<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 1 Getting started | Application of the Outcome Weights Framework for Double Machine Learning to the LaLonde Study</title>
  <meta name="description" content="<p>This book replicates the LaLonde study by Imbens &amp; Xu (2024) and extends it by comparing a
full with a reduced covariate model to assess potential confounding.
It evaluates various methods to improve overlap and covariate balance for robust
treatment effect estimation and applies the outcome weights framework by Knaus &amp; Pfleiderer (2024)
to assess another estimator, while analysing the distributional properties of resulting outcome weights.
It further applies placebo tests and sensitivity analysis to assess the robustness of the treatment effect estimates.
The analysis draws on the original LaLonde data (NSW) as well as the LaLonde–Dehejia–Wahba (LDW) and
LaLonde–Calónico–Smith (LCS) data.</p>" />
  <meta name="generator" content="bookdown 0.45 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 1 Getting started | Application of the Outcome Weights Framework for Double Machine Learning to the LaLonde Study" />
  <meta property="og:type" content="book" />
  
  <meta property="og:description" content="<p>This book replicates the LaLonde study by Imbens &amp; Xu (2024) and extends it by comparing a
full with a reduced covariate model to assess potential confounding.
It evaluates various methods to improve overlap and covariate balance for robust
treatment effect estimation and applies the outcome weights framework by Knaus &amp; Pfleiderer (2024)
to assess another estimator, while analysing the distributional properties of resulting outcome weights.
It further applies placebo tests and sensitivity analysis to assess the robustness of the treatment effect estimates.
The analysis draws on the original LaLonde data (NSW) as well as the LaLonde–Dehejia–Wahba (LDW) and
LaLonde–Calónico–Smith (LCS) data.</p>" />
  <meta name="github-repo" content="lkrsl/Application-of-Outcome-Weights-Framework-for-DML-to-Lalonde-Study" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 1 Getting started | Application of the Outcome Weights Framework for Double Machine Learning to the LaLonde Study" />
  
  <meta name="twitter:description" content="<p>This book replicates the LaLonde study by Imbens &amp; Xu (2024) and extends it by comparing a
full with a reduced covariate model to assess potential confounding.
It evaluates various methods to improve overlap and covariate balance for robust
treatment effect estimation and applies the outcome weights framework by Knaus &amp; Pfleiderer (2024)
to assess another estimator, while analysing the distributional properties of resulting outcome weights.
It further applies placebo tests and sensitivity analysis to assess the robustness of the treatment effect estimates.
The analysis draws on the original LaLonde data (NSW) as well as the LaLonde–Dehejia–Wahba (LDW) and
LaLonde–Calónico–Smith (LCS) data.</p>" />
  

<meta name="author" content="Laura Kreisel" />


<meta name="date" content="2025-12-05" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="index.html"/>
<link rel="next" href="lalonde-dehejia-wahba-ldw-data.html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>
<link href="libs/htmltools-fill-0.5.8.1/fill.css" rel="stylesheet" />
<script src="libs/htmlwidgets-1.6.4/htmlwidgets.js"></script>
<link href="libs/datatables-css-0.0.0/datatables-crosstalk.css" rel="stylesheet" />
<script src="libs/datatables-binding-0.34.0/datatables.js"></script>
<link href="libs/dt-core-1.13.6/css/jquery.dataTables.min.css" rel="stylesheet" />
<link href="libs/dt-core-1.13.6/css/jquery.dataTables.extra.css" rel="stylesheet" />
<script src="libs/dt-core-1.13.6/js/jquery.dataTables.min.js"></script>
<link href="libs/crosstalk-1.2.2/css/crosstalk.min.css" rel="stylesheet" />
<script src="libs/crosstalk-1.2.2/js/crosstalk.min.js"></script>


<style type="text/css">
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
  
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
</style>
<style type="text/css">
/* Used with Pandoc 2.11+ new --citeproc when CSL is used */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
  margin-bottom: 0em;
}
.hanging div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}
</style>

<link rel="stylesheet" href="tutorial/style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Application of Outcome Weights Framework for DML to Lalonde Study</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Preface</a></li>
<li class="chapter" data-level="1" data-path="getting-started.html"><a href="getting-started.html"><i class="fa fa-check"></i><b>1</b> Getting started</a>
<ul>
<li class="chapter" data-level="1.1" data-path="getting-started.html"><a href="getting-started.html#installation"><i class="fa fa-check"></i><b>1.1</b> Installation</a></li>
<li class="chapter" data-level="1.2" data-path="getting-started.html"><a href="getting-started.html#wrapper-functions"><i class="fa fa-check"></i><b>1.2</b> Wrapper functions</a>
<ul>
<li class="chapter" data-level="1.2.1" data-path="getting-started.html"><a href="getting-started.html#overview"><i class="fa fa-check"></i><b>1.2.1</b> Overview</a></li>
<li class="chapter" data-level="1.2.2" data-path="getting-started.html"><a href="getting-started.html#inspection"><i class="fa fa-check"></i><b>1.2.2</b> Inspection</a></li>
<li class="chapter" data-level="1.2.3" data-path="getting-started.html"><a href="getting-started.html#improving-covariate-balance-and-overlap"><i class="fa fa-check"></i><b>1.2.3</b> Improving covariate balance and overlap</a></li>
<li class="chapter" data-level="1.2.4" data-path="getting-started.html"><a href="getting-started.html#assessing-methods"><i class="fa fa-check"></i><b>1.2.4</b> Assessing methods</a></li>
<li class="chapter" data-level="1.2.5" data-path="getting-started.html"><a href="getting-started.html#identifying-best-methods"><i class="fa fa-check"></i><b>1.2.5</b> Identifying best methods</a></li>
<li class="chapter" data-level="1.2.6" data-path="getting-started.html"><a href="getting-started.html#estimating"><i class="fa fa-check"></i><b>1.2.6</b> Estimating</a></li>
<li class="chapter" data-level="1.2.7" data-path="getting-started.html"><a href="getting-started.html#outcome-weights-analysis"><i class="fa fa-check"></i><b>1.2.7</b> Outcome weights analysis</a></li>
<li class="chapter" data-level="1.2.8" data-path="getting-started.html"><a href="getting-started.html#sensitivity-analysis"><i class="fa fa-check"></i><b>1.2.8</b> Sensitivity analysis</a></li>
<li class="chapter" data-level="1.2.9" data-path="getting-started.html"><a href="getting-started.html#balance-analysis"><i class="fa fa-check"></i><b>1.2.9</b> Balance analysis</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="2" data-path="lalonde-dehejia-wahba-ldw-data.html"><a href="lalonde-dehejia-wahba-ldw-data.html"><i class="fa fa-check"></i><b>2</b> LaLonde-Dehejia-Wahba (LDW) Data</a>
<ul>
<li class="chapter" data-level="2.1" data-path="lalonde-dehejia-wahba-ldw-data.html"><a href="lalonde-dehejia-wahba-ldw-data.html#set-up"><i class="fa fa-check"></i><b>2.1</b> Set up</a>
<ul>
<li class="chapter" data-level="2.1.1" data-path="lalonde-dehejia-wahba-ldw-data.html"><a href="lalonde-dehejia-wahba-ldw-data.html#source-functions-and-load-data"><i class="fa fa-check"></i><b>2.1.1</b> Source functions and load data</a></li>
<li class="chapter" data-level="2.1.2" data-path="lalonde-dehejia-wahba-ldw-data.html"><a href="lalonde-dehejia-wahba-ldw-data.html#inspect-data"><i class="fa fa-check"></i><b>2.1.2</b> Inspect data</a></li>
<li class="chapter" data-level="2.1.3" data-path="lalonde-dehejia-wahba-ldw-data.html"><a href="lalonde-dehejia-wahba-ldw-data.html#load-and-preprocess-data"><i class="fa fa-check"></i><b>2.1.3</b> Load and preprocess data</a></li>
</ul></li>
<li class="chapter" data-level="2.2" data-path="lalonde-dehejia-wahba-ldw-data.html"><a href="lalonde-dehejia-wahba-ldw-data.html#ldw-model-a"><i class="fa fa-check"></i><b>2.2</b> LDW-Model A</a></li>
<li class="chapter" data-level="2.3" data-path="lalonde-dehejia-wahba-ldw-data.html"><a href="lalonde-dehejia-wahba-ldw-data.html#pre-assessing-methods"><i class="fa fa-check"></i><b>2.3</b> Pre-assessing methods</a>
<ul>
<li class="chapter" data-level="2.3.1" data-path="lalonde-dehejia-wahba-ldw-data.html"><a href="lalonde-dehejia-wahba-ldw-data.html#overlap"><i class="fa fa-check"></i><b>2.3.1</b> Overlap</a></li>
</ul></li>
<li class="chapter" data-level="2.4" data-path="lalonde-dehejia-wahba-ldw-data.html"><a href="lalonde-dehejia-wahba-ldw-data.html#improving-overlap"><i class="fa fa-check"></i><b>2.4</b> Improving overlap</a>
<ul>
<li class="chapter" data-level="2.4.1" data-path="lalonde-dehejia-wahba-ldw-data.html"><a href="lalonde-dehejia-wahba-ldw-data.html#single-methods"><i class="fa fa-check"></i><b>2.4.1</b> Single methods</a></li>
<li class="chapter" data-level="2.4.2" data-path="lalonde-dehejia-wahba-ldw-data.html"><a href="lalonde-dehejia-wahba-ldw-data.html#integrated-methods-2"><i class="fa fa-check"></i><b>2.4.2</b> Integrated methods</a></li>
</ul></li>
<li class="chapter" data-level="2.5" data-path="lalonde-dehejia-wahba-ldw-data.html"><a href="lalonde-dehejia-wahba-ldw-data.html#post-assessing-methods"><i class="fa fa-check"></i><b>2.5</b> Post-assessing methods</a>
<ul>
<li class="chapter" data-level="2.5.1" data-path="lalonde-dehejia-wahba-ldw-data.html"><a href="lalonde-dehejia-wahba-ldw-data.html#single-methods-1"><i class="fa fa-check"></i><b>2.5.1</b> Single methods</a></li>
<li class="chapter" data-level="2.5.2" data-path="lalonde-dehejia-wahba-ldw-data.html"><a href="lalonde-dehejia-wahba-ldw-data.html#integrated-methods-3"><i class="fa fa-check"></i><b>2.5.2</b> Integrated methods</a></li>
</ul></li>
<li class="chapter" data-level="2.6" data-path="lalonde-dehejia-wahba-ldw-data.html"><a href="lalonde-dehejia-wahba-ldw-data.html#identifying-most-efficient-methods"><i class="fa fa-check"></i><b>2.6</b> Identifying most efficient methods</a>
<ul>
<li class="chapter" data-level="2.6.1" data-path="lalonde-dehejia-wahba-ldw-data.html"><a href="lalonde-dehejia-wahba-ldw-data.html#ranking"><i class="fa fa-check"></i><b>2.6.1</b> Ranking</a></li>
<li class="chapter" data-level="2.6.2" data-path="lalonde-dehejia-wahba-ldw-data.html"><a href="lalonde-dehejia-wahba-ldw-data.html#sample-construction"><i class="fa fa-check"></i><b>2.6.2</b> Sample construction</a></li>
</ul></li>
<li class="chapter" data-level="2.7" data-path="lalonde-dehejia-wahba-ldw-data.html"><a href="lalonde-dehejia-wahba-ldw-data.html#estimating-1"><i class="fa fa-check"></i><b>2.7</b> Estimating</a>
<ul>
<li class="chapter" data-level="2.7.1" data-path="lalonde-dehejia-wahba-ldw-data.html"><a href="lalonde-dehejia-wahba-ldw-data.html#average-treatment-effect-on-the-treated-att"><i class="fa fa-check"></i><b>2.7.1</b> Average treatment effect on the treated (ATT)</a></li>
<li class="chapter" data-level="2.7.2" data-path="lalonde-dehejia-wahba-ldw-data.html"><a href="lalonde-dehejia-wahba-ldw-data.html#conditional-average-treatment-effect-on-the-treated-catt-1"><i class="fa fa-check"></i><b>2.7.2</b> Conditional average treatment effect on the treated (CATT)</a></li>
<li class="chapter" data-level="2.7.3" data-path="lalonde-dehejia-wahba-ldw-data.html"><a href="lalonde-dehejia-wahba-ldw-data.html#quantile-treatment-effect-on-the-treated-qtet"><i class="fa fa-check"></i><b>2.7.3</b> Quantile treatment effect on the treated (QTET)</a></li>
<li class="chapter" data-level="2.7.4" data-path="lalonde-dehejia-wahba-ldw-data.html"><a href="lalonde-dehejia-wahba-ldw-data.html#assessing-outcome-weights-ow"><i class="fa fa-check"></i><b>2.7.4</b> Assessing outcome weights (OW)</a></li>
</ul></li>
<li class="chapter" data-level="2.8" data-path="lalonde-dehejia-wahba-ldw-data.html"><a href="lalonde-dehejia-wahba-ldw-data.html#validation-through-placebo-analyses"><i class="fa fa-check"></i><b>2.8</b> Validation through placebo analyses</a></li>
<li class="chapter" data-level="2.9" data-path="lalonde-dehejia-wahba-ldw-data.html"><a href="lalonde-dehejia-wahba-ldw-data.html#validation-through-sensitivity-analyses"><i class="fa fa-check"></i><b>2.9</b> Validation through sensitivity analyses</a></li>
<li class="chapter" data-level="2.10" data-path="lalonde-dehejia-wahba-ldw-data.html"><a href="lalonde-dehejia-wahba-ldw-data.html#inspection-of-re74-and-re75"><i class="fa fa-check"></i><b>2.10</b> Inspection of re74 and re75</a>
<ul>
<li class="chapter" data-level="2.10.1" data-path="lalonde-dehejia-wahba-ldw-data.html"><a href="lalonde-dehejia-wahba-ldw-data.html#correlation"><i class="fa fa-check"></i><b>2.10.1</b> Correlation</a></li>
<li class="chapter" data-level="2.10.2" data-path="lalonde-dehejia-wahba-ldw-data.html"><a href="lalonde-dehejia-wahba-ldw-data.html#distributional-balance"><i class="fa fa-check"></i><b>2.10.2</b> Distributional balance</a></li>
</ul></li>
<li class="chapter" data-level="2.11" data-path="lalonde-dehejia-wahba-ldw-data.html"><a href="lalonde-dehejia-wahba-ldw-data.html#summary"><i class="fa fa-check"></i><b>2.11</b> Summary</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="lalonde-dehejia-wahba-ldw-data-1.html"><a href="lalonde-dehejia-wahba-ldw-data-1.html"><i class="fa fa-check"></i><b>3</b> LaLonde-Dehejia-Wahba (LDW) Data</a>
<ul>
<li class="chapter" data-level="3.1" data-path="lalonde-dehejia-wahba-ldw-data-1.html"><a href="lalonde-dehejia-wahba-ldw-data-1.html#set-up-1"><i class="fa fa-check"></i><b>3.1</b> Set up</a>
<ul>
<li class="chapter" data-level="3.1.1" data-path="lalonde-dehejia-wahba-ldw-data-1.html"><a href="lalonde-dehejia-wahba-ldw-data-1.html#source-functions-and-load-data-1"><i class="fa fa-check"></i><b>3.1.1</b> Source functions and load data</a></li>
<li class="chapter" data-level="3.1.2" data-path="lalonde-dehejia-wahba-ldw-data-1.html"><a href="lalonde-dehejia-wahba-ldw-data-1.html#inspect-data-1"><i class="fa fa-check"></i><b>3.1.2</b> Inspect data</a></li>
<li class="chapter" data-level="3.1.3" data-path="lalonde-dehejia-wahba-ldw-data-1.html"><a href="lalonde-dehejia-wahba-ldw-data-1.html#load-and-preprocess-data-1"><i class="fa fa-check"></i><b>3.1.3</b> Load and preprocess data</a></li>
</ul></li>
<li class="chapter" data-level="3.2" data-path="lalonde-dehejia-wahba-ldw-data-1.html"><a href="lalonde-dehejia-wahba-ldw-data-1.html#ldw-model-b"><i class="fa fa-check"></i><b>3.2</b> LDW-Model B</a></li>
<li class="chapter" data-level="3.3" data-path="lalonde-dehejia-wahba-ldw-data-1.html"><a href="lalonde-dehejia-wahba-ldw-data-1.html#pre-assessing-methods-1"><i class="fa fa-check"></i><b>3.3</b> Pre-assessing methods</a>
<ul>
<li class="chapter" data-level="3.3.1" data-path="lalonde-dehejia-wahba-ldw-data-1.html"><a href="lalonde-dehejia-wahba-ldw-data-1.html#overlap-1"><i class="fa fa-check"></i><b>3.3.1</b> Overlap</a></li>
</ul></li>
<li class="chapter" data-level="3.4" data-path="lalonde-dehejia-wahba-ldw-data-1.html"><a href="lalonde-dehejia-wahba-ldw-data-1.html#improving-overlap-1"><i class="fa fa-check"></i><b>3.4</b> Improving overlap</a>
<ul>
<li class="chapter" data-level="3.4.1" data-path="lalonde-dehejia-wahba-ldw-data-1.html"><a href="lalonde-dehejia-wahba-ldw-data-1.html#single-methods-2"><i class="fa fa-check"></i><b>3.4.1</b> Single methods</a></li>
<li class="chapter" data-level="3.4.2" data-path="lalonde-dehejia-wahba-ldw-data-1.html"><a href="lalonde-dehejia-wahba-ldw-data-1.html#integrated-methods-4"><i class="fa fa-check"></i><b>3.4.2</b> Integrated methods</a></li>
</ul></li>
<li class="chapter" data-level="3.5" data-path="lalonde-dehejia-wahba-ldw-data-1.html"><a href="lalonde-dehejia-wahba-ldw-data-1.html#post-assessing-methods-1"><i class="fa fa-check"></i><b>3.5</b> Post-assessing methods</a>
<ul>
<li class="chapter" data-level="3.5.1" data-path="lalonde-dehejia-wahba-ldw-data-1.html"><a href="lalonde-dehejia-wahba-ldw-data-1.html#single-methods-3"><i class="fa fa-check"></i><b>3.5.1</b> Single methods</a></li>
<li class="chapter" data-level="3.5.2" data-path="lalonde-dehejia-wahba-ldw-data-1.html"><a href="lalonde-dehejia-wahba-ldw-data-1.html#integrated-methods-5"><i class="fa fa-check"></i><b>3.5.2</b> Integrated methods</a></li>
</ul></li>
<li class="chapter" data-level="3.6" data-path="lalonde-dehejia-wahba-ldw-data-1.html"><a href="lalonde-dehejia-wahba-ldw-data-1.html#identifying-most-efficient-methods-1"><i class="fa fa-check"></i><b>3.6</b> Identifying most efficient methods</a>
<ul>
<li class="chapter" data-level="3.6.1" data-path="lalonde-dehejia-wahba-ldw-data-1.html"><a href="lalonde-dehejia-wahba-ldw-data-1.html#ranking-1"><i class="fa fa-check"></i><b>3.6.1</b> Ranking</a></li>
<li class="chapter" data-level="3.6.2" data-path="lalonde-dehejia-wahba-ldw-data-1.html"><a href="lalonde-dehejia-wahba-ldw-data-1.html#sample-construction-1"><i class="fa fa-check"></i><b>3.6.2</b> Sample construction</a></li>
</ul></li>
<li class="chapter" data-level="3.7" data-path="lalonde-dehejia-wahba-ldw-data-1.html"><a href="lalonde-dehejia-wahba-ldw-data-1.html#estimating-2"><i class="fa fa-check"></i><b>3.7</b> Estimating</a>
<ul>
<li class="chapter" data-level="3.7.1" data-path="lalonde-dehejia-wahba-ldw-data-1.html"><a href="lalonde-dehejia-wahba-ldw-data-1.html#average-treatment-effect-on-the-treated-att-1"><i class="fa fa-check"></i><b>3.7.1</b> Average treatment effect on the treated (ATT)</a></li>
<li class="chapter" data-level="3.7.2" data-path="lalonde-dehejia-wahba-ldw-data-1.html"><a href="lalonde-dehejia-wahba-ldw-data-1.html#conditional-average-treatment-effect-on-the-treated-catt-2"><i class="fa fa-check"></i><b>3.7.2</b> Conditional average treatment effect on the treated (CATT)</a></li>
<li class="chapter" data-level="3.7.3" data-path="lalonde-dehejia-wahba-ldw-data-1.html"><a href="lalonde-dehejia-wahba-ldw-data-1.html#quantile-treatment-effect-on-the-treated-qtet-1"><i class="fa fa-check"></i><b>3.7.3</b> Quantile treatment effect on the treated (QTET)</a></li>
<li class="chapter" data-level="3.7.4" data-path="lalonde-dehejia-wahba-ldw-data-1.html"><a href="lalonde-dehejia-wahba-ldw-data-1.html#assessing-outcome-weights-ow-1"><i class="fa fa-check"></i><b>3.7.4</b> Assessing outcome weights (OW)</a></li>
</ul></li>
<li class="chapter" data-level="3.8" data-path="lalonde-dehejia-wahba-ldw-data-1.html"><a href="lalonde-dehejia-wahba-ldw-data-1.html#validation-through-placebo-analyses-1"><i class="fa fa-check"></i><b>3.8</b> Validation through placebo analyses</a></li>
<li class="chapter" data-level="3.9" data-path="lalonde-dehejia-wahba-ldw-data-1.html"><a href="lalonde-dehejia-wahba-ldw-data-1.html#validation-through-sensitivity-analyses-1"><i class="fa fa-check"></i><b>3.9</b> Validation through sensitivity analyses</a></li>
<li class="chapter" data-level="3.10" data-path="lalonde-dehejia-wahba-ldw-data-1.html"><a href="lalonde-dehejia-wahba-ldw-data-1.html#inspection-of-re74-and-re75-1"><i class="fa fa-check"></i><b>3.10</b> Inspection of re74 and re75</a>
<ul>
<li class="chapter" data-level="3.10.1" data-path="lalonde-dehejia-wahba-ldw-data-1.html"><a href="lalonde-dehejia-wahba-ldw-data-1.html#correlation-1"><i class="fa fa-check"></i><b>3.10.1</b> Correlation</a></li>
<li class="chapter" data-level="3.10.2" data-path="lalonde-dehejia-wahba-ldw-data-1.html"><a href="lalonde-dehejia-wahba-ldw-data-1.html#distributional-balance-1"><i class="fa fa-check"></i><b>3.10.2</b> Distributional balance</a></li>
</ul></li>
<li class="chapter" data-level="3.11" data-path="lalonde-dehejia-wahba-ldw-data-1.html"><a href="lalonde-dehejia-wahba-ldw-data-1.html#summary-1"><i class="fa fa-check"></i><b>3.11</b> Summary</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="lalonde-nsw-data.html"><a href="lalonde-nsw-data.html"><i class="fa fa-check"></i><b>4</b> LaLonde (NSW) Data</a>
<ul>
<li class="chapter" data-level="4.1" data-path="lalonde-nsw-data.html"><a href="lalonde-nsw-data.html#set-up-2"><i class="fa fa-check"></i><b>4.1</b> Set up</a>
<ul>
<li class="chapter" data-level="4.1.1" data-path="lalonde-nsw-data.html"><a href="lalonde-nsw-data.html#source-functions-and-load-data-2"><i class="fa fa-check"></i><b>4.1.1</b> Source functions and load data</a></li>
<li class="chapter" data-level="4.1.2" data-path="lalonde-nsw-data.html"><a href="lalonde-nsw-data.html#load-and-preprocess-data-2"><i class="fa fa-check"></i><b>4.1.2</b> Load and preprocess data</a></li>
<li class="chapter" data-level="4.1.3" data-path="lalonde-nsw-data.html"><a href="lalonde-nsw-data.html#inspect-data-2"><i class="fa fa-check"></i><b>4.1.3</b> Inspect data</a></li>
</ul></li>
<li class="chapter" data-level="4.2" data-path="lalonde-nsw-data.html"><a href="lalonde-nsw-data.html#nsw"><i class="fa fa-check"></i><b>4.2</b> NSW</a></li>
<li class="chapter" data-level="4.3" data-path="lalonde-nsw-data.html"><a href="lalonde-nsw-data.html#pre-assessing-methods-2"><i class="fa fa-check"></i><b>4.3</b> Pre-assessing methods</a>
<ul>
<li class="chapter" data-level="4.3.1" data-path="lalonde-nsw-data.html"><a href="lalonde-nsw-data.html#overlap-2"><i class="fa fa-check"></i><b>4.3.1</b> Overlap</a></li>
</ul></li>
<li class="chapter" data-level="4.4" data-path="lalonde-nsw-data.html"><a href="lalonde-nsw-data.html#improving-overlap-2"><i class="fa fa-check"></i><b>4.4</b> Improving overlap</a>
<ul>
<li class="chapter" data-level="4.4.1" data-path="lalonde-nsw-data.html"><a href="lalonde-nsw-data.html#single-methods-4"><i class="fa fa-check"></i><b>4.4.1</b> Single methods</a></li>
<li class="chapter" data-level="4.4.2" data-path="lalonde-nsw-data.html"><a href="lalonde-nsw-data.html#integrated-methods-6"><i class="fa fa-check"></i><b>4.4.2</b> Integrated methods</a></li>
</ul></li>
<li class="chapter" data-level="4.5" data-path="lalonde-nsw-data.html"><a href="lalonde-nsw-data.html#post-assessing-methods-2"><i class="fa fa-check"></i><b>4.5</b> Post-assessing methods</a>
<ul>
<li class="chapter" data-level="4.5.1" data-path="lalonde-nsw-data.html"><a href="lalonde-nsw-data.html#single-methods-5"><i class="fa fa-check"></i><b>4.5.1</b> Single methods</a></li>
<li class="chapter" data-level="4.5.2" data-path="lalonde-nsw-data.html"><a href="lalonde-nsw-data.html#integrated-methods-7"><i class="fa fa-check"></i><b>4.5.2</b> Integrated methods</a></li>
</ul></li>
<li class="chapter" data-level="4.6" data-path="lalonde-nsw-data.html"><a href="lalonde-nsw-data.html#identifying-most-efficient-methods-2"><i class="fa fa-check"></i><b>4.6</b> Identifying most efficient methods</a>
<ul>
<li class="chapter" data-level="4.6.1" data-path="lalonde-nsw-data.html"><a href="lalonde-nsw-data.html#ranking-2"><i class="fa fa-check"></i><b>4.6.1</b> Ranking</a></li>
<li class="chapter" data-level="4.6.2" data-path="lalonde-nsw-data.html"><a href="lalonde-nsw-data.html#sample-construction-2"><i class="fa fa-check"></i><b>4.6.2</b> Sample construction</a></li>
</ul></li>
<li class="chapter" data-level="4.7" data-path="lalonde-nsw-data.html"><a href="lalonde-nsw-data.html#estimating-3"><i class="fa fa-check"></i><b>4.7</b> Estimating</a>
<ul>
<li class="chapter" data-level="4.7.1" data-path="lalonde-nsw-data.html"><a href="lalonde-nsw-data.html#average-treatment-effect-on-the-treated-att-2"><i class="fa fa-check"></i><b>4.7.1</b> Average treatment effect on the treated (ATT)</a></li>
<li class="chapter" data-level="4.7.2" data-path="lalonde-nsw-data.html"><a href="lalonde-nsw-data.html#conditional-average-treatment-effect-on-the-treated-catt-3"><i class="fa fa-check"></i><b>4.7.2</b> Conditional average treatment effect on the treated (CATT)</a></li>
<li class="chapter" data-level="4.7.3" data-path="lalonde-nsw-data.html"><a href="lalonde-nsw-data.html#quantile-treatment-effect-on-the-treated-qtet-2"><i class="fa fa-check"></i><b>4.7.3</b> Quantile treatment effect on the treated (QTET)</a></li>
<li class="chapter" data-level="4.7.4" data-path="lalonde-nsw-data.html"><a href="lalonde-nsw-data.html#assessing-outcome-weights-ow-2"><i class="fa fa-check"></i><b>4.7.4</b> Assessing outcome weights (OW)</a></li>
</ul></li>
<li class="chapter" data-level="4.8" data-path="lalonde-nsw-data.html"><a href="lalonde-nsw-data.html#validation-through-sensitivity-analyses-2"><i class="fa fa-check"></i><b>4.8</b> Validation through sensitivity analyses</a></li>
<li class="chapter" data-level="4.9" data-path="lalonde-nsw-data.html"><a href="lalonde-nsw-data.html#summary-2"><i class="fa fa-check"></i><b>4.9</b> Summary</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="lalonde-calónico-smith-lcs-data.html"><a href="lalonde-calónico-smith-lcs-data.html"><i class="fa fa-check"></i><b>5</b> LaLonde-Calónico-Smith (LCS) Data</a>
<ul>
<li class="chapter" data-level="5.1" data-path="lalonde-calónico-smith-lcs-data.html"><a href="lalonde-calónico-smith-lcs-data.html#set-up-3"><i class="fa fa-check"></i><b>5.1</b> Set up</a>
<ul>
<li class="chapter" data-level="5.1.1" data-path="lalonde-calónico-smith-lcs-data.html"><a href="lalonde-calónico-smith-lcs-data.html#source-functions-and-load-data-3"><i class="fa fa-check"></i><b>5.1.1</b> Source functions and load data</a></li>
<li class="chapter" data-level="5.1.2" data-path="lalonde-calónico-smith-lcs-data.html"><a href="lalonde-calónico-smith-lcs-data.html#load-and-preprocess-data-3"><i class="fa fa-check"></i><b>5.1.2</b> Load and preprocess data</a></li>
<li class="chapter" data-level="5.1.3" data-path="lalonde-calónico-smith-lcs-data.html"><a href="lalonde-calónico-smith-lcs-data.html#inspect-data-3"><i class="fa fa-check"></i><b>5.1.3</b> Inspect data</a></li>
</ul></li>
<li class="chapter" data-level="5.2" data-path="lalonde-calónico-smith-lcs-data.html"><a href="lalonde-calónico-smith-lcs-data.html#lcs"><i class="fa fa-check"></i><b>5.2</b> LCS</a></li>
<li class="chapter" data-level="5.3" data-path="lalonde-calónico-smith-lcs-data.html"><a href="lalonde-calónico-smith-lcs-data.html#pre-assessing-methods-3"><i class="fa fa-check"></i><b>5.3</b> Pre-assessing methods</a>
<ul>
<li class="chapter" data-level="5.3.1" data-path="lalonde-calónico-smith-lcs-data.html"><a href="lalonde-calónico-smith-lcs-data.html#overlap-3"><i class="fa fa-check"></i><b>5.3.1</b> Overlap</a></li>
</ul></li>
<li class="chapter" data-level="5.4" data-path="lalonde-calónico-smith-lcs-data.html"><a href="lalonde-calónico-smith-lcs-data.html#improving-overlap-3"><i class="fa fa-check"></i><b>5.4</b> Improving overlap</a>
<ul>
<li class="chapter" data-level="5.4.1" data-path="lalonde-calónico-smith-lcs-data.html"><a href="lalonde-calónico-smith-lcs-data.html#single-methods-6"><i class="fa fa-check"></i><b>5.4.1</b> Single methods</a></li>
<li class="chapter" data-level="5.4.2" data-path="lalonde-calónico-smith-lcs-data.html"><a href="lalonde-calónico-smith-lcs-data.html#integrated-methods-8"><i class="fa fa-check"></i><b>5.4.2</b> Integrated methods</a></li>
</ul></li>
<li class="chapter" data-level="5.5" data-path="lalonde-calónico-smith-lcs-data.html"><a href="lalonde-calónico-smith-lcs-data.html#post-assessing-methods-3"><i class="fa fa-check"></i><b>5.5</b> Post-assessing methods</a>
<ul>
<li class="chapter" data-level="5.5.1" data-path="lalonde-calónico-smith-lcs-data.html"><a href="lalonde-calónico-smith-lcs-data.html#single-methods-7"><i class="fa fa-check"></i><b>5.5.1</b> Single methods</a></li>
<li class="chapter" data-level="5.5.2" data-path="lalonde-calónico-smith-lcs-data.html"><a href="lalonde-calónico-smith-lcs-data.html#integrated-methods-9"><i class="fa fa-check"></i><b>5.5.2</b> Integrated methods</a></li>
</ul></li>
<li class="chapter" data-level="5.6" data-path="lalonde-calónico-smith-lcs-data.html"><a href="lalonde-calónico-smith-lcs-data.html#identifying-most-efficient-methods-3"><i class="fa fa-check"></i><b>5.6</b> Identifying most efficient methods</a>
<ul>
<li class="chapter" data-level="5.6.1" data-path="lalonde-calónico-smith-lcs-data.html"><a href="lalonde-calónico-smith-lcs-data.html#ranking-3"><i class="fa fa-check"></i><b>5.6.1</b> Ranking</a></li>
<li class="chapter" data-level="5.6.2" data-path="lalonde-calónico-smith-lcs-data.html"><a href="lalonde-calónico-smith-lcs-data.html#sample-construction-3"><i class="fa fa-check"></i><b>5.6.2</b> Sample construction</a></li>
</ul></li>
<li class="chapter" data-level="5.7" data-path="lalonde-calónico-smith-lcs-data.html"><a href="lalonde-calónico-smith-lcs-data.html#estimating-4"><i class="fa fa-check"></i><b>5.7</b> Estimating</a>
<ul>
<li class="chapter" data-level="5.7.1" data-path="lalonde-calónico-smith-lcs-data.html"><a href="lalonde-calónico-smith-lcs-data.html#average-treatment-effect-on-the-treated-att-3"><i class="fa fa-check"></i><b>5.7.1</b> Average treatment effect on the treated (ATT)</a></li>
<li class="chapter" data-level="5.7.2" data-path="lalonde-calónico-smith-lcs-data.html"><a href="lalonde-calónico-smith-lcs-data.html#conditional-average-treatment-effect-on-the-treated-catt-4"><i class="fa fa-check"></i><b>5.7.2</b> Conditional average treatment effect on the treated (CATT)</a></li>
<li class="chapter" data-level="5.7.3" data-path="lalonde-calónico-smith-lcs-data.html"><a href="lalonde-calónico-smith-lcs-data.html#quantile-treatment-effect-on-the-treated-qtet-3"><i class="fa fa-check"></i><b>5.7.3</b> Quantile treatment effect on the treated (QTET)</a></li>
<li class="chapter" data-level="5.7.4" data-path="lalonde-calónico-smith-lcs-data.html"><a href="lalonde-calónico-smith-lcs-data.html#assessing-outcome-weights-ow-3"><i class="fa fa-check"></i><b>5.7.4</b> Assessing outcome weights (OW)</a></li>
</ul></li>
<li class="chapter" data-level="5.8" data-path="lalonde-calónico-smith-lcs-data.html"><a href="lalonde-calónico-smith-lcs-data.html#validation-through-placebo-analyses-2"><i class="fa fa-check"></i><b>5.8</b> Validation through placebo analyses</a></li>
<li class="chapter" data-level="5.9" data-path="lalonde-calónico-smith-lcs-data.html"><a href="lalonde-calónico-smith-lcs-data.html#validation-through-sensitivity-analyses-3"><i class="fa fa-check"></i><b>5.9</b> Validation through sensitivity analyses</a></li>
<li class="chapter" data-level="5.10" data-path="lalonde-calónico-smith-lcs-data.html"><a href="lalonde-calónico-smith-lcs-data.html#summary-3"><i class="fa fa-check"></i><b>5.10</b> Summary</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i>References</a></li>
<li class="divider"></li>
<li><a href="https://github.com/lkrsl/Application-of-Outcome-Weights-Framework-for-DML-to-Lalonde-Study" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Application of the Outcome Weights Framework for Double Machine Learning to the LaLonde Study</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="getting-started" class="section level1 hasAnchor" number="1">
<h1><span class="header-section-number">Chapter 1</span> Getting started<a href="getting-started.html#getting-started" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<div class="callout-caution">
<p>The functions presented below constitute the core wrapper functions utilized throughout the analysis, including functions originally from the <span class="citation">Imbens and Xu (<a href="#ref-imbens2024">2024</a>)</span> tutorial, that were modified to suit specific analytical purposes (highlighted by ***), as well as others that were integrated without modification. For the full collection of functions by <span class="citation">Imbens and Xu (<a href="#ref-imbens2024">2024</a>)</span>, please consult their official source code available on their GitHub <a href="https://github.com/xuyiqing/lalonde">repository</a>.</p>
</div>
<div id="installation" class="section level2 hasAnchor" number="1.1">
<h2><span class="header-section-number">1.1</span> Installation<a href="getting-started.html#installation" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Several R packages are required for the data analysis and visualization. The code below checks for all required packages and installs those that are missing. Once installation is complete, the packages must be loaded.</p>
<div class="callout-note">
<p>Since the analysis sources functions directly from the <span class="citation">Imbens and Xu (<a href="#ref-imbens2024">2024</a>)</span> tutorial, the required packages are automatically installed and loaded as part of that process. Therefore, it is only necessary to install and load any additional packages as well as add custom functions that are required for the analysis.</p>
</div>
<p><strong>Packages</strong>: “CBPS”, “cobalt”, “data.table”, “dplyr”, “DT”, “DoubleML”, “ebal”, “estimatr”, “ggplot2”, “gridExtra”, “grf”,
“hbal”, “highr”, “highs”, “kableExtra”, “MatchIt”, “Matching”, “mlr3”, “mlr3learners”, “OutcomeWeights”,
“optmatch”, “optweight”, “quickmatch”, “readr”, “rgenoud”, “tidyr”, “tidyverse”, “patchwork”, “ppcor”, “WeightIt”</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="getting-started.html#cb1-1" tabindex="-1"></a><span class="co"># required packages</span></span>
<span id="cb1-2"><a href="getting-started.html#cb1-2" tabindex="-1"></a>packages <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;CBPS&quot;</span>, <span class="st">&quot;cobalt&quot;</span>, <span class="st">&quot;data.table&quot;</span>, <span class="st">&quot;dplyr&quot;</span>, <span class="st">&quot;DT&quot;</span>, <span class="st">&quot;DoubleML&quot;</span>, <span class="st">&quot;ebal&quot;</span>, <span class="st">&quot;estimatr&quot;</span>, <span class="st">&quot;ggplot2&quot;</span>, <span class="st">&quot;gridExtra&quot;</span>, <span class="st">&quot;grf&quot;</span>,</span>
<span id="cb1-3"><a href="getting-started.html#cb1-3" tabindex="-1"></a>              <span class="st">&quot;hbal&quot;</span>, <span class="st">&quot;highr&quot;</span>, <span class="st">&quot;highs&quot;</span>, <span class="st">&quot;kableExtra&quot;</span>, <span class="st">&quot;MatchIt&quot;</span>, <span class="st">&quot;Matching&quot;</span>, <span class="st">&quot;mlr3&quot;</span>, <span class="st">&quot;mlr3learners&quot;</span>, <span class="st">&quot;OutcomeWeights&quot;</span>,</span>
<span id="cb1-4"><a href="getting-started.html#cb1-4" tabindex="-1"></a>              <span class="st">&quot;optmatch&quot;</span>, <span class="st">&quot;optweight&quot;</span>, <span class="st">&quot;quickmatch&quot;</span>, <span class="st">&quot;readr&quot;</span>, <span class="st">&quot;rgenoud&quot;</span>, <span class="st">&quot;tidyr&quot;</span>, <span class="st">&quot;tidyverse&quot;</span>, <span class="st">&quot;patchwork&quot;</span>, <span class="st">&quot;ppcor&quot;</span>, <span class="st">&quot;WeightIt&quot;</span></span>
<span id="cb1-5"><a href="getting-started.html#cb1-5" tabindex="-1"></a>)</span>
<span id="cb1-6"><a href="getting-started.html#cb1-6" tabindex="-1"></a></span>
<span id="cb1-7"><a href="getting-started.html#cb1-7" tabindex="-1"></a><span class="co"># install packages</span></span>
<span id="cb1-8"><a href="getting-started.html#cb1-8" tabindex="-1"></a>install_all <span class="ot">&lt;-</span> <span class="cf">function</span>(packages) {</span>
<span id="cb1-9"><a href="getting-started.html#cb1-9" tabindex="-1"></a>  installed_pkgs <span class="ot">&lt;-</span> <span class="fu">installed.packages</span>()[, <span class="st">&quot;Package&quot;</span>]</span>
<span id="cb1-10"><a href="getting-started.html#cb1-10" tabindex="-1"></a>  <span class="cf">for</span> (pkg <span class="cf">in</span> packages) {</span>
<span id="cb1-11"><a href="getting-started.html#cb1-11" tabindex="-1"></a>    <span class="cf">if</span> (<span class="sc">!</span>pkg <span class="sc">%in%</span> installed_pkgs) {</span>
<span id="cb1-12"><a href="getting-started.html#cb1-12" tabindex="-1"></a>      <span class="fu">install.packages</span>(pkg)</span>
<span id="cb1-13"><a href="getting-started.html#cb1-13" tabindex="-1"></a>    }</span>
<span id="cb1-14"><a href="getting-started.html#cb1-14" tabindex="-1"></a>  }</span>
<span id="cb1-15"><a href="getting-started.html#cb1-15" tabindex="-1"></a>}</span>
<span id="cb1-16"><a href="getting-started.html#cb1-16" tabindex="-1"></a></span>
<span id="cb1-17"><a href="getting-started.html#cb1-17" tabindex="-1"></a><span class="fu">install_all</span>(packages)</span>
<span id="cb1-18"><a href="getting-started.html#cb1-18" tabindex="-1"></a></span>
<span id="cb1-19"><a href="getting-started.html#cb1-19" tabindex="-1"></a><span class="co"># load packages</span></span>
<span id="cb1-20"><a href="getting-started.html#cb1-20" tabindex="-1"></a><span class="fu">library</span>(CBPS)</span>
<span id="cb1-21"><a href="getting-started.html#cb1-21" tabindex="-1"></a><span class="fu">library</span>(cobalt)</span>
<span id="cb1-22"><a href="getting-started.html#cb1-22" tabindex="-1"></a><span class="fu">library</span>(data.table)</span>
<span id="cb1-23"><a href="getting-started.html#cb1-23" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb1-24"><a href="getting-started.html#cb1-24" tabindex="-1"></a><span class="fu">library</span>(DT)</span>
<span id="cb1-25"><a href="getting-started.html#cb1-25" tabindex="-1"></a><span class="fu">library</span>(DoubleML)</span>
<span id="cb1-26"><a href="getting-started.html#cb1-26" tabindex="-1"></a><span class="fu">library</span>(ebal)</span>
<span id="cb1-27"><a href="getting-started.html#cb1-27" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb1-28"><a href="getting-started.html#cb1-28" tabindex="-1"></a><span class="fu">library</span>(gridExtra)</span>
<span id="cb1-29"><a href="getting-started.html#cb1-29" tabindex="-1"></a><span class="fu">library</span>(grf)</span>
<span id="cb1-30"><a href="getting-started.html#cb1-30" tabindex="-1"></a><span class="fu">library</span>(hbal)</span>
<span id="cb1-31"><a href="getting-started.html#cb1-31" tabindex="-1"></a><span class="fu">library</span>(highr)</span>
<span id="cb1-32"><a href="getting-started.html#cb1-32" tabindex="-1"></a><span class="fu">library</span>(highs)</span>
<span id="cb1-33"><a href="getting-started.html#cb1-33" tabindex="-1"></a><span class="fu">library</span>(kableExtra)</span>
<span id="cb1-34"><a href="getting-started.html#cb1-34" tabindex="-1"></a><span class="fu">library</span>(MatchIt)</span>
<span id="cb1-35"><a href="getting-started.html#cb1-35" tabindex="-1"></a><span class="fu">library</span>(Matching)</span>
<span id="cb1-36"><a href="getting-started.html#cb1-36" tabindex="-1"></a><span class="fu">library</span>(mlr3)</span>
<span id="cb1-37"><a href="getting-started.html#cb1-37" tabindex="-1"></a><span class="fu">library</span>(mlr3learners)</span>
<span id="cb1-38"><a href="getting-started.html#cb1-38" tabindex="-1"></a><span class="fu">library</span>(optmatch)</span>
<span id="cb1-39"><a href="getting-started.html#cb1-39" tabindex="-1"></a><span class="fu">library</span>(optweight)</span>
<span id="cb1-40"><a href="getting-started.html#cb1-40" tabindex="-1"></a><span class="fu">library</span>(quickmatch)</span>
<span id="cb1-41"><a href="getting-started.html#cb1-41" tabindex="-1"></a><span class="fu">library</span>(readr)</span>
<span id="cb1-42"><a href="getting-started.html#cb1-42" tabindex="-1"></a><span class="fu">library</span>(rgenoud)</span>
<span id="cb1-43"><a href="getting-started.html#cb1-43" tabindex="-1"></a><span class="fu">library</span>(tidyr)</span>
<span id="cb1-44"><a href="getting-started.html#cb1-44" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb1-45"><a href="getting-started.html#cb1-45" tabindex="-1"></a><span class="fu">library</span>(ppcor)</span>
<span id="cb1-46"><a href="getting-started.html#cb1-46" tabindex="-1"></a><span class="fu">library</span>(patchwork)</span>
<span id="cb1-47"><a href="getting-started.html#cb1-47" tabindex="-1"></a><span class="fu">library</span>(WeightIt)</span>
<span id="cb1-48"><a href="getting-started.html#cb1-48" tabindex="-1"></a><span class="fu">library</span>(OutcomeWeights)</span></code></pre></div>
</div>
<div id="wrapper-functions" class="section level2 hasAnchor" number="1.2">
<h2><span class="header-section-number">1.2</span> Wrapper functions<a href="getting-started.html#wrapper-functions" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Next, the wrapper functions designed to manage the data, address overlap and covariate balance, estimate treatment effects and analyze outcome weights are presented.</p>
<div class="callout-note">
<p>To use the wrapper functions, the simplest method is to source the R script with the following code.</p>
</div>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="getting-started.html#cb2-1" tabindex="-1"></a><span class="fu">source</span>(<span class="st">&quot;tutorial/functions.R&quot;</span>)</span></code></pre></div>
<p>If RStudio is used, the functions should now appear in the environment section.</p>
<div id="overview" class="section level3 hasAnchor" number="1.2.1">
<h3><span class="header-section-number">1.2.1</span> Overview<a href="getting-started.html#overview" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<table>
<colgroup>
<col width="25%" />
<col width="50%" />
<col width="25%" />
</colgroup>
<thead>
<tr class="header">
<th>Function</th>
<th>Description</th>
<th align="center">Code</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>inspect_data()</code> , <code>save_overlap_panels</code></td>
<td>Inspects samples and save overlap visualizations.</td>
<td align="center"><a href="#setup">More</a></td>
</tr>
<tr class="even">
<td><code>ps_trim()</code>, <code>common_range_trim()</code>, <code>crump_trim()</code>, <code>stuermer_trim ()</code>, <code>walker_trim()</code>, <code>ps_estimate()</code>, <code>attach_matchit()</code></td>
<td>Implements methods to improve overlap, address covariate imbalance and reestimate propensity scores.</td>
<td align="center"><a href="#impl-cov-bal-overl-mthds">More</a></td>
</tr>
<tr class="odd">
<td><code>compute_abs_smd_trim()</code>, <code>compute_ovl_trim()</code>, <code>compute_abs_smd_matchit()</code>, <code>compute_ovl_matchit()</code>, <code>combine_results()</code>, <code>save_csv()</code>, <code>assess_methods()</code>, <code>get_top_methods()</code>, <code>wrap_match_entries()</code>, <code>create_top5_samples()</code>, <code>save_top5_samples()</code></td>
<td>Evaluates performance of previous methods through comparative metrics (ASMD, OVL).</td>
<td align="center"></td>
</tr>
<tr class="even">
<td><a href="#eval-mthds">More</a></td>
<td></td>
<td align="center"></td>
</tr>
<tr class="odd">
<td><code>estimate_all()</code>, <code>plot_coef()</code>, <code>save_att_panels()</code>, <code>create_matrix_results()</code>, <code>eval_att()</code>, <code>plot_catt_panels()</code>, <code>save_catt_panels()</code>, <code>save_main_catt_panels()</code>, <code>save_plus_catt_panels()</code>, <code>eval_catt()</code>, <code>est_qte_safe()</code>, <code>plot_qte_top()</code>, <code>save_qtet()</code>, <code>save_qte_top()</code></td>
<td>Computes and visualizes treatment effect estimands (ATT, CATT, QTET) using a number of estimators.</td>
<td align="center"><a href="#est-and-plot-att-catt-qtet">More</a></td>
</tr>
<tr class="even">
<td><code>get_res_att()</code>, <code>derive_ow()</code>, <code>plot_ow()</code>, <code>eval_ow()</code>, <code>save_ow()</code></td>
<td>Analyses outcome weights of samples.</td>
<td align="center"><a href="#ow-ana">More</a></td>
</tr>
<tr class="odd">
<td><code>check_filter_samples()</code>, <code>save_sensitivity_plots()</code></td>
<td>Validates and filters samples.</td>
<td align="center"><a href="#sens-ana">More</a></td>
</tr>
<tr class="even">
<td><code>save_balance()</code></td>
<td>Saves results of balance check in covariates.</td>
<td align="center"><a href="#bal-ana">More</a></td>
</tr>
</tbody>
</table>
<p><a name="setup"></a></p>
</div>
<div id="inspection" class="section level3 hasAnchor" number="1.2.2">
<h3><span class="header-section-number">1.2.2</span> Inspection<a href="getting-started.html#inspection" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p><code>inspect_data()</code> provides a structured summary of one or multiple samples by returning a single data frame listing each dataset’s name, number of observations (rows), number of treated units, number of control units, number of variables (columns) and a concatenated string of variable names.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="getting-started.html#cb3-1" tabindex="-1"></a>inspect_data <span class="ot">&lt;-</span> <span class="cf">function</span>(data, <span class="at">treat =</span> <span class="st">&quot;treat&quot;</span>) {</span>
<span id="cb3-2"><a href="getting-started.html#cb3-2" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">is.data.frame</span>(data)) {</span>
<span id="cb3-3"><a href="getting-started.html#cb3-3" tabindex="-1"></a>    data <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="at">sample =</span> data)</span>
<span id="cb3-4"><a href="getting-started.html#cb3-4" tabindex="-1"></a>  }</span>
<span id="cb3-5"><a href="getting-started.html#cb3-5" tabindex="-1"></a>  <span class="fu">data.frame</span>(</span>
<span id="cb3-6"><a href="getting-started.html#cb3-6" tabindex="-1"></a>    <span class="at">sample =</span> <span class="fu">names</span>(data),</span>
<span id="cb3-7"><a href="getting-started.html#cb3-7" tabindex="-1"></a>    <span class="at">num_obs =</span> <span class="fu">sapply</span>(data, nrow),</span>
<span id="cb3-8"><a href="getting-started.html#cb3-8" tabindex="-1"></a>    <span class="at">num_treated =</span> <span class="fu">sapply</span>(data, <span class="cf">function</span>(df) <span class="fu">sum</span>(df[[treat]] <span class="sc">==</span> <span class="dv">1</span>, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)),</span>
<span id="cb3-9"><a href="getting-started.html#cb3-9" tabindex="-1"></a>    <span class="at">num_controls =</span> <span class="fu">sapply</span>(data, <span class="cf">function</span>(df) <span class="fu">sum</span>(df[[treat]] <span class="sc">==</span> <span class="dv">0</span>, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)),</span>
<span id="cb3-10"><a href="getting-started.html#cb3-10" tabindex="-1"></a>    <span class="at">num_vars =</span> <span class="fu">sapply</span>(data, ncol),</span>
<span id="cb3-11"><a href="getting-started.html#cb3-11" tabindex="-1"></a>    <span class="at">name_vars =</span> <span class="fu">sapply</span>(data, <span class="cf">function</span>(df) <span class="fu">paste</span>(<span class="fu">names</span>(df), <span class="at">collapse =</span> <span class="st">&quot;, &quot;</span>)),</span>
<span id="cb3-12"><a href="getting-started.html#cb3-12" tabindex="-1"></a>    <span class="at">row.names =</span> <span class="cn">NULL</span></span>
<span id="cb3-13"><a href="getting-started.html#cb3-13" tabindex="-1"></a>  )</span>
<span id="cb3-14"><a href="getting-started.html#cb3-14" tabindex="-1"></a>}</span></code></pre></div>
<p><strong>Argument</strong></p>
<ul>
<li><code>data</code>: A data frame or a list of data frames containing structured data.</li>
<li><code>treat</code>: A character string indicating the name of the (binary) treatment indicator (default is “treat”).</li>
</ul>
<p><code>save_overlap_panels()</code>*** saves the histograms that visualize overlap between the treatment groups.</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="getting-started.html#cb4-1" tabindex="-1"></a>save_overlap_panels <span class="ot">&lt;-</span> <span class="cf">function</span>(</span>
<span id="cb4-2"><a href="getting-started.html#cb4-2" tabindex="-1"></a>    data_list,</span>
<span id="cb4-3"><a href="getting-started.html#cb4-3" tabindex="-1"></a>    treat,</span>
<span id="cb4-4"><a href="getting-started.html#cb4-4" tabindex="-1"></a>    covar,</span>
<span id="cb4-5"><a href="getting-started.html#cb4-5" tabindex="-1"></a>    <span class="at">plot_titles =</span> <span class="cn">NULL</span>,</span>
<span id="cb4-6"><a href="getting-started.html#cb4-6" tabindex="-1"></a>    <span class="at">prefix =</span> <span class="st">&quot;overlap_panels&quot;</span>,</span>
<span id="cb4-7"><a href="getting-started.html#cb4-7" tabindex="-1"></a>    <span class="at">folder =</span> <span class="st">&quot;graphs/lalonde&quot;</span>,</span>
<span id="cb4-8"><a href="getting-started.html#cb4-8" tabindex="-1"></a>    <span class="at">plots_per_page =</span> <span class="dv">1</span></span>
<span id="cb4-9"><a href="getting-started.html#cb4-9" tabindex="-1"></a>) {</span>
<span id="cb4-10"><a href="getting-started.html#cb4-10" tabindex="-1"></a>  <span class="cf">if</span> (<span class="sc">!</span><span class="fu">dir.exists</span>(folder)) <span class="fu">dir.create</span>(folder, <span class="at">recursive =</span> <span class="cn">TRUE</span>)</span>
<span id="cb4-11"><a href="getting-started.html#cb4-11" tabindex="-1"></a>  n <span class="ot">&lt;-</span> <span class="fu">length</span>(data_list)</span>
<span id="cb4-12"><a href="getting-started.html#cb4-12" tabindex="-1"></a>  pages <span class="ot">&lt;-</span> <span class="fu">ceiling</span>(n <span class="sc">/</span> plots_per_page)</span>
<span id="cb4-13"><a href="getting-started.html#cb4-13" tabindex="-1"></a>  <span class="cf">for</span> (p <span class="cf">in</span> <span class="fu">seq_len</span>(pages)) {</span>
<span id="cb4-14"><a href="getting-started.html#cb4-14" tabindex="-1"></a>    start <span class="ot">&lt;-</span> (p <span class="sc">-</span> <span class="dv">1</span>) <span class="sc">*</span> plots_per_page <span class="sc">+</span> <span class="dv">1</span></span>
<span id="cb4-15"><a href="getting-started.html#cb4-15" tabindex="-1"></a>    end   <span class="ot">&lt;-</span> <span class="fu">min</span>(p <span class="sc">*</span> plots_per_page, n)</span>
<span id="cb4-16"><a href="getting-started.html#cb4-16" tabindex="-1"></a>    file_name <span class="ot">&lt;-</span> <span class="fu">file.path</span>(folder, <span class="fu">paste0</span>(prefix, <span class="st">&quot;_&quot;</span>, p, <span class="st">&quot;.pdf&quot;</span>))</span>
<span id="cb4-17"><a href="getting-started.html#cb4-17" tabindex="-1"></a>    <span class="fu">pdf</span>(file_name, <span class="at">width =</span> <span class="dv">8</span>, <span class="at">height =</span> <span class="fl">2.75</span> <span class="sc">*</span> (end <span class="sc">-</span> start <span class="sc">+</span> <span class="dv">1</span>))</span>
<span id="cb4-18"><a href="getting-started.html#cb4-18" tabindex="-1"></a>    <span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(end <span class="sc">-</span> start <span class="sc">+</span> <span class="dv">1</span>, <span class="dv">1</span>), <span class="at">mar =</span> <span class="fu">c</span>(<span class="dv">4</span>, <span class="dv">5</span>, <span class="dv">3</span>, <span class="dv">2</span>))</span>
<span id="cb4-19"><a href="getting-started.html#cb4-19" tabindex="-1"></a>    <span class="cf">for</span> (i <span class="cf">in</span> start<span class="sc">:</span>end) {</span>
<span id="cb4-20"><a href="getting-started.html#cb4-20" tabindex="-1"></a>      <span class="fu">assess_overlap</span>(<span class="at">data =</span> data_list[[i]], <span class="at">treat =</span> treat, <span class="at">cov =</span> covar)</span>
<span id="cb4-21"><a href="getting-started.html#cb4-21" tabindex="-1"></a>      <span class="cf">if</span> (<span class="sc">!</span><span class="fu">is.null</span>(plot_titles) <span class="sc">&amp;&amp;</span> <span class="fu">length</span>(plot_titles) <span class="sc">&gt;=</span> i) {</span>
<span id="cb4-22"><a href="getting-started.html#cb4-22" tabindex="-1"></a>        <span class="fu">title</span>(<span class="at">main =</span> plot_titles[i])</span>
<span id="cb4-23"><a href="getting-started.html#cb4-23" tabindex="-1"></a>      } <span class="cf">else</span> {</span>
<span id="cb4-24"><a href="getting-started.html#cb4-24" tabindex="-1"></a>        <span class="fu">title</span>(<span class="at">main =</span> <span class="fu">paste</span>(<span class="st">&quot;Panel&quot;</span>, i))</span>
<span id="cb4-25"><a href="getting-started.html#cb4-25" tabindex="-1"></a>      }</span>
<span id="cb4-26"><a href="getting-started.html#cb4-26" tabindex="-1"></a>    }</span>
<span id="cb4-27"><a href="getting-started.html#cb4-27" tabindex="-1"></a>    <span class="fu">dev.off</span>()</span>
<span id="cb4-28"><a href="getting-started.html#cb4-28" tabindex="-1"></a>  }</span>
<span id="cb4-29"><a href="getting-started.html#cb4-29" tabindex="-1"></a>}</span></code></pre></div>
<p><strong>Argument</strong></p>
<ul>
<li><code>data_list</code>: A data frame or a list of data frames containing structured data.</li>
<li><code>treat</code>: A character string indicating the name of the (binary) treatment indicator (default is “treat”).</li>
<li><code>covar</code>: A vector of covariate names.</li>
<li><code>plot_titles</code>: A character vector of titles for each plot.</li>
<li><code>prefix</code>: A string prefix used for saved file names to identify sample.</li>
<li><code>folder</code>: A string specifying the folder path where the PDF panels will be saved (default is “graphs/lalonde”).</li>
<li><code>plots_per_page</code>: The number of plots to display per page / panel (default 1).</li>
</ul>
<p><br></p>
<p><a name="impl-cov-bal-overl-mthds"></a></p>
</div>
<div id="improving-covariate-balance-and-overlap" class="section level3 hasAnchor" number="1.2.3">
<h3><span class="header-section-number">1.2.3</span> Improving covariate balance and overlap<a href="getting-started.html#improving-covariate-balance-and-overlap" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div id="trimming" class="section level4 hasAnchor" number="1.2.3.1">
<h4><span class="header-section-number">1.2.3.1</span> Trimming<a href="getting-started.html#trimming" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p><code>ps_trim()</code> trims the sample based on a specified propensity score threshold, removing observations whose propensity scores exceed the given cutoff value.***</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="getting-started.html#cb5-1" tabindex="-1"></a>ps_trim <span class="ot">&lt;-</span> <span class="cf">function</span>(data, <span class="at">ps =</span> <span class="st">&quot;ps_assoverlap&quot;</span>, <span class="at">threshold =</span> <span class="fl">0.9</span>) { </span>
<span id="cb5-2"><a href="getting-started.html#cb5-2" tabindex="-1"></a>  sub <span class="ot">&lt;-</span> data[<span class="fu">which</span>(data[, ps] <span class="sc">&lt;</span> threshold), ]</span>
<span id="cb5-3"><a href="getting-started.html#cb5-3" tabindex="-1"></a>  <span class="fu">return</span>(sub)</span>
<span id="cb5-4"><a href="getting-started.html#cb5-4" tabindex="-1"></a>}</span></code></pre></div>
<p><strong>Arguments</strong></p>
<ul>
<li><code>data</code>: The data frame containing structured data.</li>
<li><code>ps</code>: The name of the propensity score variable as string.</li>
<li><code>threshold</code>: The upper limit for propensity score inclusion as numeric value (default is 0.9).</li>
</ul>
<p><code>common_range_trim()</code> trims the sample to observations with propensity scores within the common support range for treated and control groups. It takes as lower cutpoint the lowest observed propensity score in the treated group, and as upper cutpoint the highest observed propensity score in the control group.</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="getting-started.html#cb6-1" tabindex="-1"></a>common_range_trim <span class="ot">&lt;-</span> <span class="cf">function</span>(data, <span class="at">ps =</span> <span class="st">&quot;ps_assoverlap&quot;</span>, <span class="at">treat =</span> <span class="st">&quot;treat&quot;</span>) {</span>
<span id="cb6-2"><a href="getting-started.html#cb6-2" tabindex="-1"></a>  lower_cut <span class="ot">&lt;-</span> <span class="fu">min</span>(data[[ps]][data[[treat]] <span class="sc">==</span> <span class="dv">1</span>], <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb6-3"><a href="getting-started.html#cb6-3" tabindex="-1"></a>  upper_cut <span class="ot">&lt;-</span> <span class="fu">max</span>(data[[ps]][data[[treat]] <span class="sc">==</span> <span class="dv">0</span>], <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb6-4"><a href="getting-started.html#cb6-4" tabindex="-1"></a>  sub <span class="ot">&lt;-</span> data[data[[ps]] <span class="sc">&gt;=</span> lower_cut <span class="sc">&amp;</span> data[[ps]] <span class="sc">&lt;=</span> upper_cut, ]</span>
<span id="cb6-5"><a href="getting-started.html#cb6-5" tabindex="-1"></a>  <span class="fu">return</span>(sub)</span>
<span id="cb6-6"><a href="getting-started.html#cb6-6" tabindex="-1"></a>}</span></code></pre></div>
<p><strong>Arguments</strong></p>
<ul>
<li><code>data</code>: The data frame containing structured data.</li>
<li><code>ps</code>: The column name of propensity scores as string (default is “ps_assoverlap”).</li>
<li><code>treat</code>: The column name of the (binary) treatment indicator as string (default is “treat”).</li>
</ul>
<p><code>crump_trim()</code> trims the sample to observations with propensity scores outside specified lower and upper bounds (default 0.1 and 0.9). Only those observations are kept that are within the specified interval (default 0.1 &lt;= PS &lt;= 0.9).</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="getting-started.html#cb7-1" tabindex="-1"></a>crump_trim <span class="ot">&lt;-</span> <span class="cf">function</span>(data, <span class="at">ps =</span> <span class="st">&quot;ps_assoverlap&quot;</span>, <span class="at">lower =</span> <span class="fl">0.1</span>, <span class="at">upper =</span> <span class="fl">0.9</span>) {</span>
<span id="cb7-2"><a href="getting-started.html#cb7-2" tabindex="-1"></a>  sub <span class="ot">&lt;-</span> data[data[[ps]] <span class="sc">&gt;=</span> lower <span class="sc">&amp;</span> data[[ps]] <span class="sc">&lt;=</span> upper, ]</span>
<span id="cb7-3"><a href="getting-started.html#cb7-3" tabindex="-1"></a>  <span class="fu">return</span>(sub)</span>
<span id="cb7-4"><a href="getting-started.html#cb7-4" tabindex="-1"></a>}</span></code></pre></div>
<p><strong>Arguments</strong></p>
<ul>
<li><code>data</code>: The data frame containing structured data.</li>
<li><code>ps</code>: The column name of propensity scores as string (default is “ps_assoverlap”).</li>
<li><code>lower</code>: The lower bound for inclusion as numeric value (default is 0.1).</li>
<li><code>upper</code>: The upper bound for inclusion as numeric value (default is 0.9).</li>
</ul>
<p><code>stuermer_trim ()</code> trims the sample to observations based on propensity score quantiles separately for treated and control group.</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="getting-started.html#cb8-1" tabindex="-1"></a>stuermer_trim <span class="ot">&lt;-</span> <span class="cf">function</span>(data, <span class="at">treat =</span> <span class="st">&quot;treat&quot;</span>, <span class="at">ps =</span> <span class="st">&quot;ps_assoverlap&quot;</span>, </span>
<span id="cb8-2"><a href="getting-started.html#cb8-2" tabindex="-1"></a>                          <span class="at">lower_percentile =</span> <span class="fl">0.01</span>, <span class="at">upper_percentile =</span> <span class="fl">0.99</span>) {</span>
<span id="cb8-3"><a href="getting-started.html#cb8-3" tabindex="-1"></a>  treated_ps   <span class="ot">&lt;-</span> data[[ps]][data[[treat]] <span class="sc">==</span> <span class="dv">1</span>]</span>
<span id="cb8-4"><a href="getting-started.html#cb8-4" tabindex="-1"></a>  untreated_ps <span class="ot">&lt;-</span> data[[ps]][data[[treat]] <span class="sc">==</span> <span class="dv">0</span>]</span>
<span id="cb8-5"><a href="getting-started.html#cb8-5" tabindex="-1"></a>  lower_cutoff <span class="ot">&lt;-</span> <span class="fu">quantile</span>(treated_ps, <span class="at">probs =</span> lower_percentile, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb8-6"><a href="getting-started.html#cb8-6" tabindex="-1"></a>  upper_cutoff <span class="ot">&lt;-</span> <span class="fu">quantile</span>(untreated_ps, <span class="at">probs =</span> upper_percentile, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb8-7"><a href="getting-started.html#cb8-7" tabindex="-1"></a>  sub <span class="ot">&lt;-</span> data[data[[ps]] <span class="sc">&gt;=</span> lower_cutoff <span class="sc">&amp;</span> data[[ps]] <span class="sc">&lt;=</span> upper_cutoff, ]</span>
<span id="cb8-8"><a href="getting-started.html#cb8-8" tabindex="-1"></a>  <span class="fu">return</span>(sub)</span>
<span id="cb8-9"><a href="getting-started.html#cb8-9" tabindex="-1"></a>}</span></code></pre></div>
<p><strong>Arguments</strong></p>
<ul>
<li><code>data</code>: The data frame containing structured data.</li>
<li><code>treat</code>: The column name of the (binary) treatment indicator as string (default is “treat”).</li>
<li><code>ps</code>: The column name of propensity scores as string (default is “ps_assoverlap”).</li>
<li><code>lower_percentile</code>: Numeric value between 0 and 1 specifying the lower quantile cutoff for propensity scores in the treated group (default is 0.01, i.e., 1st percentile).</li>
<li><code>upper_percentile</code>: Numeric value between 0 and 1 specifying the upper quantile cutoff for propensity scores in the untreated group (default is 0.99, i.e., 99th percentile).</li>
</ul>
<p><code>walker_trim()</code> trims the sample to observations based on preference scores that adjust for treatment prevalence using logit transformations.</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="getting-started.html#cb9-1" tabindex="-1"></a>walker_trim <span class="ot">&lt;-</span> <span class="cf">function</span>(data, <span class="at">treat =</span> <span class="st">&quot;treat&quot;</span>, <span class="at">ps =</span> <span class="st">&quot;ps_assoverlap&quot;</span>, </span>
<span id="cb9-2"><a href="getting-started.html#cb9-2" tabindex="-1"></a>                        <span class="at">lower_cutoff =</span> <span class="fl">0.1</span>, <span class="at">upper_cutoff =</span> <span class="fl">0.9</span>) {</span>
<span id="cb9-3"><a href="getting-started.html#cb9-3" tabindex="-1"></a>  treat_prevalence  <span class="ot">&lt;-</span> <span class="fu">mean</span>(data[[treat]], <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb9-4"><a href="getting-started.html#cb9-4" tabindex="-1"></a>  logit_ps          <span class="ot">&lt;-</span> <span class="fu">log</span>(data[[ps]] <span class="sc">/</span> (<span class="dv">1</span> <span class="sc">-</span> data[[ps]]))</span>
<span id="cb9-5"><a href="getting-started.html#cb9-5" tabindex="-1"></a>  logit_prevalence  <span class="ot">&lt;-</span> <span class="fu">log</span>(treat_prevalence <span class="sc">/</span> (<span class="dv">1</span> <span class="sc">-</span> treat_prevalence))</span>
<span id="cb9-6"><a href="getting-started.html#cb9-6" tabindex="-1"></a>  preference_score  <span class="ot">&lt;-</span> <span class="dv">1</span> <span class="sc">/</span> (<span class="dv">1</span> <span class="sc">+</span> <span class="fu">exp</span>(<span class="sc">-</span>(logit_ps <span class="sc">-</span> logit_prevalence)))</span>
<span id="cb9-7"><a href="getting-started.html#cb9-7" tabindex="-1"></a>  sub <span class="ot">&lt;-</span> data[preference_score <span class="sc">&gt;=</span> lower_cutoff <span class="sc">&amp;</span> preference_score <span class="sc">&lt;=</span> upper_cutoff, ]</span>
<span id="cb9-8"><a href="getting-started.html#cb9-8" tabindex="-1"></a>  <span class="fu">return</span>(sub)</span>
<span id="cb9-9"><a href="getting-started.html#cb9-9" tabindex="-1"></a>}</span></code></pre></div>
<p><strong>Arguments</strong></p>
<ul>
<li><code>data</code>: The data frame containing structured data.</li>
<li><code>treat</code>: The column name of the (binary) treatment indicator as string (default is “treat”).</li>
<li><code>ps</code>: The column name of propensity scores as string (default is “ps_assoverlap”).</li>
<li><code>lower_cutoff</code>: Numeric value between 0 and 1 specifying the lower cutoff for the preference score (default is 0.1).</li>
<li><code>upper_cutoff</code>: Numeric value between 0 and 1 specifying the upper cutoff for the preference score (default is 0.9).</li>
</ul>
<p><code>ps_estimate()</code> reestimates the propensity scores by fitting a probability forest model to predict the treatment assignment based on the specified covariates.</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="getting-started.html#cb10-1" tabindex="-1"></a>ps_estimate <span class="ot">&lt;-</span> <span class="cf">function</span>(data, treat, cov, <span class="at">num.trees =</span> <span class="cn">NULL</span>, <span class="at">seed =</span> <span class="dv">42</span>) {</span>
<span id="cb10-2"><a href="getting-started.html#cb10-2" tabindex="-1"></a>  <span class="cf">if</span>(<span class="fu">is.null</span>(num.trees)){</span>
<span id="cb10-3"><a href="getting-started.html#cb10-3" tabindex="-1"></a>    p.forest1 <span class="ot">&lt;-</span> <span class="fu">probability_forest</span>(</span>
<span id="cb10-4"><a href="getting-started.html#cb10-4" tabindex="-1"></a>      <span class="at">X =</span> data[, cov],</span>
<span id="cb10-5"><a href="getting-started.html#cb10-5" tabindex="-1"></a>      <span class="at">Y =</span> <span class="fu">as.factor</span>(data[,treat]), <span class="at">seed =</span> seed)</span>
<span id="cb10-6"><a href="getting-started.html#cb10-6" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb10-7"><a href="getting-started.html#cb10-7" tabindex="-1"></a>    p.forest1 <span class="ot">&lt;-</span> <span class="fu">probability_forest</span>(</span>
<span id="cb10-8"><a href="getting-started.html#cb10-8" tabindex="-1"></a>      <span class="at">X =</span> data[, cov],</span>
<span id="cb10-9"><a href="getting-started.html#cb10-9" tabindex="-1"></a>      <span class="at">Y =</span> <span class="fu">as.factor</span>(data[,treat]), <span class="at">seed =</span> seed, <span class="at">num.trees =</span> num.trees)</span>
<span id="cb10-10"><a href="getting-started.html#cb10-10" tabindex="-1"></a>  }</span>
<span id="cb10-11"><a href="getting-started.html#cb10-11" tabindex="-1"></a>  data<span class="sc">$</span>ps_assoverlap <span class="ot">&lt;-</span> p.forest1<span class="sc">$</span>predictions[,<span class="dv">2</span>]</span>
<span id="cb10-12"><a href="getting-started.html#cb10-12" tabindex="-1"></a>  data<span class="sc">$</span>ps_assoverlap[<span class="fu">which</span>(<span class="fu">abs</span>(data<span class="sc">$</span>ps_assoverlap) <span class="sc">&lt;=</span> <span class="fl">1e-7</span>)] <span class="ot">&lt;-</span> <span class="fl">1e-7</span></span>
<span id="cb10-13"><a href="getting-started.html#cb10-13" tabindex="-1"></a>  <span class="fu">return</span>(data)</span>
<span id="cb10-14"><a href="getting-started.html#cb10-14" tabindex="-1"></a>}</span></code></pre></div>
<p><strong>Arguments</strong></p>
<ul>
<li><code>data</code>: The data frame containing structured data.</li>
<li><code>treat</code>: The column name of the (binary) treatment indicator as string.</li>
<li><code>cov</code>: A vector of covariate names.</li>
<li><code>num.trees</code>: Integer specifying the number of trees to grow in the random forest model for propensity score estimation.</li>
<li><code>seed</code>: Integer to ensure reproducibility (default is 42).</li>
</ul>
</div>
<div id="integrated-methods" class="section level4 hasAnchor" number="1.2.3.2">
<h4><span class="header-section-number">1.2.3.2</span> Integrated methods<a href="getting-started.html#integrated-methods" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p><code>attach_matchit()</code></p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb11-1"><a href="getting-started.html#cb11-1" tabindex="-1"></a>attach_matchit <span class="ot">&lt;-</span> <span class="cf">function</span>(model, data_list, ..., <span class="at">verbose =</span> <span class="cn">FALSE</span>) {</span>
<span id="cb11-2"><a href="getting-started.html#cb11-2" tabindex="-1"></a>  <span class="cf">if</span> (<span class="sc">!</span><span class="fu">is.list</span>(data_list) <span class="sc">||</span> <span class="fu">length</span>(data_list) <span class="sc">==</span> <span class="dv">0</span>) {</span>
<span id="cb11-3"><a href="getting-started.html#cb11-3" tabindex="-1"></a>    <span class="fu">stop</span>(<span class="st">&quot;attach_matchit(): &#39;data_list&#39; must be a non-empty list&quot;</span>, <span class="at">call. =</span> <span class="cn">FALSE</span>)</span>
<span id="cb11-4"><a href="getting-started.html#cb11-4" tabindex="-1"></a>  }</span>
<span id="cb11-5"><a href="getting-started.html#cb11-5" tabindex="-1"></a>  matchit_results <span class="ot">&lt;-</span> <span class="fu">vector</span>(<span class="st">&quot;list&quot;</span>, <span class="fu">length</span>(data_list))</span>
<span id="cb11-6"><a href="getting-started.html#cb11-6" tabindex="-1"></a>  <span class="fu">names</span>(matchit_results) <span class="ot">&lt;-</span> <span class="fu">names</span>(data_list)</span>
<span id="cb11-7"><a href="getting-started.html#cb11-7" tabindex="-1"></a>  dims_report <span class="ot">&lt;-</span> <span class="fu">character</span>(<span class="fu">length</span>(data_list))</span>
<span id="cb11-8"><a href="getting-started.html#cb11-8" tabindex="-1"></a>  <span class="cf">for</span> (i <span class="cf">in</span> <span class="fu">seq_along</span>(data_list)) {</span>
<span id="cb11-9"><a href="getting-started.html#cb11-9" tabindex="-1"></a>    data_i <span class="ot">&lt;-</span> data_list[[i]]</span>
<span id="cb11-10"><a href="getting-started.html#cb11-10" tabindex="-1"></a>    label_i <span class="ot">&lt;-</span> <span class="cf">if</span> (<span class="fu">length</span>(<span class="fu">names</span>(matchit_results))) <span class="fu">names</span>(matchit_results)[i] <span class="cf">else</span> i</span>
<span id="cb11-11"><a href="getting-started.html#cb11-11" tabindex="-1"></a>    res <span class="ot">&lt;-</span> <span class="fu">tryCatch</span>(</span>
<span id="cb11-12"><a href="getting-started.html#cb11-12" tabindex="-1"></a>      {</span>
<span id="cb11-13"><a href="getting-started.html#cb11-13" tabindex="-1"></a>        obj <span class="ot">&lt;-</span> <span class="fu">matchit</span>(model, <span class="at">data =</span> data_i, ...)</span>
<span id="cb11-14"><a href="getting-started.html#cb11-14" tabindex="-1"></a>        <span class="fu">attr</span>(obj, <span class="st">&quot;match_source&quot;</span>) <span class="ot">&lt;-</span> data_i</span>
<span id="cb11-15"><a href="getting-started.html#cb11-15" tabindex="-1"></a>        obj</span>
<span id="cb11-16"><a href="getting-started.html#cb11-16" tabindex="-1"></a>      },</span>
<span id="cb11-17"><a href="getting-started.html#cb11-17" tabindex="-1"></a>      <span class="at">error =</span> <span class="cf">function</span>(e) {</span>
<span id="cb11-18"><a href="getting-started.html#cb11-18" tabindex="-1"></a>        <span class="fu">warning</span>(<span class="fu">sprintf</span>(<span class="st">&quot;attach_matchit(): &#39;%s&#39; failed: %s&quot;</span>, label_i, e<span class="sc">$</span>message), <span class="at">call. =</span> <span class="cn">FALSE</span>)</span>
<span id="cb11-19"><a href="getting-started.html#cb11-19" tabindex="-1"></a>        <span class="cn">NULL</span></span>
<span id="cb11-20"><a href="getting-started.html#cb11-20" tabindex="-1"></a>      }</span>
<span id="cb11-21"><a href="getting-started.html#cb11-21" tabindex="-1"></a>    )</span>
<span id="cb11-22"><a href="getting-started.html#cb11-22" tabindex="-1"></a>    matchit_results[[i]] <span class="ot">&lt;-</span> res</span>
<span id="cb11-23"><a href="getting-started.html#cb11-23" tabindex="-1"></a>    source_rows <span class="ot">&lt;-</span> <span class="fu">tryCatch</span>(<span class="fu">nrow</span>(data_i), <span class="at">error =</span> <span class="cf">function</span>(e) <span class="cn">NA_integer_</span>)</span>
<span id="cb11-24"><a href="getting-started.html#cb11-24" tabindex="-1"></a>    matched_rows <span class="ot">&lt;-</span> <span class="cf">if</span> (<span class="fu">inherits</span>(res, <span class="st">&quot;matchit&quot;</span>)) {</span>
<span id="cb11-25"><a href="getting-started.html#cb11-25" tabindex="-1"></a>      <span class="fu">tryCatch</span>(<span class="fu">nrow</span>(<span class="fu">match.data</span>(res, <span class="at">data =</span> data_i)), <span class="at">error =</span> <span class="cf">function</span>(e) <span class="cn">NA_integer_</span>)</span>
<span id="cb11-26"><a href="getting-started.html#cb11-26" tabindex="-1"></a>    } <span class="cf">else</span> {</span>
<span id="cb11-27"><a href="getting-started.html#cb11-27" tabindex="-1"></a>      <span class="cn">NA_integer_</span></span>
<span id="cb11-28"><a href="getting-started.html#cb11-28" tabindex="-1"></a>    }</span>
<span id="cb11-29"><a href="getting-started.html#cb11-29" tabindex="-1"></a>    dims_report[[i]] <span class="ot">&lt;-</span> <span class="fu">sprintf</span>(<span class="st">&quot;%s: source=%s matched=%s&quot;</span>, label_i, source_rows, matched_rows)</span>
<span id="cb11-30"><a href="getting-started.html#cb11-30" tabindex="-1"></a>  }</span>
<span id="cb11-31"><a href="getting-started.html#cb11-31" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">isTRUE</span>(verbose)) {</span>
<span id="cb11-32"><a href="getting-started.html#cb11-32" tabindex="-1"></a>    <span class="fu">message</span>(<span class="st">&quot;attach_matchit(): &quot;</span>, <span class="fu">paste</span>(dims_report, <span class="at">collapse =</span> <span class="st">&quot;; &quot;</span>))</span>
<span id="cb11-33"><a href="getting-started.html#cb11-33" tabindex="-1"></a>  }</span>
<span id="cb11-34"><a href="getting-started.html#cb11-34" tabindex="-1"></a>  <span class="fu">attr</span>(matchit_results, <span class="st">&quot;match_dims&quot;</span>) <span class="ot">&lt;-</span> dims_report</span>
<span id="cb11-35"><a href="getting-started.html#cb11-35" tabindex="-1"></a>  <span class="co"># report summary</span></span>
<span id="cb11-36"><a href="getting-started.html#cb11-36" tabindex="-1"></a>  null_count <span class="ot">&lt;-</span> <span class="fu">sum</span>(<span class="fu">sapply</span>(matchit_results, is.null))</span>
<span id="cb11-37"><a href="getting-started.html#cb11-37" tabindex="-1"></a>  success_count <span class="ot">&lt;-</span> <span class="fu">length</span>(matchit_results) <span class="sc">-</span> null_count</span>
<span id="cb11-38"><a href="getting-started.html#cb11-38" tabindex="-1"></a>  <span class="cf">if</span> (null_count <span class="sc">&gt;</span> <span class="dv">0</span>) {</span>
<span id="cb11-39"><a href="getting-started.html#cb11-39" tabindex="-1"></a>    failed_names <span class="ot">&lt;-</span> <span class="fu">names</span>(matchit_results)[<span class="fu">sapply</span>(matchit_results, is.null)]</span>
<span id="cb11-40"><a href="getting-started.html#cb11-40" tabindex="-1"></a>    <span class="fu">cat</span>(<span class="fu">sprintf</span>(<span class="st">&quot;MATCHING SUMMARY: %d succeeded, %d failed. Failed: %s</span><span class="sc">\n</span><span class="st">&quot;</span>, </span>
<span id="cb11-41"><a href="getting-started.html#cb11-41" tabindex="-1"></a>                success_count, null_count, <span class="fu">paste</span>(failed_names, <span class="at">collapse =</span> <span class="st">&quot;, &quot;</span>)))</span>
<span id="cb11-42"><a href="getting-started.html#cb11-42" tabindex="-1"></a>  }</span>
<span id="cb11-43"><a href="getting-started.html#cb11-43" tabindex="-1"></a>  <span class="fu">return</span>(matchit_results)</span>
<span id="cb11-44"><a href="getting-started.html#cb11-44" tabindex="-1"></a>}</span></code></pre></div>
<p><strong>Arguments</strong></p>
<ul>
<li><code>model</code>: A model formula specifying the treatment and covariates to be used for calculating weights.</li>
<li><code>data_list</code>: A list of data frames containing the subsetted sample after trimming procedures.</li>
</ul>
<p><br></p>
<p><a name="eval-mthds"></a></p>
</div>
</div>
<div id="assessing-methods" class="section level3 hasAnchor" number="1.2.4">
<h3><span class="header-section-number">1.2.4</span> Assessing methods<a href="getting-started.html#assessing-methods" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div id="trimming-1" class="section level4 hasAnchor" number="1.2.4.1">
<h4><span class="header-section-number">1.2.4.1</span> Trimming<a href="getting-started.html#trimming-1" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p><code>compute_abs_smd_trim()</code> computes absolute SMDs for multiple samples.</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb12-1"><a href="getting-started.html#cb12-1" tabindex="-1"></a>compute_abs_smd_trim <span class="ot">&lt;-</span> <span class="cf">function</span>(data_list, <span class="at">treat =</span> <span class="st">&quot;treat&quot;</span>, covar) {</span>
<span id="cb12-2"><a href="getting-started.html#cb12-2" tabindex="-1"></a>  smd_list <span class="ot">&lt;-</span> <span class="fu">lapply</span>(<span class="fu">names</span>(data_list), <span class="cf">function</span>(name) {</span>
<span id="cb12-3"><a href="getting-started.html#cb12-3" tabindex="-1"></a>    data <span class="ot">&lt;-</span> data_list[[name]]</span>
<span id="cb12-4"><a href="getting-started.html#cb12-4" tabindex="-1"></a>    bal_obj <span class="ot">&lt;-</span> cobalt<span class="sc">::</span><span class="fu">bal.tab</span>(</span>
<span id="cb12-5"><a href="getting-started.html#cb12-5" tabindex="-1"></a>      <span class="fu">as.formula</span>(<span class="fu">paste</span>(treat, <span class="st">&quot;~&quot;</span>, <span class="fu">paste</span>(covar, <span class="at">collapse =</span> <span class="st">&quot; + &quot;</span>))),</span>
<span id="cb12-6"><a href="getting-started.html#cb12-6" tabindex="-1"></a>      <span class="at">data =</span> data,</span>
<span id="cb12-7"><a href="getting-started.html#cb12-7" tabindex="-1"></a>      <span class="at">un =</span> <span class="cn">TRUE</span>,</span>
<span id="cb12-8"><a href="getting-started.html#cb12-8" tabindex="-1"></a>      <span class="at">stats =</span> <span class="st">&quot;mean.diffs&quot;</span>,</span>
<span id="cb12-9"><a href="getting-started.html#cb12-9" tabindex="-1"></a>      <span class="at">s.d.denom =</span> <span class="st">&quot;treated&quot;</span></span>
<span id="cb12-10"><a href="getting-started.html#cb12-10" tabindex="-1"></a>    )</span>
<span id="cb12-11"><a href="getting-started.html#cb12-11" tabindex="-1"></a>    smds <span class="ot">&lt;-</span> bal_obj<span class="sc">$</span>Balance<span class="sc">$</span>Diff.Un   </span>
<span id="cb12-12"><a href="getting-started.html#cb12-12" tabindex="-1"></a>    smd_vals <span class="ot">&lt;-</span> <span class="fu">abs</span>(smds)</span>
<span id="cb12-13"><a href="getting-started.html#cb12-13" tabindex="-1"></a>    mean_smd <span class="ot">&lt;-</span> <span class="fu">mean</span>(smd_vals, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb12-14"><a href="getting-started.html#cb12-14" tabindex="-1"></a>    max_smd  <span class="ot">&lt;-</span> <span class="fu">max</span>(smd_vals, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb12-15"><a href="getting-started.html#cb12-15" tabindex="-1"></a>    <span class="fu">return</span>(<span class="fu">data.frame</span>(</span>
<span id="cb12-16"><a href="getting-started.html#cb12-16" tabindex="-1"></a>      <span class="at">Method   =</span> name,</span>
<span id="cb12-17"><a href="getting-started.html#cb12-17" tabindex="-1"></a>      <span class="at">Mean_Abs_SMD =</span> mean_smd,</span>
<span id="cb12-18"><a href="getting-started.html#cb12-18" tabindex="-1"></a>      <span class="at">Max_Abs_SMD  =</span> max_smd</span>
<span id="cb12-19"><a href="getting-started.html#cb12-19" tabindex="-1"></a>    ))</span>
<span id="cb12-20"><a href="getting-started.html#cb12-20" tabindex="-1"></a>  })</span>
<span id="cb12-21"><a href="getting-started.html#cb12-21" tabindex="-1"></a>  smd_summary <span class="ot">&lt;-</span> <span class="fu">do.call</span>(rbind, smd_list)</span>
<span id="cb12-22"><a href="getting-started.html#cb12-22" tabindex="-1"></a>  <span class="fu">rownames</span>(smd_summary) <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb12-23"><a href="getting-started.html#cb12-23" tabindex="-1"></a>  <span class="fu">return</span>(smd_summary)</span>
<span id="cb12-24"><a href="getting-started.html#cb12-24" tabindex="-1"></a>}</span></code></pre></div>
<p><strong>Arguments</strong></p>
<ul>
<li><code>data_list</code>: A list of data frames.</li>
<li><code>treat</code>: The name of the binary treatment indicator variable as string (default is “treat”).</li>
<li><code>covar</code>: A vector of covariate names.</li>
</ul>
<p><code>compute_ovl_trim()</code> compute the overlapping coefficient (OVL) for multiple samples.</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb13-1"><a href="getting-started.html#cb13-1" tabindex="-1"></a>compute_ovl_trim <span class="ot">&lt;-</span> <span class="cf">function</span>(data_list, <span class="at">ps =</span> <span class="st">&quot;ps_assoverlap&quot;</span>, <span class="at">treat =</span> <span class="st">&quot;treat&quot;</span>, <span class="at">n_points =</span> <span class="dv">512</span>) {</span>
<span id="cb13-2"><a href="getting-started.html#cb13-2" tabindex="-1"></a>  ovl_res <span class="ot">&lt;-</span> <span class="fu">lapply</span>(<span class="fu">names</span>(data_list), <span class="cf">function</span>(meth) {</span>
<span id="cb13-3"><a href="getting-started.html#cb13-3" tabindex="-1"></a>    dat <span class="ot">&lt;-</span> data_list[[meth]]</span>
<span id="cb13-4"><a href="getting-started.html#cb13-4" tabindex="-1"></a>    ps <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(dat[[ps]])</span>
<span id="cb13-5"><a href="getting-started.html#cb13-5" tabindex="-1"></a>    treat <span class="ot">&lt;-</span> dat[[treat]]</span>
<span id="cb13-6"><a href="getting-started.html#cb13-6" tabindex="-1"></a>    valid_idx <span class="ot">&lt;-</span> <span class="sc">!</span><span class="fu">is.na</span>(ps) <span class="sc">&amp;</span> <span class="sc">!</span><span class="fu">is.na</span>(treat) <span class="sc">&amp;</span> (ps <span class="sc">&gt;=</span> <span class="dv">0</span> <span class="sc">&amp;</span> ps <span class="sc">&lt;=</span> <span class="dv">1</span>)</span>
<span id="cb13-7"><a href="getting-started.html#cb13-7" tabindex="-1"></a>    ps <span class="ot">&lt;-</span> ps[valid_idx]</span>
<span id="cb13-8"><a href="getting-started.html#cb13-8" tabindex="-1"></a>    treat <span class="ot">&lt;-</span> treat[valid_idx]</span>
<span id="cb13-9"><a href="getting-started.html#cb13-9" tabindex="-1"></a>    treated_scores <span class="ot">&lt;-</span> ps[treat <span class="sc">==</span> <span class="dv">1</span>]</span>
<span id="cb13-10"><a href="getting-started.html#cb13-10" tabindex="-1"></a>    control_scores <span class="ot">&lt;-</span> ps[treat <span class="sc">==</span> <span class="dv">0</span>]</span>
<span id="cb13-11"><a href="getting-started.html#cb13-11" tabindex="-1"></a>    dens_treated <span class="ot">&lt;-</span> <span class="fu">density</span>(treated_scores, <span class="at">from =</span> <span class="dv">0</span>, <span class="at">to =</span> <span class="dv">1</span>, <span class="at">n =</span> n_points)</span>
<span id="cb13-12"><a href="getting-started.html#cb13-12" tabindex="-1"></a>    dens_control <span class="ot">&lt;-</span> <span class="fu">density</span>(control_scores, <span class="at">from =</span> <span class="dv">0</span>, <span class="at">to =</span> <span class="dv">1</span>, <span class="at">n =</span> n_points)</span>
<span id="cb13-13"><a href="getting-started.html#cb13-13" tabindex="-1"></a>    x_grid <span class="ot">&lt;-</span> dens_treated<span class="sc">$</span>x</span>
<span id="cb13-14"><a href="getting-started.html#cb13-14" tabindex="-1"></a>    min_density <span class="ot">&lt;-</span> <span class="fu">pmin</span>(dens_treated<span class="sc">$</span>y, dens_control<span class="sc">$</span>y)</span>
<span id="cb13-15"><a href="getting-started.html#cb13-15" tabindex="-1"></a>    bin_width <span class="ot">&lt;-</span> x_grid[<span class="dv">2</span>] <span class="sc">-</span> x_grid[<span class="dv">1</span>]</span>
<span id="cb13-16"><a href="getting-started.html#cb13-16" tabindex="-1"></a>    ovl <span class="ot">&lt;-</span> <span class="fu">sum</span>(min_density) <span class="sc">*</span> bin_width</span>
<span id="cb13-17"><a href="getting-started.html#cb13-17" tabindex="-1"></a>    <span class="fu">data.frame</span>(<span class="at">Method =</span> meth, <span class="at">OVL =</span> ovl)</span>
<span id="cb13-18"><a href="getting-started.html#cb13-18" tabindex="-1"></a>  })</span>
<span id="cb13-19"><a href="getting-started.html#cb13-19" tabindex="-1"></a>  res <span class="ot">&lt;-</span> <span class="fu">do.call</span>(rbind, ovl_res)</span>
<span id="cb13-20"><a href="getting-started.html#cb13-20" tabindex="-1"></a>  <span class="fu">rownames</span>(res) <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb13-21"><a href="getting-started.html#cb13-21" tabindex="-1"></a>  <span class="fu">return</span>(res)</span>
<span id="cb13-22"><a href="getting-started.html#cb13-22" tabindex="-1"></a>}</span></code></pre></div>
<p><strong>Arguments</strong></p>
<ul>
<li><code>data_list</code>: A list of data frames, each a trimmed sample.</li>
<li><code>ps</code>: A vector containing propensity scores (default is “ps_assoverlap”).</li>
<li><code>treat</code>: The name of the binary treatment indicator variable as string (default is “treat”).</li>
<li><code>n_points</code>: The number of grid points to use for the kernel density estimation (default is 512).</li>
</ul>
</div>
<div id="integrated-methods-1" class="section level4 hasAnchor" number="1.2.4.2">
<h4><span class="header-section-number">1.2.4.2</span> Integrated methods<a href="getting-started.html#integrated-methods-1" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p><code>compute_abs_smd_matchit()</code> computes the mean absolute standardized difference (ASMD) for matchit objects.</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb14-1"><a href="getting-started.html#cb14-1" tabindex="-1"></a>compute_abs_smd_matchit <span class="ot">&lt;-</span> <span class="cf">function</span>(match_list, data_list) {</span>
<span id="cb14-2"><a href="getting-started.html#cb14-2" tabindex="-1"></a>  <span class="cf">if</span> (<span class="sc">!</span><span class="fu">is.list</span>(match_list) <span class="sc">||</span> <span class="fu">length</span>(match_list) <span class="sc">==</span> <span class="dv">0</span>) {</span>
<span id="cb14-3"><a href="getting-started.html#cb14-3" tabindex="-1"></a>    <span class="fu">stop</span>(<span class="st">&quot;compute_abs_smd_matchit(): &#39;match_list&#39; must be a non-empty list&quot;</span>, <span class="at">call. =</span> <span class="cn">FALSE</span>)</span>
<span id="cb14-4"><a href="getting-started.html#cb14-4" tabindex="-1"></a>  }</span>
<span id="cb14-5"><a href="getting-started.html#cb14-5" tabindex="-1"></a>  <span class="cf">if</span> (<span class="sc">!</span><span class="fu">is.list</span>(data_list) <span class="sc">||</span> <span class="fu">length</span>(data_list) <span class="sc">==</span> <span class="dv">0</span>) {</span>
<span id="cb14-6"><a href="getting-started.html#cb14-6" tabindex="-1"></a>    <span class="fu">stop</span>(<span class="st">&quot;compute_abs_smd_matchit(): &#39;data_list&#39; must be a non-empty list&quot;</span>, <span class="at">call. =</span> <span class="cn">FALSE</span>)</span>
<span id="cb14-7"><a href="getting-started.html#cb14-7" tabindex="-1"></a>  }</span>
<span id="cb14-8"><a href="getting-started.html#cb14-8" tabindex="-1"></a>  data_len <span class="ot">&lt;-</span> <span class="fu">length</span>(data_list)</span>
<span id="cb14-9"><a href="getting-started.html#cb14-9" tabindex="-1"></a>  data_labels <span class="ot">&lt;-</span> <span class="cf">if</span> (<span class="fu">length</span>(<span class="fu">names</span>(data_list))) <span class="fu">names</span>(data_list) <span class="cf">else</span> <span class="fu">seq_len</span>(data_len)</span>
<span id="cb14-10"><a href="getting-started.html#cb14-10" tabindex="-1"></a>  smd_results <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb14-11"><a href="getting-started.html#cb14-11" tabindex="-1"></a>  <span class="cf">for</span> (method_name <span class="cf">in</span> <span class="fu">names</span>(match_list)) {</span>
<span id="cb14-12"><a href="getting-started.html#cb14-12" tabindex="-1"></a>    method_sublist <span class="ot">&lt;-</span> match_list[[method_name]]</span>
<span id="cb14-13"><a href="getting-started.html#cb14-13" tabindex="-1"></a>    <span class="cf">if</span> (<span class="sc">!</span><span class="fu">is.list</span>(method_sublist)) {</span>
<span id="cb14-14"><a href="getting-started.html#cb14-14" tabindex="-1"></a>      <span class="fu">warning</span>(<span class="fu">sprintf</span>(<span class="st">&quot;compute_abs_smd_matchit(): &#39;%s&#39; is not a list of matchit objects; skipping&quot;</span>, method_name), <span class="at">call. =</span> <span class="cn">FALSE</span>)</span>
<span id="cb14-15"><a href="getting-started.html#cb14-15" tabindex="-1"></a>      <span class="cf">next</span></span>
<span id="cb14-16"><a href="getting-started.html#cb14-16" tabindex="-1"></a>    }</span>
<span id="cb14-17"><a href="getting-started.html#cb14-17" tabindex="-1"></a>    method_len <span class="ot">&lt;-</span> <span class="fu">length</span>(method_sublist)</span>
<span id="cb14-18"><a href="getting-started.html#cb14-18" tabindex="-1"></a>    <span class="cf">if</span> (method_len <span class="sc">!=</span> data_len) {</span>
<span id="cb14-19"><a href="getting-started.html#cb14-19" tabindex="-1"></a>      <span class="fu">warning</span>(<span class="fu">sprintf</span>(</span>
<span id="cb14-20"><a href="getting-started.html#cb14-20" tabindex="-1"></a>        <span class="st">&quot;compute_abs_smd_matchit(): &#39;%s&#39; match list length (%d) differs from data_list length (%d); only the first %d elements are considered.&quot;</span>,</span>
<span id="cb14-21"><a href="getting-started.html#cb14-21" tabindex="-1"></a>        method_name,</span>
<span id="cb14-22"><a href="getting-started.html#cb14-22" tabindex="-1"></a>        method_len,</span>
<span id="cb14-23"><a href="getting-started.html#cb14-23" tabindex="-1"></a>        data_len,</span>
<span id="cb14-24"><a href="getting-started.html#cb14-24" tabindex="-1"></a>        <span class="fu">min</span>(method_len, data_len)</span>
<span id="cb14-25"><a href="getting-started.html#cb14-25" tabindex="-1"></a>      ), <span class="at">call. =</span> <span class="cn">FALSE</span>)</span>
<span id="cb14-26"><a href="getting-started.html#cb14-26" tabindex="-1"></a>    }</span>
<span id="cb14-27"><a href="getting-started.html#cb14-27" tabindex="-1"></a>    max_idx <span class="ot">&lt;-</span> <span class="fu">min</span>(method_len, data_len)</span>
<span id="cb14-28"><a href="getting-started.html#cb14-28" tabindex="-1"></a>    <span class="cf">for</span> (i <span class="cf">in</span> <span class="fu">seq_len</span>(max_idx)) {</span>
<span id="cb14-29"><a href="getting-started.html#cb14-29" tabindex="-1"></a>      match_obj <span class="ot">&lt;-</span> method_sublist[[i]]</span>
<span id="cb14-30"><a href="getting-started.html#cb14-30" tabindex="-1"></a>      data_i <span class="ot">&lt;-</span> data_list[[i]]</span>
<span id="cb14-31"><a href="getting-started.html#cb14-31" tabindex="-1"></a>      label_i <span class="ot">&lt;-</span> <span class="cf">if</span> (i <span class="sc">&lt;=</span> <span class="fu">length</span>(data_labels)) data_labels[[i]] <span class="cf">else</span> i</span>
<span id="cb14-32"><a href="getting-started.html#cb14-32" tabindex="-1"></a>      <span class="cf">if</span> (<span class="fu">is.null</span>(match_obj)) {</span>
<span id="cb14-33"><a href="getting-started.html#cb14-33" tabindex="-1"></a>        <span class="fu">warning</span>(<span class="fu">sprintf</span>(</span>
<span id="cb14-34"><a href="getting-started.html#cb14-34" tabindex="-1"></a>          <span class="st">&quot;compute_abs_smd_matchit(): skipping &#39;%s&#39; match object %d (%s) because it is NULL; check attach_matchit() failures.&quot;</span>,</span>
<span id="cb14-35"><a href="getting-started.html#cb14-35" tabindex="-1"></a>          method_name,</span>
<span id="cb14-36"><a href="getting-started.html#cb14-36" tabindex="-1"></a>          i,</span>
<span id="cb14-37"><a href="getting-started.html#cb14-37" tabindex="-1"></a>          label_i</span>
<span id="cb14-38"><a href="getting-started.html#cb14-38" tabindex="-1"></a>        ), <span class="at">call. =</span> <span class="cn">FALSE</span>)</span>
<span id="cb14-39"><a href="getting-started.html#cb14-39" tabindex="-1"></a>        <span class="cf">next</span></span>
<span id="cb14-40"><a href="getting-started.html#cb14-40" tabindex="-1"></a>      }</span>
<span id="cb14-41"><a href="getting-started.html#cb14-41" tabindex="-1"></a>      <span class="cf">if</span> (<span class="fu">is.null</span>(data_i)) {</span>
<span id="cb14-42"><a href="getting-started.html#cb14-42" tabindex="-1"></a>        <span class="fu">warning</span>(<span class="fu">sprintf</span>(</span>
<span id="cb14-43"><a href="getting-started.html#cb14-43" tabindex="-1"></a>          <span class="st">&quot;compute_abs_smd_matchit(): skipping &#39;%s&#39; source data %d (%s) because it is NULL; verify trimming outputs.&quot;</span>,</span>
<span id="cb14-44"><a href="getting-started.html#cb14-44" tabindex="-1"></a>          method_name,</span>
<span id="cb14-45"><a href="getting-started.html#cb14-45" tabindex="-1"></a>          i,</span>
<span id="cb14-46"><a href="getting-started.html#cb14-46" tabindex="-1"></a>          label_i</span>
<span id="cb14-47"><a href="getting-started.html#cb14-47" tabindex="-1"></a>        ), <span class="at">call. =</span> <span class="cn">FALSE</span>)</span>
<span id="cb14-48"><a href="getting-started.html#cb14-48" tabindex="-1"></a>        <span class="cf">next</span></span>
<span id="cb14-49"><a href="getting-started.html#cb14-49" tabindex="-1"></a>      }</span>
<span id="cb14-50"><a href="getting-started.html#cb14-50" tabindex="-1"></a>      bal <span class="ot">&lt;-</span> <span class="fu">bal.tab</span>(</span>
<span id="cb14-51"><a href="getting-started.html#cb14-51" tabindex="-1"></a>        match_obj,</span>
<span id="cb14-52"><a href="getting-started.html#cb14-52" tabindex="-1"></a>        <span class="at">data =</span> data_i,</span>
<span id="cb14-53"><a href="getting-started.html#cb14-53" tabindex="-1"></a>        <span class="at">stats =</span> <span class="st">&quot;mean.diffs&quot;</span>,</span>
<span id="cb14-54"><a href="getting-started.html#cb14-54" tabindex="-1"></a>        <span class="at">un =</span> <span class="cn">TRUE</span>,</span>
<span id="cb14-55"><a href="getting-started.html#cb14-55" tabindex="-1"></a>        <span class="at">s.d.denom =</span> <span class="st">&quot;treated&quot;</span></span>
<span id="cb14-56"><a href="getting-started.html#cb14-56" tabindex="-1"></a>      )</span>
<span id="cb14-57"><a href="getting-started.html#cb14-57" tabindex="-1"></a>      smds <span class="ot">&lt;-</span> bal<span class="sc">$</span>Balance<span class="sc">$</span>Diff.Adj</span>
<span id="cb14-58"><a href="getting-started.html#cb14-58" tabindex="-1"></a>      smd_vals <span class="ot">&lt;-</span> <span class="fu">abs</span>(smds)</span>
<span id="cb14-59"><a href="getting-started.html#cb14-59" tabindex="-1"></a>      mean_smd <span class="ot">&lt;-</span> <span class="fu">mean</span>(smd_vals, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb14-60"><a href="getting-started.html#cb14-60" tabindex="-1"></a>      max_smd <span class="ot">&lt;-</span> <span class="fu">max</span>(smd_vals, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb14-61"><a href="getting-started.html#cb14-61" tabindex="-1"></a>      smd_results[[<span class="fu">paste</span>(method_name, label_i, <span class="at">sep =</span> <span class="st">&quot;_&quot;</span>)]] <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb14-62"><a href="getting-started.html#cb14-62" tabindex="-1"></a>        <span class="at">Method =</span> method_name,</span>
<span id="cb14-63"><a href="getting-started.html#cb14-63" tabindex="-1"></a>        <span class="at">MatchIndex =</span> label_i,</span>
<span id="cb14-64"><a href="getting-started.html#cb14-64" tabindex="-1"></a>        <span class="at">Mean_Abs_SMD =</span> mean_smd,</span>
<span id="cb14-65"><a href="getting-started.html#cb14-65" tabindex="-1"></a>        <span class="at">Max_Abs_SMD =</span> max_smd</span>
<span id="cb14-66"><a href="getting-started.html#cb14-66" tabindex="-1"></a>      )</span>
<span id="cb14-67"><a href="getting-started.html#cb14-67" tabindex="-1"></a>    }</span>
<span id="cb14-68"><a href="getting-started.html#cb14-68" tabindex="-1"></a>  }</span>
<span id="cb14-69"><a href="getting-started.html#cb14-69" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">length</span>(smd_results) <span class="sc">==</span> <span class="dv">0</span>) {</span>
<span id="cb14-70"><a href="getting-started.html#cb14-70" tabindex="-1"></a>    <span class="fu">return</span>(<span class="fu">data.frame</span>(</span>
<span id="cb14-71"><a href="getting-started.html#cb14-71" tabindex="-1"></a>      <span class="at">Method =</span> <span class="fu">character</span>(<span class="dv">0</span>),</span>
<span id="cb14-72"><a href="getting-started.html#cb14-72" tabindex="-1"></a>      <span class="at">MatchIndex =</span> <span class="fu">integer</span>(<span class="dv">0</span>),</span>
<span id="cb14-73"><a href="getting-started.html#cb14-73" tabindex="-1"></a>      <span class="at">Mean_Abs_SMD =</span> <span class="fu">numeric</span>(<span class="dv">0</span>),</span>
<span id="cb14-74"><a href="getting-started.html#cb14-74" tabindex="-1"></a>      <span class="at">Max_Abs_SMD =</span> <span class="fu">numeric</span>(<span class="dv">0</span>)</span>
<span id="cb14-75"><a href="getting-started.html#cb14-75" tabindex="-1"></a>    ))</span>
<span id="cb14-76"><a href="getting-started.html#cb14-76" tabindex="-1"></a>  }</span>
<span id="cb14-77"><a href="getting-started.html#cb14-77" tabindex="-1"></a>  smd_summary <span class="ot">&lt;-</span> <span class="fu">do.call</span>(rbind, smd_results)</span>
<span id="cb14-78"><a href="getting-started.html#cb14-78" tabindex="-1"></a>  <span class="fu">rownames</span>(smd_summary) <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb14-79"><a href="getting-started.html#cb14-79" tabindex="-1"></a>  <span class="fu">return</span>(smd_summary)</span>
<span id="cb14-80"><a href="getting-started.html#cb14-80" tabindex="-1"></a>}</span></code></pre></div>
<p><strong>Arguments</strong></p>
<ul>
<li><code>match_list</code>: A named list of method-specific elements, where each itself is a list of matchit objects.</li>
<li><code>data_list</code>: A list of data frames, each a trimmed sample.</li>
</ul>
<p><code>compute_ovl_matchit()</code> computes the OVL for matchit objects.</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb15-1"><a href="getting-started.html#cb15-1" tabindex="-1"></a>compute_ovl_matchit <span class="ot">&lt;-</span> <span class="cf">function</span>(match_list, data_list, <span class="at">ps =</span> <span class="st">&quot;ps_assoverlap&quot;</span>, <span class="at">treat =</span> <span class="st">&quot;treat&quot;</span>,</span>
<span id="cb15-2"><a href="getting-started.html#cb15-2" tabindex="-1"></a>                                <span class="at">covar =</span> <span class="cn">NULL</span>, <span class="at">num.trees =</span> <span class="cn">NULL</span>, <span class="at">seed =</span> <span class="dv">42</span>, <span class="at">n_points =</span> <span class="dv">512</span>) {</span>
<span id="cb15-3"><a href="getting-started.html#cb15-3" tabindex="-1"></a>  <span class="cf">if</span> (<span class="sc">!</span><span class="fu">is.list</span>(match_list) <span class="sc">||</span> <span class="fu">length</span>(match_list) <span class="sc">==</span> <span class="dv">0</span>) {</span>
<span id="cb15-4"><a href="getting-started.html#cb15-4" tabindex="-1"></a>    <span class="fu">stop</span>(<span class="st">&quot;compute_ovl_matchit(): &#39;match_list&#39; must be a non-empty list&quot;</span>, <span class="at">call. =</span> <span class="cn">FALSE</span>)</span>
<span id="cb15-5"><a href="getting-started.html#cb15-5" tabindex="-1"></a>  }</span>
<span id="cb15-6"><a href="getting-started.html#cb15-6" tabindex="-1"></a>  <span class="cf">if</span> (<span class="sc">!</span><span class="fu">is.list</span>(data_list) <span class="sc">||</span> <span class="fu">length</span>(data_list) <span class="sc">==</span> <span class="dv">0</span>) {</span>
<span id="cb15-7"><a href="getting-started.html#cb15-7" tabindex="-1"></a>    <span class="fu">stop</span>(<span class="st">&quot;compute_ovl_matchit(): &#39;data_list&#39; must be a non-empty list&quot;</span>, <span class="at">call. =</span> <span class="cn">FALSE</span>)</span>
<span id="cb15-8"><a href="getting-started.html#cb15-8" tabindex="-1"></a>  }</span>
<span id="cb15-9"><a href="getting-started.html#cb15-9" tabindex="-1"></a>  data_len <span class="ot">&lt;-</span> <span class="fu">length</span>(data_list)</span>
<span id="cb15-10"><a href="getting-started.html#cb15-10" tabindex="-1"></a>  data_labels <span class="ot">&lt;-</span> <span class="cf">if</span> (<span class="fu">length</span>(<span class="fu">names</span>(data_list))) <span class="fu">names</span>(data_list) <span class="cf">else</span> <span class="fu">seq_len</span>(data_len)</span>
<span id="cb15-11"><a href="getting-started.html#cb15-11" tabindex="-1"></a>  ovl_results <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb15-12"><a href="getting-started.html#cb15-12" tabindex="-1"></a>  <span class="cf">for</span> (method_name <span class="cf">in</span> <span class="fu">names</span>(match_list)) {</span>
<span id="cb15-13"><a href="getting-started.html#cb15-13" tabindex="-1"></a>    method_sublist <span class="ot">&lt;-</span> match_list[[method_name]]</span>
<span id="cb15-14"><a href="getting-started.html#cb15-14" tabindex="-1"></a>    <span class="cf">if</span> (<span class="sc">!</span><span class="fu">is.list</span>(method_sublist)) {</span>
<span id="cb15-15"><a href="getting-started.html#cb15-15" tabindex="-1"></a>      <span class="fu">warning</span>(<span class="fu">sprintf</span>(<span class="st">&quot;compute_ovl_matchit(): &#39;%s&#39; is not a list of matchit objects; skipping&quot;</span>, method_name), <span class="at">call. =</span> <span class="cn">FALSE</span>)</span>
<span id="cb15-16"><a href="getting-started.html#cb15-16" tabindex="-1"></a>      <span class="cf">next</span></span>
<span id="cb15-17"><a href="getting-started.html#cb15-17" tabindex="-1"></a>    }</span>
<span id="cb15-18"><a href="getting-started.html#cb15-18" tabindex="-1"></a>    method_len <span class="ot">&lt;-</span> <span class="fu">length</span>(method_sublist)</span>
<span id="cb15-19"><a href="getting-started.html#cb15-19" tabindex="-1"></a>    <span class="cf">if</span> (method_len <span class="sc">!=</span> data_len) {</span>
<span id="cb15-20"><a href="getting-started.html#cb15-20" tabindex="-1"></a>      <span class="fu">warning</span>(<span class="fu">sprintf</span>(</span>
<span id="cb15-21"><a href="getting-started.html#cb15-21" tabindex="-1"></a>        <span class="st">&quot;compute_ovl_matchit(): &#39;%s&#39; match list length (%d) differs from data_list length (%d); only the first %d elements are considered.&quot;</span>,</span>
<span id="cb15-22"><a href="getting-started.html#cb15-22" tabindex="-1"></a>        method_name,</span>
<span id="cb15-23"><a href="getting-started.html#cb15-23" tabindex="-1"></a>        method_len,</span>
<span id="cb15-24"><a href="getting-started.html#cb15-24" tabindex="-1"></a>        data_len,</span>
<span id="cb15-25"><a href="getting-started.html#cb15-25" tabindex="-1"></a>        <span class="fu">min</span>(method_len, data_len)</span>
<span id="cb15-26"><a href="getting-started.html#cb15-26" tabindex="-1"></a>      ), <span class="at">call. =</span> <span class="cn">FALSE</span>)</span>
<span id="cb15-27"><a href="getting-started.html#cb15-27" tabindex="-1"></a>    }</span>
<span id="cb15-28"><a href="getting-started.html#cb15-28" tabindex="-1"></a>    max_idx <span class="ot">&lt;-</span> <span class="fu">min</span>(method_len, data_len)</span>
<span id="cb15-29"><a href="getting-started.html#cb15-29" tabindex="-1"></a>    <span class="cf">for</span> (i <span class="cf">in</span> <span class="fu">seq_len</span>(max_idx)) {</span>
<span id="cb15-30"><a href="getting-started.html#cb15-30" tabindex="-1"></a>      match_obj <span class="ot">&lt;-</span> method_sublist[[i]]</span>
<span id="cb15-31"><a href="getting-started.html#cb15-31" tabindex="-1"></a>      data_i <span class="ot">&lt;-</span> data_list[[i]]</span>
<span id="cb15-32"><a href="getting-started.html#cb15-32" tabindex="-1"></a>      label_i <span class="ot">&lt;-</span> <span class="cf">if</span> (i <span class="sc">&lt;=</span> <span class="fu">length</span>(data_labels)) data_labels[[i]] <span class="cf">else</span> i</span>
<span id="cb15-33"><a href="getting-started.html#cb15-33" tabindex="-1"></a>      <span class="cf">if</span> (<span class="fu">is.null</span>(match_obj)) {</span>
<span id="cb15-34"><a href="getting-started.html#cb15-34" tabindex="-1"></a>        <span class="fu">warning</span>(<span class="fu">sprintf</span>(</span>
<span id="cb15-35"><a href="getting-started.html#cb15-35" tabindex="-1"></a>          <span class="st">&quot;compute_ovl_matchit(): skipping &#39;%s&#39; match object %d (%s) because it is NULL; check attach_matchit() failures.&quot;</span>,</span>
<span id="cb15-36"><a href="getting-started.html#cb15-36" tabindex="-1"></a>          method_name,</span>
<span id="cb15-37"><a href="getting-started.html#cb15-37" tabindex="-1"></a>          i,</span>
<span id="cb15-38"><a href="getting-started.html#cb15-38" tabindex="-1"></a>          label_i</span>
<span id="cb15-39"><a href="getting-started.html#cb15-39" tabindex="-1"></a>        ), <span class="at">call. =</span> <span class="cn">FALSE</span>)</span>
<span id="cb15-40"><a href="getting-started.html#cb15-40" tabindex="-1"></a>        <span class="cf">next</span></span>
<span id="cb15-41"><a href="getting-started.html#cb15-41" tabindex="-1"></a>      }</span>
<span id="cb15-42"><a href="getting-started.html#cb15-42" tabindex="-1"></a>      <span class="cf">if</span> (<span class="sc">!</span><span class="fu">inherits</span>(match_obj, <span class="st">&quot;matchit&quot;</span>)) {</span>
<span id="cb15-43"><a href="getting-started.html#cb15-43" tabindex="-1"></a>        <span class="fu">warning</span>(<span class="fu">sprintf</span>(</span>
<span id="cb15-44"><a href="getting-started.html#cb15-44" tabindex="-1"></a>          <span class="st">&quot;compute_ovl_matchit(): skipping &#39;%s&#39; match object %d (%s) because it is class &#39;%s&#39; not &#39;matchit&#39;&quot;</span>,</span>
<span id="cb15-45"><a href="getting-started.html#cb15-45" tabindex="-1"></a>          method_name,</span>
<span id="cb15-46"><a href="getting-started.html#cb15-46" tabindex="-1"></a>          i,</span>
<span id="cb15-47"><a href="getting-started.html#cb15-47" tabindex="-1"></a>          label_i,</span>
<span id="cb15-48"><a href="getting-started.html#cb15-48" tabindex="-1"></a>          <span class="fu">paste</span>(<span class="fu">class</span>(match_obj), <span class="at">collapse =</span> <span class="st">&quot;/&quot;</span>)</span>
<span id="cb15-49"><a href="getting-started.html#cb15-49" tabindex="-1"></a>        ), <span class="at">call. =</span> <span class="cn">FALSE</span>)</span>
<span id="cb15-50"><a href="getting-started.html#cb15-50" tabindex="-1"></a>        <span class="cf">next</span></span>
<span id="cb15-51"><a href="getting-started.html#cb15-51" tabindex="-1"></a>      }</span>
<span id="cb15-52"><a href="getting-started.html#cb15-52" tabindex="-1"></a>      <span class="cf">if</span> (<span class="fu">is.null</span>(data_i)) {</span>
<span id="cb15-53"><a href="getting-started.html#cb15-53" tabindex="-1"></a>        data_i <span class="ot">&lt;-</span> <span class="fu">attr</span>(match_obj, <span class="st">&quot;match_source&quot;</span>)</span>
<span id="cb15-54"><a href="getting-started.html#cb15-54" tabindex="-1"></a>        <span class="cf">if</span> (<span class="fu">is.null</span>(data_i)) {</span>
<span id="cb15-55"><a href="getting-started.html#cb15-55" tabindex="-1"></a>          <span class="fu">warning</span>(<span class="fu">sprintf</span>(</span>
<span id="cb15-56"><a href="getting-started.html#cb15-56" tabindex="-1"></a>            <span class="st">&quot;compute_ovl_matchit(): source data missing for method &#39;%s&#39; index %d (%s); cannot recover matched data.&quot;</span>,</span>
<span id="cb15-57"><a href="getting-started.html#cb15-57" tabindex="-1"></a>            method_name,</span>
<span id="cb15-58"><a href="getting-started.html#cb15-58" tabindex="-1"></a>            i,</span>
<span id="cb15-59"><a href="getting-started.html#cb15-59" tabindex="-1"></a>            label_i</span>
<span id="cb15-60"><a href="getting-started.html#cb15-60" tabindex="-1"></a>          ), <span class="at">call. =</span> <span class="cn">FALSE</span>)</span>
<span id="cb15-61"><a href="getting-started.html#cb15-61" tabindex="-1"></a>          <span class="cf">next</span></span>
<span id="cb15-62"><a href="getting-started.html#cb15-62" tabindex="-1"></a>        }</span>
<span id="cb15-63"><a href="getting-started.html#cb15-63" tabindex="-1"></a>      }</span>
<span id="cb15-64"><a href="getting-started.html#cb15-64" tabindex="-1"></a>      <span class="cf">if</span> (<span class="sc">!</span><span class="fu">is.data.frame</span>(data_i)) {</span>
<span id="cb15-65"><a href="getting-started.html#cb15-65" tabindex="-1"></a>        <span class="fu">warning</span>(<span class="fu">sprintf</span>(</span>
<span id="cb15-66"><a href="getting-started.html#cb15-66" tabindex="-1"></a>          <span class="st">&quot;compute_ovl_matchit(): data_list[[%d]] for method &#39;%s&#39; is type &#39;%s&#39; not data.frame&quot;</span>,</span>
<span id="cb15-67"><a href="getting-started.html#cb15-67" tabindex="-1"></a>          i,</span>
<span id="cb15-68"><a href="getting-started.html#cb15-68" tabindex="-1"></a>          method_name,</span>
<span id="cb15-69"><a href="getting-started.html#cb15-69" tabindex="-1"></a>          <span class="fu">paste</span>(<span class="fu">class</span>(data_i), <span class="at">collapse =</span> <span class="st">&quot;/&quot;</span>)</span>
<span id="cb15-70"><a href="getting-started.html#cb15-70" tabindex="-1"></a>        ), <span class="at">call. =</span> <span class="cn">FALSE</span>)</span>
<span id="cb15-71"><a href="getting-started.html#cb15-71" tabindex="-1"></a>        <span class="cf">next</span></span>
<span id="cb15-72"><a href="getting-started.html#cb15-72" tabindex="-1"></a>      }</span>
<span id="cb15-73"><a href="getting-started.html#cb15-73" tabindex="-1"></a>      <span class="cf">if</span> (<span class="sc">!</span><span class="fu">nrow</span>(data_i)) {</span>
<span id="cb15-74"><a href="getting-started.html#cb15-74" tabindex="-1"></a>        <span class="fu">warning</span>(<span class="fu">sprintf</span>(</span>
<span id="cb15-75"><a href="getting-started.html#cb15-75" tabindex="-1"></a>          <span class="st">&quot;compute_ovl_matchit(): data_list[[%d]] for method &#39;%s&#39; has zero rows&quot;</span>,</span>
<span id="cb15-76"><a href="getting-started.html#cb15-76" tabindex="-1"></a>          i,</span>
<span id="cb15-77"><a href="getting-started.html#cb15-77" tabindex="-1"></a>          method_name</span>
<span id="cb15-78"><a href="getting-started.html#cb15-78" tabindex="-1"></a>        ), <span class="at">call. =</span> <span class="cn">FALSE</span>)</span>
<span id="cb15-79"><a href="getting-started.html#cb15-79" tabindex="-1"></a>        <span class="cf">next</span></span>
<span id="cb15-80"><a href="getting-started.html#cb15-80" tabindex="-1"></a>      }</span>
<span id="cb15-81"><a href="getting-started.html#cb15-81" tabindex="-1"></a>      matched_data <span class="ot">&lt;-</span> <span class="fu">match.data</span>(match_obj, <span class="at">data =</span> data_i)</span>
<span id="cb15-82"><a href="getting-started.html#cb15-82" tabindex="-1"></a>      <span class="cf">if</span> (<span class="sc">!</span><span class="fu">is.data.frame</span>(matched_data) <span class="sc">||</span> <span class="sc">!</span><span class="fu">nrow</span>(matched_data)) {</span>
<span id="cb15-83"><a href="getting-started.html#cb15-83" tabindex="-1"></a>        <span class="fu">warning</span>(<span class="fu">sprintf</span>(</span>
<span id="cb15-84"><a href="getting-started.html#cb15-84" tabindex="-1"></a>          <span class="st">&quot;compute_ovl_matchit(): matched data empty for method &#39;%s&#39; index %d (%s)&quot;</span>,</span>
<span id="cb15-85"><a href="getting-started.html#cb15-85" tabindex="-1"></a>          method_name,</span>
<span id="cb15-86"><a href="getting-started.html#cb15-86" tabindex="-1"></a>          i,</span>
<span id="cb15-87"><a href="getting-started.html#cb15-87" tabindex="-1"></a>          label_i</span>
<span id="cb15-88"><a href="getting-started.html#cb15-88" tabindex="-1"></a>        ), <span class="at">call. =</span> <span class="cn">FALSE</span>)</span>
<span id="cb15-89"><a href="getting-started.html#cb15-89" tabindex="-1"></a>        <span class="cf">next</span></span>
<span id="cb15-90"><a href="getting-started.html#cb15-90" tabindex="-1"></a>      }</span>
<span id="cb15-91"><a href="getting-started.html#cb15-91" tabindex="-1"></a>      <span class="cf">if</span> (ps <span class="sc">%in%</span> <span class="fu">names</span>(matched_data)) {</span>
<span id="cb15-92"><a href="getting-started.html#cb15-92" tabindex="-1"></a>        ps_vals <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(matched_data[[ps]])</span>
<span id="cb15-93"><a href="getting-started.html#cb15-93" tabindex="-1"></a>      } <span class="cf">else</span> {</span>
<span id="cb15-94"><a href="getting-started.html#cb15-94" tabindex="-1"></a>        <span class="cf">if</span> (<span class="fu">is.null</span>(covar)) {</span>
<span id="cb15-95"><a href="getting-started.html#cb15-95" tabindex="-1"></a>          <span class="fu">stop</span>(<span class="fu">sprintf</span>(</span>
<span id="cb15-96"><a href="getting-started.html#cb15-96" tabindex="-1"></a>            <span class="st">&quot;compute_ovl_matchit(): propensity scores missing for &#39;%s&#39; index %d (%s) and &#39;covar&#39; not provided&quot;</span>,</span>
<span id="cb15-97"><a href="getting-started.html#cb15-97" tabindex="-1"></a>            method_name,</span>
<span id="cb15-98"><a href="getting-started.html#cb15-98" tabindex="-1"></a>            i,</span>
<span id="cb15-99"><a href="getting-started.html#cb15-99" tabindex="-1"></a>            label_i</span>
<span id="cb15-100"><a href="getting-started.html#cb15-100" tabindex="-1"></a>          ), <span class="at">call. =</span> <span class="cn">FALSE</span>)</span>
<span id="cb15-101"><a href="getting-started.html#cb15-101" tabindex="-1"></a>        }</span>
<span id="cb15-102"><a href="getting-started.html#cb15-102" tabindex="-1"></a>        X <span class="ot">&lt;-</span> matched_data[, covar, drop <span class="ot">=</span> <span class="cn">FALSE</span>]</span>
<span id="cb15-103"><a href="getting-started.html#cb15-103" tabindex="-1"></a>        Y <span class="ot">&lt;-</span> <span class="fu">as.factor</span>(matched_data[[treat]])</span>
<span id="cb15-104"><a href="getting-started.html#cb15-104" tabindex="-1"></a>        <span class="cf">if</span> (<span class="fu">is.null</span>(num.trees)) {</span>
<span id="cb15-105"><a href="getting-started.html#cb15-105" tabindex="-1"></a>          p.forest1 <span class="ot">&lt;-</span> <span class="fu">probability_forest</span>(<span class="at">X =</span> X, <span class="at">Y =</span> Y, <span class="at">seed =</span> seed)</span>
<span id="cb15-106"><a href="getting-started.html#cb15-106" tabindex="-1"></a>        } <span class="cf">else</span> {</span>
<span id="cb15-107"><a href="getting-started.html#cb15-107" tabindex="-1"></a>          p.forest1 <span class="ot">&lt;-</span> <span class="fu">probability_forest</span>(<span class="at">X =</span> X, <span class="at">Y =</span> Y, <span class="at">seed =</span> seed, <span class="at">num.trees =</span> num.trees)</span>
<span id="cb15-108"><a href="getting-started.html#cb15-108" tabindex="-1"></a>        }</span>
<span id="cb15-109"><a href="getting-started.html#cb15-109" tabindex="-1"></a>        ps_vals <span class="ot">&lt;-</span> p.forest1<span class="sc">$</span>predictions[, <span class="dv">2</span>]</span>
<span id="cb15-110"><a href="getting-started.html#cb15-110" tabindex="-1"></a>        ps_vals[<span class="fu">which</span>(<span class="fu">abs</span>(ps_vals) <span class="sc">&lt;=</span> <span class="fl">1e-7</span>)] <span class="ot">&lt;-</span> <span class="fl">1e-7</span></span>
<span id="cb15-111"><a href="getting-started.html#cb15-111" tabindex="-1"></a>      }</span>
<span id="cb15-112"><a href="getting-started.html#cb15-112" tabindex="-1"></a>      treat_vals <span class="ot">&lt;-</span> matched_data[[treat]]</span>
<span id="cb15-113"><a href="getting-started.html#cb15-113" tabindex="-1"></a>      valid_idx <span class="ot">&lt;-</span> <span class="sc">!</span><span class="fu">is.na</span>(ps_vals) <span class="sc">&amp;</span> <span class="sc">!</span><span class="fu">is.na</span>(treat_vals) <span class="sc">&amp;</span> (ps_vals <span class="sc">&gt;=</span> <span class="dv">0</span> <span class="sc">&amp;</span> ps_vals <span class="sc">&lt;=</span> <span class="dv">1</span>)</span>
<span id="cb15-114"><a href="getting-started.html#cb15-114" tabindex="-1"></a>      ps_vals <span class="ot">&lt;-</span> ps_vals[valid_idx]</span>
<span id="cb15-115"><a href="getting-started.html#cb15-115" tabindex="-1"></a>      treat_vals <span class="ot">&lt;-</span> treat_vals[valid_idx]</span>
<span id="cb15-116"><a href="getting-started.html#cb15-116" tabindex="-1"></a>      <span class="cf">if</span> (<span class="sc">!</span><span class="fu">length</span>(ps_vals) <span class="sc">||</span> <span class="fu">length</span>(<span class="fu">unique</span>(treat_vals)) <span class="sc">&lt;</span> <span class="dv">2</span>) {</span>
<span id="cb15-117"><a href="getting-started.html#cb15-117" tabindex="-1"></a>        <span class="fu">warning</span>(<span class="fu">sprintf</span>(</span>
<span id="cb15-118"><a href="getting-started.html#cb15-118" tabindex="-1"></a>          <span class="st">&quot;compute_ovl_matchit(): insufficient treated/control overlap after cleaning for method &#39;%s&#39; index %d (%s)&quot;</span>,</span>
<span id="cb15-119"><a href="getting-started.html#cb15-119" tabindex="-1"></a>          method_name,</span>
<span id="cb15-120"><a href="getting-started.html#cb15-120" tabindex="-1"></a>          i,</span>
<span id="cb15-121"><a href="getting-started.html#cb15-121" tabindex="-1"></a>          label_i</span>
<span id="cb15-122"><a href="getting-started.html#cb15-122" tabindex="-1"></a>        ), <span class="at">call. =</span> <span class="cn">FALSE</span>)</span>
<span id="cb15-123"><a href="getting-started.html#cb15-123" tabindex="-1"></a>        <span class="cf">next</span></span>
<span id="cb15-124"><a href="getting-started.html#cb15-124" tabindex="-1"></a>      }</span>
<span id="cb15-125"><a href="getting-started.html#cb15-125" tabindex="-1"></a>      treated_scores <span class="ot">&lt;-</span> ps_vals[treat_vals <span class="sc">==</span> <span class="dv">1</span>]</span>
<span id="cb15-126"><a href="getting-started.html#cb15-126" tabindex="-1"></a>      control_scores <span class="ot">&lt;-</span> ps_vals[treat_vals <span class="sc">==</span> <span class="dv">0</span>]</span>
<span id="cb15-127"><a href="getting-started.html#cb15-127" tabindex="-1"></a>      <span class="cf">if</span> (<span class="fu">length</span>(treated_scores) <span class="sc">&lt;</span> <span class="dv">2</span> <span class="sc">||</span> <span class="fu">length</span>(control_scores) <span class="sc">&lt;</span> <span class="dv">2</span>) {</span>
<span id="cb15-128"><a href="getting-started.html#cb15-128" tabindex="-1"></a>        <span class="fu">warning</span>(<span class="fu">sprintf</span>(</span>
<span id="cb15-129"><a href="getting-started.html#cb15-129" tabindex="-1"></a>          <span class="st">&quot;compute_ovl_matchit(): Not enough treated/control units for density estimation in method &#39;%s&#39; index %d (%s)&quot;</span>,</span>
<span id="cb15-130"><a href="getting-started.html#cb15-130" tabindex="-1"></a>          method_name,</span>
<span id="cb15-131"><a href="getting-started.html#cb15-131" tabindex="-1"></a>          i,</span>
<span id="cb15-132"><a href="getting-started.html#cb15-132" tabindex="-1"></a>          label_i</span>
<span id="cb15-133"><a href="getting-started.html#cb15-133" tabindex="-1"></a>        ), <span class="at">call. =</span> <span class="cn">FALSE</span>)</span>
<span id="cb15-134"><a href="getting-started.html#cb15-134" tabindex="-1"></a>        <span class="cf">next</span></span>
<span id="cb15-135"><a href="getting-started.html#cb15-135" tabindex="-1"></a>      }</span>
<span id="cb15-136"><a href="getting-started.html#cb15-136" tabindex="-1"></a>      dens_treated <span class="ot">&lt;-</span> <span class="fu">density</span>(treated_scores, <span class="at">from =</span> <span class="dv">0</span>, <span class="at">to =</span> <span class="dv">1</span>, <span class="at">n =</span> n_points)</span>
<span id="cb15-137"><a href="getting-started.html#cb15-137" tabindex="-1"></a>      dens_control <span class="ot">&lt;-</span> <span class="fu">density</span>(control_scores, <span class="at">from =</span> <span class="dv">0</span>, <span class="at">to =</span> <span class="dv">1</span>, <span class="at">n =</span> n_points)</span>
<span id="cb15-138"><a href="getting-started.html#cb15-138" tabindex="-1"></a>      x_grid <span class="ot">&lt;-</span> dens_treated<span class="sc">$</span>x</span>
<span id="cb15-139"><a href="getting-started.html#cb15-139" tabindex="-1"></a>      min_density <span class="ot">&lt;-</span> <span class="fu">pmin</span>(dens_treated<span class="sc">$</span>y, dens_control<span class="sc">$</span>y)</span>
<span id="cb15-140"><a href="getting-started.html#cb15-140" tabindex="-1"></a>      bin_width <span class="ot">&lt;-</span> x_grid[<span class="dv">2</span>] <span class="sc">-</span> x_grid[<span class="dv">1</span>]</span>
<span id="cb15-141"><a href="getting-started.html#cb15-141" tabindex="-1"></a>      ovl <span class="ot">&lt;-</span> <span class="fu">sum</span>(min_density) <span class="sc">*</span> bin_width</span>
<span id="cb15-142"><a href="getting-started.html#cb15-142" tabindex="-1"></a>      ovl_results[[<span class="fu">paste</span>(method_name, label_i, <span class="at">sep =</span> <span class="st">&quot;_&quot;</span>)]] <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb15-143"><a href="getting-started.html#cb15-143" tabindex="-1"></a>        <span class="at">Method =</span> <span class="fu">paste</span>(method_name, label_i, <span class="at">sep =</span> <span class="st">&quot;_&quot;</span>),</span>
<span id="cb15-144"><a href="getting-started.html#cb15-144" tabindex="-1"></a>        <span class="at">OVL =</span> ovl</span>
<span id="cb15-145"><a href="getting-started.html#cb15-145" tabindex="-1"></a>      )</span>
<span id="cb15-146"><a href="getting-started.html#cb15-146" tabindex="-1"></a>    }</span>
<span id="cb15-147"><a href="getting-started.html#cb15-147" tabindex="-1"></a>  }</span>
<span id="cb15-148"><a href="getting-started.html#cb15-148" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">length</span>(ovl_results) <span class="sc">==</span> <span class="dv">0</span>) {</span>
<span id="cb15-149"><a href="getting-started.html#cb15-149" tabindex="-1"></a>    <span class="fu">return</span>(<span class="fu">data.frame</span>(<span class="at">Method =</span> <span class="fu">character</span>(<span class="dv">0</span>), <span class="at">OVL =</span> <span class="fu">numeric</span>(<span class="dv">0</span>)))</span>
<span id="cb15-150"><a href="getting-started.html#cb15-150" tabindex="-1"></a>  }</span>
<span id="cb15-151"><a href="getting-started.html#cb15-151" tabindex="-1"></a>  final_df <span class="ot">&lt;-</span> <span class="fu">do.call</span>(rbind, ovl_results)</span>
<span id="cb15-152"><a href="getting-started.html#cb15-152" tabindex="-1"></a>  <span class="fu">rownames</span>(final_df) <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb15-153"><a href="getting-started.html#cb15-153" tabindex="-1"></a>  <span class="fu">return</span>(final_df)</span>
<span id="cb15-154"><a href="getting-started.html#cb15-154" tabindex="-1"></a>}</span></code></pre></div>
<p><strong>Arguments</strong></p>
<ul>
<li><code>match_list</code>: A named list of method-specific elements, where each itself is a list of matchit objects.</li>
<li><code>data_list</code>: A list of data frames, each a trimmed sample.</li>
<li><code>ps</code>: A vector containing propensity scores (default is “ps_assoverlap”).</li>
<li><code>treat</code>: The name of the binary treatment indicator variable as string (default is “treat”).</li>
<li><code>covar</code>: A vector of covariate names.</li>
<li><code>num.trees</code>: Integer specifying the number of trees to grow in the random forest model for propensity score estimation.</li>
<li><code>seed</code>: Integer to ensure reproducibility (default is 42).</li>
<li><code>n_points</code>: The number of grid points to use for the kernel density estimation.</li>
</ul>
</div>
</div>
<div id="identifying-best-methods" class="section level3 hasAnchor" number="1.2.5">
<h3><span class="header-section-number">1.2.5</span> Identifying best methods<a href="getting-started.html#identifying-best-methods" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p><code>combine_results()</code> merges and summarizes mean ASMD and OVL statistics from various analysis stages of non-plus-samples into a final comparison table.</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb16-1"><a href="getting-started.html#cb16-1" tabindex="-1"></a>combine_results <span class="ot">&lt;-</span> <span class="cf">function</span>(data) {</span>
<span id="cb16-2"><a href="getting-started.html#cb16-2" tabindex="-1"></a>  data_lower <span class="ot">&lt;-</span> <span class="fu">tolower</span>(data)</span>
<span id="cb16-3"><a href="getting-started.html#cb16-3" tabindex="-1"></a>  <span class="co"># retrieve individual method results</span></span>
<span id="cb16-4"><a href="getting-started.html#cb16-4" tabindex="-1"></a>  smd_trimming <span class="ot">&lt;-</span> <span class="fu">get</span>(<span class="fu">paste0</span>(<span class="st">&quot;smd_trim.&quot;</span>, data_lower))</span>
<span id="cb16-5"><a href="getting-started.html#cb16-5" tabindex="-1"></a>  ovl_trimming <span class="ot">&lt;-</span> <span class="fu">get</span>(<span class="fu">paste0</span>(<span class="st">&quot;ovl_trim.&quot;</span>, data_lower))</span>
<span id="cb16-6"><a href="getting-started.html#cb16-6" tabindex="-1"></a>  smd_trim_match_combined <span class="ot">&lt;-</span> <span class="fu">get</span>(<span class="fu">paste0</span>(<span class="st">&quot;smd_trim_match_comb.&quot;</span>, data_lower))</span>
<span id="cb16-7"><a href="getting-started.html#cb16-7" tabindex="-1"></a>  ovl_trim_match_combined <span class="ot">&lt;-</span> <span class="fu">get</span>(<span class="fu">paste0</span>(<span class="st">&quot;ovl_trim_match_comb.&quot;</span>, data_lower))</span>
<span id="cb16-8"><a href="getting-started.html#cb16-8" tabindex="-1"></a>  format_smd_results <span class="ot">&lt;-</span> <span class="cf">function</span>(df) {</span>
<span id="cb16-9"><a href="getting-started.html#cb16-9" tabindex="-1"></a>    <span class="cf">if</span> (<span class="fu">is.null</span>(df) <span class="sc">||</span> <span class="sc">!</span><span class="fu">nrow</span>(df)) {</span>
<span id="cb16-10"><a href="getting-started.html#cb16-10" tabindex="-1"></a>      <span class="fu">return</span>(<span class="fu">data.frame</span>(<span class="at">Method =</span> <span class="fu">character</span>(<span class="dv">0</span>), <span class="at">Mean_Abs_SMD =</span> <span class="fu">numeric</span>(<span class="dv">0</span>), <span class="at">Max_Abs_SMD =</span> <span class="fu">numeric</span>(<span class="dv">0</span>)))</span>
<span id="cb16-11"><a href="getting-started.html#cb16-11" tabindex="-1"></a>    }</span>
<span id="cb16-12"><a href="getting-started.html#cb16-12" tabindex="-1"></a>    out <span class="ot">&lt;-</span> df</span>
<span id="cb16-13"><a href="getting-started.html#cb16-13" tabindex="-1"></a>    <span class="cf">if</span> (<span class="st">&quot;MatchIndex&quot;</span> <span class="sc">%in%</span> <span class="fu">names</span>(out)) {</span>
<span id="cb16-14"><a href="getting-started.html#cb16-14" tabindex="-1"></a>      out<span class="sc">$</span>Method <span class="ot">&lt;-</span> <span class="fu">paste</span>(out<span class="sc">$</span>Method, out<span class="sc">$</span>MatchIndex, <span class="at">sep =</span> <span class="st">&quot;_&quot;</span>)</span>
<span id="cb16-15"><a href="getting-started.html#cb16-15" tabindex="-1"></a>      out<span class="sc">$</span>MatchIndex <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb16-16"><a href="getting-started.html#cb16-16" tabindex="-1"></a>    }</span>
<span id="cb16-17"><a href="getting-started.html#cb16-17" tabindex="-1"></a>    out[, <span class="fu">c</span>(<span class="st">&quot;Method&quot;</span>, <span class="st">&quot;Mean_Abs_SMD&quot;</span>, <span class="st">&quot;Max_Abs_SMD&quot;</span>), drop <span class="ot">=</span> <span class="cn">FALSE</span>]</span>
<span id="cb16-18"><a href="getting-started.html#cb16-18" tabindex="-1"></a>  }</span>
<span id="cb16-19"><a href="getting-started.html#cb16-19" tabindex="-1"></a>  format_ovl_results <span class="ot">&lt;-</span> <span class="cf">function</span>(df) {</span>
<span id="cb16-20"><a href="getting-started.html#cb16-20" tabindex="-1"></a>    <span class="cf">if</span> (<span class="fu">is.null</span>(df) <span class="sc">||</span> <span class="sc">!</span><span class="fu">nrow</span>(df)) {</span>
<span id="cb16-21"><a href="getting-started.html#cb16-21" tabindex="-1"></a>      <span class="fu">return</span>(<span class="fu">data.frame</span>(<span class="at">Method =</span> <span class="fu">character</span>(<span class="dv">0</span>), <span class="at">OVL =</span> <span class="fu">numeric</span>(<span class="dv">0</span>)))</span>
<span id="cb16-22"><a href="getting-started.html#cb16-22" tabindex="-1"></a>    }</span>
<span id="cb16-23"><a href="getting-started.html#cb16-23" tabindex="-1"></a>    df[, <span class="fu">c</span>(<span class="st">&quot;Method&quot;</span>, <span class="st">&quot;OVL&quot;</span>), drop <span class="ot">=</span> <span class="cn">FALSE</span>]</span>
<span id="cb16-24"><a href="getting-started.html#cb16-24" tabindex="-1"></a>  }</span>
<span id="cb16-25"><a href="getting-started.html#cb16-25" tabindex="-1"></a>  smd_all <span class="ot">&lt;-</span> dplyr<span class="sc">::</span><span class="fu">bind_rows</span>(</span>
<span id="cb16-26"><a href="getting-started.html#cb16-26" tabindex="-1"></a>    <span class="fu">format_smd_results</span>(smd_trimming),</span>
<span id="cb16-27"><a href="getting-started.html#cb16-27" tabindex="-1"></a>    <span class="fu">format_smd_results</span>(smd_trim_match_combined)</span>
<span id="cb16-28"><a href="getting-started.html#cb16-28" tabindex="-1"></a>  )</span>
<span id="cb16-29"><a href="getting-started.html#cb16-29" tabindex="-1"></a>  ovl_all <span class="ot">&lt;-</span> dplyr<span class="sc">::</span><span class="fu">bind_rows</span>(</span>
<span id="cb16-30"><a href="getting-started.html#cb16-30" tabindex="-1"></a>    <span class="fu">format_ovl_results</span>(ovl_trimming),</span>
<span id="cb16-31"><a href="getting-started.html#cb16-31" tabindex="-1"></a>    <span class="fu">format_ovl_results</span>(ovl_trim_match_combined)</span>
<span id="cb16-32"><a href="getting-started.html#cb16-32" tabindex="-1"></a>  )</span>
<span id="cb16-33"><a href="getting-started.html#cb16-33" tabindex="-1"></a>  <span class="co"># merge absolute SMD and OVL results by method</span></span>
<span id="cb16-34"><a href="getting-started.html#cb16-34" tabindex="-1"></a>  final_df <span class="ot">&lt;-</span> dplyr<span class="sc">::</span><span class="fu">full_join</span>(smd_all, ovl_all, <span class="at">by =</span> <span class="st">&quot;Method&quot;</span>)</span>
<span id="cb16-35"><a href="getting-started.html#cb16-35" tabindex="-1"></a>  <span class="cf">if</span> (<span class="sc">!</span><span class="fu">nrow</span>(final_df)) {</span>
<span id="cb16-36"><a href="getting-started.html#cb16-36" tabindex="-1"></a>    <span class="fu">return</span>(final_df)</span>
<span id="cb16-37"><a href="getting-started.html#cb16-37" tabindex="-1"></a>  }</span>
<span id="cb16-38"><a href="getting-started.html#cb16-38" tabindex="-1"></a>  final_df<span class="sc">$</span>Method <span class="ot">&lt;-</span> <span class="fu">as.character</span>(final_df<span class="sc">$</span>Method)</span>
<span id="cb16-39"><a href="getting-started.html#cb16-39" tabindex="-1"></a>  <span class="co"># remove sample suffixes for clean labels</span></span>
<span id="cb16-40"><a href="getting-started.html#cb16-40" tabindex="-1"></a>  final_df<span class="sc">$</span>Method <span class="ot">&lt;-</span> <span class="fu">gsub</span>(<span class="st">&quot;</span><span class="sc">\\</span><span class="st">.psid&quot;</span>, <span class="st">&quot;&quot;</span>, final_df<span class="sc">$</span>Method, <span class="at">ignore.case =</span> <span class="cn">TRUE</span>)</span>
<span id="cb16-41"><a href="getting-started.html#cb16-41" tabindex="-1"></a>  final_df<span class="sc">$</span>Method <span class="ot">&lt;-</span> <span class="fu">gsub</span>(<span class="st">&quot;</span><span class="sc">\\</span><span class="st">.cps&quot;</span>, <span class="st">&quot;&quot;</span>, final_df<span class="sc">$</span>Method, <span class="at">ignore.case =</span> <span class="cn">TRUE</span>)</span>
<span id="cb16-42"><a href="getting-started.html#cb16-42" tabindex="-1"></a>  <span class="co"># reset row names</span></span>
<span id="cb16-43"><a href="getting-started.html#cb16-43" tabindex="-1"></a>  <span class="fu">rownames</span>(final_df) <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb16-44"><a href="getting-started.html#cb16-44" tabindex="-1"></a>  <span class="fu">return</span>(final_df)</span>
<span id="cb16-45"><a href="getting-started.html#cb16-45" tabindex="-1"></a>}</span></code></pre></div>
<p><strong>Arguments</strong></p>
<ul>
<li><code>data</code>: The sample name for which to combine ASMD and OVL summaries.</li>
</ul>
<p><code>save_csv()</code> saves the tables into a CSV file.</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb17-1"><a href="getting-started.html#cb17-1" tabindex="-1"></a>save_csv <span class="ot">&lt;-</span> <span class="cf">function</span>(data, filename) {</span>
<span id="cb17-2"><a href="getting-started.html#cb17-2" tabindex="-1"></a>  folder <span class="ot">&lt;-</span> <span class="st">&quot;tables&quot;</span></span>
<span id="cb17-3"><a href="getting-started.html#cb17-3" tabindex="-1"></a>  <span class="cf">if</span> (<span class="sc">!</span><span class="fu">dir.exists</span>(folder)) <span class="fu">dir.create</span>(folder, <span class="at">recursive =</span> <span class="cn">TRUE</span>)</span>
<span id="cb17-4"><a href="getting-started.html#cb17-4" tabindex="-1"></a>  file_csv <span class="ot">&lt;-</span> <span class="fu">file.path</span>(folder, <span class="fu">paste0</span>(filename, <span class="st">&quot;.csv&quot;</span>))</span>
<span id="cb17-5"><a href="getting-started.html#cb17-5" tabindex="-1"></a>  <span class="fu">write.csv</span>(data, <span class="at">file =</span> file_csv, <span class="at">row.names =</span> <span class="cn">FALSE</span>)</span>
<span id="cb17-6"><a href="getting-started.html#cb17-6" tabindex="-1"></a>}</span></code></pre></div>
<p><strong>Arguments</strong></p>
<ul>
<li><code>data</code>: The data frame.</li>
<li><code>filename</code>: The name of the file that is to be saved as CSV.</li>
</ul>
<p><code>assess_methods()</code> ranks methods based on the OVL.</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb18-1"><a href="getting-started.html#cb18-1" tabindex="-1"></a>assess_methods <span class="ot">&lt;-</span> <span class="cf">function</span>(data) {</span>
<span id="cb18-2"><a href="getting-started.html#cb18-2" tabindex="-1"></a>  data <span class="sc">%&gt;%</span></span>
<span id="cb18-3"><a href="getting-started.html#cb18-3" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">select</span>(Method, OVL, Mean_Abs_SMD) <span class="sc">%&gt;%</span></span>
<span id="cb18-4"><a href="getting-started.html#cb18-4" tabindex="-1"></a>    <span class="fu">arrange</span>(<span class="fu">desc</span>(OVL))</span>
<span id="cb18-5"><a href="getting-started.html#cb18-5" tabindex="-1"></a>}</span></code></pre></div>
<p><strong>Argument</strong></p>
<ul>
<li><code>data</code>: A data frame containing method performance metrics.</li>
</ul>
<p><code>get_top_methods()</code> retrieves the top-performing methods based on the OVL.</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb19-1"><a href="getting-started.html#cb19-1" tabindex="-1"></a>get_top_methods <span class="ot">&lt;-</span> <span class="cf">function</span>(data, <span class="at">top_n =</span> <span class="dv">5</span>, <span class="at">score_col =</span> <span class="cn">NULL</span>) {</span>
<span id="cb19-2"><a href="getting-started.html#cb19-2" tabindex="-1"></a>  <span class="cf">if</span> (<span class="sc">!</span><span class="st">&quot;Method&quot;</span> <span class="sc">%in%</span> <span class="fu">names</span>(data)) {</span>
<span id="cb19-3"><a href="getting-started.html#cb19-3" tabindex="-1"></a>    <span class="fu">stop</span>(<span class="st">&quot;Data frame must contain column &#39;Method&#39;&quot;</span>)</span>
<span id="cb19-4"><a href="getting-started.html#cb19-4" tabindex="-1"></a>  }</span>
<span id="cb19-5"><a href="getting-started.html#cb19-5" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">is.null</span>(score_col)) {</span>
<span id="cb19-6"><a href="getting-started.html#cb19-6" tabindex="-1"></a>    <span class="cf">if</span> (<span class="st">&quot;Score&quot;</span> <span class="sc">%in%</span> <span class="fu">names</span>(data)) {</span>
<span id="cb19-7"><a href="getting-started.html#cb19-7" tabindex="-1"></a>      score_col <span class="ot">&lt;-</span> <span class="st">&quot;Score&quot;</span></span>
<span id="cb19-8"><a href="getting-started.html#cb19-8" tabindex="-1"></a>    } <span class="cf">else</span> <span class="cf">if</span> (<span class="st">&quot;OVL&quot;</span> <span class="sc">%in%</span> <span class="fu">names</span>(data)) {</span>
<span id="cb19-9"><a href="getting-started.html#cb19-9" tabindex="-1"></a>      score_col <span class="ot">&lt;-</span> <span class="st">&quot;OVL&quot;</span></span>
<span id="cb19-10"><a href="getting-started.html#cb19-10" tabindex="-1"></a>    } <span class="cf">else</span> {</span>
<span id="cb19-11"><a href="getting-started.html#cb19-11" tabindex="-1"></a>      <span class="fu">stop</span>(<span class="st">&quot;Data frame must contain a scoring column (&#39;Score&#39; or &#39;OVL&#39;), or specify &#39;score_col&#39;&quot;</span>)</span>
<span id="cb19-12"><a href="getting-started.html#cb19-12" tabindex="-1"></a>    }</span>
<span id="cb19-13"><a href="getting-started.html#cb19-13" tabindex="-1"></a>  }</span>
<span id="cb19-14"><a href="getting-started.html#cb19-14" tabindex="-1"></a>  <span class="cf">if</span> (<span class="sc">!</span>score_col <span class="sc">%in%</span> <span class="fu">names</span>(data)) {</span>
<span id="cb19-15"><a href="getting-started.html#cb19-15" tabindex="-1"></a>    <span class="fu">stop</span>(<span class="fu">sprintf</span>(<span class="st">&quot;Column &#39;%s&#39; not found in data&quot;</span>, score_col))</span>
<span id="cb19-16"><a href="getting-started.html#cb19-16" tabindex="-1"></a>  }</span>
<span id="cb19-17"><a href="getting-started.html#cb19-17" tabindex="-1"></a>  data <span class="sc">%&gt;%</span></span>
<span id="cb19-18"><a href="getting-started.html#cb19-18" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(.data[[score_col]])) <span class="sc">%&gt;%</span></span>
<span id="cb19-19"><a href="getting-started.html#cb19-19" tabindex="-1"></a>    <span class="fu">arrange</span>(dplyr<span class="sc">::</span><span class="fu">desc</span>(.data[[score_col]])) <span class="sc">%&gt;%</span></span>
<span id="cb19-20"><a href="getting-started.html#cb19-20" tabindex="-1"></a>    <span class="fu">head</span>(top_n) <span class="sc">%&gt;%</span></span>
<span id="cb19-21"><a href="getting-started.html#cb19-21" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">pull</span>(Method)</span>
<span id="cb19-22"><a href="getting-started.html#cb19-22" tabindex="-1"></a>}</span></code></pre></div>
<p><strong>Arguments</strong></p>
<ul>
<li><code>data</code>: A data frame including columns used for ranking.</li>
<li><code>top_n</code>: Integer specifying the number of top-performing methods to return (default 5).</li>
<li><code>score_col</code>: The name of the column to use for ranking methods.</li>
</ul>
<p><code>wrap_match_entries()</code></p>
<div class="sourceCode" id="cb20"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb20-1"><a href="getting-started.html#cb20-1" tabindex="-1"></a>wrap_match_entries <span class="ot">&lt;-</span> <span class="cf">function</span>(match_list, source_list, prefix) {</span>
<span id="cb20-2"><a href="getting-started.html#cb20-2" tabindex="-1"></a>  <span class="cf">if</span> (<span class="sc">!</span><span class="fu">is.list</span>(match_list)) {</span>
<span id="cb20-3"><a href="getting-started.html#cb20-3" tabindex="-1"></a>    <span class="fu">return</span>(<span class="fu">list</span>())</span>
<span id="cb20-4"><a href="getting-started.html#cb20-4" tabindex="-1"></a>  }</span>
<span id="cb20-5"><a href="getting-started.html#cb20-5" tabindex="-1"></a>  max_idx <span class="ot">&lt;-</span> <span class="fu">min</span>(<span class="fu">length</span>(match_list), <span class="fu">length</span>(source_list))</span>
<span id="cb20-6"><a href="getting-started.html#cb20-6" tabindex="-1"></a>  source_labels <span class="ot">&lt;-</span> <span class="cf">if</span> (<span class="fu">length</span>(<span class="fu">names</span>(source_list))) <span class="fu">names</span>(source_list) <span class="cf">else</span> <span class="fu">seq_len</span>(max_idx)</span>
<span id="cb20-7"><a href="getting-started.html#cb20-7" tabindex="-1"></a>  entries <span class="ot">&lt;-</span> <span class="fu">vector</span>(<span class="st">&quot;list&quot;</span>, max_idx)</span>
<span id="cb20-8"><a href="getting-started.html#cb20-8" tabindex="-1"></a>  <span class="fu">names</span>(entries) <span class="ot">&lt;-</span> <span class="fu">paste0</span>(prefix, <span class="st">&quot;_&quot;</span>, source_labels[<span class="fu">seq_len</span>(max_idx)])</span>
<span id="cb20-9"><a href="getting-started.html#cb20-9" tabindex="-1"></a>  <span class="cf">for</span> (i <span class="cf">in</span> <span class="fu">seq_len</span>(max_idx)) {</span>
<span id="cb20-10"><a href="getting-started.html#cb20-10" tabindex="-1"></a>    match_obj <span class="ot">&lt;-</span> match_list[[i]]</span>
<span id="cb20-11"><a href="getting-started.html#cb20-11" tabindex="-1"></a>    <span class="cf">if</span> (<span class="fu">is.null</span>(match_obj)) {</span>
<span id="cb20-12"><a href="getting-started.html#cb20-12" tabindex="-1"></a>      <span class="cf">next</span></span>
<span id="cb20-13"><a href="getting-started.html#cb20-13" tabindex="-1"></a>    }</span>
<span id="cb20-14"><a href="getting-started.html#cb20-14" tabindex="-1"></a>    entries[[i]] <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="at">matchit =</span> match_obj, <span class="at">data =</span> source_list[[i]])</span>
<span id="cb20-15"><a href="getting-started.html#cb20-15" tabindex="-1"></a>  }</span>
<span id="cb20-16"><a href="getting-started.html#cb20-16" tabindex="-1"></a>  <span class="fu">Filter</span>(<span class="fu">Negate</span>(is.null), entries)</span>
<span id="cb20-17"><a href="getting-started.html#cb20-17" tabindex="-1"></a>}</span></code></pre></div>
<p><strong>Arguments</strong></p>
<ul>
<li><code>match_list</code>: A named list of method-specific elements, where each itself is a list of matchit objects.</li>
<li><code>source_list</code>: A list of source data frames corresponding to each match object.</li>
<li><code>prefix</code>: A string prefix for defining the names of the returned list entries.</li>
</ul>
<p><code>create_top5_samples()</code> creates samples corresponding to the top five ranked methods for further analysis or presentation.</p>
<div class="sourceCode" id="cb21"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb21-1"><a href="getting-started.html#cb21-1" tabindex="-1"></a>create_top5_samples <span class="ot">&lt;-</span> <span class="cf">function</span>(data_list, top_method_names) {</span>
<span id="cb21-2"><a href="getting-started.html#cb21-2" tabindex="-1"></a>  <span class="cf">if</span> (<span class="sc">!</span><span class="fu">is.list</span>(data_list) <span class="sc">||</span> <span class="fu">length</span>(data_list) <span class="sc">==</span> <span class="dv">0</span>) {</span>
<span id="cb21-3"><a href="getting-started.html#cb21-3" tabindex="-1"></a>    <span class="fu">stop</span>(<span class="st">&quot;create_top5_samples(): &#39;data_list&#39; must be a non-empty list&quot;</span>, <span class="at">call. =</span> <span class="cn">FALSE</span>)</span>
<span id="cb21-4"><a href="getting-started.html#cb21-4" tabindex="-1"></a>  }</span>
<span id="cb21-5"><a href="getting-started.html#cb21-5" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">length</span>(top_method_names) <span class="sc">==</span> <span class="dv">0</span>) {</span>
<span id="cb21-6"><a href="getting-started.html#cb21-6" tabindex="-1"></a>    <span class="fu">stop</span>(<span class="st">&quot;create_top5_samples(): &#39;top_method_names&#39; must contain at least one method name&quot;</span>, <span class="at">call. =</span> <span class="cn">FALSE</span>)</span>
<span id="cb21-7"><a href="getting-started.html#cb21-7" tabindex="-1"></a>  }</span>
<span id="cb21-8"><a href="getting-started.html#cb21-8" tabindex="-1"></a>  missing_methods <span class="ot">&lt;-</span> <span class="fu">setdiff</span>(top_method_names, <span class="fu">names</span>(data_list))</span>
<span id="cb21-9"><a href="getting-started.html#cb21-9" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">length</span>(missing_methods)) {</span>
<span id="cb21-10"><a href="getting-started.html#cb21-10" tabindex="-1"></a>    <span class="fu">stop</span>(<span class="fu">sprintf</span>(</span>
<span id="cb21-11"><a href="getting-started.html#cb21-11" tabindex="-1"></a>      <span class="st">&quot;create_top5_samples(): the following methods are missing from &#39;data_list&#39;: %s&quot;</span>,</span>
<span id="cb21-12"><a href="getting-started.html#cb21-12" tabindex="-1"></a>      <span class="fu">paste</span>(missing_methods, <span class="at">collapse =</span> <span class="st">&quot;, &quot;</span>)</span>
<span id="cb21-13"><a href="getting-started.html#cb21-13" tabindex="-1"></a>    ), <span class="at">call. =</span> <span class="cn">FALSE</span>)</span>
<span id="cb21-14"><a href="getting-started.html#cb21-14" tabindex="-1"></a>  }</span>
<span id="cb21-15"><a href="getting-started.html#cb21-15" tabindex="-1"></a>  out <span class="ot">&lt;-</span> <span class="fu">lapply</span>(top_method_names, <span class="cf">function</span>(method_name) {</span>
<span id="cb21-16"><a href="getting-started.html#cb21-16" tabindex="-1"></a>    ds <span class="ot">&lt;-</span> data_list[[method_name]]</span>
<span id="cb21-17"><a href="getting-started.html#cb21-17" tabindex="-1"></a>    <span class="cf">if</span> (<span class="fu">is.null</span>(ds)) {</span>
<span id="cb21-18"><a href="getting-started.html#cb21-18" tabindex="-1"></a>      <span class="fu">stop</span>(<span class="fu">sprintf</span>(<span class="st">&quot;create_top5_samples(): sample for method &#39;%s&#39; is NULL&quot;</span>, method_name), <span class="at">call. =</span> <span class="cn">FALSE</span>)</span>
<span id="cb21-19"><a href="getting-started.html#cb21-19" tabindex="-1"></a>    }</span>
<span id="cb21-20"><a href="getting-started.html#cb21-20" tabindex="-1"></a>    <span class="cf">if</span> (<span class="fu">inherits</span>(ds, <span class="st">&quot;matchit&quot;</span>)) {</span>
<span id="cb21-21"><a href="getting-started.html#cb21-21" tabindex="-1"></a>      source_data <span class="ot">&lt;-</span> <span class="fu">attr</span>(ds, <span class="st">&quot;match_source&quot;</span>)</span>
<span id="cb21-22"><a href="getting-started.html#cb21-22" tabindex="-1"></a>      <span class="cf">if</span> (<span class="fu">is.null</span>(source_data)) {</span>
<span id="cb21-23"><a href="getting-started.html#cb21-23" tabindex="-1"></a>        <span class="fu">stop</span>(<span class="fu">sprintf</span>(</span>
<span id="cb21-24"><a href="getting-started.html#cb21-24" tabindex="-1"></a>          <span class="st">&quot;create_top5_samples(): matchit object &#39;%s&#39; is missing source data. Regenerate it with attach_matchit() so &#39;match_source&#39; attribute is available or provide a data.frame entry instead.&quot;</span>,</span>
<span id="cb21-25"><a href="getting-started.html#cb21-25" tabindex="-1"></a>          method_name</span>
<span id="cb21-26"><a href="getting-started.html#cb21-26" tabindex="-1"></a>        ), <span class="at">call. =</span> <span class="cn">FALSE</span>)</span>
<span id="cb21-27"><a href="getting-started.html#cb21-27" tabindex="-1"></a>      }</span>
<span id="cb21-28"><a href="getting-started.html#cb21-28" tabindex="-1"></a>      <span class="fu">return</span>(<span class="fu">as.data.frame</span>(<span class="fu">match.data</span>(ds, <span class="at">data =</span> source_data)))</span>
<span id="cb21-29"><a href="getting-started.html#cb21-29" tabindex="-1"></a>    }</span>
<span id="cb21-30"><a href="getting-started.html#cb21-30" tabindex="-1"></a>    <span class="cf">if</span> (<span class="fu">is.list</span>(ds) <span class="sc">&amp;&amp;</span> <span class="fu">inherits</span>(ds<span class="sc">$</span>matchit, <span class="st">&quot;matchit&quot;</span>) <span class="sc">&amp;&amp;</span> <span class="fu">is.data.frame</span>(ds<span class="sc">$</span>data)) {</span>
<span id="cb21-31"><a href="getting-started.html#cb21-31" tabindex="-1"></a>      <span class="fu">return</span>(<span class="fu">as.data.frame</span>(<span class="fu">match.data</span>(ds<span class="sc">$</span>matchit, <span class="at">data =</span> ds<span class="sc">$</span>data)))</span>
<span id="cb21-32"><a href="getting-started.html#cb21-32" tabindex="-1"></a>    }</span>
<span id="cb21-33"><a href="getting-started.html#cb21-33" tabindex="-1"></a>    <span class="cf">if</span> (<span class="fu">is.data.frame</span>(ds)) {</span>
<span id="cb21-34"><a href="getting-started.html#cb21-34" tabindex="-1"></a>      <span class="fu">return</span>(ds)</span>
<span id="cb21-35"><a href="getting-started.html#cb21-35" tabindex="-1"></a>    }</span>
<span id="cb21-36"><a href="getting-started.html#cb21-36" tabindex="-1"></a>    <span class="fu">stop</span>(<span class="fu">sprintf</span>(<span class="st">&quot;create_top5_samples(): unsupported entry type for method &#39;%s&#39;&quot;</span>, method_name), <span class="at">call. =</span> <span class="cn">FALSE</span>)</span>
<span id="cb21-37"><a href="getting-started.html#cb21-37" tabindex="-1"></a>  })</span>
<span id="cb21-38"><a href="getting-started.html#cb21-38" tabindex="-1"></a>  <span class="fu">names</span>(out) <span class="ot">&lt;-</span> top_method_names</span>
<span id="cb21-39"><a href="getting-started.html#cb21-39" tabindex="-1"></a>  out</span>
<span id="cb21-40"><a href="getting-started.html#cb21-40" tabindex="-1"></a>}  </span></code></pre></div>
<p><strong>Arguments</strong></p>
<ul>
<li><code>data_list</code>: A list of samples or MatchIt objects containing processed results for different methods.</li>
<li><code>top_method_names</code>: A character vector of method names corresponding to the top-ranked samples.</li>
</ul>
<p><code>save_top5_samples()</code> saves samples of the top five methods as individual files for reproducibility or sharing.</p>
<div class="sourceCode" id="cb22"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb22-1"><a href="getting-started.html#cb22-1" tabindex="-1"></a>save_top5_samples <span class="ot">&lt;-</span> <span class="cf">function</span>(combined_methods_list, top_method_names, prefix) {</span>
<span id="cb22-2"><a href="getting-started.html#cb22-2" tabindex="-1"></a>  <span class="fu">dir.create</span>(<span class="st">&quot;tutorial/data&quot;</span>, <span class="at">showWarnings =</span> <span class="cn">FALSE</span>, <span class="at">recursive =</span> <span class="cn">TRUE</span>)</span>
<span id="cb22-3"><a href="getting-started.html#cb22-3" tabindex="-1"></a>  <span class="cf">for</span> (i <span class="cf">in</span> <span class="fu">seq_along</span>(top_method_names)) {</span>
<span id="cb22-4"><a href="getting-started.html#cb22-4" tabindex="-1"></a>    method_name <span class="ot">&lt;-</span> top_method_names[i]</span>
<span id="cb22-5"><a href="getting-started.html#cb22-5" tabindex="-1"></a>    <span class="cf">if</span> (<span class="sc">!</span>method_name <span class="sc">%in%</span> <span class="fu">names</span>(combined_methods_list)) {</span>
<span id="cb22-6"><a href="getting-started.html#cb22-6" tabindex="-1"></a>      <span class="fu">warning</span>(<span class="fu">paste0</span>(<span class="st">&quot;Method &#39;&quot;</span>, method_name, <span class="st">&quot;&#39; not found in combined methods list&quot;</span>))</span>
<span id="cb22-7"><a href="getting-started.html#cb22-7" tabindex="-1"></a>      <span class="cf">next</span></span>
<span id="cb22-8"><a href="getting-started.html#cb22-8" tabindex="-1"></a>    }</span>
<span id="cb22-9"><a href="getting-started.html#cb22-9" tabindex="-1"></a>    sample_to_save <span class="ot">&lt;-</span> combined_methods_list[[method_name]]</span>
<span id="cb22-10"><a href="getting-started.html#cb22-10" tabindex="-1"></a>    file_name <span class="ot">&lt;-</span> <span class="fu">sprintf</span>(<span class="st">&quot;tutorial/data/top%d_%s_method_%s.RData&quot;</span>, i, prefix, method_name)</span>
<span id="cb22-11"><a href="getting-started.html#cb22-11" tabindex="-1"></a>    <span class="fu">save</span>(sample_to_save, <span class="at">file =</span> file_name)</span>
<span id="cb22-12"><a href="getting-started.html#cb22-12" tabindex="-1"></a>  }</span>
<span id="cb22-13"><a href="getting-started.html#cb22-13" tabindex="-1"></a>}</span></code></pre></div>
<p><strong>Arguments</strong></p>
<ul>
<li><code>combined_methods_list</code>: A list of all combined method results.</li>
<li><code>top_method_names</code>: A character vector of method names corresponding to the top-ranked samples.</li>
<li><code>prefix</code>: A string prefix used for saved file names to identify sample.</li>
</ul>
<p><br></p>
</div>
<div id="estimating" class="section level3 hasAnchor" number="1.2.6">
<h3><span class="header-section-number">1.2.6</span> Estimating<a href="getting-started.html#estimating" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div id="average-treatment-effect-of-the-treated-att" class="section level4 hasAnchor" number="1.2.6.1">
<h4><span class="header-section-number">1.2.6.1</span> Average treatment effect of the treated (ATT)<a href="getting-started.html#average-treatment-effect-of-the-treated-att" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p><a name="est-and-plot-att-catt-qtet"></a></p>
<p><code>estimate_all()</code>*** runs multiple treatment effect estimators on a sample and returns point estimates, standard errors and confidence intervals.</p>
<div class="sourceCode" id="cb23"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb23-1"><a href="getting-started.html#cb23-1" tabindex="-1"></a><span class="do">#### quiet()***</span></span>
<span id="cb23-2"><a href="getting-started.html#cb23-2" tabindex="-1"></a>quiet <span class="ot">&lt;-</span> <span class="cf">function</span>(x) {</span>
<span id="cb23-3"><a href="getting-started.html#cb23-3" tabindex="-1"></a>  <span class="fu">sink</span>(<span class="fu">tempfile</span>())</span>
<span id="cb23-4"><a href="getting-started.html#cb23-4" tabindex="-1"></a>  <span class="fu">on.exit</span>(<span class="fu">sink</span>())</span>
<span id="cb23-5"><a href="getting-started.html#cb23-5" tabindex="-1"></a>  <span class="fu">invisible</span>(<span class="fu">force</span>(x))</span>
<span id="cb23-6"><a href="getting-started.html#cb23-6" tabindex="-1"></a>}</span>
<span id="cb23-7"><a href="getting-started.html#cb23-7" tabindex="-1"></a></span>
<span id="cb23-8"><a href="getting-started.html#cb23-8" tabindex="-1"></a><span class="do">#### diff()***</span></span>
<span id="cb23-9"><a href="getting-started.html#cb23-9" tabindex="-1"></a>diff <span class="ot">&lt;-</span> <span class="cf">function</span>(data, Y, treat) {</span>
<span id="cb23-10"><a href="getting-started.html#cb23-10" tabindex="-1"></a>  fml <span class="ot">&lt;-</span> <span class="fu">as.formula</span>(<span class="fu">paste</span>(Y, <span class="st">&quot;~&quot;</span>, treat))</span>
<span id="cb23-11"><a href="getting-started.html#cb23-11" tabindex="-1"></a>  out <span class="ot">&lt;-</span> <span class="fu">summary</span>(<span class="fu">lm_robust</span>(fml, <span class="at">data =</span> data, <span class="at">se_type =</span> <span class="st">&quot;stata&quot;</span>))<span class="sc">$</span>coefficients[treat, <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">5</span>, <span class="dv">6</span>)]</span>
<span id="cb23-12"><a href="getting-started.html#cb23-12" tabindex="-1"></a>  <span class="fu">return</span>(out) <span class="co"># extract coef, se, ci.lower, ci.upper</span></span>
<span id="cb23-13"><a href="getting-started.html#cb23-13" tabindex="-1"></a>}</span>
<span id="cb23-14"><a href="getting-started.html#cb23-14" tabindex="-1"></a></span>
<span id="cb23-15"><a href="getting-started.html#cb23-15" tabindex="-1"></a><span class="do">#### reg()***</span></span>
<span id="cb23-16"><a href="getting-started.html#cb23-16" tabindex="-1"></a>reg <span class="ot">&lt;-</span> <span class="cf">function</span>(data, Y, treat, covar) {</span>
<span id="cb23-17"><a href="getting-started.html#cb23-17" tabindex="-1"></a>  fml <span class="ot">&lt;-</span> <span class="fu">as.formula</span>(<span class="fu">paste</span>(Y, <span class="st">&quot;~&quot;</span>, treat, <span class="st">&quot;+&quot;</span>, <span class="fu">paste</span>(covar, <span class="at">collapse =</span> <span class="st">&quot; + &quot;</span>)))</span>
<span id="cb23-18"><a href="getting-started.html#cb23-18" tabindex="-1"></a>  out <span class="ot">&lt;-</span> <span class="fu">summary</span>(<span class="fu">lm_robust</span>(fml, <span class="at">data =</span> data, <span class="at">se_type =</span> <span class="st">&quot;stata&quot;</span>))<span class="sc">$</span>coefficients[treat, <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">5</span>, <span class="dv">6</span>)]</span>
<span id="cb23-19"><a href="getting-started.html#cb23-19" tabindex="-1"></a>  <span class="co"># extract coef, se, ci.lower, ci.upper</span></span>
<span id="cb23-20"><a href="getting-started.html#cb23-20" tabindex="-1"></a>  <span class="fu">return</span>(out)</span>
<span id="cb23-21"><a href="getting-started.html#cb23-21" tabindex="-1"></a>}</span>
<span id="cb23-22"><a href="getting-started.html#cb23-22" tabindex="-1"></a></span>
<span id="cb23-23"><a href="getting-started.html#cb23-23" tabindex="-1"></a><span class="co"># library(Matching)</span></span>
<span id="cb23-24"><a href="getting-started.html#cb23-24" tabindex="-1"></a><span class="do">#### matching()***</span></span>
<span id="cb23-25"><a href="getting-started.html#cb23-25" tabindex="-1"></a>matching <span class="ot">&lt;-</span> <span class="cf">function</span>(data, Y, treat, covar) {</span>
<span id="cb23-26"><a href="getting-started.html#cb23-26" tabindex="-1"></a>  <span class="fu">tryCatch</span>({</span>
<span id="cb23-27"><a href="getting-started.html#cb23-27" tabindex="-1"></a>    m.out <span class="ot">&lt;-</span> <span class="fu">Match</span>(<span class="at">Y =</span> data[, Y], <span class="at">Tr =</span> data[, treat], <span class="at">X =</span> data[, covar], <span class="at">Z =</span> data[, covar],</span>
<span id="cb23-28"><a href="getting-started.html#cb23-28" tabindex="-1"></a>                   <span class="at">estimand =</span> <span class="st">&quot;ATT&quot;</span>, <span class="at">M =</span> <span class="dv">5</span>, <span class="at">replace =</span> <span class="cn">TRUE</span>, <span class="at">ties =</span> <span class="cn">TRUE</span>, <span class="at">BiasAdjust =</span> <span class="cn">TRUE</span>)</span>
<span id="cb23-29"><a href="getting-started.html#cb23-29" tabindex="-1"></a>    out <span class="ot">&lt;-</span> <span class="fu">c</span>(m.out<span class="sc">$</span>est[<span class="dv">1</span>], m.out<span class="sc">$</span>se[<span class="dv">1</span>], m.out<span class="sc">$</span>est[<span class="dv">1</span>] <span class="sc">-</span> <span class="fl">1.96</span> <span class="sc">*</span> m.out<span class="sc">$</span>se[<span class="dv">1</span>],</span>
<span id="cb23-30"><a href="getting-started.html#cb23-30" tabindex="-1"></a>             m.out<span class="sc">$</span>est[<span class="dv">1</span>] <span class="sc">+</span> <span class="fl">1.96</span> <span class="sc">*</span> m.out<span class="sc">$</span>se[<span class="dv">1</span>])</span>
<span id="cb23-31"><a href="getting-started.html#cb23-31" tabindex="-1"></a>    <span class="fu">return</span>(out)</span>
<span id="cb23-32"><a href="getting-started.html#cb23-32" tabindex="-1"></a>  }, <span class="at">error =</span> <span class="cf">function</span>(e) {</span>
<span id="cb23-33"><a href="getting-started.html#cb23-33" tabindex="-1"></a>    <span class="fu">cat</span>(<span class="st">&quot;Warning in matching method:&quot;</span>, e<span class="sc">$</span>message, <span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span>)</span>
<span id="cb23-34"><a href="getting-started.html#cb23-34" tabindex="-1"></a>    <span class="fu">return</span>(<span class="fu">c</span>(<span class="cn">NA</span>, <span class="cn">NA</span>, <span class="cn">NA</span>, <span class="cn">NA</span>))</span>
<span id="cb23-35"><a href="getting-started.html#cb23-35" tabindex="-1"></a>  })</span>
<span id="cb23-36"><a href="getting-started.html#cb23-36" tabindex="-1"></a>}</span>
<span id="cb23-37"><a href="getting-started.html#cb23-37" tabindex="-1"></a></span>
<span id="cb23-38"><a href="getting-started.html#cb23-38" tabindex="-1"></a><span class="do">#### psm()***</span></span>
<span id="cb23-39"><a href="getting-started.html#cb23-39" tabindex="-1"></a>psm <span class="ot">&lt;-</span> <span class="cf">function</span>(data, Y, treat, covar) {</span>
<span id="cb23-40"><a href="getting-started.html#cb23-40" tabindex="-1"></a>  ps <span class="ot">&lt;-</span> <span class="fu">probability_forest</span>(<span class="at">X =</span> data[, covar],</span>
<span id="cb23-41"><a href="getting-started.html#cb23-41" tabindex="-1"></a>                           <span class="at">Y =</span> <span class="fu">as.factor</span>(data[,treat]), <span class="at">seed =</span> <span class="dv">42</span>, <span class="at">num.trees =</span> <span class="dv">4000</span>)<span class="sc">$</span>predictions[,<span class="dv">2</span>]</span>
<span id="cb23-42"><a href="getting-started.html#cb23-42" tabindex="-1"></a>  m.out <span class="ot">&lt;-</span> <span class="fu">Match</span>(<span class="at">Y =</span> data[, Y], <span class="at">Tr =</span> data[, treat], <span class="at">X =</span> <span class="fu">matrix</span>(ps, <span class="fu">nrow</span>(data), <span class="dv">1</span>),</span>
<span id="cb23-43"><a href="getting-started.html#cb23-43" tabindex="-1"></a>                 <span class="at">estimand =</span> <span class="st">&quot;ATT&quot;</span>, <span class="at">M =</span> <span class="dv">5</span>, <span class="at">replace =</span> <span class="cn">TRUE</span>, <span class="at">ties =</span> <span class="cn">FALSE</span>, <span class="at">BiasAdjust =</span> <span class="cn">FALSE</span>)</span>
<span id="cb23-44"><a href="getting-started.html#cb23-44" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">is.null</span>(m.out<span class="sc">$</span>se)<span class="sc">==</span><span class="cn">FALSE</span>) {</span>
<span id="cb23-45"><a href="getting-started.html#cb23-45" tabindex="-1"></a>    se <span class="ot">&lt;-</span> m.out<span class="sc">$</span>se[<span class="dv">1</span>]</span>
<span id="cb23-46"><a href="getting-started.html#cb23-46" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb23-47"><a href="getting-started.html#cb23-47" tabindex="-1"></a>    se <span class="ot">&lt;-</span> m.out<span class="sc">$</span>se.standard[<span class="dv">1</span>]</span>
<span id="cb23-48"><a href="getting-started.html#cb23-48" tabindex="-1"></a>  }</span>
<span id="cb23-49"><a href="getting-started.html#cb23-49" tabindex="-1"></a>  out <span class="ot">&lt;-</span> <span class="fu">c</span>(m.out<span class="sc">$</span>est[<span class="dv">1</span>], se, m.out<span class="sc">$</span>est[<span class="dv">1</span>] <span class="sc">-</span> <span class="fl">1.96</span> <span class="sc">*</span> se,</span>
<span id="cb23-50"><a href="getting-started.html#cb23-50" tabindex="-1"></a>           m.out<span class="sc">$</span>est[<span class="dv">1</span>] <span class="sc">+</span> <span class="fl">1.96</span> <span class="sc">*</span> se)</span>
<span id="cb23-51"><a href="getting-started.html#cb23-51" tabindex="-1"></a>  <span class="fu">return</span>(out)</span>
<span id="cb23-52"><a href="getting-started.html#cb23-52" tabindex="-1"></a>}</span>
<span id="cb23-53"><a href="getting-started.html#cb23-53" tabindex="-1"></a></span>
<span id="cb23-54"><a href="getting-started.html#cb23-54" tabindex="-1"></a><span class="do">#### om.reg()***</span></span>
<span id="cb23-55"><a href="getting-started.html#cb23-55" tabindex="-1"></a>om.reg <span class="ot">&lt;-</span> <span class="cf">function</span>(data, Y, treat, covar) {</span>
<span id="cb23-56"><a href="getting-started.html#cb23-56" tabindex="-1"></a>  tr <span class="ot">&lt;-</span> <span class="fu">which</span>(data[, treat] <span class="sc">==</span> <span class="dv">1</span>)</span>
<span id="cb23-57"><a href="getting-started.html#cb23-57" tabindex="-1"></a>  co <span class="ot">&lt;-</span> <span class="fu">which</span>(data[, treat] <span class="sc">==</span> <span class="dv">0</span>)</span>
<span id="cb23-58"><a href="getting-started.html#cb23-58" tabindex="-1"></a>  fml <span class="ot">&lt;-</span> <span class="fu">as.formula</span>(<span class="fu">paste</span>(Y, <span class="st">&quot;~&quot;</span>, <span class="fu">paste</span>(covar, <span class="at">collapse =</span> <span class="st">&quot; + &quot;</span>)))</span>
<span id="cb23-59"><a href="getting-started.html#cb23-59" tabindex="-1"></a>  out.co <span class="ot">&lt;-</span> <span class="fu">lm</span>(fml, <span class="at">data =</span> data[co, ])</span>
<span id="cb23-60"><a href="getting-started.html#cb23-60" tabindex="-1"></a>  Y.tr.hat <span class="ot">&lt;-</span> <span class="fu">predict</span>(out.co, <span class="at">newdata =</span> data[tr, covar, <span class="at">drop =</span> <span class="cn">FALSE</span>])</span>
<span id="cb23-61"><a href="getting-started.html#cb23-61" tabindex="-1"></a>  newdata <span class="ot">&lt;-</span> <span class="fu">cbind.data.frame</span>(<span class="at">Y =</span> <span class="fu">c</span>(data[tr, Y], Y.tr.hat), <span class="at">treat =</span> <span class="fu">rep</span>(<span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">0</span>), <span class="at">each =</span> <span class="fu">length</span>(tr)))</span>
<span id="cb23-62"><a href="getting-started.html#cb23-62" tabindex="-1"></a>  out <span class="ot">&lt;-</span> <span class="fu">summary</span>(<span class="fu">lm_robust</span>(Y <span class="sc">~</span> treat, <span class="at">data =</span> newdata, <span class="at">se_type =</span> <span class="st">&quot;stata&quot;</span>))<span class="sc">$</span>coefficients[<span class="st">&quot;treat&quot;</span>, <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">5</span>, <span class="dv">6</span>)]</span>
<span id="cb23-63"><a href="getting-started.html#cb23-63" tabindex="-1"></a>  <span class="fu">return</span>(out)</span>
<span id="cb23-64"><a href="getting-started.html#cb23-64" tabindex="-1"></a>}</span>
<span id="cb23-65"><a href="getting-started.html#cb23-65" tabindex="-1"></a></span>
<span id="cb23-66"><a href="getting-started.html#cb23-66" tabindex="-1"></a><span class="co"># library(grf)</span></span>
<span id="cb23-67"><a href="getting-started.html#cb23-67" tabindex="-1"></a><span class="do">#### om.grf()***</span></span>
<span id="cb23-68"><a href="getting-started.html#cb23-68" tabindex="-1"></a>om.grf <span class="ot">&lt;-</span> <span class="cf">function</span>(data, Y, treat, covar) {</span>
<span id="cb23-69"><a href="getting-started.html#cb23-69" tabindex="-1"></a>  tr <span class="ot">&lt;-</span> <span class="fu">which</span>(data[, treat] <span class="sc">==</span> <span class="dv">1</span>)</span>
<span id="cb23-70"><a href="getting-started.html#cb23-70" tabindex="-1"></a>  co <span class="ot">&lt;-</span> <span class="fu">which</span>(data[, treat] <span class="sc">==</span> <span class="dv">0</span>)</span>
<span id="cb23-71"><a href="getting-started.html#cb23-71" tabindex="-1"></a>  out.co <span class="ot">&lt;-</span> <span class="fu">regression_forest</span>(<span class="at">X =</span> data[co, covar, <span class="at">drop =</span> <span class="cn">FALSE</span>], <span class="at">Y =</span> <span class="fu">as.vector</span>(data[co, Y]) )</span>
<span id="cb23-72"><a href="getting-started.html#cb23-72" tabindex="-1"></a>  Y.tr.hat <span class="ot">&lt;-</span> <span class="fu">as.vector</span>(<span class="fu">unlist</span>(<span class="fu">predict</span>(out.co, <span class="at">newdata =</span> data[tr, covar, <span class="at">drop =</span> <span class="cn">FALSE</span>])))</span>
<span id="cb23-73"><a href="getting-started.html#cb23-73" tabindex="-1"></a>  newdata <span class="ot">&lt;-</span> <span class="fu">cbind.data.frame</span>(<span class="at">Y =</span> <span class="fu">c</span>(data[tr, Y], Y.tr.hat), <span class="at">treat =</span> <span class="fu">rep</span>(<span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">0</span>), <span class="at">each =</span> <span class="fu">length</span>(tr)))</span>
<span id="cb23-74"><a href="getting-started.html#cb23-74" tabindex="-1"></a>  out <span class="ot">&lt;-</span> <span class="fu">summary</span>(<span class="fu">lm_robust</span>(Y <span class="sc">~</span> treat, <span class="at">data =</span> newdata, <span class="at">se_type =</span> <span class="st">&quot;stata&quot;</span>))<span class="sc">$</span>coefficients[<span class="st">&quot;treat&quot;</span>, <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">5</span>, <span class="dv">6</span>)]</span>
<span id="cb23-75"><a href="getting-started.html#cb23-75" tabindex="-1"></a>  <span class="fu">return</span>(out)</span>
<span id="cb23-76"><a href="getting-started.html#cb23-76" tabindex="-1"></a>}</span>
<span id="cb23-77"><a href="getting-started.html#cb23-77" tabindex="-1"></a></span>
<span id="cb23-78"><a href="getting-started.html#cb23-78" tabindex="-1"></a><span class="do">#### ipw()***</span></span>
<span id="cb23-79"><a href="getting-started.html#cb23-79" tabindex="-1"></a>ipw <span class="ot">&lt;-</span> <span class="cf">function</span>(data, Y, treat, covar) {</span>
<span id="cb23-80"><a href="getting-started.html#cb23-80" tabindex="-1"></a>  ps <span class="ot">&lt;-</span> <span class="fu">probability_forest</span>(<span class="at">X =</span> data[, covar, <span class="at">drop =</span> <span class="cn">FALSE</span>], <span class="at">Y =</span> <span class="fu">as.factor</span>(data[, treat]), <span class="at">seed =</span> <span class="dv">42</span>)<span class="sc">$</span>predictions[,<span class="dv">2</span>]</span>
<span id="cb23-81"><a href="getting-started.html#cb23-81" tabindex="-1"></a>  fml <span class="ot">&lt;-</span> <span class="fu">as.formula</span>(<span class="fu">paste</span>(Y, <span class="st">&quot;~&quot;</span>, treat))</span>
<span id="cb23-82"><a href="getting-started.html#cb23-82" tabindex="-1"></a>  weights <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="dv">1</span>, <span class="fu">nrow</span>(data))</span>
<span id="cb23-83"><a href="getting-started.html#cb23-83" tabindex="-1"></a>  co <span class="ot">&lt;-</span> <span class="fu">which</span>(data[, treat] <span class="sc">==</span> <span class="dv">0</span>)</span>
<span id="cb23-84"><a href="getting-started.html#cb23-84" tabindex="-1"></a>  weights[co] <span class="ot">&lt;-</span> ps[co]<span class="sc">/</span>(<span class="dv">1</span><span class="sc">-</span>ps[co])</span>
<span id="cb23-85"><a href="getting-started.html#cb23-85" tabindex="-1"></a>  out <span class="ot">&lt;-</span> <span class="fu">summary</span>(<span class="fu">lm_robust</span>(fml, <span class="at">data =</span> data, <span class="at">weights =</span> weights, <span class="at">se_type =</span> <span class="st">&quot;stata&quot;</span>))<span class="sc">$</span>coefficients[treat, <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">5</span>, <span class="dv">6</span>)]</span>
<span id="cb23-86"><a href="getting-started.html#cb23-86" tabindex="-1"></a>  <span class="co"># extract coef, se, ci.lower, ci.upper</span></span>
<span id="cb23-87"><a href="getting-started.html#cb23-87" tabindex="-1"></a>  <span class="fu">return</span>(out)</span>
<span id="cb23-88"><a href="getting-started.html#cb23-88" tabindex="-1"></a>}</span>
<span id="cb23-89"><a href="getting-started.html#cb23-89" tabindex="-1"></a></span>
<span id="cb23-90"><a href="getting-started.html#cb23-90" tabindex="-1"></a><span class="co"># library(&quot;CBPS&quot;)</span></span>
<span id="cb23-91"><a href="getting-started.html#cb23-91" tabindex="-1"></a><span class="do">#### cbps()***</span></span>
<span id="cb23-92"><a href="getting-started.html#cb23-92" tabindex="-1"></a>cbps <span class="ot">&lt;-</span> <span class="cf">function</span>(data, Y, treat, covar) {</span>
<span id="cb23-93"><a href="getting-started.html#cb23-93" tabindex="-1"></a>  <span class="fu">tryCatch</span>({</span>
<span id="cb23-94"><a href="getting-started.html#cb23-94" tabindex="-1"></a>    fml <span class="ot">&lt;-</span> <span class="fu">as.formula</span>(<span class="fu">paste</span>(treat, <span class="st">&quot;~&quot;</span>, <span class="fu">paste</span>(covar, <span class="at">collapse =</span> <span class="st">&quot; + &quot;</span>)))</span>
<span id="cb23-95"><a href="getting-started.html#cb23-95" tabindex="-1"></a>    ps <span class="ot">&lt;-</span> <span class="fu">quiet</span>(<span class="fu">CBPS</span>(fml, <span class="at">data =</span> data, <span class="at">standardize =</span> <span class="cn">TRUE</span>)<span class="sc">$</span>fitted.values)</span>
<span id="cb23-96"><a href="getting-started.html#cb23-96" tabindex="-1"></a>    fml <span class="ot">&lt;-</span> <span class="fu">as.formula</span>(<span class="fu">paste</span>(Y, <span class="st">&quot;~&quot;</span>, treat))</span>
<span id="cb23-97"><a href="getting-started.html#cb23-97" tabindex="-1"></a>    weights <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="dv">1</span>, <span class="fu">nrow</span>(data))</span>
<span id="cb23-98"><a href="getting-started.html#cb23-98" tabindex="-1"></a>    co <span class="ot">&lt;-</span> <span class="fu">which</span>(data[, treat] <span class="sc">==</span> <span class="dv">0</span>)</span>
<span id="cb23-99"><a href="getting-started.html#cb23-99" tabindex="-1"></a>    weights[co] <span class="ot">&lt;-</span> ps[co]<span class="sc">/</span>(<span class="dv">1</span><span class="sc">-</span>ps[co])</span>
<span id="cb23-100"><a href="getting-started.html#cb23-100" tabindex="-1"></a>    out <span class="ot">&lt;-</span> <span class="fu">summary</span>(<span class="fu">lm_robust</span>(fml, <span class="at">data =</span> data, <span class="at">weights =</span> weights, <span class="at">se_type =</span> <span class="st">&quot;stata&quot;</span>))<span class="sc">$</span>coefficients[treat, <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">5</span>, <span class="dv">6</span>)]</span>
<span id="cb23-101"><a href="getting-started.html#cb23-101" tabindex="-1"></a>    <span class="fu">return</span>(out)</span>
<span id="cb23-102"><a href="getting-started.html#cb23-102" tabindex="-1"></a>  }, <span class="at">error =</span> <span class="cf">function</span>(e) {</span>
<span id="cb23-103"><a href="getting-started.html#cb23-103" tabindex="-1"></a>    <span class="fu">cat</span>(<span class="st">&quot;Warning in cbps method:&quot;</span>, e<span class="sc">$</span>message, <span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span>)</span>
<span id="cb23-104"><a href="getting-started.html#cb23-104" tabindex="-1"></a>    <span class="fu">return</span>(<span class="fu">c</span>(<span class="cn">NA</span>, <span class="cn">NA</span>, <span class="cn">NA</span>, <span class="cn">NA</span>))</span>
<span id="cb23-105"><a href="getting-started.html#cb23-105" tabindex="-1"></a>  })</span>
<span id="cb23-106"><a href="getting-started.html#cb23-106" tabindex="-1"></a>}</span>
<span id="cb23-107"><a href="getting-started.html#cb23-107" tabindex="-1"></a></span>
<span id="cb23-108"><a href="getting-started.html#cb23-108" tabindex="-1"></a><span class="co"># library(hbal)</span></span>
<span id="cb23-109"><a href="getting-started.html#cb23-109" tabindex="-1"></a><span class="do">#### ebal()***</span></span>
<span id="cb23-110"><a href="getting-started.html#cb23-110" tabindex="-1"></a>ebal <span class="ot">&lt;-</span> <span class="cf">function</span>(data, Y, treat, covar) {</span>
<span id="cb23-111"><a href="getting-started.html#cb23-111" tabindex="-1"></a>  <span class="fu">tryCatch</span>({</span>
<span id="cb23-112"><a href="getting-started.html#cb23-112" tabindex="-1"></a>    ebal.out <span class="ot">&lt;-</span> hbal<span class="sc">::</span><span class="fu">hbal</span>(<span class="at">Y =</span> Y, <span class="at">Treat =</span> treat, <span class="at">X =</span> covar,  <span class="at">data =</span> data, <span class="at">expand.degree =</span> <span class="dv">1</span>)</span>
<span id="cb23-113"><a href="getting-started.html#cb23-113" tabindex="-1"></a>    out <span class="ot">&lt;-</span> hbal<span class="sc">::</span><span class="fu">att</span>(ebal.out, <span class="at">dr =</span> <span class="cn">FALSE</span>)[<span class="dv">1</span>, <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">5</span>, <span class="dv">6</span>)]</span>
<span id="cb23-114"><a href="getting-started.html#cb23-114" tabindex="-1"></a>    <span class="fu">return</span>(out)</span>
<span id="cb23-115"><a href="getting-started.html#cb23-115" tabindex="-1"></a>  }, <span class="at">error =</span> <span class="cf">function</span>(e) {</span>
<span id="cb23-116"><a href="getting-started.html#cb23-116" tabindex="-1"></a>    <span class="fu">cat</span>(<span class="st">&quot;Warning in ebal method:&quot;</span>, e<span class="sc">$</span>message, <span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span>)</span>
<span id="cb23-117"><a href="getting-started.html#cb23-117" tabindex="-1"></a>    <span class="fu">return</span>(<span class="fu">c</span>(<span class="cn">NA</span>, <span class="cn">NA</span>, <span class="cn">NA</span>, <span class="cn">NA</span>))</span>
<span id="cb23-118"><a href="getting-started.html#cb23-118" tabindex="-1"></a>  })</span>
<span id="cb23-119"><a href="getting-started.html#cb23-119" tabindex="-1"></a>}</span>
<span id="cb23-120"><a href="getting-started.html#cb23-120" tabindex="-1"></a></span>
<span id="cb23-121"><a href="getting-started.html#cb23-121" tabindex="-1"></a><span class="do">#### hbal()***</span></span>
<span id="cb23-122"><a href="getting-started.html#cb23-122" tabindex="-1"></a><span class="co"># hbal &lt;- function(data, Y, treat, covar) {</span></span>
<span id="cb23-123"><a href="getting-started.html#cb23-123" tabindex="-1"></a><span class="co">#   hbal.out &lt;- hbal::hbal(Y = Y, Treat = treat, X = covar,  data = data, expand.degree = 2, # cv = TRUE)</span></span>
<span id="cb23-124"><a href="getting-started.html#cb23-124" tabindex="-1"></a><span class="co">#   out &lt;- hbal::att(hbal.out, dr = FALSE)[1, c(1, 2, 5, 6)]</span></span>
<span id="cb23-125"><a href="getting-started.html#cb23-125" tabindex="-1"></a><span class="co">#   return(out)</span></span>
<span id="cb23-126"><a href="getting-started.html#cb23-126" tabindex="-1"></a><span class="co"># }</span></span>
<span id="cb23-127"><a href="getting-started.html#cb23-127" tabindex="-1"></a></span>
<span id="cb23-128"><a href="getting-started.html#cb23-128" tabindex="-1"></a><span class="do">#### aipw_grf()***</span></span>
<span id="cb23-129"><a href="getting-started.html#cb23-129" tabindex="-1"></a>aipw <span class="ot">&lt;-</span> <span class="cf">function</span>(data, Y, treat, covar) {</span>
<span id="cb23-130"><a href="getting-started.html#cb23-130" tabindex="-1"></a>  <span class="fu">tryCatch</span>({</span>
<span id="cb23-131"><a href="getting-started.html#cb23-131" tabindex="-1"></a>    <span class="co">#library(&quot;grf&quot;)</span></span>
<span id="cb23-132"><a href="getting-started.html#cb23-132" tabindex="-1"></a>    <span class="cf">for</span> (var <span class="cf">in</span> <span class="fu">c</span>(Y, treat, covar)) {</span>
<span id="cb23-133"><a href="getting-started.html#cb23-133" tabindex="-1"></a>      data[, var] <span class="ot">&lt;-</span> <span class="fu">as.vector</span>(data[, var])</span>
<span id="cb23-134"><a href="getting-started.html#cb23-134" tabindex="-1"></a>    }</span>
<span id="cb23-135"><a href="getting-started.html#cb23-135" tabindex="-1"></a>    c.forest <span class="ot">&lt;-</span> <span class="fu">causal_forest</span>(<span class="at">X =</span> data[, covar, <span class="at">drop =</span> <span class="cn">FALSE</span>], <span class="at">Y =</span> data[, Y],</span>
<span id="cb23-136"><a href="getting-started.html#cb23-136" tabindex="-1"></a>                              <span class="at">W =</span> data[, treat], <span class="at">seed =</span> <span class="dv">42</span>)</span>
<span id="cb23-137"><a href="getting-started.html#cb23-137" tabindex="-1"></a>    att <span class="ot">&lt;-</span> <span class="fu">average_treatment_effect</span>(c.forest, <span class="at">target.sample =</span> <span class="st">&quot;treated&quot;</span>, <span class="at">method =</span> <span class="st">&quot;AIPW&quot;</span>)</span>
<span id="cb23-138"><a href="getting-started.html#cb23-138" tabindex="-1"></a>    att <span class="ot">&lt;-</span> <span class="fu">c</span>(att, att[<span class="dv">1</span>] <span class="sc">-</span> <span class="fl">1.96</span> <span class="sc">*</span> att[<span class="dv">2</span>], att[<span class="dv">1</span>] <span class="sc">+</span> <span class="fl">1.96</span> <span class="sc">*</span> att[<span class="dv">2</span>])</span>
<span id="cb23-139"><a href="getting-started.html#cb23-139" tabindex="-1"></a>    <span class="fu">return</span>(att)</span>
<span id="cb23-140"><a href="getting-started.html#cb23-140" tabindex="-1"></a>  }, <span class="at">error =</span> <span class="cf">function</span>(e) {</span>
<span id="cb23-141"><a href="getting-started.html#cb23-141" tabindex="-1"></a>    <span class="fu">cat</span>(<span class="st">&quot;Error in aipw_grf method:&quot;</span>, e<span class="sc">$</span>message, <span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span>)</span>
<span id="cb23-142"><a href="getting-started.html#cb23-142" tabindex="-1"></a>    <span class="fu">return</span>(<span class="fu">c</span>(<span class="cn">NA</span>, <span class="cn">NA</span>, <span class="cn">NA</span>, <span class="cn">NA</span>))</span>
<span id="cb23-143"><a href="getting-started.html#cb23-143" tabindex="-1"></a>  })</span>
<span id="cb23-144"><a href="getting-started.html#cb23-144" tabindex="-1"></a>}</span>
<span id="cb23-145"><a href="getting-started.html#cb23-145" tabindex="-1"></a></span>
<span id="cb23-146"><a href="getting-started.html#cb23-146" tabindex="-1"></a><span class="do">#### aipw.match()***</span></span>
<span id="cb23-147"><a href="getting-started.html#cb23-147" tabindex="-1"></a>aipw.match <span class="ot">&lt;-</span> <span class="cf">function</span>(data, Y, treat, covar) { <span class="co"># match on ps</span></span>
<span id="cb23-148"><a href="getting-started.html#cb23-148" tabindex="-1"></a>  ps <span class="ot">&lt;-</span> <span class="fu">probability_forest</span>(<span class="at">X =</span> data[, covar], <span class="at">Y =</span> <span class="fu">as.factor</span>(data[, treat]), <span class="at">seed =</span> <span class="dv">42</span>)<span class="sc">$</span>predictions[,<span class="dv">2</span>]</span>
<span id="cb23-149"><a href="getting-started.html#cb23-149" tabindex="-1"></a>  m.out <span class="ot">&lt;-</span> <span class="fu">Match</span>(<span class="at">Y =</span> data[, Y], <span class="at">Tr =</span> data[, treat], <span class="at">X =</span> ps,</span>
<span id="cb23-150"><a href="getting-started.html#cb23-150" tabindex="-1"></a>                 <span class="at">estimand =</span> <span class="st">&quot;ATT&quot;</span>, <span class="at">M =</span> <span class="dv">1</span>, <span class="at">replace =</span> <span class="cn">FALSE</span>, <span class="at">ties =</span> <span class="cn">FALSE</span>, <span class="at">BiasAdjust =</span> <span class="cn">FALSE</span>)</span>
<span id="cb23-151"><a href="getting-started.html#cb23-151" tabindex="-1"></a>  mb <span class="ot">&lt;-</span> <span class="fu">quiet</span>(<span class="fu">MatchBalance</span>(treat <span class="sc">~</span> ps, <span class="at">data =</span> data, <span class="at">match.out =</span> m.out, <span class="at">nboots=</span> <span class="dv">0</span>))</span>
<span id="cb23-152"><a href="getting-started.html#cb23-152" tabindex="-1"></a>  ks <span class="ot">&lt;-</span> mb<span class="sc">$</span>AfterMatching[[<span class="dv">1</span>]]<span class="sc">$</span>ks<span class="sc">$</span>ks<span class="sc">$</span>statistic</span>
<span id="cb23-153"><a href="getting-started.html#cb23-153" tabindex="-1"></a>  s <span class="ot">&lt;-</span> data[<span class="fu">c</span>(m.out<span class="sc">$</span>index.treated, m.out<span class="sc">$</span>index.control), ]</span>
<span id="cb23-154"><a href="getting-started.html#cb23-154" tabindex="-1"></a>  out <span class="ot">&lt;-</span> <span class="fu">aipw</span>(s, Y, treat, covar)</span>
<span id="cb23-155"><a href="getting-started.html#cb23-155" tabindex="-1"></a>  <span class="co"># return(out)</span></span>
<span id="cb23-156"><a href="getting-started.html#cb23-156" tabindex="-1"></a>  <span class="fu">return</span>(<span class="fu">c</span>(out, ks))</span>
<span id="cb23-157"><a href="getting-started.html#cb23-157" tabindex="-1"></a>}</span>
<span id="cb23-158"><a href="getting-started.html#cb23-158" tabindex="-1"></a></span>
<span id="cb23-159"><a href="getting-started.html#cb23-159" tabindex="-1"></a><span class="do">#### aipw_ow()</span></span>
<span id="cb23-160"><a href="getting-started.html#cb23-160" tabindex="-1"></a>aipw_ow <span class="ot">&lt;-</span> <span class="cf">function</span>(data, Y, treat, covar) {</span>
<span id="cb23-161"><a href="getting-started.html#cb23-161" tabindex="-1"></a>  <span class="fu">tryCatch</span>({</span>
<span id="cb23-162"><a href="getting-started.html#cb23-162" tabindex="-1"></a>    <span class="cf">for</span> (var <span class="cf">in</span> <span class="fu">c</span>(Y, treat, covar)) {</span>
<span id="cb23-163"><a href="getting-started.html#cb23-163" tabindex="-1"></a>      data[, var] <span class="ot">&lt;-</span> <span class="fu">as.vector</span>(data[, var])</span>
<span id="cb23-164"><a href="getting-started.html#cb23-164" tabindex="-1"></a>    }</span>
<span id="cb23-165"><a href="getting-started.html#cb23-165" tabindex="-1"></a>    X <span class="ot">&lt;-</span> data[, covar, drop <span class="ot">=</span> <span class="cn">FALSE</span>]</span>
<span id="cb23-166"><a href="getting-started.html#cb23-166" tabindex="-1"></a>    Y <span class="ot">&lt;-</span> data[, Y]</span>
<span id="cb23-167"><a href="getting-started.html#cb23-167" tabindex="-1"></a>    W <span class="ot">&lt;-</span> data[, treat]</span>
<span id="cb23-168"><a href="getting-started.html#cb23-168" tabindex="-1"></a>    <span class="co"># run dml_with_smoother with AIPW_ATT</span></span>
<span id="cb23-169"><a href="getting-started.html#cb23-169" tabindex="-1"></a>    dml_fit <span class="ot">&lt;-</span> <span class="fu">dml_with_smoother</span>(</span>
<span id="cb23-170"><a href="getting-started.html#cb23-170" tabindex="-1"></a>      <span class="at">Y =</span> Y, <span class="at">D =</span> W, <span class="at">X =</span> X,</span>
<span id="cb23-171"><a href="getting-started.html#cb23-171" tabindex="-1"></a>      <span class="at">estimators =</span> <span class="fu">c</span>(<span class="st">&quot;AIPW_ATT&quot;</span>),</span>
<span id="cb23-172"><a href="getting-started.html#cb23-172" tabindex="-1"></a>      <span class="at">smoother =</span> <span class="st">&quot;honest_forest&quot;</span>,</span>
<span id="cb23-173"><a href="getting-started.html#cb23-173" tabindex="-1"></a>      <span class="at">n_cf_folds =</span> <span class="dv">5</span>,</span>
<span id="cb23-174"><a href="getting-started.html#cb23-174" tabindex="-1"></a>      <span class="at">n_reps =</span> <span class="dv">1</span>)</span>
<span id="cb23-175"><a href="getting-started.html#cb23-175" tabindex="-1"></a>    <span class="co"># extract estimate and SE from summary</span></span>
<span id="cb23-176"><a href="getting-started.html#cb23-176" tabindex="-1"></a>    summ <span class="ot">&lt;-</span> <span class="fu">summary</span>(dml_fit, <span class="at">quiet =</span> <span class="cn">TRUE</span>)</span>
<span id="cb23-177"><a href="getting-started.html#cb23-177" tabindex="-1"></a>    est <span class="ot">&lt;-</span> summ[<span class="st">&quot;AIPW-ATT&quot;</span>, <span class="st">&quot;Estimate&quot;</span>]</span>
<span id="cb23-178"><a href="getting-started.html#cb23-178" tabindex="-1"></a>    se <span class="ot">&lt;-</span> summ[<span class="st">&quot;AIPW-ATT&quot;</span>, <span class="st">&quot;SE&quot;</span>]</span>
<span id="cb23-179"><a href="getting-started.html#cb23-179" tabindex="-1"></a>    ci_lower <span class="ot">&lt;-</span> est <span class="sc">-</span> <span class="fl">1.96</span> <span class="sc">*</span> se</span>
<span id="cb23-180"><a href="getting-started.html#cb23-180" tabindex="-1"></a>    ci_upper <span class="ot">&lt;-</span> est <span class="sc">+</span> <span class="fl">1.96</span> <span class="sc">*</span> se</span>
<span id="cb23-181"><a href="getting-started.html#cb23-181" tabindex="-1"></a>    <span class="fu">return</span>(<span class="fu">c</span>(est, se, ci_lower, ci_upper))</span>
<span id="cb23-182"><a href="getting-started.html#cb23-182" tabindex="-1"></a>  }, <span class="at">error =</span> <span class="cf">function</span>(e) {</span>
<span id="cb23-183"><a href="getting-started.html#cb23-183" tabindex="-1"></a>    <span class="fu">cat</span>(<span class="st">&quot;Error in aipw_ow method:&quot;</span>, e<span class="sc">$</span>message, <span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span>)</span>
<span id="cb23-184"><a href="getting-started.html#cb23-184" tabindex="-1"></a>    <span class="fu">return</span>(<span class="fu">c</span>(<span class="cn">NA</span>, <span class="cn">NA</span>, <span class="cn">NA</span>, <span class="cn">NA</span>))</span>
<span id="cb23-185"><a href="getting-started.html#cb23-185" tabindex="-1"></a>  })</span>
<span id="cb23-186"><a href="getting-started.html#cb23-186" tabindex="-1"></a>}</span>
<span id="cb23-187"><a href="getting-started.html#cb23-187" tabindex="-1"></a></span>
<span id="cb23-188"><a href="getting-started.html#cb23-188" tabindex="-1"></a><span class="do">### this script checks for robustness by estimating original model</span></span>
<span id="cb23-189"><a href="getting-started.html#cb23-189" tabindex="-1"></a><span class="do">### using double/debiased machine learning using DoubleML package</span></span>
<span id="cb23-190"><a href="getting-started.html#cb23-190" tabindex="-1"></a><span class="do">#### dml()***</span></span>
<span id="cb23-191"><a href="getting-started.html#cb23-191" tabindex="-1"></a>dml <span class="ot">&lt;-</span><span class="cf">function</span>(data, <span class="at">Y =</span> <span class="cn">NULL</span>, <span class="at">treat =</span> <span class="cn">NULL</span>, <span class="at">covar =</span> <span class="cn">NULL</span>, <span class="at">clust_var =</span> <span class="cn">NULL</span>, <span class="at">ml_l =</span> <span class="fu">lrn</span>(<span class="st">&quot;regr.cv_glmnet&quot;</span>), <span class="at">ml_m =</span> <span class="fu">lrn</span>(<span class="st">&quot;regr.cv_glmnet&quot;</span>)){</span>
<span id="cb23-192"><a href="getting-started.html#cb23-192" tabindex="-1"></a>  <span class="fu">tryCatch</span>({</span>
<span id="cb23-193"><a href="getting-started.html#cb23-193" tabindex="-1"></a>    <span class="cf">if</span>(<span class="fu">is.null</span>(covar)){</span>
<span id="cb23-194"><a href="getting-started.html#cb23-194" tabindex="-1"></a>      <span class="fu">stop</span>(<span class="st">&quot;No controls in specification.&quot;</span>)</span>
<span id="cb23-195"><a href="getting-started.html#cb23-195" tabindex="-1"></a>    }</span>
<span id="cb23-196"><a href="getting-started.html#cb23-196" tabindex="-1"></a>    <span class="co">#require(DoubleML)</span></span>
<span id="cb23-197"><a href="getting-started.html#cb23-197" tabindex="-1"></a>    <span class="co">#require(mlr3learners) </span></span>
<span id="cb23-198"><a href="getting-started.html#cb23-198" tabindex="-1"></a>    <span class="co">#require(fixest)</span></span>
<span id="cb23-199"><a href="getting-started.html#cb23-199" tabindex="-1"></a>    <span class="co">#require(ggplot2)</span></span>
<span id="cb23-200"><a href="getting-started.html#cb23-200" tabindex="-1"></a>    <span class="cf">if</span>(<span class="fu">is.null</span>(clust_var) <span class="sc">==</span> <span class="cn">TRUE</span>){</span>
<span id="cb23-201"><a href="getting-started.html#cb23-201" tabindex="-1"></a>      dat <span class="ot">=</span> data[,<span class="fu">c</span>(Y,treat,covar)]</span>
<span id="cb23-202"><a href="getting-started.html#cb23-202" tabindex="-1"></a>      dat <span class="ot">=</span> <span class="fu">na.omit</span>(dat)</span>
<span id="cb23-203"><a href="getting-started.html#cb23-203" tabindex="-1"></a>      dml_dat <span class="ot">=</span> DoubleMLData<span class="sc">$</span><span class="fu">new</span>(</span>
<span id="cb23-204"><a href="getting-started.html#cb23-204" tabindex="-1"></a>        dat,</span>
<span id="cb23-205"><a href="getting-started.html#cb23-205" tabindex="-1"></a>        <span class="at">y_col =</span> Y,</span>
<span id="cb23-206"><a href="getting-started.html#cb23-206" tabindex="-1"></a>        <span class="at">d_cols =</span> treat,</span>
<span id="cb23-207"><a href="getting-started.html#cb23-207" tabindex="-1"></a>        <span class="at">use_other_treat_as_covariate =</span> <span class="cn">FALSE</span>,</span>
<span id="cb23-208"><a href="getting-started.html#cb23-208" tabindex="-1"></a>        <span class="at">x_cols =</span> covar)</span>
<span id="cb23-209"><a href="getting-started.html#cb23-209" tabindex="-1"></a>    }<span class="cf">else</span>{</span>
<span id="cb23-210"><a href="getting-started.html#cb23-210" tabindex="-1"></a>      dat <span class="ot">=</span> data[,<span class="fu">c</span>(Y, treat, covar, clust_var)]</span>
<span id="cb23-211"><a href="getting-started.html#cb23-211" tabindex="-1"></a>      dat[,clust_var] <span class="ot">=</span> <span class="fu">as.numeric</span>(<span class="fu">factor</span>(dat[,clust_var]))</span>
<span id="cb23-212"><a href="getting-started.html#cb23-212" tabindex="-1"></a>      dat <span class="ot">=</span> dat[<span class="fu">is.na</span>(dat[,Y]) <span class="sc">==</span> <span class="cn">FALSE</span>,]</span>
<span id="cb23-213"><a href="getting-started.html#cb23-213" tabindex="-1"></a>      dat <span class="ot">=</span> dat[<span class="fu">is.na</span>(dat[,D]) <span class="sc">==</span> <span class="cn">FALSE</span>,]</span>
<span id="cb23-214"><a href="getting-started.html#cb23-214" tabindex="-1"></a>      features <span class="ot">=</span> <span class="fu">data.frame</span>(<span class="fu">model.matrix</span>(<span class="fu">formula</span>(<span class="fu">paste</span>(<span class="fu">c</span>(<span class="st">&#39;~ 1&#39;</span>,treat,covar), <span class="at">collapse=</span><span class="st">&quot;+&quot;</span>)), dat))</span>
<span id="cb23-215"><a href="getting-started.html#cb23-215" tabindex="-1"></a>      dat <span class="ot">=</span> <span class="fu">cbind</span>(dat[,<span class="fu">c</span>(Y,clust_var)],features)</span>
<span id="cb23-216"><a href="getting-started.html#cb23-216" tabindex="-1"></a>      dml_dat <span class="ot">=</span> DoubleMLClusterData<span class="sc">$</span><span class="fu">new</span>(</span>
<span id="cb23-217"><a href="getting-started.html#cb23-217" tabindex="-1"></a>        dat,</span>
<span id="cb23-218"><a href="getting-started.html#cb23-218" tabindex="-1"></a>        <span class="at">y_col =</span> Y,</span>
<span id="cb23-219"><a href="getting-started.html#cb23-219" tabindex="-1"></a>        <span class="at">d_cols =</span> treat,</span>
<span id="cb23-220"><a href="getting-started.html#cb23-220" tabindex="-1"></a>        <span class="at">cluster_cols =</span> clust_var,</span>
<span id="cb23-221"><a href="getting-started.html#cb23-221" tabindex="-1"></a>        <span class="at">use_other_treat_as_covariate =</span> <span class="cn">FALSE</span>,</span>
<span id="cb23-222"><a href="getting-started.html#cb23-222" tabindex="-1"></a>        <span class="at">x_cols =</span> covar)</span>
<span id="cb23-223"><a href="getting-started.html#cb23-223" tabindex="-1"></a>    }</span>
<span id="cb23-224"><a href="getting-started.html#cb23-224" tabindex="-1"></a>    <span class="co"># set active treatment treatment</span></span>
<span id="cb23-225"><a href="getting-started.html#cb23-225" tabindex="-1"></a>    dml_dat<span class="sc">$</span><span class="fu">set_data_model</span>(treat)</span>
<span id="cb23-226"><a href="getting-started.html#cb23-226" tabindex="-1"></a>    <span class="co"># estimate with DML</span></span>
<span id="cb23-227"><a href="getting-started.html#cb23-227" tabindex="-1"></a>    <span class="fu">set.seed</span>(pi)</span>
<span id="cb23-228"><a href="getting-started.html#cb23-228" tabindex="-1"></a>    dml_mod <span class="ot">=</span> DoubleMLPLR<span class="sc">$</span><span class="fu">new</span>(dml_dat, <span class="at">ml_l=</span>ml_l, <span class="at">ml_m=</span>ml_m)</span>
<span id="cb23-229"><a href="getting-started.html#cb23-229" tabindex="-1"></a>    <span class="fu">quiet</span>(dml_mod<span class="sc">$</span><span class="fu">fit</span>())</span>
<span id="cb23-230"><a href="getting-started.html#cb23-230" tabindex="-1"></a>    out <span class="ot">=</span> <span class="fu">c</span>(dml_mod<span class="sc">$</span>coef[treat], dml_mod<span class="sc">$</span>se[treat], dml_mod<span class="sc">$</span><span class="fu">confint</span>()[treat,])</span>
<span id="cb23-231"><a href="getting-started.html#cb23-231" tabindex="-1"></a>    <span class="fu">return</span>(out)</span>
<span id="cb23-232"><a href="getting-started.html#cb23-232" tabindex="-1"></a>  }, <span class="at">error =</span> <span class="cf">function</span>(e) {</span>
<span id="cb23-233"><a href="getting-started.html#cb23-233" tabindex="-1"></a>    <span class="fu">cat</span>(<span class="st">&quot;Error in dml method:&quot;</span>, e<span class="sc">$</span>message, <span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span>)</span>
<span id="cb23-234"><a href="getting-started.html#cb23-234" tabindex="-1"></a>    <span class="fu">return</span>(<span class="fu">c</span>(<span class="cn">NA</span>, <span class="cn">NA</span>, <span class="cn">NA</span>, <span class="cn">NA</span>))</span>
<span id="cb23-235"><a href="getting-started.html#cb23-235" tabindex="-1"></a>  })</span>
<span id="cb23-236"><a href="getting-started.html#cb23-236" tabindex="-1"></a>}</span>
<span id="cb23-237"><a href="getting-started.html#cb23-237" tabindex="-1"></a></span>
<span id="cb23-238"><a href="getting-started.html#cb23-238" tabindex="-1"></a></span>
<span id="cb23-239"><a href="getting-started.html#cb23-239" tabindex="-1"></a><span class="do">#### estimate_all***</span></span>
<span id="cb23-240"><a href="getting-started.html#cb23-240" tabindex="-1"></a>estimate_all <span class="ot">&lt;-</span> <span class="cf">function</span>(data, Y, treat, covar, </span>
<span id="cb23-241"><a href="getting-started.html#cb23-241" tabindex="-1"></a>                         <span class="at">methods =</span> <span class="fu">c</span>(<span class="st">&quot;diff&quot;</span>, <span class="st">&quot;reg&quot;</span>, <span class="st">&quot;om.reg&quot;</span>, <span class="st">&quot;om.grf&quot;</span>,</span>
<span id="cb23-242"><a href="getting-started.html#cb23-242" tabindex="-1"></a>                                     <span class="st">&quot;matching&quot;</span>, <span class="st">&quot;psm&quot;</span>, <span class="st">&quot;ipw&quot;</span>, <span class="st">&quot;cbps&quot;</span>, <span class="st">&quot;ebal&quot;</span>, </span>
<span id="cb23-243"><a href="getting-started.html#cb23-243" tabindex="-1"></a>                                     <span class="st">&quot;dml&quot;</span>, <span class="st">&quot;aipw_grf&quot;</span>, <span class="st">&quot;aipw_ow&quot;</span>)) {</span>
<span id="cb23-244"><a href="getting-started.html#cb23-244" tabindex="-1"></a>  </span>
<span id="cb23-245"><a href="getting-started.html#cb23-245" tabindex="-1"></a>  results <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(<span class="fu">matrix</span>(<span class="cn">NA</span>, <span class="fu">length</span>(methods), <span class="dv">4</span>))</span>
<span id="cb23-246"><a href="getting-started.html#cb23-246" tabindex="-1"></a>  <span class="fu">rownames</span>(results) <span class="ot">&lt;-</span> methods</span>
<span id="cb23-247"><a href="getting-started.html#cb23-247" tabindex="-1"></a>  <span class="fu">colnames</span>(results) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;Estimate&quot;</span>, <span class="st">&quot;SE&quot;</span>, <span class="st">&quot;CI_lower&quot;</span>, <span class="st">&quot;CI_upper&quot;</span>)</span>
<span id="cb23-248"><a href="getting-started.html#cb23-248" tabindex="-1"></a>  m <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb23-249"><a href="getting-started.html#cb23-249" tabindex="-1"></a>  <span class="cf">if</span> (<span class="st">&quot;diff&quot;</span> <span class="sc">%in%</span> methods) {</span>
<span id="cb23-250"><a href="getting-started.html#cb23-250" tabindex="-1"></a>    results[m, ] <span class="ot">&lt;-</span> <span class="fu">diff</span>(data, Y, treat) </span>
<span id="cb23-251"><a href="getting-started.html#cb23-251" tabindex="-1"></a>    m <span class="ot">&lt;-</span> m <span class="sc">+</span> <span class="dv">1</span></span>
<span id="cb23-252"><a href="getting-started.html#cb23-252" tabindex="-1"></a>  }</span>
<span id="cb23-253"><a href="getting-started.html#cb23-253" tabindex="-1"></a>  <span class="cf">if</span> (<span class="st">&quot;reg&quot;</span> <span class="sc">%in%</span> methods) {</span>
<span id="cb23-254"><a href="getting-started.html#cb23-254" tabindex="-1"></a>    results[m, ] <span class="ot">&lt;-</span> <span class="fu">reg</span>(data, Y, treat, covar) </span>
<span id="cb23-255"><a href="getting-started.html#cb23-255" tabindex="-1"></a>    m <span class="ot">&lt;-</span> m <span class="sc">+</span> <span class="dv">1</span></span>
<span id="cb23-256"><a href="getting-started.html#cb23-256" tabindex="-1"></a>  }</span>
<span id="cb23-257"><a href="getting-started.html#cb23-257" tabindex="-1"></a>  <span class="cf">if</span> (<span class="st">&quot;om.reg&quot;</span> <span class="sc">%in%</span> methods) {</span>
<span id="cb23-258"><a href="getting-started.html#cb23-258" tabindex="-1"></a>    results[m, ] <span class="ot">&lt;-</span> <span class="fu">om.reg</span>(data, Y, treat, covar) </span>
<span id="cb23-259"><a href="getting-started.html#cb23-259" tabindex="-1"></a>    m <span class="ot">&lt;-</span> m <span class="sc">+</span> <span class="dv">1</span></span>
<span id="cb23-260"><a href="getting-started.html#cb23-260" tabindex="-1"></a>  }</span>
<span id="cb23-261"><a href="getting-started.html#cb23-261" tabindex="-1"></a>  <span class="cf">if</span> (<span class="st">&quot;om.grf&quot;</span> <span class="sc">%in%</span> methods) {</span>
<span id="cb23-262"><a href="getting-started.html#cb23-262" tabindex="-1"></a>    results[m, ] <span class="ot">&lt;-</span> <span class="fu">om.grf</span>(data, Y, treat, covar) </span>
<span id="cb23-263"><a href="getting-started.html#cb23-263" tabindex="-1"></a>    m <span class="ot">&lt;-</span> m <span class="sc">+</span> <span class="dv">1</span></span>
<span id="cb23-264"><a href="getting-started.html#cb23-264" tabindex="-1"></a>  } </span>
<span id="cb23-265"><a href="getting-started.html#cb23-265" tabindex="-1"></a>  <span class="cf">if</span> (<span class="st">&quot;matching&quot;</span> <span class="sc">%in%</span> methods) {</span>
<span id="cb23-266"><a href="getting-started.html#cb23-266" tabindex="-1"></a>    results[m, ] <span class="ot">&lt;-</span> <span class="fu">matching</span>(data, Y, treat, covar) </span>
<span id="cb23-267"><a href="getting-started.html#cb23-267" tabindex="-1"></a>    m <span class="ot">&lt;-</span> m <span class="sc">+</span> <span class="dv">1</span></span>
<span id="cb23-268"><a href="getting-started.html#cb23-268" tabindex="-1"></a>  }</span>
<span id="cb23-269"><a href="getting-started.html#cb23-269" tabindex="-1"></a>  <span class="cf">if</span> (<span class="st">&quot;psm&quot;</span> <span class="sc">%in%</span> methods) {</span>
<span id="cb23-270"><a href="getting-started.html#cb23-270" tabindex="-1"></a>    results[m, ] <span class="ot">&lt;-</span> <span class="fu">psm</span>(data, Y, treat, covar) </span>
<span id="cb23-271"><a href="getting-started.html#cb23-271" tabindex="-1"></a>    m <span class="ot">&lt;-</span> m <span class="sc">+</span> <span class="dv">1</span></span>
<span id="cb23-272"><a href="getting-started.html#cb23-272" tabindex="-1"></a>  }  </span>
<span id="cb23-273"><a href="getting-started.html#cb23-273" tabindex="-1"></a>  <span class="cf">if</span> (<span class="st">&quot;ipw&quot;</span> <span class="sc">%in%</span> methods) {</span>
<span id="cb23-274"><a href="getting-started.html#cb23-274" tabindex="-1"></a>    results[m, ] <span class="ot">&lt;-</span> <span class="fu">ipw</span>(data, Y, treat, covar) </span>
<span id="cb23-275"><a href="getting-started.html#cb23-275" tabindex="-1"></a>    m <span class="ot">&lt;-</span> m <span class="sc">+</span> <span class="dv">1</span></span>
<span id="cb23-276"><a href="getting-started.html#cb23-276" tabindex="-1"></a>  }</span>
<span id="cb23-277"><a href="getting-started.html#cb23-277" tabindex="-1"></a>  <span class="cf">if</span> (<span class="st">&quot;cbps&quot;</span> <span class="sc">%in%</span> methods) {</span>
<span id="cb23-278"><a href="getting-started.html#cb23-278" tabindex="-1"></a>    results[m, ] <span class="ot">&lt;-</span> <span class="fu">cbps</span>(data, Y, treat, covar) </span>
<span id="cb23-279"><a href="getting-started.html#cb23-279" tabindex="-1"></a>    m <span class="ot">&lt;-</span> m <span class="sc">+</span> <span class="dv">1</span></span>
<span id="cb23-280"><a href="getting-started.html#cb23-280" tabindex="-1"></a>  }</span>
<span id="cb23-281"><a href="getting-started.html#cb23-281" tabindex="-1"></a>  <span class="cf">if</span> (<span class="st">&quot;ebal&quot;</span> <span class="sc">%in%</span> methods) {</span>
<span id="cb23-282"><a href="getting-started.html#cb23-282" tabindex="-1"></a>    results[m, ] <span class="ot">&lt;-</span> <span class="fu">quiet</span>(<span class="fu">ebal</span>(data, Y, treat, covar))</span>
<span id="cb23-283"><a href="getting-started.html#cb23-283" tabindex="-1"></a>    m <span class="ot">&lt;-</span> m <span class="sc">+</span> <span class="dv">1</span></span>
<span id="cb23-284"><a href="getting-started.html#cb23-284" tabindex="-1"></a>  }</span>
<span id="cb23-285"><a href="getting-started.html#cb23-285" tabindex="-1"></a>  <span class="co"># if (&quot;hbal&quot; %in% methods) {</span></span>
<span id="cb23-286"><a href="getting-started.html#cb23-286" tabindex="-1"></a>  <span class="co">#   results[m, ] &lt;- quiet(hbal(data, Y, treat, covar))</span></span>
<span id="cb23-287"><a href="getting-started.html#cb23-287" tabindex="-1"></a>  <span class="co">#   m &lt;- m + 1</span></span>
<span id="cb23-288"><a href="getting-started.html#cb23-288" tabindex="-1"></a>  <span class="co"># }</span></span>
<span id="cb23-289"><a href="getting-started.html#cb23-289" tabindex="-1"></a>  <span class="cf">if</span> (<span class="st">&quot;dml&quot;</span> <span class="sc">%in%</span> methods) {</span>
<span id="cb23-290"><a href="getting-started.html#cb23-290" tabindex="-1"></a>    results[m, ] <span class="ot">&lt;-</span><span class="fu">dml</span>(data, Y, treat, covar) </span>
<span id="cb23-291"><a href="getting-started.html#cb23-291" tabindex="-1"></a>    m <span class="ot">&lt;-</span> m <span class="sc">+</span> <span class="dv">1</span></span>
<span id="cb23-292"><a href="getting-started.html#cb23-292" tabindex="-1"></a>  }</span>
<span id="cb23-293"><a href="getting-started.html#cb23-293" tabindex="-1"></a>  <span class="cf">if</span> (<span class="st">&quot;aipw_grf&quot;</span> <span class="sc">%in%</span> methods) {</span>
<span id="cb23-294"><a href="getting-started.html#cb23-294" tabindex="-1"></a>    results[m, ] <span class="ot">&lt;-</span> <span class="fu">aipw</span>(data, Y, treat, covar) </span>
<span id="cb23-295"><a href="getting-started.html#cb23-295" tabindex="-1"></a>    m <span class="ot">&lt;-</span> m <span class="sc">+</span> <span class="dv">1</span></span>
<span id="cb23-296"><a href="getting-started.html#cb23-296" tabindex="-1"></a>  }</span>
<span id="cb23-297"><a href="getting-started.html#cb23-297" tabindex="-1"></a>  <span class="cf">if</span> (<span class="st">&quot;aipw_ow&quot;</span> <span class="sc">%in%</span> methods) {</span>
<span id="cb23-298"><a href="getting-started.html#cb23-298" tabindex="-1"></a>    results[m, ] <span class="ot">&lt;-</span> <span class="fu">aipw_ow</span>(data, Y, treat, covar)</span>
<span id="cb23-299"><a href="getting-started.html#cb23-299" tabindex="-1"></a>    m <span class="ot">&lt;-</span> m <span class="sc">+</span> <span class="dv">1</span></span>
<span id="cb23-300"><a href="getting-started.html#cb23-300" tabindex="-1"></a>  }</span>
<span id="cb23-301"><a href="getting-started.html#cb23-301" tabindex="-1"></a>  <span class="fu">return</span>(results)</span>
<span id="cb23-302"><a href="getting-started.html#cb23-302" tabindex="-1"></a>}</span></code></pre></div>
<p><strong>Function calls</strong></p>
<ul>
<li><code>quiet</code>: Suppresses output from a function call.</li>
<li><code>diff</code>: Difference in means estimator. It runs a linear regression adjusting for robust standard errors and returns the coefficient, standard error, and confidence interval for the treatment variable.</li>
<li><code>reg</code>: Regression adjustment. Similar to <code>diff</code> but includes additional covariates in the regression model.</li>
<li><code>matching</code>: Propensity score matching using the Matching package. It aligns treated units to control units based on covariates and returns the estimated ATT and its confidence interval.</li>
<li><code>psm</code>: Propensity score matching using a probability forest, followed by matching and estimation of the ATT.</li>
<li><code>om.reg</code>: Outcome modeling using regression. It predicts the outcome for the treated units based on the model fitted to the control units, and then estimates the ATT.</li>
<li><code>om.grf</code>: Outcome modeling using generalized random forests, noted as GRF.</li>
<li><code>ipw</code>: Inverse probability weighting,denoted as IPW. It weights observations by the inverse of their estimated propensity scores and calculates the treatment effect with a weighted regression.</li>
<li><code>cbps</code>: Covariate balancing propensity score, noted as CBPS. It estimates propensity scores to achieve balance on covariates across groups.</li>
<li><code>ebal</code>: Entropy balancing. It reweights the data to balance the covariate distributions.</li>
<li><code>hbal</code>: Hierarchical balancing. It is an extension of <code>ebal</code> with more complex balancing methods.</li>
<li><code>aipw</code>: Augmented inverse probability weighting, noted as AIPW.</li>
<li><code>aipw.match</code>: Combines matching on propensity scores with AIPW.</li>
<li><code>aipw_ow</code>: AIPW computed via outcome weights.</li>
<li><code>dml</code>: Double machine learning. It uses machine learning algorithms to control for confounders when estimating treatment effects.</li>
</ul>
<p><code>plot_coef()</code>*** plots treatment effect point estimates and corresponding confidence intervals comparatively across various estimators.</p>
<div class="sourceCode" id="cb24"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb24-1"><a href="getting-started.html#cb24-1" tabindex="-1"></a>plot_coef <span class="ot">&lt;-</span> <span class="cf">function</span>(out, </span>
<span id="cb24-2"><a href="getting-started.html#cb24-2" tabindex="-1"></a>                      <span class="at">methods =</span> <span class="fu">c</span>(<span class="st">&quot;diff&quot;</span>, <span class="st">&quot;reg&quot;</span>, <span class="st">&quot;om.reg&quot;</span>, <span class="st">&quot;om.grf&quot;</span>, </span>
<span id="cb24-3"><a href="getting-started.html#cb24-3" tabindex="-1"></a>                                  <span class="st">&quot;matching&quot;</span>, <span class="st">&quot;psm&quot;</span>, <span class="st">&quot;ipw&quot;</span>, <span class="st">&quot;cbps&quot;</span>, <span class="st">&quot;ebal&quot;</span>, </span>
<span id="cb24-4"><a href="getting-started.html#cb24-4" tabindex="-1"></a>                                  <span class="st">&quot;dml&quot;</span>, <span class="st">&quot;aipw_grf&quot;</span>, <span class="st">&quot;aipw_ow&quot;</span>),</span>
<span id="cb24-5"><a href="getting-started.html#cb24-5" tabindex="-1"></a>                      <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">&quot;Diff-in-Means&quot;</span>, <span class="st">&quot;Reg&quot;</span>, <span class="st">&quot;OM: Reg&quot;</span>, <span class="st">&quot;OM: GRF&quot;</span>,</span>
<span id="cb24-6"><a href="getting-started.html#cb24-6" tabindex="-1"></a>                                 <span class="st">&quot;NN</span><span class="sc">\n</span><span class="st">Matching&quot;</span>, <span class="st">&quot;PS</span><span class="sc">\n</span><span class="st">Matching&quot;</span>,</span>
<span id="cb24-7"><a href="getting-started.html#cb24-7" tabindex="-1"></a>                                 <span class="st">&quot;IPW&quot;</span>, <span class="st">&quot;CBPS&quot;</span>, <span class="st">&quot;Ebal&quot;</span>, <span class="st">&quot;DML</span><span class="sc">\n</span><span class="st">Elasnet&quot;</span>, <span class="st">&quot;AIPW-GRF&quot;</span>, <span class="st">&quot;AIPW-OW&quot;</span>),</span>
<span id="cb24-8"><a href="getting-started.html#cb24-8" tabindex="-1"></a>                      <span class="at">main =</span> <span class="cn">NULL</span>,</span>
<span id="cb24-9"><a href="getting-started.html#cb24-9" tabindex="-1"></a>                      <span class="at">ylab =</span> <span class="st">&quot;Estimate&quot;</span>,</span>
<span id="cb24-10"><a href="getting-started.html#cb24-10" tabindex="-1"></a>                      <span class="at">band =</span> <span class="cn">NULL</span>,</span>
<span id="cb24-11"><a href="getting-started.html#cb24-11" tabindex="-1"></a>                      <span class="at">line =</span> <span class="cn">NULL</span>,</span>
<span id="cb24-12"><a href="getting-started.html#cb24-12" tabindex="-1"></a>                      <span class="at">grid =</span> <span class="cn">TRUE</span>,</span>
<span id="cb24-13"><a href="getting-started.html#cb24-13" tabindex="-1"></a>                      <span class="at">main.pos =</span> <span class="dv">1</span>,</span>
<span id="cb24-14"><a href="getting-started.html#cb24-14" tabindex="-1"></a>                      <span class="at">main.line =</span> <span class="sc">-</span><span class="dv">2</span>,</span>
<span id="cb24-15"><a href="getting-started.html#cb24-15" tabindex="-1"></a>                      <span class="at">ylim =</span> <span class="cn">NULL</span>,</span>
<span id="cb24-16"><a href="getting-started.html#cb24-16" tabindex="-1"></a>                      <span class="at">textsize =</span> <span class="fl">0.8</span></span>
<span id="cb24-17"><a href="getting-started.html#cb24-17" tabindex="-1"></a>) {</span>
<span id="cb24-18"><a href="getting-started.html#cb24-18" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">is.null</span>(methods) <span class="sc">==</span> <span class="cn">TRUE</span>) {</span>
<span id="cb24-19"><a href="getting-started.html#cb24-19" tabindex="-1"></a>    methods <span class="ot">&lt;-</span> <span class="fu">rownames</span>(out)</span>
<span id="cb24-20"><a href="getting-started.html#cb24-20" tabindex="-1"></a>  }</span>
<span id="cb24-21"><a href="getting-started.html#cb24-21" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">is.null</span>(labels) <span class="sc">==</span> <span class="cn">TRUE</span>) {</span>
<span id="cb24-22"><a href="getting-started.html#cb24-22" tabindex="-1"></a>    labels <span class="ot">&lt;-</span> methods</span>
<span id="cb24-23"><a href="getting-started.html#cb24-23" tabindex="-1"></a>  }</span>
<span id="cb24-24"><a href="getting-started.html#cb24-24" tabindex="-1"></a>  <span class="co"># # check</span></span>
<span id="cb24-25"><a href="getting-started.html#cb24-25" tabindex="-1"></a>  <span class="co"># if (is.null(out)==FALSE) {</span></span>
<span id="cb24-26"><a href="getting-started.html#cb24-26" tabindex="-1"></a>  <span class="co">#   if (inherits(out, &quot;ivDiag&quot;) == FALSE) {stop(&quot;\&quot;out\&quot; needs to be a \&quot;ltz\&quot; object.&quot;)}</span></span>
<span id="cb24-27"><a href="getting-started.html#cb24-27" tabindex="-1"></a>  <span class="co"># }</span></span>
<span id="cb24-28"><a href="getting-started.html#cb24-28" tabindex="-1"></a>  <span class="co"># </span></span>
<span id="cb24-29"><a href="getting-started.html#cb24-29" tabindex="-1"></a>  <span class="co"># # title</span></span>
<span id="cb24-30"><a href="getting-started.html#cb24-30" tabindex="-1"></a>  <span class="co"># if (is.null(main)==TRUE) {</span></span>
<span id="cb24-31"><a href="getting-started.html#cb24-31" tabindex="-1"></a>  <span class="co">#   main &lt;- &quot;Estimates with 95% CIs&quot;</span></span>
<span id="cb24-32"><a href="getting-started.html#cb24-32" tabindex="-1"></a>  <span class="co"># }</span></span>
<span id="cb24-33"><a href="getting-started.html#cb24-33" tabindex="-1"></a>  <span class="co"># data for the plot</span></span>
<span id="cb24-34"><a href="getting-started.html#cb24-34" tabindex="-1"></a>  data <span class="ot">&lt;-</span> out</span>
<span id="cb24-35"><a href="getting-started.html#cb24-35" tabindex="-1"></a>  rg <span class="ot">&lt;-</span> <span class="fu">range</span>(data[,<span class="fu">c</span>(<span class="dv">3</span>,<span class="dv">4</span>)], <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb24-36"><a href="getting-started.html#cb24-36" tabindex="-1"></a>  adj <span class="ot">&lt;-</span> rg[<span class="dv">2</span>] <span class="sc">-</span> rg[<span class="dv">1</span>]</span>
<span id="cb24-37"><a href="getting-started.html#cb24-37" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">is.null</span>(ylim) <span class="sc">==</span> <span class="cn">TRUE</span>) {</span>
<span id="cb24-38"><a href="getting-started.html#cb24-38" tabindex="-1"></a>    ylim  <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fu">min</span>(<span class="dv">0</span>, rg[<span class="dv">1</span>] <span class="sc">-</span> <span class="fl">0.3</span><span class="sc">*</span>adj), <span class="fu">max</span>(<span class="dv">0</span>, rg[<span class="dv">2</span>] <span class="sc">+</span> <span class="fl">0.35</span><span class="sc">*</span>adj))</span>
<span id="cb24-39"><a href="getting-started.html#cb24-39" tabindex="-1"></a>  }</span>
<span id="cb24-40"><a href="getting-started.html#cb24-40" tabindex="-1"></a>  adj2 <span class="ot">&lt;-</span> ylim[<span class="dv">2</span>] <span class="sc">-</span> ylim[<span class="dv">1</span>] </span>
<span id="cb24-41"><a href="getting-started.html#cb24-41" tabindex="-1"></a>  <span class="co"># Set up the plot</span></span>
<span id="cb24-42"><a href="getting-started.html#cb24-42" tabindex="-1"></a>  ncoefs <span class="ot">&lt;-</span> <span class="fu">length</span>(methods)</span>
<span id="cb24-43"><a href="getting-started.html#cb24-43" tabindex="-1"></a>  <span class="fu">par</span>(<span class="at">mar =</span> <span class="fu">c</span>(<span class="fl">2.5</span>, <span class="dv">4</span>, <span class="dv">1</span>, <span class="dv">2</span>))</span>
<span id="cb24-44"><a href="getting-started.html#cb24-44" tabindex="-1"></a>  <span class="fu">plot</span>(<span class="dv">1</span><span class="sc">:</span> ncoefs, data[, <span class="dv">1</span>], <span class="at">xlim =</span> <span class="fu">c</span>(<span class="fl">0.5</span>, ncoefs <span class="sc">+</span> <span class="fl">0.5</span>), <span class="at">ylim =</span> ylim,</span>
<span id="cb24-45"><a href="getting-started.html#cb24-45" tabindex="-1"></a>       <span class="at">ylab =</span> <span class="st">&quot;&quot;</span>, <span class="at">xlab =</span> <span class="st">&quot;&quot;</span>, <span class="at">main =</span> <span class="st">&quot;&quot;</span>, </span>
<span id="cb24-46"><a href="getting-started.html#cb24-46" tabindex="-1"></a>       <span class="at">axes =</span> <span class="cn">FALSE</span>, <span class="at">xaxt =</span> <span class="st">&quot;n&quot;</span>, <span class="at">yaxt =</span> <span class="st">&quot;n&quot;</span>, <span class="at">type =</span> <span class="st">&quot;n&quot;</span>)</span>
<span id="cb24-47"><a href="getting-started.html#cb24-47" tabindex="-1"></a>  <span class="fu">axis</span>(<span class="dv">1</span>, <span class="at">at =</span> <span class="dv">1</span><span class="sc">:</span> ncoefs, <span class="at">labels =</span>  labels, <span class="at">las =</span> <span class="dv">1</span>, <span class="at">cex.axis =</span> <span class="fl">0.8</span>)</span>
<span id="cb24-48"><a href="getting-started.html#cb24-48" tabindex="-1"></a>  <span class="fu">axis</span>(<span class="dv">2</span>, <span class="at">cex.axis =</span> <span class="fl">0.7</span>)</span>
<span id="cb24-49"><a href="getting-started.html#cb24-49" tabindex="-1"></a>  <span class="fu">mtext</span>(main, main.pos, <span class="at">line =</span> main.line, <span class="at">cex =</span> textsize)</span>
<span id="cb24-50"><a href="getting-started.html#cb24-50" tabindex="-1"></a>  <span class="fu">mtext</span>(ylab, <span class="dv">2</span>, <span class="at">line =</span> <span class="fl">2.5</span>)</span>
<span id="cb24-51"><a href="getting-started.html#cb24-51" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">is.null</span>(band) <span class="sc">==</span> <span class="cn">FALSE</span>) {</span>
<span id="cb24-52"><a href="getting-started.html#cb24-52" tabindex="-1"></a>    <span class="fu">rect</span>(<span class="sc">-</span><span class="fl">0.5</span>, band[<span class="dv">1</span>], ncoefs <span class="sc">+</span> <span class="dv">1</span>, band[<span class="dv">2</span>], <span class="at">col =</span> <span class="st">&quot;#ff000030&quot;</span>, <span class="at">border =</span> <span class="st">&quot;white&quot;</span>) <span class="co"># label at bottom</span></span>
<span id="cb24-53"><a href="getting-started.html#cb24-53" tabindex="-1"></a>  }</span>
<span id="cb24-54"><a href="getting-started.html#cb24-54" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">is.null</span>(line) <span class="sc">==</span> <span class="cn">FALSE</span>) {</span>
<span id="cb24-55"><a href="getting-started.html#cb24-55" tabindex="-1"></a>    <span class="fu">abline</span>(<span class="at">h =</span> line, <span class="at">col =</span> <span class="st">&quot;red&quot;</span>, <span class="at">lty =</span> <span class="dv">2</span>)</span>
<span id="cb24-56"><a href="getting-started.html#cb24-56" tabindex="-1"></a>  }</span>
<span id="cb24-57"><a href="getting-started.html#cb24-57" tabindex="-1"></a>  <span class="cf">if</span> (grid <span class="sc">==</span> <span class="cn">TRUE</span>) {</span>
<span id="cb24-58"><a href="getting-started.html#cb24-58" tabindex="-1"></a>    <span class="fu">abline</span>(<span class="at">h =</span> <span class="fu">axTicks</span>(<span class="dv">2</span>), <span class="at">lty =</span> <span class="st">&quot;dotted&quot;</span>, <span class="at">col =</span> <span class="st">&quot;gray50&quot;</span>)</span>
<span id="cb24-59"><a href="getting-started.html#cb24-59" tabindex="-1"></a>    <span class="fu">abline</span>(<span class="at">v =</span> <span class="fu">c</span>(<span class="fl">0.5</span>, <span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span> ncoefs) <span class="sc">+</span> <span class="fl">0.5</span>), <span class="at">lty =</span> <span class="st">&quot;dotted&quot;</span>, <span class="at">col =</span> <span class="st">&quot;gray50&quot;</span>) <span class="co"># horizontal grid</span></span>
<span id="cb24-60"><a href="getting-started.html#cb24-60" tabindex="-1"></a>  }</span>
<span id="cb24-61"><a href="getting-started.html#cb24-61" tabindex="-1"></a>  <span class="fu">abline</span>(<span class="at">h =</span> <span class="dv">0</span>, <span class="at">col =</span> <span class="st">&quot;red&quot;</span>, <span class="at">lwd =</span> <span class="dv">2</span>, <span class="at">lty =</span> <span class="st">&quot;solid&quot;</span>)</span>
<span id="cb24-62"><a href="getting-started.html#cb24-62" tabindex="-1"></a>  <span class="fu">segments</span>(<span class="at">y0 =</span> data[, <span class="dv">3</span>], <span class="at">x0 =</span> <span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span> ncoefs), <span class="at">y1 =</span> data[, <span class="dv">4</span>], <span class="at">x1 =</span> <span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span> ncoefs), <span class="at">lwd =</span> <span class="dv">2</span>) <span class="co">#CI</span></span>
<span id="cb24-63"><a href="getting-started.html#cb24-63" tabindex="-1"></a>  <span class="fu">points</span>(<span class="dv">1</span><span class="sc">:</span> ncoefs, data[, <span class="dv">1</span>], <span class="at">pch =</span> <span class="dv">16</span>, <span class="at">col =</span> <span class="dv">1</span>, <span class="at">cex =</span> <span class="fl">1.2</span>) <span class="co">#point coefs</span></span>
<span id="cb24-64"><a href="getting-started.html#cb24-64" tabindex="-1"></a>  <span class="fu">box</span>()</span>
<span id="cb24-65"><a href="getting-started.html#cb24-65" tabindex="-1"></a>}</span></code></pre></div>
<p><code>save_att_panels()</code>*** generates and saves paginated pdf plots that display ATT estimates and their confidence bands from multiple methods.</p>
<div class="sourceCode" id="cb25"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb25-1"><a href="getting-started.html#cb25-1" tabindex="-1"></a>save_att_panels <span class="ot">&lt;-</span> <span class="cf">function</span>(</span>
<span id="cb25-2"><a href="getting-started.html#cb25-2" tabindex="-1"></a>    out_list, plot_titles, band_list, est_list,</span>
<span id="cb25-3"><a href="getting-started.html#cb25-3" tabindex="-1"></a>    <span class="at">prefix =</span> <span class="st">&quot;ldw_model_a_plus&quot;</span>,</span>
<span id="cb25-4"><a href="getting-started.html#cb25-4" tabindex="-1"></a>    <span class="at">plots_per_page =</span> <span class="dv">4</span>,</span>
<span id="cb25-5"><a href="getting-started.html#cb25-5" tabindex="-1"></a>    <span class="at">ylim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">15500</span>, <span class="dv">5500</span>),</span>
<span id="cb25-6"><a href="getting-started.html#cb25-6" tabindex="-1"></a>    <span class="at">folder =</span> <span class="st">&quot;graphs/lalonde&quot;</span>) {</span>
<span id="cb25-7"><a href="getting-started.html#cb25-7" tabindex="-1"></a>  <span class="cf">if</span> (<span class="sc">!</span><span class="fu">dir.exists</span>(folder)) <span class="fu">dir.create</span>(folder, <span class="at">recursive =</span> <span class="cn">TRUE</span>)</span>
<span id="cb25-8"><a href="getting-started.html#cb25-8" tabindex="-1"></a>  n <span class="ot">&lt;-</span> <span class="fu">length</span>(out_list)</span>
<span id="cb25-9"><a href="getting-started.html#cb25-9" tabindex="-1"></a>  pages <span class="ot">&lt;-</span> <span class="fu">ceiling</span>(n <span class="sc">/</span> plots_per_page)</span>
<span id="cb25-10"><a href="getting-started.html#cb25-10" tabindex="-1"></a>  </span>
<span id="cb25-11"><a href="getting-started.html#cb25-11" tabindex="-1"></a>  <span class="cf">for</span> (p <span class="cf">in</span> <span class="fu">seq_len</span>(pages)) {</span>
<span id="cb25-12"><a href="getting-started.html#cb25-12" tabindex="-1"></a>    start <span class="ot">&lt;-</span> (p <span class="sc">-</span> <span class="dv">1</span>) <span class="sc">*</span> plots_per_page <span class="sc">+</span> <span class="dv">1</span></span>
<span id="cb25-13"><a href="getting-started.html#cb25-13" tabindex="-1"></a>    end <span class="ot">&lt;-</span> <span class="fu">min</span>(p <span class="sc">*</span> plots_per_page, n)</span>
<span id="cb25-14"><a href="getting-started.html#cb25-14" tabindex="-1"></a>    file_name <span class="ot">&lt;-</span> <span class="fu">file.path</span>(folder, <span class="fu">paste0</span>(prefix, <span class="st">&quot;_&quot;</span>, p, <span class="st">&quot;.pdf&quot;</span>))</span>
<span id="cb25-15"><a href="getting-started.html#cb25-15" tabindex="-1"></a>    <span class="fu">pdf</span>(file_name, <span class="at">width =</span> <span class="dv">8</span>, <span class="at">height =</span> <span class="dv">11</span>)</span>
<span id="cb25-16"><a href="getting-started.html#cb25-16" tabindex="-1"></a>    <span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(plots_per_page, <span class="dv">1</span>), <span class="at">mar =</span> <span class="fu">c</span>(<span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">3</span>, <span class="dv">2</span>))</span>
<span id="cb25-17"><a href="getting-started.html#cb25-17" tabindex="-1"></a>    <span class="cf">for</span> (i <span class="cf">in</span> start<span class="sc">:</span>end) {</span>
<span id="cb25-18"><a href="getting-started.html#cb25-18" tabindex="-1"></a>      <span class="fu">plot_coef</span>(out_list[[i]], <span class="at">band =</span> band_list[[i]], <span class="at">line =</span> est_list[[i]],</span>
<span id="cb25-19"><a href="getting-started.html#cb25-19" tabindex="-1"></a>                <span class="at">ylim =</span> ylim, <span class="at">main =</span> plot_titles[i])</span>
<span id="cb25-20"><a href="getting-started.html#cb25-20" tabindex="-1"></a>    }</span>
<span id="cb25-21"><a href="getting-started.html#cb25-21" tabindex="-1"></a>    <span class="fu">dev.off</span>()</span>
<span id="cb25-22"><a href="getting-started.html#cb25-22" tabindex="-1"></a>  }</span>
<span id="cb25-23"><a href="getting-started.html#cb25-23" tabindex="-1"></a>}</span></code></pre></div>
<p><strong>Arguments</strong></p>
<ul>
<li><code>out_list</code>: A list of output objects containing ATT estimates and confidence intervals for different methods.</li>
<li><code>plot_titles</code>: A character vector of titles for each plot.</li>
<li><code>band_list</code>: A list of numeric vectors specifying the confidence interval bounds for each plot.</li>
<li><code>est_list</code>: A list or numeric vector representing the point estimates (ATT values) for each plot.</li>
<li><code>prefix</code>: A string prefix used for saved file names to identify sample (default is “ldw_model_a_plus”).</li>
<li><code>plots_per_page</code>: The number of plots to display per page / panel (default 4).</li>
<li><code>ylim</code>: A numeric vector specifying the y-axis limits for the plots.</li>
<li><code>folder</code>: A string specifying the folder path where the PDF panels will be saved (default is “graphs/lalonde”).</li>
</ul>
<p><code>create_matrix_results()</code> organizes estimation results into a formatted matrix suitable for reporting or tables.</p>
<div class="sourceCode" id="cb26"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb26-1"><a href="getting-started.html#cb26-1" tabindex="-1"></a>create_matrix_results <span class="ot">&lt;-</span> <span class="cf">function</span>(all_outs, all_out_mat, sample_names) {</span>
<span id="cb26-2"><a href="getting-started.html#cb26-2" tabindex="-1"></a>  n_samples <span class="ot">&lt;-</span> <span class="fu">length</span>(sample_names)</span>
<span id="cb26-3"><a href="getting-started.html#cb26-3" tabindex="-1"></a>  n_estimators <span class="ot">&lt;-</span> <span class="fu">nrow</span>(all_outs[[<span class="dv">1</span>]])</span>
<span id="cb26-4"><a href="getting-started.html#cb26-4" tabindex="-1"></a>  result_mat <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="st">&quot;&quot;</span>, <span class="at">nrow =</span> n_estimators <span class="sc">+</span> <span class="dv">1</span>, <span class="at">ncol =</span> n_samples <span class="sc">*</span> <span class="dv">2</span>)</span>
<span id="cb26-5"><a href="getting-started.html#cb26-5" tabindex="-1"></a>  cnames <span class="ot">&lt;-</span> <span class="fu">character</span>(n_samples <span class="sc">*</span> <span class="dv">2</span>)</span>
<span id="cb26-6"><a href="getting-started.html#cb26-6" tabindex="-1"></a>  <span class="cf">for</span> (j <span class="cf">in</span> <span class="fu">seq_along</span>(sample_names)) {</span>
<span id="cb26-7"><a href="getting-started.html#cb26-7" tabindex="-1"></a>    cnames[(j <span class="sc">-</span> <span class="dv">1</span>) <span class="sc">*</span> <span class="dv">2</span> <span class="sc">+</span> <span class="dv">1</span>] <span class="ot">&lt;-</span> sample_names[j]</span>
<span id="cb26-8"><a href="getting-started.html#cb26-8" tabindex="-1"></a>    cnames[(j <span class="sc">-</span> <span class="dv">1</span>) <span class="sc">*</span> <span class="dv">2</span> <span class="sc">+</span> <span class="dv">2</span>] <span class="ot">&lt;-</span> <span class="st">&quot;&quot;</span></span>
<span id="cb26-9"><a href="getting-started.html#cb26-9" tabindex="-1"></a>  }</span>
<span id="cb26-10"><a href="getting-started.html#cb26-10" tabindex="-1"></a>  <span class="fu">colnames</span>(result_mat) <span class="ot">&lt;-</span> cnames</span>
<span id="cb26-11"><a href="getting-started.html#cb26-11" tabindex="-1"></a>  estimator_names <span class="ot">&lt;-</span> <span class="fu">rownames</span>(all_outs[[<span class="dv">1</span>]])</span>
<span id="cb26-12"><a href="getting-started.html#cb26-12" tabindex="-1"></a>  <span class="fu">rownames</span>(result_mat) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;Experimental Benchmark&quot;</span>, estimator_names)</span>
<span id="cb26-13"><a href="getting-started.html#cb26-13" tabindex="-1"></a>  <span class="co"># all_out_mat contains 13 entries</span></span>
<span id="cb26-14"><a href="getting-started.html#cb26-14" tabindex="-1"></a>  bench.exp      <span class="ot">&lt;-</span> <span class="cf">if</span>(<span class="sc">!</span><span class="fu">is.null</span>(all_out_mat[[<span class="dv">1</span>]])) all_out_mat[[<span class="dv">1</span>]][<span class="dv">1</span>, <span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>] <span class="cf">else</span> <span class="fu">c</span>(<span class="cn">NA</span>, <span class="cn">NA</span>)</span>
<span id="cb26-15"><a href="getting-started.html#cb26-15" tabindex="-1"></a>  bench.cps      <span class="ot">&lt;-</span> <span class="cf">if</span>(<span class="fu">length</span>(all_out_mat) <span class="sc">&gt;=</span> <span class="dv">6</span>) <span class="fu">lapply</span>(all_out_mat[<span class="dv">2</span><span class="sc">:</span><span class="dv">6</span>], <span class="cf">function</span>(x) <span class="cf">if</span>(<span class="sc">!</span><span class="fu">is.null</span>(x)) x[<span class="dv">1</span>, <span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>] <span class="cf">else</span> <span class="fu">c</span>(<span class="cn">NA</span>, <span class="cn">NA</span>)) <span class="cf">else</span> <span class="cn">NULL</span></span>
<span id="cb26-16"><a href="getting-started.html#cb26-16" tabindex="-1"></a>  bench.psid     <span class="ot">&lt;-</span> <span class="cf">if</span>(<span class="fu">length</span>(all_out_mat) <span class="sc">&gt;=</span> <span class="dv">11</span>) <span class="fu">lapply</span>(all_out_mat[<span class="dv">7</span><span class="sc">:</span><span class="dv">11</span>], <span class="cf">function</span>(x) <span class="cf">if</span>(<span class="sc">!</span><span class="fu">is.null</span>(x)) x[<span class="dv">1</span>, <span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>] <span class="cf">else</span> <span class="fu">c</span>(<span class="cn">NA</span>, <span class="cn">NA</span>)) <span class="cf">else</span> <span class="cn">NULL</span></span>
<span id="cb26-17"><a href="getting-started.html#cb26-17" tabindex="-1"></a>  bench.cps_plus <span class="ot">&lt;-</span> <span class="cf">if</span>(<span class="fu">length</span>(all_out_mat) <span class="sc">&gt;=</span> <span class="dv">12</span> <span class="sc">&amp;&amp;</span> <span class="sc">!</span><span class="fu">is.null</span>(all_out_mat[[<span class="dv">12</span>]])) all_out_mat[[<span class="dv">12</span>]][<span class="dv">1</span>, <span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>] <span class="cf">else</span> <span class="fu">c</span>(<span class="cn">NA</span>, <span class="cn">NA</span>)</span>
<span id="cb26-18"><a href="getting-started.html#cb26-18" tabindex="-1"></a>  bench.psid_plus<span class="ot">&lt;-</span> <span class="cf">if</span>(<span class="fu">length</span>(all_out_mat) <span class="sc">&gt;=</span> <span class="dv">13</span> <span class="sc">&amp;&amp;</span> <span class="sc">!</span><span class="fu">is.null</span>(all_out_mat[[<span class="dv">13</span>]])) all_out_mat[[<span class="dv">13</span>]][<span class="dv">1</span>, <span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>] <span class="cf">else</span> <span class="fu">c</span>(<span class="cn">NA</span>, <span class="cn">NA</span>)</span>
<span id="cb26-19"><a href="getting-started.html#cb26-19" tabindex="-1"></a>  <span class="co"># all_outs contains 15 entries</span></span>
<span id="cb26-20"><a href="getting-started.html#cb26-20" tabindex="-1"></a>  <span class="cf">for</span> (j <span class="cf">in</span> <span class="fu">seq_along</span>(all_outs)) {</span>
<span id="cb26-21"><a href="getting-started.html#cb26-21" tabindex="-1"></a>    out <span class="ot">&lt;-</span> all_outs[[j]]</span>
<span id="cb26-22"><a href="getting-started.html#cb26-22" tabindex="-1"></a>    <span class="co"># assign benchmark according to position</span></span>
<span id="cb26-23"><a href="getting-started.html#cb26-23" tabindex="-1"></a>    <span class="co"># use bench.exp for the first 3 entries in all_outs</span></span>
<span id="cb26-24"><a href="getting-started.html#cb26-24" tabindex="-1"></a>    <span class="cf">if</span> (j <span class="sc">&lt;=</span> <span class="dv">3</span> <span class="sc">&amp;&amp;</span> <span class="sc">!</span><span class="fu">any</span>(<span class="fu">is.na</span>(bench.exp))) {</span>
<span id="cb26-25"><a href="getting-started.html#cb26-25" tabindex="-1"></a>      result_mat[<span class="dv">1</span>, (j <span class="sc">-</span> <span class="dv">1</span>) <span class="sc">*</span> <span class="dv">2</span> <span class="sc">+</span> <span class="dv">1</span>] <span class="ot">&lt;-</span> <span class="fu">sprintf</span>(<span class="st">&quot;%.2f&quot;</span>, bench.exp[<span class="dv">1</span>])</span>
<span id="cb26-26"><a href="getting-started.html#cb26-26" tabindex="-1"></a>      result_mat[<span class="dv">1</span>, (j <span class="sc">-</span> <span class="dv">1</span>) <span class="sc">*</span> <span class="dv">2</span> <span class="sc">+</span> <span class="dv">2</span>] <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">&quot;(&quot;</span>, <span class="fu">sprintf</span>(<span class="st">&quot;%.2f&quot;</span>, bench.exp[<span class="dv">2</span>]), <span class="st">&quot;)&quot;</span>)</span>
<span id="cb26-27"><a href="getting-started.html#cb26-27" tabindex="-1"></a>    }</span>
<span id="cb26-28"><a href="getting-started.html#cb26-28" tabindex="-1"></a>    <span class="co"># use bench.cps for the next 5 entries in all_outs</span></span>
<span id="cb26-29"><a href="getting-started.html#cb26-29" tabindex="-1"></a>    <span class="co"># use all entries in bench.cps one after another</span></span>
<span id="cb26-30"><a href="getting-started.html#cb26-30" tabindex="-1"></a>    <span class="cf">if</span> (j <span class="sc">&gt;=</span> <span class="dv">4</span> <span class="sc">&amp;&amp;</span> j <span class="sc">&lt;=</span> <span class="dv">8</span> <span class="sc">&amp;&amp;</span> <span class="sc">!</span><span class="fu">is.null</span>(bench.cps) <span class="sc">&amp;&amp;</span> <span class="fu">length</span>(bench.cps) <span class="sc">&gt;=</span> (j <span class="sc">-</span> <span class="dv">3</span>)) {</span>
<span id="cb26-31"><a href="getting-started.html#cb26-31" tabindex="-1"></a>      b <span class="ot">&lt;-</span> bench.cps[[j <span class="sc">-</span> <span class="dv">3</span>]]</span>
<span id="cb26-32"><a href="getting-started.html#cb26-32" tabindex="-1"></a>      result_mat[<span class="dv">1</span>, (j <span class="sc">-</span> <span class="dv">1</span>) <span class="sc">*</span> <span class="dv">2</span> <span class="sc">+</span> <span class="dv">1</span>] <span class="ot">&lt;-</span> <span class="fu">sprintf</span>(<span class="st">&quot;%.2f&quot;</span>, b[<span class="dv">1</span>])</span>
<span id="cb26-33"><a href="getting-started.html#cb26-33" tabindex="-1"></a>      result_mat[<span class="dv">1</span>, (j <span class="sc">-</span> <span class="dv">1</span>) <span class="sc">*</span> <span class="dv">2</span> <span class="sc">+</span> <span class="dv">2</span>] <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">&quot;(&quot;</span>, <span class="fu">sprintf</span>(<span class="st">&quot;%.2f&quot;</span>, b[<span class="dv">2</span>]), <span class="st">&quot;)&quot;</span>)</span>
<span id="cb26-34"><a href="getting-started.html#cb26-34" tabindex="-1"></a>    }</span>
<span id="cb26-35"><a href="getting-started.html#cb26-35" tabindex="-1"></a>    <span class="co"># use bench.psid for the next 5 entries in all_outs</span></span>
<span id="cb26-36"><a href="getting-started.html#cb26-36" tabindex="-1"></a>    <span class="co"># use all entries in bench.psid one after another</span></span>
<span id="cb26-37"><a href="getting-started.html#cb26-37" tabindex="-1"></a>    <span class="cf">if</span> (j <span class="sc">&gt;=</span> <span class="dv">9</span> <span class="sc">&amp;&amp;</span> j <span class="sc">&lt;=</span> <span class="dv">13</span> <span class="sc">&amp;&amp;</span> <span class="sc">!</span><span class="fu">is.null</span>(bench.psid) <span class="sc">&amp;&amp;</span> <span class="fu">length</span>(bench.psid) <span class="sc">&gt;=</span> (j <span class="sc">-</span> <span class="dv">8</span>)) {</span>
<span id="cb26-38"><a href="getting-started.html#cb26-38" tabindex="-1"></a>      b <span class="ot">&lt;-</span> bench.psid[[j <span class="sc">-</span> <span class="dv">8</span>]]</span>
<span id="cb26-39"><a href="getting-started.html#cb26-39" tabindex="-1"></a>      result_mat[<span class="dv">1</span>, (j <span class="sc">-</span> <span class="dv">1</span>) <span class="sc">*</span> <span class="dv">2</span> <span class="sc">+</span> <span class="dv">1</span>] <span class="ot">&lt;-</span> <span class="fu">sprintf</span>(<span class="st">&quot;%.2f&quot;</span>, b[<span class="dv">1</span>])</span>
<span id="cb26-40"><a href="getting-started.html#cb26-40" tabindex="-1"></a>      result_mat[<span class="dv">1</span>, (j <span class="sc">-</span> <span class="dv">1</span>) <span class="sc">*</span> <span class="dv">2</span> <span class="sc">+</span> <span class="dv">2</span>] <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">&quot;(&quot;</span>, <span class="fu">sprintf</span>(<span class="st">&quot;%.2f&quot;</span>, b[<span class="dv">2</span>]), <span class="st">&quot;)&quot;</span>)</span>
<span id="cb26-41"><a href="getting-started.html#cb26-41" tabindex="-1"></a>    }</span>
<span id="cb26-42"><a href="getting-started.html#cb26-42" tabindex="-1"></a>    <span class="co"># use bench.cps_plus for the second last entry in all_outs</span></span>
<span id="cb26-43"><a href="getting-started.html#cb26-43" tabindex="-1"></a>    <span class="cf">if</span> (j <span class="sc">==</span> n_samples <span class="sc">-</span> <span class="dv">1</span> <span class="sc">&amp;&amp;</span> <span class="sc">!</span><span class="fu">any</span>(<span class="fu">is.na</span>(bench.cps_plus))) {</span>
<span id="cb26-44"><a href="getting-started.html#cb26-44" tabindex="-1"></a>      result_mat[<span class="dv">1</span>, (j <span class="sc">-</span> <span class="dv">1</span>) <span class="sc">*</span> <span class="dv">2</span> <span class="sc">+</span> <span class="dv">1</span>] <span class="ot">&lt;-</span> <span class="fu">sprintf</span>(<span class="st">&quot;%.2f&quot;</span>, bench.cps_plus[<span class="dv">1</span>])</span>
<span id="cb26-45"><a href="getting-started.html#cb26-45" tabindex="-1"></a>      result_mat[<span class="dv">1</span>, (j <span class="sc">-</span> <span class="dv">1</span>) <span class="sc">*</span> <span class="dv">2</span> <span class="sc">+</span> <span class="dv">2</span>] <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">&quot;(&quot;</span>, <span class="fu">sprintf</span>(<span class="st">&quot;%.2f&quot;</span>, bench.cps_plus[<span class="dv">2</span>]), <span class="st">&quot;)&quot;</span>)</span>
<span id="cb26-46"><a href="getting-started.html#cb26-46" tabindex="-1"></a>    }</span>
<span id="cb26-47"><a href="getting-started.html#cb26-47" tabindex="-1"></a>    <span class="co"># use bench.psid_plus for the last entry in all_outs</span></span>
<span id="cb26-48"><a href="getting-started.html#cb26-48" tabindex="-1"></a>    <span class="cf">if</span> (j <span class="sc">==</span> n_samples <span class="sc">&amp;&amp;</span> <span class="sc">!</span><span class="fu">any</span>(<span class="fu">is.na</span>(bench.psid_plus))) {</span>
<span id="cb26-49"><a href="getting-started.html#cb26-49" tabindex="-1"></a>      result_mat[<span class="dv">1</span>, (j <span class="sc">-</span> <span class="dv">1</span>) <span class="sc">*</span> <span class="dv">2</span> <span class="sc">+</span> <span class="dv">1</span>] <span class="ot">&lt;-</span> <span class="fu">sprintf</span>(<span class="st">&quot;%.2f&quot;</span>, bench.psid_plus[<span class="dv">1</span>])</span>
<span id="cb26-50"><a href="getting-started.html#cb26-50" tabindex="-1"></a>      result_mat[<span class="dv">1</span>, (j <span class="sc">-</span> <span class="dv">1</span>) <span class="sc">*</span> <span class="dv">2</span> <span class="sc">+</span> <span class="dv">2</span>] <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">&quot;(&quot;</span>, <span class="fu">sprintf</span>(<span class="st">&quot;%.2f&quot;</span>, bench.psid_plus[<span class="dv">2</span>]), <span class="st">&quot;)&quot;</span>)</span>
<span id="cb26-51"><a href="getting-started.html#cb26-51" tabindex="-1"></a>    }</span>
<span id="cb26-52"><a href="getting-started.html#cb26-52" tabindex="-1"></a>    <span class="co"># fill in estimates + SEs</span></span>
<span id="cb26-53"><a href="getting-started.html#cb26-53" tabindex="-1"></a>    <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">2</span><span class="sc">:</span>(n_estimators <span class="sc">+</span> <span class="dv">1</span>)) {</span>
<span id="cb26-54"><a href="getting-started.html#cb26-54" tabindex="-1"></a>      <span class="cf">if</span> ((i<span class="dv">-1</span>) <span class="sc">&lt;=</span> <span class="fu">nrow</span>(out)) {</span>
<span id="cb26-55"><a href="getting-started.html#cb26-55" tabindex="-1"></a>        result_mat[i, (j <span class="sc">-</span> <span class="dv">1</span>) <span class="sc">*</span> <span class="dv">2</span> <span class="sc">+</span> <span class="dv">1</span>] <span class="ot">&lt;-</span> <span class="fu">sprintf</span>(<span class="st">&quot;%.2f&quot;</span>, out[i <span class="sc">-</span> <span class="dv">1</span>, <span class="dv">1</span>])</span>
<span id="cb26-56"><a href="getting-started.html#cb26-56" tabindex="-1"></a>        result_mat[i, (j <span class="sc">-</span> <span class="dv">1</span>) <span class="sc">*</span> <span class="dv">2</span> <span class="sc">+</span> <span class="dv">2</span>] <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">&quot;(&quot;</span>, <span class="fu">sprintf</span>(<span class="st">&quot;%.2f&quot;</span>, out[i <span class="sc">-</span> <span class="dv">1</span>, <span class="dv">2</span>]), <span class="st">&quot;)&quot;</span>)</span>
<span id="cb26-57"><a href="getting-started.html#cb26-57" tabindex="-1"></a>      } <span class="cf">else</span> {</span>
<span id="cb26-58"><a href="getting-started.html#cb26-58" tabindex="-1"></a>        result_mat[i, (j <span class="sc">-</span> <span class="dv">1</span>) <span class="sc">*</span> <span class="dv">2</span> <span class="sc">+</span> <span class="dv">1</span>] <span class="ot">&lt;-</span> <span class="st">&quot;&quot;</span></span>
<span id="cb26-59"><a href="getting-started.html#cb26-59" tabindex="-1"></a>        result_mat[i, (j <span class="sc">-</span> <span class="dv">1</span>) <span class="sc">*</span> <span class="dv">2</span> <span class="sc">+</span> <span class="dv">2</span>] <span class="ot">&lt;-</span> <span class="st">&quot;&quot;</span></span>
<span id="cb26-60"><a href="getting-started.html#cb26-60" tabindex="-1"></a>      }</span>
<span id="cb26-61"><a href="getting-started.html#cb26-61" tabindex="-1"></a>    }</span>
<span id="cb26-62"><a href="getting-started.html#cb26-62" tabindex="-1"></a>  }</span>
<span id="cb26-63"><a href="getting-started.html#cb26-63" tabindex="-1"></a>  <span class="fu">return</span>(result_mat)</span>
<span id="cb26-64"><a href="getting-started.html#cb26-64" tabindex="-1"></a>}</span></code></pre></div>
<p><strong>Arguments</strong></p>
<ul>
<li><code>all_outs</code>: A list of output objects containing ATT estimates and confidence intervals for different methods.</li>
<li><code>all_out_mat</code>: A list of objects containing ATT estimates and confidence intervals for different methods used for benchmark construction.</li>
<li><code>sample_names</code>: A character vector of sample names corresponding to <code>all_outs</code>.</li>
</ul>
<p><code>eval_att()</code> computes summary statistics of the treatment effect estimates.</p>
<div class="sourceCode" id="cb27"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb27-1"><a href="getting-started.html#cb27-1" tabindex="-1"></a>eval_att <span class="ot">&lt;-</span> <span class="cf">function</span>(data) {</span>
<span id="cb27-2"><a href="getting-started.html#cb27-2" tabindex="-1"></a>  <span class="fu">data.frame</span>(</span>
<span id="cb27-3"><a href="getting-started.html#cb27-3" tabindex="-1"></a>    <span class="at">Mean_SE =</span> <span class="fu">mean</span>(data[, <span class="st">&quot;SE&quot;</span>], <span class="at">na.rm =</span> <span class="cn">TRUE</span>), <span class="co"># mean standard error</span></span>
<span id="cb27-4"><a href="getting-started.html#cb27-4" tabindex="-1"></a>    <span class="at">Min_Estimate =</span> <span class="fu">min</span>(data[, <span class="st">&quot;Estimate&quot;</span>], <span class="at">na.rm =</span> <span class="cn">TRUE</span>), <span class="co"># maximum estimate </span></span>
<span id="cb27-5"><a href="getting-started.html#cb27-5" tabindex="-1"></a>    <span class="at">Max_Estimate =</span> <span class="fu">max</span>(data[, <span class="st">&quot;Estimate&quot;</span>], <span class="at">na.rm =</span> <span class="cn">TRUE</span>), <span class="co"># minimum estimate </span></span>
<span id="cb27-6"><a href="getting-started.html#cb27-6" tabindex="-1"></a>    <span class="at">Diff_Estimate =</span> <span class="fu">max</span>(data[, <span class="st">&quot;Estimate&quot;</span>], <span class="at">na.rm =</span> <span class="cn">TRUE</span>) <span class="sc">-</span> <span class="fu">min</span>(data[, <span class="st">&quot;Estimate&quot;</span>], <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb27-7"><a href="getting-started.html#cb27-7" tabindex="-1"></a>  )</span>
<span id="cb27-8"><a href="getting-started.html#cb27-8" tabindex="-1"></a>}</span></code></pre></div>
<p><strong>Argument</strong></p>
<ul>
<li><code>data</code>: A data frame containing treatment effect estimation results.</li>
</ul>
</div>
<div id="conditional-average-treatment-effect-on-the-treated-catt" class="section level4 hasAnchor" number="1.2.6.2">
<h4><span class="header-section-number">1.2.6.2</span> Conditional average treatment effect on the treated (CATT)<a href="getting-started.html#conditional-average-treatment-effect-on-the-treated-catt" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p><code>plot_catt_panels()</code>*** visualizes CATT comparing multiple methods.</p>
<div class="sourceCode" id="cb28"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb28-1"><a href="getting-started.html#cb28-1" tabindex="-1"></a>plot_catt_panels <span class="ot">&lt;-</span> <span class="cf">function</span>(exp_catt_list, catt_list, plot_titles, <span class="at">plots_per_page =</span> <span class="dv">4</span>, <span class="at">range =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">8000</span>, <span class="dv">8000</span>)) {</span>
<span id="cb28-2"><a href="getting-started.html#cb28-2" tabindex="-1"></a>  n <span class="ot">&lt;-</span> <span class="fu">length</span>(catt_list)</span>
<span id="cb28-3"><a href="getting-started.html#cb28-3" tabindex="-1"></a>  num_pages <span class="ot">&lt;-</span> <span class="fu">ceiling</span>(n <span class="sc">/</span> plots_per_page)</span>
<span id="cb28-4"><a href="getting-started.html#cb28-4" tabindex="-1"></a>  <span class="cf">for</span> (page <span class="cf">in</span> <span class="fu">seq_len</span>(num_pages)) {</span>
<span id="cb28-5"><a href="getting-started.html#cb28-5" tabindex="-1"></a>    start_idx <span class="ot">&lt;-</span> (page <span class="sc">-</span> <span class="dv">1</span>) <span class="sc">*</span> plots_per_page <span class="sc">+</span> <span class="dv">1</span></span>
<span id="cb28-6"><a href="getting-started.html#cb28-6" tabindex="-1"></a>    end_idx   <span class="ot">&lt;-</span> <span class="fu">min</span>(page <span class="sc">*</span> plots_per_page, n)</span>
<span id="cb28-7"><a href="getting-started.html#cb28-7" tabindex="-1"></a>    <span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">2</span>), <span class="at">mar =</span> <span class="fu">c</span>(<span class="fl">4.5</span>, <span class="dv">5</span>, <span class="dv">3</span>, <span class="dv">2</span>))</span>
<span id="cb28-8"><a href="getting-started.html#cb28-8" tabindex="-1"></a>    <span class="cf">for</span> (i <span class="cf">in</span> start_idx<span class="sc">:</span>end_idx) {</span>
<span id="cb28-9"><a href="getting-started.html#cb28-9" tabindex="-1"></a>      catt_ldw <span class="ot">&lt;-</span> exp_catt_list[[i]]<span class="sc">$</span>catt</span>
<span id="cb28-10"><a href="getting-started.html#cb28-10" tabindex="-1"></a>      att_ldw  <span class="ot">&lt;-</span> exp_catt_list[[i]]<span class="sc">$</span>att[<span class="dv">1</span>]</span>
<span id="cb28-11"><a href="getting-started.html#cb28-11" tabindex="-1"></a>      id_ldw   <span class="ot">&lt;-</span> <span class="cf">if</span> (<span class="sc">!</span><span class="fu">is.null</span>(exp_catt_list[[i]]<span class="sc">$</span>id)) exp_catt_list[[i]]<span class="sc">$</span>id <span class="cf">else</span> <span class="fu">seq_along</span>(catt_ldw)</span>
<span id="cb28-12"><a href="getting-started.html#cb28-12" tabindex="-1"></a>      catt2 <span class="ot">&lt;-</span> catt_list[[i]]<span class="sc">$</span>catt</span>
<span id="cb28-13"><a href="getting-started.html#cb28-13" tabindex="-1"></a>      att2  <span class="ot">&lt;-</span> catt_list[[i]]<span class="sc">$</span>att[<span class="dv">1</span>]</span>
<span id="cb28-14"><a href="getting-started.html#cb28-14" tabindex="-1"></a>      id2   <span class="ot">&lt;-</span> <span class="cf">if</span> (<span class="sc">!</span><span class="fu">is.null</span>(catt_list[[i]]<span class="sc">$</span>id)) catt_list[[i]]<span class="sc">$</span>id <span class="cf">else</span> <span class="fu">seq_along</span>(catt2)</span>
<span id="cb28-15"><a href="getting-started.html#cb28-15" tabindex="-1"></a>      common_ids <span class="ot">&lt;-</span> <span class="fu">intersect</span>(id_ldw, id2)</span>
<span id="cb28-16"><a href="getting-started.html#cb28-16" tabindex="-1"></a>      idx_ldw    <span class="ot">&lt;-</span> <span class="fu">match</span>(common_ids, id_ldw)</span>
<span id="cb28-17"><a href="getting-started.html#cb28-17" tabindex="-1"></a>      idx_other  <span class="ot">&lt;-</span> <span class="fu">match</span>(common_ids, id2)</span>
<span id="cb28-18"><a href="getting-started.html#cb28-18" tabindex="-1"></a>      catt1_plot <span class="ot">&lt;-</span> catt_ldw[idx_ldw]</span>
<span id="cb28-19"><a href="getting-started.html#cb28-19" tabindex="-1"></a>      catt2_plot <span class="ot">&lt;-</span> catt2[idx_other]</span>
<span id="cb28-20"><a href="getting-started.html#cb28-20" tabindex="-1"></a>      <span class="fu">plot_catt</span>(</span>
<span id="cb28-21"><a href="getting-started.html#cb28-21" tabindex="-1"></a>        <span class="at">catt1 =</span> catt1_plot,</span>
<span id="cb28-22"><a href="getting-started.html#cb28-22" tabindex="-1"></a>        <span class="at">catt2 =</span> catt2_plot,</span>
<span id="cb28-23"><a href="getting-started.html#cb28-23" tabindex="-1"></a>        <span class="at">att1  =</span> att_ldw,</span>
<span id="cb28-24"><a href="getting-started.html#cb28-24" tabindex="-1"></a>        <span class="at">att2  =</span> att2,</span>
<span id="cb28-25"><a href="getting-started.html#cb28-25" tabindex="-1"></a>        <span class="at">xlab  =</span> <span class="st">&quot;CATT (Experimental)&quot;</span>,</span>
<span id="cb28-26"><a href="getting-started.html#cb28-26" tabindex="-1"></a>        <span class="at">ylab  =</span> plot_titles[i],</span>
<span id="cb28-27"><a href="getting-started.html#cb28-27" tabindex="-1"></a>        <span class="at">main  =</span> plot_titles[i],</span>
<span id="cb28-28"><a href="getting-started.html#cb28-28" tabindex="-1"></a>        <span class="at">axes.range =</span> range</span>
<span id="cb28-29"><a href="getting-started.html#cb28-29" tabindex="-1"></a>      )</span>
<span id="cb28-30"><a href="getting-started.html#cb28-30" tabindex="-1"></a>    }</span>
<span id="cb28-31"><a href="getting-started.html#cb28-31" tabindex="-1"></a>  }</span>
<span id="cb28-32"><a href="getting-started.html#cb28-32" tabindex="-1"></a>}</span></code></pre></div>
<p><strong>Arguments</strong></p>
<ul>
<li><code>exp_catt_list</code>: A list of objects containing CATT estimates used as experimental benchmark.</li>
<li><code>catt_list</code>: A list of objects containing CATT estimates from each comparison with the experimental benchmark.</li>
<li><code>plot_titles</code>: A character vector of titles for each plot.</li>
<li><code>plots_per_page</code>: The number of plots to display per page / panel (default 4).</li>
<li><code>range</code>: A numeric vector of axis limits for plots (default c(-8000, 8000)).</li>
</ul>
<p><code>save_catt_panels()</code>*** generates and saves multi-page PDF plots comparing CATT estimates across different methods.</p>
<div class="sourceCode" id="cb29"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb29-1"><a href="getting-started.html#cb29-1" tabindex="-1"></a>save_catt_panels <span class="ot">&lt;-</span> <span class="cf">function</span>(</span>
<span id="cb29-2"><a href="getting-started.html#cb29-2" tabindex="-1"></a>    exp_catt_list,   </span>
<span id="cb29-3"><a href="getting-started.html#cb29-3" tabindex="-1"></a>    catt_list, </span>
<span id="cb29-4"><a href="getting-started.html#cb29-4" tabindex="-1"></a>    plot_titles, </span>
<span id="cb29-5"><a href="getting-started.html#cb29-5" tabindex="-1"></a>    <span class="at">prefix =</span> <span class="st">&quot;catt_top5&quot;</span>, </span>
<span id="cb29-6"><a href="getting-started.html#cb29-6" tabindex="-1"></a>    <span class="at">plots_per_page =</span> <span class="dv">1</span>, </span>
<span id="cb29-7"><a href="getting-started.html#cb29-7" tabindex="-1"></a>    <span class="at">range =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">8000</span>, <span class="dv">8000</span>), </span>
<span id="cb29-8"><a href="getting-started.html#cb29-8" tabindex="-1"></a>    <span class="at">folder =</span> <span class="st">&quot;graphs/lalonde&quot;</span>) {</span>
<span id="cb29-9"><a href="getting-started.html#cb29-9" tabindex="-1"></a>  <span class="cf">if</span> (<span class="sc">!</span><span class="fu">dir.exists</span>(folder)) <span class="fu">dir.create</span>(folder, <span class="at">recursive =</span> <span class="cn">TRUE</span>)</span>
<span id="cb29-10"><a href="getting-started.html#cb29-10" tabindex="-1"></a>  n <span class="ot">&lt;-</span> <span class="fu">length</span>(catt_list)</span>
<span id="cb29-11"><a href="getting-started.html#cb29-11" tabindex="-1"></a>  num_pages <span class="ot">&lt;-</span> <span class="fu">ceiling</span>(n <span class="sc">/</span> plots_per_page)</span>
<span id="cb29-12"><a href="getting-started.html#cb29-12" tabindex="-1"></a>  <span class="cf">for</span> (page <span class="cf">in</span> <span class="fu">seq_len</span>(num_pages)) {</span>
<span id="cb29-13"><a href="getting-started.html#cb29-13" tabindex="-1"></a>    start_idx <span class="ot">&lt;-</span> (page <span class="sc">-</span> <span class="dv">1</span>) <span class="sc">*</span> plots_per_page <span class="sc">+</span> <span class="dv">1</span></span>
<span id="cb29-14"><a href="getting-started.html#cb29-14" tabindex="-1"></a>    end_idx   <span class="ot">&lt;-</span> <span class="fu">min</span>(page <span class="sc">*</span> plots_per_page, n)</span>
<span id="cb29-15"><a href="getting-started.html#cb29-15" tabindex="-1"></a>    file_name <span class="ot">&lt;-</span> <span class="fu">file.path</span>(folder, <span class="fu">paste0</span>(prefix, <span class="st">&quot;_&quot;</span>, page, <span class="st">&quot;.pdf&quot;</span>))</span>
<span id="cb29-16"><a href="getting-started.html#cb29-16" tabindex="-1"></a>    <span class="fu">pdf</span>(<span class="at">file =</span> file_name, <span class="at">width =</span> <span class="dv">10</span>, <span class="at">height =</span> <span class="dv">12</span>)</span>
<span id="cb29-17"><a href="getting-started.html#cb29-17" tabindex="-1"></a>    <span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(plots_per_page, <span class="dv">1</span>), <span class="at">mar =</span> <span class="fu">c</span>(<span class="fl">4.5</span>, <span class="dv">5</span>, <span class="dv">3</span>, <span class="dv">2</span>))</span>
<span id="cb29-18"><a href="getting-started.html#cb29-18" tabindex="-1"></a>    <span class="cf">for</span> (i <span class="cf">in</span> start_idx<span class="sc">:</span>end_idx) {</span>
<span id="cb29-19"><a href="getting-started.html#cb29-19" tabindex="-1"></a>      <span class="co"># Use matching elements from both lists</span></span>
<span id="cb29-20"><a href="getting-started.html#cb29-20" tabindex="-1"></a>      catt_ldw <span class="ot">&lt;-</span> exp_catt_list[[i]]<span class="sc">$</span>catt</span>
<span id="cb29-21"><a href="getting-started.html#cb29-21" tabindex="-1"></a>      att_ldw  <span class="ot">&lt;-</span> exp_catt_list[[i]]<span class="sc">$</span>att[<span class="dv">1</span>]</span>
<span id="cb29-22"><a href="getting-started.html#cb29-22" tabindex="-1"></a>      id_ldw   <span class="ot">&lt;-</span> <span class="cf">if</span> (<span class="sc">!</span><span class="fu">is.null</span>(exp_catt_list[[i]]<span class="sc">$</span>id)) exp_catt_list[[i]]<span class="sc">$</span>id <span class="cf">else</span> <span class="fu">seq_along</span>(catt_ldw)</span>
<span id="cb29-23"><a href="getting-started.html#cb29-23" tabindex="-1"></a>      catt2 <span class="ot">&lt;-</span> catt_list[[i]]<span class="sc">$</span>catt</span>
<span id="cb29-24"><a href="getting-started.html#cb29-24" tabindex="-1"></a>      att2  <span class="ot">&lt;-</span> catt_list[[i]]<span class="sc">$</span>att[<span class="dv">1</span>]</span>
<span id="cb29-25"><a href="getting-started.html#cb29-25" tabindex="-1"></a>      id2   <span class="ot">&lt;-</span> <span class="cf">if</span> (<span class="sc">!</span><span class="fu">is.null</span>(catt_list[[i]]<span class="sc">$</span>id)) catt_list[[i]]<span class="sc">$</span>id <span class="cf">else</span> <span class="fu">seq_along</span>(catt2)</span>
<span id="cb29-26"><a href="getting-started.html#cb29-26" tabindex="-1"></a>      common_ids <span class="ot">&lt;-</span> <span class="fu">intersect</span>(id_ldw, id2)</span>
<span id="cb29-27"><a href="getting-started.html#cb29-27" tabindex="-1"></a>      idx_ldw    <span class="ot">&lt;-</span> <span class="fu">match</span>(common_ids, id_ldw)</span>
<span id="cb29-28"><a href="getting-started.html#cb29-28" tabindex="-1"></a>      idx_other  <span class="ot">&lt;-</span> <span class="fu">match</span>(common_ids, id2)</span>
<span id="cb29-29"><a href="getting-started.html#cb29-29" tabindex="-1"></a>      catt1_plot <span class="ot">&lt;-</span> catt_ldw[idx_ldw]</span>
<span id="cb29-30"><a href="getting-started.html#cb29-30" tabindex="-1"></a>      catt2_plot <span class="ot">&lt;-</span> catt2[idx_other]</span>
<span id="cb29-31"><a href="getting-started.html#cb29-31" tabindex="-1"></a>      <span class="fu">plot_catt</span>(</span>
<span id="cb29-32"><a href="getting-started.html#cb29-32" tabindex="-1"></a>        <span class="at">catt1 =</span> catt1_plot,</span>
<span id="cb29-33"><a href="getting-started.html#cb29-33" tabindex="-1"></a>        <span class="at">catt2 =</span> catt2_plot,</span>
<span id="cb29-34"><a href="getting-started.html#cb29-34" tabindex="-1"></a>        <span class="at">att1  =</span> att_ldw,</span>
<span id="cb29-35"><a href="getting-started.html#cb29-35" tabindex="-1"></a>        <span class="at">att2  =</span> att2,</span>
<span id="cb29-36"><a href="getting-started.html#cb29-36" tabindex="-1"></a>        <span class="at">xlab  =</span> <span class="st">&quot;CATT (Experimental)&quot;</span>,</span>
<span id="cb29-37"><a href="getting-started.html#cb29-37" tabindex="-1"></a>        <span class="at">ylab  =</span> plot_titles[i],</span>
<span id="cb29-38"><a href="getting-started.html#cb29-38" tabindex="-1"></a>        <span class="at">main  =</span> plot_titles[i],</span>
<span id="cb29-39"><a href="getting-started.html#cb29-39" tabindex="-1"></a>        <span class="at">axes.range =</span> range</span>
<span id="cb29-40"><a href="getting-started.html#cb29-40" tabindex="-1"></a>      )</span>
<span id="cb29-41"><a href="getting-started.html#cb29-41" tabindex="-1"></a>    }</span>
<span id="cb29-42"><a href="getting-started.html#cb29-42" tabindex="-1"></a>    <span class="co"># fill empty panels if last page is not full</span></span>
<span id="cb29-43"><a href="getting-started.html#cb29-43" tabindex="-1"></a>    <span class="cf">if</span> ((end_idx <span class="sc">-</span> start_idx <span class="sc">+</span> <span class="dv">1</span>) <span class="sc">&lt;</span> plots_per_page) {</span>
<span id="cb29-44"><a href="getting-started.html#cb29-44" tabindex="-1"></a>      <span class="cf">for</span> (k <span class="cf">in</span> <span class="fu">seq_len</span>(plots_per_page <span class="sc">-</span> (end_idx <span class="sc">-</span> start_idx <span class="sc">+</span> <span class="dv">1</span>))) <span class="fu">plot.new</span>()</span>
<span id="cb29-45"><a href="getting-started.html#cb29-45" tabindex="-1"></a>    }</span>
<span id="cb29-46"><a href="getting-started.html#cb29-46" tabindex="-1"></a>    <span class="fu">dev.off</span>()</span>
<span id="cb29-47"><a href="getting-started.html#cb29-47" tabindex="-1"></a>  }</span>
<span id="cb29-48"><a href="getting-started.html#cb29-48" tabindex="-1"></a>}</span></code></pre></div>
<p><strong>Arguments</strong></p>
<ul>
<li><code>exp_catt_list</code>: A list of objects containing CATT estimates used as experimental benchmark.</li>
<li><code>catt_list</code>: A list of objects containing CATT estimates from each comparison with the experimental benchmark.</li>
<li><code>plot_titles</code>: A character vector of titles for each plot.</li>
<li><code>prefix</code>: A string prefix for saved PDF filenames (default is “catt_top5”).</li>
<li><code>plots_per_page</code>: The number of plots to display per page / panel (default 1).</li>
<li><code>range</code>: A numeric vector of axis limits for plots (default c(-8000, 8000)).</li>
<li><code>folder</code>: A string specifying the folder path where the PDF panels will be saved (default is “graphs/lalonde”).</li>
</ul>
<p><code>save_main_catt_panels()</code></p>
<div class="sourceCode" id="cb30"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb30-1"><a href="getting-started.html#cb30-1" tabindex="-1"></a>save_main_catt_panels <span class="ot">&lt;-</span> <span class="cf">function</span>(</span>
<span id="cb30-2"><a href="getting-started.html#cb30-2" tabindex="-1"></a>    catt_refs,</span>
<span id="cb30-3"><a href="getting-started.html#cb30-3" tabindex="-1"></a>    catt_comps, </span>
<span id="cb30-4"><a href="getting-started.html#cb30-4" tabindex="-1"></a>    ylabels,</span>
<span id="cb30-5"><a href="getting-started.html#cb30-5" tabindex="-1"></a>    <span class="at">prefix =</span> <span class="st">&quot;catt_main&quot;</span>, </span>
<span id="cb30-6"><a href="getting-started.html#cb30-6" tabindex="-1"></a>    <span class="at">plots_per_page =</span> <span class="dv">1</span>, </span>
<span id="cb30-7"><a href="getting-started.html#cb30-7" tabindex="-1"></a>    <span class="at">main_titles =</span> <span class="cn">NULL</span>, </span>
<span id="cb30-8"><a href="getting-started.html#cb30-8" tabindex="-1"></a>    <span class="at">range =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">8000</span>, <span class="dv">8000</span>), </span>
<span id="cb30-9"><a href="getting-started.html#cb30-9" tabindex="-1"></a>    <span class="at">folder =</span> <span class="st">&quot;graphs/lalonde&quot;</span></span>
<span id="cb30-10"><a href="getting-started.html#cb30-10" tabindex="-1"></a>) {</span>
<span id="cb30-11"><a href="getting-started.html#cb30-11" tabindex="-1"></a>  <span class="cf">if</span> (<span class="sc">!</span><span class="fu">dir.exists</span>(folder)) <span class="fu">dir.create</span>(folder, <span class="at">recursive =</span> <span class="cn">TRUE</span>)</span>
<span id="cb30-12"><a href="getting-started.html#cb30-12" tabindex="-1"></a>  n_panels <span class="ot">&lt;-</span> <span class="fu">length</span>(catt_comps)</span>
<span id="cb30-13"><a href="getting-started.html#cb30-13" tabindex="-1"></a>  num_pages <span class="ot">&lt;-</span> <span class="fu">ceiling</span>(n_panels <span class="sc">/</span> plots_per_page)</span>
<span id="cb30-14"><a href="getting-started.html#cb30-14" tabindex="-1"></a>  <span class="cf">for</span> (page <span class="cf">in</span> <span class="fu">seq_len</span>(num_pages)) {</span>
<span id="cb30-15"><a href="getting-started.html#cb30-15" tabindex="-1"></a>    start_idx <span class="ot">&lt;-</span> (page <span class="sc">-</span> <span class="dv">1</span>) <span class="sc">*</span> plots_per_page <span class="sc">+</span> <span class="dv">1</span></span>
<span id="cb30-16"><a href="getting-started.html#cb30-16" tabindex="-1"></a>    end_idx <span class="ot">&lt;-</span> <span class="fu">min</span>(page <span class="sc">*</span> plots_per_page, n_panels)</span>
<span id="cb30-17"><a href="getting-started.html#cb30-17" tabindex="-1"></a>    file_name <span class="ot">&lt;-</span> <span class="fu">file.path</span>(folder, <span class="fu">paste0</span>(prefix, <span class="st">&quot;_&quot;</span>, page, <span class="st">&quot;.pdf&quot;</span>))</span>
<span id="cb30-18"><a href="getting-started.html#cb30-18" tabindex="-1"></a>    <span class="fu">pdf</span>(<span class="at">file =</span> file_name, <span class="at">width =</span> <span class="dv">10</span>, <span class="at">height =</span> <span class="dv">12</span>)</span>
<span id="cb30-19"><a href="getting-started.html#cb30-19" tabindex="-1"></a>    <span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(plots_per_page, <span class="dv">1</span>), <span class="at">mar =</span> <span class="fu">c</span>(<span class="fl">4.5</span>, <span class="dv">5</span>, <span class="dv">3</span>, <span class="dv">2</span>))</span>
<span id="cb30-20"><a href="getting-started.html#cb30-20" tabindex="-1"></a>    <span class="cf">for</span> (i <span class="cf">in</span> start_idx<span class="sc">:</span>end_idx) {</span>
<span id="cb30-21"><a href="getting-started.html#cb30-21" tabindex="-1"></a>      ref_idx <span class="ot">&lt;-</span> <span class="fu">min</span>(i, <span class="fu">length</span>(catt_refs))</span>
<span id="cb30-22"><a href="getting-started.html#cb30-22" tabindex="-1"></a>      catt1 <span class="ot">&lt;-</span> catt_refs[[ref_idx]]<span class="sc">$</span>catt</span>
<span id="cb30-23"><a href="getting-started.html#cb30-23" tabindex="-1"></a>      catt2 <span class="ot">&lt;-</span> catt_comps[[i]]<span class="sc">$</span>catt</span>
<span id="cb30-24"><a href="getting-started.html#cb30-24" tabindex="-1"></a>      att1  <span class="ot">&lt;-</span> catt_refs[[ref_idx]]<span class="sc">$</span>att[<span class="dv">1</span>]</span>
<span id="cb30-25"><a href="getting-started.html#cb30-25" tabindex="-1"></a>      att2  <span class="ot">&lt;-</span> catt_comps[[i]]<span class="sc">$</span>att[<span class="dv">1</span>]</span>
<span id="cb30-26"><a href="getting-started.html#cb30-26" tabindex="-1"></a>      <span class="fu">plot_catt</span>(</span>
<span id="cb30-27"><a href="getting-started.html#cb30-27" tabindex="-1"></a>        <span class="at">catt1 =</span> catt1,</span>
<span id="cb30-28"><a href="getting-started.html#cb30-28" tabindex="-1"></a>        <span class="at">catt2 =</span> catt2,</span>
<span id="cb30-29"><a href="getting-started.html#cb30-29" tabindex="-1"></a>        <span class="at">att1  =</span> att1,</span>
<span id="cb30-30"><a href="getting-started.html#cb30-30" tabindex="-1"></a>        <span class="at">att2  =</span> att2,</span>
<span id="cb30-31"><a href="getting-started.html#cb30-31" tabindex="-1"></a>        <span class="at">xlab  =</span> <span class="st">&quot;CATT (Reference)&quot;</span>,</span>
<span id="cb30-32"><a href="getting-started.html#cb30-32" tabindex="-1"></a>        <span class="at">ylab  =</span> ylabels[i],</span>
<span id="cb30-33"><a href="getting-started.html#cb30-33" tabindex="-1"></a>        <span class="at">main  =</span> <span class="cf">if</span> (<span class="fu">is.null</span>(main_titles)) <span class="fu">paste</span>(<span class="st">&quot;Comparison&quot;</span>, i) <span class="cf">else</span> main_titles[i],</span>
<span id="cb30-34"><a href="getting-started.html#cb30-34" tabindex="-1"></a>        <span class="at">axes.range =</span> range</span>
<span id="cb30-35"><a href="getting-started.html#cb30-35" tabindex="-1"></a>      )</span>
<span id="cb30-36"><a href="getting-started.html#cb30-36" tabindex="-1"></a>    }</span>
<span id="cb30-37"><a href="getting-started.html#cb30-37" tabindex="-1"></a>    <span class="co"># fill empty panels if last page not full</span></span>
<span id="cb30-38"><a href="getting-started.html#cb30-38" tabindex="-1"></a>    <span class="cf">if</span> ((end_idx <span class="sc">-</span> start_idx <span class="sc">+</span> <span class="dv">1</span>) <span class="sc">&lt;</span> plots_per_page) {</span>
<span id="cb30-39"><a href="getting-started.html#cb30-39" tabindex="-1"></a>      <span class="cf">for</span> (k <span class="cf">in</span> <span class="fu">seq_len</span>(plots_per_page <span class="sc">-</span> (end_idx <span class="sc">-</span> start_idx <span class="sc">+</span> <span class="dv">1</span>))) <span class="fu">plot.new</span>()</span>
<span id="cb30-40"><a href="getting-started.html#cb30-40" tabindex="-1"></a>    }</span>
<span id="cb30-41"><a href="getting-started.html#cb30-41" tabindex="-1"></a>    <span class="fu">dev.off</span>()</span>
<span id="cb30-42"><a href="getting-started.html#cb30-42" tabindex="-1"></a>  }</span>
<span id="cb30-43"><a href="getting-started.html#cb30-43" tabindex="-1"></a>}</span></code></pre></div>
<p><strong>Arguments</strong></p>
<ul>
<li><code>catt_refs</code>: List of reference CATT objects used for x-axis values in each comparison plot.</li>
<li><code>catt_comps</code>: List of comparison CATT objects used for the y-axis in each plot.</li>
<li><code>ylabels</code>: Character vector of plot y-axis labels.</li>
<li><code>prefix</code>: A string prefix for saved PDF filenames (default is “catt_main”).</li>
<li><code>plots_per_page</code>: The number of plots to display per page / panel (default 1).</li>
<li><code>main_titles</code>: Character vector of main titles to appear at the top of each plot.</li>
<li><code>range</code>: A numeric vector of axis limits for plots (default c(-8000, 8000)).</li>
<li><code>folder</code>: A string specifying the folder path where the PDF panels will be saved (default is “graphs/lalonde”).</li>
</ul>
<p><code>save_plus_catt_panels()</code></p>
<div class="sourceCode" id="cb31"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb31-1"><a href="getting-started.html#cb31-1" tabindex="-1"></a>save_plus_catt_panels <span class="ot">&lt;-</span> <span class="cf">function</span>(</span>
<span id="cb31-2"><a href="getting-started.html#cb31-2" tabindex="-1"></a>    catt1_list, </span>
<span id="cb31-3"><a href="getting-started.html#cb31-3" tabindex="-1"></a>    catt2_list, </span>
<span id="cb31-4"><a href="getting-started.html#cb31-4" tabindex="-1"></a>    ylabels, </span>
<span id="cb31-5"><a href="getting-started.html#cb31-5" tabindex="-1"></a>    <span class="at">prefix =</span> <span class="st">&quot;catt_plus&quot;</span>, </span>
<span id="cb31-6"><a href="getting-started.html#cb31-6" tabindex="-1"></a>    <span class="at">plots_per_page =</span> <span class="dv">1</span>, </span>
<span id="cb31-7"><a href="getting-started.html#cb31-7" tabindex="-1"></a>    <span class="at">main_titles =</span> <span class="cn">NULL</span>, </span>
<span id="cb31-8"><a href="getting-started.html#cb31-8" tabindex="-1"></a>    <span class="at">range =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">8000</span>, <span class="dv">8000</span>), </span>
<span id="cb31-9"><a href="getting-started.html#cb31-9" tabindex="-1"></a>    <span class="at">folder =</span> <span class="st">&quot;graphs/lalonde&quot;</span></span>
<span id="cb31-10"><a href="getting-started.html#cb31-10" tabindex="-1"></a>) {</span>
<span id="cb31-11"><a href="getting-started.html#cb31-11" tabindex="-1"></a>  <span class="cf">if</span> (<span class="sc">!</span><span class="fu">dir.exists</span>(folder)) <span class="fu">dir.create</span>(folder, <span class="at">recursive =</span> <span class="cn">TRUE</span>)</span>
<span id="cb31-12"><a href="getting-started.html#cb31-12" tabindex="-1"></a>  n_panels <span class="ot">&lt;-</span> <span class="fu">min</span>(<span class="fu">length</span>(catt1_list), <span class="fu">length</span>(catt2_list))</span>
<span id="cb31-13"><a href="getting-started.html#cb31-13" tabindex="-1"></a>  num_pages <span class="ot">&lt;-</span> <span class="fu">ceiling</span>(n_panels <span class="sc">/</span> plots_per_page)</span>
<span id="cb31-14"><a href="getting-started.html#cb31-14" tabindex="-1"></a>  <span class="cf">for</span> (page <span class="cf">in</span> <span class="fu">seq_len</span>(num_pages)) {</span>
<span id="cb31-15"><a href="getting-started.html#cb31-15" tabindex="-1"></a>    start_idx <span class="ot">&lt;-</span> (page <span class="sc">-</span> <span class="dv">1</span>) <span class="sc">*</span> plots_per_page <span class="sc">+</span> <span class="dv">1</span></span>
<span id="cb31-16"><a href="getting-started.html#cb31-16" tabindex="-1"></a>    end_idx <span class="ot">&lt;-</span> <span class="fu">min</span>(page <span class="sc">*</span> plots_per_page, n_panels)</span>
<span id="cb31-17"><a href="getting-started.html#cb31-17" tabindex="-1"></a>    file_name <span class="ot">&lt;-</span> <span class="fu">file.path</span>(folder, <span class="fu">paste0</span>(prefix, <span class="st">&quot;_&quot;</span>, page, <span class="st">&quot;.pdf&quot;</span>))</span>
<span id="cb31-18"><a href="getting-started.html#cb31-18" tabindex="-1"></a>    <span class="fu">pdf</span>(<span class="at">file =</span> file_name, <span class="at">width =</span> <span class="dv">10</span>, <span class="at">height =</span> <span class="dv">12</span>)</span>
<span id="cb31-19"><a href="getting-started.html#cb31-19" tabindex="-1"></a>    <span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(plots_per_page, <span class="dv">1</span>), <span class="at">mar =</span> <span class="fu">c</span>(<span class="fl">4.5</span>, <span class="dv">5</span>, <span class="dv">3</span>, <span class="dv">2</span>))</span>
<span id="cb31-20"><a href="getting-started.html#cb31-20" tabindex="-1"></a>    <span class="cf">for</span> (i <span class="cf">in</span> start_idx<span class="sc">:</span>end_idx) {</span>
<span id="cb31-21"><a href="getting-started.html#cb31-21" tabindex="-1"></a>      catt1 <span class="ot">&lt;-</span> catt1_list[[i]]<span class="sc">$</span>catt</span>
<span id="cb31-22"><a href="getting-started.html#cb31-22" tabindex="-1"></a>      catt2 <span class="ot">&lt;-</span> catt2_list[[i]]<span class="sc">$</span>catt</span>
<span id="cb31-23"><a href="getting-started.html#cb31-23" tabindex="-1"></a>      att1  <span class="ot">&lt;-</span> catt1_list[[i]]<span class="sc">$</span>att[<span class="dv">1</span>]</span>
<span id="cb31-24"><a href="getting-started.html#cb31-24" tabindex="-1"></a>      att2  <span class="ot">&lt;-</span> catt2_list[[i]]<span class="sc">$</span>att[<span class="dv">1</span>]</span>
<span id="cb31-25"><a href="getting-started.html#cb31-25" tabindex="-1"></a>      <span class="fu">plot_catt</span>(</span>
<span id="cb31-26"><a href="getting-started.html#cb31-26" tabindex="-1"></a>        <span class="at">catt1 =</span> catt1,</span>
<span id="cb31-27"><a href="getting-started.html#cb31-27" tabindex="-1"></a>        <span class="at">catt2 =</span> catt2,</span>
<span id="cb31-28"><a href="getting-started.html#cb31-28" tabindex="-1"></a>        <span class="at">att1  =</span> att1,</span>
<span id="cb31-29"><a href="getting-started.html#cb31-29" tabindex="-1"></a>        <span class="at">att2  =</span> att2,</span>
<span id="cb31-30"><a href="getting-started.html#cb31-30" tabindex="-1"></a>        <span class="at">xlab  =</span> <span class="st">&quot;CATT (Reference/Trimmed)&quot;</span>,</span>
<span id="cb31-31"><a href="getting-started.html#cb31-31" tabindex="-1"></a>        <span class="at">ylab  =</span> ylabels[i],</span>
<span id="cb31-32"><a href="getting-started.html#cb31-32" tabindex="-1"></a>        <span class="at">main  =</span> <span class="cf">if</span> (<span class="fu">is.null</span>(main_titles)) <span class="fu">paste</span>(<span class="st">&quot;Trimmed Panel&quot;</span>, i) <span class="cf">else</span> main_titles[i],</span>
<span id="cb31-33"><a href="getting-started.html#cb31-33" tabindex="-1"></a>        <span class="at">axes.range =</span> range</span>
<span id="cb31-34"><a href="getting-started.html#cb31-34" tabindex="-1"></a>      )</span>
<span id="cb31-35"><a href="getting-started.html#cb31-35" tabindex="-1"></a>    }</span>
<span id="cb31-36"><a href="getting-started.html#cb31-36" tabindex="-1"></a>    <span class="co"># fill empty panels if last page not full</span></span>
<span id="cb31-37"><a href="getting-started.html#cb31-37" tabindex="-1"></a>    <span class="cf">if</span> ((end_idx <span class="sc">-</span> start_idx <span class="sc">+</span> <span class="dv">1</span>) <span class="sc">&lt;</span> plots_per_page) {</span>
<span id="cb31-38"><a href="getting-started.html#cb31-38" tabindex="-1"></a>      <span class="cf">for</span> (k <span class="cf">in</span> <span class="fu">seq_len</span>(plots_per_page <span class="sc">-</span> (end_idx <span class="sc">-</span> start_idx <span class="sc">+</span> <span class="dv">1</span>))) <span class="fu">plot.new</span>()</span>
<span id="cb31-39"><a href="getting-started.html#cb31-39" tabindex="-1"></a>    }</span>
<span id="cb31-40"><a href="getting-started.html#cb31-40" tabindex="-1"></a>    <span class="fu">dev.off</span>()</span>
<span id="cb31-41"><a href="getting-started.html#cb31-41" tabindex="-1"></a>  }</span>
<span id="cb31-42"><a href="getting-started.html#cb31-42" tabindex="-1"></a>}</span></code></pre></div>
<p><strong>Arguments</strong></p>
<ul>
<li><code>catt1_list</code>: List of CATT objects for x-axis values.</li>
<li><code>catt2_list</code>: List of CATT objects for y-axis values.</li>
<li><code>ylabels</code>: Character vector of plot y-axis labels.</li>
<li><code>prefix</code>: A string prefix for saved PDF filenames.</li>
<li><code>plots_per_page</code>: The number of plots to display per page / panel (default 1).</li>
<li><code>main_titles</code>: Character vector of main titles to appear at the top of each plot.</li>
<li><code>range</code>: A numeric vector of axis limits for plots (default c(-8000, 8000)).</li>
<li><code>folder</code>: A string specifying the folder path where the PDF panels will be saved (default is “graphs/lalonde”).</li>
</ul>
<p><code>eval_catt()</code> computes summary statistics of CATT vectors for each method, returning the minimum, maximum, mean, and range (difference) of the CATT estimates.</p>
<div class="sourceCode" id="cb32"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb32-1"><a href="getting-started.html#cb32-1" tabindex="-1"></a>eval_catt <span class="ot">&lt;-</span> <span class="cf">function</span>(all_catt, plot_titles) {</span>
<span id="cb32-2"><a href="getting-started.html#cb32-2" tabindex="-1"></a>  <span class="fu">do.call</span>(rbind, <span class="fu">lapply</span>(<span class="fu">seq_along</span>(all_catt), <span class="cf">function</span>(i) {</span>
<span id="cb32-3"><a href="getting-started.html#cb32-3" tabindex="-1"></a>    catt_vec <span class="ot">&lt;-</span> all_catt[[i]]<span class="sc">$</span>catt</span>
<span id="cb32-4"><a href="getting-started.html#cb32-4" tabindex="-1"></a>    <span class="fu">data.frame</span>(</span>
<span id="cb32-5"><a href="getting-started.html#cb32-5" tabindex="-1"></a>      <span class="at">Method =</span> plot_titles[i],</span>
<span id="cb32-6"><a href="getting-started.html#cb32-6" tabindex="-1"></a>      <span class="at">Min_Catt =</span> <span class="fu">min</span>(catt_vec, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb32-7"><a href="getting-started.html#cb32-7" tabindex="-1"></a>      <span class="at">Max_Catt =</span> <span class="fu">max</span>(catt_vec, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb32-8"><a href="getting-started.html#cb32-8" tabindex="-1"></a>      <span class="at">Mean_Catt =</span> <span class="fu">mean</span>(catt_vec, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb32-9"><a href="getting-started.html#cb32-9" tabindex="-1"></a>      <span class="at">Diff_Catt =</span> <span class="fu">max</span>(catt_vec, <span class="at">na.rm =</span> <span class="cn">TRUE</span>) <span class="sc">-</span> <span class="fu">min</span>(catt_vec, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb32-10"><a href="getting-started.html#cb32-10" tabindex="-1"></a>      <span class="at">stringsAsFactors =</span> <span class="cn">FALSE</span></span>
<span id="cb32-11"><a href="getting-started.html#cb32-11" tabindex="-1"></a>    )</span>
<span id="cb32-12"><a href="getting-started.html#cb32-12" tabindex="-1"></a>  }))</span>
<span id="cb32-13"><a href="getting-started.html#cb32-13" tabindex="-1"></a>}</span></code></pre></div>
<p><strong>Arguments</strong></p>
<ul>
<li><code>all_catt</code>: A list of objects containing conditional average treatment effect on treated (CATT) estimates.</li>
<li><code>plot_titles</code>: A character vector of titles for each plot, corresponding to the outputs in <code>all_catt</code>.</li>
</ul>
</div>
<div id="quantile-treatment-effect-on-treated-qtet" class="section level4 hasAnchor" number="1.2.6.3">
<h4><span class="header-section-number">1.2.6.3</span> Quantile treatment effect on treated (QTET)<a href="getting-started.html#quantile-treatment-effect-on-treated-qtet" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p><code>est_qte_safe()</code>*** computes QTET estimates while handling potential errors gracefully.</p>
<div class="sourceCode" id="cb33"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb33-1"><a href="getting-started.html#cb33-1" tabindex="-1"></a>est_qte_safe <span class="ot">&lt;-</span> <span class="cf">function</span>(Y, treat, covar, data, <span class="at">cores =</span> <span class="dv">1</span>) {</span>
<span id="cb33-2"><a href="getting-started.html#cb33-2" tabindex="-1"></a>  <span class="fu">tryCatch</span>({</span>
<span id="cb33-3"><a href="getting-started.html#cb33-3" tabindex="-1"></a>    <span class="fu">est_qte</span>(Y, treat, covar, <span class="at">data =</span> data, <span class="at">cores =</span> cores)</span>
<span id="cb33-4"><a href="getting-started.html#cb33-4" tabindex="-1"></a>  }, <span class="at">error =</span> <span class="cf">function</span>(e) {</span>
<span id="cb33-5"><a href="getting-started.html#cb33-5" tabindex="-1"></a>    <span class="fu">cat</span>(<span class="st">&quot;Warning in est_qte:&quot;</span>, e<span class="sc">$</span>message, <span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span>)</span>
<span id="cb33-6"><a href="getting-started.html#cb33-6" tabindex="-1"></a>    <span class="fu">return</span>(<span class="cn">NULL</span>)</span>
<span id="cb33-7"><a href="getting-started.html#cb33-7" tabindex="-1"></a>  })</span>
<span id="cb33-8"><a href="getting-started.html#cb33-8" tabindex="-1"></a>}</span></code></pre></div>
<p><strong>Arguments</strong></p>
<ul>
<li><code>Y</code>: The name of the outcome variable.</li>
<li><code>treat</code>: The name of the binary treatment indicator variable as string.</li>
<li><code>covar</code>: A vector of covariate names.</li>
<li><code>data</code>: The data frame used for QTET estimation.</li>
<li><code>cores</code>: The number of CPU cores used for parallel computation (default is 1).</li>
</ul>
<p><code>plot_qte_top()</code>*** plots QTET of top-ranked samples for comparison against an experimental benchmark.</p>
<div class="sourceCode" id="cb34"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb34-1"><a href="getting-started.html#cb34-1" tabindex="-1"></a>plot_qte_top <span class="ot">&lt;-</span> <span class="cf">function</span>(qtet_top, qtet_top0, bm_list, plot_titles, <span class="at">main_start =</span> <span class="dv">1</span>, </span>
<span id="cb34-2"><a href="getting-started.html#cb34-2" tabindex="-1"></a>                         <span class="at">ylim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">25000</span>, <span class="dv">15000</span>), <span class="at">col =</span> <span class="cn">NULL</span>) {</span>
<span id="cb34-3"><a href="getting-started.html#cb34-3" tabindex="-1"></a>  n <span class="ot">&lt;-</span> <span class="fu">length</span>(qtet_top)</span>
<span id="cb34-4"><a href="getting-started.html#cb34-4" tabindex="-1"></a>  <span class="cf">for</span> (i <span class="cf">in</span> <span class="fu">seq_len</span>(n)) {</span>
<span id="cb34-5"><a href="getting-started.html#cb34-5" tabindex="-1"></a>    main_title <span class="ot">&lt;-</span> plot_titles[main_start <span class="sc">+</span> i <span class="sc">-</span> <span class="dv">1</span>]</span>
<span id="cb34-6"><a href="getting-started.html#cb34-6" tabindex="-1"></a>    mod <span class="ot">&lt;-</span> qtet_top[[i]]</span>
<span id="cb34-7"><a href="getting-started.html#cb34-7" tabindex="-1"></a>    mod2 <span class="ot">&lt;-</span> qtet_top0[[i]]</span>
<span id="cb34-8"><a href="getting-started.html#cb34-8" tabindex="-1"></a>    bm  <span class="ot">&lt;-</span> bm_list[[i]]</span>
<span id="cb34-9"><a href="getting-started.html#cb34-9" tabindex="-1"></a>    <span class="fu">plot_qte</span>(mod, mod2, bm, <span class="at">main =</span> main_title, <span class="at">ylim =</span> ylim, <span class="at">col =</span> col)</span>
<span id="cb34-10"><a href="getting-started.html#cb34-10" tabindex="-1"></a>    <span class="fu">legend</span>(<span class="st">&quot;bottomleft&quot;</span>, <span class="at">legend =</span> <span class="fu">c</span>(<span class="st">&quot;Experimental&quot;</span>, <span class="st">&quot;Unadjusted&quot;</span>, <span class="st">&quot;Adjusted&quot;</span>),</span>
<span id="cb34-11"><a href="getting-started.html#cb34-11" tabindex="-1"></a>           <span class="at">lty =</span> <span class="dv">1</span>, <span class="at">pch =</span> <span class="fu">c</span>(<span class="dv">16</span>, <span class="dv">17</span>, <span class="dv">16</span>), <span class="at">col =</span> <span class="fu">c</span>(<span class="dv">4</span>, <span class="dv">2</span>, <span class="dv">1</span>), <span class="at">bty =</span> <span class="st">&quot;n&quot;</span>)</span>
<span id="cb34-12"><a href="getting-started.html#cb34-12" tabindex="-1"></a>  }</span>
<span id="cb34-13"><a href="getting-started.html#cb34-13" tabindex="-1"></a>}</span></code></pre></div>
<p><strong>Arguments</strong></p>
<ul>
<li><code>qtet_top</code>: A list of objects containing QTET estimates for top-ranked samples.</li>
<li><code>qtet_top0</code>: A list of objects containing unadjusted QTET estimates.</li>
<li><code>bm_list</code>: A list containing QTET estimates for experimental benchmark construction.</li>
<li><code>plot_titles</code>: A character vector of titles for each plot, matching the order of elements in <code>qtet_top</code>.</li>
<li><code>main_start</code>: Numeric value index specifying where to start selecting titles from <code>plot_titles</code> (default is 1).</li>
<li><code>ylim</code>: A numeric vector specifying the y-axis limits for the plots (default is c(-25000, 15000)).</li>
<li><code>col</code>: Color specification.</li>
</ul>
<p><code>save_qtet()</code>*** generates and saves quantile treatment effect on the treated (QTET) plots for a given list of estimates.</p>
<div class="sourceCode" id="cb35"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb35-1"><a href="getting-started.html#cb35-1" tabindex="-1"></a>save_qtet <span class="ot">&lt;-</span> <span class="cf">function</span>(plots, <span class="at">plot_titles =</span> <span class="cn">NULL</span>, <span class="at">main_start =</span> <span class="dv">1</span>, </span>
<span id="cb35-2"><a href="getting-started.html#cb35-2" tabindex="-1"></a>                      <span class="at">ylim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">25000</span>, <span class="dv">15000</span>), <span class="at">col =</span> <span class="cn">NULL</span>, <span class="at">prefix =</span> <span class="st">&quot;ldw&quot;</span>) {</span>
<span id="cb35-3"><a href="getting-started.html#cb35-3" tabindex="-1"></a>  <span class="fu">dir.create</span>(<span class="st">&quot;graphs/lalonde&quot;</span>, <span class="at">showWarnings =</span> <span class="cn">FALSE</span>, <span class="at">recursive =</span> <span class="cn">TRUE</span>)</span>
<span id="cb35-4"><a href="getting-started.html#cb35-4" tabindex="-1"></a>  n <span class="ot">&lt;-</span> <span class="fu">length</span>(plots)</span>
<span id="cb35-5"><a href="getting-started.html#cb35-5" tabindex="-1"></a>  <span class="cf">for</span> (i <span class="cf">in</span> <span class="fu">seq_len</span>(n)) {</span>
<span id="cb35-6"><a href="getting-started.html#cb35-6" tabindex="-1"></a>    p <span class="ot">&lt;-</span> plots[[i]]</span>
<span id="cb35-7"><a href="getting-started.html#cb35-7" tabindex="-1"></a>    main_title <span class="ot">&lt;-</span> <span class="cf">if</span> (<span class="fu">is.null</span>(plot_titles)) p<span class="sc">$</span>main <span class="cf">else</span> plot_titles[main_start <span class="sc">+</span> i <span class="sc">-</span> <span class="dv">1</span>]</span>
<span id="cb35-8"><a href="getting-started.html#cb35-8" tabindex="-1"></a>    clean_title <span class="ot">&lt;-</span> <span class="fu">gsub</span>(<span class="st">&quot;[^a-zA-Z0-9]&quot;</span>, <span class="st">&quot;_&quot;</span>, main_title)</span>
<span id="cb35-9"><a href="getting-started.html#cb35-9" tabindex="-1"></a>    file_name <span class="ot">&lt;-</span> <span class="fu">sprintf</span>(<span class="st">&quot;graphs/lalonde/%s_qtet_estimates_%s.pdf&quot;</span>, prefix, clean_title)</span>
<span id="cb35-10"><a href="getting-started.html#cb35-10" tabindex="-1"></a>    <span class="fu">pdf</span>(<span class="at">file =</span> file_name, <span class="at">width =</span> <span class="dv">7</span>, <span class="at">height =</span> <span class="dv">5</span>)</span>
<span id="cb35-11"><a href="getting-started.html#cb35-11" tabindex="-1"></a>    <span class="fu">plot_qte</span>(p<span class="sc">$</span>mod, p<span class="sc">$</span>mod0, p<span class="sc">$</span>bm, <span class="at">main =</span> main_title, <span class="at">ylim =</span> ylim, <span class="at">col =</span> col)</span>
<span id="cb35-12"><a href="getting-started.html#cb35-12" tabindex="-1"></a>    <span class="fu">legend</span>(<span class="st">&quot;bottomleft&quot;</span>, <span class="at">legend =</span> <span class="fu">c</span>(<span class="st">&quot;Experimental&quot;</span>, <span class="st">&quot;Unadjusted&quot;</span>, <span class="st">&quot;Adjusted&quot;</span>),</span>
<span id="cb35-13"><a href="getting-started.html#cb35-13" tabindex="-1"></a>           <span class="at">lty =</span> <span class="dv">1</span>, <span class="at">pch =</span> <span class="fu">c</span>(<span class="dv">16</span>, <span class="dv">17</span>, <span class="dv">16</span>), <span class="at">col =</span> <span class="fu">c</span>(<span class="dv">4</span>, <span class="dv">2</span>, <span class="dv">1</span>), <span class="at">bty =</span> <span class="st">&quot;n&quot;</span>)</span>
<span id="cb35-14"><a href="getting-started.html#cb35-14" tabindex="-1"></a>    <span class="fu">dev.off</span>()</span>
<span id="cb35-15"><a href="getting-started.html#cb35-15" tabindex="-1"></a>  }</span>
<span id="cb35-16"><a href="getting-started.html#cb35-16" tabindex="-1"></a>}</span></code></pre></div>
<p><strong>Arguments</strong></p>
<ul>
<li><code>plots</code>: A list of objects containing QTET estimates and corresponding unadjusted estimates.</li>
<li><code>plot_titles</code>: A character vector of titles for each plot, matching the order of elements in <code>plots</code>.</li>
<li><code>main_start</code>: Numeric value index specifying where to start selecting titles from <code>plot_titles</code> (default is 1).</li>
<li><code>ylim</code>: A numeric vector specifying the y-axis limits for the plots (default is c(-25000, 15000)).</li>
<li><code>col</code>: Color specification.</li>
<li><code>prefix</code>: A string prefix for saved PDF filenames (default is “ldw”).</li>
</ul>
<p><code>save_qte_top()</code>*** generates and saves quantile treatment effect on the treated (QTET) plots for a given list of estimates of top-ranked samples.</p>
<div class="sourceCode" id="cb36"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb36-1"><a href="getting-started.html#cb36-1" tabindex="-1"></a>save_qte_top <span class="ot">&lt;-</span> <span class="cf">function</span>(qtet_top, qtet_top0, bm_list, plot_titles, <span class="at">main_start =</span> <span class="dv">1</span>,</span>
<span id="cb36-2"><a href="getting-started.html#cb36-2" tabindex="-1"></a>                         <span class="at">ylim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">25000</span>, <span class="dv">15000</span>), <span class="at">col =</span> <span class="cn">NULL</span>, <span class="at">prefix =</span> <span class="st">&quot;ldw_top&quot;</span>) {</span>
<span id="cb36-3"><a href="getting-started.html#cb36-3" tabindex="-1"></a>  n <span class="ot">&lt;-</span> <span class="fu">length</span>(qtet_top)</span>
<span id="cb36-4"><a href="getting-started.html#cb36-4" tabindex="-1"></a>  <span class="fu">dir.create</span>(<span class="st">&quot;graphs/lalonde&quot;</span>, <span class="at">showWarnings =</span> <span class="cn">FALSE</span>, <span class="at">recursive =</span> <span class="cn">TRUE</span>)</span>
<span id="cb36-5"><a href="getting-started.html#cb36-5" tabindex="-1"></a>  <span class="cf">for</span> (i <span class="cf">in</span> <span class="fu">seq_len</span>(n)) {</span>
<span id="cb36-6"><a href="getting-started.html#cb36-6" tabindex="-1"></a>    mod <span class="ot">&lt;-</span> qtet_top[[i]]</span>
<span id="cb36-7"><a href="getting-started.html#cb36-7" tabindex="-1"></a>    mod2 <span class="ot">&lt;-</span> qtet_top0[[i]]</span>
<span id="cb36-8"><a href="getting-started.html#cb36-8" tabindex="-1"></a>    bm <span class="ot">&lt;-</span> bm_list[[i]]                 </span>
<span id="cb36-9"><a href="getting-started.html#cb36-9" tabindex="-1"></a>    main_title <span class="ot">&lt;-</span> plot_titles[main_start <span class="sc">+</span> i <span class="sc">-</span> <span class="dv">1</span>]</span>
<span id="cb36-10"><a href="getting-started.html#cb36-10" tabindex="-1"></a>    clean_title <span class="ot">&lt;-</span> <span class="fu">gsub</span>(<span class="st">&quot;[^a-zA-Z0-9]&quot;</span>, <span class="st">&quot;_&quot;</span>, main_title)</span>
<span id="cb36-11"><a href="getting-started.html#cb36-11" tabindex="-1"></a>    file_name <span class="ot">&lt;-</span> <span class="fu">sprintf</span>(<span class="st">&quot;graphs/lalonde/%s_qte_estimates_%s.pdf&quot;</span>, prefix, clean_title)</span>
<span id="cb36-12"><a href="getting-started.html#cb36-12" tabindex="-1"></a>    <span class="fu">pdf</span>(<span class="at">file =</span> file_name, <span class="at">width =</span> <span class="dv">7</span>, <span class="at">height =</span> <span class="dv">5</span>)</span>
<span id="cb36-13"><a href="getting-started.html#cb36-13" tabindex="-1"></a>    <span class="fu">plot_qte</span>(mod, mod2, bm, <span class="at">main =</span> main_title, <span class="at">ylim =</span> ylim, <span class="at">col =</span> col)</span>
<span id="cb36-14"><a href="getting-started.html#cb36-14" tabindex="-1"></a>    <span class="fu">legend</span>(<span class="st">&quot;bottomleft&quot;</span>, <span class="at">legend =</span> <span class="fu">c</span>(<span class="st">&quot;Experimental&quot;</span>, <span class="st">&quot;Unadjusted&quot;</span>, <span class="st">&quot;Adjusted&quot;</span>),</span>
<span id="cb36-15"><a href="getting-started.html#cb36-15" tabindex="-1"></a>           <span class="at">lty =</span> <span class="dv">1</span>, <span class="at">pch =</span> <span class="fu">c</span>(<span class="dv">16</span>, <span class="dv">17</span>, <span class="dv">16</span>), <span class="at">col =</span> <span class="fu">c</span>(<span class="dv">4</span>, <span class="dv">2</span>, <span class="dv">1</span>), <span class="at">bty =</span> <span class="st">&quot;n&quot;</span>)</span>
<span id="cb36-16"><a href="getting-started.html#cb36-16" tabindex="-1"></a>    <span class="fu">dev.off</span>()</span>
<span id="cb36-17"><a href="getting-started.html#cb36-17" tabindex="-1"></a>  }</span>
<span id="cb36-18"><a href="getting-started.html#cb36-18" tabindex="-1"></a>}</span></code></pre></div>
<p><strong>Arguments</strong></p>
<ul>
<li><code>qtet_top</code>: A list of objects containing QTET estimates for top-ranked samples.</li>
<li><code>qtet_top0</code>: A list of objects containing unadjusted QTET estimates.</li>
<li><code>bm_list</code>: A list containing QTET estimates for experimental benchmark construction.</li>
<li><code>plot_titles</code>: A character vector of titles for each plot, matching the order of elements in <code>qtet_top</code>.</li>
<li><code>main_start</code>: Numeric value index specifying where to start selecting titles from <code>plot_titles</code> (default is 1).</li>
<li><code>ylim</code>: A numeric vector specifying the y-axis limits for the plots (default is c(-25000, 15000)).</li>
<li><code>col</code>: Color specification.</li>
<li><code>prefix</code>: A string prefix for saved PDF filenames (default is “ldw_top”).</li>
</ul>
<p><br></p>
<p><a name="ow-ana"></a></p>
</div>
</div>
<div id="outcome-weights-analysis" class="section level3 hasAnchor" number="1.2.7">
<h3><span class="header-section-number">1.2.7</span> Outcome weights analysis<a href="getting-started.html#outcome-weights-analysis" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p><code>get_res_att()</code> estimates average treatment effects on the treated (ATT) using augmented inverse probability weighting with cross-fitting on a list of sample.</p>
<div class="sourceCode" id="cb37"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb37-1"><a href="getting-started.html#cb37-1" tabindex="-1"></a>get_res_att <span class="ot">&lt;-</span> <span class="cf">function</span>(data_list, Y, treat, covar,</span>
<span id="cb37-2"><a href="getting-started.html#cb37-2" tabindex="-1"></a>                        <span class="at">estimator =</span> <span class="st">&quot;AIPW_ATT&quot;</span>, </span>
<span id="cb37-3"><a href="getting-started.html#cb37-3" tabindex="-1"></a>                        <span class="at">smoother =</span> <span class="st">&quot;honest_forest&quot;</span>, </span>
<span id="cb37-4"><a href="getting-started.html#cb37-4" tabindex="-1"></a>                        <span class="at">n_cf_folds =</span> <span class="dv">5</span>,</span>
<span id="cb37-5"><a href="getting-started.html#cb37-5" tabindex="-1"></a>                        <span class="at">n_reps =</span> <span class="dv">1</span>) {</span>
<span id="cb37-6"><a href="getting-started.html#cb37-6" tabindex="-1"></a>      results <span class="ot">&lt;-</span> <span class="fu">lapply</span>(<span class="fu">seq_along</span>(data_list),</span>
<span id="cb37-7"><a href="getting-started.html#cb37-7" tabindex="-1"></a>          <span class="cf">function</span>(i) {</span>
<span id="cb37-8"><a href="getting-started.html#cb37-8" tabindex="-1"></a>            data <span class="ot">&lt;-</span> data_list[[i]]</span>
<span id="cb37-9"><a href="getting-started.html#cb37-9" tabindex="-1"></a>            n_obs <span class="ot">&lt;-</span> <span class="fu">nrow</span>(data)</span>
<span id="cb37-10"><a href="getting-started.html#cb37-10" tabindex="-1"></a>            <span class="co"># adjust n_cf_folds for small samples</span></span>
<span id="cb37-11"><a href="getting-started.html#cb37-11" tabindex="-1"></a>            folds <span class="ot">&lt;-</span> <span class="cf">if</span> (n_obs <span class="sc">&lt;</span> <span class="dv">100</span>) {</span>
<span id="cb37-12"><a href="getting-started.html#cb37-12" tabindex="-1"></a>              <span class="fu">max</span>(<span class="dv">2</span>, <span class="fu">min</span>(<span class="dv">3</span>, n_cf_folds))</span>
<span id="cb37-13"><a href="getting-started.html#cb37-13" tabindex="-1"></a>            } <span class="cf">else</span> <span class="cf">if</span> (n_obs <span class="sc">&lt;</span> <span class="dv">300</span>) {</span>
<span id="cb37-14"><a href="getting-started.html#cb37-14" tabindex="-1"></a>              <span class="fu">max</span>(<span class="dv">3</span>, <span class="fu">min</span>(<span class="dv">4</span>, n_cf_folds))</span>
<span id="cb37-15"><a href="getting-started.html#cb37-15" tabindex="-1"></a>            } <span class="cf">else</span> {</span>
<span id="cb37-16"><a href="getting-started.html#cb37-16" tabindex="-1"></a>              n_cf_folds</span>
<span id="cb37-17"><a href="getting-started.html#cb37-17" tabindex="-1"></a>            }</span>
<span id="cb37-18"><a href="getting-started.html#cb37-18" tabindex="-1"></a>            <span class="fu">tryCatch</span>({</span>
<span id="cb37-19"><a href="getting-started.html#cb37-19" tabindex="-1"></a>              <span class="fu">dml_with_smoother</span>(</span>
<span id="cb37-20"><a href="getting-started.html#cb37-20" tabindex="-1"></a>                <span class="at">Y =</span> data[[Y]],</span>
<span id="cb37-21"><a href="getting-started.html#cb37-21" tabindex="-1"></a>                <span class="at">D =</span> data[[treat]],</span>
<span id="cb37-22"><a href="getting-started.html#cb37-22" tabindex="-1"></a>                <span class="at">X =</span> data[, covar, <span class="at">drop =</span> <span class="cn">FALSE</span>],</span>
<span id="cb37-23"><a href="getting-started.html#cb37-23" tabindex="-1"></a>                <span class="at">estimator =</span> estimator,</span>
<span id="cb37-24"><a href="getting-started.html#cb37-24" tabindex="-1"></a>                <span class="at">smoother =</span> smoother,</span>
<span id="cb37-25"><a href="getting-started.html#cb37-25" tabindex="-1"></a>                <span class="at">n_cf_folds =</span> folds,</span>
<span id="cb37-26"><a href="getting-started.html#cb37-26" tabindex="-1"></a>                <span class="at">n_reps =</span> n_reps</span>
<span id="cb37-27"><a href="getting-started.html#cb37-27" tabindex="-1"></a>              )</span>
<span id="cb37-28"><a href="getting-started.html#cb37-28" tabindex="-1"></a>            }, <span class="at">error =</span> <span class="cf">function</span>(e) {</span>
<span id="cb37-29"><a href="getting-started.html#cb37-29" tabindex="-1"></a>              <span class="fu">cat</span>(<span class="fu">sprintf</span>(<span class="st">&quot;WARNING: get_res_att failed for sample %d (n=%d): %s</span><span class="sc">\n</span><span class="st">&quot;</span>, i, n_obs, e<span class="sc">$</span>message))</span>
<span id="cb37-30"><a href="getting-started.html#cb37-30" tabindex="-1"></a>              <span class="fu">return</span>(<span class="cn">NULL</span>)</span>
<span id="cb37-31"><a href="getting-started.html#cb37-31" tabindex="-1"></a>            })</span>
<span id="cb37-32"><a href="getting-started.html#cb37-32" tabindex="-1"></a>          }</span>
<span id="cb37-33"><a href="getting-started.html#cb37-33" tabindex="-1"></a>      )</span>
<span id="cb37-34"><a href="getting-started.html#cb37-34" tabindex="-1"></a>    <span class="co"># summary report</span></span>
<span id="cb37-35"><a href="getting-started.html#cb37-35" tabindex="-1"></a>    null_count <span class="ot">&lt;-</span> <span class="fu">sum</span>(<span class="fu">sapply</span>(results, is.null))</span>
<span id="cb37-36"><a href="getting-started.html#cb37-36" tabindex="-1"></a>    success_count <span class="ot">&lt;-</span> <span class="fu">length</span>(results) <span class="sc">-</span> null_count</span>
<span id="cb37-37"><a href="getting-started.html#cb37-37" tabindex="-1"></a>    <span class="fu">cat</span>(<span class="fu">sprintf</span>(<span class="st">&quot;OUTCOME WEIGHTS SUMMARY: %d succeeded, %d failed out of %d samples</span><span class="sc">\n</span><span class="st">&quot;</span>, </span>
<span id="cb37-38"><a href="getting-started.html#cb37-38" tabindex="-1"></a>                success_count, null_count, <span class="fu">length</span>(results)))</span>
<span id="cb37-39"><a href="getting-started.html#cb37-39" tabindex="-1"></a>    <span class="fu">return</span>(results)</span>
<span id="cb37-40"><a href="getting-started.html#cb37-40" tabindex="-1"></a>}</span></code></pre></div>
<p><strong>Arguments</strong></p>
<ul>
<li><code>data_list</code>: A list of samples containing data.</li>
<li><code>Y</code>: String specifying the name of the outcome variable.</li>
<li><code>treat</code>: The name of the binary treatment indicator variable as string.</li>
<li><code>covar</code>: A vector of covariate names.</li>
<li><code>estimator</code>: String specifying the estimator to use (default is “AIPW_ATT”).</li>
<li><code>smoother</code>: String specifying the smoothing method (default is “honest_forest”).</li>
<li><code>n_cf_folds</code>: Numeric value specifying the number of cross-fitting folds (default is 5).</li>
<li><code>n_reps</code>: Numeric value specifying the number of repetitions for robustness (default is 1).</li>
</ul>
<p><code>derive_ow()</code> extracts outcome weights from a list of estimation results.</p>
<div class="sourceCode" id="cb38"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb38-1"><a href="getting-started.html#cb38-1" tabindex="-1"></a>derive_ow <span class="ot">&lt;-</span> <span class="cf">function</span>(results_list) {</span>
<span id="cb38-2"><a href="getting-started.html#cb38-2" tabindex="-1"></a><span class="fu">lapply</span>(results_list, <span class="cf">function</span>(res) <span class="fu">get_outcome_weights</span>(res))</span>
<span id="cb38-3"><a href="getting-started.html#cb38-3" tabindex="-1"></a>}</span></code></pre></div>
<p><strong>Argument</strong></p>
<ul>
<li><code>results_list</code>: A list of objects obtained from <code>get_res_att()</code>.</li>
</ul>
<p><code>plot_ow()</code> plots the distribution of the outcome weights.</p>
<div class="sourceCode" id="cb39"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb39-1"><a href="getting-started.html#cb39-1" tabindex="-1"></a>plot_ow <span class="ot">&lt;-</span> <span class="cf">function</span>(outcome_weights, <span class="at">plot_titles =</span> <span class="cn">NULL</span>, <span class="at">breaks =</span> <span class="dv">50</span>, </span>
<span id="cb39-2"><a href="getting-started.html#cb39-2" tabindex="-1"></a>                    <span class="at">col =</span> <span class="st">&quot;#ff000080&quot;</span>, <span class="at">xlab =</span> <span class="st">&quot;Outcome Weight&quot;</span>, </span>
<span id="cb39-3"><a href="getting-started.html#cb39-3" tabindex="-1"></a>                    <span class="at">estimator =</span> <span class="st">&quot;AIPW-ATT&quot;</span>) {</span>
<span id="cb39-4"><a href="getting-started.html#cb39-4" tabindex="-1"></a>  N <span class="ot">&lt;-</span> <span class="fu">length</span>(outcome_weights)</span>
<span id="cb39-5"><a href="getting-started.html#cb39-5" tabindex="-1"></a>  <span class="cf">for</span> (i <span class="cf">in</span> <span class="fu">seq_len</span>(N)) {</span>
<span id="cb39-6"><a href="getting-started.html#cb39-6" tabindex="-1"></a>    weights <span class="ot">&lt;-</span> outcome_weights[[i]]<span class="sc">$</span>omega[estimator, ]</span>
<span id="cb39-7"><a href="getting-started.html#cb39-7" tabindex="-1"></a>    main_title <span class="ot">&lt;-</span> <span class="cf">if</span> (<span class="sc">!</span><span class="fu">is.null</span>(plot_titles)) plot_titles[i] <span class="cf">else</span> <span class="fu">paste</span>(<span class="st">&quot;Sample&quot;</span>, i)</span>
<span id="cb39-8"><a href="getting-started.html#cb39-8" tabindex="-1"></a>    <span class="fu">hist</span>(weights, <span class="at">breaks =</span> breaks, <span class="at">main =</span> main_title, <span class="at">xlab =</span> xlab, <span class="at">col =</span> col)</span>
<span id="cb39-9"><a href="getting-started.html#cb39-9" tabindex="-1"></a>    <span class="fu">mtext</span>(<span class="fu">paste</span>(<span class="st">&quot;N =&quot;</span>, <span class="fu">length</span>(weights)), <span class="at">side =</span> <span class="dv">3</span>, <span class="at">line =</span> <span class="sc">-</span><span class="fl">1.5</span>, <span class="at">cex =</span> <span class="fl">0.8</span>)</span>
<span id="cb39-10"><a href="getting-started.html#cb39-10" tabindex="-1"></a>  }</span>
<span id="cb39-11"><a href="getting-started.html#cb39-11" tabindex="-1"></a>  <span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">1</span>))</span>
<span id="cb39-12"><a href="getting-started.html#cb39-12" tabindex="-1"></a>}</span></code></pre></div>
<p><strong>Arguments</strong></p>
<ul>
<li><code>outcome_weights</code>: A list of outcome weight objects.</li>
<li><code>plot_titles</code>: A character vector of titles for each plot.</li>
<li><code>breaks</code>: Numeric value specifying the number of bins for the histogram plots (default is 50).</li>
<li><code>col</code>: Color specification (default is “#ff000080”).</li>
<li><code>xlab</code>: String specifying the label for the x-axis (default is “Outcome Weight”)</li>
<li><code>estimator</code>: String specifying the estimator to use (default is “AIPW-ATT”).</li>
</ul>
<p><code>eval_ow()</code> computes summary statistics of outcome weights by treatment group for a list of samples and returns a data frame for comparison.</p>
<div class="sourceCode" id="cb40"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb40-1"><a href="getting-started.html#cb40-1" tabindex="-1"></a>eval_ow <span class="ot">&lt;-</span> <span class="cf">function</span>(outcome_weights, data_list, <span class="at">plot_titles =</span> <span class="cn">NULL</span>, <span class="at">treat =</span> <span class="st">&quot;treat&quot;</span>, <span class="at">estimator =</span> <span class="st">&quot;AIPW-ATT&quot;</span>) {</span>
<span id="cb40-2"><a href="getting-started.html#cb40-2" tabindex="-1"></a>  results <span class="ot">&lt;-</span> <span class="fu">lapply</span>(<span class="fu">seq_along</span>(outcome_weights), <span class="cf">function</span>(i) {</span>
<span id="cb40-3"><a href="getting-started.html#cb40-3" tabindex="-1"></a>    ow <span class="ot">&lt;-</span> outcome_weights[[i]]<span class="sc">$</span>omega[estimator, ]</span>
<span id="cb40-4"><a href="getting-started.html#cb40-4" tabindex="-1"></a>    treat <span class="ot">&lt;-</span> data_list[[i]][[treat]]</span>
<span id="cb40-5"><a href="getting-started.html#cb40-5" tabindex="-1"></a>    method <span class="ot">&lt;-</span> <span class="cf">if</span> (<span class="sc">!</span><span class="fu">is.null</span>(plot_titles)) plot_titles[i] <span class="cf">else</span> <span class="fu">paste</span>(<span class="st">&quot;Sample&quot;</span>, i)</span>
<span id="cb40-6"><a href="getting-started.html#cb40-6" tabindex="-1"></a>    sum_treated <span class="ot">&lt;-</span> <span class="fu">sum</span>(ow[treat <span class="sc">==</span> <span class="dv">1</span>])</span>
<span id="cb40-7"><a href="getting-started.html#cb40-7" tabindex="-1"></a>    sum_untreated <span class="ot">&lt;-</span> <span class="fu">sum</span>(ow[treat <span class="sc">==</span> <span class="dv">0</span>])</span>
<span id="cb40-8"><a href="getting-started.html#cb40-8" tabindex="-1"></a>    <span class="fu">data.frame</span>(</span>
<span id="cb40-9"><a href="getting-started.html#cb40-9" tabindex="-1"></a>      <span class="at">Method =</span> method,</span>
<span id="cb40-10"><a href="getting-started.html#cb40-10" tabindex="-1"></a>      <span class="at">Sum_Treated =</span> sum_treated,</span>
<span id="cb40-11"><a href="getting-started.html#cb40-11" tabindex="-1"></a>      <span class="at">Sum_Untreated =</span> sum_untreated,</span>
<span id="cb40-12"><a href="getting-started.html#cb40-12" tabindex="-1"></a>      <span class="at">Total_Sum =</span> sum_treated <span class="sc">+</span> sum_untreated,</span>
<span id="cb40-13"><a href="getting-started.html#cb40-13" tabindex="-1"></a>      <span class="at">stringsAsFactors =</span> <span class="cn">FALSE</span></span>
<span id="cb40-14"><a href="getting-started.html#cb40-14" tabindex="-1"></a>    )</span>
<span id="cb40-15"><a href="getting-started.html#cb40-15" tabindex="-1"></a>  })</span>
<span id="cb40-16"><a href="getting-started.html#cb40-16" tabindex="-1"></a>  <span class="fu">do.call</span>(rbind, results)</span>
<span id="cb40-17"><a href="getting-started.html#cb40-17" tabindex="-1"></a>}</span></code></pre></div>
<p>**Arguments*</p>
<ul>
<li><code>outcome_weights</code>: A list of outcome weight objects.</li>
<li><code>data_list</code>: A list of samples containing data.</li>
<li><code>plot_titles</code>: A character vector of titles for each plot.</li>
<li><code>treat</code>: String specifying the treatment variable in each sample (default is “treat”).</li>
<li><code>estimator</code>: String specifying the estimator to use (default is “AIPW-ATT”).</li>
</ul>
<p><code>save_ow()</code> saves the outcome weight histograms as PDF files, one per sample, with optional custom titles and formatting.</p>
<div class="sourceCode" id="cb41"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb41-1"><a href="getting-started.html#cb41-1" tabindex="-1"></a>save_ow <span class="ot">&lt;-</span> <span class="cf">function</span>(outcome_weights, <span class="at">plot_titles =</span> <span class="cn">NULL</span>,</span>
<span id="cb41-2"><a href="getting-started.html#cb41-2" tabindex="-1"></a>                    <span class="at">breaks =</span> <span class="dv">50</span>, <span class="at">col =</span> <span class="st">&quot;#ff000080&quot;</span>, <span class="at">xlab =</span> <span class="st">&quot;Outcome Weight&quot;</span>,</span>
<span id="cb41-3"><a href="getting-started.html#cb41-3" tabindex="-1"></a>                    <span class="at">prefix =</span> <span class="st">&quot;model_a&quot;</span>, <span class="at">estimator =</span> <span class="st">&quot;AIPW-ATT&quot;</span>) {</span>
<span id="cb41-4"><a href="getting-started.html#cb41-4" tabindex="-1"></a>  <span class="fu">dir.create</span>(<span class="st">&quot;graphs/lalonde&quot;</span>, <span class="at">showWarnings =</span> <span class="cn">FALSE</span>, <span class="at">recursive =</span> <span class="cn">TRUE</span>)</span>
<span id="cb41-5"><a href="getting-started.html#cb41-5" tabindex="-1"></a>  N <span class="ot">&lt;-</span> <span class="fu">length</span>(outcome_weights)</span>
<span id="cb41-6"><a href="getting-started.html#cb41-6" tabindex="-1"></a>  <span class="cf">for</span> (i <span class="cf">in</span> <span class="fu">seq_len</span>(N)) {</span>
<span id="cb41-7"><a href="getting-started.html#cb41-7" tabindex="-1"></a>    file_name <span class="ot">&lt;-</span> <span class="fu">sprintf</span>(<span class="st">&quot;graphs/lalonde/%s_outcomewt_%d.pdf&quot;</span>, prefix, i)</span>
<span id="cb41-8"><a href="getting-started.html#cb41-8" tabindex="-1"></a>    <span class="fu">pdf</span>(<span class="at">file =</span> file_name, <span class="at">width =</span> <span class="dv">8</span>, <span class="at">height =</span> <span class="dv">6</span>)</span>
<span id="cb41-9"><a href="getting-started.html#cb41-9" tabindex="-1"></a>    weights <span class="ot">&lt;-</span> outcome_weights[[i]]<span class="sc">$</span>omega[estimator, ]</span>
<span id="cb41-10"><a href="getting-started.html#cb41-10" tabindex="-1"></a>    main_title <span class="ot">&lt;-</span> <span class="cf">if</span> (<span class="sc">!</span><span class="fu">is.null</span>(plot_titles)) plot_titles[i] <span class="cf">else</span> <span class="fu">paste</span>(<span class="st">&quot;Sample&quot;</span>, i)</span>
<span id="cb41-11"><a href="getting-started.html#cb41-11" tabindex="-1"></a>    <span class="fu">hist</span>(weights, <span class="at">breaks =</span> breaks, <span class="at">main =</span> main_title, <span class="at">xlab =</span> xlab, <span class="at">col =</span> col)</span>
<span id="cb41-12"><a href="getting-started.html#cb41-12" tabindex="-1"></a>    <span class="fu">mtext</span>(<span class="fu">paste</span>(<span class="st">&quot;N =&quot;</span>, <span class="fu">length</span>(weights)), <span class="at">side =</span> <span class="dv">3</span>, <span class="at">line =</span> <span class="sc">-</span><span class="fl">1.5</span>, <span class="at">cex =</span> <span class="fl">0.8</span>)</span>
<span id="cb41-13"><a href="getting-started.html#cb41-13" tabindex="-1"></a>    <span class="fu">dev.off</span>()</span>
<span id="cb41-14"><a href="getting-started.html#cb41-14" tabindex="-1"></a>  }</span>
<span id="cb41-15"><a href="getting-started.html#cb41-15" tabindex="-1"></a>}</span></code></pre></div>
<p><strong>Argument</strong></p>
<ul>
<li><code>outcome_weights</code>: A list of outcome weight objects.</li>
<li><code>plot_titles</code>: A character vector of titles for each plot.</li>
<li><code>breaks</code>: Numeric value specifying the number of bins for the histogram plots (default is 50).</li>
<li><code>col</code>: Color specification (default is “#ff000080”).</li>
<li><code>xlab</code>: String specifying the label for the x-axis (default is “Outcome Weight”)</li>
<li><code>prefix</code>: A string prefix for saved PDF filenames.</li>
<li><code>estimator</code>: String specifying the estimator to use (default is “AIPW-ATT”).</li>
</ul>
<p><a name="sens-ana"></a></p>
</div>
<div id="sensitivity-analysis" class="section level3 hasAnchor" number="1.2.8">
<h3><span class="header-section-number">1.2.8</span> Sensitivity analysis<a href="getting-started.html#sensitivity-analysis" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p><code>check_filter_samples()</code> filters a list of samples to retain only those with all required variables, no missing data, binary treatment, and sufficient baseline/covariate variation.</p>
<div class="sourceCode" id="cb42"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb42-1"><a href="getting-started.html#cb42-1" tabindex="-1"></a>check_filter_samples <span class="ot">&lt;-</span> <span class="cf">function</span>(data_list, Y, treat, covar, bm) {</span>
<span id="cb42-2"><a href="getting-started.html#cb42-2" tabindex="-1"></a>  valid_samples <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb42-3"><a href="getting-started.html#cb42-3" tabindex="-1"></a>  <span class="cf">for</span> (i <span class="cf">in</span> <span class="fu">seq_along</span>(data_list)) {</span>
<span id="cb42-4"><a href="getting-started.html#cb42-4" tabindex="-1"></a>    data <span class="ot">&lt;-</span> data_list[[i]]</span>
<span id="cb42-5"><a href="getting-started.html#cb42-5" tabindex="-1"></a>    name <span class="ot">&lt;-</span> <span class="fu">names</span>(data_list)[i]</span>
<span id="cb42-6"><a href="getting-started.html#cb42-6" tabindex="-1"></a>    <span class="cf">if</span> (<span class="fu">is.null</span>(name) <span class="sc">||</span> name <span class="sc">==</span> <span class="st">&quot;&quot;</span>) name <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">&quot;data_&quot;</span>, i)  <span class="co"># provide a name if missing</span></span>
<span id="cb42-7"><a href="getting-started.html#cb42-7" tabindex="-1"></a>    vars_needed <span class="ot">&lt;-</span> <span class="fu">c</span>(Y, treat, covar, bm)</span>
<span id="cb42-8"><a href="getting-started.html#cb42-8" tabindex="-1"></a>    <span class="cf">if</span> (<span class="sc">!</span><span class="fu">all</span>(vars_needed <span class="sc">%in%</span> <span class="fu">names</span>(data))) { <span class="co"># check all variables exist</span></span>
<span id="cb42-9"><a href="getting-started.html#cb42-9" tabindex="-1"></a>      <span class="fu">message</span>(<span class="st">&quot;Removed &quot;</span>, name, <span class="st">&quot;: missing required variables&quot;</span>) </span>
<span id="cb42-10"><a href="getting-started.html#cb42-10" tabindex="-1"></a>      <span class="cf">next</span></span>
<span id="cb42-11"><a href="getting-started.html#cb42-11" tabindex="-1"></a>    }</span>
<span id="cb42-12"><a href="getting-started.html#cb42-12" tabindex="-1"></a>    sub <span class="ot">&lt;-</span> data[, vars_needed, drop <span class="ot">=</span> <span class="cn">FALSE</span>]</span>
<span id="cb42-13"><a href="getting-started.html#cb42-13" tabindex="-1"></a>    <span class="cf">if</span> (<span class="fu">any</span>(<span class="fu">is.na</span>(sub))) { <span class="co"># check no missing values</span></span>
<span id="cb42-14"><a href="getting-started.html#cb42-14" tabindex="-1"></a>      <span class="fu">message</span>(<span class="st">&quot;Removed &quot;</span>, name, <span class="st">&quot;: contains missing values&quot;</span>) </span>
<span id="cb42-15"><a href="getting-started.html#cb42-15" tabindex="-1"></a>      <span class="cf">next</span></span>
<span id="cb42-16"><a href="getting-started.html#cb42-16" tabindex="-1"></a>    }</span>
<span id="cb42-17"><a href="getting-started.html#cb42-17" tabindex="-1"></a>    tvals <span class="ot">&lt;-</span> <span class="fu">unique</span>(sub[[treat]])  <span class="co"># check treatment binary</span></span>
<span id="cb42-18"><a href="getting-started.html#cb42-18" tabindex="-1"></a>    <span class="cf">if</span> (<span class="sc">!</span><span class="fu">all</span>(tvals <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>)) <span class="sc">&amp;&amp;</span> <span class="sc">!</span><span class="fu">all</span>(tvals <span class="sc">%in%</span> <span class="fu">c</span>(<span class="cn">TRUE</span>, <span class="cn">FALSE</span>))) {</span>
<span id="cb42-19"><a href="getting-started.html#cb42-19" tabindex="-1"></a>      <span class="fu">message</span>(<span class="st">&quot;Removed &quot;</span>, name, <span class="st">&quot;: treatment variable not binary&quot;</span>)</span>
<span id="cb42-20"><a href="getting-started.html#cb42-20" tabindex="-1"></a>      <span class="cf">next</span></span>
<span id="cb42-21"><a href="getting-started.html#cb42-21" tabindex="-1"></a>    }</span>
<span id="cb42-22"><a href="getting-started.html#cb42-22" tabindex="-1"></a>    <span class="cf">if</span> (<span class="fu">any</span>(<span class="fu">sapply</span>(sub[bm], <span class="cf">function</span>(x) <span class="fu">length</span>(<span class="fu">unique</span>(x)) <span class="sc">&lt;=</span> <span class="dv">1</span>))) { <span class="co"># check baseline variables have variation</span></span>
<span id="cb42-23"><a href="getting-started.html#cb42-23" tabindex="-1"></a>      <span class="fu">message</span>(<span class="st">&quot;Removed &quot;</span>, name, <span class="st">&quot;: baseline variable(s) lack variation&quot;</span>) </span>
<span id="cb42-24"><a href="getting-started.html#cb42-24" tabindex="-1"></a>      <span class="cf">next</span></span>
<span id="cb42-25"><a href="getting-started.html#cb42-25" tabindex="-1"></a>    }</span>
<span id="cb42-26"><a href="getting-started.html#cb42-26" tabindex="-1"></a>    <span class="cf">if</span> (<span class="fu">any</span>(<span class="fu">sapply</span>(sub[covar], <span class="cf">function</span>(x) <span class="fu">length</span>(<span class="fu">unique</span>(x)) <span class="sc">&lt;=</span> <span class="dv">1</span>))) { <span class="co"># check covariates have variation</span></span>
<span id="cb42-27"><a href="getting-started.html#cb42-27" tabindex="-1"></a>      <span class="fu">message</span>(<span class="st">&quot;Removed &quot;</span>, name, <span class="st">&quot;: covariate variable(s) lack variation&quot;</span>)</span>
<span id="cb42-28"><a href="getting-started.html#cb42-28" tabindex="-1"></a>      <span class="cf">next</span></span>
<span id="cb42-29"><a href="getting-started.html#cb42-29" tabindex="-1"></a>    }</span>
<span id="cb42-30"><a href="getting-started.html#cb42-30" tabindex="-1"></a>    valid_samples[[name]] <span class="ot">&lt;-</span> data <span class="co"># if all passed sample is kept</span></span>
<span id="cb42-31"><a href="getting-started.html#cb42-31" tabindex="-1"></a>  }</span>
<span id="cb42-32"><a href="getting-started.html#cb42-32" tabindex="-1"></a>  <span class="fu">return</span>(valid_samples)</span>
<span id="cb42-33"><a href="getting-started.html#cb42-33" tabindex="-1"></a>}</span></code></pre></div>
<p><strong>Arguments</strong></p>
<ul>
<li><code>data_list</code>: A list of data frames containing data to be filtered.</li>
<li><code>Y</code>: The name of the outcome variable.</li>
<li><code>treat</code>: The name of the binary treatment indicator variable as string.</li>
<li><code>covar</code>: A vector of covariate names.</li>
<li><code>bm</code>: A vector of baseline variable names.</li>
</ul>
<p><code>save_sensitivity_plots()</code> generates sensitivity analysis plots for a series of filtered samples, saving each as a pdf file.</p>
<div class="sourceCode" id="cb43"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb43-1"><a href="getting-started.html#cb43-1" tabindex="-1"></a>save_sensitivity_plots <span class="ot">&lt;-</span> <span class="cf">function</span>(filtered_data_list, Y, treat, covar, bm, plot_titles, prefix) {</span>
<span id="cb43-2"><a href="getting-started.html#cb43-2" tabindex="-1"></a>  folder <span class="ot">&lt;-</span> <span class="st">&quot;graphs/lalonde&quot;</span></span>
<span id="cb43-3"><a href="getting-started.html#cb43-3" tabindex="-1"></a>  <span class="cf">if</span> (<span class="sc">!</span><span class="fu">dir.exists</span>(folder)) <span class="fu">dir.create</span>(folder, <span class="at">recursive =</span> <span class="cn">TRUE</span>)</span>
<span id="cb43-4"><a href="getting-started.html#cb43-4" tabindex="-1"></a>  success_count <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb43-5"><a href="getting-started.html#cb43-5" tabindex="-1"></a>  fail_count <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb43-6"><a href="getting-started.html#cb43-6" tabindex="-1"></a>  <span class="cf">for</span> (i <span class="cf">in</span> <span class="fu">seq_along</span>(filtered_data_list)) {</span>
<span id="cb43-7"><a href="getting-started.html#cb43-7" tabindex="-1"></a>    idx <span class="ot">&lt;-</span> i</span>
<span id="cb43-8"><a href="getting-started.html#cb43-8" tabindex="-1"></a>    file_name <span class="ot">&lt;-</span> <span class="fu">file.path</span>(folder, <span class="fu">paste0</span>(prefix, <span class="st">&quot;_sensitivity_&quot;</span>, idx, <span class="st">&quot;.pdf&quot;</span>))</span>
<span id="cb43-9"><a href="getting-started.html#cb43-9" tabindex="-1"></a>    <span class="fu">pdf</span>(file_name, <span class="at">width =</span> <span class="dv">8</span>, <span class="at">height =</span> <span class="dv">8</span>)</span>
<span id="cb43-10"><a href="getting-started.html#cb43-10" tabindex="-1"></a>    <span class="fu">tryCatch</span>({</span>
<span id="cb43-11"><a href="getting-started.html#cb43-11" tabindex="-1"></a>      <span class="fu">sens_ana</span>(filtered_data_list[[i]], Y, treat, covar, bm, <span class="at">kd =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>)</span>
<span id="cb43-12"><a href="getting-started.html#cb43-12" tabindex="-1"></a>      <span class="cf">if</span> (<span class="sc">!</span><span class="fu">is.null</span>(plot_titles) <span class="sc">&amp;&amp;</span> <span class="fu">length</span>(plot_titles) <span class="sc">&gt;=</span> idx) {</span>
<span id="cb43-13"><a href="getting-started.html#cb43-13" tabindex="-1"></a>        <span class="fu">title</span>(<span class="at">main =</span> plot_titles[idx])</span>
<span id="cb43-14"><a href="getting-started.html#cb43-14" tabindex="-1"></a>      }</span>
<span id="cb43-15"><a href="getting-started.html#cb43-15" tabindex="-1"></a>      success_count <span class="ot">&lt;-</span> success_count <span class="sc">+</span> <span class="dv">1</span></span>
<span id="cb43-16"><a href="getting-started.html#cb43-16" tabindex="-1"></a>    }, <span class="at">error =</span> <span class="cf">function</span>(e) {</span>
<span id="cb43-17"><a href="getting-started.html#cb43-17" tabindex="-1"></a>      <span class="fu">plot.new</span>()</span>
<span id="cb43-18"><a href="getting-started.html#cb43-18" tabindex="-1"></a>      title_text <span class="ot">&lt;-</span> <span class="cf">if</span> (<span class="sc">!</span><span class="fu">is.null</span>(plot_titles) <span class="sc">&amp;&amp;</span> <span class="fu">length</span>(plot_titles) <span class="sc">&gt;=</span> idx) plot_titles[idx] <span class="cf">else</span> <span class="fu">paste</span>(<span class="st">&quot;Sample&quot;</span>, idx)</span>
<span id="cb43-19"><a href="getting-started.html#cb43-19" tabindex="-1"></a>      <span class="fu">text</span>(<span class="fl">0.5</span>, <span class="fl">0.5</span>, <span class="fu">paste</span>(<span class="st">&quot;ERROR:&quot;</span>, title_text, <span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span>, e<span class="sc">$</span>message), <span class="at">cex =</span> <span class="fl">0.8</span>)</span>
<span id="cb43-20"><a href="getting-started.html#cb43-20" tabindex="-1"></a>      <span class="fu">cat</span>(<span class="fu">sprintf</span>(<span class="st">&quot;WARNING: Sensitivity plot %d (%s) failed: %s</span><span class="sc">\n</span><span class="st">&quot;</span>, idx, title_text, e<span class="sc">$</span>message))</span>
<span id="cb43-21"><a href="getting-started.html#cb43-21" tabindex="-1"></a>      fail_count <span class="ot">&lt;-</span> fail_count <span class="sc">+</span> <span class="dv">1</span></span>
<span id="cb43-22"><a href="getting-started.html#cb43-22" tabindex="-1"></a>    })</span>
<span id="cb43-23"><a href="getting-started.html#cb43-23" tabindex="-1"></a>    <span class="fu">dev.off</span>()</span>
<span id="cb43-24"><a href="getting-started.html#cb43-24" tabindex="-1"></a>  }</span>
<span id="cb43-25"><a href="getting-started.html#cb43-25" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="fu">sprintf</span>(<span class="st">&quot;SUMMARY: Sensitivity plots - %d succeeded, %d failed out of %d total</span><span class="sc">\n</span><span class="st">&quot;</span>, </span>
<span id="cb43-26"><a href="getting-started.html#cb43-26" tabindex="-1"></a>              success_count, fail_count, <span class="fu">length</span>(filtered_data_list)))</span>
<span id="cb43-27"><a href="getting-started.html#cb43-27" tabindex="-1"></a>}</span></code></pre></div>
<p><strong>Arguments</strong></p>
<ul>
<li><code>filtered_data_list</code>: A list of filtered samples containing data.</li>
<li><code>Y</code>: The name of the outcome variable.</li>
<li><code>treat</code>: The name of the binary treatment indicator variable as string.</li>
<li><code>covar</code>: A vector of covariate names.</li>
<li><code>bm</code>: A vector of baseline variable names.</li>
<li><code>plot_titles</code>: A vector of titles for plots corresponding to samples.</li>
<li><code>prefix</code>: A string prefix for saving output PDF files.</li>
</ul>
<p><a name="bal-ana"></a></p>
</div>
<div id="balance-analysis" class="section level3 hasAnchor" number="1.2.9">
<h3><span class="header-section-number">1.2.9</span> Balance analysis<a href="getting-started.html#balance-analysis" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p><code>save_balance()</code> generates balance plots that visualize the distribution of a specified covariate across treated and control groups for each sample and method.</p>
<div class="sourceCode" id="cb44"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb44-1"><a href="getting-started.html#cb44-1" tabindex="-1"></a>save_balance <span class="ot">&lt;-</span> <span class="cf">function</span>(</span>
<span id="cb44-2"><a href="getting-started.html#cb44-2" tabindex="-1"></a>    data_list,</span>
<span id="cb44-3"><a href="getting-started.html#cb44-3" tabindex="-1"></a>    method_names,</span>
<span id="cb44-4"><a href="getting-started.html#cb44-4" tabindex="-1"></a>    <span class="at">balance_var =</span> <span class="st">&quot;re75&quot;</span>,</span>
<span id="cb44-5"><a href="getting-started.html#cb44-5" tabindex="-1"></a>    <span class="at">prefix =</span> <span class="st">&quot;balance_panels&quot;</span>,</span>
<span id="cb44-6"><a href="getting-started.html#cb44-6" tabindex="-1"></a>    <span class="at">plots_per_page =</span> <span class="dv">4</span>,</span>
<span id="cb44-7"><a href="getting-started.html#cb44-7" tabindex="-1"></a>    <span class="at">folder =</span> <span class="st">&quot;graphs/lalonde&quot;</span></span>
<span id="cb44-8"><a href="getting-started.html#cb44-8" tabindex="-1"></a>) {</span>
<span id="cb44-9"><a href="getting-started.html#cb44-9" tabindex="-1"></a>  <span class="cf">if</span> (<span class="sc">!</span><span class="fu">dir.exists</span>(folder)) <span class="fu">dir.create</span>(folder, <span class="at">recursive =</span> <span class="cn">TRUE</span>)</span>
<span id="cb44-10"><a href="getting-started.html#cb44-10" tabindex="-1"></a>  n <span class="ot">&lt;-</span> <span class="fu">length</span>(data_list)</span>
<span id="cb44-11"><a href="getting-started.html#cb44-11" tabindex="-1"></a>  pages <span class="ot">&lt;-</span> <span class="fu">ceiling</span>(n <span class="sc">/</span> plots_per_page)</span>
<span id="cb44-12"><a href="getting-started.html#cb44-12" tabindex="-1"></a>  <span class="cf">for</span> (p <span class="cf">in</span> <span class="fu">seq_len</span>(pages)) {</span>
<span id="cb44-13"><a href="getting-started.html#cb44-13" tabindex="-1"></a>    start <span class="ot">&lt;-</span> (p <span class="sc">-</span> <span class="dv">1</span>) <span class="sc">*</span> plots_per_page <span class="sc">+</span> <span class="dv">1</span></span>
<span id="cb44-14"><a href="getting-started.html#cb44-14" tabindex="-1"></a>    end <span class="ot">&lt;-</span> <span class="fu">min</span>(p <span class="sc">*</span> plots_per_page, n)</span>
<span id="cb44-15"><a href="getting-started.html#cb44-15" tabindex="-1"></a>    file_name <span class="ot">&lt;-</span> <span class="fu">file.path</span>(folder, <span class="fu">paste0</span>(prefix, <span class="st">&quot;_&quot;</span>, balance_var, <span class="st">&quot;_&quot;</span>, p, <span class="st">&quot;.pdf&quot;</span>))</span>
<span id="cb44-16"><a href="getting-started.html#cb44-16" tabindex="-1"></a>    plot_list <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb44-17"><a href="getting-started.html#cb44-17" tabindex="-1"></a>    <span class="cf">for</span> (i <span class="cf">in</span> start<span class="sc">:</span>end) {</span>
<span id="cb44-18"><a href="getting-started.html#cb44-18" tabindex="-1"></a>      plot_title <span class="ot">&lt;-</span> <span class="fu">paste0</span>(method_names[i])</span>
<span id="cb44-19"><a href="getting-started.html#cb44-19" tabindex="-1"></a>      pl <span class="ot">&lt;-</span> <span class="fu">tryCatch</span>({</span>
<span id="cb44-20"><a href="getting-started.html#cb44-20" tabindex="-1"></a>        form <span class="ot">&lt;-</span> <span class="fu">as.formula</span>(<span class="fu">paste0</span>(<span class="st">&quot;treat ~ &quot;</span>, balance_var))</span>
<span id="cb44-21"><a href="getting-started.html#cb44-21" tabindex="-1"></a>        <span class="fu">bal.plot</span>(form, <span class="at">data =</span> data_list[[i]], <span class="at">which =</span> <span class="st">&quot;both&quot;</span>) <span class="sc">+</span></span>
<span id="cb44-22"><a href="getting-started.html#cb44-22" tabindex="-1"></a>          <span class="fu">ggtitle</span>(plot_title)</span>
<span id="cb44-23"><a href="getting-started.html#cb44-23" tabindex="-1"></a>      }, <span class="at">error =</span> <span class="cf">function</span>(e) {</span>
<span id="cb44-24"><a href="getting-started.html#cb44-24" tabindex="-1"></a>        <span class="fu">message</span>(<span class="fu">sprintf</span>(<span class="st">&quot;Could not plot %s: %s&quot;</span>, method_names[i], e<span class="sc">$</span>message))</span>
<span id="cb44-25"><a href="getting-started.html#cb44-25" tabindex="-1"></a>        <span class="fu">ggplot</span>() <span class="sc">+</span> <span class="fu">ggtitle</span>(<span class="fu">sprintf</span>(<span class="st">&quot;Error: %s&quot;</span>, method_names[i]))</span>
<span id="cb44-26"><a href="getting-started.html#cb44-26" tabindex="-1"></a>      })</span>
<span id="cb44-27"><a href="getting-started.html#cb44-27" tabindex="-1"></a>      plot_list[[<span class="fu">length</span>(plot_list)<span class="sc">+</span><span class="dv">1</span>]] <span class="ot">&lt;-</span> pl</span>
<span id="cb44-28"><a href="getting-started.html#cb44-28" tabindex="-1"></a>    }</span>
<span id="cb44-29"><a href="getting-started.html#cb44-29" tabindex="-1"></a>    <span class="fu">pdf</span>(file_name, <span class="at">width =</span> <span class="dv">8</span>, <span class="at">height =</span> <span class="dv">11</span>)</span>
<span id="cb44-30"><a href="getting-started.html#cb44-30" tabindex="-1"></a>    <span class="fu">print</span>(<span class="fu">wrap_plots</span>(<span class="at">plotlist =</span> plot_list, <span class="at">ncol =</span> <span class="dv">1</span>))</span>
<span id="cb44-31"><a href="getting-started.html#cb44-31" tabindex="-1"></a>    <span class="fu">dev.off</span>()</span>
<span id="cb44-32"><a href="getting-started.html#cb44-32" tabindex="-1"></a>  }</span>
<span id="cb44-33"><a href="getting-started.html#cb44-33" tabindex="-1"></a>}</span></code></pre></div>
<p><strong>Arguments</strong></p>
<ul>
<li><code>data_list</code>: A list of samples containing data.</li>
<li><code>method_names</code>: A list of methods names that were used to generate the samples.</li>
<li><code>balance_var</code>: The name of the covariate that shall be used for balance check.</li>
<li><code>prefix</code>: A string prefix for saving output PDF files.</li>
<li><code>folder</code>: A string specifying the folder path where the PDF panels will be saved (default is “graphs/lalonde”).</li>
<li><code>plots_per_page</code>: The number of plots to display per page / panel (default 4).</li>
</ul>

</div>
</div>
</div>
<h3>References<a href="references.html#references" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div id="refs" class="references csl-bib-body hanging-indent" entry-spacing="0">
<div id="ref-imbens2024" class="csl-entry">
Imbens, Guido W., and Yiqing Xu. 2024. <span>“LaLonde (1986) After Nearly Four Decades: Lessons Learned.”</span>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="index.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="lalonde-dehejia-wahba-ldw-data.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
  "sharing": {
    "github": false,
    "facebook": true,
    "twitter": true,
    "linkedin": false,
    "weibo": false,
    "instapaper": false,
    "vk": false,
    "whatsapp": false,
    "all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
  },
  "fontsettings": {
    "theme": "white",
    "family": "sans",
    "size": 2
  },
  "edit": {
    "link": "https://github.com/lkrsl/Application-of-Outcome-Weights-Framework-for-DML-to-Lalonde-Study/edit/main/tutorial/01-Start.Rmd",
    "text": "Edit"
  },
  "history": {
    "link": null,
    "text": null
  },
  "view": {
    "link": null,
    "text": null
  },
  "download": ["Outcome-Weights.pdf", "Outcome-Weights.epub"],
  "search": {
    "engine": "fuse",
    "options": null
  },
  "toc": {
    "collapse": "subsection"
  }
});
});
</script>

</body>

</html>

<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 1 Getting started | Application of Outcome Weights Framework for DML to Lalonde Study</title>
  <meta name="description" content="<p>This book demonstrates the application of the Outcome Weights Framework
for Double Machine Learning to the Lalonde Study.</p>" />
  <meta name="generator" content="bookdown 0.45 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 1 Getting started | Application of Outcome Weights Framework for DML to Lalonde Study" />
  <meta property="og:type" content="book" />
  
  <meta property="og:description" content="<p>This book demonstrates the application of the Outcome Weights Framework
for Double Machine Learning to the Lalonde Study.</p>" />
  <meta name="github-repo" content="lkrsl/Application-of-Outcome-Weights-Framework-for-DML-to-Lalonde-Study" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 1 Getting started | Application of Outcome Weights Framework for DML to Lalonde Study" />
  
  <meta name="twitter:description" content="<p>This book demonstrates the application of the Outcome Weights Framework
for Double Machine Learning to the Lalonde Study.</p>" />
  

<meta name="author" content="Laura Kreisel" />


<meta name="date" content="2025-10-03" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="index.html"/>
<link rel="next" href="references.html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>


<style type="text/css">
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
  
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">A Minimal Book Example</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Preface</a>
<ul>
<li class="chapter" data-level="0.1" data-path="index.html"><a href="index.html#overview"><i class="fa fa-check"></i><b>0.1</b> Overview</a></li>
</ul></li>
<li class="chapter" data-level="1" data-path="getting-started.html"><a href="getting-started.html"><i class="fa fa-check"></i><b>1</b> Getting started</a>
<ul>
<li class="chapter" data-level="1.1" data-path="getting-started.html"><a href="getting-started.html#installation"><i class="fa fa-check"></i><b>1.1</b> Installation</a></li>
<li class="chapter" data-level="1.2" data-path="getting-started.html"><a href="getting-started.html#wrapper-functions"><i class="fa fa-check"></i><b>1.2</b> Wrapper functions</a>
<ul>
<li class="chapter" data-level="1.2.1" data-path="getting-started.html"><a href="getting-started.html#overview-1"><i class="fa fa-check"></i><b>1.2.1</b> Overview</a></li>
<li class="chapter" data-level="1.2.2" data-path="getting-started.html"><a href="getting-started.html#inspection"><i class="fa fa-check"></i><b>1.2.2</b> Inspection</a></li>
<li class="chapter" data-level="1.2.3" data-path="getting-started.html"><a href="getting-started.html#improving-covariate-balance-and-overlap"><i class="fa fa-check"></i><b>1.2.3</b> Improving covariate balance and overlap</a></li>
<li class="chapter" data-level="1.2.4" data-path="getting-started.html"><a href="getting-started.html#reassessing-methods"><i class="fa fa-check"></i><b>1.2.4</b> Reassessing methods</a></li>
<li class="chapter" data-level="1.2.5" data-path="getting-started.html"><a href="getting-started.html#estimating"><i class="fa fa-check"></i><b>1.2.5</b> Estimating</a></li>
</ul></li>
<li class="chapter" data-level="1.3" data-path="getting-started.html"><a href="getting-started.html#outcome-weights-analysis"><i class="fa fa-check"></i><b>1.3</b> Outcome weights analysis</a></li>
<li class="chapter" data-level="1.4" data-path="getting-started.html"><a href="getting-started.html#sensitivity-analysis"><i class="fa fa-check"></i><b>1.4</b> Sensitivity analysis</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i>References</a></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Application of Outcome Weights Framework for DML to Lalonde Study</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="getting-started" class="section level1 hasAnchor" number="1">
<h1><span class="header-section-number">Chapter 1</span> Getting started<a href="getting-started.html#getting-started" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<div class="callout-caution">
<p>The functions presented below constitute the core wrapper functions utilized throughout the analysis, including three adapted function originally from the Imbens &amp; Xu (2024) tutorial, which were modified to suit specific analytical purpose (highlighted by ***). For the full original collection of functions by Imbens &amp; Xu (2024), including additional functions used in the analysis, please consult their official source code available on their GitHub <a href="https://github.com/lkrsl/Application-of-Outcome-Weights-Framework-for-DML-to-Lalonde-Study">repository</a>.</p>
</div>
<div id="installation" class="section level2 hasAnchor" number="1.1">
<h2><span class="header-section-number">1.1</span> Installation<a href="getting-started.html#installation" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Several R packages are required for the data analysis and visualization. The code below checks for all required packages and installs those that are missing. After the installation, the packages need to be loaded.</p>
<div class="callout-note">
<p>Since the analysis sources functions directly from the Imbens &amp; Xu (2024) tutorial, the required packages are automatically installed and loaded as part of that process. Therefore, it is only necessary to install and load any additional packages as well as add custom functions that are required for the analysis.</p>
</div>
<p><strong>Packages</strong>: “data.table”, “dplyr”, “ggplot2”, “gridExtra”, “highr”, “highs” , “MatchIt”, “optmatch”, “optweight”, “quickmatch”, “readr”, “rgenoud”, “tidyr”, “tidyverse”, “WeightIt”</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="getting-started.html#cb1-1" tabindex="-1"></a><span class="co"># required packages</span></span>
<span id="cb1-2"><a href="getting-started.html#cb1-2" tabindex="-1"></a>packages <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;data.table&quot;</span>, <span class="st">&quot;dplyr&quot;</span>, <span class="st">&quot;ggplot2&quot;</span>, <span class="st">&quot;gridExtra&quot;</span>, <span class="st">&quot;highr&quot;</span>, <span class="st">&quot;highs&quot;</span> , <span class="st">&quot;MatchIt&quot;</span>, <span class="st">&quot;optmatch&quot;</span>, <span class="st">&quot;optweight&quot;</span>, <span class="st">&quot;quickmatch&quot;</span>, <span class="st">&quot;readr&quot;</span>, <span class="st">&quot;rgenoud&quot;</span>, <span class="st">&quot;tidyr&quot;</span>, <span class="st">&quot;tidyverse&quot;</span>, <span class="st">&quot;WeightIt&quot;</span></span>
<span id="cb1-3"><a href="getting-started.html#cb1-3" tabindex="-1"></a>)</span>
<span id="cb1-4"><a href="getting-started.html#cb1-4" tabindex="-1"></a></span>
<span id="cb1-5"><a href="getting-started.html#cb1-5" tabindex="-1"></a><span class="co"># install packages</span></span>
<span id="cb1-6"><a href="getting-started.html#cb1-6" tabindex="-1"></a>install_all <span class="ot">&lt;-</span> <span class="cf">function</span>(packages) {</span>
<span id="cb1-7"><a href="getting-started.html#cb1-7" tabindex="-1"></a>  installed_pkgs <span class="ot">&lt;-</span> <span class="fu">installed.packages</span>()[, <span class="st">&quot;Package&quot;</span>]</span>
<span id="cb1-8"><a href="getting-started.html#cb1-8" tabindex="-1"></a>  <span class="cf">for</span> (pkg <span class="cf">in</span> packages) {</span>
<span id="cb1-9"><a href="getting-started.html#cb1-9" tabindex="-1"></a>    <span class="cf">if</span> (<span class="sc">!</span>pkg <span class="sc">%in%</span> installed_pkgs) {</span>
<span id="cb1-10"><a href="getting-started.html#cb1-10" tabindex="-1"></a>      <span class="fu">install.packages</span>(pkg)</span>
<span id="cb1-11"><a href="getting-started.html#cb1-11" tabindex="-1"></a>    }</span>
<span id="cb1-12"><a href="getting-started.html#cb1-12" tabindex="-1"></a>  }</span>
<span id="cb1-13"><a href="getting-started.html#cb1-13" tabindex="-1"></a>}</span>
<span id="cb1-14"><a href="getting-started.html#cb1-14" tabindex="-1"></a></span>
<span id="cb1-15"><a href="getting-started.html#cb1-15" tabindex="-1"></a><span class="fu">install_all</span>(packages)</span>
<span id="cb1-16"><a href="getting-started.html#cb1-16" tabindex="-1"></a></span>
<span id="cb1-17"><a href="getting-started.html#cb1-17" tabindex="-1"></a><span class="co"># load packages</span></span>
<span id="cb1-18"><a href="getting-started.html#cb1-18" tabindex="-1"></a><span class="fu">library</span>(cobalt)</span>
<span id="cb1-19"><a href="getting-started.html#cb1-19" tabindex="-1"></a><span class="fu">library</span>(data.table)</span>
<span id="cb1-20"><a href="getting-started.html#cb1-20" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb1-21"><a href="getting-started.html#cb1-21" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb1-22"><a href="getting-started.html#cb1-22" tabindex="-1"></a><span class="fu">library</span>(gridExtra)</span>
<span id="cb1-23"><a href="getting-started.html#cb1-23" tabindex="-1"></a><span class="fu">library</span>(highr)</span>
<span id="cb1-24"><a href="getting-started.html#cb1-24" tabindex="-1"></a><span class="fu">library</span>(highs)</span>
<span id="cb1-25"><a href="getting-started.html#cb1-25" tabindex="-1"></a><span class="fu">library</span>(MatchIt)</span>
<span id="cb1-26"><a href="getting-started.html#cb1-26" tabindex="-1"></a><span class="fu">library</span>(optmatch)</span>
<span id="cb1-27"><a href="getting-started.html#cb1-27" tabindex="-1"></a><span class="fu">library</span>(optweight)</span>
<span id="cb1-28"><a href="getting-started.html#cb1-28" tabindex="-1"></a><span class="fu">library</span>(quickmatch)</span>
<span id="cb1-29"><a href="getting-started.html#cb1-29" tabindex="-1"></a><span class="fu">library</span>(readr)</span>
<span id="cb1-30"><a href="getting-started.html#cb1-30" tabindex="-1"></a><span class="fu">library</span>(tidyr)</span>
<span id="cb1-31"><a href="getting-started.html#cb1-31" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb1-32"><a href="getting-started.html#cb1-32" tabindex="-1"></a><span class="fu">library</span>(WeightIt)</span></code></pre></div>
</div>
<div id="wrapper-functions" class="section level2 hasAnchor" number="1.2">
<h2><span class="header-section-number">1.2</span> Wrapper functions<a href="getting-started.html#wrapper-functions" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Next, we outline the wrapper functions designed to address overlap and covariate balance as well as the estimation of the average treatment effect on the treated (ATT) and alternative estimands.</p>
<div class="callout-note">
<p>To use the wrapper functions, the simplest method is to source the R script with the following code.</p>
</div>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="getting-started.html#cb2-1" tabindex="-1"></a><span class="fu">source</span>(<span class="st">&quot;tutorial/functions.R&quot;</span>)</span></code></pre></div>
<p>If you are using RStudio, you should now see the functions in the environment section.</p>
<div id="overview-1" class="section level3 hasAnchor" number="1.2.1">
<h3><span class="header-section-number">1.2.1</span> Overview<a href="getting-started.html#overview-1" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<table>
<colgroup>
<col width="25%" />
<col width="50%" />
<col width="25%" />
</colgroup>
<thead>
<tr class="header">
<th>Function</th>
<th>Description</th>
<th align="center">Code</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>inspect_data()</code></td>
<td>Inspects datasets.</td>
<td align="center"><a href="#inspec">More</a></td>
</tr>
</tbody>
</table>
<div class="line-block"><code>matchit_profile()</code>,<code>create_smr_weights()</code>,<code>create_overlap_weights()</code>, <code>truncate_weights_fixed()</code>, <code>truncate_weights_percentile()</code>, <code>check_weights()</code>, <code>truncate_weights_adaptive()</code>, <code>ps_trim()</code>, <code>common_range_trim()</code>, <code>crump_trim()</code>, <code>stuermer_trim ()</code>, <code>walker_trim()</code> and <code>trim_attach_weights()</code> | Implements methods to improve covariate balancing and overlap. | <a href="#impl-cov-bal-overl-mthds">More</a> |</div>
<p><code>get_smd_stats()</code>, <code>compute_abs_smd_matchit()</code>, <code>compute_ess_matchit()</code>, <code>plot_matchit()</code>, <code>compute_abs_smd_weight()</code>, <code>compute_ess_weight()</code>, <code>plot_weighting_methods()</code>, <code>compute_abs_smd_trunc()</code>, <code>compute_ess_trunc()</code>, <code>plot_trunc_methods()</code>, <code>compute_abs_smd_trim()</code>, <code>compute_ess_trim()</code>, <code>plot_trim()</code>, <code>compute_smd_all_datasets ()</code>, <code>compute_ess_all_datasets()</code>, <code>plot_comb_overlap()</code>, <code>plot_comb_love_plots()</code>, <code>combine_results()</code>, <code>save_csv()</code>, <code>assess_methods()</code>, <code>get_top_methods()</code>, <code>create_top5_datasets()</code> and <code>save_top5_individual_files()</code> | Evaluates performance of previous methods through comparative metrics (absolute standardized mean differences (SMD) and effective sample size (ESS)) | <a href="#eval-mthds">More</a> |
| <code>estimate_all()</code>, <code>plot_coef()</code>, <code>plot_att_panels()</code>, <code>save_att_panels()</code>, <code>create_matrix_results()</code>, <code>eval_att()</code>, <code>plot_catt_panels()</code>, <code>save_catt_panels()</code>, <code>eval_catt()</code>, <code>plot_qte_top()</code>, <code>save_qtet()</code>, <code>save_qte_top()</code> | Computes and visualizes the Average Treatment Effect on the Treated (ATT) using a number of estimators. | <a href="#est-and-plot-att-catt-qtet">More</a> |
| <code>get_res_att()</code>, <code>derive_ow()</code>, <code>plot_ow()</code>, <code>eval_ow()</code>, <code>save_ow()</code> | Analyses outcome weights of datasets. | <a href="#ow-ana">More</a> |
| <code>check_filter_datasets()</code>, <code>save_sensitivity_plots()</code> | Validates and filters datasets. | <a href="#sens-ana">More</a> |</p>
<p><a name="inspec"></a></p>
</div>
<div id="inspection" class="section level3 hasAnchor" number="1.2.2">
<h3><span class="header-section-number">1.2.2</span> Inspection<a href="getting-started.html#inspection" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p><code>inspect_data()</code> summarizes one or more datasets by returning a single data frame with each dataset’s name, number of observations, number of variables, and the concatenated names of its variables.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r fold-hide"><code class="sourceCode r"><span id="cb3-1"><a href="getting-started.html#cb3-1" tabindex="-1"></a>inspect_data <span class="ot">&lt;-</span> <span class="cf">function</span>(data_list) {</span>
<span id="cb3-2"><a href="getting-started.html#cb3-2" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">is.data.frame</span>(data_list)) {</span>
<span id="cb3-3"><a href="getting-started.html#cb3-3" tabindex="-1"></a>    data_list <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="at">dataset =</span> data_list)</span>
<span id="cb3-4"><a href="getting-started.html#cb3-4" tabindex="-1"></a>  }</span>
<span id="cb3-5"><a href="getting-started.html#cb3-5" tabindex="-1"></a>  <span class="fu">data.frame</span>(</span>
<span id="cb3-6"><a href="getting-started.html#cb3-6" tabindex="-1"></a>    <span class="at">dataset =</span> <span class="fu">names</span>(data_list),</span>
<span id="cb3-7"><a href="getting-started.html#cb3-7" tabindex="-1"></a>    <span class="at">num_obs =</span> <span class="fu">sapply</span>(data_list, nrow),</span>
<span id="cb3-8"><a href="getting-started.html#cb3-8" tabindex="-1"></a>    <span class="at">num_vars =</span> <span class="fu">sapply</span>(data_list, ncol),</span>
<span id="cb3-9"><a href="getting-started.html#cb3-9" tabindex="-1"></a>    <span class="at">name_vars =</span> <span class="fu">sapply</span>(data_list, <span class="cf">function</span>(df) <span class="fu">paste</span>(<span class="fu">names</span>(df), <span class="at">collapse =</span> <span class="st">&quot;, &quot;</span>)),</span>
<span id="cb3-10"><a href="getting-started.html#cb3-10" tabindex="-1"></a>    <span class="at">row.names =</span> <span class="cn">NULL</span></span>
<span id="cb3-11"><a href="getting-started.html#cb3-11" tabindex="-1"></a>  )</span>
<span id="cb3-12"><a href="getting-started.html#cb3-12" tabindex="-1"></a>}</span></code></pre></div>
<p><strong>Argument</strong></p>
<ul>
<li><code>data_list</code>: The dataset or a list of datasets.</li>
</ul>
<p><br></p>
<p><a name="impl-cov-bal-overl-mthds"></a></p>
</div>
<div id="improving-covariate-balance-and-overlap" class="section level3 hasAnchor" number="1.2.3">
<h3><span class="header-section-number">1.2.3</span> Improving covariate balance and overlap<a href="getting-started.html#improving-covariate-balance-and-overlap" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div id="matching" class="section level4 hasAnchor" number="1.2.3.1">
<h4><span class="header-section-number">1.2.3.1</span> Matching<a href="getting-started.html#matching" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p><code>matchit_profile()</code> performs nearest neighbor matching based on a combination of specified covariates and each observation’s distance from the overall covariate mean, returning a matchit object for balance diagnostics and matched sampling.</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r fold-hide"><code class="sourceCode r"><span id="cb4-1"><a href="getting-started.html#cb4-1" tabindex="-1"></a>matchit_profile <span class="ot">&lt;-</span> <span class="cf">function</span>(data, treat, covar) {</span>
<span id="cb4-2"><a href="getting-started.html#cb4-2" tabindex="-1"></a>  overall_means <span class="ot">&lt;-</span> <span class="fu">colMeans</span>(data[, covar], <span class="at">na.rm =</span> <span class="cn">TRUE</span>) </span>
<span id="cb4-3"><a href="getting-started.html#cb4-3" tabindex="-1"></a>  cov_matrix <span class="ot">&lt;-</span> <span class="fu">as.matrix</span>(data[, covar])   </span>
<span id="cb4-4"><a href="getting-started.html#cb4-4" tabindex="-1"></a>  dist_from_target <span class="ot">&lt;-</span> <span class="fu">apply</span>(cov_matrix, <span class="dv">1</span>, <span class="cf">function</span>(x) <span class="fu">sqrt</span>(<span class="fu">sum</span>((x <span class="sc">-</span> overall_means)<span class="sc">^</span><span class="dv">2</span>)))</span>
<span id="cb4-5"><a href="getting-started.html#cb4-5" tabindex="-1"></a>  data<span class="sc">$</span>dist_from_target <span class="ot">&lt;-</span> dist_from_target </span>
<span id="cb4-6"><a href="getting-started.html#cb4-6" tabindex="-1"></a>  formula <span class="ot">&lt;-</span> <span class="fu">as.formula</span>(<span class="fu">paste</span>(treat, <span class="st">&quot;~&quot;</span>, <span class="fu">paste</span>(<span class="fu">c</span>(covar, <span class="st">&quot;dist_from_target&quot;</span>), <span class="at">collapse =</span> <span class="st">&quot;+&quot;</span>)))</span>
<span id="cb4-7"><a href="getting-started.html#cb4-7" tabindex="-1"></a>  match_out <span class="ot">&lt;-</span> <span class="fu">matchit</span>(formula, <span class="at">data =</span> data, <span class="at">method =</span> <span class="st">&quot;nearest&quot;</span>, <span class="at">distance =</span> <span class="st">&quot;glm&quot;</span>)</span>
<span id="cb4-8"><a href="getting-started.html#cb4-8" tabindex="-1"></a>  <span class="fu">return</span>(match_out)</span>
<span id="cb4-9"><a href="getting-started.html#cb4-9" tabindex="-1"></a>}</span></code></pre></div>
<p><strong>Arguments</strong></p>
<ul>
<li><code>data</code>: The input dataset.</li>
<li><code>treat</code>: The name of the binary treatment indicator variable.</li>
<li><code>covar</code>: A vector of covariate names.</li>
</ul>
</div>
<div id="weighting" class="section level4 hasAnchor" number="1.2.3.2">
<h4><span class="header-section-number">1.2.3.2</span> Weighting<a href="getting-started.html#weighting" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p><code>create_smr_weights()</code> calculates standardized mortality ratio (SMR) weights based on estimated propensity scores, allowing for ATT or ATE weighting according to the estimand specified.</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r fold-hide"><code class="sourceCode r"><span id="cb5-1"><a href="getting-started.html#cb5-1" tabindex="-1"></a>create_smr_weights <span class="ot">&lt;-</span> <span class="cf">function</span>(data, formula, <span class="at">estimand =</span> <span class="st">&quot;ATT&quot;</span>) {</span>
<span id="cb5-2"><a href="getting-started.html#cb5-2" tabindex="-1"></a>  ps_model <span class="ot">&lt;-</span> <span class="fu">glm</span>(formula, <span class="at">data =</span> data, <span class="at">family =</span> <span class="fu">binomial</span>())</span>
<span id="cb5-3"><a href="getting-started.html#cb5-3" tabindex="-1"></a>  ps <span class="ot">&lt;-</span> <span class="fu">predict</span>(ps_model, <span class="at">type =</span> <span class="st">&quot;response&quot;</span>)</span>
<span id="cb5-4"><a href="getting-started.html#cb5-4" tabindex="-1"></a>  <span class="cf">if</span> (estimand <span class="sc">==</span> <span class="st">&quot;ATT&quot;</span>) {</span>
<span id="cb5-5"><a href="getting-started.html#cb5-5" tabindex="-1"></a>    weights <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(data<span class="sc">$</span>treat <span class="sc">==</span> <span class="dv">1</span>, <span class="dv">1</span><span class="sc">/</span>ps, <span class="dv">1</span><span class="sc">/</span>(<span class="dv">1</span><span class="sc">-</span>ps)) </span>
<span id="cb5-6"><a href="getting-started.html#cb5-6" tabindex="-1"></a>  } <span class="cf">else</span> <span class="cf">if</span> (estimand <span class="sc">==</span> <span class="st">&quot;ATE&quot;</span>) {</span>
<span id="cb5-7"><a href="getting-started.html#cb5-7" tabindex="-1"></a>    weights <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(data<span class="sc">$</span>treat <span class="sc">==</span> <span class="dv">1</span>, <span class="dv">1</span><span class="sc">/</span>ps, <span class="dv">1</span><span class="sc">/</span>(<span class="dv">1</span><span class="sc">-</span>ps)) </span>
<span id="cb5-8"><a href="getting-started.html#cb5-8" tabindex="-1"></a>  }</span>
<span id="cb5-9"><a href="getting-started.html#cb5-9" tabindex="-1"></a>  <span class="fu">return</span>(weights)</span>
<span id="cb5-10"><a href="getting-started.html#cb5-10" tabindex="-1"></a>}</span></code></pre></div>
<p><strong>Arguments</strong></p>
<ul>
<li><code>data</code>: The input dataset.</li>
<li><code>formula</code>: The model formula specifying the relation between the treatment variable and a set of covariates, defining the model structure.</li>
<li><code>estimand = ATT</code>: The target estimand (default is ATT).</li>
</ul>
<p><code>create_overlap_weights()</code> computes overlap weights based on propensity scores.</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r fold-hide"><code class="sourceCode r"><span id="cb6-1"><a href="getting-started.html#cb6-1" tabindex="-1"></a>create_overlap_weights <span class="ot">&lt;-</span> <span class="cf">function</span>(data, formula) {</span>
<span id="cb6-2"><a href="getting-started.html#cb6-2" tabindex="-1"></a>  ps_model <span class="ot">&lt;-</span> <span class="fu">glm</span>(formula, <span class="at">data =</span> data, <span class="at">family =</span> <span class="fu">binomial</span>())</span>
<span id="cb6-3"><a href="getting-started.html#cb6-3" tabindex="-1"></a>  ps <span class="ot">&lt;-</span> <span class="fu">predict</span>(ps_model, <span class="at">type =</span> <span class="st">&quot;response&quot;</span>)</span>
<span id="cb6-4"><a href="getting-started.html#cb6-4" tabindex="-1"></a>  <span class="fu">return</span>(<span class="fu">ifelse</span>(data<span class="sc">$</span>treat <span class="sc">==</span> <span class="dv">1</span>, <span class="dv">1</span> <span class="sc">-</span> ps, ps))</span>
<span id="cb6-5"><a href="getting-started.html#cb6-5" tabindex="-1"></a>}</span></code></pre></div>
<p><strong>Arguments</strong></p>
<ul>
<li><code>data</code>: The input dataset.</li>
<li><code>formula</code>: The model formula specifying the relation between the treatment variable and a set of covariates, defining the model structure.</li>
</ul>
</div>
<div id="truncation" class="section level4 hasAnchor" number="1.2.3.3">
<h4><span class="header-section-number">1.2.3.3</span> Truncation<a href="getting-started.html#truncation" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p><code>truncate_weights_fixed()</code> caps weights at a fixed maximum value to limit extreme weight influence.</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r fold-hide"><code class="sourceCode r"><span id="cb7-1"><a href="getting-started.html#cb7-1" tabindex="-1"></a>truncate_weights_fixed <span class="ot">&lt;-</span> <span class="cf">function</span>(data, weight_col, <span class="at">max_weight =</span> <span class="dv">10</span>) {</span>
<span id="cb7-2"><a href="getting-started.html#cb7-2" tabindex="-1"></a>  data[[weight_col]] <span class="ot">&lt;-</span> <span class="fu">pmin</span>(data[[weight_col]], max_weight)</span>
<span id="cb7-3"><a href="getting-started.html#cb7-3" tabindex="-1"></a>  <span class="fu">return</span>(data)</span>
<span id="cb7-4"><a href="getting-started.html#cb7-4" tabindex="-1"></a>}</span></code></pre></div>
<p><strong>Arguments</strong></p>
<ul>
<li><code>data</code>: The input dataset.</li>
<li><code>weight_col</code>: The column name of the weights in the dataset.</li>
<li><code>max_weight</code>: The maximum allowed weight value.</li>
</ul>
<p><code>truncate_weights_percentile()</code> caps weights at a specified percentile threshold to reduce outliers in weight distribution.</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r fold-hide"><code class="sourceCode r"><span id="cb8-1"><a href="getting-started.html#cb8-1" tabindex="-1"></a>truncate_weights_percentile <span class="ot">&lt;-</span> <span class="cf">function</span>(data, weight_col, <span class="at">percentile =</span> <span class="fl">0.99</span>) {</span>
<span id="cb8-2"><a href="getting-started.html#cb8-2" tabindex="-1"></a>  weight_cutoff <span class="ot">&lt;-</span> <span class="fu">quantile</span>(data[[weight_col]], <span class="at">probs =</span> percentile, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb8-3"><a href="getting-started.html#cb8-3" tabindex="-1"></a>  data[[weight_col]] <span class="ot">&lt;-</span> <span class="fu">pmin</span>(data[[weight_col]], weight_cutoff)</span>
<span id="cb8-4"><a href="getting-started.html#cb8-4" tabindex="-1"></a>  <span class="fu">return</span>(data)</span>
<span id="cb8-5"><a href="getting-started.html#cb8-5" tabindex="-1"></a>}    </span></code></pre></div>
<p><strong>Arguments</strong></p>
<ul>
<li><code>data</code>: The input dataset.</li>
<li><code>weight_col</code>: The column name of the weights in the dataset.</li>
<li><code>percentile</code>: The quantile cutoff value.</li>
</ul>
<p><code>check_weights()</code> prints the variance of the specified weight vector to assess variability and relevance for adaptive truncation.</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r fold-hide"><code class="sourceCode r"><span id="cb9-1"><a href="getting-started.html#cb9-1" tabindex="-1"></a>check_weights <span class="ot">&lt;-</span> <span class="cf">function</span>(data, <span class="at">weight_col =</span> <span class="st">&quot;weight&quot;</span>) {</span>
<span id="cb9-2"><a href="getting-started.html#cb9-2" tabindex="-1"></a>  w <span class="ot">&lt;-</span> data[[weight_col]]</span>
<span id="cb9-3"><a href="getting-started.html#cb9-3" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">&quot;Variance of&quot;</span>, weight_col, <span class="st">&quot;:&quot;</span>, <span class="fu">var</span>(w, <span class="at">na.rm =</span> <span class="cn">TRUE</span>), <span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span>)</span>
<span id="cb9-4"><a href="getting-started.html#cb9-4" tabindex="-1"></a>}  </span></code></pre></div>
<p><strong>Arguments</strong></p>
<ul>
<li><code>data</code>: The input dataset.</li>
<li><code>weight_col</code>: The weight column to analyze.</li>
</ul>
<p><code>truncate_weights_adaptive()</code> caps weights adaptively at a threshold defined by the mean plus a multiple of the standard deviation.</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r fold-hide"><code class="sourceCode r"><span id="cb10-1"><a href="getting-started.html#cb10-1" tabindex="-1"></a>truncate_weights_adaptive <span class="ot">&lt;-</span> <span class="cf">function</span>(data, weight_col, <span class="at">c =</span> <span class="dv">3</span>) {</span>
<span id="cb10-2"><a href="getting-started.html#cb10-2" tabindex="-1"></a>  w <span class="ot">&lt;-</span> data[[weight_col]]</span>
<span id="cb10-3"><a href="getting-started.html#cb10-3" tabindex="-1"></a>  <span class="co"># Only apply if variance is positive</span></span>
<span id="cb10-4"><a href="getting-started.html#cb10-4" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">var</span>(w, <span class="at">na.rm =</span> <span class="cn">TRUE</span>) <span class="sc">&gt;</span> <span class="dv">0</span>) {</span>
<span id="cb10-5"><a href="getting-started.html#cb10-5" tabindex="-1"></a>    cutoff <span class="ot">&lt;-</span> <span class="fu">mean</span>(w, <span class="at">na.rm =</span> <span class="cn">TRUE</span>) <span class="sc">+</span> c <span class="sc">*</span> <span class="fu">sd</span>(w, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb10-6"><a href="getting-started.html#cb10-6" tabindex="-1"></a>    data[[weight_col]] <span class="ot">&lt;-</span> <span class="fu">pmin</span>(w, cutoff)</span>
<span id="cb10-7"><a href="getting-started.html#cb10-7" tabindex="-1"></a>  }</span>
<span id="cb10-8"><a href="getting-started.html#cb10-8" tabindex="-1"></a>  <span class="fu">return</span>(data)</span>
<span id="cb10-9"><a href="getting-started.html#cb10-9" tabindex="-1"></a>}</span></code></pre></div>
<p><strong>Arguments</strong></p>
<ul>
<li><code>data</code>: The input dataset.</li>
<li><code>weight_col</code>: The column name of the weights in the dataset.</li>
<li><code>c</code>: The multiplier for the standard deviation added to the mean to define the cutoff value.</li>
</ul>
</div>
<div id="trimming" class="section level4 hasAnchor" number="1.2.3.4">
<h4><span class="header-section-number">1.2.3.4</span> Trimming<a href="getting-started.html#trimming" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p><code>ps_trim()</code> trims the dataset based on a specified propensity score threshold, removing observations whose propensity scores exceed the given cutoff value.***</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r fold-hide"><code class="sourceCode r"><span id="cb11-1"><a href="getting-started.html#cb11-1" tabindex="-1"></a>ps_trim <span class="ot">&lt;-</span> <span class="cf">function</span>(data, <span class="at">ps =</span> <span class="st">&quot;ps_assoverlap&quot;</span>, <span class="at">threshold =</span> <span class="fl">0.9</span>) { </span>
<span id="cb11-2"><a href="getting-started.html#cb11-2" tabindex="-1"></a>  sub <span class="ot">&lt;-</span> data[<span class="fu">which</span>(data[, ps] <span class="sc">&lt;</span> threshold), ]</span>
<span id="cb11-3"><a href="getting-started.html#cb11-3" tabindex="-1"></a>  <span class="fu">return</span>(sub)</span>
<span id="cb11-4"><a href="getting-started.html#cb11-4" tabindex="-1"></a>}</span></code></pre></div>
<p><strong>Arguments</strong></p>
<ul>
<li><code>data</code>: The input dataset.</li>
<li><code>ps</code>: The name of the propensity score variable.</li>
<li><code>threshold</code>: The upper limit for propensity score inclusion.</li>
</ul>
<p><code>common_range_trim()</code> trims the dataset to observations with propensity scores within the common support range for treated and control groups.</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r fold-hide"><code class="sourceCode r"><span id="cb12-1"><a href="getting-started.html#cb12-1" tabindex="-1"></a>common_range_trim <span class="ot">&lt;-</span> <span class="cf">function</span>(data, <span class="at">ps_col =</span> <span class="st">&quot;ps_assoverlap&quot;</span>, <span class="at">treat_col =</span> <span class="st">&quot;treat&quot;</span>) {</span>
<span id="cb12-2"><a href="getting-started.html#cb12-2" tabindex="-1"></a>  lower_cut <span class="ot">&lt;-</span> <span class="fu">max</span>(</span>
<span id="cb12-3"><a href="getting-started.html#cb12-3" tabindex="-1"></a>    <span class="fu">min</span>(data[[ps_col]][data[[treat_col]] <span class="sc">==</span> <span class="dv">1</span>], <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb12-4"><a href="getting-started.html#cb12-4" tabindex="-1"></a>    <span class="fu">min</span>(data[[ps_col]][data[[treat_col]] <span class="sc">==</span> <span class="dv">0</span>], <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb12-5"><a href="getting-started.html#cb12-5" tabindex="-1"></a>  )</span>
<span id="cb12-6"><a href="getting-started.html#cb12-6" tabindex="-1"></a>  upper_cut <span class="ot">&lt;-</span> <span class="fu">min</span>(</span>
<span id="cb12-7"><a href="getting-started.html#cb12-7" tabindex="-1"></a>    <span class="fu">max</span>(data[[ps_col]][data[[treat_col]] <span class="sc">==</span> <span class="dv">1</span>], <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb12-8"><a href="getting-started.html#cb12-8" tabindex="-1"></a>    <span class="fu">max</span>(data[[ps_col]][data[[treat_col]] <span class="sc">==</span> <span class="dv">0</span>], <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb12-9"><a href="getting-started.html#cb12-9" tabindex="-1"></a>  )</span>
<span id="cb12-10"><a href="getting-started.html#cb12-10" tabindex="-1"></a>  sub <span class="ot">&lt;-</span> data[data[[ps_col]] <span class="sc">&gt;=</span> lower_cut <span class="sc">&amp;</span> data[[ps_col]] <span class="sc">&lt;=</span> upper_cut, ]</span>
<span id="cb12-11"><a href="getting-started.html#cb12-11" tabindex="-1"></a>  <span class="fu">return</span>(sub)</span>
<span id="cb12-12"><a href="getting-started.html#cb12-12" tabindex="-1"></a>}</span></code></pre></div>
<p><strong>Arguments</strong></p>
<ul>
<li><code>data</code>: The input dataset.</li>
<li><code>ps_col</code>: The column name of propensity scores.</li>
<li><code>treat_col</code>: The column name of the (binary) treatment indicator.</li>
</ul>
<p><code>crump_trim()</code> trims the dataset to observations with propensity scores outside specified lower and upper bounds (default 0.1 and 0.9).</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r fold-hide"><code class="sourceCode r"><span id="cb13-1"><a href="getting-started.html#cb13-1" tabindex="-1"></a>crump_trim <span class="ot">&lt;-</span> <span class="cf">function</span>(data, <span class="at">ps_col =</span> <span class="st">&quot;ps_assoverlap&quot;</span>, <span class="at">lower =</span> <span class="fl">0.1</span>, <span class="at">upper =</span> <span class="fl">0.9</span>) {</span>
<span id="cb13-2"><a href="getting-started.html#cb13-2" tabindex="-1"></a>  sub <span class="ot">&lt;-</span> data[data[[ps_col]] <span class="sc">&gt;=</span> lower <span class="sc">&amp;</span> data[[ps_col]] <span class="sc">&lt;=</span> upper, ]</span>
<span id="cb13-3"><a href="getting-started.html#cb13-3" tabindex="-1"></a>  <span class="fu">return</span>(sub)</span>
<span id="cb13-4"><a href="getting-started.html#cb13-4" tabindex="-1"></a>}</span></code></pre></div>
<p><strong>Arguments</strong></p>
<ul>
<li><code>data</code>: The input dataset.</li>
<li><code>ps_col</code>: The column name of propensity scores.</li>
<li><code>lower</code>: The lower bound for inclusion.</li>
<li><code>upper</code>: The upper bound for inclusion.</li>
</ul>
<p><code>stuermer_trim ()</code> trims the dataset to observations based on propensity score quantiles separately for treated and control group.</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r fold-hide"><code class="sourceCode r"><span id="cb14-1"><a href="getting-started.html#cb14-1" tabindex="-1"></a>stuermer_trim <span class="ot">&lt;-</span> <span class="cf">function</span>(data, <span class="at">treat_col =</span> <span class="st">&quot;treat&quot;</span>, <span class="at">ps_col =</span> <span class="st">&quot;ps_assoverlap&quot;</span>, </span>
<span id="cb14-2"><a href="getting-started.html#cb14-2" tabindex="-1"></a>                         <span class="at">lower_percentile =</span> <span class="fl">0.05</span>, <span class="at">upper_percentile =</span> <span class="fl">0.95</span>) {</span>
<span id="cb14-3"><a href="getting-started.html#cb14-3" tabindex="-1"></a>  treated_ps   <span class="ot">&lt;-</span> data[[ps_col]][data[[treat_col]] <span class="sc">==</span> <span class="dv">1</span>]</span>
<span id="cb14-4"><a href="getting-started.html#cb14-4" tabindex="-1"></a>  untreated_ps <span class="ot">&lt;-</span> data[[ps_col]][data[[treat_col]] <span class="sc">==</span> <span class="dv">0</span>]</span>
<span id="cb14-5"><a href="getting-started.html#cb14-5" tabindex="-1"></a>  lower_cutoff <span class="ot">&lt;-</span> <span class="fu">quantile</span>(treated_ps, <span class="at">probs =</span> lower_percentile, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb14-6"><a href="getting-started.html#cb14-6" tabindex="-1"></a>  upper_cutoff <span class="ot">&lt;-</span> <span class="fu">quantile</span>(untreated_ps, <span class="at">probs =</span> upper_percentile, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb14-7"><a href="getting-started.html#cb14-7" tabindex="-1"></a>  sub <span class="ot">&lt;-</span> data[data[[ps_col]] <span class="sc">&gt;=</span> lower_cutoff <span class="sc">&amp;</span> data[[ps_col]] <span class="sc">&lt;=</span> upper_cutoff, ]</span>
<span id="cb14-8"><a href="getting-started.html#cb14-8" tabindex="-1"></a>  <span class="fu">return</span>(sub)</span>
<span id="cb14-9"><a href="getting-started.html#cb14-9" tabindex="-1"></a>}</span></code></pre></div>
<p><strong>Arguments</strong></p>
<ul>
<li><code>data</code>: The input dataset.</li>
<li><code>treat_col</code>: The column name of the (binary) treatment indicator.</li>
<li><code>ps_col</code>: The column name of propensity scores.</li>
</ul>
<p><code>walker_trim()</code> trims the dataset to observations based on preference scores that adjust for treatment prevalence using logit transformations.</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode r fold-hide"><code class="sourceCode r"><span id="cb15-1"><a href="getting-started.html#cb15-1" tabindex="-1"></a>walker_trim <span class="ot">&lt;-</span> <span class="cf">function</span>(data, <span class="at">treat_col =</span> <span class="st">&quot;treat&quot;</span>, <span class="at">ps_col =</span> <span class="st">&quot;ps_assoverlap&quot;</span>, </span>
<span id="cb15-2"><a href="getting-started.html#cb15-2" tabindex="-1"></a>                        <span class="at">lower_cutoff =</span> <span class="fl">0.3</span>, <span class="at">upper_cutoff =</span> <span class="fl">0.7</span>) {</span>
<span id="cb15-3"><a href="getting-started.html#cb15-3" tabindex="-1"></a>  treat_prevalence  <span class="ot">&lt;-</span> <span class="fu">mean</span>(data[[treat_col]], <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb15-4"><a href="getting-started.html#cb15-4" tabindex="-1"></a>  logit_ps          <span class="ot">&lt;-</span> <span class="fu">log</span>(data[[ps_col]] <span class="sc">/</span> (<span class="dv">1</span> <span class="sc">-</span> data[[ps_col]]))</span>
<span id="cb15-5"><a href="getting-started.html#cb15-5" tabindex="-1"></a>  logit_prevalence  <span class="ot">&lt;-</span> <span class="fu">log</span>(treat_prevalence <span class="sc">/</span> (<span class="dv">1</span> <span class="sc">-</span> treat_prevalence))</span>
<span id="cb15-6"><a href="getting-started.html#cb15-6" tabindex="-1"></a>  preference_score  <span class="ot">&lt;-</span> <span class="dv">1</span> <span class="sc">/</span> (<span class="dv">1</span> <span class="sc">+</span> <span class="fu">exp</span>(<span class="sc">-</span>(logit_ps <span class="sc">-</span> logit_prevalence)))</span>
<span id="cb15-7"><a href="getting-started.html#cb15-7" tabindex="-1"></a>  sub <span class="ot">&lt;-</span> data[preference_score <span class="sc">&gt;=</span> lower_cutoff <span class="sc">&amp;</span> preference_score <span class="sc">&lt;=</span> upper_cutoff, ]</span>
<span id="cb15-8"><a href="getting-started.html#cb15-8" tabindex="-1"></a>  <span class="fu">return</span>(sub)</span>
<span id="cb15-9"><a href="getting-started.html#cb15-9" tabindex="-1"></a>}</span></code></pre></div>
<p><strong>Arguments</strong></p>
<ul>
<li><code>data</code>: The input dataset.</li>
<li><code>treat_col</code>: The column name of the (binary) treatment indicator.</li>
<li><code>ps_col</code>: The column name of propensity scores.</li>
</ul>
</div>
<div id="combined-methods" class="section level4 hasAnchor" number="1.2.3.5">
<h4><span class="header-section-number">1.2.3.5</span> Combined methods<a href="getting-started.html#combined-methods" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p><code>trim_attach_weights()</code> merges trimmed data with original weights, preserving corresponding weight values after trimming.</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode r fold-hide"><code class="sourceCode r"><span id="cb16-1"><a href="getting-started.html#cb16-1" tabindex="-1"></a>trim_attach_weights <span class="ot">&lt;-</span> <span class="cf">function</span>(trimmed_data, original_data, weight_col){</span>
<span id="cb16-2"><a href="getting-started.html#cb16-2" tabindex="-1"></a>trimmed_data<span class="sc">$</span>orig_row   <span class="ot">&lt;-</span> <span class="fu">as.integer</span>(<span class="fu">rownames</span>(trimmed_data))</span>
<span id="cb16-3"><a href="getting-started.html#cb16-3" tabindex="-1"></a>original_data<span class="sc">$</span>orig_row  <span class="ot">&lt;-</span> <span class="fu">as.integer</span>(<span class="fu">rownames</span>(original_data))</span>
<span id="cb16-4"><a href="getting-started.html#cb16-4" tabindex="-1"></a>trimmed_data <span class="ot">&lt;-</span> <span class="fu">merge</span>(</span>
<span id="cb16-5"><a href="getting-started.html#cb16-5" tabindex="-1"></a>  trimmed_data,</span>
<span id="cb16-6"><a href="getting-started.html#cb16-6" tabindex="-1"></a>  original_data[, <span class="fu">c</span>(<span class="st">&quot;orig_row&quot;</span>, weight_col)],</span>
<span id="cb16-7"><a href="getting-started.html#cb16-7" tabindex="-1"></a>  <span class="at">by =</span> <span class="st">&quot;orig_row&quot;</span>,</span>
<span id="cb16-8"><a href="getting-started.html#cb16-8" tabindex="-1"></a>  <span class="at">all.x =</span> <span class="cn">TRUE</span></span>
<span id="cb16-9"><a href="getting-started.html#cb16-9" tabindex="-1"></a>)</span>
<span id="cb16-10"><a href="getting-started.html#cb16-10" tabindex="-1"></a><span class="fu">colnames</span>(trimmed_data)[<span class="fu">colnames</span>(trimmed_data) <span class="sc">==</span> weight_col] <span class="ot">&lt;-</span> <span class="st">&quot;weight&quot;</span></span>
<span id="cb16-11"><a href="getting-started.html#cb16-11" tabindex="-1"></a>trimmed_data<span class="sc">$</span>orig_row <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb16-12"><a href="getting-started.html#cb16-12" tabindex="-1"></a>original_data<span class="sc">$</span>orig_row <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb16-13"><a href="getting-started.html#cb16-13" tabindex="-1"></a><span class="fu">return</span>(trimmed_data)</span>
<span id="cb16-14"><a href="getting-started.html#cb16-14" tabindex="-1"></a>}</span></code></pre></div>
<p><strong>Arguments</strong></p>
<ul>
<li><code>trimmed_data</code>: The dataset resulting from trimming procedures, typically a subset of the original dataset.</li>
<li><code>original_data</code>: The full dataset before trimming.</li>
<li><code>weight_col</code>: The name of the column in <code>original_data</code> that holds the weights to be transferred.</li>
</ul>
<p><br></p>
<p><a name="eval-mthds"></a></p>
</div>
</div>
<div id="reassessing-methods" class="section level3 hasAnchor" number="1.2.4">
<h3><span class="header-section-number">1.2.4</span> Reassessing methods<a href="getting-started.html#reassessing-methods" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div id="matching-1" class="section level4 hasAnchor" number="1.2.4.1">
<h4><span class="header-section-number">1.2.4.1</span> Matching<a href="getting-started.html#matching-1" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p><code>get_smd_stats()</code> extracts mean and maximum absolute standardized mean differences (SMDs) from a balance object to assess covariate balance.</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode r fold-hide"><code class="sourceCode r"><span id="cb17-1"><a href="getting-started.html#cb17-1" tabindex="-1"></a>get_smd_stats <span class="ot">&lt;-</span> <span class="cf">function</span>(match_object) {</span>
<span id="cb17-2"><a href="getting-started.html#cb17-2" tabindex="-1"></a>  bal <span class="ot">&lt;-</span> <span class="fu">bal.tab</span>(match_object, <span class="at">stats =</span> <span class="st">&quot;mean.diffs&quot;</span>, <span class="at">un =</span> <span class="cn">TRUE</span>, <span class="at">s.d.denom =</span> <span class="st">&quot;treated&quot;</span>)</span>
<span id="cb17-3"><a href="getting-started.html#cb17-3" tabindex="-1"></a>  smds <span class="ot">&lt;-</span> bal<span class="sc">$</span>Balance<span class="sc">$</span>Diff.Adj</span>
<span id="cb17-4"><a href="getting-started.html#cb17-4" tabindex="-1"></a>  smds <span class="ot">&lt;-</span> smds[<span class="sc">!</span>(<span class="fu">rownames</span>(bal<span class="sc">$</span>Balance) <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&quot;distance&quot;</span>))]</span>
<span id="cb17-5"><a href="getting-started.html#cb17-5" tabindex="-1"></a>  mean_smd <span class="ot">&lt;-</span> <span class="fu">mean</span>(<span class="fu">abs</span>(smds), <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb17-6"><a href="getting-started.html#cb17-6" tabindex="-1"></a>  max_smd <span class="ot">&lt;-</span> <span class="fu">max</span>(<span class="fu">abs</span>(smds), <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb17-7"><a href="getting-started.html#cb17-7" tabindex="-1"></a>  <span class="fu">return</span>(<span class="fu">c</span>(<span class="at">Mean_Abs_SMD =</span> mean_smd, <span class="at">Max_Abs_SMD =</span> max_smd))</span>
<span id="cb17-8"><a href="getting-started.html#cb17-8" tabindex="-1"></a>}</span></code></pre></div>
<p><strong>Argument</strong></p>
<ul>
<li><code>match_object</code>: The balance / matching object, containing information on covariate balance.</li>
</ul>
<p><code>compute_abs_smd_matchit()</code> computes absolute SMDs for a list of MatchIt objects and returns summary statistics.</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode r fold-hide"><code class="sourceCode r"><span id="cb18-1"><a href="getting-started.html#cb18-1" tabindex="-1"></a>compute_abs_smd_matchit <span class="ot">&lt;-</span> <span class="cf">function</span>(match_list) {</span>
<span id="cb18-2"><a href="getting-started.html#cb18-2" tabindex="-1"></a>  smd_list <span class="ot">&lt;-</span> <span class="fu">lapply</span>(match_list, get_smd_stats)       </span>
<span id="cb18-3"><a href="getting-started.html#cb18-3" tabindex="-1"></a>  smd_mat <span class="ot">&lt;-</span> <span class="fu">do.call</span>(rbind, smd_list)                 </span>
<span id="cb18-4"><a href="getting-started.html#cb18-4" tabindex="-1"></a>  smd_df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb18-5"><a href="getting-started.html#cb18-5" tabindex="-1"></a>    <span class="at">Method =</span> <span class="fu">names</span>(match_list),</span>
<span id="cb18-6"><a href="getting-started.html#cb18-6" tabindex="-1"></a>    <span class="at">Mean_Abs_SMD =</span> smd_mat[, <span class="st">&quot;Mean_Abs_SMD&quot;</span>],</span>
<span id="cb18-7"><a href="getting-started.html#cb18-7" tabindex="-1"></a>    <span class="at">Max_Abs_SMD  =</span> smd_mat[, <span class="st">&quot;Max_Abs_SMD&quot;</span>],</span>
<span id="cb18-8"><a href="getting-started.html#cb18-8" tabindex="-1"></a>    <span class="at">row.names =</span> <span class="cn">NULL</span></span>
<span id="cb18-9"><a href="getting-started.html#cb18-9" tabindex="-1"></a>  )</span>
<span id="cb18-10"><a href="getting-started.html#cb18-10" tabindex="-1"></a>  <span class="fu">return</span>(smd_df)</span>
<span id="cb18-11"><a href="getting-started.html#cb18-11" tabindex="-1"></a>}  </span></code></pre></div>
<p><strong>Argument</strong></p>
<ul>
<li><code>match_list</code>: A named list of MatchIt objects.</li>
</ul>
<p><code>compute_ess_matchit()</code> extracts and formats effective sample size (ESS) information from the balance summary of a MatchIt object.</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode r fold-hide"><code class="sourceCode r"><span id="cb19-1"><a href="getting-started.html#cb19-1" tabindex="-1"></a>compute_ess_matchit <span class="ot">&lt;-</span> <span class="cf">function</span>(bal_tab_object) {</span>
<span id="cb19-2"><a href="getting-started.html#cb19-2" tabindex="-1"></a>  samples <span class="ot">&lt;-</span> bal_tab_object<span class="sc">$</span>Observations</span>
<span id="cb19-3"><a href="getting-started.html#cb19-3" tabindex="-1"></a>  df <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(samples)</span>
<span id="cb19-4"><a href="getting-started.html#cb19-4" tabindex="-1"></a>  df<span class="sc">$</span>Method <span class="ot">&lt;-</span> <span class="fu">rownames</span>(samples)</span>
<span id="cb19-5"><a href="getting-started.html#cb19-5" tabindex="-1"></a>  df <span class="ot">&lt;-</span> df[, <span class="fu">c</span>(<span class="st">&quot;Method&quot;</span>,<span class="st">&quot;Control&quot;</span>, <span class="st">&quot;Treated&quot;</span>)]</span>
<span id="cb19-6"><a href="getting-started.html#cb19-6" tabindex="-1"></a>  <span class="fu">rownames</span>(df) <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb19-7"><a href="getting-started.html#cb19-7" tabindex="-1"></a>  df</span>
<span id="cb19-8"><a href="getting-started.html#cb19-8" tabindex="-1"></a>}</span></code></pre></div>
<p><strong>Argument</strong></p>
<ul>
<li><code>bal_tab_object</code>: A balance table object that contains ESS information from matched data.</li>
</ul>
<p><code>plot_matchit()</code> generates balance plots for a list of MatchIt objects, visualizing covariate balance before and after matching.</p>
<div class="sourceCode" id="cb20"><pre class="sourceCode r fold-hide"><code class="sourceCode r"><span id="cb20-1"><a href="getting-started.html#cb20-1" tabindex="-1"></a>plot_matchit <span class="ot">&lt;-</span> <span class="cf">function</span>(match_list, dataset_name) {</span>
<span id="cb20-2"><a href="getting-started.html#cb20-2" tabindex="-1"></a>  <span class="cf">for</span> (method_name <span class="cf">in</span> <span class="fu">names</span>(match_list)) {</span>
<span id="cb20-3"><a href="getting-started.html#cb20-3" tabindex="-1"></a>    match_obj <span class="ot">&lt;-</span> match_list[[method_name]]</span>
<span id="cb20-4"><a href="getting-started.html#cb20-4" tabindex="-1"></a>    <span class="cf">if</span> (method_name <span class="sc">==</span> <span class="st">&quot;subcl&quot;</span>) {</span>
<span id="cb20-5"><a href="getting-started.html#cb20-5" tabindex="-1"></a>      <span class="fu">plot</span>(<span class="fu">summary</span>(match_obj, <span class="at">subclass =</span> <span class="cn">TRUE</span>), </span>
<span id="cb20-6"><a href="getting-started.html#cb20-6" tabindex="-1"></a>           <span class="at">main =</span> <span class="fu">paste0</span>(dataset_name, <span class="st">&quot; - &quot;</span>, method_name,<span class="st">&quot; matching&quot;</span>))</span>
<span id="cb20-7"><a href="getting-started.html#cb20-7" tabindex="-1"></a>    } <span class="cf">else</span> {</span>
<span id="cb20-8"><a href="getting-started.html#cb20-8" tabindex="-1"></a>      <span class="fu">plot</span>(<span class="fu">summary</span>(match_obj), </span>
<span id="cb20-9"><a href="getting-started.html#cb20-9" tabindex="-1"></a>           <span class="at">main =</span> <span class="fu">paste0</span>(dataset_name, <span class="st">&quot; - &quot;</span>, method_name,<span class="st">&quot; matching&quot;</span>))</span>
<span id="cb20-10"><a href="getting-started.html#cb20-10" tabindex="-1"></a>    }</span>
<span id="cb20-11"><a href="getting-started.html#cb20-11" tabindex="-1"></a>  }</span>
<span id="cb20-12"><a href="getting-started.html#cb20-12" tabindex="-1"></a>}</span></code></pre></div>
<p><strong>Arguments</strong></p>
<ul>
<li><code>match_list</code>: A named list of MatchIt objects.</li>
<li><code>dataset_name</code>: A string naming the dataset for use in plot titles.</li>
</ul>
</div>
<div id="weighting-1" class="section level4 hasAnchor" number="1.2.4.2">
<h4><span class="header-section-number">1.2.4.2</span> Weighting<a href="getting-started.html#weighting-1" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p><code>compute_abs_smd_weight()</code> calculates absolute SMDs for datasets weighted by specified weight vectors.</p>
<div class="sourceCode" id="cb21"><pre class="sourceCode r fold-hide"><code class="sourceCode r"><span id="cb21-1"><a href="getting-started.html#cb21-1" tabindex="-1"></a>compute_abs_smd_weight <span class="ot">&lt;-</span> <span class="cf">function</span>(data, treat, covar, weight_cols) {</span>
<span id="cb21-2"><a href="getting-started.html#cb21-2" tabindex="-1"></a>  smd_list <span class="ot">&lt;-</span> <span class="fu">lapply</span>(weight_cols, <span class="cf">function</span>(wcol) {</span>
<span id="cb21-3"><a href="getting-started.html#cb21-3" tabindex="-1"></a>    bal_obj <span class="ot">&lt;-</span> cobalt<span class="sc">::</span><span class="fu">bal.tab</span>(</span>
<span id="cb21-4"><a href="getting-started.html#cb21-4" tabindex="-1"></a>      <span class="fu">as.formula</span>(<span class="fu">paste</span>(treat, <span class="st">&quot;~&quot;</span>, <span class="fu">paste</span>(covar, <span class="at">collapse =</span> <span class="st">&quot; + &quot;</span>))),</span>
<span id="cb21-5"><a href="getting-started.html#cb21-5" tabindex="-1"></a>      <span class="at">data =</span> data,</span>
<span id="cb21-6"><a href="getting-started.html#cb21-6" tabindex="-1"></a>      <span class="at">weights =</span> data[[wcol]],</span>
<span id="cb21-7"><a href="getting-started.html#cb21-7" tabindex="-1"></a>      <span class="at">un =</span> <span class="cn">TRUE</span>,</span>
<span id="cb21-8"><a href="getting-started.html#cb21-8" tabindex="-1"></a>      <span class="at">s.d.denom =</span> <span class="st">&quot;treated&quot;</span></span>
<span id="cb21-9"><a href="getting-started.html#cb21-9" tabindex="-1"></a>    )</span>
<span id="cb21-10"><a href="getting-started.html#cb21-10" tabindex="-1"></a>    smd_df <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(bal_obj<span class="sc">$</span>Balance)</span>
<span id="cb21-11"><a href="getting-started.html#cb21-11" tabindex="-1"></a>    smd_vals <span class="ot">&lt;-</span> <span class="fu">abs</span>(smd_df<span class="sc">$</span>Diff.Adj)</span>
<span id="cb21-12"><a href="getting-started.html#cb21-12" tabindex="-1"></a>    mean_smd <span class="ot">&lt;-</span> <span class="fu">mean</span>(smd_vals, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb21-13"><a href="getting-started.html#cb21-13" tabindex="-1"></a>    max_smd  <span class="ot">&lt;-</span> <span class="fu">max</span>(smd_vals, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb21-14"><a href="getting-started.html#cb21-14" tabindex="-1"></a>    <span class="fu">return</span>(<span class="fu">data.frame</span>(</span>
<span id="cb21-15"><a href="getting-started.html#cb21-15" tabindex="-1"></a>      <span class="at">Method =</span> wcol,</span>
<span id="cb21-16"><a href="getting-started.html#cb21-16" tabindex="-1"></a>      <span class="at">Mean_Abs_SMD =</span> mean_smd,</span>
<span id="cb21-17"><a href="getting-started.html#cb21-17" tabindex="-1"></a>      <span class="at">Max_Abs_SMD  =</span> max_smd</span>
<span id="cb21-18"><a href="getting-started.html#cb21-18" tabindex="-1"></a>    ))</span>
<span id="cb21-19"><a href="getting-started.html#cb21-19" tabindex="-1"></a>  })</span>
<span id="cb21-20"><a href="getting-started.html#cb21-20" tabindex="-1"></a>  <span class="fu">do.call</span>(rbind, smd_list)</span>
<span id="cb21-21"><a href="getting-started.html#cb21-21" tabindex="-1"></a>}</span></code></pre></div>
<p><strong>Arguments</strong></p>
<ul>
<li><code>data</code>: The input dataset.</li>
<li><code>treat</code>: The name of the binary treatment indicator variable.</li>
<li><code>covar</code>: A vector of covariate names.</li>
<li><code>weight_cols</code>:The name of the columns holding the weights.</li>
</ul>
<p><code>compute_ess_weight()</code> extracts ESS associated with different weighting schemes.</p>
<div class="sourceCode" id="cb22"><pre class="sourceCode r fold-hide"><code class="sourceCode r"><span id="cb22-1"><a href="getting-started.html#cb22-1" tabindex="-1"></a>compute_ess_weight <span class="ot">&lt;-</span> <span class="cf">function</span>(data, treat, covar, weight_cols) {</span>
<span id="cb22-2"><a href="getting-started.html#cb22-2" tabindex="-1"></a>  ess_list <span class="ot">&lt;-</span> <span class="fu">lapply</span>(weight_cols, <span class="cf">function</span>(wcol) {</span>
<span id="cb22-3"><a href="getting-started.html#cb22-3" tabindex="-1"></a>    bal_obj <span class="ot">&lt;-</span> cobalt<span class="sc">::</span><span class="fu">bal.tab</span>(</span>
<span id="cb22-4"><a href="getting-started.html#cb22-4" tabindex="-1"></a>      <span class="fu">as.formula</span>(<span class="fu">paste</span>(treat, <span class="st">&quot;~&quot;</span>, <span class="fu">paste</span>(covar, <span class="at">collapse =</span> <span class="st">&quot; + &quot;</span>))),</span>
<span id="cb22-5"><a href="getting-started.html#cb22-5" tabindex="-1"></a>      <span class="at">data =</span> data,</span>
<span id="cb22-6"><a href="getting-started.html#cb22-6" tabindex="-1"></a>      <span class="at">weights =</span> data[[wcol]],</span>
<span id="cb22-7"><a href="getting-started.html#cb22-7" tabindex="-1"></a>      <span class="at">un =</span> <span class="cn">FALSE</span></span>
<span id="cb22-8"><a href="getting-started.html#cb22-8" tabindex="-1"></a>    )</span>
<span id="cb22-9"><a href="getting-started.html#cb22-9" tabindex="-1"></a>    samples <span class="ot">&lt;-</span> bal_obj<span class="sc">$</span>Observations</span>
<span id="cb22-10"><a href="getting-started.html#cb22-10" tabindex="-1"></a>    <span class="cf">if</span> (<span class="st">&quot;Adjusted&quot;</span> <span class="sc">%in%</span> <span class="fu">rownames</span>(samples)) {</span>
<span id="cb22-11"><a href="getting-started.html#cb22-11" tabindex="-1"></a>      df <span class="ot">&lt;-</span> samples[<span class="st">&quot;Adjusted&quot;</span>, <span class="fu">c</span>(<span class="st">&quot;Control&quot;</span>, <span class="st">&quot;Treated&quot;</span>), drop <span class="ot">=</span> <span class="cn">FALSE</span>]</span>
<span id="cb22-12"><a href="getting-started.html#cb22-12" tabindex="-1"></a>    } <span class="cf">else</span> {</span>
<span id="cb22-13"><a href="getting-started.html#cb22-13" tabindex="-1"></a>      df <span class="ot">&lt;-</span> samples[<span class="dv">1</span>, <span class="fu">c</span>(<span class="st">&quot;Control&quot;</span>, <span class="st">&quot;Treated&quot;</span>), drop <span class="ot">=</span> <span class="cn">FALSE</span>]</span>
<span id="cb22-14"><a href="getting-started.html#cb22-14" tabindex="-1"></a>    }</span>
<span id="cb22-15"><a href="getting-started.html#cb22-15" tabindex="-1"></a>    df <span class="ot">&lt;-</span> <span class="fu">cbind</span>(<span class="at">Method =</span> wcol, df)</span>
<span id="cb22-16"><a href="getting-started.html#cb22-16" tabindex="-1"></a>    <span class="fu">rownames</span>(df) <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb22-17"><a href="getting-started.html#cb22-17" tabindex="-1"></a>    <span class="fu">return</span>(df)</span>
<span id="cb22-18"><a href="getting-started.html#cb22-18" tabindex="-1"></a>  })</span>
<span id="cb22-19"><a href="getting-started.html#cb22-19" tabindex="-1"></a>  <span class="fu">do.call</span>(rbind, ess_list)</span>
<span id="cb22-20"><a href="getting-started.html#cb22-20" tabindex="-1"></a>}</span></code></pre></div>
<p><strong>Arguments</strong></p>
<ul>
<li><code>data</code>: The input dataset.</li>
<li><code>treat</code>: The name of the binary treatment indicator variable.</li>
<li><code>covar</code>: A vector of covariate names.</li>
<li><code>weight_cols</code>: The name of the columns holding the weights.</li>
</ul>
<p><code>plot_weighting_methods()</code> generates love plots, visualizing covariate balance under different weighting methods.</p>
<div class="sourceCode" id="cb23"><pre class="sourceCode r fold-hide"><code class="sourceCode r"><span id="cb23-1"><a href="getting-started.html#cb23-1" tabindex="-1"></a>plot_weighting_methods <span class="ot">&lt;-</span> <span class="cf">function</span>(data, treat, covar, weight_list, <span class="at">dataset_name =</span> <span class="cn">NULL</span>) {</span>
<span id="cb23-2"><a href="getting-started.html#cb23-2" tabindex="-1"></a>  <span class="cf">for</span> (wcol <span class="cf">in</span> <span class="fu">names</span>(weight_list)) {</span>
<span id="cb23-3"><a href="getting-started.html#cb23-3" tabindex="-1"></a>    bal_obj <span class="ot">&lt;-</span> cobalt<span class="sc">::</span><span class="fu">bal.tab</span>(</span>
<span id="cb23-4"><a href="getting-started.html#cb23-4" tabindex="-1"></a>      <span class="fu">as.formula</span>(<span class="fu">paste</span>(treat, <span class="st">&quot;~&quot;</span>, <span class="fu">paste</span>(covar, <span class="at">collapse =</span> <span class="st">&quot; + &quot;</span>))),</span>
<span id="cb23-5"><a href="getting-started.html#cb23-5" tabindex="-1"></a>      <span class="at">data =</span> data,</span>
<span id="cb23-6"><a href="getting-started.html#cb23-6" tabindex="-1"></a>      <span class="at">weights =</span> weight_list[[wcol]],</span>
<span id="cb23-7"><a href="getting-started.html#cb23-7" tabindex="-1"></a>      <span class="at">un =</span> <span class="cn">TRUE</span>,</span>
<span id="cb23-8"><a href="getting-started.html#cb23-8" tabindex="-1"></a>      <span class="at">s.d.denom =</span> <span class="st">&quot;treated&quot;</span></span>
<span id="cb23-9"><a href="getting-started.html#cb23-9" tabindex="-1"></a>    )</span>
<span id="cb23-10"><a href="getting-started.html#cb23-10" tabindex="-1"></a>    title_text <span class="ot">&lt;-</span> <span class="cf">if</span> (<span class="sc">!</span><span class="fu">is.null</span>(dataset_name)) <span class="fu">paste</span>(dataset_name, <span class="st">&quot;-&quot;</span>, wcol, <span class="st">&quot;weighting&quot;</span>) <span class="cf">else</span> wcol</span>
<span id="cb23-11"><a href="getting-started.html#cb23-11" tabindex="-1"></a>    lp <span class="ot">&lt;-</span> cobalt<span class="sc">::</span><span class="fu">love.plot</span>(</span>
<span id="cb23-12"><a href="getting-started.html#cb23-12" tabindex="-1"></a>      bal_obj,</span>
<span id="cb23-13"><a href="getting-started.html#cb23-13" tabindex="-1"></a>      <span class="at">stats =</span> <span class="st">&quot;mean.diffs&quot;</span>,</span>
<span id="cb23-14"><a href="getting-started.html#cb23-14" tabindex="-1"></a>      <span class="at">abs =</span> <span class="cn">TRUE</span>,</span>
<span id="cb23-15"><a href="getting-started.html#cb23-15" tabindex="-1"></a>      <span class="at">var.order =</span> <span class="st">&quot;unadjusted&quot;</span>,</span>
<span id="cb23-16"><a href="getting-started.html#cb23-16" tabindex="-1"></a>      <span class="at">thresholds =</span> <span class="fu">c</span>(<span class="at">m =</span> <span class="fl">0.1</span>),</span>
<span id="cb23-17"><a href="getting-started.html#cb23-17" tabindex="-1"></a>      <span class="at">title =</span> title_text</span>
<span id="cb23-18"><a href="getting-started.html#cb23-18" tabindex="-1"></a>    )</span>
<span id="cb23-19"><a href="getting-started.html#cb23-19" tabindex="-1"></a>    <span class="fu">print</span>(lp)</span>
<span id="cb23-20"><a href="getting-started.html#cb23-20" tabindex="-1"></a>  }</span>
<span id="cb23-21"><a href="getting-started.html#cb23-21" tabindex="-1"></a>}</span></code></pre></div>
<p><strong>Arguments</strong></p>
<ul>
<li><code>data</code>: The input dataset.</li>
<li><code>treat</code>: The name of the binary treatment indicator variable.</li>
<li><code>covar</code>: A vector of covariate names.</li>
<li><code>weight_list</code>: A named list of weight vectors.</li>
<li><code>dataset_name</code>: The dataset name for plot titles.</li>
</ul>
</div>
<div id="truncation-1" class="section level4 hasAnchor" number="1.2.4.3">
<h4><span class="header-section-number">1.2.4.3</span> Truncation<a href="getting-started.html#truncation-1" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p><code>compute_abs_smd_trunc()</code> calculates absolute SMDs for truncated weight datasets across different truncation methods and weighting variables.</p>
<div class="sourceCode" id="cb24"><pre class="sourceCode r fold-hide"><code class="sourceCode r"><span id="cb24-1"><a href="getting-started.html#cb24-1" tabindex="-1"></a>compute_abs_smd_trunc <span class="ot">&lt;-</span> <span class="cf">function</span>(trunc_list, treat, covar, weight_cols) {</span>
<span id="cb24-2"><a href="getting-started.html#cb24-2" tabindex="-1"></a>  all_smd <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb24-3"><a href="getting-started.html#cb24-3" tabindex="-1"></a>  <span class="cf">for</span>(trunc_name <span class="cf">in</span> <span class="fu">names</span>(trunc_list)) {</span>
<span id="cb24-4"><a href="getting-started.html#cb24-4" tabindex="-1"></a>    dataset <span class="ot">&lt;-</span> trunc_list[[trunc_name]]</span>
<span id="cb24-5"><a href="getting-started.html#cb24-5" tabindex="-1"></a>    smd_list <span class="ot">&lt;-</span> <span class="fu">lapply</span>(weight_cols, <span class="cf">function</span>(wcol) {</span>
<span id="cb24-6"><a href="getting-started.html#cb24-6" tabindex="-1"></a>      <span class="cf">if</span> (wcol <span class="sc">%in%</span> <span class="fu">names</span>(dataset)) {</span>
<span id="cb24-7"><a href="getting-started.html#cb24-7" tabindex="-1"></a>        bal_obj <span class="ot">&lt;-</span> cobalt<span class="sc">::</span><span class="fu">bal.tab</span>(</span>
<span id="cb24-8"><a href="getting-started.html#cb24-8" tabindex="-1"></a>          <span class="fu">as.formula</span>(<span class="fu">paste</span>(treat, <span class="st">&quot;~&quot;</span>, <span class="fu">paste</span>(covar, <span class="at">collapse =</span> <span class="st">&quot; + &quot;</span>))),</span>
<span id="cb24-9"><a href="getting-started.html#cb24-9" tabindex="-1"></a>          <span class="at">data =</span> dataset,</span>
<span id="cb24-10"><a href="getting-started.html#cb24-10" tabindex="-1"></a>          <span class="at">weights =</span> dataset[[wcol]],</span>
<span id="cb24-11"><a href="getting-started.html#cb24-11" tabindex="-1"></a>          <span class="at">un =</span> <span class="cn">TRUE</span>,</span>
<span id="cb24-12"><a href="getting-started.html#cb24-12" tabindex="-1"></a>          <span class="at">s.d.denom =</span> <span class="st">&quot;treated&quot;</span></span>
<span id="cb24-13"><a href="getting-started.html#cb24-13" tabindex="-1"></a>        )</span>
<span id="cb24-14"><a href="getting-started.html#cb24-14" tabindex="-1"></a>        smd_df <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(bal_obj<span class="sc">$</span>Balance)</span>
<span id="cb24-15"><a href="getting-started.html#cb24-15" tabindex="-1"></a>        smd_vals <span class="ot">&lt;-</span> <span class="fu">abs</span>(smd_df<span class="sc">$</span>Diff.Adj)</span>
<span id="cb24-16"><a href="getting-started.html#cb24-16" tabindex="-1"></a>        <span class="fu">data.frame</span>(</span>
<span id="cb24-17"><a href="getting-started.html#cb24-17" tabindex="-1"></a>          <span class="at">Method =</span> <span class="fu">paste</span>(trunc_name, wcol, <span class="at">sep =</span> <span class="st">&quot;_&quot;</span>),</span>
<span id="cb24-18"><a href="getting-started.html#cb24-18" tabindex="-1"></a>          <span class="at">Mean_Abs_SMD =</span> <span class="fu">mean</span>(smd_vals, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb24-19"><a href="getting-started.html#cb24-19" tabindex="-1"></a>          <span class="at">Max_Abs_SMD =</span> <span class="fu">max</span>(smd_vals, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb24-20"><a href="getting-started.html#cb24-20" tabindex="-1"></a>        )</span>
<span id="cb24-21"><a href="getting-started.html#cb24-21" tabindex="-1"></a>      } <span class="cf">else</span> {</span>
<span id="cb24-22"><a href="getting-started.html#cb24-22" tabindex="-1"></a>        <span class="cn">NULL</span></span>
<span id="cb24-23"><a href="getting-started.html#cb24-23" tabindex="-1"></a>      }</span>
<span id="cb24-24"><a href="getting-started.html#cb24-24" tabindex="-1"></a>    })</span>
<span id="cb24-25"><a href="getting-started.html#cb24-25" tabindex="-1"></a>    all_smd[[trunc_name]] <span class="ot">&lt;-</span> <span class="fu">do.call</span>(rbind, smd_list)</span>
<span id="cb24-26"><a href="getting-started.html#cb24-26" tabindex="-1"></a>  }</span>
<span id="cb24-27"><a href="getting-started.html#cb24-27" tabindex="-1"></a>  smd_summary <span class="ot">&lt;-</span> <span class="fu">do.call</span>(rbind, all_smd)</span>
<span id="cb24-28"><a href="getting-started.html#cb24-28" tabindex="-1"></a>  <span class="fu">rownames</span>(smd_summary) <span class="ot">&lt;-</span> <span class="cn">NULL</span>  </span>
<span id="cb24-29"><a href="getting-started.html#cb24-29" tabindex="-1"></a>  <span class="fu">return</span>(smd_summary)</span>
<span id="cb24-30"><a href="getting-started.html#cb24-30" tabindex="-1"></a>}</span></code></pre></div>
<p><strong>Arguments</strong></p>
<ul>
<li><code>trunc_list</code>: A list of datasets with truncated weights.</li>
<li><code>treat</code>: The name of the binary treatment indicator variable.</li>
<li><code>covar</code>: A vector of covariate names.</li>
<li><code>weight_cols</code>: The name of the columns holding the weights.</li>
</ul>
<p><code>compute_ess_trunc()</code> computes ESS values for truncated weight datasets considering different methods and weights.</p>
<div class="sourceCode" id="cb25"><pre class="sourceCode r fold-hide"><code class="sourceCode r"><span id="cb25-1"><a href="getting-started.html#cb25-1" tabindex="-1"></a>compute_ess_trunc <span class="ot">&lt;-</span> <span class="cf">function</span>(trunc_list, treat, covar, weight_cols) {</span>
<span id="cb25-2"><a href="getting-started.html#cb25-2" tabindex="-1"></a>  all_ess <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb25-3"><a href="getting-started.html#cb25-3" tabindex="-1"></a>  <span class="cf">for</span>(trunc_name <span class="cf">in</span> <span class="fu">names</span>(trunc_list)) {</span>
<span id="cb25-4"><a href="getting-started.html#cb25-4" tabindex="-1"></a>    dataset <span class="ot">&lt;-</span> trunc_list[[trunc_name]]</span>
<span id="cb25-5"><a href="getting-started.html#cb25-5" tabindex="-1"></a>    ess_list <span class="ot">&lt;-</span> <span class="fu">lapply</span>(weight_cols, <span class="cf">function</span>(wcol) {</span>
<span id="cb25-6"><a href="getting-started.html#cb25-6" tabindex="-1"></a>      <span class="cf">if</span> (wcol <span class="sc">%in%</span> <span class="fu">names</span>(dataset)) {</span>
<span id="cb25-7"><a href="getting-started.html#cb25-7" tabindex="-1"></a>        bal_obj <span class="ot">&lt;-</span> cobalt<span class="sc">::</span><span class="fu">bal.tab</span>(</span>
<span id="cb25-8"><a href="getting-started.html#cb25-8" tabindex="-1"></a>          <span class="fu">as.formula</span>(<span class="fu">paste</span>(treat, <span class="st">&quot;~&quot;</span>, <span class="fu">paste</span>(covar, <span class="at">collapse =</span> <span class="st">&quot; + &quot;</span>))),</span>
<span id="cb25-9"><a href="getting-started.html#cb25-9" tabindex="-1"></a>          <span class="at">data =</span> dataset,</span>
<span id="cb25-10"><a href="getting-started.html#cb25-10" tabindex="-1"></a>          <span class="at">weights =</span> dataset[[wcol]],</span>
<span id="cb25-11"><a href="getting-started.html#cb25-11" tabindex="-1"></a>          <span class="at">un =</span> <span class="cn">FALSE</span>,</span>
<span id="cb25-12"><a href="getting-started.html#cb25-12" tabindex="-1"></a>          <span class="at">s.d.denom =</span> <span class="st">&quot;treated&quot;</span></span>
<span id="cb25-13"><a href="getting-started.html#cb25-13" tabindex="-1"></a>        )</span>
<span id="cb25-14"><a href="getting-started.html#cb25-14" tabindex="-1"></a>        samples <span class="ot">&lt;-</span> bal_obj<span class="sc">$</span>Observations</span>
<span id="cb25-15"><a href="getting-started.html#cb25-15" tabindex="-1"></a>        <span class="cf">if</span> (<span class="st">&quot;Adjusted&quot;</span> <span class="sc">%in%</span> <span class="fu">rownames</span>(samples)) {</span>
<span id="cb25-16"><a href="getting-started.html#cb25-16" tabindex="-1"></a>          df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb25-17"><a href="getting-started.html#cb25-17" tabindex="-1"></a>            <span class="at">Method =</span> <span class="fu">paste</span>(trunc_name, wcol, <span class="at">sep =</span> <span class="st">&quot;_&quot;</span>),</span>
<span id="cb25-18"><a href="getting-started.html#cb25-18" tabindex="-1"></a>            <span class="at">Control =</span> samples[<span class="st">&quot;Adjusted&quot;</span>, <span class="st">&quot;Control&quot;</span>],</span>
<span id="cb25-19"><a href="getting-started.html#cb25-19" tabindex="-1"></a>            <span class="at">Treated =</span> samples[<span class="st">&quot;Adjusted&quot;</span>, <span class="st">&quot;Treated&quot;</span>]</span>
<span id="cb25-20"><a href="getting-started.html#cb25-20" tabindex="-1"></a>          )</span>
<span id="cb25-21"><a href="getting-started.html#cb25-21" tabindex="-1"></a>        } <span class="cf">else</span> {</span>
<span id="cb25-22"><a href="getting-started.html#cb25-22" tabindex="-1"></a>          df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb25-23"><a href="getting-started.html#cb25-23" tabindex="-1"></a>            <span class="at">Method =</span> <span class="fu">paste</span>(trunc_name, wcol, <span class="at">sep =</span> <span class="st">&quot;_&quot;</span>),</span>
<span id="cb25-24"><a href="getting-started.html#cb25-24" tabindex="-1"></a>            <span class="at">Control =</span> samples[<span class="dv">1</span>, <span class="st">&quot;Control&quot;</span>],</span>
<span id="cb25-25"><a href="getting-started.html#cb25-25" tabindex="-1"></a>            <span class="at">Treated =</span> samples[<span class="dv">1</span>, <span class="st">&quot;Treated&quot;</span>]</span>
<span id="cb25-26"><a href="getting-started.html#cb25-26" tabindex="-1"></a>          )</span>
<span id="cb25-27"><a href="getting-started.html#cb25-27" tabindex="-1"></a>        }</span>
<span id="cb25-28"><a href="getting-started.html#cb25-28" tabindex="-1"></a>        df</span>
<span id="cb25-29"><a href="getting-started.html#cb25-29" tabindex="-1"></a>      } <span class="cf">else</span> {</span>
<span id="cb25-30"><a href="getting-started.html#cb25-30" tabindex="-1"></a>        <span class="cn">NULL</span></span>
<span id="cb25-31"><a href="getting-started.html#cb25-31" tabindex="-1"></a>      }</span>
<span id="cb25-32"><a href="getting-started.html#cb25-32" tabindex="-1"></a>    })</span>
<span id="cb25-33"><a href="getting-started.html#cb25-33" tabindex="-1"></a>    all_ess[[trunc_name]] <span class="ot">&lt;-</span> <span class="fu">do.call</span>(rbind, ess_list)</span>
<span id="cb25-34"><a href="getting-started.html#cb25-34" tabindex="-1"></a>  }</span>
<span id="cb25-35"><a href="getting-started.html#cb25-35" tabindex="-1"></a>  ess_summary <span class="ot">&lt;-</span> <span class="fu">do.call</span>(rbind, all_ess)</span>
<span id="cb25-36"><a href="getting-started.html#cb25-36" tabindex="-1"></a>  <span class="fu">rownames</span>(ess_summary) <span class="ot">&lt;-</span> <span class="cn">NULL</span>   </span>
<span id="cb25-37"><a href="getting-started.html#cb25-37" tabindex="-1"></a>  <span class="fu">return</span>(ess_summary)</span>
<span id="cb25-38"><a href="getting-started.html#cb25-38" tabindex="-1"></a>}</span></code></pre></div>
<p><strong>Arguments</strong></p>
<ul>
<li><code>trunc_list</code>: A list of truncated weight datasets.</li>
<li><code>treat</code>: The name of the binary treatment indicator variable.</li>
<li><code>covar</code>: A vector of covariate names.</li>
<li><code>weight_cols</code>: The name of the columns holding the weights.</li>
</ul>
<p><code>plot_trunc_methods()</code> produces love plots for various truncation methods and weight types, visualizing covariate balance before and after truncation.</p>
<div class="sourceCode" id="cb26"><pre class="sourceCode r fold-hide"><code class="sourceCode r"><span id="cb26-1"><a href="getting-started.html#cb26-1" tabindex="-1"></a>plot_trunc_methods <span class="ot">&lt;-</span> <span class="cf">function</span>(trunc_list, treat, covar, weight_cols, <span class="at">dataset_name =</span> <span class="cn">NULL</span>) {</span>
<span id="cb26-2"><a href="getting-started.html#cb26-2" tabindex="-1"></a>  <span class="cf">for</span>(trunc_name <span class="cf">in</span> <span class="fu">names</span>(trunc_list)) {</span>
<span id="cb26-3"><a href="getting-started.html#cb26-3" tabindex="-1"></a>    dataset <span class="ot">&lt;-</span> trunc_list[[trunc_name]]</span>
<span id="cb26-4"><a href="getting-started.html#cb26-4" tabindex="-1"></a>    <span class="cf">for</span>(wcol <span class="cf">in</span> weight_cols) {</span>
<span id="cb26-5"><a href="getting-started.html#cb26-5" tabindex="-1"></a>      <span class="cf">if</span>(wcol <span class="sc">%in%</span> <span class="fu">names</span>(dataset)) {</span>
<span id="cb26-6"><a href="getting-started.html#cb26-6" tabindex="-1"></a>        bal_obj <span class="ot">&lt;-</span> cobalt<span class="sc">::</span><span class="fu">bal.tab</span>(</span>
<span id="cb26-7"><a href="getting-started.html#cb26-7" tabindex="-1"></a>          <span class="fu">as.formula</span>(<span class="fu">paste</span>(treat, <span class="st">&quot;~&quot;</span>, <span class="fu">paste</span>(covar, <span class="at">collapse =</span> <span class="st">&quot; + &quot;</span>))),</span>
<span id="cb26-8"><a href="getting-started.html#cb26-8" tabindex="-1"></a>          <span class="at">data =</span> dataset,</span>
<span id="cb26-9"><a href="getting-started.html#cb26-9" tabindex="-1"></a>          <span class="at">weights =</span> dataset[[wcol]],</span>
<span id="cb26-10"><a href="getting-started.html#cb26-10" tabindex="-1"></a>          <span class="at">un =</span> <span class="cn">TRUE</span>,</span>
<span id="cb26-11"><a href="getting-started.html#cb26-11" tabindex="-1"></a>          <span class="at">s.d.denom =</span> <span class="st">&quot;treated&quot;</span></span>
<span id="cb26-12"><a href="getting-started.html#cb26-12" tabindex="-1"></a>        )</span>
<span id="cb26-13"><a href="getting-started.html#cb26-13" tabindex="-1"></a>        title_text <span class="ot">&lt;-</span> <span class="cf">if</span> (<span class="sc">!</span><span class="fu">is.null</span>(dataset_name)) {</span>
<span id="cb26-14"><a href="getting-started.html#cb26-14" tabindex="-1"></a>          <span class="fu">paste</span>(dataset_name, <span class="st">&quot;-&quot;</span>, trunc_name, <span class="st">&quot;-&quot;</span>, wcol, <span class="st">&quot;truncation&quot;</span>)</span>
<span id="cb26-15"><a href="getting-started.html#cb26-15" tabindex="-1"></a>        } <span class="cf">else</span> {</span>
<span id="cb26-16"><a href="getting-started.html#cb26-16" tabindex="-1"></a>          <span class="fu">paste</span>(trunc_name, wcol, <span class="st">&quot;truncation&quot;</span>)</span>
<span id="cb26-17"><a href="getting-started.html#cb26-17" tabindex="-1"></a>        }</span>
<span id="cb26-18"><a href="getting-started.html#cb26-18" tabindex="-1"></a>        lp <span class="ot">&lt;-</span> cobalt<span class="sc">::</span><span class="fu">love.plot</span>(</span>
<span id="cb26-19"><a href="getting-started.html#cb26-19" tabindex="-1"></a>          bal_obj,</span>
<span id="cb26-20"><a href="getting-started.html#cb26-20" tabindex="-1"></a>          <span class="at">stats =</span> <span class="st">&quot;mean.diffs&quot;</span>,</span>
<span id="cb26-21"><a href="getting-started.html#cb26-21" tabindex="-1"></a>          <span class="at">abs =</span> <span class="cn">TRUE</span>,</span>
<span id="cb26-22"><a href="getting-started.html#cb26-22" tabindex="-1"></a>          <span class="at">var.order =</span> <span class="st">&quot;unadjusted&quot;</span>,</span>
<span id="cb26-23"><a href="getting-started.html#cb26-23" tabindex="-1"></a>          <span class="at">thresholds =</span> <span class="fu">c</span>(<span class="at">m =</span> <span class="fl">0.1</span>),</span>
<span id="cb26-24"><a href="getting-started.html#cb26-24" tabindex="-1"></a>          <span class="at">stars =</span> <span class="st">&quot;none&quot;</span>,</span>
<span id="cb26-25"><a href="getting-started.html#cb26-25" tabindex="-1"></a>          <span class="at">title =</span> title_text</span>
<span id="cb26-26"><a href="getting-started.html#cb26-26" tabindex="-1"></a>        )</span>
<span id="cb26-27"><a href="getting-started.html#cb26-27" tabindex="-1"></a>        <span class="fu">print</span>(lp)</span>
<span id="cb26-28"><a href="getting-started.html#cb26-28" tabindex="-1"></a>      }</span>
<span id="cb26-29"><a href="getting-started.html#cb26-29" tabindex="-1"></a>    }</span>
<span id="cb26-30"><a href="getting-started.html#cb26-30" tabindex="-1"></a>  }</span>
<span id="cb26-31"><a href="getting-started.html#cb26-31" tabindex="-1"></a>}</span></code></pre></div>
<p><strong>Arguments</strong></p>
<ul>
<li><code>trunc_list</code>: A list of truncated weight datasets.</li>
<li><code>treat</code>: The name of the binary treatment indicator variable.</li>
<li><code>covar</code>: A vector of covariate names.</li>
<li><code>weight_cols</code>: The name of the columns holding the weights.</li>
<li><code>dataset_name</code>: The dataset name for plot titles.</li>
</ul>
</div>
<div id="trimming-1" class="section level4 hasAnchor" number="1.2.4.4">
<h4><span class="header-section-number">1.2.4.4</span> Trimming<a href="getting-started.html#trimming-1" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p><code>compute_abs_smd_trim()</code> computes absolute SMDs for multiple trimmed datasets.</p>
<div class="sourceCode" id="cb27"><pre class="sourceCode r fold-hide"><code class="sourceCode r"><span id="cb27-1"><a href="getting-started.html#cb27-1" tabindex="-1"></a>compute_abs_smd_trim <span class="ot">&lt;-</span> <span class="cf">function</span>(trimming_list, treat, covar) {</span>
<span id="cb27-2"><a href="getting-started.html#cb27-2" tabindex="-1"></a>  smd_list <span class="ot">&lt;-</span> <span class="fu">lapply</span>(<span class="fu">names</span>(trimming_list), <span class="cf">function</span>(name) {</span>
<span id="cb27-3"><a href="getting-started.html#cb27-3" tabindex="-1"></a>    data <span class="ot">&lt;-</span> trimming_list[[name]]</span>
<span id="cb27-4"><a href="getting-started.html#cb27-4" tabindex="-1"></a>    bal_obj <span class="ot">&lt;-</span> cobalt<span class="sc">::</span><span class="fu">bal.tab</span>(</span>
<span id="cb27-5"><a href="getting-started.html#cb27-5" tabindex="-1"></a>      <span class="fu">as.formula</span>(<span class="fu">paste</span>(treat, <span class="st">&quot;~&quot;</span>, <span class="fu">paste</span>(covar, <span class="at">collapse =</span> <span class="st">&quot; + &quot;</span>))),</span>
<span id="cb27-6"><a href="getting-started.html#cb27-6" tabindex="-1"></a>      <span class="at">data =</span> data,</span>
<span id="cb27-7"><a href="getting-started.html#cb27-7" tabindex="-1"></a>      <span class="at">un =</span> <span class="cn">TRUE</span>, </span>
<span id="cb27-8"><a href="getting-started.html#cb27-8" tabindex="-1"></a>      <span class="at">s.d.denom =</span> <span class="st">&quot;treated&quot;</span></span>
<span id="cb27-9"><a href="getting-started.html#cb27-9" tabindex="-1"></a>    )</span>
<span id="cb27-10"><a href="getting-started.html#cb27-10" tabindex="-1"></a>    smd_df <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(bal_obj<span class="sc">$</span>Balance)</span>
<span id="cb27-11"><a href="getting-started.html#cb27-11" tabindex="-1"></a>    smd_vals <span class="ot">&lt;-</span> <span class="fu">abs</span>(smd_df<span class="sc">$</span>Diff.Un)</span>
<span id="cb27-12"><a href="getting-started.html#cb27-12" tabindex="-1"></a>    mean_smd <span class="ot">&lt;-</span> <span class="fu">mean</span>(smd_vals, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb27-13"><a href="getting-started.html#cb27-13" tabindex="-1"></a>    max_smd  <span class="ot">&lt;-</span> <span class="fu">max</span>(smd_vals, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb27-14"><a href="getting-started.html#cb27-14" tabindex="-1"></a>    <span class="fu">return</span>(<span class="fu">data.frame</span>(</span>
<span id="cb27-15"><a href="getting-started.html#cb27-15" tabindex="-1"></a>      <span class="at">Method   =</span> name,</span>
<span id="cb27-16"><a href="getting-started.html#cb27-16" tabindex="-1"></a>      <span class="at">Mean_Abs_SMD =</span> mean_smd,</span>
<span id="cb27-17"><a href="getting-started.html#cb27-17" tabindex="-1"></a>      <span class="at">Max_Abs_SMD  =</span> max_smd </span>
<span id="cb27-18"><a href="getting-started.html#cb27-18" tabindex="-1"></a>    ))</span>
<span id="cb27-19"><a href="getting-started.html#cb27-19" tabindex="-1"></a>  })</span>
<span id="cb27-20"><a href="getting-started.html#cb27-20" tabindex="-1"></a>  smd_summary <span class="ot">&lt;-</span> <span class="fu">do.call</span>(rbind, smd_list)</span>
<span id="cb27-21"><a href="getting-started.html#cb27-21" tabindex="-1"></a>  <span class="fu">rownames</span>(smd_summary) <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb27-22"><a href="getting-started.html#cb27-22" tabindex="-1"></a>  <span class="fu">return</span>(smd_summary)</span>
<span id="cb27-23"><a href="getting-started.html#cb27-23" tabindex="-1"></a>}</span></code></pre></div>
<p><strong>Arguments</strong></p>
<ul>
<li><code>trimming_list</code>: A named list of trimmed datasets.</li>
<li><code>treat</code>: The name of the binary treatment indicator variable.</li>
<li><code>covar</code>: A vector of covariate names.</li>
</ul>
<p><code>compute_ess_trim()</code> extracts ESS information for multiple trimmed datasets.</p>
<div class="sourceCode" id="cb28"><pre class="sourceCode r fold-hide"><code class="sourceCode r"><span id="cb28-1"><a href="getting-started.html#cb28-1" tabindex="-1"></a>compute_ess_trim <span class="ot">&lt;-</span> <span class="cf">function</span>(trimming_list, treat, covar) {</span>
<span id="cb28-2"><a href="getting-started.html#cb28-2" tabindex="-1"></a>  ess_list <span class="ot">&lt;-</span> <span class="fu">lapply</span>(trimming_list, <span class="cf">function</span>(data) {</span>
<span id="cb28-3"><a href="getting-started.html#cb28-3" tabindex="-1"></a>    bal_obj <span class="ot">&lt;-</span> cobalt<span class="sc">::</span><span class="fu">bal.tab</span>(<span class="fu">as.formula</span>(<span class="fu">paste</span>(treat, <span class="st">&quot;~&quot;</span>, <span class="fu">paste</span>(covar, <span class="at">collapse =</span> <span class="st">&quot; + &quot;</span>))),</span>
<span id="cb28-4"><a href="getting-started.html#cb28-4" tabindex="-1"></a>                               <span class="at">data =</span> data, <span class="at">un =</span> <span class="cn">TRUE</span>)</span>
<span id="cb28-5"><a href="getting-started.html#cb28-5" tabindex="-1"></a>    samples <span class="ot">&lt;-</span> bal_obj<span class="sc">$</span>Observations</span>
<span id="cb28-6"><a href="getting-started.html#cb28-6" tabindex="-1"></a>    df <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(samples)[<span class="fu">c</span>(<span class="st">&quot;Control&quot;</span>, <span class="st">&quot;Treated&quot;</span>)]</span>
<span id="cb28-7"><a href="getting-started.html#cb28-7" tabindex="-1"></a>    <span class="fu">return</span>(df)</span>
<span id="cb28-8"><a href="getting-started.html#cb28-8" tabindex="-1"></a>  })</span>
<span id="cb28-9"><a href="getting-started.html#cb28-9" tabindex="-1"></a>  ess_df <span class="ot">&lt;-</span> <span class="fu">do.call</span>(rbind, ess_list)</span>
<span id="cb28-10"><a href="getting-started.html#cb28-10" tabindex="-1"></a>  ess_df<span class="sc">$</span>Method <span class="ot">&lt;-</span> <span class="fu">names</span>(trimming_list)</span>
<span id="cb28-11"><a href="getting-started.html#cb28-11" tabindex="-1"></a>  <span class="fu">rownames</span>(ess_df) <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb28-12"><a href="getting-started.html#cb28-12" tabindex="-1"></a>  ess_df <span class="ot">&lt;-</span> ess_df[, <span class="fu">c</span>(<span class="st">&quot;Method&quot;</span>, <span class="st">&quot;Control&quot;</span>, <span class="st">&quot;Treated&quot;</span>)]</span>
<span id="cb28-13"><a href="getting-started.html#cb28-13" tabindex="-1"></a>  <span class="fu">return</span>(ess_df)</span>
<span id="cb28-14"><a href="getting-started.html#cb28-14" tabindex="-1"></a>}</span></code></pre></div>
<p><strong>Arguments</strong></p>
<ul>
<li><code>trimming_list</code>: A named list of trimmed datasets.</li>
<li><code>treat</code>: The name of the binary treatment indicator variable.</li>
<li><code>covar</code>: A vector of covariate names.</li>
</ul>
<p><code>plot_trim()</code> plots overlap diagnostics for a set of trimmed datasets, visualizing covariate balance before and after matching.</p>
<div class="sourceCode" id="cb29"><pre class="sourceCode r fold-hide"><code class="sourceCode r"><span id="cb29-1"><a href="getting-started.html#cb29-1" tabindex="-1"></a>plot_trim <span class="ot">&lt;-</span> <span class="cf">function</span>(data_list, treat, covar) {</span>
<span id="cb29-2"><a href="getting-started.html#cb29-2" tabindex="-1"></a>  <span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">3</span>))</span>
<span id="cb29-3"><a href="getting-started.html#cb29-3" tabindex="-1"></a>  <span class="cf">for</span> (data_obj <span class="cf">in</span> data_list) {</span>
<span id="cb29-4"><a href="getting-started.html#cb29-4" tabindex="-1"></a>    <span class="fu">assess_overlap</span>(data_obj, <span class="at">treat =</span> treat, <span class="at">cov =</span> covar)</span>
<span id="cb29-5"><a href="getting-started.html#cb29-5" tabindex="-1"></a>  }</span>
<span id="cb29-6"><a href="getting-started.html#cb29-6" tabindex="-1"></a>}</span></code></pre></div>
<p><strong>Arguments</strong></p>
<ul>
<li><code>data_list</code>: A list of datasets to plot.</li>
<li><code>treat</code>: The name of the binary treatment indicator variable.</li>
<li><code>covar</code>: A vector of covariate names.</li>
</ul>
</div>
<div id="combined-methods-1" class="section level4 hasAnchor" number="1.2.4.5">
<h4><span class="header-section-number">1.2.4.5</span> Combined methods<a href="getting-started.html#combined-methods-1" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p><code>compute_smd_all_datasets ()</code> aggregates absolute SMD statistics across multiple datasets, weighting methods, and trimming techniques.</p>
<div class="sourceCode" id="cb30"><pre class="sourceCode r fold-hide"><code class="sourceCode r"><span id="cb30-1"><a href="getting-started.html#cb30-1" tabindex="-1"></a>compute_smd_all_datasets <span class="ot">&lt;-</span> <span class="cf">function</span>(combined_list, treat, covar) {</span>
<span id="cb30-2"><a href="getting-started.html#cb30-2" tabindex="-1"></a>  smd_list <span class="ot">&lt;-</span> <span class="fu">lapply</span>(<span class="fu">names</span>(combined_list), <span class="cf">function</span>(weight_method) {</span>
<span id="cb30-3"><a href="getting-started.html#cb30-3" tabindex="-1"></a>    method_list <span class="ot">&lt;-</span> combined_list[[weight_method]]</span>
<span id="cb30-4"><a href="getting-started.html#cb30-4" tabindex="-1"></a>    res <span class="ot">&lt;-</span> <span class="fu">lapply</span>(<span class="fu">names</span>(method_list), <span class="cf">function</span>(trim_method) {</span>
<span id="cb30-5"><a href="getting-started.html#cb30-5" tabindex="-1"></a>      data <span class="ot">&lt;-</span> method_list[[trim_method]]</span>
<span id="cb30-6"><a href="getting-started.html#cb30-6" tabindex="-1"></a>      <span class="co"># Use equal weights if weight column missing</span></span>
<span id="cb30-7"><a href="getting-started.html#cb30-7" tabindex="-1"></a>      <span class="cf">if</span> (<span class="sc">!</span><span class="st">&quot;weight&quot;</span> <span class="sc">%in%</span> <span class="fu">colnames</span>(data)) {</span>
<span id="cb30-8"><a href="getting-started.html#cb30-8" tabindex="-1"></a>        data<span class="sc">$</span>weight <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="dv">1</span>, <span class="fu">nrow</span>(data))</span>
<span id="cb30-9"><a href="getting-started.html#cb30-9" tabindex="-1"></a>      }</span>
<span id="cb30-10"><a href="getting-started.html#cb30-10" tabindex="-1"></a>      bal_obj <span class="ot">&lt;-</span> cobalt<span class="sc">::</span><span class="fu">bal.tab</span>(</span>
<span id="cb30-11"><a href="getting-started.html#cb30-11" tabindex="-1"></a>        <span class="fu">as.formula</span>(<span class="fu">paste</span>(treat, <span class="st">&quot;~&quot;</span>, <span class="fu">paste</span>(covar, <span class="at">collapse =</span> <span class="st">&quot; + &quot;</span>))),</span>
<span id="cb30-12"><a href="getting-started.html#cb30-12" tabindex="-1"></a>        <span class="at">data =</span> data,</span>
<span id="cb30-13"><a href="getting-started.html#cb30-13" tabindex="-1"></a>        <span class="at">weights =</span> data<span class="sc">$</span>weight,</span>
<span id="cb30-14"><a href="getting-started.html#cb30-14" tabindex="-1"></a>        <span class="at">un =</span> <span class="cn">TRUE</span>,</span>
<span id="cb30-15"><a href="getting-started.html#cb30-15" tabindex="-1"></a>        <span class="at">s.d.denom =</span> <span class="st">&quot;treated&quot;</span></span>
<span id="cb30-16"><a href="getting-started.html#cb30-16" tabindex="-1"></a>      )</span>
<span id="cb30-17"><a href="getting-started.html#cb30-17" tabindex="-1"></a>      smd_df <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(bal_obj<span class="sc">$</span>Balance)</span>
<span id="cb30-18"><a href="getting-started.html#cb30-18" tabindex="-1"></a>      smd_vals <span class="ot">&lt;-</span> <span class="fu">abs</span>(smd_df<span class="sc">$</span>Diff.Adj)</span>
<span id="cb30-19"><a href="getting-started.html#cb30-19" tabindex="-1"></a>      method_name <span class="ot">&lt;-</span> <span class="fu">paste</span>(weight_method, trim_method, <span class="at">sep =</span> <span class="st">&quot;_&quot;</span>)</span>
<span id="cb30-20"><a href="getting-started.html#cb30-20" tabindex="-1"></a>      <span class="fu">data.frame</span>(</span>
<span id="cb30-21"><a href="getting-started.html#cb30-21" tabindex="-1"></a>        <span class="at">Method =</span> method_name,</span>
<span id="cb30-22"><a href="getting-started.html#cb30-22" tabindex="-1"></a>        <span class="at">Mean_Abs_SMD =</span> <span class="fu">mean</span>(smd_vals, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb30-23"><a href="getting-started.html#cb30-23" tabindex="-1"></a>        <span class="at">Max_Abs_SMD =</span> <span class="fu">max</span>(smd_vals, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb30-24"><a href="getting-started.html#cb30-24" tabindex="-1"></a>      )</span>
<span id="cb30-25"><a href="getting-started.html#cb30-25" tabindex="-1"></a>    })</span>
<span id="cb30-26"><a href="getting-started.html#cb30-26" tabindex="-1"></a>    <span class="fu">do.call</span>(rbind, res)</span>
<span id="cb30-27"><a href="getting-started.html#cb30-27" tabindex="-1"></a>  })</span>
<span id="cb30-28"><a href="getting-started.html#cb30-28" tabindex="-1"></a>  smd_summary <span class="ot">&lt;-</span> <span class="fu">do.call</span>(rbind, smd_list)</span>
<span id="cb30-29"><a href="getting-started.html#cb30-29" tabindex="-1"></a>  <span class="fu">rownames</span>(smd_summary) <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb30-30"><a href="getting-started.html#cb30-30" tabindex="-1"></a>  <span class="fu">return</span>(smd_summary)</span>
<span id="cb30-31"><a href="getting-started.html#cb30-31" tabindex="-1"></a>}</span></code></pre></div>
<p><strong>Arguments</strong></p>
<ul>
<li><code>combined_list</code>: A nested list of datasets grouped by weighting and trimming methods.</li>
<li><code>treat</code>: The name of the binary treatment indicator variable.</li>
<li><code>covar</code>: A vector of covariate names.</li>
</ul>
<p><code>compute_ess_all_datasets()</code> aggregates ESS information across various datasets, weighting methods, and trimming techniques.</p>
<div class="sourceCode" id="cb31"><pre class="sourceCode r fold-hide"><code class="sourceCode r"><span id="cb31-1"><a href="getting-started.html#cb31-1" tabindex="-1"></a>compute_ess_all_datasets <span class="ot">&lt;-</span> <span class="cf">function</span>(combined_list, treat, covar) {</span>
<span id="cb31-2"><a href="getting-started.html#cb31-2" tabindex="-1"></a>  ess_list <span class="ot">&lt;-</span> <span class="fu">lapply</span>(<span class="fu">names</span>(combined_list), <span class="cf">function</span>(weight_method) {</span>
<span id="cb31-3"><a href="getting-started.html#cb31-3" tabindex="-1"></a>    method_list <span class="ot">&lt;-</span> combined_list[[weight_method]]</span>
<span id="cb31-4"><a href="getting-started.html#cb31-4" tabindex="-1"></a>    res <span class="ot">&lt;-</span> <span class="fu">lapply</span>(<span class="fu">names</span>(method_list), <span class="cf">function</span>(trim_method) {</span>
<span id="cb31-5"><a href="getting-started.html#cb31-5" tabindex="-1"></a>      data <span class="ot">&lt;-</span> method_list[[trim_method]]</span>
<span id="cb31-6"><a href="getting-started.html#cb31-6" tabindex="-1"></a>      <span class="co"># Use equal weights if weight column missing</span></span>
<span id="cb31-7"><a href="getting-started.html#cb31-7" tabindex="-1"></a>      <span class="cf">if</span> (<span class="sc">!</span><span class="st">&quot;weight&quot;</span> <span class="sc">%in%</span> <span class="fu">colnames</span>(data)) {</span>
<span id="cb31-8"><a href="getting-started.html#cb31-8" tabindex="-1"></a>        data<span class="sc">$</span>weight <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="dv">1</span>, <span class="fu">nrow</span>(data))</span>
<span id="cb31-9"><a href="getting-started.html#cb31-9" tabindex="-1"></a>      }</span>
<span id="cb31-10"><a href="getting-started.html#cb31-10" tabindex="-1"></a>      bal_obj <span class="ot">&lt;-</span> cobalt<span class="sc">::</span><span class="fu">bal.tab</span>(</span>
<span id="cb31-11"><a href="getting-started.html#cb31-11" tabindex="-1"></a>        <span class="fu">as.formula</span>(<span class="fu">paste</span>(treat, <span class="st">&quot;~&quot;</span>, <span class="fu">paste</span>(covar, <span class="at">collapse =</span> <span class="st">&quot; + &quot;</span>))),</span>
<span id="cb31-12"><a href="getting-started.html#cb31-12" tabindex="-1"></a>        <span class="at">data =</span> data,</span>
<span id="cb31-13"><a href="getting-started.html#cb31-13" tabindex="-1"></a>        <span class="at">weights =</span> data<span class="sc">$</span>weight,</span>
<span id="cb31-14"><a href="getting-started.html#cb31-14" tabindex="-1"></a>        <span class="at">un =</span> <span class="cn">TRUE</span>,</span>
<span id="cb31-15"><a href="getting-started.html#cb31-15" tabindex="-1"></a>        <span class="at">s.d.denom =</span> <span class="st">&quot;treated&quot;</span></span>
<span id="cb31-16"><a href="getting-started.html#cb31-16" tabindex="-1"></a>      )</span>
<span id="cb31-17"><a href="getting-started.html#cb31-17" tabindex="-1"></a>      samples <span class="ot">&lt;-</span> bal_obj<span class="sc">$</span>Observations</span>
<span id="cb31-18"><a href="getting-started.html#cb31-18" tabindex="-1"></a>      <span class="cf">if</span> (<span class="st">&quot;Adjusted&quot;</span> <span class="sc">%in%</span> <span class="fu">rownames</span>(samples)) {</span>
<span id="cb31-19"><a href="getting-started.html#cb31-19" tabindex="-1"></a>        control_ess <span class="ot">&lt;-</span> samples[<span class="st">&quot;Adjusted&quot;</span>, <span class="st">&quot;Control&quot;</span>]</span>
<span id="cb31-20"><a href="getting-started.html#cb31-20" tabindex="-1"></a>        treated_ess <span class="ot">&lt;-</span> samples[<span class="st">&quot;Adjusted&quot;</span>, <span class="st">&quot;Treated&quot;</span>]</span>
<span id="cb31-21"><a href="getting-started.html#cb31-21" tabindex="-1"></a>      } <span class="cf">else</span> {</span>
<span id="cb31-22"><a href="getting-started.html#cb31-22" tabindex="-1"></a>        control_ess <span class="ot">&lt;-</span> samples[<span class="dv">1</span>, <span class="st">&quot;Control&quot;</span>]</span>
<span id="cb31-23"><a href="getting-started.html#cb31-23" tabindex="-1"></a>        treated_ess <span class="ot">&lt;-</span> samples[<span class="dv">1</span>, <span class="st">&quot;Treated&quot;</span>]</span>
<span id="cb31-24"><a href="getting-started.html#cb31-24" tabindex="-1"></a>      }</span>
<span id="cb31-25"><a href="getting-started.html#cb31-25" tabindex="-1"></a>      method_name <span class="ot">&lt;-</span> <span class="fu">paste</span>(weight_method, trim_method, <span class="at">sep =</span> <span class="st">&quot;_&quot;</span>)</span>
<span id="cb31-26"><a href="getting-started.html#cb31-26" tabindex="-1"></a>      <span class="fu">data.frame</span>(</span>
<span id="cb31-27"><a href="getting-started.html#cb31-27" tabindex="-1"></a>        <span class="at">Method =</span> method_name,</span>
<span id="cb31-28"><a href="getting-started.html#cb31-28" tabindex="-1"></a>        <span class="at">Control =</span> control_ess,</span>
<span id="cb31-29"><a href="getting-started.html#cb31-29" tabindex="-1"></a>        <span class="at">Treated =</span> treated_ess</span>
<span id="cb31-30"><a href="getting-started.html#cb31-30" tabindex="-1"></a>      )</span>
<span id="cb31-31"><a href="getting-started.html#cb31-31" tabindex="-1"></a>    })</span>
<span id="cb31-32"><a href="getting-started.html#cb31-32" tabindex="-1"></a>    <span class="fu">do.call</span>(rbind, res)</span>
<span id="cb31-33"><a href="getting-started.html#cb31-33" tabindex="-1"></a>  })</span>
<span id="cb31-34"><a href="getting-started.html#cb31-34" tabindex="-1"></a>  ess_summary <span class="ot">&lt;-</span> <span class="fu">do.call</span>(rbind, ess_list)</span>
<span id="cb31-35"><a href="getting-started.html#cb31-35" tabindex="-1"></a>  <span class="fu">rownames</span>(ess_summary) <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb31-36"><a href="getting-started.html#cb31-36" tabindex="-1"></a>  <span class="fu">return</span>(ess_summary)</span>
<span id="cb31-37"><a href="getting-started.html#cb31-37" tabindex="-1"></a>}</span></code></pre></div>
<p><strong>Arguments</strong></p>
<ul>
<li><code>combined_list</code>: A nested list of datasets grouped by weighting and trimming methods.</li>
<li><code>treat</code>: The name of the binary treatment indicator variable.</li>
<li><code>covar</code>: A vector of covariate names.</li>
</ul>
<p><code>plot_comb_overlap()</code> creates plots assessing overlap for combinations of weighting and trimming methods across datasets.</p>
<div class="sourceCode" id="cb32"><pre class="sourceCode r fold-hide"><code class="sourceCode r"><span id="cb32-1"><a href="getting-started.html#cb32-1" tabindex="-1"></a>plot_comb_overlap <span class="ot">&lt;-</span> <span class="cf">function</span>(<span class="at">comb_meth_cps =</span> <span class="cn">NULL</span>, <span class="at">comb_meth_psid =</span> <span class="cn">NULL</span>, treat, covar,</span>
<span id="cb32-2"><a href="getting-started.html#cb32-2" tabindex="-1"></a>                              <span class="at">prefix_cps =</span> <span class="st">&quot;LDW-CPS1&quot;</span>, <span class="at">prefix_psid =</span> <span class="st">&quot;LDW-PSID1&quot;</span>) {</span>
<span id="cb32-3"><a href="getting-started.html#cb32-3" tabindex="-1"></a>  all_combined_list <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb32-4"><a href="getting-started.html#cb32-4" tabindex="-1"></a>  <span class="cf">if</span> (<span class="sc">!</span><span class="fu">is.null</span>(comb_meth_cps)) all_combined_list<span class="sc">$</span>CPS <span class="ot">&lt;-</span> comb_meth_cps</span>
<span id="cb32-5"><a href="getting-started.html#cb32-5" tabindex="-1"></a>  <span class="cf">if</span> (<span class="sc">!</span><span class="fu">is.null</span>(comb_meth_psid)) all_combined_list<span class="sc">$</span>PSID <span class="ot">&lt;-</span> comb_meth_psid</span>
<span id="cb32-6"><a href="getting-started.html#cb32-6" tabindex="-1"></a>  <span class="cf">for</span> (ds_name <span class="cf">in</span> <span class="fu">names</span>(all_combined_list)) {</span>
<span id="cb32-7"><a href="getting-started.html#cb32-7" tabindex="-1"></a>    combined_list <span class="ot">&lt;-</span> all_combined_list[[ds_name]]</span>
<span id="cb32-8"><a href="getting-started.html#cb32-8" tabindex="-1"></a>    plot_list <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb32-9"><a href="getting-started.html#cb32-9" tabindex="-1"></a>    method_names <span class="ot">&lt;-</span> <span class="fu">character</span>()</span>
<span id="cb32-10"><a href="getting-started.html#cb32-10" tabindex="-1"></a>    <span class="cf">for</span> (weight_method <span class="cf">in</span> <span class="fu">names</span>(combined_list)) {</span>
<span id="cb32-11"><a href="getting-started.html#cb32-11" tabindex="-1"></a>      <span class="cf">for</span> (trim_method <span class="cf">in</span> <span class="fu">names</span>(combined_list[[weight_method]])) {</span>
<span id="cb32-12"><a href="getting-started.html#cb32-12" tabindex="-1"></a>        full_method_name <span class="ot">&lt;-</span> <span class="fu">paste</span>(weight_method, trim_method, <span class="at">sep =</span> <span class="st">&quot;_&quot;</span>)</span>
<span id="cb32-13"><a href="getting-started.html#cb32-13" tabindex="-1"></a>        plot_list[[full_method_name]] <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb32-14"><a href="getting-started.html#cb32-14" tabindex="-1"></a>          <span class="at">data =</span> combined_list[[weight_method]][[trim_method]],</span>
<span id="cb32-15"><a href="getting-started.html#cb32-15" tabindex="-1"></a>          <span class="at">method_name =</span> full_method_name</span>
<span id="cb32-16"><a href="getting-started.html#cb32-16" tabindex="-1"></a>        )</span>
<span id="cb32-17"><a href="getting-started.html#cb32-17" tabindex="-1"></a>        method_names <span class="ot">&lt;-</span> <span class="fu">c</span>(method_names, full_method_name)</span>
<span id="cb32-18"><a href="getting-started.html#cb32-18" tabindex="-1"></a>      }</span>
<span id="cb32-19"><a href="getting-started.html#cb32-19" tabindex="-1"></a>    }</span>
<span id="cb32-20"><a href="getting-started.html#cb32-20" tabindex="-1"></a>    total_plots <span class="ot">&lt;-</span> <span class="fu">length</span>(plot_list)</span>
<span id="cb32-21"><a href="getting-started.html#cb32-21" tabindex="-1"></a>    plots_per_page <span class="ot">&lt;-</span> <span class="dv">4</span>  <span class="co"># 2x2 layout</span></span>
<span id="cb32-22"><a href="getting-started.html#cb32-22" tabindex="-1"></a>    <span class="cf">for</span> (i <span class="cf">in</span> <span class="fu">seq</span>(<span class="dv">1</span>, total_plots, <span class="at">by =</span> plots_per_page)) {</span>
<span id="cb32-23"><a href="getting-started.html#cb32-23" tabindex="-1"></a>      page_plots <span class="ot">&lt;-</span> plot_list[i<span class="sc">:</span><span class="fu">min</span>(i <span class="sc">+</span> plots_per_page <span class="sc">-</span> <span class="dv">1</span>, total_plots)]</span>
<span id="cb32-24"><a href="getting-started.html#cb32-24" tabindex="-1"></a>      <span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">2</span>), <span class="at">mar =</span> <span class="fu">c</span>(<span class="dv">4</span>, <span class="dv">4</span>, <span class="dv">2</span>, <span class="dv">1</span>))</span>
<span id="cb32-25"><a href="getting-started.html#cb32-25" tabindex="-1"></a>      <span class="cf">for</span> (p <span class="cf">in</span> page_plots) {</span>
<span id="cb32-26"><a href="getting-started.html#cb32-26" tabindex="-1"></a>        <span class="fu">assess_overlap</span>(p<span class="sc">$</span>data, <span class="at">treat =</span> treat, <span class="at">cov =</span> covar)</span>
<span id="cb32-27"><a href="getting-started.html#cb32-27" tabindex="-1"></a>        idx <span class="ot">&lt;-</span> <span class="fu">match</span>(p<span class="sc">$</span>method_name, method_names)</span>
<span id="cb32-28"><a href="getting-started.html#cb32-28" tabindex="-1"></a>        prefix <span class="ot">&lt;-</span> <span class="cf">if</span> (ds_name <span class="sc">==</span> <span class="st">&quot;CPS&quot;</span> <span class="sc">&amp;&amp;</span> idx <span class="sc">&lt;=</span> <span class="dv">25</span>) prefix_cps <span class="cf">else</span></span>
<span id="cb32-29"><a href="getting-started.html#cb32-29" tabindex="-1"></a>          <span class="cf">if</span> (ds_name <span class="sc">==</span> <span class="st">&quot;PSID&quot;</span> <span class="sc">&amp;&amp;</span> idx <span class="sc">&lt;=</span> <span class="dv">25</span>) prefix_psid <span class="cf">else</span> <span class="st">&quot;&quot;</span></span>
<span id="cb32-30"><a href="getting-started.html#cb32-30" tabindex="-1"></a>        </span>
<span id="cb32-31"><a href="getting-started.html#cb32-31" tabindex="-1"></a>        <span class="fu">title</span>(<span class="at">main =</span> <span class="fu">paste0</span>(prefix, <span class="st">&quot; - &quot;</span>, p<span class="sc">$</span>method_name))</span>
<span id="cb32-32"><a href="getting-started.html#cb32-32" tabindex="-1"></a>      }</span>
<span id="cb32-33"><a href="getting-started.html#cb32-33" tabindex="-1"></a>    }</span>
<span id="cb32-34"><a href="getting-started.html#cb32-34" tabindex="-1"></a>  }</span>
<span id="cb32-35"><a href="getting-started.html#cb32-35" tabindex="-1"></a>}</span></code></pre></div>
<p><strong>Arguments</strong></p>
<ul>
<li><code>comb_meth_cps</code>: A named list combining weighting and trimming results for CPS dataset.</li>
<li><code>comb_meth_psid</code>: A named list combining weighting and trimming results for PSID dataset.</li>
<li><code>treat</code>: The name of the binary treatment indicator variable.</li>
<li><code>covar</code>: A vector of covariate names.</li>
<li><code>prefix_cps</code>: Optional string prefix for plot titles related to CPS results.</li>
<li><code>prefix_psid</code>: Optional string prefix for plot titles related to PSID results.</li>
</ul>
<p><code>plot_comb_love_plots()</code> visualizes SMDs via love plots for combined weighting and trimming approaches.</p>
<div class="sourceCode" id="cb33"><pre class="sourceCode r fold-hide"><code class="sourceCode r"><span id="cb33-1"><a href="getting-started.html#cb33-1" tabindex="-1"></a>plot_comb_love_plots <span class="ot">&lt;-</span> <span class="cf">function</span>(<span class="at">comb_meth_cps =</span> <span class="cn">NULL</span>, <span class="at">comb_meth_psid =</span> <span class="cn">NULL</span>, treat, covar,</span>
<span id="cb33-2"><a href="getting-started.html#cb33-2" tabindex="-1"></a>                                 <span class="at">prefix_cps =</span> <span class="st">&quot;LDW-CPS1&quot;</span>, <span class="at">prefix_psid =</span> <span class="st">&quot;LDW-PSID1&quot;</span>) {</span>
<span id="cb33-3"><a href="getting-started.html#cb33-3" tabindex="-1"></a>  all_datasets <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb33-4"><a href="getting-started.html#cb33-4" tabindex="-1"></a>  <span class="cf">if</span> (<span class="sc">!</span><span class="fu">is.null</span>(comb_meth_cps)) all_datasets<span class="sc">$</span>CPS <span class="ot">&lt;-</span> comb_meth_cps</span>
<span id="cb33-5"><a href="getting-started.html#cb33-5" tabindex="-1"></a>  <span class="cf">if</span> (<span class="sc">!</span><span class="fu">is.null</span>(comb_meth_psid)) all_datasets<span class="sc">$</span>PSID <span class="ot">&lt;-</span> comb_meth_psid</span>
<span id="cb33-6"><a href="getting-started.html#cb33-6" tabindex="-1"></a>  <span class="cf">for</span> (ds_name <span class="cf">in</span> <span class="fu">names</span>(all_datasets)) {</span>
<span id="cb33-7"><a href="getting-started.html#cb33-7" tabindex="-1"></a>    method_list <span class="ot">&lt;-</span> all_datasets[[ds_name]]</span>
<span id="cb33-8"><a href="getting-started.html#cb33-8" tabindex="-1"></a>    method_names <span class="ot">&lt;-</span> <span class="fu">unlist</span>(<span class="fu">lapply</span>(<span class="fu">names</span>(method_list), <span class="cf">function</span>(weighting) {</span>
<span id="cb33-9"><a href="getting-started.html#cb33-9" tabindex="-1"></a>      trimmed_list <span class="ot">&lt;-</span> method_list[[weighting]]</span>
<span id="cb33-10"><a href="getting-started.html#cb33-10" tabindex="-1"></a>      <span class="fu">sapply</span>(<span class="fu">names</span>(trimmed_list), <span class="cf">function</span>(trim) <span class="fu">paste</span>(weighting, trim, <span class="at">sep =</span> <span class="st">&quot;_&quot;</span>))</span>
<span id="cb33-11"><a href="getting-started.html#cb33-11" tabindex="-1"></a>    }))</span>
<span id="cb33-12"><a href="getting-started.html#cb33-12" tabindex="-1"></a>    plot_counter <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb33-13"><a href="getting-started.html#cb33-13" tabindex="-1"></a>    <span class="cf">for</span> (weighting <span class="cf">in</span> <span class="fu">names</span>(method_list)) {</span>
<span id="cb33-14"><a href="getting-started.html#cb33-14" tabindex="-1"></a>      trimmed_list <span class="ot">&lt;-</span> method_list[[weighting]]</span>
<span id="cb33-15"><a href="getting-started.html#cb33-15" tabindex="-1"></a>      <span class="cf">for</span> (trim <span class="cf">in</span> <span class="fu">names</span>(trimmed_list)) {</span>
<span id="cb33-16"><a href="getting-started.html#cb33-16" tabindex="-1"></a>        df <span class="ot">&lt;-</span> trimmed_list[[trim]]</span>
<span id="cb33-17"><a href="getting-started.html#cb33-17" tabindex="-1"></a>        plot_counter <span class="ot">&lt;-</span> plot_counter <span class="sc">+</span> <span class="dv">1</span></span>
<span id="cb33-18"><a href="getting-started.html#cb33-18" tabindex="-1"></a>        <span class="cf">if</span> (<span class="sc">!</span><span class="st">&quot;weight&quot;</span> <span class="sc">%in%</span> <span class="fu">names</span>(df)) df<span class="sc">$</span>weight <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb33-19"><a href="getting-started.html#cb33-19" tabindex="-1"></a>        bal <span class="ot">&lt;-</span> cobalt<span class="sc">::</span><span class="fu">bal.tab</span>(</span>
<span id="cb33-20"><a href="getting-started.html#cb33-20" tabindex="-1"></a>          <span class="fu">as.formula</span>(<span class="fu">paste</span>(treat, <span class="st">&quot;~&quot;</span>, <span class="fu">paste</span>(covar, <span class="at">collapse =</span> <span class="st">&quot; + &quot;</span>))),</span>
<span id="cb33-21"><a href="getting-started.html#cb33-21" tabindex="-1"></a>          <span class="at">data =</span> df,</span>
<span id="cb33-22"><a href="getting-started.html#cb33-22" tabindex="-1"></a>          <span class="at">weights =</span> df<span class="sc">$</span>weight,</span>
<span id="cb33-23"><a href="getting-started.html#cb33-23" tabindex="-1"></a>          <span class="at">un =</span> <span class="cn">TRUE</span>,</span>
<span id="cb33-24"><a href="getting-started.html#cb33-24" tabindex="-1"></a>          <span class="at">s.d.denom =</span> <span class="st">&quot;treated&quot;</span></span>
<span id="cb33-25"><a href="getting-started.html#cb33-25" tabindex="-1"></a>        )</span>
<span id="cb33-26"><a href="getting-started.html#cb33-26" tabindex="-1"></a>        method_name <span class="ot">&lt;-</span> <span class="fu">paste</span>(weighting, trim, <span class="at">sep =</span> <span class="st">&quot;_&quot;</span>)</span>
<span id="cb33-27"><a href="getting-started.html#cb33-27" tabindex="-1"></a>        prefix <span class="ot">&lt;-</span> <span class="st">&quot;&quot;</span></span>
<span id="cb33-28"><a href="getting-started.html#cb33-28" tabindex="-1"></a>        <span class="cf">if</span> (ds_name <span class="sc">==</span> <span class="st">&quot;CPS&quot;</span> <span class="sc">&amp;&amp;</span> plot_counter <span class="sc">&lt;=</span> <span class="dv">25</span>) prefix <span class="ot">&lt;-</span> prefix_cps</span>
<span id="cb33-29"><a href="getting-started.html#cb33-29" tabindex="-1"></a>        <span class="cf">if</span> (ds_name <span class="sc">==</span> <span class="st">&quot;PSID&quot;</span> <span class="sc">&amp;&amp;</span> plot_counter <span class="sc">&lt;=</span> <span class="dv">25</span>) prefix <span class="ot">&lt;-</span> prefix_psid</span>
<span id="cb33-30"><a href="getting-started.html#cb33-30" tabindex="-1"></a>        title_text <span class="ot">&lt;-</span> <span class="fu">paste</span>(prefix, method_name, <span class="at">sep =</span> <span class="st">&quot; - &quot;</span>)</span>
<span id="cb33-31"><a href="getting-started.html#cb33-31" tabindex="-1"></a>        lp <span class="ot">&lt;-</span> cobalt<span class="sc">::</span><span class="fu">love.plot</span>(</span>
<span id="cb33-32"><a href="getting-started.html#cb33-32" tabindex="-1"></a>          bal,</span>
<span id="cb33-33"><a href="getting-started.html#cb33-33" tabindex="-1"></a>          <span class="at">stats =</span> <span class="st">&quot;mean.diffs&quot;</span>,</span>
<span id="cb33-34"><a href="getting-started.html#cb33-34" tabindex="-1"></a>          <span class="at">absolute =</span> <span class="cn">TRUE</span>,</span>
<span id="cb33-35"><a href="getting-started.html#cb33-35" tabindex="-1"></a>          <span class="at">var.order =</span> <span class="st">&quot;unadjusted&quot;</span>,</span>
<span id="cb33-36"><a href="getting-started.html#cb33-36" tabindex="-1"></a>          <span class="at">thresholds =</span> <span class="fu">c</span>(<span class="at">m =</span> .<span class="dv">1</span>),</span>
<span id="cb33-37"><a href="getting-started.html#cb33-37" tabindex="-1"></a>          <span class="at">title =</span> title_text</span>
<span id="cb33-38"><a href="getting-started.html#cb33-38" tabindex="-1"></a>        )</span>
<span id="cb33-39"><a href="getting-started.html#cb33-39" tabindex="-1"></a>        <span class="fu">print</span>(lp)</span>
<span id="cb33-40"><a href="getting-started.html#cb33-40" tabindex="-1"></a>      }</span>
<span id="cb33-41"><a href="getting-started.html#cb33-41" tabindex="-1"></a>    }</span>
<span id="cb33-42"><a href="getting-started.html#cb33-42" tabindex="-1"></a>  }</span>
<span id="cb33-43"><a href="getting-started.html#cb33-43" tabindex="-1"></a>}</span></code></pre></div>
<p><strong>Arguments</strong></p>
<ul>
<li><code>comb_meth_cps</code>: A named list combining weighting and trimming results for CPS dataset.</li>
<li><code>comb_meth_psid</code>: A named list combining weighting and trimming results for PSID dataset.</li>
<li><code>treat</code>: The name of the binary treatment indicator variable.</li>
<li><code>covar</code>: A vector of covariate names.</li>
<li><code>prefix_cps</code>: Optional string prefix for plot titles related to CPS results.</li>
<li><code>prefix_psid</code>: Optional string prefix for plot titles related to PSID results.</li>
</ul>
<p><code>save_comb_hist()</code> saves the histograms into a pdf file.</p>
<div class="sourceCode" id="cb34"><pre class="sourceCode r fold-hide"><code class="sourceCode r"><span id="cb34-1"><a href="getting-started.html#cb34-1" tabindex="-1"></a>save_comb_hist <span class="ot">&lt;-</span> <span class="cf">function</span>(<span class="at">comb_meth_cps =</span> <span class="cn">NULL</span>, <span class="at">comb_meth_psid =</span> <span class="cn">NULL</span>, treat, covar,</span>
<span id="cb34-2"><a href="getting-started.html#cb34-2" tabindex="-1"></a>                           <span class="at">prefix =</span> <span class="st">&quot;model_a&quot;</span>,</span>
<span id="cb34-3"><a href="getting-started.html#cb34-3" tabindex="-1"></a>                           <span class="at">prefix_cps =</span> <span class="st">&quot;LDW-CPS1&quot;</span>, <span class="at">prefix_psid =</span> <span class="st">&quot;LDW-PSID1&quot;</span>,</span>
<span id="cb34-4"><a href="getting-started.html#cb34-4" tabindex="-1"></a>                           <span class="at">path =</span> <span class="st">&quot;graphs/lalonde&quot;</span>) {</span>
<span id="cb34-5"><a href="getting-started.html#cb34-5" tabindex="-1"></a>  <span class="fu">dir.create</span>(path, <span class="at">showWarnings =</span> <span class="cn">FALSE</span>, <span class="at">recursive =</span> <span class="cn">TRUE</span>)</span>
<span id="cb34-6"><a href="getting-started.html#cb34-6" tabindex="-1"></a>  all_combined_list <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb34-7"><a href="getting-started.html#cb34-7" tabindex="-1"></a>  <span class="cf">if</span> (<span class="sc">!</span><span class="fu">is.null</span>(comb_meth_cps)) all_combined_list<span class="sc">$</span>CPS <span class="ot">&lt;-</span> comb_meth_cps</span>
<span id="cb34-8"><a href="getting-started.html#cb34-8" tabindex="-1"></a>  <span class="cf">if</span> (<span class="sc">!</span><span class="fu">is.null</span>(comb_meth_psid)) all_combined_list<span class="sc">$</span>PSID <span class="ot">&lt;-</span> comb_meth_psid</span>
<span id="cb34-9"><a href="getting-started.html#cb34-9" tabindex="-1"></a>  </span>
<span id="cb34-10"><a href="getting-started.html#cb34-10" tabindex="-1"></a>  file_index <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb34-11"><a href="getting-started.html#cb34-11" tabindex="-1"></a>  <span class="cf">for</span> (ds_name <span class="cf">in</span> <span class="fu">names</span>(all_combined_list)) {</span>
<span id="cb34-12"><a href="getting-started.html#cb34-12" tabindex="-1"></a>    combined_list <span class="ot">&lt;-</span> all_combined_list[[ds_name]]</span>
<span id="cb34-13"><a href="getting-started.html#cb34-13" tabindex="-1"></a>    method_names <span class="ot">&lt;-</span> <span class="fu">character</span>()</span>
<span id="cb34-14"><a href="getting-started.html#cb34-14" tabindex="-1"></a>    plot_list <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb34-15"><a href="getting-started.html#cb34-15" tabindex="-1"></a>    <span class="cf">for</span> (weight_method <span class="cf">in</span> <span class="fu">names</span>(combined_list)) {</span>
<span id="cb34-16"><a href="getting-started.html#cb34-16" tabindex="-1"></a>      <span class="cf">for</span> (trim_method <span class="cf">in</span> <span class="fu">names</span>(combined_list[[weight_method]])) {</span>
<span id="cb34-17"><a href="getting-started.html#cb34-17" tabindex="-1"></a>        full_method_name <span class="ot">&lt;-</span> <span class="fu">paste</span>(weight_method, trim_method, <span class="at">sep =</span> <span class="st">&quot;_&quot;</span>)</span>
<span id="cb34-18"><a href="getting-started.html#cb34-18" tabindex="-1"></a>        plot_list[[full_method_name]] <span class="ot">&lt;-</span> combined_list[[weight_method]][[trim_method]]</span>
<span id="cb34-19"><a href="getting-started.html#cb34-19" tabindex="-1"></a>        method_names <span class="ot">&lt;-</span> <span class="fu">c</span>(method_names, full_method_name)</span>
<span id="cb34-20"><a href="getting-started.html#cb34-20" tabindex="-1"></a>      }</span>
<span id="cb34-21"><a href="getting-started.html#cb34-21" tabindex="-1"></a>    }</span>
<span id="cb34-22"><a href="getting-started.html#cb34-22" tabindex="-1"></a>    total_plots <span class="ot">&lt;-</span> <span class="fu">length</span>(plot_list)</span>
<span id="cb34-23"><a href="getting-started.html#cb34-23" tabindex="-1"></a>    <span class="cf">for</span> (i <span class="cf">in</span> <span class="fu">seq_len</span>(total_plots)) {</span>
<span id="cb34-24"><a href="getting-started.html#cb34-24" tabindex="-1"></a>      data <span class="ot">&lt;-</span> plot_list[[i]]</span>
<span id="cb34-25"><a href="getting-started.html#cb34-25" tabindex="-1"></a>      pdf_file <span class="ot">&lt;-</span> <span class="fu">file.path</span>(path, <span class="fu">sprintf</span>(<span class="st">&quot;%s_overlap_%d.pdf&quot;</span>, prefix, file_index))</span>
<span id="cb34-26"><a href="getting-started.html#cb34-26" tabindex="-1"></a>      <span class="fu">pdf</span>(pdf_file, <span class="at">width =</span> <span class="dv">8</span>, <span class="at">height =</span> <span class="dv">6</span>)</span>
<span id="cb34-27"><a href="getting-started.html#cb34-27" tabindex="-1"></a>      <span class="fu">assess_overlap</span>(data, <span class="at">treat =</span> treat, <span class="at">cov =</span> covar)</span>
<span id="cb34-28"><a href="getting-started.html#cb34-28" tabindex="-1"></a>      prefix_str <span class="ot">&lt;-</span> <span class="cf">if</span> (ds_name <span class="sc">==</span> <span class="st">&quot;CPS&quot;</span>) prefix_cps <span class="cf">else</span> prefix_psid</span>
<span id="cb34-29"><a href="getting-started.html#cb34-29" tabindex="-1"></a>      <span class="fu">title</span>(<span class="at">main =</span> <span class="fu">paste0</span>(prefix_str, <span class="st">&quot; - &quot;</span>, method_names[i]))</span>
<span id="cb34-30"><a href="getting-started.html#cb34-30" tabindex="-1"></a>      <span class="fu">dev.off</span>()</span>
<span id="cb34-31"><a href="getting-started.html#cb34-31" tabindex="-1"></a>      file_index <span class="ot">&lt;-</span> file_index <span class="sc">+</span> <span class="dv">1</span></span>
<span id="cb34-32"><a href="getting-started.html#cb34-32" tabindex="-1"></a>    }</span>
<span id="cb34-33"><a href="getting-started.html#cb34-33" tabindex="-1"></a>  }</span>
<span id="cb34-34"><a href="getting-started.html#cb34-34" tabindex="-1"></a>}</span></code></pre></div>
<p><strong>Arguments</strong></p>
<ul>
<li><code>comb_meth_cps</code>: A named list combining weighting and trimming results for CPS dataset.</li>
<li><code>comb_meth_psid</code>: A named list combining weighting and trimming results for PSID dataset.</li>
<li><code>treat</code>: The name of the binary treatment indicator variable.</li>
<li><code>covar</code>: A vector of covariate names.</li>
<li><code>prefix</code>: Optional string prefix for plot titles related to the respective dataset or model.</li>
<li><code>prefix_cps</code>: Optional string prefix for plot titles related to CPS results.</li>
<li><code>prefix_psid</code>: Optional string prefix for plot titles related to PSID results.</li>
</ul>
<p><code>save_comb_loveplots()</code> saves the loveplots into a pdf file.</p>
<div class="sourceCode" id="cb35"><pre class="sourceCode r fold-hide"><code class="sourceCode r"><span id="cb35-1"><a href="getting-started.html#cb35-1" tabindex="-1"></a>save_comb_loveplots <span class="ot">&lt;-</span> <span class="cf">function</span>(<span class="at">comb_meth_cps =</span> <span class="cn">NULL</span>, <span class="at">comb_meth_psid =</span> <span class="cn">NULL</span>, treat, covar,</span>
<span id="cb35-2"><a href="getting-started.html#cb35-2" tabindex="-1"></a>                                <span class="at">prefix =</span> <span class="st">&quot;model_a&quot;</span>,</span>
<span id="cb35-3"><a href="getting-started.html#cb35-3" tabindex="-1"></a>                                <span class="at">prefix_cps =</span> <span class="st">&quot;LDW-CPS1&quot;</span>, <span class="at">prefix_psid =</span> <span class="st">&quot;LDW-PSID1&quot;</span>,</span>
<span id="cb35-4"><a href="getting-started.html#cb35-4" tabindex="-1"></a>                                <span class="at">path =</span> <span class="st">&quot;graphs/lalonde&quot;</span>) {</span>
<span id="cb35-5"><a href="getting-started.html#cb35-5" tabindex="-1"></a>  <span class="fu">dir.create</span>(path, <span class="at">showWarnings =</span> <span class="cn">FALSE</span>, <span class="at">recursive =</span> <span class="cn">TRUE</span>)</span>
<span id="cb35-6"><a href="getting-started.html#cb35-6" tabindex="-1"></a>  all_datasets <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb35-7"><a href="getting-started.html#cb35-7" tabindex="-1"></a>  <span class="cf">if</span> (<span class="sc">!</span><span class="fu">is.null</span>(comb_meth_cps)) all_datasets<span class="sc">$</span>CPS <span class="ot">&lt;-</span> comb_meth_cps</span>
<span id="cb35-8"><a href="getting-started.html#cb35-8" tabindex="-1"></a>  <span class="cf">if</span> (<span class="sc">!</span><span class="fu">is.null</span>(comb_meth_psid)) all_datasets<span class="sc">$</span>PSID <span class="ot">&lt;-</span> comb_meth_psid</span>
<span id="cb35-9"><a href="getting-started.html#cb35-9" tabindex="-1"></a>  </span>
<span id="cb35-10"><a href="getting-started.html#cb35-10" tabindex="-1"></a>  file_index <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb35-11"><a href="getting-started.html#cb35-11" tabindex="-1"></a>  <span class="cf">for</span> (ds_name <span class="cf">in</span> <span class="fu">names</span>(all_datasets)) {</span>
<span id="cb35-12"><a href="getting-started.html#cb35-12" tabindex="-1"></a>    method_list <span class="ot">&lt;-</span> all_datasets[[ds_name]]</span>
<span id="cb35-13"><a href="getting-started.html#cb35-13" tabindex="-1"></a>    method_names <span class="ot">&lt;-</span> <span class="fu">unlist</span>(<span class="fu">lapply</span>(<span class="fu">names</span>(method_list), <span class="cf">function</span>(weighting) {</span>
<span id="cb35-14"><a href="getting-started.html#cb35-14" tabindex="-1"></a>      trimmed_list <span class="ot">&lt;-</span> method_list[[weighting]]</span>
<span id="cb35-15"><a href="getting-started.html#cb35-15" tabindex="-1"></a>      <span class="fu">sapply</span>(<span class="fu">names</span>(trimmed_list), <span class="cf">function</span>(trim) <span class="fu">paste</span>(weighting, trim, <span class="at">sep =</span> <span class="st">&quot;_&quot;</span>))</span>
<span id="cb35-16"><a href="getting-started.html#cb35-16" tabindex="-1"></a>    }))</span>
<span id="cb35-17"><a href="getting-started.html#cb35-17" tabindex="-1"></a>    <span class="cf">for</span> (weighting <span class="cf">in</span> <span class="fu">names</span>(method_list)) {</span>
<span id="cb35-18"><a href="getting-started.html#cb35-18" tabindex="-1"></a>      trimmed_list <span class="ot">&lt;-</span> method_list[[weighting]]</span>
<span id="cb35-19"><a href="getting-started.html#cb35-19" tabindex="-1"></a>      <span class="cf">for</span> (trim <span class="cf">in</span> <span class="fu">names</span>(trimmed_list)) {</span>
<span id="cb35-20"><a href="getting-started.html#cb35-20" tabindex="-1"></a>        df <span class="ot">&lt;-</span> trimmed_list[[trim]]</span>
<span id="cb35-21"><a href="getting-started.html#cb35-21" tabindex="-1"></a>        <span class="cf">if</span> (<span class="sc">!</span><span class="st">&quot;weight&quot;</span> <span class="sc">%in%</span> <span class="fu">names</span>(df)) df<span class="sc">$</span>weight <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb35-22"><a href="getting-started.html#cb35-22" tabindex="-1"></a>        bal <span class="ot">&lt;-</span> cobalt<span class="sc">::</span><span class="fu">bal.tab</span>(</span>
<span id="cb35-23"><a href="getting-started.html#cb35-23" tabindex="-1"></a>          <span class="fu">as.formula</span>(<span class="fu">paste</span>(treat, <span class="st">&quot;~&quot;</span>, <span class="fu">paste</span>(covar, <span class="at">collapse =</span> <span class="st">&quot; + &quot;</span>))),</span>
<span id="cb35-24"><a href="getting-started.html#cb35-24" tabindex="-1"></a>          <span class="at">data =</span> df,</span>
<span id="cb35-25"><a href="getting-started.html#cb35-25" tabindex="-1"></a>          <span class="at">weights =</span> df<span class="sc">$</span>weight,</span>
<span id="cb35-26"><a href="getting-started.html#cb35-26" tabindex="-1"></a>          <span class="at">un =</span> <span class="cn">TRUE</span>,</span>
<span id="cb35-27"><a href="getting-started.html#cb35-27" tabindex="-1"></a>          <span class="at">s.d.denom =</span> <span class="st">&quot;treated&quot;</span></span>
<span id="cb35-28"><a href="getting-started.html#cb35-28" tabindex="-1"></a>        )</span>
<span id="cb35-29"><a href="getting-started.html#cb35-29" tabindex="-1"></a>        method_name <span class="ot">&lt;-</span> <span class="fu">paste</span>(weighting, trim, <span class="at">sep =</span> <span class="st">&quot;_&quot;</span>)</span>
<span id="cb35-30"><a href="getting-started.html#cb35-30" tabindex="-1"></a>        prefix_str <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(ds_name <span class="sc">==</span> <span class="st">&quot;CPS&quot;</span>, prefix_cps, prefix_psid)</span>
<span id="cb35-31"><a href="getting-started.html#cb35-31" tabindex="-1"></a>        pdf_file <span class="ot">&lt;-</span> <span class="fu">file.path</span>(path, <span class="fu">sprintf</span>(<span class="st">&quot;%s_balance_%d.pdf&quot;</span>, prefix, file_index))</span>
<span id="cb35-32"><a href="getting-started.html#cb35-32" tabindex="-1"></a>        <span class="fu">pdf</span>(pdf_file, <span class="at">width =</span> <span class="dv">8</span>, <span class="at">height =</span> <span class="dv">6</span>)</span>
<span id="cb35-33"><a href="getting-started.html#cb35-33" tabindex="-1"></a>        lp <span class="ot">&lt;-</span> cobalt<span class="sc">::</span><span class="fu">love.plot</span>(</span>
<span id="cb35-34"><a href="getting-started.html#cb35-34" tabindex="-1"></a>          bal,</span>
<span id="cb35-35"><a href="getting-started.html#cb35-35" tabindex="-1"></a>          <span class="at">stats =</span> <span class="st">&quot;mean.diffs&quot;</span>,</span>
<span id="cb35-36"><a href="getting-started.html#cb35-36" tabindex="-1"></a>          <span class="at">absolute =</span> <span class="cn">TRUE</span>,</span>
<span id="cb35-37"><a href="getting-started.html#cb35-37" tabindex="-1"></a>          <span class="at">var.order =</span> <span class="st">&quot;unadjusted&quot;</span>,</span>
<span id="cb35-38"><a href="getting-started.html#cb35-38" tabindex="-1"></a>          <span class="at">thresholds =</span> <span class="fu">c</span>(<span class="at">m =</span> .<span class="dv">1</span>),</span>
<span id="cb35-39"><a href="getting-started.html#cb35-39" tabindex="-1"></a>          <span class="at">title =</span> <span class="fu">paste</span>(prefix_str, method_name, <span class="at">sep =</span> <span class="st">&quot; - &quot;</span>)</span>
<span id="cb35-40"><a href="getting-started.html#cb35-40" tabindex="-1"></a>        )</span>
<span id="cb35-41"><a href="getting-started.html#cb35-41" tabindex="-1"></a>        <span class="fu">print</span>(lp)</span>
<span id="cb35-42"><a href="getting-started.html#cb35-42" tabindex="-1"></a>        <span class="fu">dev.off</span>()</span>
<span id="cb35-43"><a href="getting-started.html#cb35-43" tabindex="-1"></a>        file_index <span class="ot">&lt;-</span> file_index <span class="sc">+</span> <span class="dv">1</span></span>
<span id="cb35-44"><a href="getting-started.html#cb35-44" tabindex="-1"></a>      }</span>
<span id="cb35-45"><a href="getting-started.html#cb35-45" tabindex="-1"></a>    }</span>
<span id="cb35-46"><a href="getting-started.html#cb35-46" tabindex="-1"></a>  }</span>
<span id="cb35-47"><a href="getting-started.html#cb35-47" tabindex="-1"></a>}</span></code></pre></div>
<p><strong>Arguments</strong></p>
<ul>
<li><code>comb_meth_cps</code>: A named list combining weighting and trimming results for CPS dataset.</li>
<li><code>comb_meth_psid</code>: A named list combining weighting and trimming results for PSID dataset.</li>
<li><code>treat</code>: The name of the binary treatment indicator variable.</li>
<li><code>covar</code>: A vector of covariate names.</li>
<li><code>prefix</code>: String prefix used for saved file names to identify dataset.</li>
<li><code>prefix_cps</code>: Optional string prefix for plot titles related to CPS results.</li>
<li><code>prefix_psid</code>: Optional string prefix for plot titles related to PSID results.</li>
</ul>
</div>
<div id="getting-top-methods-and-datasets" class="section level4 hasAnchor" number="1.2.4.6">
<h4><span class="header-section-number">1.2.4.6</span> Getting top methods and datasets<a href="getting-started.html#getting-top-methods-and-datasets" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p><code>combine_results()</code> merges and summarizes SMD and ESS statistics from various analysis stages into a final comparison table.</p>
<div class="sourceCode" id="cb36"><pre class="sourceCode r fold-hide"><code class="sourceCode r"><span id="cb36-1"><a href="getting-started.html#cb36-1" tabindex="-1"></a>combine_results <span class="ot">&lt;-</span> <span class="cf">function</span>(dataset_name) {</span>
<span id="cb36-2"><a href="getting-started.html#cb36-2" tabindex="-1"></a>  dataset_lower <span class="ot">&lt;-</span> <span class="fu">tolower</span>(dataset_name)</span>
<span id="cb36-3"><a href="getting-started.html#cb36-3" tabindex="-1"></a>  <span class="co"># Retrieve matching results</span></span>
<span id="cb36-4"><a href="getting-started.html#cb36-4" tabindex="-1"></a>  smd_matching <span class="ot">&lt;-</span> <span class="fu">get</span>(<span class="fu">paste0</span>(<span class="st">&quot;smd_matchit.&quot;</span>, dataset_lower))</span>
<span id="cb36-5"><a href="getting-started.html#cb36-5" tabindex="-1"></a>  ess_matching <span class="ot">&lt;-</span> <span class="fu">get</span>(<span class="fu">paste0</span>(<span class="st">&quot;ess_matchit.&quot;</span>, dataset_lower))</span>
<span id="cb36-6"><a href="getting-started.html#cb36-6" tabindex="-1"></a>  <span class="co"># Retrieve trimming results</span></span>
<span id="cb36-7"><a href="getting-started.html#cb36-7" tabindex="-1"></a>  smd_trimming <span class="ot">&lt;-</span> <span class="fu">get</span>(<span class="fu">paste0</span>(<span class="st">&quot;smd_trim.&quot;</span>, dataset_lower))</span>
<span id="cb36-8"><a href="getting-started.html#cb36-8" tabindex="-1"></a>  ess_trimming <span class="ot">&lt;-</span> <span class="fu">get</span>(<span class="fu">paste0</span>(<span class="st">&quot;ess_trim.&quot;</span>, dataset_lower))</span>
<span id="cb36-9"><a href="getting-started.html#cb36-9" tabindex="-1"></a>  <span class="co"># Retrieve truncation results</span></span>
<span id="cb36-10"><a href="getting-started.html#cb36-10" tabindex="-1"></a>  smd_trunc <span class="ot">&lt;-</span> <span class="fu">get</span>(<span class="fu">paste0</span>(<span class="st">&quot;smd_trunc.&quot;</span>, dataset_lower))</span>
<span id="cb36-11"><a href="getting-started.html#cb36-11" tabindex="-1"></a>  ess_trunc <span class="ot">&lt;-</span> <span class="fu">get</span>(<span class="fu">paste0</span>(<span class="st">&quot;ess_trunc.&quot;</span>, dataset_lower))</span>
<span id="cb36-12"><a href="getting-started.html#cb36-12" tabindex="-1"></a>  <span class="co"># Retrieve weighting results</span></span>
<span id="cb36-13"><a href="getting-started.html#cb36-13" tabindex="-1"></a>  smd_weighting <span class="ot">&lt;-</span> <span class="fu">get</span>(<span class="fu">paste0</span>(<span class="st">&quot;smd_weight.&quot;</span>, dataset_lower))</span>
<span id="cb36-14"><a href="getting-started.html#cb36-14" tabindex="-1"></a>  ess_weighting <span class="ot">&lt;-</span> <span class="fu">get</span>(<span class="fu">paste0</span>(<span class="st">&quot;ess_weight.&quot;</span>, dataset_lower))</span>
<span id="cb36-15"><a href="getting-started.html#cb36-15" tabindex="-1"></a>  <span class="co"># Retrieve combined SMD and ESS</span></span>
<span id="cb36-16"><a href="getting-started.html#cb36-16" tabindex="-1"></a>  <span class="co"># Make sure you have these variables in your environment per dataset</span></span>
<span id="cb36-17"><a href="getting-started.html#cb36-17" tabindex="-1"></a>  smd_combined_var <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">&quot;smd_all_comb_meth.&quot;</span>, dataset_lower)</span>
<span id="cb36-18"><a href="getting-started.html#cb36-18" tabindex="-1"></a>  ess_combined_var <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">&quot;ess_all_comb_meth.&quot;</span>, dataset_lower)</span>
<span id="cb36-19"><a href="getting-started.html#cb36-19" tabindex="-1"></a>  smd_combined <span class="ot">&lt;-</span> <span class="fu">get</span>(smd_combined_var)</span>
<span id="cb36-20"><a href="getting-started.html#cb36-20" tabindex="-1"></a>  ess_combined <span class="ot">&lt;-</span> <span class="fu">get</span>(ess_combined_var)</span>
<span id="cb36-21"><a href="getting-started.html#cb36-21" tabindex="-1"></a>  <span class="co"># Combine all SMD results</span></span>
<span id="cb36-22"><a href="getting-started.html#cb36-22" tabindex="-1"></a>  smd_all <span class="ot">&lt;-</span> <span class="fu">do.call</span>(rbind, <span class="fu">list</span>(</span>
<span id="cb36-23"><a href="getting-started.html#cb36-23" tabindex="-1"></a>    smd_matching,</span>
<span id="cb36-24"><a href="getting-started.html#cb36-24" tabindex="-1"></a>    smd_trimming,</span>
<span id="cb36-25"><a href="getting-started.html#cb36-25" tabindex="-1"></a>    smd_trunc,</span>
<span id="cb36-26"><a href="getting-started.html#cb36-26" tabindex="-1"></a>    smd_weighting,</span>
<span id="cb36-27"><a href="getting-started.html#cb36-27" tabindex="-1"></a>    smd_combined[, <span class="fu">c</span>(<span class="st">&quot;Method&quot;</span>, <span class="st">&quot;Mean_Abs_SMD&quot;</span>, <span class="st">&quot;Max_Abs_SMD&quot;</span>)]</span>
<span id="cb36-28"><a href="getting-started.html#cb36-28" tabindex="-1"></a>  ))</span>
<span id="cb36-29"><a href="getting-started.html#cb36-29" tabindex="-1"></a>    <span class="co"># Combine all ESS results</span></span>
<span id="cb36-30"><a href="getting-started.html#cb36-30" tabindex="-1"></a>  ess_all <span class="ot">&lt;-</span> <span class="fu">do.call</span>(rbind, <span class="fu">list</span>(</span>
<span id="cb36-31"><a href="getting-started.html#cb36-31" tabindex="-1"></a>    ess_matching,</span>
<span id="cb36-32"><a href="getting-started.html#cb36-32" tabindex="-1"></a>    ess_trimming,</span>
<span id="cb36-33"><a href="getting-started.html#cb36-33" tabindex="-1"></a>    ess_trunc,</span>
<span id="cb36-34"><a href="getting-started.html#cb36-34" tabindex="-1"></a>    ess_weighting,</span>
<span id="cb36-35"><a href="getting-started.html#cb36-35" tabindex="-1"></a>    ess_combined[, <span class="fu">c</span>(<span class="st">&quot;Method&quot;</span>, <span class="st">&quot;Control&quot;</span>, <span class="st">&quot;Treated&quot;</span>)]</span>
<span id="cb36-36"><a href="getting-started.html#cb36-36" tabindex="-1"></a>  ))</span>
<span id="cb36-37"><a href="getting-started.html#cb36-37" tabindex="-1"></a>  <span class="co"># Merge SMD and ESS results by Method</span></span>
<span id="cb36-38"><a href="getting-started.html#cb36-38" tabindex="-1"></a>  final_df <span class="ot">&lt;-</span> <span class="fu">merge</span>(smd_all, ess_all, <span class="at">by =</span> <span class="st">&quot;Method&quot;</span>, <span class="at">all =</span> <span class="cn">TRUE</span>)</span>
<span id="cb36-39"><a href="getting-started.html#cb36-39" tabindex="-1"></a>  <span class="co"># Remove dataset suffixes like &quot;.cps_plus&quot; or &quot;.psid_plus&quot; from Method names for cleaner labels</span></span>
<span id="cb36-40"><a href="getting-started.html#cb36-40" tabindex="-1"></a>  final_df<span class="sc">$</span>Method <span class="ot">&lt;-</span> <span class="fu">gsub</span>(<span class="st">&quot;</span><span class="sc">\\</span><span class="st">.psid_plus&quot;</span>, <span class="st">&quot;&quot;</span>, final_df<span class="sc">$</span>Method, <span class="at">ignore.case =</span> <span class="cn">TRUE</span>)</span>
<span id="cb36-41"><a href="getting-started.html#cb36-41" tabindex="-1"></a>  final_df<span class="sc">$</span>Method <span class="ot">&lt;-</span> <span class="fu">gsub</span>(<span class="st">&quot;</span><span class="sc">\\</span><span class="st">.cps_plus&quot;</span>, <span class="st">&quot;&quot;</span>, final_df<span class="sc">$</span>Method, <span class="at">ignore.case =</span> <span class="cn">TRUE</span>)</span>
<span id="cb36-42"><a href="getting-started.html#cb36-42" tabindex="-1"></a>    <span class="co"># Reset row names</span></span>
<span id="cb36-43"><a href="getting-started.html#cb36-43" tabindex="-1"></a>  <span class="fu">rownames</span>(final_df) <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb36-44"><a href="getting-started.html#cb36-44" tabindex="-1"></a>  <span class="fu">return</span>(final_df)</span>
<span id="cb36-45"><a href="getting-started.html#cb36-45" tabindex="-1"></a>}</span></code></pre></div>
<p><strong>Arguments</strong></p>
<ul>
<li><code>dataset_name</code>: The dataset name for which to combine SMD and ESS summaries.</li>
</ul>
<p><code>save_csv()</code> saves the tables into a CSV file.</p>
<div class="sourceCode" id="cb37"><pre class="sourceCode r fold-hide"><code class="sourceCode r"><span id="cb37-1"><a href="getting-started.html#cb37-1" tabindex="-1"></a>save_csv <span class="ot">&lt;-</span> <span class="cf">function</span>(data, filename) {</span>
<span id="cb37-2"><a href="getting-started.html#cb37-2" tabindex="-1"></a>  folder <span class="ot">&lt;-</span> <span class="st">&quot;../tables&quot;</span></span>
<span id="cb37-3"><a href="getting-started.html#cb37-3" tabindex="-1"></a>  <span class="cf">if</span> (<span class="sc">!</span><span class="fu">dir.exists</span>(folder)) <span class="fu">dir.create</span>(folder, <span class="at">recursive =</span> <span class="cn">TRUE</span>)</span>
<span id="cb37-4"><a href="getting-started.html#cb37-4" tabindex="-1"></a>  file_csv <span class="ot">&lt;-</span> <span class="fu">file.path</span>(folder, <span class="fu">paste0</span>(filename, <span class="st">&quot;.csv&quot;</span>))</span>
<span id="cb37-5"><a href="getting-started.html#cb37-5" tabindex="-1"></a>  <span class="fu">write.csv</span>(data, <span class="at">file =</span> file_csv, <span class="at">row.names =</span> <span class="cn">FALSE</span>)</span>
<span id="cb37-6"><a href="getting-started.html#cb37-6" tabindex="-1"></a>}</span></code></pre></div>
<p><strong>Arguments</strong></p>
<ul>
<li><code>data</code>: The input dataset.</li>
<li><code>filename</code>: The name of the file that is to be saved as CSV.</li>
</ul>
<p><code>assess_methods()</code> scores and ranks methods based on a weighted combination of balance and sample size metrics.</p>
<div class="sourceCode" id="cb38"><pre class="sourceCode r fold-hide"><code class="sourceCode r"><span id="cb38-1"><a href="getting-started.html#cb38-1" tabindex="-1"></a>assess_methods <span class="ot">&lt;-</span> <span class="cf">function</span>(df) {</span>
<span id="cb38-2"><a href="getting-started.html#cb38-2" tabindex="-1"></a>  df <span class="sc">%&gt;%</span></span>
<span id="cb38-3"><a href="getting-started.html#cb38-3" tabindex="-1"></a>    <span class="fu">mutate</span>(</span>
<span id="cb38-4"><a href="getting-started.html#cb38-4" tabindex="-1"></a>      <span class="co"># ess score</span></span>
<span id="cb38-5"><a href="getting-started.html#cb38-5" tabindex="-1"></a>      <span class="at">ess_balance_ratio =</span> <span class="fu">pmin</span>(Control, Treated) <span class="sc">/</span> <span class="fu">pmax</span>(Control, Treated),</span>
<span id="cb38-6"><a href="getting-started.html#cb38-6" tabindex="-1"></a>      <span class="at">ess_total =</span> Control <span class="sc">+</span> Treated,</span>
<span id="cb38-7"><a href="getting-started.html#cb38-7" tabindex="-1"></a>      <span class="co"># Normalize balance_ratio and ess_total</span></span>
<span id="cb38-8"><a href="getting-started.html#cb38-8" tabindex="-1"></a>      <span class="at">ess_balance_score =</span> (ess_balance_ratio <span class="sc">-</span> <span class="fu">min</span>(ess_balance_ratio, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)) <span class="sc">/</span></span>
<span id="cb38-9"><a href="getting-started.html#cb38-9" tabindex="-1"></a>        (<span class="fu">max</span>(ess_balance_ratio, <span class="at">na.rm =</span> <span class="cn">TRUE</span>) <span class="sc">-</span> <span class="fu">min</span>(ess_balance_ratio, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)),</span>
<span id="cb38-10"><a href="getting-started.html#cb38-10" tabindex="-1"></a>      <span class="at">ess_size_score =</span> (ess_total <span class="sc">-</span> <span class="fu">min</span>(ess_total, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)) <span class="sc">/</span></span>
<span id="cb38-11"><a href="getting-started.html#cb38-11" tabindex="-1"></a>        (<span class="fu">max</span>(ess_total, <span class="at">na.rm =</span> <span class="cn">TRUE</span>) <span class="sc">-</span> <span class="fu">min</span>(ess_total, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)),</span>
<span id="cb38-12"><a href="getting-started.html#cb38-12" tabindex="-1"></a>      <span class="co"># Combine size and balance equally</span></span>
<span id="cb38-13"><a href="getting-started.html#cb38-13" tabindex="-1"></a>      <span class="at">ess_score =</span> <span class="fl">0.5</span> <span class="sc">*</span> ess_balance_score <span class="sc">+</span> <span class="fl">0.5</span> <span class="sc">*</span> ess_size_score,</span>
<span id="cb38-14"><a href="getting-started.html#cb38-14" tabindex="-1"></a>      <span class="co"># smd score</span></span>
<span id="cb38-15"><a href="getting-started.html#cb38-15" tabindex="-1"></a>      <span class="at">smd_score =</span> <span class="dv">1</span> <span class="sc">-</span> (Mean_Abs_SMD <span class="sc">-</span> <span class="fu">min</span>(Mean_Abs_SMD, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)) <span class="sc">/</span></span>
<span id="cb38-16"><a href="getting-started.html#cb38-16" tabindex="-1"></a>        (<span class="fu">max</span>(Mean_Abs_SMD, <span class="at">na.rm =</span> <span class="cn">TRUE</span>) <span class="sc">-</span> <span class="fu">min</span>(Mean_Abs_SMD, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)),</span>
<span id="cb38-17"><a href="getting-started.html#cb38-17" tabindex="-1"></a>      <span class="co"># final score</span></span>
<span id="cb38-18"><a href="getting-started.html#cb38-18" tabindex="-1"></a>      <span class="at">Score =</span> <span class="fl">0.5</span> <span class="sc">*</span> smd_score <span class="sc">+</span> <span class="fl">0.5</span> <span class="sc">*</span> ess_score</span>
<span id="cb38-19"><a href="getting-started.html#cb38-19" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span></span>
<span id="cb38-20"><a href="getting-started.html#cb38-20" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">select</span>(Method, Score) <span class="sc">%&gt;%</span></span>
<span id="cb38-21"><a href="getting-started.html#cb38-21" tabindex="-1"></a>    <span class="fu">arrange</span>(<span class="fu">desc</span>(Score))</span>
<span id="cb38-22"><a href="getting-started.html#cb38-22" tabindex="-1"></a>}</span></code></pre></div>
<p><strong>Argument</strong></p>
<ul>
<li><code>df</code>: A data frame containing method performance metrics.</li>
</ul>
<p><code>get_top_methods()</code> retrieves the top-performing methods based on combined scoring criteria.</p>
<div class="sourceCode" id="cb39"><pre class="sourceCode r fold-hide"><code class="sourceCode r"><span id="cb39-1"><a href="getting-started.html#cb39-1" tabindex="-1"></a>get_top_methods <span class="ot">&lt;-</span> <span class="cf">function</span>(summary_df, <span class="at">top_n =</span> <span class="dv">5</span>) {</span>
<span id="cb39-2"><a href="getting-started.html#cb39-2" tabindex="-1"></a>  <span class="cf">if</span> (<span class="sc">!</span><span class="fu">all</span>(<span class="fu">c</span>(<span class="st">&quot;Method&quot;</span>, <span class="st">&quot;Score&quot;</span>) <span class="sc">%in%</span> <span class="fu">names</span>(summary_df))) {</span>
<span id="cb39-3"><a href="getting-started.html#cb39-3" tabindex="-1"></a>    <span class="fu">stop</span>(<span class="st">&quot;Data frame must contain columns &#39;Method&#39; and &#39;Score&#39;&quot;</span>)</span>
<span id="cb39-4"><a href="getting-started.html#cb39-4" tabindex="-1"></a>  }</span>
<span id="cb39-5"><a href="getting-started.html#cb39-5" tabindex="-1"></a>  top_methods_df <span class="ot">&lt;-</span> summary_df <span class="sc">%&gt;%</span></span>
<span id="cb39-6"><a href="getting-started.html#cb39-6" tabindex="-1"></a>    <span class="fu">arrange</span>(<span class="fu">desc</span>(Score)) <span class="sc">%&gt;%</span></span>
<span id="cb39-7"><a href="getting-started.html#cb39-7" tabindex="-1"></a>    <span class="fu">head</span>(top_n)</span>
<span id="cb39-8"><a href="getting-started.html#cb39-8" tabindex="-1"></a>  <span class="fu">print</span>(top_methods_df)</span>
<span id="cb39-9"><a href="getting-started.html#cb39-9" tabindex="-1"></a>  <span class="fu">return</span>(top_methods_df<span class="sc">$</span>Method)</span>
<span id="cb39-10"><a href="getting-started.html#cb39-10" tabindex="-1"></a>}</span></code></pre></div>
<p><strong>Arguments</strong></p>
<ul>
<li><code>summary_df</code>: A data frame including columns used for ranking.</li>
<li><code>top_n</code>: Integer specifying the number of top-performing methods to return (default 5).</li>
</ul>
<p><code>create_top5_datasets()</code> extracts datasets corresponding to the top five ranked methods for further analysis or presentation.</p>
<div class="sourceCode" id="cb40"><pre class="sourceCode r fold-hide"><code class="sourceCode r"><span id="cb40-1"><a href="getting-started.html#cb40-1" tabindex="-1"></a>create_top5_datasets <span class="ot">&lt;-</span> <span class="cf">function</span>(dataset_list, top5_method_names) {</span>
<span id="cb40-2"><a href="getting-started.html#cb40-2" tabindex="-1"></a>  <span class="fu">lapply</span>(top5_method_names, <span class="cf">function</span>(method_name) {</span>
<span id="cb40-3"><a href="getting-started.html#cb40-3" tabindex="-1"></a>    <span class="cf">if</span> (<span class="sc">!</span>method_name <span class="sc">%in%</span> <span class="fu">names</span>(dataset_list)) {</span>
<span id="cb40-4"><a href="getting-started.html#cb40-4" tabindex="-1"></a>      <span class="fu">stop</span>(<span class="fu">paste0</span>(<span class="st">&quot;Method &#39;&quot;</span>, method_name, <span class="st">&quot;&#39; not found in the dataset lookup list&quot;</span>))</span>
<span id="cb40-5"><a href="getting-started.html#cb40-5" tabindex="-1"></a>    }</span>
<span id="cb40-6"><a href="getting-started.html#cb40-6" tabindex="-1"></a>    ds <span class="ot">&lt;-</span> dataset_list[[method_name]]</span>
<span id="cb40-7"><a href="getting-started.html#cb40-7" tabindex="-1"></a>    <span class="cf">if</span> (<span class="fu">inherits</span>(ds, <span class="st">&quot;matchit&quot;</span>)) {</span>
<span id="cb40-8"><a href="getting-started.html#cb40-8" tabindex="-1"></a>      <span class="co"># for matchit class, extract matched data</span></span>
<span id="cb40-9"><a href="getting-started.html#cb40-9" tabindex="-1"></a>      <span class="fu">return</span>(<span class="fu">as.data.frame</span>(<span class="fu">match.data</span>(ds)))</span>
<span id="cb40-10"><a href="getting-started.html#cb40-10" tabindex="-1"></a>    } <span class="cf">else</span> <span class="cf">if</span> (<span class="fu">is.data.frame</span>(ds)) {</span>
<span id="cb40-11"><a href="getting-started.html#cb40-11" tabindex="-1"></a>      <span class="co"># if already dataframe, return as is</span></span>
<span id="cb40-12"><a href="getting-started.html#cb40-12" tabindex="-1"></a>      <span class="fu">return</span>(ds)</span>
<span id="cb40-13"><a href="getting-started.html#cb40-13" tabindex="-1"></a>    } <span class="cf">else</span> <span class="cf">if</span> (<span class="fu">is.vector</span>(ds)) {</span>
<span id="cb40-14"><a href="getting-started.html#cb40-14" tabindex="-1"></a>      <span class="co"># merge with original data</span></span>
<span id="cb40-15"><a href="getting-started.html#cb40-15" tabindex="-1"></a>      <span class="cf">if</span> (<span class="sc">!</span><span class="st">&quot;original&quot;</span> <span class="sc">%in%</span> <span class="fu">names</span>(dataset_list)) {</span>
<span id="cb40-16"><a href="getting-started.html#cb40-16" tabindex="-1"></a>        <span class="fu">stop</span>(<span class="st">&quot;Original dataset not found in dataset_list to merge weights&quot;</span>)</span>
<span id="cb40-17"><a href="getting-started.html#cb40-17" tabindex="-1"></a>      }</span>
<span id="cb40-18"><a href="getting-started.html#cb40-18" tabindex="-1"></a>      original_df <span class="ot">&lt;-</span> dataset_list[[<span class="st">&quot;original&quot;</span>]]</span>
<span id="cb40-19"><a href="getting-started.html#cb40-19" tabindex="-1"></a>      <span class="cf">if</span> (<span class="fu">length</span>(ds) <span class="sc">!=</span> <span class="fu">nrow</span>(original_df)) {</span>
<span id="cb40-20"><a href="getting-started.html#cb40-20" tabindex="-1"></a>        <span class="fu">stop</span>(<span class="fu">paste0</span>(<span class="st">&quot;Length of weight vector for method &#39;&quot;</span>, method_name, <span class="st">&quot;&#39; does not match number of rows in original dataset&quot;</span>))</span>
<span id="cb40-21"><a href="getting-started.html#cb40-21" tabindex="-1"></a>      }</span>
<span id="cb40-22"><a href="getting-started.html#cb40-22" tabindex="-1"></a>      <span class="co"># create new data frame with weights appended</span></span>
<span id="cb40-23"><a href="getting-started.html#cb40-23" tabindex="-1"></a>      weighted_df <span class="ot">&lt;-</span> original_df</span>
<span id="cb40-24"><a href="getting-started.html#cb40-24" tabindex="-1"></a>      weighted_df[[<span class="st">&quot;weights&quot;</span>]] <span class="ot">&lt;-</span> ds</span>
<span id="cb40-25"><a href="getting-started.html#cb40-25" tabindex="-1"></a>      <span class="fu">return</span>(weighted_df)</span>
<span id="cb40-26"><a href="getting-started.html#cb40-26" tabindex="-1"></a>    } <span class="cf">else</span> {</span>
<span id="cb40-27"><a href="getting-started.html#cb40-27" tabindex="-1"></a>      <span class="fu">stop</span>(<span class="fu">paste</span>(<span class="st">&quot;Unsupported data type for method&quot;</span>, method_name))</span>
<span id="cb40-28"><a href="getting-started.html#cb40-28" tabindex="-1"></a>    }</span>
<span id="cb40-29"><a href="getting-started.html#cb40-29" tabindex="-1"></a>  })</span>
<span id="cb40-30"><a href="getting-started.html#cb40-30" tabindex="-1"></a>}</span></code></pre></div>
<p><strong>Arguments</strong></p>
<ul>
<li><code>dataset_list</code>: A named list of datasets or MatchIt objects containing processed results for different methods.</li>
<li><code>top5_method_names</code>: A character vector of method names corresponding to the top-ranked datasets.</li>
</ul>
<p><code>save_top5_individual_files()</code> saves datasets of the top five methods as individual files for reproducibility or sharing.</p>
<div class="sourceCode" id="cb41"><pre class="sourceCode r fold-hide"><code class="sourceCode r"><span id="cb41-1"><a href="getting-started.html#cb41-1" tabindex="-1"></a>save_top5_individual_files <span class="ot">&lt;-</span> <span class="cf">function</span>(combined_methods_list, top5_method_names, prefix) {</span>
<span id="cb41-2"><a href="getting-started.html#cb41-2" tabindex="-1"></a>  <span class="cf">for</span> (i <span class="cf">in</span> <span class="fu">seq_along</span>(top5_method_names)) {</span>
<span id="cb41-3"><a href="getting-started.html#cb41-3" tabindex="-1"></a>    method_name <span class="ot">&lt;-</span> top5_method_names[i]</span>
<span id="cb41-4"><a href="getting-started.html#cb41-4" tabindex="-1"></a>    <span class="cf">if</span> (<span class="sc">!</span>method_name <span class="sc">%in%</span> <span class="fu">names</span>(combined_methods_list)) {</span>
<span id="cb41-5"><a href="getting-started.html#cb41-5" tabindex="-1"></a>      <span class="fu">warning</span>(<span class="fu">paste0</span>(<span class="st">&quot;Method &#39;&quot;</span>, method_name, <span class="st">&quot;&#39; not found in combined methods list&quot;</span>))</span>
<span id="cb41-6"><a href="getting-started.html#cb41-6" tabindex="-1"></a>      <span class="cf">next</span></span>
<span id="cb41-7"><a href="getting-started.html#cb41-7" tabindex="-1"></a>    }</span>
<span id="cb41-8"><a href="getting-started.html#cb41-8" tabindex="-1"></a>    dataset_to_save <span class="ot">&lt;-</span> combined_methods_list[[method_name]]</span>
<span id="cb41-9"><a href="getting-started.html#cb41-9" tabindex="-1"></a>    file_name <span class="ot">&lt;-</span> <span class="fu">sprintf</span>(<span class="st">&quot;data/top%d_%s_method_%s.RData&quot;</span>, i, prefix, method_name)</span>
<span id="cb41-10"><a href="getting-started.html#cb41-10" tabindex="-1"></a>    <span class="fu">save</span>(dataset_to_save, <span class="at">file =</span> file_name)</span>
<span id="cb41-11"><a href="getting-started.html#cb41-11" tabindex="-1"></a>    <span class="fu">cat</span>(<span class="st">&quot;Saved:&quot;</span>, file_name, <span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span>)</span>
<span id="cb41-12"><a href="getting-started.html#cb41-12" tabindex="-1"></a>  }</span>
<span id="cb41-13"><a href="getting-started.html#cb41-13" tabindex="-1"></a>}</span></code></pre></div>
<p><strong>Arguments</strong></p>
<ul>
<li><code>combined_methods_list</code>: A named list of all combined method results.</li>
<li><code>top5_method_names</code>: A character vector of method names corresponding to the top-ranked datasets.</li>
<li><code>prefix</code>: String prefix used for saved file names to identify dataset.</li>
</ul>
<p><br></p>
</div>
</div>
<div id="estimating" class="section level3 hasAnchor" number="1.2.5">
<h3><span class="header-section-number">1.2.5</span> Estimating<a href="getting-started.html#estimating" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div id="average-treatment-effect-of-the-treated-att" class="section level4 hasAnchor" number="1.2.5.1">
<h4><span class="header-section-number">1.2.5.1</span> Average treatment effect of the treated (ATT)<a href="getting-started.html#average-treatment-effect-of-the-treated-att" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p><a name="est-and-plot-att-catt-qtet"></a></p>
<p><code>estimate_all()</code> runs multiple treatment effect estimators on a dataset and returns point estimates, standard errors and confidence intervals.</p>
<div class="sourceCode" id="cb42"><pre class="sourceCode r fold-hide"><code class="sourceCode r"><span id="cb42-1"><a href="getting-started.html#cb42-1" tabindex="-1"></a><span class="co"># diff</span></span>
<span id="cb42-2"><a href="getting-started.html#cb42-2" tabindex="-1"></a>diff <span class="ot">&lt;-</span> <span class="cf">function</span>(data, Y, treat) {</span>
<span id="cb42-3"><a href="getting-started.html#cb42-3" tabindex="-1"></a>  fml <span class="ot">&lt;-</span> <span class="fu">as.formula</span>(<span class="fu">paste</span>(Y, <span class="st">&quot;~&quot;</span>, treat))</span>
<span id="cb42-4"><a href="getting-started.html#cb42-4" tabindex="-1"></a>  out <span class="ot">&lt;-</span> <span class="fu">summary</span>(<span class="fu">lm_robust</span>(fml, <span class="at">data =</span> data, <span class="at">se_type =</span> <span class="st">&quot;stata&quot;</span>))<span class="sc">$</span>coefficients[treat, <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">5</span>, <span class="dv">6</span>)]</span>
<span id="cb42-5"><a href="getting-started.html#cb42-5" tabindex="-1"></a>  <span class="fu">return</span>(out) <span class="co"># extract coef, se, ci.lower, ci.upper</span></span>
<span id="cb42-6"><a href="getting-started.html#cb42-6" tabindex="-1"></a>}</span>
<span id="cb42-7"><a href="getting-started.html#cb42-7" tabindex="-1"></a></span>
<span id="cb42-8"><a href="getting-started.html#cb42-8" tabindex="-1"></a><span class="co"># reg</span></span>
<span id="cb42-9"><a href="getting-started.html#cb42-9" tabindex="-1"></a>reg <span class="ot">&lt;-</span> <span class="cf">function</span>(data, Y, treat, covar) {</span>
<span id="cb42-10"><a href="getting-started.html#cb42-10" tabindex="-1"></a>  fml <span class="ot">&lt;-</span> <span class="fu">as.formula</span>(<span class="fu">paste</span>(Y, <span class="st">&quot;~&quot;</span>, treat, <span class="st">&quot;+&quot;</span>, <span class="fu">paste</span>(covar, <span class="at">collapse =</span> <span class="st">&quot; + &quot;</span>)))</span>
<span id="cb42-11"><a href="getting-started.html#cb42-11" tabindex="-1"></a>  out <span class="ot">&lt;-</span> <span class="fu">summary</span>(<span class="fu">lm_robust</span>(fml, <span class="at">data =</span> data, <span class="at">se_type =</span> <span class="st">&quot;stata&quot;</span>))<span class="sc">$</span>coefficients[treat, <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">5</span>, <span class="dv">6</span>)]</span>
<span id="cb42-12"><a href="getting-started.html#cb42-12" tabindex="-1"></a>  <span class="co"># extract coef, se, ci.lower, ci.upper</span></span>
<span id="cb42-13"><a href="getting-started.html#cb42-13" tabindex="-1"></a>  <span class="fu">return</span>(out)</span>
<span id="cb42-14"><a href="getting-started.html#cb42-14" tabindex="-1"></a>}</span>
<span id="cb42-15"><a href="getting-started.html#cb42-15" tabindex="-1"></a></span>
<span id="cb42-16"><a href="getting-started.html#cb42-16" tabindex="-1"></a><span class="co"># matching</span></span>
<span id="cb42-17"><a href="getting-started.html#cb42-17" tabindex="-1"></a>matching <span class="ot">&lt;-</span> <span class="cf">function</span>(data, Y, treat, covar) {</span>
<span id="cb42-18"><a href="getting-started.html#cb42-18" tabindex="-1"></a>  m.out <span class="ot">&lt;-</span> <span class="fu">Match</span>(<span class="at">Y =</span> data[, Y], <span class="at">Tr =</span> data[, treat], <span class="at">X =</span> data[, covar], <span class="at">Z =</span> data[, covar],</span>
<span id="cb42-19"><a href="getting-started.html#cb42-19" tabindex="-1"></a>                 <span class="at">estimand =</span> <span class="st">&quot;ATT&quot;</span>, <span class="at">M =</span> <span class="dv">5</span>, <span class="at">replace =</span> <span class="cn">TRUE</span>, <span class="at">ties =</span> <span class="cn">TRUE</span>, <span class="at">BiasAdjust =</span> <span class="cn">TRUE</span>)</span>
<span id="cb42-20"><a href="getting-started.html#cb42-20" tabindex="-1"></a>  out <span class="ot">&lt;-</span> <span class="fu">c</span>(m.out<span class="sc">$</span>est[<span class="dv">1</span>], m.out<span class="sc">$</span>se[<span class="dv">1</span>], m.out<span class="sc">$</span>est[<span class="dv">1</span>] <span class="sc">-</span> <span class="fl">1.96</span> <span class="sc">*</span> m.out<span class="sc">$</span>se[<span class="dv">1</span>],</span>
<span id="cb42-21"><a href="getting-started.html#cb42-21" tabindex="-1"></a>           m.out<span class="sc">$</span>est[<span class="dv">1</span>] <span class="sc">+</span> <span class="fl">1.96</span> <span class="sc">*</span> m.out<span class="sc">$</span>se[<span class="dv">1</span>])</span>
<span id="cb42-22"><a href="getting-started.html#cb42-22" tabindex="-1"></a>  <span class="fu">return</span>(out)</span>
<span id="cb42-23"><a href="getting-started.html#cb42-23" tabindex="-1"></a>}</span>
<span id="cb42-24"><a href="getting-started.html#cb42-24" tabindex="-1"></a></span>
<span id="cb42-25"><a href="getting-started.html#cb42-25" tabindex="-1"></a><span class="co"># psm</span></span>
<span id="cb42-26"><a href="getting-started.html#cb42-26" tabindex="-1"></a>psm <span class="ot">&lt;-</span> <span class="cf">function</span>(data, Y, treat, covar) {</span>
<span id="cb42-27"><a href="getting-started.html#cb42-27" tabindex="-1"></a>  ps <span class="ot">&lt;-</span> <span class="fu">probability_forest</span>(<span class="at">X =</span> data[, covar],</span>
<span id="cb42-28"><a href="getting-started.html#cb42-28" tabindex="-1"></a>                           <span class="at">Y =</span> <span class="fu">as.factor</span>(data[,treat]), <span class="at">seed =</span> <span class="dv">1234</span>, <span class="at">num.trees =</span> <span class="dv">4000</span>)<span class="sc">$</span>predictions[,<span class="dv">2</span>]</span>
<span id="cb42-29"><a href="getting-started.html#cb42-29" tabindex="-1"></a>  m.out <span class="ot">&lt;-</span> <span class="fu">Match</span>(<span class="at">Y =</span> data[, Y], <span class="at">Tr =</span> data[, treat], <span class="at">X =</span> <span class="fu">matrix</span>(ps, <span class="fu">nrow</span>(data), <span class="dv">1</span>),</span>
<span id="cb42-30"><a href="getting-started.html#cb42-30" tabindex="-1"></a>                 <span class="at">estimand =</span> <span class="st">&quot;ATT&quot;</span>, <span class="at">M =</span> <span class="dv">5</span>, <span class="at">replace =</span> <span class="cn">TRUE</span>, <span class="at">ties =</span> <span class="cn">FALSE</span>, <span class="at">BiasAdjust =</span> <span class="cn">FALSE</span>)</span>
<span id="cb42-31"><a href="getting-started.html#cb42-31" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">is.null</span>(m.out<span class="sc">$</span>se)<span class="sc">==</span><span class="cn">FALSE</span>) {</span>
<span id="cb42-32"><a href="getting-started.html#cb42-32" tabindex="-1"></a>    se <span class="ot">&lt;-</span> m.out<span class="sc">$</span>se[<span class="dv">1</span>]</span>
<span id="cb42-33"><a href="getting-started.html#cb42-33" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb42-34"><a href="getting-started.html#cb42-34" tabindex="-1"></a>    se <span class="ot">&lt;-</span> m.out<span class="sc">$</span>se.standard[<span class="dv">1</span>]</span>
<span id="cb42-35"><a href="getting-started.html#cb42-35" tabindex="-1"></a>  }</span>
<span id="cb42-36"><a href="getting-started.html#cb42-36" tabindex="-1"></a>  out <span class="ot">&lt;-</span> <span class="fu">c</span>(m.out<span class="sc">$</span>est[<span class="dv">1</span>], se, m.out<span class="sc">$</span>est[<span class="dv">1</span>] <span class="sc">-</span> <span class="fl">1.96</span> <span class="sc">*</span> se,</span>
<span id="cb42-37"><a href="getting-started.html#cb42-37" tabindex="-1"></a>           m.out<span class="sc">$</span>est[<span class="dv">1</span>] <span class="sc">+</span> <span class="fl">1.96</span> <span class="sc">*</span> se)</span>
<span id="cb42-38"><a href="getting-started.html#cb42-38" tabindex="-1"></a>  <span class="fu">return</span>(out)</span>
<span id="cb42-39"><a href="getting-started.html#cb42-39" tabindex="-1"></a>}</span>
<span id="cb42-40"><a href="getting-started.html#cb42-40" tabindex="-1"></a></span>
<span id="cb42-41"><a href="getting-started.html#cb42-41" tabindex="-1"></a></span>
<span id="cb42-42"><a href="getting-started.html#cb42-42" tabindex="-1"></a><span class="co"># OM (reg)</span></span>
<span id="cb42-43"><a href="getting-started.html#cb42-43" tabindex="-1"></a>om.reg <span class="ot">&lt;-</span> <span class="cf">function</span>(data, Y, treat, covar) {</span>
<span id="cb42-44"><a href="getting-started.html#cb42-44" tabindex="-1"></a>  tr <span class="ot">&lt;-</span> <span class="fu">which</span>(data[, treat] <span class="sc">==</span> <span class="dv">1</span>)</span>
<span id="cb42-45"><a href="getting-started.html#cb42-45" tabindex="-1"></a>  co <span class="ot">&lt;-</span> <span class="fu">which</span>(data[, treat] <span class="sc">==</span> <span class="dv">0</span>)</span>
<span id="cb42-46"><a href="getting-started.html#cb42-46" tabindex="-1"></a>  fml <span class="ot">&lt;-</span> <span class="fu">as.formula</span>(<span class="fu">paste</span>(Y, <span class="st">&quot;~&quot;</span>, <span class="fu">paste</span>(covar, <span class="at">collapse =</span> <span class="st">&quot; + &quot;</span>)))</span>
<span id="cb42-47"><a href="getting-started.html#cb42-47" tabindex="-1"></a>  out.co <span class="ot">&lt;-</span> <span class="fu">lm</span>(fml, <span class="at">data =</span> data[co, ])</span>
<span id="cb42-48"><a href="getting-started.html#cb42-48" tabindex="-1"></a>  Y.tr.hat <span class="ot">&lt;-</span> <span class="fu">predict</span>(out.co, <span class="at">newdata =</span> data[tr, covar, <span class="at">drop =</span> <span class="cn">FALSE</span>])</span>
<span id="cb42-49"><a href="getting-started.html#cb42-49" tabindex="-1"></a>  newdata <span class="ot">&lt;-</span> <span class="fu">cbind.data.frame</span>(<span class="at">Y =</span> <span class="fu">c</span>(data[tr, Y], Y.tr.hat), <span class="at">treat =</span> <span class="fu">rep</span>(<span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">0</span>), <span class="at">each =</span> <span class="fu">length</span>(tr)))</span>
<span id="cb42-50"><a href="getting-started.html#cb42-50" tabindex="-1"></a>  out <span class="ot">&lt;-</span> <span class="fu">summary</span>(<span class="fu">lm_robust</span>(Y <span class="sc">~</span> treat, <span class="at">data =</span> newdata, <span class="at">se_type =</span> <span class="st">&quot;stata&quot;</span>))<span class="sc">$</span>coefficients[<span class="st">&quot;treat&quot;</span>, <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">5</span>, <span class="dv">6</span>)]</span>
<span id="cb42-51"><a href="getting-started.html#cb42-51" tabindex="-1"></a>  <span class="fu">return</span>(out)</span>
<span id="cb42-52"><a href="getting-started.html#cb42-52" tabindex="-1"></a>}</span>
<span id="cb42-53"><a href="getting-started.html#cb42-53" tabindex="-1"></a></span>
<span id="cb42-54"><a href="getting-started.html#cb42-54" tabindex="-1"></a><span class="co"># OM (grf)</span></span>
<span id="cb42-55"><a href="getting-started.html#cb42-55" tabindex="-1"></a>om.grf <span class="ot">&lt;-</span> <span class="cf">function</span>(data, Y, treat, covar) {</span>
<span id="cb42-56"><a href="getting-started.html#cb42-56" tabindex="-1"></a>  tr <span class="ot">&lt;-</span> <span class="fu">which</span>(data[, treat] <span class="sc">==</span> <span class="dv">1</span>)</span>
<span id="cb42-57"><a href="getting-started.html#cb42-57" tabindex="-1"></a>  co <span class="ot">&lt;-</span> <span class="fu">which</span>(data[, treat] <span class="sc">==</span> <span class="dv">0</span>)</span>
<span id="cb42-58"><a href="getting-started.html#cb42-58" tabindex="-1"></a>  out.co <span class="ot">&lt;-</span> <span class="fu">regression_forest</span>(<span class="at">X =</span> data[co, covar, <span class="at">drop =</span> <span class="cn">FALSE</span>], <span class="at">Y =</span> <span class="fu">as.vector</span>(data[co, Y]) )</span>
<span id="cb42-59"><a href="getting-started.html#cb42-59" tabindex="-1"></a>  Y.tr.hat <span class="ot">&lt;-</span> <span class="fu">as.vector</span>(<span class="fu">unlist</span>(<span class="fu">predict</span>(out.co, <span class="at">newdata =</span> data[tr, covar, <span class="at">drop =</span> <span class="cn">FALSE</span>])))</span>
<span id="cb42-60"><a href="getting-started.html#cb42-60" tabindex="-1"></a>  newdata <span class="ot">&lt;-</span> <span class="fu">cbind.data.frame</span>(<span class="at">Y =</span> <span class="fu">c</span>(data[tr, Y], Y.tr.hat), <span class="at">treat =</span> <span class="fu">rep</span>(<span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">0</span>), <span class="at">each =</span> <span class="fu">length</span>(tr)))</span>
<span id="cb42-61"><a href="getting-started.html#cb42-61" tabindex="-1"></a>  out <span class="ot">&lt;-</span> <span class="fu">summary</span>(<span class="fu">lm_robust</span>(Y <span class="sc">~</span> treat, <span class="at">data =</span> newdata, <span class="at">se_type =</span> <span class="st">&quot;stata&quot;</span>))<span class="sc">$</span>coefficients[<span class="st">&quot;treat&quot;</span>, <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">5</span>, <span class="dv">6</span>)]</span>
<span id="cb42-62"><a href="getting-started.html#cb42-62" tabindex="-1"></a>  <span class="fu">return</span>(out)</span>
<span id="cb42-63"><a href="getting-started.html#cb42-63" tabindex="-1"></a>}</span>
<span id="cb42-64"><a href="getting-started.html#cb42-64" tabindex="-1"></a></span>
<span id="cb42-65"><a href="getting-started.html#cb42-65" tabindex="-1"></a><span class="co"># IPW</span></span>
<span id="cb42-66"><a href="getting-started.html#cb42-66" tabindex="-1"></a>ipw <span class="ot">&lt;-</span> <span class="cf">function</span>(data, Y, treat, covar) {</span>
<span id="cb42-67"><a href="getting-started.html#cb42-67" tabindex="-1"></a>  ps <span class="ot">&lt;-</span> <span class="fu">probability_forest</span>(<span class="at">X =</span> data[, covar, <span class="at">drop =</span> <span class="cn">FALSE</span>], <span class="at">Y =</span> <span class="fu">as.factor</span>(data[, treat]), <span class="at">seed =</span> <span class="dv">1234</span>)<span class="sc">$</span>predictions[,<span class="dv">2</span>]</span>
<span id="cb42-68"><a href="getting-started.html#cb42-68" tabindex="-1"></a>  fml <span class="ot">&lt;-</span> <span class="fu">as.formula</span>(<span class="fu">paste</span>(Y, <span class="st">&quot;~&quot;</span>, treat))</span>
<span id="cb42-69"><a href="getting-started.html#cb42-69" tabindex="-1"></a>  weights <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="dv">1</span>, <span class="fu">nrow</span>(data))</span>
<span id="cb42-70"><a href="getting-started.html#cb42-70" tabindex="-1"></a>  co <span class="ot">&lt;-</span> <span class="fu">which</span>(data[, treat] <span class="sc">==</span> <span class="dv">0</span>)</span>
<span id="cb42-71"><a href="getting-started.html#cb42-71" tabindex="-1"></a>  weights[co] <span class="ot">&lt;-</span> ps[co]<span class="sc">/</span>(<span class="dv">1</span><span class="sc">-</span>ps[co])</span>
<span id="cb42-72"><a href="getting-started.html#cb42-72" tabindex="-1"></a>  out <span class="ot">&lt;-</span> <span class="fu">summary</span>(<span class="fu">lm_robust</span>(fml, <span class="at">data =</span> data, <span class="at">weights =</span> weights, <span class="at">se_type =</span> <span class="st">&quot;stata&quot;</span>))<span class="sc">$</span>coefficients[treat, <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">5</span>, <span class="dv">6</span>)]</span>
<span id="cb42-73"><a href="getting-started.html#cb42-73" tabindex="-1"></a>  <span class="co"># extract coef, se, ci.lower, ci.upper</span></span>
<span id="cb42-74"><a href="getting-started.html#cb42-74" tabindex="-1"></a>  <span class="fu">return</span>(out)</span>
<span id="cb42-75"><a href="getting-started.html#cb42-75" tabindex="-1"></a>}</span>
<span id="cb42-76"><a href="getting-started.html#cb42-76" tabindex="-1"></a></span>
<span id="cb42-77"><a href="getting-started.html#cb42-77" tabindex="-1"></a></span>
<span id="cb42-78"><a href="getting-started.html#cb42-78" tabindex="-1"></a><span class="co"># CBPS</span></span>
<span id="cb42-79"><a href="getting-started.html#cb42-79" tabindex="-1"></a><span class="co">#library(&quot;CBPS&quot;)</span></span>
<span id="cb42-80"><a href="getting-started.html#cb42-80" tabindex="-1"></a>cbps <span class="ot">&lt;-</span> <span class="cf">function</span>(data, Y, treat, covar) {</span>
<span id="cb42-81"><a href="getting-started.html#cb42-81" tabindex="-1"></a>  fml <span class="ot">&lt;-</span> <span class="fu">as.formula</span>(<span class="fu">paste</span>(treat, <span class="st">&quot;~&quot;</span>, <span class="fu">paste</span>(covar, <span class="at">collapse =</span> <span class="st">&quot; + &quot;</span>)))</span>
<span id="cb42-82"><a href="getting-started.html#cb42-82" tabindex="-1"></a>  ps <span class="ot">&lt;-</span> <span class="fu">quiet</span>(<span class="fu">CBPS</span>(fml, <span class="at">data =</span> data, <span class="at">standardize =</span> <span class="cn">TRUE</span>)<span class="sc">$</span>fitted.values)</span>
<span id="cb42-83"><a href="getting-started.html#cb42-83" tabindex="-1"></a>  fml <span class="ot">&lt;-</span> <span class="fu">as.formula</span>(<span class="fu">paste</span>(Y, <span class="st">&quot;~&quot;</span>, treat))</span>
<span id="cb42-84"><a href="getting-started.html#cb42-84" tabindex="-1"></a>  weights <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="dv">1</span>, <span class="fu">nrow</span>(data))</span>
<span id="cb42-85"><a href="getting-started.html#cb42-85" tabindex="-1"></a>  co <span class="ot">&lt;-</span> <span class="fu">which</span>(data[, treat] <span class="sc">==</span> <span class="dv">0</span>)</span>
<span id="cb42-86"><a href="getting-started.html#cb42-86" tabindex="-1"></a>  weights[co] <span class="ot">&lt;-</span> ps[co]<span class="sc">/</span>(<span class="dv">1</span><span class="sc">-</span>ps[co])</span>
<span id="cb42-87"><a href="getting-started.html#cb42-87" tabindex="-1"></a>  out <span class="ot">&lt;-</span> <span class="fu">summary</span>(<span class="fu">lm_robust</span>(fml, <span class="at">data =</span> data, <span class="at">weights =</span> weights, <span class="at">se_type =</span> <span class="st">&quot;stata&quot;</span>))<span class="sc">$</span>coefficients[treat, <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">5</span>, <span class="dv">6</span>)]</span>
<span id="cb42-88"><a href="getting-started.html#cb42-88" tabindex="-1"></a>  <span class="fu">return</span>(out)</span>
<span id="cb42-89"><a href="getting-started.html#cb42-89" tabindex="-1"></a>}</span>
<span id="cb42-90"><a href="getting-started.html#cb42-90" tabindex="-1"></a></span>
<span id="cb42-91"><a href="getting-started.html#cb42-91" tabindex="-1"></a><span class="co"># ebal</span></span>
<span id="cb42-92"><a href="getting-started.html#cb42-92" tabindex="-1"></a><span class="co">#library(hbal)</span></span>
<span id="cb42-93"><a href="getting-started.html#cb42-93" tabindex="-1"></a>ebal <span class="ot">&lt;-</span> <span class="cf">function</span>(data, Y, treat, covar) {</span>
<span id="cb42-94"><a href="getting-started.html#cb42-94" tabindex="-1"></a>  ebal.out <span class="ot">&lt;-</span> hbal<span class="sc">::</span><span class="fu">hbal</span>(<span class="at">Y =</span> Y, <span class="at">Treat =</span> treat, <span class="at">X =</span> covar,  <span class="at">data =</span> data, <span class="at">expand.degree =</span> <span class="dv">1</span>)</span>
<span id="cb42-95"><a href="getting-started.html#cb42-95" tabindex="-1"></a>  out <span class="ot">&lt;-</span> hbal<span class="sc">::</span><span class="fu">att</span>(ebal.out, <span class="at">dr =</span> <span class="cn">FALSE</span>)[<span class="dv">1</span>, <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">5</span>, <span class="dv">6</span>)]</span>
<span id="cb42-96"><a href="getting-started.html#cb42-96" tabindex="-1"></a>  <span class="fu">return</span>(out)</span>
<span id="cb42-97"><a href="getting-started.html#cb42-97" tabindex="-1"></a>}</span>
<span id="cb42-98"><a href="getting-started.html#cb42-98" tabindex="-1"></a></span>
<span id="cb42-99"><a href="getting-started.html#cb42-99" tabindex="-1"></a><span class="co"># hbal</span></span>
<span id="cb42-100"><a href="getting-started.html#cb42-100" tabindex="-1"></a><span class="co"># hbal &lt;- function(data, Y, treat, covar) {</span></span>
<span id="cb42-101"><a href="getting-started.html#cb42-101" tabindex="-1"></a><span class="co">#   hbal.out &lt;- hbal::hbal(Y = Y, Treat = treat, X = covar,  data = data, expand.degree = 2, # cv = TRUE)</span></span>
<span id="cb42-102"><a href="getting-started.html#cb42-102" tabindex="-1"></a><span class="co">#   out &lt;- hbal::att(hbal.out, dr = FALSE)[1, c(1, 2, 5, 6)]</span></span>
<span id="cb42-103"><a href="getting-started.html#cb42-103" tabindex="-1"></a><span class="co">#   return(out)</span></span>
<span id="cb42-104"><a href="getting-started.html#cb42-104" tabindex="-1"></a><span class="co"># }</span></span>
<span id="cb42-105"><a href="getting-started.html#cb42-105" tabindex="-1"></a></span>
<span id="cb42-106"><a href="getting-started.html#cb42-106" tabindex="-1"></a><span class="co"># aipw_grf</span></span>
<span id="cb42-107"><a href="getting-started.html#cb42-107" tabindex="-1"></a>aipw <span class="ot">&lt;-</span> <span class="cf">function</span>(data, Y, treat, covar) {</span>
<span id="cb42-108"><a href="getting-started.html#cb42-108" tabindex="-1"></a>  <span class="co">#library(&quot;grf&quot;)</span></span>
<span id="cb42-109"><a href="getting-started.html#cb42-109" tabindex="-1"></a>  <span class="cf">for</span> (var <span class="cf">in</span> <span class="fu">c</span>(Y, treat, covar)) {</span>
<span id="cb42-110"><a href="getting-started.html#cb42-110" tabindex="-1"></a>    data[, var] <span class="ot">&lt;-</span> <span class="fu">as.vector</span>(data[, var])</span>
<span id="cb42-111"><a href="getting-started.html#cb42-111" tabindex="-1"></a>  }</span>
<span id="cb42-112"><a href="getting-started.html#cb42-112" tabindex="-1"></a>  c.forest <span class="ot">&lt;-</span> <span class="fu">causal_forest</span>(<span class="at">X =</span> data[, covar, <span class="at">drop =</span> <span class="cn">FALSE</span>], <span class="at">Y =</span> data[, Y],</span>
<span id="cb42-113"><a href="getting-started.html#cb42-113" tabindex="-1"></a>                            <span class="at">W =</span> data[, treat], <span class="at">seed =</span> <span class="dv">1234</span>)</span>
<span id="cb42-114"><a href="getting-started.html#cb42-114" tabindex="-1"></a>  att <span class="ot">&lt;-</span> <span class="fu">average_treatment_effect</span>(c.forest, <span class="at">target.sample =</span> <span class="st">&quot;treated&quot;</span>, <span class="at">method =</span> <span class="st">&quot;AIPW&quot;</span>)</span>
<span id="cb42-115"><a href="getting-started.html#cb42-115" tabindex="-1"></a>  att <span class="ot">&lt;-</span> <span class="fu">c</span>(att, att[<span class="dv">1</span>] <span class="sc">-</span> <span class="fl">1.96</span> <span class="sc">*</span> att[<span class="dv">2</span>], att[<span class="dv">1</span>] <span class="sc">+</span> <span class="fl">1.96</span> <span class="sc">*</span> att[<span class="dv">2</span>])</span>
<span id="cb42-116"><a href="getting-started.html#cb42-116" tabindex="-1"></a>  <span class="fu">return</span>(att)</span>
<span id="cb42-117"><a href="getting-started.html#cb42-117" tabindex="-1"></a>}</span>
<span id="cb42-118"><a href="getting-started.html#cb42-118" tabindex="-1"></a></span>
<span id="cb42-119"><a href="getting-started.html#cb42-119" tabindex="-1"></a>aipw.match <span class="ot">&lt;-</span> <span class="cf">function</span>(data, Y, treat, covar) { <span class="co"># match on ps</span></span>
<span id="cb42-120"><a href="getting-started.html#cb42-120" tabindex="-1"></a>  ps <span class="ot">&lt;-</span> <span class="fu">probability_forest</span>(<span class="at">X =</span> data[, covar], <span class="at">Y =</span> <span class="fu">as.factor</span>(data[, treat]), <span class="at">seed =</span> <span class="dv">1234</span>)<span class="sc">$</span>predictions[,<span class="dv">2</span>]</span>
<span id="cb42-121"><a href="getting-started.html#cb42-121" tabindex="-1"></a>  m.out <span class="ot">&lt;-</span> <span class="fu">Match</span>(<span class="at">Y =</span> data[, Y], <span class="at">Tr =</span> data[, treat], <span class="at">X =</span> ps,</span>
<span id="cb42-122"><a href="getting-started.html#cb42-122" tabindex="-1"></a>                 <span class="at">estimand =</span> <span class="st">&quot;ATT&quot;</span>, <span class="at">M =</span> <span class="dv">1</span>, <span class="at">replace =</span> <span class="cn">FALSE</span>, <span class="at">ties =</span> <span class="cn">FALSE</span>, <span class="at">BiasAdjust =</span> <span class="cn">FALSE</span>)</span>
<span id="cb42-123"><a href="getting-started.html#cb42-123" tabindex="-1"></a>  mb <span class="ot">&lt;-</span> <span class="fu">quiet</span>(<span class="fu">MatchBalance</span>(treat <span class="sc">~</span> ps, <span class="at">data =</span> data, <span class="at">match.out =</span> m.out, <span class="at">nboots=</span> <span class="dv">0</span>))</span>
<span id="cb42-124"><a href="getting-started.html#cb42-124" tabindex="-1"></a>  ks <span class="ot">&lt;-</span> mb<span class="sc">$</span>AfterMatching[[<span class="dv">1</span>]]<span class="sc">$</span>ks<span class="sc">$</span>ks<span class="sc">$</span>statistic</span>
<span id="cb42-125"><a href="getting-started.html#cb42-125" tabindex="-1"></a>  s <span class="ot">&lt;-</span> data[<span class="fu">c</span>(m.out<span class="sc">$</span>index.treated, m.out<span class="sc">$</span>index.control), ]</span>
<span id="cb42-126"><a href="getting-started.html#cb42-126" tabindex="-1"></a>  out <span class="ot">&lt;-</span> <span class="fu">aipw</span>(s, Y, treat, covar)</span>
<span id="cb42-127"><a href="getting-started.html#cb42-127" tabindex="-1"></a>  <span class="co">#return(out)</span></span>
<span id="cb42-128"><a href="getting-started.html#cb42-128" tabindex="-1"></a>  <span class="fu">return</span>(<span class="fu">c</span>(out, ks))</span>
<span id="cb42-129"><a href="getting-started.html#cb42-129" tabindex="-1"></a>}</span>
<span id="cb42-130"><a href="getting-started.html#cb42-130" tabindex="-1"></a></span>
<span id="cb42-131"><a href="getting-started.html#cb42-131" tabindex="-1"></a>aipw_ow <span class="ot">&lt;-</span> <span class="cf">function</span>(data, Y, treat, covar) {</span>
<span id="cb42-132"><a href="getting-started.html#cb42-132" tabindex="-1"></a>  <span class="cf">for</span> (var <span class="cf">in</span> <span class="fu">c</span>(Y, treat, covar)) {</span>
<span id="cb42-133"><a href="getting-started.html#cb42-133" tabindex="-1"></a>    data[, var] <span class="ot">&lt;-</span> <span class="fu">as.vector</span>(data[, var])</span>
<span id="cb42-134"><a href="getting-started.html#cb42-134" tabindex="-1"></a>  }</span>
<span id="cb42-135"><a href="getting-started.html#cb42-135" tabindex="-1"></a>  X <span class="ot">&lt;-</span> data[, covar, drop <span class="ot">=</span> <span class="cn">FALSE</span>]</span>
<span id="cb42-136"><a href="getting-started.html#cb42-136" tabindex="-1"></a>  Y <span class="ot">&lt;-</span> data[, Y]</span>
<span id="cb42-137"><a href="getting-started.html#cb42-137" tabindex="-1"></a>  W <span class="ot">&lt;-</span> data[, treat]</span>
<span id="cb42-138"><a href="getting-started.html#cb42-138" tabindex="-1"></a>  <span class="co"># run dml_with_smoother with AIPW_ATT</span></span>
<span id="cb42-139"><a href="getting-started.html#cb42-139" tabindex="-1"></a>  dml_fit <span class="ot">&lt;-</span> <span class="fu">dml_with_smoother</span>(<span class="at">Y =</span> Y, <span class="at">D =</span> W, <span class="at">X =</span> X,</span>
<span id="cb42-140"><a href="getting-started.html#cb42-140" tabindex="-1"></a>                               <span class="at">estimators =</span> <span class="fu">c</span>(<span class="st">&quot;AIPW_ATT&quot;</span>),</span>
<span id="cb42-141"><a href="getting-started.html#cb42-141" tabindex="-1"></a>                               <span class="at">smoother =</span> <span class="st">&quot;honest_forest&quot;</span>,</span>
<span id="cb42-142"><a href="getting-started.html#cb42-142" tabindex="-1"></a>                               <span class="at">n_cf_folds =</span> <span class="dv">5</span>,</span>
<span id="cb42-143"><a href="getting-started.html#cb42-143" tabindex="-1"></a>                               <span class="at">n_reps =</span> <span class="dv">1</span>)</span>
<span id="cb42-144"><a href="getting-started.html#cb42-144" tabindex="-1"></a>  <span class="co"># extract estimate and SE from summary</span></span>
<span id="cb42-145"><a href="getting-started.html#cb42-145" tabindex="-1"></a>  summ <span class="ot">&lt;-</span> <span class="fu">summary</span>(dml_fit, <span class="at">quiet =</span> <span class="cn">TRUE</span>)</span>
<span id="cb42-146"><a href="getting-started.html#cb42-146" tabindex="-1"></a>  est <span class="ot">&lt;-</span> summ[<span class="st">&quot;AIPW-ATT&quot;</span>, <span class="st">&quot;Estimate&quot;</span>]</span>
<span id="cb42-147"><a href="getting-started.html#cb42-147" tabindex="-1"></a>  se <span class="ot">&lt;-</span> summ[<span class="st">&quot;AIPW-ATT&quot;</span>, <span class="st">&quot;SE&quot;</span>]</span>
<span id="cb42-148"><a href="getting-started.html#cb42-148" tabindex="-1"></a>  ci_lower <span class="ot">&lt;-</span> est <span class="sc">-</span> <span class="fl">1.96</span> <span class="sc">*</span> se</span>
<span id="cb42-149"><a href="getting-started.html#cb42-149" tabindex="-1"></a>  ci_upper <span class="ot">&lt;-</span> est <span class="sc">+</span> <span class="fl">1.96</span> <span class="sc">*</span> se</span>
<span id="cb42-150"><a href="getting-started.html#cb42-150" tabindex="-1"></a>  <span class="fu">return</span>(<span class="fu">c</span>(est, se, ci_lower, ci_upper))</span>
<span id="cb42-151"><a href="getting-started.html#cb42-151" tabindex="-1"></a>}</span>
<span id="cb42-152"><a href="getting-started.html#cb42-152" tabindex="-1"></a></span>
<span id="cb42-153"><a href="getting-started.html#cb42-153" tabindex="-1"></a><span class="do">### dml</span></span>
<span id="cb42-154"><a href="getting-started.html#cb42-154" tabindex="-1"></a>dml <span class="ot">&lt;-</span><span class="cf">function</span>(data, <span class="at">Y =</span> <span class="cn">NULL</span>, <span class="at">treat =</span> <span class="cn">NULL</span>, <span class="at">covar =</span> <span class="cn">NULL</span>, <span class="at">clust_var =</span> <span class="cn">NULL</span>, <span class="at">ml_l =</span> <span class="fu">lrn</span>(<span class="st">&quot;regr.lm&quot;</span>), <span class="at">ml_m =</span> <span class="fu">lrn</span>(<span class="st">&quot;regr.lm&quot;</span>)){</span>
<span id="cb42-155"><a href="getting-started.html#cb42-155" tabindex="-1"></a>  <span class="cf">if</span>(<span class="fu">is.null</span>(covar)){</span>
<span id="cb42-156"><a href="getting-started.html#cb42-156" tabindex="-1"></a>    <span class="fu">stop</span>(<span class="st">&quot;No controls in specification.&quot;</span>)</span>
<span id="cb42-157"><a href="getting-started.html#cb42-157" tabindex="-1"></a>  }</span>
<span id="cb42-158"><a href="getting-started.html#cb42-158" tabindex="-1"></a>  <span class="co">#require(DoubleML)</span></span>
<span id="cb42-159"><a href="getting-started.html#cb42-159" tabindex="-1"></a>  <span class="co">#require(mlr3learners)</span></span>
<span id="cb42-160"><a href="getting-started.html#cb42-160" tabindex="-1"></a>  <span class="co">#require(fixest)</span></span>
<span id="cb42-161"><a href="getting-started.html#cb42-161" tabindex="-1"></a>  <span class="co">#require(ggplot2)</span></span>
<span id="cb42-162"><a href="getting-started.html#cb42-162" tabindex="-1"></a>  <span class="cf">if</span>(<span class="fu">is.null</span>(clust_var) <span class="sc">==</span> <span class="cn">TRUE</span>){</span>
<span id="cb42-163"><a href="getting-started.html#cb42-163" tabindex="-1"></a>    dat <span class="ot">=</span> data[,<span class="fu">c</span>(Y,treat,covar)]</span>
<span id="cb42-164"><a href="getting-started.html#cb42-164" tabindex="-1"></a>    dat <span class="ot">=</span> <span class="fu">na.omit</span>(dat)</span>
<span id="cb42-165"><a href="getting-started.html#cb42-165" tabindex="-1"></a>    dml_dat <span class="ot">=</span> DoubleMLData<span class="sc">$</span><span class="fu">new</span>(dat,</span>
<span id="cb42-166"><a href="getting-started.html#cb42-166" tabindex="-1"></a>                               <span class="at">y_col =</span> Y,</span>
<span id="cb42-167"><a href="getting-started.html#cb42-167" tabindex="-1"></a>                               <span class="at">d_cols =</span> treat,</span>
<span id="cb42-168"><a href="getting-started.html#cb42-168" tabindex="-1"></a>                               <span class="at">use_other_treat_as_covariate =</span> <span class="cn">FALSE</span>,</span>
<span id="cb42-169"><a href="getting-started.html#cb42-169" tabindex="-1"></a>                               <span class="at">x_cols =</span> covar)</span>
<span id="cb42-170"><a href="getting-started.html#cb42-170" tabindex="-1"></a>  }<span class="cf">else</span>{</span>
<span id="cb42-171"><a href="getting-started.html#cb42-171" tabindex="-1"></a>    dat <span class="ot">=</span> data[,<span class="fu">c</span>(Y, treat, covar, clust_var)]</span>
<span id="cb42-172"><a href="getting-started.html#cb42-172" tabindex="-1"></a>    dat[,clust_var] <span class="ot">=</span> <span class="fu">as.numeric</span>(<span class="fu">factor</span>(dat[,clust_var]))</span>
<span id="cb42-173"><a href="getting-started.html#cb42-173" tabindex="-1"></a>    dat <span class="ot">=</span> dat[<span class="fu">is.na</span>(dat[,Y]) <span class="sc">==</span> <span class="cn">FALSE</span>,]</span>
<span id="cb42-174"><a href="getting-started.html#cb42-174" tabindex="-1"></a>    dat <span class="ot">=</span> dat[<span class="fu">is.na</span>(dat[,D]) <span class="sc">==</span> <span class="cn">FALSE</span>,]</span>
<span id="cb42-175"><a href="getting-started.html#cb42-175" tabindex="-1"></a>    features <span class="ot">=</span> <span class="fu">data.frame</span>(<span class="fu">model.matrix</span>(<span class="fu">formula</span>(<span class="fu">paste</span>(<span class="fu">c</span>(<span class="st">&#39;~ 1&#39;</span>,treat,covar), <span class="at">collapse=</span><span class="st">&quot;+&quot;</span>)), dat))</span>
<span id="cb42-176"><a href="getting-started.html#cb42-176" tabindex="-1"></a>    dat <span class="ot">=</span> <span class="fu">cbind</span>(dat[,<span class="fu">c</span>(Y,clust_var)],features)</span>
<span id="cb42-177"><a href="getting-started.html#cb42-177" tabindex="-1"></a>    dml_dat <span class="ot">=</span> DoubleMLClusterData<span class="sc">$</span><span class="fu">new</span>(dat,</span>
<span id="cb42-178"><a href="getting-started.html#cb42-178" tabindex="-1"></a>                                      <span class="at">y_col =</span> Y,</span>
<span id="cb42-179"><a href="getting-started.html#cb42-179" tabindex="-1"></a>                                      <span class="at">d_cols =</span> treat,</span>
<span id="cb42-180"><a href="getting-started.html#cb42-180" tabindex="-1"></a>                                      <span class="at">cluster_cols =</span> clust_var,</span>
<span id="cb42-181"><a href="getting-started.html#cb42-181" tabindex="-1"></a>                                      <span class="at">use_other_treat_as_covariate =</span> <span class="cn">FALSE</span>,</span>
<span id="cb42-182"><a href="getting-started.html#cb42-182" tabindex="-1"></a>                                      <span class="at">x_cols =</span> covar)</span>
<span id="cb42-183"><a href="getting-started.html#cb42-183" tabindex="-1"></a>  }</span>
<span id="cb42-184"><a href="getting-started.html#cb42-184" tabindex="-1"></a>  <span class="co"># Set active treatment treatment</span></span>
<span id="cb42-185"><a href="getting-started.html#cb42-185" tabindex="-1"></a>  dml_dat<span class="sc">$</span><span class="fu">set_data_model</span>(treat)</span>
<span id="cb42-186"><a href="getting-started.html#cb42-186" tabindex="-1"></a>  <span class="co"># Estimate with DML</span></span>
<span id="cb42-187"><a href="getting-started.html#cb42-187" tabindex="-1"></a>  <span class="fu">set.seed</span>(pi)</span>
<span id="cb42-188"><a href="getting-started.html#cb42-188" tabindex="-1"></a>  dml_mod <span class="ot">=</span> DoubleMLPLR<span class="sc">$</span><span class="fu">new</span>(dml_dat, <span class="at">ml_l=</span>ml_l, <span class="at">ml_m=</span>ml_m)</span>
<span id="cb42-189"><a href="getting-started.html#cb42-189" tabindex="-1"></a>  <span class="fu">quiet</span>(dml_mod<span class="sc">$</span><span class="fu">fit</span>())</span>
<span id="cb42-190"><a href="getting-started.html#cb42-190" tabindex="-1"></a>  out <span class="ot">=</span> <span class="fu">c</span>(dml_mod<span class="sc">$</span>coef[treat], dml_mod<span class="sc">$</span>se[treat], dml_mod<span class="sc">$</span><span class="fu">confint</span>()[treat,])</span>
<span id="cb42-191"><a href="getting-started.html#cb42-191" tabindex="-1"></a>  <span class="fu">return</span>(out)</span>
<span id="cb42-192"><a href="getting-started.html#cb42-192" tabindex="-1"></a>  </span>
<span id="cb42-193"><a href="getting-started.html#cb42-193" tabindex="-1"></a>}</span>
<span id="cb42-194"><a href="getting-started.html#cb42-194" tabindex="-1"></a></span>
<span id="cb42-195"><a href="getting-started.html#cb42-195" tabindex="-1"></a><span class="co"># execute all estimators</span></span>
<span id="cb42-196"><a href="getting-started.html#cb42-196" tabindex="-1"></a>estimate_all <span class="ot">&lt;-</span> <span class="cf">function</span>(data, Y, treat, covar, </span>
<span id="cb42-197"><a href="getting-started.html#cb42-197" tabindex="-1"></a>                         <span class="at">methods =</span> <span class="fu">c</span>(<span class="st">&quot;diff&quot;</span>, <span class="st">&quot;reg&quot;</span>, <span class="st">&quot;om.reg&quot;</span>, <span class="st">&quot;om.grf&quot;</span>,</span>
<span id="cb42-198"><a href="getting-started.html#cb42-198" tabindex="-1"></a>                                     <span class="st">&quot;matching&quot;</span>, <span class="st">&quot;psm&quot;</span>, <span class="st">&quot;ipw&quot;</span>, <span class="st">&quot;cbps&quot;</span>, <span class="st">&quot;ebal&quot;</span>, </span>
<span id="cb42-199"><a href="getting-started.html#cb42-199" tabindex="-1"></a>                                     <span class="st">&quot;dml&quot;</span>, <span class="st">&quot;aipw_grf&quot;</span>, <span class="st">&quot;aipw_ow&quot;</span>)) {</span>
<span id="cb42-200"><a href="getting-started.html#cb42-200" tabindex="-1"></a>  </span>
<span id="cb42-201"><a href="getting-started.html#cb42-201" tabindex="-1"></a>  results <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(<span class="fu">matrix</span>(<span class="cn">NA</span>, <span class="fu">length</span>(methods), <span class="dv">4</span>))</span>
<span id="cb42-202"><a href="getting-started.html#cb42-202" tabindex="-1"></a>  <span class="fu">rownames</span>(results) <span class="ot">&lt;-</span> methods</span>
<span id="cb42-203"><a href="getting-started.html#cb42-203" tabindex="-1"></a>  <span class="fu">colnames</span>(results) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;Estimate&quot;</span>, <span class="st">&quot;SE&quot;</span>, <span class="st">&quot;CI_lower&quot;</span>, <span class="st">&quot;CI_upper&quot;</span>)</span>
<span id="cb42-204"><a href="getting-started.html#cb42-204" tabindex="-1"></a>  m <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb42-205"><a href="getting-started.html#cb42-205" tabindex="-1"></a>  <span class="cf">if</span> (<span class="st">&quot;diff&quot;</span> <span class="sc">%in%</span> methods) {</span>
<span id="cb42-206"><a href="getting-started.html#cb42-206" tabindex="-1"></a>    results[m, ] <span class="ot">&lt;-</span> <span class="fu">diff</span>(data, Y, treat) </span>
<span id="cb42-207"><a href="getting-started.html#cb42-207" tabindex="-1"></a>    m <span class="ot">&lt;-</span> m <span class="sc">+</span> <span class="dv">1</span></span>
<span id="cb42-208"><a href="getting-started.html#cb42-208" tabindex="-1"></a>  }</span>
<span id="cb42-209"><a href="getting-started.html#cb42-209" tabindex="-1"></a>  <span class="cf">if</span> (<span class="st">&quot;reg&quot;</span> <span class="sc">%in%</span> methods) {</span>
<span id="cb42-210"><a href="getting-started.html#cb42-210" tabindex="-1"></a>    results[m, ] <span class="ot">&lt;-</span> <span class="fu">reg</span>(data, Y, treat, covar) </span>
<span id="cb42-211"><a href="getting-started.html#cb42-211" tabindex="-1"></a>    m <span class="ot">&lt;-</span> m <span class="sc">+</span> <span class="dv">1</span></span>
<span id="cb42-212"><a href="getting-started.html#cb42-212" tabindex="-1"></a>  }</span>
<span id="cb42-213"><a href="getting-started.html#cb42-213" tabindex="-1"></a>  <span class="cf">if</span> (<span class="st">&quot;om.reg&quot;</span> <span class="sc">%in%</span> methods) {</span>
<span id="cb42-214"><a href="getting-started.html#cb42-214" tabindex="-1"></a>    results[m, ] <span class="ot">&lt;-</span> <span class="fu">om.reg</span>(data, Y, treat, covar) </span>
<span id="cb42-215"><a href="getting-started.html#cb42-215" tabindex="-1"></a>    m <span class="ot">&lt;-</span> m <span class="sc">+</span> <span class="dv">1</span></span>
<span id="cb42-216"><a href="getting-started.html#cb42-216" tabindex="-1"></a>  }</span>
<span id="cb42-217"><a href="getting-started.html#cb42-217" tabindex="-1"></a>  <span class="cf">if</span> (<span class="st">&quot;om.grf&quot;</span> <span class="sc">%in%</span> methods) {</span>
<span id="cb42-218"><a href="getting-started.html#cb42-218" tabindex="-1"></a>    results[m, ] <span class="ot">&lt;-</span> <span class="fu">om.grf</span>(data, Y, treat, covar) </span>
<span id="cb42-219"><a href="getting-started.html#cb42-219" tabindex="-1"></a>    m <span class="ot">&lt;-</span> m <span class="sc">+</span> <span class="dv">1</span></span>
<span id="cb42-220"><a href="getting-started.html#cb42-220" tabindex="-1"></a>  } </span>
<span id="cb42-221"><a href="getting-started.html#cb42-221" tabindex="-1"></a>  <span class="cf">if</span> (<span class="st">&quot;matching&quot;</span> <span class="sc">%in%</span> methods) {</span>
<span id="cb42-222"><a href="getting-started.html#cb42-222" tabindex="-1"></a>    results[m, ] <span class="ot">&lt;-</span> <span class="fu">matching</span>(data, Y, treat, covar) </span>
<span id="cb42-223"><a href="getting-started.html#cb42-223" tabindex="-1"></a>    m <span class="ot">&lt;-</span> m <span class="sc">+</span> <span class="dv">1</span></span>
<span id="cb42-224"><a href="getting-started.html#cb42-224" tabindex="-1"></a>  }</span>
<span id="cb42-225"><a href="getting-started.html#cb42-225" tabindex="-1"></a>  <span class="cf">if</span> (<span class="st">&quot;psm&quot;</span> <span class="sc">%in%</span> methods) {</span>
<span id="cb42-226"><a href="getting-started.html#cb42-226" tabindex="-1"></a>    results[m, ] <span class="ot">&lt;-</span> <span class="fu">psm</span>(data, Y, treat, covar) </span>
<span id="cb42-227"><a href="getting-started.html#cb42-227" tabindex="-1"></a>    m <span class="ot">&lt;-</span> m <span class="sc">+</span> <span class="dv">1</span></span>
<span id="cb42-228"><a href="getting-started.html#cb42-228" tabindex="-1"></a>  }  </span>
<span id="cb42-229"><a href="getting-started.html#cb42-229" tabindex="-1"></a>  <span class="cf">if</span> (<span class="st">&quot;ipw&quot;</span> <span class="sc">%in%</span> methods) {</span>
<span id="cb42-230"><a href="getting-started.html#cb42-230" tabindex="-1"></a>    results[m, ] <span class="ot">&lt;-</span> <span class="fu">ipw</span>(data, Y, treat, covar) </span>
<span id="cb42-231"><a href="getting-started.html#cb42-231" tabindex="-1"></a>    m <span class="ot">&lt;-</span> m <span class="sc">+</span> <span class="dv">1</span></span>
<span id="cb42-232"><a href="getting-started.html#cb42-232" tabindex="-1"></a>  }</span>
<span id="cb42-233"><a href="getting-started.html#cb42-233" tabindex="-1"></a>  <span class="cf">if</span> (<span class="st">&quot;cbps&quot;</span> <span class="sc">%in%</span> methods) {</span>
<span id="cb42-234"><a href="getting-started.html#cb42-234" tabindex="-1"></a>    results[m, ] <span class="ot">&lt;-</span> <span class="fu">cbps</span>(data, Y, treat, covar) </span>
<span id="cb42-235"><a href="getting-started.html#cb42-235" tabindex="-1"></a>    m <span class="ot">&lt;-</span> m <span class="sc">+</span> <span class="dv">1</span></span>
<span id="cb42-236"><a href="getting-started.html#cb42-236" tabindex="-1"></a>  }</span>
<span id="cb42-237"><a href="getting-started.html#cb42-237" tabindex="-1"></a>  <span class="cf">if</span> (<span class="st">&quot;ebal&quot;</span> <span class="sc">%in%</span> methods) {</span>
<span id="cb42-238"><a href="getting-started.html#cb42-238" tabindex="-1"></a>    results[m, ] <span class="ot">&lt;-</span> <span class="fu">quiet</span>(<span class="fu">ebal</span>(data, Y, treat, covar))</span>
<span id="cb42-239"><a href="getting-started.html#cb42-239" tabindex="-1"></a>    m <span class="ot">&lt;-</span> m <span class="sc">+</span> <span class="dv">1</span></span>
<span id="cb42-240"><a href="getting-started.html#cb42-240" tabindex="-1"></a>  }</span>
<span id="cb42-241"><a href="getting-started.html#cb42-241" tabindex="-1"></a>  <span class="co"># if (&quot;hbal&quot; %in% methods) {</span></span>
<span id="cb42-242"><a href="getting-started.html#cb42-242" tabindex="-1"></a>  <span class="co">#   results[m, ] &lt;- quiet(hbal(data, Y, treat, covar))</span></span>
<span id="cb42-243"><a href="getting-started.html#cb42-243" tabindex="-1"></a>  <span class="co">#   m &lt;- m + 1</span></span>
<span id="cb42-244"><a href="getting-started.html#cb42-244" tabindex="-1"></a>  <span class="co"># }</span></span>
<span id="cb42-245"><a href="getting-started.html#cb42-245" tabindex="-1"></a>  <span class="cf">if</span> (<span class="st">&quot;dml&quot;</span> <span class="sc">%in%</span> methods) {</span>
<span id="cb42-246"><a href="getting-started.html#cb42-246" tabindex="-1"></a>    results[m, ] <span class="ot">&lt;-</span><span class="fu">dml</span>(data, Y, treat, covar) </span>
<span id="cb42-247"><a href="getting-started.html#cb42-247" tabindex="-1"></a>    m <span class="ot">&lt;-</span> m <span class="sc">+</span> <span class="dv">1</span></span>
<span id="cb42-248"><a href="getting-started.html#cb42-248" tabindex="-1"></a>  }</span>
<span id="cb42-249"><a href="getting-started.html#cb42-249" tabindex="-1"></a>  <span class="cf">if</span> (<span class="st">&quot;aipw_grf&quot;</span> <span class="sc">%in%</span> methods) {</span>
<span id="cb42-250"><a href="getting-started.html#cb42-250" tabindex="-1"></a>    results[m, ] <span class="ot">&lt;-</span> <span class="fu">aipw</span>(data, Y, treat, covar) </span>
<span id="cb42-251"><a href="getting-started.html#cb42-251" tabindex="-1"></a>    m <span class="ot">&lt;-</span> m <span class="sc">+</span> <span class="dv">1</span></span>
<span id="cb42-252"><a href="getting-started.html#cb42-252" tabindex="-1"></a>  }</span>
<span id="cb42-253"><a href="getting-started.html#cb42-253" tabindex="-1"></a>  <span class="cf">if</span> (<span class="st">&quot;aipw_ow&quot;</span> <span class="sc">%in%</span> methods) {</span>
<span id="cb42-254"><a href="getting-started.html#cb42-254" tabindex="-1"></a>    results[m, ] <span class="ot">&lt;-</span> <span class="fu">aipw_ow</span>(data, Y, treat, covar)</span>
<span id="cb42-255"><a href="getting-started.html#cb42-255" tabindex="-1"></a>    m <span class="ot">&lt;-</span> m <span class="sc">+</span> <span class="dv">1</span></span>
<span id="cb42-256"><a href="getting-started.html#cb42-256" tabindex="-1"></a>  }</span>
<span id="cb42-257"><a href="getting-started.html#cb42-257" tabindex="-1"></a>  <span class="fu">return</span>(results)</span>
<span id="cb42-258"><a href="getting-started.html#cb42-258" tabindex="-1"></a>}</span></code></pre></div>
<p><strong>Function calls</strong></p>
<ul>
<li><code>quiet</code>: Suppresses output from a function call.</li>
<li><code>diff</code>: Difference in means estimator. It runs a linear regression adjusting for robust standard errors and returns the coefficient, standard error, and confidence interval for the treatment variable.</li>
<li><code>reg</code>: Regression adjustment. Similar to <code>diff</code> but includes additional covariates in the regression model.</li>
<li><code>matching</code>: Propensity score matching using the Matching package. It aligns treated units to control units based on covariates and returns the estimated ATT and its confidence interval.</li>
<li><code>psm</code>: Propensity score matching using a probability forest, followed by matching and estimation of the ATT.</li>
<li><code>om.reg</code>: Outcome modeling using regression. It predicts the outcome for the treated units based on the model fitted to the control units, and then estimates the ATT.</li>
<li><code>om.grf</code>: Outcome modeling using generalized random forests, noted as GRF.</li>
<li><code>ipw</code>: Inverse probability weighting,denoted as IPW. It weights observations by the inverse of their estimated propensity scores and calculates the treatment effect with a weighted regression.</li>
<li><code>cbps</code>: Covariate balancing propensity score, noted as CBPS. It estimates propensity scores to achieve balance on covariates across groups.</li>
<li><code>ebal</code>: Entropy balancing. It reweights the data to balance the covariate distributions.</li>
<li><code>hbal</code>: Hierarchical balancing. It is an extension of <code>ebal</code> with more complex balancing methods.</li>
<li><code>aipw</code>: Augmented inverse probability weighting, noted as AIPW.</li>
<li><code>aipw.match</code>: Combines matching on propensity scores with AIPW.</li>
<li><code>aipw_ow</code>: AIPW computed via outcome weights.</li>
<li><code>dml</code>: Double machine learning. It uses machine learning algorithms to control for confounders when estimating treatment effects.</li>
</ul>
<p><code>plot_coef()</code> plots treatment effect point estimates and corresponding confidence intervals comparatively across various estimators.</p>
<div class="sourceCode" id="cb43"><pre class="sourceCode r fold-hide"><code class="sourceCode r"><span id="cb43-1"><a href="getting-started.html#cb43-1" tabindex="-1"></a>plot_coef <span class="ot">&lt;-</span> <span class="cf">function</span>(out, </span>
<span id="cb43-2"><a href="getting-started.html#cb43-2" tabindex="-1"></a>                      <span class="at">methods =</span> <span class="fu">c</span>(<span class="st">&quot;diff&quot;</span>, <span class="st">&quot;reg&quot;</span>, <span class="st">&quot;om.reg&quot;</span>, <span class="st">&quot;om.grf&quot;</span>, </span>
<span id="cb43-3"><a href="getting-started.html#cb43-3" tabindex="-1"></a>                                  <span class="st">&quot;matching&quot;</span>, <span class="st">&quot;psm&quot;</span>, <span class="st">&quot;ipw&quot;</span>, <span class="st">&quot;cbps&quot;</span>, <span class="st">&quot;ebal&quot;</span>, </span>
<span id="cb43-4"><a href="getting-started.html#cb43-4" tabindex="-1"></a>                                  <span class="st">&quot;dml&quot;</span>, <span class="st">&quot;aipw_grf&quot;</span>, <span class="st">&quot;aipw_ow&quot;</span>),</span>
<span id="cb43-5"><a href="getting-started.html#cb43-5" tabindex="-1"></a>                      <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">&quot;Diff-in-Means&quot;</span>, <span class="st">&quot;Reg&quot;</span>, <span class="st">&quot;OM: Reg&quot;</span>, <span class="st">&quot;OM: GRF&quot;</span>,</span>
<span id="cb43-6"><a href="getting-started.html#cb43-6" tabindex="-1"></a>                                 <span class="st">&quot;NN</span><span class="sc">\n</span><span class="st">Matching&quot;</span>, <span class="st">&quot;PS</span><span class="sc">\n</span><span class="st">Matching&quot;</span>,</span>
<span id="cb43-7"><a href="getting-started.html#cb43-7" tabindex="-1"></a>                                 <span class="st">&quot;IPW&quot;</span>, <span class="st">&quot;CBPS&quot;</span>, <span class="st">&quot;Ebal&quot;</span>, <span class="st">&quot;DML</span><span class="sc">\n</span><span class="st">Elasnet&quot;</span>, <span class="st">&quot;AIPW-GRF&quot;</span>, <span class="st">&quot;AIPW-OW&quot;</span>),</span>
<span id="cb43-8"><a href="getting-started.html#cb43-8" tabindex="-1"></a>                      <span class="at">main =</span> <span class="cn">NULL</span>,</span>
<span id="cb43-9"><a href="getting-started.html#cb43-9" tabindex="-1"></a>                      <span class="at">ylab =</span> <span class="st">&quot;Estimate&quot;</span>,</span>
<span id="cb43-10"><a href="getting-started.html#cb43-10" tabindex="-1"></a>                      <span class="at">band =</span> <span class="cn">NULL</span>,</span>
<span id="cb43-11"><a href="getting-started.html#cb43-11" tabindex="-1"></a>                      <span class="at">line =</span> <span class="cn">NULL</span>,</span>
<span id="cb43-12"><a href="getting-started.html#cb43-12" tabindex="-1"></a>                      <span class="at">grid =</span> <span class="cn">TRUE</span>,</span>
<span id="cb43-13"><a href="getting-started.html#cb43-13" tabindex="-1"></a>                      <span class="at">main.pos =</span> <span class="dv">1</span>,</span>
<span id="cb43-14"><a href="getting-started.html#cb43-14" tabindex="-1"></a>                      <span class="at">main.line =</span> <span class="sc">-</span><span class="dv">2</span>,</span>
<span id="cb43-15"><a href="getting-started.html#cb43-15" tabindex="-1"></a>                      <span class="at">ylim =</span> <span class="cn">NULL</span>,</span>
<span id="cb43-16"><a href="getting-started.html#cb43-16" tabindex="-1"></a>                      <span class="at">textsize =</span> <span class="dv">1</span></span>
<span id="cb43-17"><a href="getting-started.html#cb43-17" tabindex="-1"></a>) {</span>
<span id="cb43-18"><a href="getting-started.html#cb43-18" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">is.null</span>(methods) <span class="sc">==</span> <span class="cn">TRUE</span>) {</span>
<span id="cb43-19"><a href="getting-started.html#cb43-19" tabindex="-1"></a>    methods <span class="ot">&lt;-</span> <span class="fu">rownames</span>(out)</span>
<span id="cb43-20"><a href="getting-started.html#cb43-20" tabindex="-1"></a>  }</span>
<span id="cb43-21"><a href="getting-started.html#cb43-21" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">is.null</span>(labels) <span class="sc">==</span> <span class="cn">TRUE</span>) {</span>
<span id="cb43-22"><a href="getting-started.html#cb43-22" tabindex="-1"></a>    labels <span class="ot">&lt;-</span> methods</span>
<span id="cb43-23"><a href="getting-started.html#cb43-23" tabindex="-1"></a>  }</span>
<span id="cb43-24"><a href="getting-started.html#cb43-24" tabindex="-1"></a>  <span class="co"># # check</span></span>
<span id="cb43-25"><a href="getting-started.html#cb43-25" tabindex="-1"></a>  <span class="co"># if (is.null(out)==FALSE) {</span></span>
<span id="cb43-26"><a href="getting-started.html#cb43-26" tabindex="-1"></a>  <span class="co">#   if (inherits(out, &quot;ivDiag&quot;) == FALSE) {stop(&quot;\&quot;out\&quot; needs to be a \&quot;ltz\&quot; object.&quot;)}</span></span>
<span id="cb43-27"><a href="getting-started.html#cb43-27" tabindex="-1"></a>  <span class="co"># }</span></span>
<span id="cb43-28"><a href="getting-started.html#cb43-28" tabindex="-1"></a>  <span class="co"># </span></span>
<span id="cb43-29"><a href="getting-started.html#cb43-29" tabindex="-1"></a>  <span class="co"># # title</span></span>
<span id="cb43-30"><a href="getting-started.html#cb43-30" tabindex="-1"></a>  <span class="co"># if (is.null(main)==TRUE) {</span></span>
<span id="cb43-31"><a href="getting-started.html#cb43-31" tabindex="-1"></a>  <span class="co">#   main &lt;- &quot;Estimates with 95% CIs&quot;</span></span>
<span id="cb43-32"><a href="getting-started.html#cb43-32" tabindex="-1"></a>  <span class="co"># }</span></span>
<span id="cb43-33"><a href="getting-started.html#cb43-33" tabindex="-1"></a>  <span class="co"># data for the plot</span></span>
<span id="cb43-34"><a href="getting-started.html#cb43-34" tabindex="-1"></a>  data <span class="ot">&lt;-</span> out</span>
<span id="cb43-35"><a href="getting-started.html#cb43-35" tabindex="-1"></a>  rg <span class="ot">&lt;-</span> <span class="fu">range</span>(data[,<span class="fu">c</span>(<span class="dv">3</span>,<span class="dv">4</span>)], <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb43-36"><a href="getting-started.html#cb43-36" tabindex="-1"></a>  adj <span class="ot">&lt;-</span> rg[<span class="dv">2</span>] <span class="sc">-</span> rg[<span class="dv">1</span>]</span>
<span id="cb43-37"><a href="getting-started.html#cb43-37" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">is.null</span>(ylim) <span class="sc">==</span> <span class="cn">TRUE</span>) {</span>
<span id="cb43-38"><a href="getting-started.html#cb43-38" tabindex="-1"></a>    ylim  <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fu">min</span>(<span class="dv">0</span>, rg[<span class="dv">1</span>] <span class="sc">-</span> <span class="fl">0.3</span><span class="sc">*</span>adj), <span class="fu">max</span>(<span class="dv">0</span>, rg[<span class="dv">2</span>] <span class="sc">+</span> <span class="fl">0.35</span><span class="sc">*</span>adj))</span>
<span id="cb43-39"><a href="getting-started.html#cb43-39" tabindex="-1"></a>  }</span>
<span id="cb43-40"><a href="getting-started.html#cb43-40" tabindex="-1"></a>  adj2 <span class="ot">&lt;-</span> ylim[<span class="dv">2</span>] <span class="sc">-</span> ylim[<span class="dv">1</span>] </span>
<span id="cb43-41"><a href="getting-started.html#cb43-41" tabindex="-1"></a>  <span class="co"># Set up the plot</span></span>
<span id="cb43-42"><a href="getting-started.html#cb43-42" tabindex="-1"></a>  ncoefs <span class="ot">&lt;-</span> <span class="fu">length</span>(methods)</span>
<span id="cb43-43"><a href="getting-started.html#cb43-43" tabindex="-1"></a>  <span class="fu">par</span>(<span class="at">mar =</span> <span class="fu">c</span>(<span class="fl">2.5</span>, <span class="dv">4</span>, <span class="dv">1</span>, <span class="dv">2</span>))</span>
<span id="cb43-44"><a href="getting-started.html#cb43-44" tabindex="-1"></a>  <span class="fu">plot</span>(<span class="dv">1</span><span class="sc">:</span> ncoefs, data[, <span class="dv">1</span>], <span class="at">xlim =</span> <span class="fu">c</span>(<span class="fl">0.5</span>, ncoefs <span class="sc">+</span> <span class="fl">0.5</span>), <span class="at">ylim =</span> ylim,</span>
<span id="cb43-45"><a href="getting-started.html#cb43-45" tabindex="-1"></a>       <span class="at">ylab =</span> <span class="st">&quot;&quot;</span>, <span class="at">xlab =</span> <span class="st">&quot;&quot;</span>, <span class="at">main =</span> <span class="st">&quot;&quot;</span>, </span>
<span id="cb43-46"><a href="getting-started.html#cb43-46" tabindex="-1"></a>       <span class="at">axes =</span> <span class="cn">FALSE</span>, <span class="at">xaxt =</span> <span class="st">&quot;n&quot;</span>, <span class="at">yaxt =</span> <span class="st">&quot;n&quot;</span>, <span class="at">type =</span> <span class="st">&quot;n&quot;</span>)</span>
<span id="cb43-47"><a href="getting-started.html#cb43-47" tabindex="-1"></a>  <span class="fu">axis</span>(<span class="dv">1</span>, <span class="at">at =</span> <span class="dv">1</span><span class="sc">:</span> ncoefs, <span class="at">labels =</span>  labels, <span class="at">las =</span> <span class="dv">1</span>, <span class="at">cex.axis =</span> <span class="fl">0.8</span>)</span>
<span id="cb43-48"><a href="getting-started.html#cb43-48" tabindex="-1"></a>  <span class="fu">axis</span>(<span class="dv">2</span>, <span class="at">cex.axis =</span> <span class="fl">0.7</span>)</span>
<span id="cb43-49"><a href="getting-started.html#cb43-49" tabindex="-1"></a>  <span class="fu">mtext</span>(main, main.pos, <span class="at">line =</span> main.line, <span class="at">cex =</span> textsize)</span>
<span id="cb43-50"><a href="getting-started.html#cb43-50" tabindex="-1"></a>  <span class="fu">mtext</span>(ylab, <span class="dv">2</span>, <span class="at">line =</span> <span class="fl">2.5</span>)</span>
<span id="cb43-51"><a href="getting-started.html#cb43-51" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">is.null</span>(band) <span class="sc">==</span> <span class="cn">FALSE</span>) {</span>
<span id="cb43-52"><a href="getting-started.html#cb43-52" tabindex="-1"></a>    <span class="fu">rect</span>(<span class="sc">-</span><span class="fl">0.5</span>, band[<span class="dv">1</span>], ncoefs <span class="sc">+</span> <span class="dv">1</span>, band[<span class="dv">2</span>], <span class="at">col =</span> <span class="st">&quot;#ff000030&quot;</span>, <span class="at">border =</span> <span class="st">&quot;white&quot;</span>) <span class="co"># label at bottom</span></span>
<span id="cb43-53"><a href="getting-started.html#cb43-53" tabindex="-1"></a>  }</span>
<span id="cb43-54"><a href="getting-started.html#cb43-54" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">is.null</span>(line) <span class="sc">==</span> <span class="cn">FALSE</span>) {</span>
<span id="cb43-55"><a href="getting-started.html#cb43-55" tabindex="-1"></a>    <span class="fu">abline</span>(<span class="at">h =</span> line, <span class="at">col =</span> <span class="st">&quot;red&quot;</span>, <span class="at">lty =</span> <span class="dv">2</span>)</span>
<span id="cb43-56"><a href="getting-started.html#cb43-56" tabindex="-1"></a>  }</span>
<span id="cb43-57"><a href="getting-started.html#cb43-57" tabindex="-1"></a>  <span class="cf">if</span> (grid <span class="sc">==</span> <span class="cn">TRUE</span>) {</span>
<span id="cb43-58"><a href="getting-started.html#cb43-58" tabindex="-1"></a>    <span class="fu">abline</span>(<span class="at">h =</span> <span class="fu">axTicks</span>(<span class="dv">2</span>), <span class="at">lty =</span> <span class="st">&quot;dotted&quot;</span>, <span class="at">col =</span> <span class="st">&quot;gray50&quot;</span>)</span>
<span id="cb43-59"><a href="getting-started.html#cb43-59" tabindex="-1"></a>    <span class="fu">abline</span>(<span class="at">v =</span> <span class="fu">c</span>(<span class="fl">0.5</span>, <span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span> ncoefs) <span class="sc">+</span> <span class="fl">0.5</span>), <span class="at">lty =</span> <span class="st">&quot;dotted&quot;</span>, <span class="at">col =</span> <span class="st">&quot;gray50&quot;</span>) <span class="co"># horizontal grid</span></span>
<span id="cb43-60"><a href="getting-started.html#cb43-60" tabindex="-1"></a>  }</span>
<span id="cb43-61"><a href="getting-started.html#cb43-61" tabindex="-1"></a>  <span class="fu">abline</span>(<span class="at">h =</span> <span class="dv">0</span>, <span class="at">col =</span> <span class="st">&quot;red&quot;</span>, <span class="at">lwd =</span> <span class="dv">2</span>, <span class="at">lty =</span> <span class="st">&quot;solid&quot;</span>)</span>
<span id="cb43-62"><a href="getting-started.html#cb43-62" tabindex="-1"></a>  <span class="fu">segments</span>(<span class="at">y0 =</span> data[, <span class="dv">3</span>], <span class="at">x0 =</span> <span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span> ncoefs), <span class="at">y1 =</span> data[, <span class="dv">4</span>], <span class="at">x1 =</span> <span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span> ncoefs), <span class="at">lwd =</span> <span class="dv">2</span>) <span class="co">#CI</span></span>
<span id="cb43-63"><a href="getting-started.html#cb43-63" tabindex="-1"></a>  <span class="fu">points</span>(<span class="dv">1</span><span class="sc">:</span> ncoefs, data[, <span class="dv">1</span>], <span class="at">pch =</span> <span class="dv">16</span>, <span class="at">col =</span> <span class="dv">1</span>, <span class="at">cex =</span> <span class="fl">1.2</span>) <span class="co">#point coefs</span></span>
<span id="cb43-64"><a href="getting-started.html#cb43-64" tabindex="-1"></a>  <span class="fu">box</span>()</span>
<span id="cb43-65"><a href="getting-started.html#cb43-65" tabindex="-1"></a>}</span></code></pre></div>
<p><code>plot_att_panels()</code> produces panels of ATT estimates with confidence intervals for multiple methods and datasets.</p>
<div class="sourceCode" id="cb44"><pre class="sourceCode r fold-hide"><code class="sourceCode r"><span id="cb44-1"><a href="getting-started.html#cb44-1" tabindex="-1"></a>plot_att_panels <span class="ot">&lt;-</span> <span class="cf">function</span>(all_outs, plot_titles, band, est, <span class="at">ylim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">15500</span>, <span class="dv">5500</span>), <span class="at">plots_per_page =</span> <span class="dv">4</span>, <span class="at">ylab =</span> <span class="st">&quot;Estimate&quot;</span>, <span class="at">textsize =</span> <span class="dv">1</span>) {</span>
<span id="cb44-2"><a href="getting-started.html#cb44-2" tabindex="-1"></a>  num_pages <span class="ot">&lt;-</span> <span class="fu">ceiling</span>(<span class="fu">length</span>(all_outs) <span class="sc">/</span> plots_per_page)</span>
<span id="cb44-3"><a href="getting-started.html#cb44-3" tabindex="-1"></a>  <span class="cf">for</span> (page <span class="cf">in</span> <span class="fu">seq_len</span>(num_pages)) {</span>
<span id="cb44-4"><a href="getting-started.html#cb44-4" tabindex="-1"></a>    start_idx <span class="ot">&lt;-</span> (page <span class="sc">-</span> <span class="dv">1</span>) <span class="sc">*</span> plots_per_page <span class="sc">+</span> <span class="dv">1</span></span>
<span id="cb44-5"><a href="getting-started.html#cb44-5" tabindex="-1"></a>    end_idx   <span class="ot">&lt;-</span> <span class="fu">min</span>(page <span class="sc">*</span> plots_per_page, <span class="fu">length</span>(all_outs))</span>
<span id="cb44-6"><a href="getting-started.html#cb44-6" tabindex="-1"></a>    <span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(plots_per_page, <span class="dv">1</span>), <span class="at">mar =</span> <span class="fu">c</span>(<span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">3</span>, <span class="dv">2</span>))</span>
<span id="cb44-7"><a href="getting-started.html#cb44-7" tabindex="-1"></a>    <span class="cf">for</span> (i <span class="cf">in</span> start_idx<span class="sc">:</span>end_idx) {</span>
<span id="cb44-8"><a href="getting-started.html#cb44-8" tabindex="-1"></a>      out <span class="ot">&lt;-</span> all_outs[[i]]</span>
<span id="cb44-9"><a href="getting-started.html#cb44-9" tabindex="-1"></a>      <span class="fu">plot_coef</span>(out, </span>
<span id="cb44-10"><a href="getting-started.html#cb44-10" tabindex="-1"></a>                <span class="at">band =</span> band, </span>
<span id="cb44-11"><a href="getting-started.html#cb44-11" tabindex="-1"></a>                <span class="at">line =</span> est,</span>
<span id="cb44-12"><a href="getting-started.html#cb44-12" tabindex="-1"></a>                <span class="at">ylim =</span> ylim,</span>
<span id="cb44-13"><a href="getting-started.html#cb44-13" tabindex="-1"></a>                <span class="at">main =</span> plot_titles[i],</span>
<span id="cb44-14"><a href="getting-started.html#cb44-14" tabindex="-1"></a>                <span class="at">ylab =</span> ylab,</span>
<span id="cb44-15"><a href="getting-started.html#cb44-15" tabindex="-1"></a>                <span class="at">textsize =</span> textsize)</span>
<span id="cb44-16"><a href="getting-started.html#cb44-16" tabindex="-1"></a>    }</span>
<span id="cb44-17"><a href="getting-started.html#cb44-17" tabindex="-1"></a>  }</span>
<span id="cb44-18"><a href="getting-started.html#cb44-18" tabindex="-1"></a>}</span></code></pre></div>
<p><strong>Arguments</strong></p>
<ul>
<li><code>all_outs</code>: A list of output objects containing ATT estimates and confidence intervals for different methods.</li>
<li><code>plot_titles</code>: A character vector of titles for each plot, corresponding to the outputs in <code>all_outs</code>.</li>
<li><code>band</code>: A numeric vector specifying the confidence interval bounds.</li>
<li><code>est</code>: A numeric value representing the point estimate.</li>
<li><code>ylim</code>: A numeric vector specifying the y-axis limits for the plots (default c(-15500, 5500)).</li>
<li><code>plots_per_page</code>: The number of plots to display per page / panel (default 4).</li>
<li><code>ylab</code>: The label for the y-axis (default “Estimate”).</li>
<li><code>textsize</code>: A numeric scaling factor for text size in plots (default 1).</li>
</ul>
<p><code>save_att_panels()</code> generates and saves paginated pdf plots that display ATT estimates and their confidence bands from multiple methods.</p>
<div class="sourceCode" id="cb45"><pre class="sourceCode r fold-hide"><code class="sourceCode r"><span id="cb45-1"><a href="getting-started.html#cb45-1" tabindex="-1"></a>save_att_panels <span class="ot">&lt;-</span> <span class="cf">function</span>(</span>
<span id="cb45-2"><a href="getting-started.html#cb45-2" tabindex="-1"></a>    all_outs, plot_titles, band, est, prefix,</span>
<span id="cb45-3"><a href="getting-started.html#cb45-3" tabindex="-1"></a>    <span class="at">plots_per_page =</span> <span class="dv">4</span>, <span class="at">ylab =</span> <span class="st">&quot;Estimate&quot;</span>, <span class="at">textsize =</span> <span class="dv">1</span>) {</span>
<span id="cb45-4"><a href="getting-started.html#cb45-4" tabindex="-1"></a>  folder <span class="ot">&lt;-</span> <span class="st">&quot;../graphs/lalonde&quot;</span></span>
<span id="cb45-5"><a href="getting-started.html#cb45-5" tabindex="-1"></a>  ylim   <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">15500</span>, <span class="dv">5500</span>)</span>
<span id="cb45-6"><a href="getting-started.html#cb45-6" tabindex="-1"></a>  <span class="cf">if</span> (<span class="sc">!</span><span class="fu">dir.exists</span>(folder)) <span class="fu">dir.create</span>(folder, <span class="at">recursive =</span> <span class="cn">TRUE</span>)</span>
<span id="cb45-7"><a href="getting-started.html#cb45-7" tabindex="-1"></a>  num_pages <span class="ot">&lt;-</span> <span class="fu">ceiling</span>(<span class="fu">length</span>(all_outs) <span class="sc">/</span> plots_per_page)</span>
<span id="cb45-8"><a href="getting-started.html#cb45-8" tabindex="-1"></a>  <span class="cf">for</span> (page <span class="cf">in</span> <span class="fu">seq_len</span>(num_pages)) {</span>
<span id="cb45-9"><a href="getting-started.html#cb45-9" tabindex="-1"></a>    file_name <span class="ot">&lt;-</span> <span class="fu">file.path</span>(folder, <span class="fu">paste0</span>(prefix, <span class="st">&quot;_&quot;</span>, page, <span class="st">&quot;.pdf&quot;</span>))</span>
<span id="cb45-10"><a href="getting-started.html#cb45-10" tabindex="-1"></a>    <span class="fu">pdf</span>(file_name, <span class="at">width =</span> <span class="dv">8</span>, <span class="at">height =</span> <span class="dv">11</span>)</span>
<span id="cb45-11"><a href="getting-started.html#cb45-11" tabindex="-1"></a>    <span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(plots_per_page, <span class="dv">1</span>), <span class="at">mar =</span> <span class="fu">c</span>(<span class="dv">3</span>,<span class="dv">4</span>,<span class="dv">3</span>,<span class="dv">2</span>))</span>
<span id="cb45-12"><a href="getting-started.html#cb45-12" tabindex="-1"></a>    start_idx <span class="ot">&lt;-</span> (page <span class="sc">-</span> <span class="dv">1</span>) <span class="sc">*</span> plots_per_page <span class="sc">+</span> <span class="dv">1</span></span>
<span id="cb45-13"><a href="getting-started.html#cb45-13" tabindex="-1"></a>    end_idx <span class="ot">&lt;-</span> <span class="fu">min</span>(page <span class="sc">*</span> plots_per_page, <span class="fu">length</span>(all_outs))</span>
<span id="cb45-14"><a href="getting-started.html#cb45-14" tabindex="-1"></a>    <span class="cf">for</span> (i <span class="cf">in</span> start_idx<span class="sc">:</span>end_idx) {</span>
<span id="cb45-15"><a href="getting-started.html#cb45-15" tabindex="-1"></a>      <span class="fu">plot_coef</span>(all_outs[[i]],</span>
<span id="cb45-16"><a href="getting-started.html#cb45-16" tabindex="-1"></a>                <span class="at">band =</span> band, <span class="at">line =</span> est, <span class="at">ylim =</span> ylim,</span>
<span id="cb45-17"><a href="getting-started.html#cb45-17" tabindex="-1"></a>                <span class="at">main =</span> plot_titles[i], <span class="at">ylab =</span> ylab, <span class="at">textsize =</span> textsize)</span>
<span id="cb45-18"><a href="getting-started.html#cb45-18" tabindex="-1"></a>    }</span>
<span id="cb45-19"><a href="getting-started.html#cb45-19" tabindex="-1"></a>    <span class="fu">dev.off</span>()</span>
<span id="cb45-20"><a href="getting-started.html#cb45-20" tabindex="-1"></a>  }</span>
<span id="cb45-21"><a href="getting-started.html#cb45-21" tabindex="-1"></a>}</span></code></pre></div>
<p><strong>Arguments</strong></p>
<ul>
<li><code>all_outs</code>: A list of output objects containing ATT estimates and confidence intervals for different methods.</li>
<li><code>plot_titles</code>: A character vector of titles for each plot, corresponding to the outputs in <code>all_outs</code>.</li>
<li><code>band</code>: A numeric vector specifying the confidence interval bounds.</li>
<li><code>est</code>: A numeric value representing the point estimate.</li>
<li><code>prefix</code>: String prefix used for saved file names to identify dataset.</li>
<li><code>plots_per_page</code>: The number of plots to display per page / panel (default 4).</li>
<li><code>ylab</code>: The label for the y-axis (default “Estimate”).</li>
<li><code>textsize</code>: A numeric scaling factor for text size in plots (default 1).</li>
</ul>
<p><code>create_matrix_results()</code> organizes estimation results into a formatted matrix suitable for reporting or tables.</p>
<div class="sourceCode" id="cb46"><pre class="sourceCode r fold-hide"><code class="sourceCode r"><span id="cb46-1"><a href="getting-started.html#cb46-1" tabindex="-1"></a>create_matrix_results <span class="ot">&lt;-</span> <span class="cf">function</span>(all_outs, sample_names) {</span>
<span id="cb46-2"><a href="getting-started.html#cb46-2" tabindex="-1"></a>  n_samples <span class="ot">&lt;-</span> <span class="fu">length</span>(sample_names)</span>
<span id="cb46-3"><a href="getting-started.html#cb46-3" tabindex="-1"></a>  n_estimators <span class="ot">&lt;-</span> <span class="fu">nrow</span>(all_outs[[<span class="dv">1</span>]])</span>
<span id="cb46-4"><a href="getting-started.html#cb46-4" tabindex="-1"></a>  result_mat <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="st">&quot;&quot;</span>, <span class="at">nrow =</span> n_estimators <span class="sc">+</span> <span class="dv">1</span>, <span class="at">ncol =</span> n_samples <span class="sc">*</span> <span class="dv">2</span>)</span>
<span id="cb46-5"><a href="getting-started.html#cb46-5" tabindex="-1"></a>  <span class="co"># Set up alternating column names</span></span>
<span id="cb46-6"><a href="getting-started.html#cb46-6" tabindex="-1"></a>  cnames <span class="ot">&lt;-</span> <span class="fu">character</span>(n_samples <span class="sc">*</span> <span class="dv">2</span>)</span>
<span id="cb46-7"><a href="getting-started.html#cb46-7" tabindex="-1"></a>  <span class="cf">for</span> (j <span class="cf">in</span> <span class="fu">seq_along</span>(sample_names)) {</span>
<span id="cb46-8"><a href="getting-started.html#cb46-8" tabindex="-1"></a>    cnames[(j<span class="dv">-1</span>)<span class="sc">*</span><span class="dv">2</span> <span class="sc">+</span> <span class="dv">1</span>] <span class="ot">&lt;-</span> sample_names[j]</span>
<span id="cb46-9"><a href="getting-started.html#cb46-9" tabindex="-1"></a>    cnames[(j<span class="dv">-1</span>)<span class="sc">*</span><span class="dv">2</span> <span class="sc">+</span> <span class="dv">2</span>] <span class="ot">&lt;-</span> <span class="st">&quot;&quot;</span> <span class="co"># SE/parenthesis column</span></span>
<span id="cb46-10"><a href="getting-started.html#cb46-10" tabindex="-1"></a>  }</span>
<span id="cb46-11"><a href="getting-started.html#cb46-11" tabindex="-1"></a>  <span class="fu">colnames</span>(result_mat) <span class="ot">&lt;-</span> cnames</span>
<span id="cb46-12"><a href="getting-started.html#cb46-12" tabindex="-1"></a>  estimator_names <span class="ot">&lt;-</span> <span class="fu">rownames</span>(all_outs[[<span class="dv">1</span>]])</span>
<span id="cb46-13"><a href="getting-started.html#cb46-13" tabindex="-1"></a>  <span class="fu">rownames</span>(result_mat) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;Experimental Benchmark&quot;</span>, estimator_names)</span>
<span id="cb46-14"><a href="getting-started.html#cb46-14" tabindex="-1"></a>  <span class="co"># Fill values</span></span>
<span id="cb46-15"><a href="getting-started.html#cb46-15" tabindex="-1"></a>  <span class="cf">for</span> (j <span class="cf">in</span> <span class="fu">seq_along</span>(all_outs)) {</span>
<span id="cb46-16"><a href="getting-started.html#cb46-16" tabindex="-1"></a>    out <span class="ot">&lt;-</span> all_outs[[j]]</span>
<span id="cb46-17"><a href="getting-started.html#cb46-17" tabindex="-1"></a>    result_mat[<span class="dv">1</span>, (j<span class="dv">-1</span>)<span class="sc">*</span><span class="dv">2</span> <span class="sc">+</span> <span class="dv">1</span>] <span class="ot">&lt;-</span> <span class="fu">sprintf</span>(<span class="st">&quot;%.2f&quot;</span>, out[<span class="dv">1</span>, <span class="dv">1</span>])</span>
<span id="cb46-18"><a href="getting-started.html#cb46-18" tabindex="-1"></a>    result_mat[<span class="dv">1</span>, (j<span class="dv">-1</span>)<span class="sc">*</span><span class="dv">2</span> <span class="sc">+</span> <span class="dv">2</span>] <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">&quot;(&quot;</span>, <span class="fu">sprintf</span>(<span class="st">&quot;%.2f&quot;</span>, out[<span class="dv">1</span>, <span class="dv">2</span>]), <span class="st">&quot;)&quot;</span>)</span>
<span id="cb46-19"><a href="getting-started.html#cb46-19" tabindex="-1"></a>    <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">2</span><span class="sc">:</span>(n_estimators<span class="sc">+</span><span class="dv">1</span>)) {</span>
<span id="cb46-20"><a href="getting-started.html#cb46-20" tabindex="-1"></a>      result_mat[i, (j<span class="dv">-1</span>)<span class="sc">*</span><span class="dv">2</span> <span class="sc">+</span> <span class="dv">1</span>] <span class="ot">&lt;-</span> <span class="fu">sprintf</span>(<span class="st">&quot;%.2f&quot;</span>, out[i<span class="dv">-1</span>, <span class="dv">1</span>])</span>
<span id="cb46-21"><a href="getting-started.html#cb46-21" tabindex="-1"></a>      result_mat[i, (j<span class="dv">-1</span>)<span class="sc">*</span><span class="dv">2</span> <span class="sc">+</span> <span class="dv">2</span>] <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">&quot;(&quot;</span>, <span class="fu">sprintf</span>(<span class="st">&quot;%.2f&quot;</span>, out[i<span class="dv">-1</span>, <span class="dv">2</span>]), <span class="st">&quot;)&quot;</span>)</span>
<span id="cb46-22"><a href="getting-started.html#cb46-22" tabindex="-1"></a>    }</span>
<span id="cb46-23"><a href="getting-started.html#cb46-23" tabindex="-1"></a>  }</span>
<span id="cb46-24"><a href="getting-started.html#cb46-24" tabindex="-1"></a>  <span class="fu">return</span>(result_mat)</span>
<span id="cb46-25"><a href="getting-started.html#cb46-25" tabindex="-1"></a>}</span></code></pre></div>
<p><strong>Arguments</strong></p>
<ul>
<li><code>all_outs</code>: A list of output objects containing ATT estimates and confidence intervals for different methods.</li>
<li><code>sample_names</code>: A character vector of sample / dataset names corresponding to <code>all_outs</code>.</li>
</ul>
<p><code>eval_att()</code> computes summary statistics of the treatment effect estimates.</p>
<div class="sourceCode" id="cb47"><pre class="sourceCode r fold-hide"><code class="sourceCode r"><span id="cb47-1"><a href="getting-started.html#cb47-1" tabindex="-1"></a>eval_att <span class="ot">&lt;-</span> <span class="cf">function</span>(result) {</span>
<span id="cb47-2"><a href="getting-started.html#cb47-2" tabindex="-1"></a>  <span class="fu">data.frame</span>(</span>
<span id="cb47-3"><a href="getting-started.html#cb47-3" tabindex="-1"></a>    <span class="at">Mean_SE =</span> <span class="fu">mean</span>(result[, <span class="st">&quot;SE&quot;</span>], <span class="at">na.rm =</span> <span class="cn">TRUE</span>), <span class="co"># mean standard error across all estimator results</span></span>
<span id="cb47-4"><a href="getting-started.html#cb47-4" tabindex="-1"></a>    <span class="at">Min_Estimate =</span> <span class="fu">min</span>(result[, <span class="st">&quot;Estimate&quot;</span>], <span class="at">na.rm =</span> <span class="cn">TRUE</span>), <span class="co"># maximum estimate of all estimator results</span></span>
<span id="cb47-5"><a href="getting-started.html#cb47-5" tabindex="-1"></a>    <span class="at">Max_Estimate =</span> <span class="fu">max</span>(result[, <span class="st">&quot;Estimate&quot;</span>], <span class="at">na.rm =</span> <span class="cn">TRUE</span>), <span class="co"># minimum estimate of all estimator results</span></span>
<span id="cb47-6"><a href="getting-started.html#cb47-6" tabindex="-1"></a>    <span class="at">Diff_Estimate =</span> <span class="fu">max</span>(result[, <span class="st">&quot;Estimate&quot;</span>], <span class="at">na.rm =</span> <span class="cn">TRUE</span>) <span class="sc">-</span> <span class="fu">min</span>(result[, <span class="st">&quot;Estimate&quot;</span>], <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb47-7"><a href="getting-started.html#cb47-7" tabindex="-1"></a>  )</span>
<span id="cb47-8"><a href="getting-started.html#cb47-8" tabindex="-1"></a>}</span></code></pre></div>
<p><strong>Argument</strong></p>
<ul>
<li><code>result</code>: A data frame containing treatment effect estimation results.</li>
</ul>
</div>
<div id="conditional-average-treatment-effect-on-the-treated-catt" class="section level4 hasAnchor" number="1.2.5.2">
<h4><span class="header-section-number">1.2.5.2</span> Conditional average treatment effect on the treated (CATT)<a href="getting-started.html#conditional-average-treatment-effect-on-the-treated-catt" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p><code>plot_catt_panels()</code> visualizes CATT comparing multiple methods.</p>
<div class="sourceCode" id="cb48"><pre class="sourceCode r fold-hide"><code class="sourceCode r"><span id="cb48-1"><a href="getting-started.html#cb48-1" tabindex="-1"></a>plot_catt_panels <span class="ot">&lt;-</span> <span class="cf">function</span>(all_catt, plot_titles, <span class="at">plots_per_page =</span> <span class="dv">4</span>, <span class="at">range =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">8000</span>, <span class="dv">8000</span>)) {</span>
<span id="cb48-2"><a href="getting-started.html#cb48-2" tabindex="-1"></a>  num_pages <span class="ot">&lt;-</span> <span class="fu">ceiling</span>((<span class="fu">length</span>(all_catt) <span class="sc">-</span> <span class="dv">1</span>) <span class="sc">/</span> plots_per_page)</span>
<span id="cb48-3"><a href="getting-started.html#cb48-3" tabindex="-1"></a>  <span class="co"># Experimental reference (first panel)</span></span>
<span id="cb48-4"><a href="getting-started.html#cb48-4" tabindex="-1"></a>  catt_ldw <span class="ot">&lt;-</span> all_catt[[<span class="dv">1</span>]]<span class="sc">$</span>catt</span>
<span id="cb48-5"><a href="getting-started.html#cb48-5" tabindex="-1"></a>  att_ldw  <span class="ot">&lt;-</span> all_catt[[<span class="dv">1</span>]]<span class="sc">$</span>att[<span class="dv">1</span>]</span>
<span id="cb48-6"><a href="getting-started.html#cb48-6" tabindex="-1"></a>  id_ldw   <span class="ot">&lt;-</span> <span class="cf">if</span> (<span class="sc">!</span><span class="fu">is.null</span>(all_catt[[<span class="dv">1</span>]]<span class="sc">$</span>id)) all_catt[[<span class="dv">1</span>]]<span class="sc">$</span>id <span class="cf">else</span> <span class="fu">seq_along</span>(catt_ldw)</span>
<span id="cb48-7"><a href="getting-started.html#cb48-7" tabindex="-1"></a>  </span>
<span id="cb48-8"><a href="getting-started.html#cb48-8" tabindex="-1"></a>  <span class="cf">for</span> (page <span class="cf">in</span> <span class="fu">seq_len</span>(num_pages)) {</span>
<span id="cb48-9"><a href="getting-started.html#cb48-9" tabindex="-1"></a>    start_idx <span class="ot">&lt;-</span> (page <span class="sc">-</span> <span class="dv">1</span>) <span class="sc">*</span> plots_per_page <span class="sc">+</span> <span class="dv">2</span> <span class="co"># skip experimental vs itself</span></span>
<span id="cb48-10"><a href="getting-started.html#cb48-10" tabindex="-1"></a>    end_idx   <span class="ot">&lt;-</span> <span class="fu">min</span>(page <span class="sc">*</span> plots_per_page <span class="sc">+</span> <span class="dv">1</span>, <span class="fu">length</span>(all_catt))</span>
<span id="cb48-11"><a href="getting-started.html#cb48-11" tabindex="-1"></a>    <span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(plots_per_page, <span class="dv">1</span>), <span class="at">mar =</span> <span class="fu">c</span>(<span class="fl">4.5</span>, <span class="dv">5</span>, <span class="dv">3</span>, <span class="dv">2</span>))</span>
<span id="cb48-12"><a href="getting-started.html#cb48-12" tabindex="-1"></a>    <span class="cf">for</span> (i <span class="cf">in</span> start_idx<span class="sc">:</span>end_idx) {</span>
<span id="cb48-13"><a href="getting-started.html#cb48-13" tabindex="-1"></a>      other <span class="ot">&lt;-</span> all_catt[[i]]</span>
<span id="cb48-14"><a href="getting-started.html#cb48-14" tabindex="-1"></a>      main_label <span class="ot">&lt;-</span> plot_titles[i]</span>
<span id="cb48-15"><a href="getting-started.html#cb48-15" tabindex="-1"></a>      catt2 <span class="ot">&lt;-</span> other<span class="sc">$</span>catt</span>
<span id="cb48-16"><a href="getting-started.html#cb48-16" tabindex="-1"></a>      att2  <span class="ot">&lt;-</span> other<span class="sc">$</span>att[<span class="dv">1</span>]</span>
<span id="cb48-17"><a href="getting-started.html#cb48-17" tabindex="-1"></a>      id2   <span class="ot">&lt;-</span> <span class="cf">if</span> (<span class="sc">!</span><span class="fu">is.null</span>(other<span class="sc">$</span>id)) other<span class="sc">$</span>id <span class="cf">else</span> <span class="fu">seq_along</span>(catt2)</span>
<span id="cb48-18"><a href="getting-started.html#cb48-18" tabindex="-1"></a>      common_ids <span class="ot">&lt;-</span> <span class="fu">intersect</span>(id_ldw, id2)</span>
<span id="cb48-19"><a href="getting-started.html#cb48-19" tabindex="-1"></a>      idx_ldw    <span class="ot">&lt;-</span> <span class="fu">match</span>(common_ids, id_ldw)</span>
<span id="cb48-20"><a href="getting-started.html#cb48-20" tabindex="-1"></a>      idx_other  <span class="ot">&lt;-</span> <span class="fu">match</span>(common_ids, id2)</span>
<span id="cb48-21"><a href="getting-started.html#cb48-21" tabindex="-1"></a>      catt1_plot <span class="ot">&lt;-</span> catt_ldw[idx_ldw]</span>
<span id="cb48-22"><a href="getting-started.html#cb48-22" tabindex="-1"></a>      catt2_plot <span class="ot">&lt;-</span> catt2[idx_other]</span>
<span id="cb48-23"><a href="getting-started.html#cb48-23" tabindex="-1"></a>      <span class="fu">plot_catt</span>(</span>
<span id="cb48-24"><a href="getting-started.html#cb48-24" tabindex="-1"></a>        <span class="at">catt1 =</span> catt1_plot,</span>
<span id="cb48-25"><a href="getting-started.html#cb48-25" tabindex="-1"></a>        <span class="at">catt2 =</span> catt2_plot,</span>
<span id="cb48-26"><a href="getting-started.html#cb48-26" tabindex="-1"></a>        <span class="at">att1  =</span> att_ldw,</span>
<span id="cb48-27"><a href="getting-started.html#cb48-27" tabindex="-1"></a>        <span class="at">att2  =</span> att2,</span>
<span id="cb48-28"><a href="getting-started.html#cb48-28" tabindex="-1"></a>        <span class="at">xlab  =</span> <span class="st">&quot;CATT (Experimental)&quot;</span>,</span>
<span id="cb48-29"><a href="getting-started.html#cb48-29" tabindex="-1"></a>        <span class="at">ylab  =</span> main_label,</span>
<span id="cb48-30"><a href="getting-started.html#cb48-30" tabindex="-1"></a>        <span class="at">main  =</span> main_label,</span>
<span id="cb48-31"><a href="getting-started.html#cb48-31" tabindex="-1"></a>        <span class="at">axes.range =</span> range</span>
<span id="cb48-32"><a href="getting-started.html#cb48-32" tabindex="-1"></a>      )</span>
<span id="cb48-33"><a href="getting-started.html#cb48-33" tabindex="-1"></a>    }</span>
<span id="cb48-34"><a href="getting-started.html#cb48-34" tabindex="-1"></a>  }</span>
<span id="cb48-35"><a href="getting-started.html#cb48-35" tabindex="-1"></a>}</span></code></pre></div>
<p><strong>Arguments</strong></p>
<ul>
<li><code>all_catt</code>: A list of objects containing conditional average treatment effect on treated (CATT) estimates.</li>
<li><code>plot_titles</code>: A character vector of titles for each plot, corresponding to the outputs in <code>all_catt</code>.</li>
<li><code>plots_per_page</code>: The number of plots to display per page / panel (default 4).</li>
<li><code>range</code>: A numeric vector of axis limits for plots (default c(-8000, 8000)).</li>
</ul>
<p><code>save_catt_panels()</code>generates and saves multi-page PDF plots comparing CATT estimates across different methods.</p>
<div class="sourceCode" id="cb49"><pre class="sourceCode r fold-hide"><code class="sourceCode r"><span id="cb49-1"><a href="getting-started.html#cb49-1" tabindex="-1"></a>save_catt_panels <span class="ot">&lt;-</span> <span class="cf">function</span>(all_catt, plot_titles, <span class="at">range =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">8000</span>, <span class="dv">8000</span>), <span class="at">prefix =</span> <span class="st">&quot;model_a&quot;</span>, <span class="at">plots_per_page =</span> <span class="dv">4</span>) {</span>
<span id="cb49-2"><a href="getting-started.html#cb49-2" tabindex="-1"></a>  <span class="fu">dir.create</span>(<span class="st">&quot;../graphs/lalonde&quot;</span>, <span class="at">showWarnings =</span> <span class="cn">FALSE</span>, <span class="at">recursive =</span> <span class="cn">TRUE</span>)</span>
<span id="cb49-3"><a href="getting-started.html#cb49-3" tabindex="-1"></a>  catt_ldw <span class="ot">&lt;-</span> all_catt[[<span class="dv">1</span>]]<span class="sc">$</span>catt</span>
<span id="cb49-4"><a href="getting-started.html#cb49-4" tabindex="-1"></a>  att_ldw  <span class="ot">&lt;-</span> all_catt[[<span class="dv">1</span>]]<span class="sc">$</span>att[<span class="dv">1</span>]</span>
<span id="cb49-5"><a href="getting-started.html#cb49-5" tabindex="-1"></a>  id_ldw   <span class="ot">&lt;-</span> <span class="cf">if</span> (<span class="sc">!</span><span class="fu">is.null</span>(all_catt[[<span class="dv">1</span>]]<span class="sc">$</span>id)) all_catt[[<span class="dv">1</span>]]<span class="sc">$</span>id <span class="cf">else</span> <span class="fu">seq_along</span>(catt_ldw)</span>
<span id="cb49-6"><a href="getting-started.html#cb49-6" tabindex="-1"></a>  num_panels <span class="ot">&lt;-</span> <span class="fu">length</span>(all_catt) <span class="sc">-</span> <span class="dv">1</span>   <span class="co"># skip experimental on page</span></span>
<span id="cb49-7"><a href="getting-started.html#cb49-7" tabindex="-1"></a>  num_pages  <span class="ot">&lt;-</span> <span class="fu">ceiling</span>(num_panels <span class="sc">/</span> plots_per_page)</span>
<span id="cb49-8"><a href="getting-started.html#cb49-8" tabindex="-1"></a>  <span class="cf">for</span> (page <span class="cf">in</span> <span class="fu">seq_len</span>(num_pages)) {</span>
<span id="cb49-9"><a href="getting-started.html#cb49-9" tabindex="-1"></a>    start_idx <span class="ot">&lt;-</span> (page <span class="sc">-</span> <span class="dv">1</span>) <span class="sc">*</span> plots_per_page <span class="sc">+</span> <span class="dv">2</span>  <span class="co"># always skip all_catt[[1]]</span></span>
<span id="cb49-10"><a href="getting-started.html#cb49-10" tabindex="-1"></a>    end_idx   <span class="ot">&lt;-</span> <span class="fu">min</span>(page <span class="sc">*</span> plots_per_page <span class="sc">+</span> <span class="dv">1</span>, <span class="fu">length</span>(all_catt))</span>
<span id="cb49-11"><a href="getting-started.html#cb49-11" tabindex="-1"></a>    plots_this_page <span class="ot">&lt;-</span> end_idx <span class="sc">-</span> start_idx <span class="sc">+</span> <span class="dv">1</span></span>
<span id="cb49-12"><a href="getting-started.html#cb49-12" tabindex="-1"></a>    file_name <span class="ot">&lt;-</span> <span class="fu">sprintf</span>(<span class="st">&quot;../graphs/lalonde/%s_catt_estimates_%d.pdf&quot;</span>, prefix, page)</span>
<span id="cb49-13"><a href="getting-started.html#cb49-13" tabindex="-1"></a>    <span class="fu">pdf</span>(<span class="at">file =</span> file_name, <span class="at">width =</span> <span class="dv">10</span>, <span class="at">height =</span> <span class="dv">12</span>)</span>
<span id="cb49-14"><a href="getting-started.html#cb49-14" tabindex="-1"></a>    <span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">2</span>), <span class="at">mar =</span> <span class="fu">c</span>(<span class="dv">4</span>, <span class="dv">4</span>, <span class="dv">2</span>, <span class="dv">2</span>))</span>
<span id="cb49-15"><a href="getting-started.html#cb49-15" tabindex="-1"></a>    <span class="cf">for</span> (i <span class="cf">in</span> start_idx<span class="sc">:</span>end_idx) {</span>
<span id="cb49-16"><a href="getting-started.html#cb49-16" tabindex="-1"></a>      other <span class="ot">&lt;-</span> all_catt[[i]]</span>
<span id="cb49-17"><a href="getting-started.html#cb49-17" tabindex="-1"></a>      main_label <span class="ot">&lt;-</span> plot_titles[i]</span>
<span id="cb49-18"><a href="getting-started.html#cb49-18" tabindex="-1"></a>      catt2 <span class="ot">&lt;-</span> other<span class="sc">$</span>catt</span>
<span id="cb49-19"><a href="getting-started.html#cb49-19" tabindex="-1"></a>      att2  <span class="ot">&lt;-</span> other<span class="sc">$</span>att[<span class="dv">1</span>]</span>
<span id="cb49-20"><a href="getting-started.html#cb49-20" tabindex="-1"></a>      id2   <span class="ot">&lt;-</span> <span class="cf">if</span> (<span class="sc">!</span><span class="fu">is.null</span>(other<span class="sc">$</span>id)) other<span class="sc">$</span>id <span class="cf">else</span> <span class="fu">seq_along</span>(catt2)</span>
<span id="cb49-21"><a href="getting-started.html#cb49-21" tabindex="-1"></a>      common_ids <span class="ot">&lt;-</span> <span class="fu">intersect</span>(id_ldw, id2)</span>
<span id="cb49-22"><a href="getting-started.html#cb49-22" tabindex="-1"></a>      idx_ldw    <span class="ot">&lt;-</span> <span class="fu">match</span>(common_ids, id_ldw)</span>
<span id="cb49-23"><a href="getting-started.html#cb49-23" tabindex="-1"></a>      idx_other  <span class="ot">&lt;-</span> <span class="fu">match</span>(common_ids, id2)</span>
<span id="cb49-24"><a href="getting-started.html#cb49-24" tabindex="-1"></a>      catt1_plot <span class="ot">&lt;-</span> catt_ldw[idx_ldw]</span>
<span id="cb49-25"><a href="getting-started.html#cb49-25" tabindex="-1"></a>      catt2_plot <span class="ot">&lt;-</span> catt2[idx_other]</span>
<span id="cb49-26"><a href="getting-started.html#cb49-26" tabindex="-1"></a>      <span class="fu">plot_catt</span>(</span>
<span id="cb49-27"><a href="getting-started.html#cb49-27" tabindex="-1"></a>        <span class="at">catt1 =</span> catt1_plot,</span>
<span id="cb49-28"><a href="getting-started.html#cb49-28" tabindex="-1"></a>        <span class="at">catt2 =</span> catt2_plot,</span>
<span id="cb49-29"><a href="getting-started.html#cb49-29" tabindex="-1"></a>        <span class="at">att1  =</span> att_ldw,</span>
<span id="cb49-30"><a href="getting-started.html#cb49-30" tabindex="-1"></a>        <span class="at">att2  =</span> att2,</span>
<span id="cb49-31"><a href="getting-started.html#cb49-31" tabindex="-1"></a>        <span class="at">xlab  =</span> <span class="st">&quot;CATT (Experimental)&quot;</span>,</span>
<span id="cb49-32"><a href="getting-started.html#cb49-32" tabindex="-1"></a>        <span class="at">ylab  =</span> main_label,</span>
<span id="cb49-33"><a href="getting-started.html#cb49-33" tabindex="-1"></a>        <span class="at">main  =</span> main_label,</span>
<span id="cb49-34"><a href="getting-started.html#cb49-34" tabindex="-1"></a>        <span class="at">axes.range =</span> range</span>
<span id="cb49-35"><a href="getting-started.html#cb49-35" tabindex="-1"></a>      )</span>
<span id="cb49-36"><a href="getting-started.html#cb49-36" tabindex="-1"></a>    }</span>
<span id="cb49-37"><a href="getting-started.html#cb49-37" tabindex="-1"></a>    <span class="co"># blanks if fewer than 4 plots on last page</span></span>
<span id="cb49-38"><a href="getting-started.html#cb49-38" tabindex="-1"></a>    <span class="cf">if</span> (plots_this_page <span class="sc">&lt;</span> plots_per_page) {</span>
<span id="cb49-39"><a href="getting-started.html#cb49-39" tabindex="-1"></a>      <span class="cf">for</span> (k <span class="cf">in</span> <span class="fu">seq_len</span>(plots_per_page <span class="sc">-</span> plots_this_page)) <span class="fu">plot.new</span>()</span>
<span id="cb49-40"><a href="getting-started.html#cb49-40" tabindex="-1"></a>    }</span>
<span id="cb49-41"><a href="getting-started.html#cb49-41" tabindex="-1"></a>    <span class="fu">dev.off</span>()</span>
<span id="cb49-42"><a href="getting-started.html#cb49-42" tabindex="-1"></a>  }</span>
<span id="cb49-43"><a href="getting-started.html#cb49-43" tabindex="-1"></a>}</span></code></pre></div>
<p><strong>Arguments</strong></p>
<ul>
<li><code>all_catt</code>: A list of objects containing conditional average treatment effect on treated (CATT) estimates.</li>
<li><code>plot_titles</code>: A character vector of titles for each plot, corresponding to the outputs in <code>all_catt</code>.</li>
<li><code>range</code>: A numeric vector of axis limits for plots (default c(-8000, 8000)).</li>
<li><code>prefix</code>: A string prefix for saved PDF filenames.</li>
<li><code>plots_per_page</code>: The number of plots to display per page / panel (default 4).</li>
</ul>
<p><code>eval_catt()</code> computes summary statistics of CATT vectors for each method, returning the minimum, maximum, mean, and range (difference) of the CATT estimates.</p>
<div class="sourceCode" id="cb50"><pre class="sourceCode r fold-hide"><code class="sourceCode r"><span id="cb50-1"><a href="getting-started.html#cb50-1" tabindex="-1"></a>eval_catt <span class="ot">&lt;-</span> <span class="cf">function</span>(all_catt, plot_titles) {</span>
<span id="cb50-2"><a href="getting-started.html#cb50-2" tabindex="-1"></a>  <span class="fu">do.call</span>(rbind, <span class="fu">lapply</span>(<span class="fu">seq_along</span>(all_catt), <span class="cf">function</span>(i) {</span>
<span id="cb50-3"><a href="getting-started.html#cb50-3" tabindex="-1"></a>    catt_vec <span class="ot">&lt;-</span> all_catt[[i]]<span class="sc">$</span>catt</span>
<span id="cb50-4"><a href="getting-started.html#cb50-4" tabindex="-1"></a>    <span class="fu">data.frame</span>(</span>
<span id="cb50-5"><a href="getting-started.html#cb50-5" tabindex="-1"></a>      <span class="at">Method =</span> plot_titles[i],</span>
<span id="cb50-6"><a href="getting-started.html#cb50-6" tabindex="-1"></a>      <span class="at">Min_Catt =</span> <span class="fu">min</span>(catt_vec, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb50-7"><a href="getting-started.html#cb50-7" tabindex="-1"></a>      <span class="at">Max_Catt =</span> <span class="fu">max</span>(catt_vec, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb50-8"><a href="getting-started.html#cb50-8" tabindex="-1"></a>      <span class="at">Mean_Catt =</span> <span class="fu">mean</span>(catt_vec, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb50-9"><a href="getting-started.html#cb50-9" tabindex="-1"></a>      <span class="at">Diff_Catt =</span> <span class="fu">max</span>(catt_vec, <span class="at">na.rm =</span> <span class="cn">TRUE</span>) <span class="sc">-</span> <span class="fu">min</span>(catt_vec, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb50-10"><a href="getting-started.html#cb50-10" tabindex="-1"></a>      <span class="at">stringsAsFactors =</span> <span class="cn">FALSE</span></span>
<span id="cb50-11"><a href="getting-started.html#cb50-11" tabindex="-1"></a>    )</span>
<span id="cb50-12"><a href="getting-started.html#cb50-12" tabindex="-1"></a>  }))</span>
<span id="cb50-13"><a href="getting-started.html#cb50-13" tabindex="-1"></a>}</span></code></pre></div>
<p><strong>Arguments</strong></p>
<ul>
<li><code>all_catt</code>: A list of objects containing conditional average treatment effect on treated (CATT) estimates.</li>
<li><code>plot_titles</code>: A character vector of titles for each plot, corresponding to the outputs in <code>all_catt</code>.</li>
</ul>
</div>
<div id="quantile-treatment-effect-on-treated-qtet" class="section level4 hasAnchor" number="1.2.5.3">
<h4><span class="header-section-number">1.2.5.3</span> Quantile treatment effect on treated (QTET)<a href="getting-started.html#quantile-treatment-effect-on-treated-qtet" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p><code>plot_qte_top()</code> plots QTET of top-ranked samples for comparison against an experimental benchmark.</p>
<div class="sourceCode" id="cb51"><pre class="sourceCode r fold-hide"><code class="sourceCode r"><span id="cb51-1"><a href="getting-started.html#cb51-1" tabindex="-1"></a>plot_qte_top <span class="ot">&lt;-</span> <span class="cf">function</span>(qtet_top, qtet_top0, bm, plot_titles, <span class="at">main_start =</span> <span class="dv">1</span>, <span class="at">ylim =</span> <span class="cn">NULL</span>, <span class="at">col =</span> <span class="cn">NULL</span>) {</span>
<span id="cb51-2"><a href="getting-started.html#cb51-2" tabindex="-1"></a>  n <span class="ot">&lt;-</span> <span class="fu">length</span>(qtet_top)</span>
<span id="cb51-3"><a href="getting-started.html#cb51-3" tabindex="-1"></a>  <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>n) {</span>
<span id="cb51-4"><a href="getting-started.html#cb51-4" tabindex="-1"></a>    main_title <span class="ot">&lt;-</span> plot_titles[main_start <span class="sc">+</span> i <span class="sc">-</span> <span class="dv">1</span>]</span>
<span id="cb51-5"><a href="getting-started.html#cb51-5" tabindex="-1"></a>    mod <span class="ot">&lt;-</span> qtet_top[[i]]</span>
<span id="cb51-6"><a href="getting-started.html#cb51-6" tabindex="-1"></a>    mod2 <span class="ot">&lt;-</span> qtet_top0[[i]]</span>
<span id="cb51-7"><a href="getting-started.html#cb51-7" tabindex="-1"></a>    <span class="fu">plot_qte</span>(mod, mod2, bm, <span class="at">main =</span> main_title, <span class="at">ylim =</span> ylim, <span class="at">col =</span> col)</span>
<span id="cb51-8"><a href="getting-started.html#cb51-8" tabindex="-1"></a>    <span class="fu">legend</span>(<span class="st">&quot;bottomleft&quot;</span>, <span class="at">legend =</span> <span class="fu">c</span>(<span class="st">&quot;Experimental&quot;</span>, <span class="st">&quot;Unadjusted&quot;</span>, <span class="st">&quot;Adjusted&quot;</span>),</span>
<span id="cb51-9"><a href="getting-started.html#cb51-9" tabindex="-1"></a>           <span class="at">lty =</span> <span class="dv">1</span>, <span class="at">pch =</span> <span class="fu">c</span>(<span class="dv">16</span>, <span class="dv">17</span>, <span class="dv">16</span>), <span class="at">col =</span> <span class="fu">c</span>(<span class="dv">4</span>, <span class="dv">2</span>, <span class="dv">1</span>), <span class="at">bty =</span> <span class="st">&quot;n&quot;</span>)</span>
<span id="cb51-10"><a href="getting-started.html#cb51-10" tabindex="-1"></a>  }</span>
<span id="cb51-11"><a href="getting-started.html#cb51-11" tabindex="-1"></a>}</span></code></pre></div>
<p><strong>Arguments</strong></p>
<ul>
<li><code>qtet_top</code>: A list of objects containing QTET estimates for top-ranked samples.</li>
<li><code>qtet_top0</code>: A list of objects containing unadjusted QTET estimates.</li>
<li><code>bm</code>: Experimental benchmark.</li>
<li><code>plot_titles</code>: A character vector of titles for each plot, matching the order of elements in <code>qtet_top</code>.</li>
<li><code>main_start</code>: Integer index specifying where to start selecting titles from <code>plot_titles</code> (default is 1).</li>
<li><code>ylim</code>: A numeric vector specifying the y-axis limits for the plots.</li>
<li><code>col</code>: Color specification.</li>
</ul>
<p><code>save_qtet()</code> generates and saves quantile treatment effect on the treated (QTET) plots for a given list of estimates.</p>
<div class="sourceCode" id="cb52"><pre class="sourceCode r fold-hide"><code class="sourceCode r"><span id="cb52-1"><a href="getting-started.html#cb52-1" tabindex="-1"></a>save_qtet <span class="ot">&lt;-</span> <span class="cf">function</span>(plots, <span class="at">plot_titles =</span> <span class="cn">NULL</span>, <span class="at">main_start =</span> <span class="dv">1</span>, <span class="at">ylim =</span> <span class="cn">NULL</span>, <span class="at">col =</span> <span class="cn">NULL</span>, <span class="at">prefix =</span> <span class="st">&quot;model_a&quot;</span>) {</span>
<span id="cb52-2"><a href="getting-started.html#cb52-2" tabindex="-1"></a>  <span class="fu">dir.create</span>(<span class="st">&quot;../graphs/lalonde&quot;</span>, <span class="at">showWarnings =</span> <span class="cn">FALSE</span>, <span class="at">recursive =</span> <span class="cn">TRUE</span>)</span>
<span id="cb52-3"><a href="getting-started.html#cb52-3" tabindex="-1"></a>  n <span class="ot">&lt;-</span> <span class="fu">length</span>(plots)</span>
<span id="cb52-4"><a href="getting-started.html#cb52-4" tabindex="-1"></a>  <span class="cf">for</span> (i <span class="cf">in</span> <span class="fu">seq_len</span>(n)) {</span>
<span id="cb52-5"><a href="getting-started.html#cb52-5" tabindex="-1"></a>    p <span class="ot">&lt;-</span> plots[[i]]</span>
<span id="cb52-6"><a href="getting-started.html#cb52-6" tabindex="-1"></a>    main_title <span class="ot">&lt;-</span> <span class="cf">if</span> (<span class="fu">is.null</span>(plot_titles)) p<span class="sc">$</span>main <span class="cf">else</span> plot_titles[main_start <span class="sc">+</span> i <span class="sc">-</span> <span class="dv">1</span>]</span>
<span id="cb52-7"><a href="getting-started.html#cb52-7" tabindex="-1"></a>    clean_title <span class="ot">&lt;-</span> <span class="fu">gsub</span>(<span class="st">&quot;[^a-zA-Z0-9]&quot;</span>, <span class="st">&quot;_&quot;</span>, main_title)</span>
<span id="cb52-8"><a href="getting-started.html#cb52-8" tabindex="-1"></a>    file_name <span class="ot">&lt;-</span> <span class="fu">sprintf</span>(<span class="st">&quot;../graphs/lalonde/%s_qtet_estimates_%s.pdf&quot;</span>, prefix, clean_title)</span>
<span id="cb52-9"><a href="getting-started.html#cb52-9" tabindex="-1"></a>    <span class="fu">pdf</span>(<span class="at">file =</span> file_name, <span class="at">width =</span> <span class="dv">7</span>, <span class="at">height =</span> <span class="dv">5</span>)</span>
<span id="cb52-10"><a href="getting-started.html#cb52-10" tabindex="-1"></a>    <span class="fu">plot_qte</span>(p<span class="sc">$</span>mod, p<span class="sc">$</span>mod0, p<span class="sc">$</span>bm, <span class="at">main =</span> main_title, <span class="at">ylim =</span> ylim, <span class="at">col =</span> col)</span>
<span id="cb52-11"><a href="getting-started.html#cb52-11" tabindex="-1"></a>    <span class="fu">legend</span>(<span class="st">&quot;bottomleft&quot;</span>, <span class="at">legend =</span> <span class="fu">c</span>(<span class="st">&quot;Experimental&quot;</span>, <span class="st">&quot;Unadjusted&quot;</span>, <span class="st">&quot;Adjusted&quot;</span>),</span>
<span id="cb52-12"><a href="getting-started.html#cb52-12" tabindex="-1"></a>           <span class="at">lty =</span> <span class="dv">1</span>, <span class="at">pch =</span> <span class="fu">c</span>(<span class="dv">16</span>, <span class="dv">17</span>, <span class="dv">16</span>), <span class="at">col =</span> <span class="fu">c</span>(<span class="dv">4</span>, <span class="dv">2</span>, <span class="dv">1</span>), <span class="at">bty =</span> <span class="st">&quot;n&quot;</span>)</span>
<span id="cb52-13"><a href="getting-started.html#cb52-13" tabindex="-1"></a>    <span class="fu">dev.off</span>()</span>
<span id="cb52-14"><a href="getting-started.html#cb52-14" tabindex="-1"></a>  }</span>
<span id="cb52-15"><a href="getting-started.html#cb52-15" tabindex="-1"></a>}</span></code></pre></div>
<p><strong>Arguments</strong></p>
<ul>
<li><code>plots</code>: A list of objects containing QTET estimates and corresponding unadjusted estimates.</li>
<li><code>plot_titles</code>: A character vector of titles for each plot, matching the order of elements in <code>plots</code>.</li>
<li><code>main_start</code>: Integer index specifying where to start selecting titles from <code>plot_titles</code> (default is 1).</li>
<li><code>ylim</code>: A numeric vector specifying the y-axis limits for the plots.</li>
<li><code>col</code>: Color specification.</li>
<li><code>prefix</code>: A string prefix for saved PDF filenames.</li>
</ul>
<p><code>save_qte_top()</code> generates and saves quantile treatment effect on the treated (QTET) plots for a given list of estimates of top-ranked samples.</p>
<div class="sourceCode" id="cb53"><pre class="sourceCode r fold-hide"><code class="sourceCode r"><span id="cb53-1"><a href="getting-started.html#cb53-1" tabindex="-1"></a>save_qte_top <span class="ot">&lt;-</span> <span class="cf">function</span>(qtet_top, qtet_top0, bm, plot_titles, <span class="at">main_start =</span> <span class="dv">1</span>,</span>
<span id="cb53-2"><a href="getting-started.html#cb53-2" tabindex="-1"></a>                                <span class="at">ylim =</span> <span class="cn">NULL</span>, <span class="at">col =</span> <span class="cn">NULL</span>, <span class="at">prefix =</span> <span class="st">&quot;model_a_top&quot;</span>) {</span>
<span id="cb53-3"><a href="getting-started.html#cb53-3" tabindex="-1"></a>  n <span class="ot">&lt;-</span> <span class="fu">length</span>(qtet_top)</span>
<span id="cb53-4"><a href="getting-started.html#cb53-4" tabindex="-1"></a>  <span class="fu">dir.create</span>(<span class="st">&quot;../graphs/lalonde&quot;</span>, <span class="at">showWarnings =</span> <span class="cn">FALSE</span>, <span class="at">recursive =</span> <span class="cn">TRUE</span>)</span>
<span id="cb53-5"><a href="getting-started.html#cb53-5" tabindex="-1"></a>  <span class="cf">for</span> (i <span class="cf">in</span> <span class="fu">seq_len</span>(n)) {</span>
<span id="cb53-6"><a href="getting-started.html#cb53-6" tabindex="-1"></a>    mod <span class="ot">&lt;-</span> qtet_top[[i]]</span>
<span id="cb53-7"><a href="getting-started.html#cb53-7" tabindex="-1"></a>    mod2 <span class="ot">&lt;-</span> qtet_top0[[i]]</span>
<span id="cb53-8"><a href="getting-started.html#cb53-8" tabindex="-1"></a>    main_title <span class="ot">&lt;-</span> plot_titles[main_start <span class="sc">+</span> i <span class="sc">-</span> <span class="dv">1</span>]</span>
<span id="cb53-9"><a href="getting-started.html#cb53-9" tabindex="-1"></a>    clean_title <span class="ot">&lt;-</span> <span class="fu">gsub</span>(<span class="st">&quot;[^a-zA-Z0-9]&quot;</span>, <span class="st">&quot;_&quot;</span>, main_title)</span>
<span id="cb53-10"><a href="getting-started.html#cb53-10" tabindex="-1"></a>    file_name <span class="ot">&lt;-</span> <span class="fu">sprintf</span>(<span class="st">&quot;../graphs/lalonde/%s_qte_estimates_%s.pdf&quot;</span>, prefix, clean_title)</span>
<span id="cb53-11"><a href="getting-started.html#cb53-11" tabindex="-1"></a>    <span class="fu">pdf</span>(<span class="at">file =</span> file_name, <span class="at">width =</span> <span class="dv">7</span>, <span class="at">height =</span> <span class="dv">5</span>)</span>
<span id="cb53-12"><a href="getting-started.html#cb53-12" tabindex="-1"></a>    <span class="fu">plot_qte</span>(mod, mod2, bm, <span class="at">main =</span> main_title, <span class="at">ylim =</span> ylim, <span class="at">col =</span> col)</span>
<span id="cb53-13"><a href="getting-started.html#cb53-13" tabindex="-1"></a>    <span class="fu">legend</span>(<span class="st">&quot;bottomleft&quot;</span>, <span class="at">legend =</span> <span class="fu">c</span>(<span class="st">&quot;Experimental&quot;</span>, <span class="st">&quot;Unadjusted&quot;</span>, <span class="st">&quot;Adjusted&quot;</span>),</span>
<span id="cb53-14"><a href="getting-started.html#cb53-14" tabindex="-1"></a>           <span class="at">lty =</span> <span class="dv">1</span>, <span class="at">pch =</span> <span class="fu">c</span>(<span class="dv">16</span>, <span class="dv">17</span>, <span class="dv">16</span>), <span class="at">col =</span> <span class="fu">c</span>(<span class="dv">4</span>, <span class="dv">2</span>, <span class="dv">1</span>), <span class="at">bty =</span> <span class="st">&quot;n&quot;</span>)</span>
<span id="cb53-15"><a href="getting-started.html#cb53-15" tabindex="-1"></a>    <span class="fu">dev.off</span>()</span>
<span id="cb53-16"><a href="getting-started.html#cb53-16" tabindex="-1"></a>  }</span>
<span id="cb53-17"><a href="getting-started.html#cb53-17" tabindex="-1"></a>}</span></code></pre></div>
<p><strong>Arguments</strong></p>
<ul>
<li><code>qtet_top</code>: A list of objects containing QTET estimates for top-ranked samples.</li>
<li><code>qtet_top0</code>: A list of objects containing unadjusted QTET estimates.</li>
<li><code>plot_titles</code>: A character vector of titles for each plot, matching the order of elements in <code>qtet_top</code>.</li>
<li><code>main_start</code>: Integer index specifying where to start selecting titles from <code>plot_titles</code> (default is 1).</li>
<li><code>ylim</code>: A numeric vector specifying the y-axis limits for the plots.</li>
<li><code>col</code>: Color specification.</li>
<li><code>prefix</code>: A string prefix for saved PDF filenames.</li>
</ul>
<p><br></p>
<p><a name="ow-ana"></a></p>
</div>
</div>
</div>
<div id="outcome-weights-analysis" class="section level2 hasAnchor" number="1.3">
<h2><span class="header-section-number">1.3</span> Outcome weights analysis<a href="getting-started.html#outcome-weights-analysis" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p><code>get_res_att()</code> estimates average treatment effects on the treated (ATT) using augmented inverse probability weighting with cross-fitting on a list of datasets.</p>
<div class="sourceCode" id="cb54"><pre class="sourceCode r fold-hide"><code class="sourceCode r"><span id="cb54-1"><a href="getting-started.html#cb54-1" tabindex="-1"></a>get_res_att <span class="ot">&lt;-</span> <span class="cf">function</span>(dataset_list, Y, treat, covar,</span>
<span id="cb54-2"><a href="getting-started.html#cb54-2" tabindex="-1"></a>                            <span class="at">estimators =</span> <span class="st">&quot;AIPW_ATT&quot;</span>,</span>
<span id="cb54-3"><a href="getting-started.html#cb54-3" tabindex="-1"></a>                            <span class="at">smoother =</span> <span class="st">&quot;honest_forest&quot;</span>,</span>
<span id="cb54-4"><a href="getting-started.html#cb54-4" tabindex="-1"></a>                            <span class="at">n_cf_folds =</span> <span class="dv">5</span>,</span>
<span id="cb54-5"><a href="getting-started.html#cb54-5" tabindex="-1"></a>                            <span class="at">n_reps =</span> <span class="dv">1</span>) {</span>
<span id="cb54-6"><a href="getting-started.html#cb54-6" tabindex="-1"></a>  <span class="fu">lapply</span>(dataset_list,</span>
<span id="cb54-7"><a href="getting-started.html#cb54-7" tabindex="-1"></a>      <span class="cf">function</span>(data) {</span>
<span id="cb54-8"><a href="getting-started.html#cb54-8" tabindex="-1"></a>        <span class="fu">dml_with_smoother</span>(</span>
<span id="cb54-9"><a href="getting-started.html#cb54-9" tabindex="-1"></a>          <span class="at">Y =</span> data[[Y]],</span>
<span id="cb54-10"><a href="getting-started.html#cb54-10" tabindex="-1"></a>          <span class="at">D =</span> data[[treat]],</span>
<span id="cb54-11"><a href="getting-started.html#cb54-11" tabindex="-1"></a>          <span class="at">X =</span> data[, covar, <span class="at">drop =</span> <span class="cn">FALSE</span>],</span>
<span id="cb54-12"><a href="getting-started.html#cb54-12" tabindex="-1"></a>          <span class="at">estimators =</span> estimators,</span>
<span id="cb54-13"><a href="getting-started.html#cb54-13" tabindex="-1"></a>          <span class="at">smoother =</span> smoother,</span>
<span id="cb54-14"><a href="getting-started.html#cb54-14" tabindex="-1"></a>          <span class="at">n_cf_folds =</span> n_cf_folds,</span>
<span id="cb54-15"><a href="getting-started.html#cb54-15" tabindex="-1"></a>          <span class="at">n_reps =</span> n_reps</span>
<span id="cb54-16"><a href="getting-started.html#cb54-16" tabindex="-1"></a>      )</span>
<span id="cb54-17"><a href="getting-started.html#cb54-17" tabindex="-1"></a>    }</span>
<span id="cb54-18"><a href="getting-started.html#cb54-18" tabindex="-1"></a>  )</span>
<span id="cb54-19"><a href="getting-started.html#cb54-19" tabindex="-1"></a>}</span></code></pre></div>
<p><strong>Arguments</strong></p>
<ul>
<li><code>dataset_list</code>: A list of input datasets.</li>
<li><code>Y</code>: String specifying the name of the outcome variable.</li>
<li><code>treat</code>: String specifying the name of the binary treatment indicator variable.</li>
<li><code>covar</code>: A vector of covariate names.</li>
<li><code>estimators</code>: String specifying the estimator to use (default is “AIPW_ATT”).</li>
<li><code>smoother</code>: String specifying the smoothing method (default is “honest_forest”).</li>
<li><code>n_cf_folds</code>: Integer specifying the number of cross-fitting folds (default is 5).</li>
<li><code>n_reps</code>: Integer specifying the number of repetitions for robustness (default is 1).</li>
</ul>
<p><code>derive_ow()</code> extracts outcome weights from a list of estimation results.</p>
<div class="sourceCode" id="cb55"><pre class="sourceCode r fold-hide"><code class="sourceCode r"><span id="cb55-1"><a href="getting-started.html#cb55-1" tabindex="-1"></a>derive_ow <span class="ot">&lt;-</span> <span class="cf">function</span>(results_list) {</span>
<span id="cb55-2"><a href="getting-started.html#cb55-2" tabindex="-1"></a><span class="fu">lapply</span>(results_list, <span class="cf">function</span>(res) <span class="fu">get_outcome_weights</span>(res))</span>
<span id="cb55-3"><a href="getting-started.html#cb55-3" tabindex="-1"></a>}</span></code></pre></div>
<p><strong>Argument</strong></p>
<ul>
<li><code>results_list</code>: A list of objects obtained from <code>get_res_att()</code>.</li>
</ul>
<p><code>plot_ow()</code></p>
<div class="sourceCode" id="cb56"><pre class="sourceCode r fold-hide"><code class="sourceCode r"><span id="cb56-1"><a href="getting-started.html#cb56-1" tabindex="-1"></a>plot_ow <span class="ot">&lt;-</span> <span class="cf">function</span>(outcome_weights, <span class="at">plot_titles =</span> <span class="cn">NULL</span>, <span class="at">breaks =</span> <span class="dv">50</span>, </span>
<span id="cb56-2"><a href="getting-started.html#cb56-2" tabindex="-1"></a>                    <span class="at">col =</span> <span class="st">&quot;#ff000080&quot;</span>, <span class="at">xlab =</span> <span class="st">&quot;Outcome Weight&quot;</span>, </span>
<span id="cb56-3"><a href="getting-started.html#cb56-3" tabindex="-1"></a>                    <span class="at">estimator =</span> <span class="st">&quot;AIPW-ATT&quot;</span>) {</span>
<span id="cb56-4"><a href="getting-started.html#cb56-4" tabindex="-1"></a>  N <span class="ot">&lt;-</span> <span class="fu">length</span>(outcome_weights)</span>
<span id="cb56-5"><a href="getting-started.html#cb56-5" tabindex="-1"></a>  <span class="cf">for</span> (i <span class="cf">in</span> <span class="fu">seq_len</span>(N)) {</span>
<span id="cb56-6"><a href="getting-started.html#cb56-6" tabindex="-1"></a>    weights <span class="ot">&lt;-</span> outcome_weights[[i]]<span class="sc">$</span>omega[estimator, ]</span>
<span id="cb56-7"><a href="getting-started.html#cb56-7" tabindex="-1"></a>    main_title <span class="ot">&lt;-</span> <span class="cf">if</span> (<span class="sc">!</span><span class="fu">is.null</span>(plot_titles)) plot_titles[i] <span class="cf">else</span> <span class="fu">paste</span>(<span class="st">&quot;Dataset&quot;</span>, i)</span>
<span id="cb56-8"><a href="getting-started.html#cb56-8" tabindex="-1"></a>    <span class="fu">hist</span>(weights, <span class="at">breaks =</span> breaks, <span class="at">main =</span> main_title, <span class="at">xlab =</span> xlab, <span class="at">col =</span> col)</span>
<span id="cb56-9"><a href="getting-started.html#cb56-9" tabindex="-1"></a>    <span class="fu">mtext</span>(<span class="fu">paste</span>(<span class="st">&quot;N =&quot;</span>, <span class="fu">length</span>(weights)), <span class="at">side =</span> <span class="dv">3</span>, <span class="at">line =</span> <span class="sc">-</span><span class="fl">1.5</span>, <span class="at">cex =</span> <span class="fl">0.8</span>)</span>
<span id="cb56-10"><a href="getting-started.html#cb56-10" tabindex="-1"></a>  }</span>
<span id="cb56-11"><a href="getting-started.html#cb56-11" tabindex="-1"></a>  <span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">1</span>))</span>
<span id="cb56-12"><a href="getting-started.html#cb56-12" tabindex="-1"></a>}</span></code></pre></div>
<p><strong>Arguments</strong></p>
<ul>
<li><code>outcome_weights</code>: A list of outcome weight objects.</li>
<li><code>plot_titles</code>: A character vector of titles for each plot.</li>
<li><code>breaks</code>: Integer specifying the number of bins for the histogram plots (default is 50).</li>
<li><code>col</code>: Color specification (default is “#ff000080”).</li>
<li><code>xlab</code>: String specifying the label for the x-axis (default is “Outcome Weight”)</li>
<li><code>estimator</code>: String specifying the estimator to use (default is “AIPW-ATT”).</li>
</ul>
<p><code>eval_ow()</code> computes summary statistics of outcome weights by treatment group for a list of datasets and returns a data frame for comparison.</p>
<div class="sourceCode" id="cb57"><pre class="sourceCode r fold-hide"><code class="sourceCode r"><span id="cb57-1"><a href="getting-started.html#cb57-1" tabindex="-1"></a>eval_ow <span class="ot">&lt;-</span> <span class="cf">function</span>(outcome_weights, dataset_list, <span class="at">plot_titles =</span> <span class="cn">NULL</span>, <span class="at">treat_var =</span> <span class="st">&quot;treat&quot;</span>, <span class="at">estimand =</span> <span class="st">&quot;AIPW-ATT&quot;</span>) {</span>
<span id="cb57-2"><a href="getting-started.html#cb57-2" tabindex="-1"></a>  results <span class="ot">&lt;-</span> <span class="fu">lapply</span>(<span class="fu">seq_along</span>(outcome_weights), <span class="cf">function</span>(i) {</span>
<span id="cb57-3"><a href="getting-started.html#cb57-3" tabindex="-1"></a>    ow <span class="ot">&lt;-</span> outcome_weights[[i]]<span class="sc">$</span>omega[estimand, ]</span>
<span id="cb57-4"><a href="getting-started.html#cb57-4" tabindex="-1"></a>    treat <span class="ot">&lt;-</span> dataset_list[[i]][[treat_var]]</span>
<span id="cb57-5"><a href="getting-started.html#cb57-5" tabindex="-1"></a>    method <span class="ot">&lt;-</span> <span class="cf">if</span> (<span class="sc">!</span><span class="fu">is.null</span>(plot_titles)) plot_titles[i] <span class="cf">else</span> <span class="fu">paste</span>(<span class="st">&quot;Dataset&quot;</span>, i)</span>
<span id="cb57-6"><a href="getting-started.html#cb57-6" tabindex="-1"></a>    sum_treated <span class="ot">&lt;-</span> <span class="fu">sum</span>(ow[treat <span class="sc">==</span> <span class="dv">1</span>])</span>
<span id="cb57-7"><a href="getting-started.html#cb57-7" tabindex="-1"></a>    sum_untreated <span class="ot">&lt;-</span> <span class="fu">sum</span>(ow[treat <span class="sc">==</span> <span class="dv">0</span>])</span>
<span id="cb57-8"><a href="getting-started.html#cb57-8" tabindex="-1"></a>    <span class="fu">data.frame</span>(</span>
<span id="cb57-9"><a href="getting-started.html#cb57-9" tabindex="-1"></a>      <span class="at">Method =</span> method,</span>
<span id="cb57-10"><a href="getting-started.html#cb57-10" tabindex="-1"></a>      <span class="at">Sum_Treated =</span> sum_treated,</span>
<span id="cb57-11"><a href="getting-started.html#cb57-11" tabindex="-1"></a>      <span class="at">Sum_Untreated =</span> sum_untreated,</span>
<span id="cb57-12"><a href="getting-started.html#cb57-12" tabindex="-1"></a>      <span class="at">stringsAsFactors =</span> <span class="cn">FALSE</span></span>
<span id="cb57-13"><a href="getting-started.html#cb57-13" tabindex="-1"></a>    )</span>
<span id="cb57-14"><a href="getting-started.html#cb57-14" tabindex="-1"></a>  })</span>
<span id="cb57-15"><a href="getting-started.html#cb57-15" tabindex="-1"></a>  <span class="fu">do.call</span>(rbind, results)</span>
<span id="cb57-16"><a href="getting-started.html#cb57-16" tabindex="-1"></a>}</span></code></pre></div>
<p>**Arguments*</p>
<ul>
<li><code>outcome_weights</code>: A list of outcome weight objects.</li>
<li><code>plot_titles</code>: A character vector of titles for each plot.</li>
<li><code>treat_var</code>: String specifying the treatment variable in each dataset (default is “treat”).</li>
<li><code>estimator</code>: String specifying the estimator to use (default is “AIPW-ATT”).</li>
</ul>
<p><code>save_ow()</code> saves the outcome weight histograms as PDF files, one per dataset, with optional custom titles and formatting.</p>
<div class="sourceCode" id="cb58"><pre class="sourceCode r fold-hide"><code class="sourceCode r"><span id="cb58-1"><a href="getting-started.html#cb58-1" tabindex="-1"></a>save_ow <span class="ot">&lt;-</span> <span class="cf">function</span>(outcome_weights, <span class="at">plot_titles =</span> <span class="cn">NULL</span>,</span>
<span id="cb58-2"><a href="getting-started.html#cb58-2" tabindex="-1"></a>                    <span class="at">breaks =</span> <span class="dv">50</span>, <span class="at">col =</span> <span class="st">&quot;#ff000080&quot;</span>, <span class="at">xlab =</span> <span class="st">&quot;Outcome Weight&quot;</span>,</span>
<span id="cb58-3"><a href="getting-started.html#cb58-3" tabindex="-1"></a>                    <span class="at">prefix =</span> <span class="st">&quot;model_a&quot;</span>, <span class="at">estimator =</span> <span class="st">&quot;AIPW-ATT&quot;</span>) {</span>
<span id="cb58-4"><a href="getting-started.html#cb58-4" tabindex="-1"></a>  <span class="fu">dir.create</span>(<span class="st">&quot;../graphs/lalonde&quot;</span>, <span class="at">showWarnings =</span> <span class="cn">FALSE</span>, <span class="at">recursive =</span> <span class="cn">TRUE</span>)</span>
<span id="cb58-5"><a href="getting-started.html#cb58-5" tabindex="-1"></a>  N <span class="ot">&lt;-</span> <span class="fu">length</span>(outcome_weights)</span>
<span id="cb58-6"><a href="getting-started.html#cb58-6" tabindex="-1"></a>  <span class="cf">for</span> (i <span class="cf">in</span> <span class="fu">seq_len</span>(N)) {</span>
<span id="cb58-7"><a href="getting-started.html#cb58-7" tabindex="-1"></a>    file_name <span class="ot">&lt;-</span> <span class="fu">sprintf</span>(<span class="st">&quot;../graphs/lalonde/%s_outcomewt_%d.pdf&quot;</span>, prefix, i)</span>
<span id="cb58-8"><a href="getting-started.html#cb58-8" tabindex="-1"></a>    <span class="fu">pdf</span>(<span class="at">file =</span> file_name, <span class="at">width =</span> <span class="dv">8</span>, <span class="at">height =</span> <span class="dv">6</span>)</span>
<span id="cb58-9"><a href="getting-started.html#cb58-9" tabindex="-1"></a>    weights <span class="ot">&lt;-</span> outcome_weights[[i]]<span class="sc">$</span>omega[estimator, ]</span>
<span id="cb58-10"><a href="getting-started.html#cb58-10" tabindex="-1"></a>    main_title <span class="ot">&lt;-</span> <span class="cf">if</span> (<span class="sc">!</span><span class="fu">is.null</span>(plot_titles)) plot_titles[i] <span class="cf">else</span> <span class="fu">paste</span>(<span class="st">&quot;Dataset&quot;</span>, i)</span>
<span id="cb58-11"><a href="getting-started.html#cb58-11" tabindex="-1"></a>    <span class="fu">hist</span>(weights, <span class="at">breaks =</span> breaks, <span class="at">main =</span> main_title, <span class="at">xlab =</span> xlab, <span class="at">col =</span> col)</span>
<span id="cb58-12"><a href="getting-started.html#cb58-12" tabindex="-1"></a>    <span class="fu">mtext</span>(<span class="fu">paste</span>(<span class="st">&quot;N =&quot;</span>, <span class="fu">length</span>(weights)), <span class="at">side =</span> <span class="dv">3</span>, <span class="at">line =</span> <span class="sc">-</span><span class="fl">1.5</span>, <span class="at">cex =</span> <span class="fl">0.8</span>)</span>
<span id="cb58-13"><a href="getting-started.html#cb58-13" tabindex="-1"></a>    <span class="fu">dev.off</span>()</span>
<span id="cb58-14"><a href="getting-started.html#cb58-14" tabindex="-1"></a>  }</span>
<span id="cb58-15"><a href="getting-started.html#cb58-15" tabindex="-1"></a>}</span></code></pre></div>
<p><strong>Argument</strong></p>
<ul>
<li><code>outcome_weights</code>: A list of outcome weight objects.</li>
<li><code>plot_titles</code>: A character vector of titles for each plot.</li>
<li><code>breaks</code>: Integer specifying the number of bins for the histogram plots (default is 50).</li>
<li><code>col</code>: Color specification (default is “#ff000080”).</li>
<li><code>xlab</code>: String specifying the label for the x-axis (default is “Outcome Weight”)</li>
<li><code>prefix</code>: A string prefix for saved PDF filenames.</li>
<li><code>estimator</code>: String specifying the estimator to use (default is “AIPW-ATT”).</li>
</ul>
<p><a name="sens-ana"></a></p>
</div>
<div id="sensitivity-analysis" class="section level2 hasAnchor" number="1.4">
<h2><span class="header-section-number">1.4</span> Sensitivity analysis<a href="getting-started.html#sensitivity-analysis" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p><code>check_filter_datasets()</code> filters a list of datasets to retain only those with all required variables, no missing data, binary treatment, and sufficient baseline/covariate variation.</p>
<div class="sourceCode" id="cb59"><pre class="sourceCode r fold-hide"><code class="sourceCode r"><span id="cb59-1"><a href="getting-started.html#cb59-1" tabindex="-1"></a>check_filter_datasets <span class="ot">&lt;-</span> <span class="cf">function</span>(datasets, Y, treat, covar, bm) {</span>
<span id="cb59-2"><a href="getting-started.html#cb59-2" tabindex="-1"></a>  valid_datasets <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb59-3"><a href="getting-started.html#cb59-3" tabindex="-1"></a>  <span class="cf">for</span> (i <span class="cf">in</span> <span class="fu">seq_along</span>(datasets)) {</span>
<span id="cb59-4"><a href="getting-started.html#cb59-4" tabindex="-1"></a>    data <span class="ot">&lt;-</span> datasets[[i]]</span>
<span id="cb59-5"><a href="getting-started.html#cb59-5" tabindex="-1"></a>    name <span class="ot">&lt;-</span> <span class="fu">names</span>(datasets)[i]</span>
<span id="cb59-6"><a href="getting-started.html#cb59-6" tabindex="-1"></a>    <span class="cf">if</span> (<span class="fu">is.null</span>(name) <span class="sc">||</span> name <span class="sc">==</span> <span class="st">&quot;&quot;</span>) name <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">&quot;dataset_&quot;</span>, i)  <span class="co"># provide a name if missing</span></span>
<span id="cb59-7"><a href="getting-started.html#cb59-7" tabindex="-1"></a>    vars_needed <span class="ot">&lt;-</span> <span class="fu">c</span>(Y, treat, covar, bm)</span>
<span id="cb59-8"><a href="getting-started.html#cb59-8" tabindex="-1"></a>    <span class="cf">if</span> (<span class="sc">!</span><span class="fu">all</span>(vars_needed <span class="sc">%in%</span> <span class="fu">names</span>(data))) { <span class="co"># check all variables exist</span></span>
<span id="cb59-9"><a href="getting-started.html#cb59-9" tabindex="-1"></a>      <span class="fu">message</span>(<span class="st">&quot;Removed &quot;</span>, name, <span class="st">&quot;: missing required variables&quot;</span>) </span>
<span id="cb59-10"><a href="getting-started.html#cb59-10" tabindex="-1"></a>      <span class="cf">next</span></span>
<span id="cb59-11"><a href="getting-started.html#cb59-11" tabindex="-1"></a>    }</span>
<span id="cb59-12"><a href="getting-started.html#cb59-12" tabindex="-1"></a>    sub <span class="ot">&lt;-</span> data[, vars_needed, drop <span class="ot">=</span> <span class="cn">FALSE</span>]</span>
<span id="cb59-13"><a href="getting-started.html#cb59-13" tabindex="-1"></a>    <span class="cf">if</span> (<span class="fu">any</span>(<span class="fu">is.na</span>(sub))) { <span class="co"># check no missing values</span></span>
<span id="cb59-14"><a href="getting-started.html#cb59-14" tabindex="-1"></a>      <span class="fu">message</span>(<span class="st">&quot;Removed &quot;</span>, name, <span class="st">&quot;: contains missing values&quot;</span>) </span>
<span id="cb59-15"><a href="getting-started.html#cb59-15" tabindex="-1"></a>      <span class="cf">next</span></span>
<span id="cb59-16"><a href="getting-started.html#cb59-16" tabindex="-1"></a>    }</span>
<span id="cb59-17"><a href="getting-started.html#cb59-17" tabindex="-1"></a>    tvals <span class="ot">&lt;-</span> <span class="fu">unique</span>(sub[[treat]])  <span class="co"># check treatment binary</span></span>
<span id="cb59-18"><a href="getting-started.html#cb59-18" tabindex="-1"></a>    <span class="cf">if</span> (<span class="sc">!</span><span class="fu">all</span>(tvals <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>)) <span class="sc">&amp;&amp;</span> <span class="sc">!</span><span class="fu">all</span>(tvals <span class="sc">%in%</span> <span class="fu">c</span>(<span class="cn">TRUE</span>, <span class="cn">FALSE</span>))) {</span>
<span id="cb59-19"><a href="getting-started.html#cb59-19" tabindex="-1"></a>      <span class="fu">message</span>(<span class="st">&quot;Removed &quot;</span>, name, <span class="st">&quot;: treatment variable not binary&quot;</span>)</span>
<span id="cb59-20"><a href="getting-started.html#cb59-20" tabindex="-1"></a>      <span class="cf">next</span></span>
<span id="cb59-21"><a href="getting-started.html#cb59-21" tabindex="-1"></a>    }</span>
<span id="cb59-22"><a href="getting-started.html#cb59-22" tabindex="-1"></a>    <span class="cf">if</span> (<span class="fu">any</span>(<span class="fu">sapply</span>(sub[bm], <span class="cf">function</span>(x) <span class="fu">length</span>(<span class="fu">unique</span>(x)) <span class="sc">&lt;=</span> <span class="dv">1</span>))) { <span class="co"># check baseline variables have variation</span></span>
<span id="cb59-23"><a href="getting-started.html#cb59-23" tabindex="-1"></a>      <span class="fu">message</span>(<span class="st">&quot;Removed &quot;</span>, name, <span class="st">&quot;: baseline variable(s) lack variation&quot;</span>) </span>
<span id="cb59-24"><a href="getting-started.html#cb59-24" tabindex="-1"></a>      <span class="cf">next</span></span>
<span id="cb59-25"><a href="getting-started.html#cb59-25" tabindex="-1"></a>    }</span>
<span id="cb59-26"><a href="getting-started.html#cb59-26" tabindex="-1"></a>    <span class="cf">if</span> (<span class="fu">any</span>(<span class="fu">sapply</span>(sub[covar], <span class="cf">function</span>(x) <span class="fu">length</span>(<span class="fu">unique</span>(x)) <span class="sc">&lt;=</span> <span class="dv">1</span>))) { <span class="co"># check covariates have variation</span></span>
<span id="cb59-27"><a href="getting-started.html#cb59-27" tabindex="-1"></a>      <span class="fu">message</span>(<span class="st">&quot;Removed &quot;</span>, name, <span class="st">&quot;: covariate variable(s) lack variation&quot;</span>)</span>
<span id="cb59-28"><a href="getting-started.html#cb59-28" tabindex="-1"></a>      <span class="cf">next</span></span>
<span id="cb59-29"><a href="getting-started.html#cb59-29" tabindex="-1"></a>    }</span>
<span id="cb59-30"><a href="getting-started.html#cb59-30" tabindex="-1"></a>    valid_datasets[[name]] <span class="ot">&lt;-</span> data <span class="co"># if all passed dataset is kept</span></span>
<span id="cb59-31"><a href="getting-started.html#cb59-31" tabindex="-1"></a>  }</span>
<span id="cb59-32"><a href="getting-started.html#cb59-32" tabindex="-1"></a>  <span class="fu">return</span>(valid_datasets)</span>
<span id="cb59-33"><a href="getting-started.html#cb59-33" tabindex="-1"></a>}</span></code></pre></div>
<p><strong>Arguments</strong></p>
<ul>
<li><code>datasets</code>: The input datasets.</li>
<li><code>Y</code>: The name of the outcome variable.</li>
<li><code>treat</code>: The name of the binary treatment indicator variable.</li>
<li><code>covar</code>: A vector of covariate names.</li>
<li><code>bm</code>: A vector of baseline variable names.</li>
</ul>
<p><code>save_sensitivity_plots()</code> generates sensitivity analysis plots for a series of filtered datasets, saving each as a pdf file.</p>
<div class="sourceCode" id="cb60"><pre class="sourceCode r fold-hide"><code class="sourceCode r"><span id="cb60-1"><a href="getting-started.html#cb60-1" tabindex="-1"></a>save_sensitivity_plots <span class="ot">&lt;-</span> <span class="cf">function</span>(filtered_datasets, Y, treat, covar, bm, plot_titles, prefix) {</span>
<span id="cb60-2"><a href="getting-started.html#cb60-2" tabindex="-1"></a>  folder <span class="ot">&lt;-</span> <span class="st">&quot;../graphs/lalonde&quot;</span></span>
<span id="cb60-3"><a href="getting-started.html#cb60-3" tabindex="-1"></a>  <span class="cf">if</span> (<span class="sc">!</span><span class="fu">dir.exists</span>(folder)) <span class="fu">dir.create</span>(folder, <span class="at">recursive =</span> <span class="cn">TRUE</span>)</span>
<span id="cb60-4"><a href="getting-started.html#cb60-4" tabindex="-1"></a>  <span class="cf">for</span> (i <span class="cf">in</span> <span class="fu">seq_along</span>(filtered_datasets)) {</span>
<span id="cb60-5"><a href="getting-started.html#cb60-5" tabindex="-1"></a>    idx <span class="ot">&lt;-</span> i</span>
<span id="cb60-6"><a href="getting-started.html#cb60-6" tabindex="-1"></a>    file_name <span class="ot">&lt;-</span> <span class="fu">file.path</span>(folder, <span class="fu">paste0</span>(prefix, <span class="st">&quot;_sensitivity_&quot;</span>, idx, <span class="st">&quot;.pdf&quot;</span>))</span>
<span id="cb60-7"><a href="getting-started.html#cb60-7" tabindex="-1"></a>    <span class="fu">pdf</span>(file_name, <span class="at">width =</span> <span class="dv">8</span>, <span class="at">height =</span> <span class="dv">8</span>)</span>
<span id="cb60-8"><a href="getting-started.html#cb60-8" tabindex="-1"></a>    <span class="fu">sens_ana</span>(filtered_datasets[[i]], Y, treat, covar, bm, <span class="at">kd =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>)</span>
<span id="cb60-9"><a href="getting-started.html#cb60-9" tabindex="-1"></a>    <span class="cf">if</span> (<span class="sc">!</span><span class="fu">missing</span>(plot_titles) <span class="sc">&amp;&amp;</span> <span class="fu">length</span>(plot_titles) <span class="sc">&gt;=</span> idx) {</span>
<span id="cb60-10"><a href="getting-started.html#cb60-10" tabindex="-1"></a>      <span class="fu">title</span>(<span class="at">main =</span> plot_titles[idx])</span>
<span id="cb60-11"><a href="getting-started.html#cb60-11" tabindex="-1"></a>    }</span>
<span id="cb60-12"><a href="getting-started.html#cb60-12" tabindex="-1"></a>    <span class="fu">dev.off</span>()</span>
<span id="cb60-13"><a href="getting-started.html#cb60-13" tabindex="-1"></a> }</span>
<span id="cb60-14"><a href="getting-started.html#cb60-14" tabindex="-1"></a>}</span></code></pre></div>
<p><strong>Arguments</strong></p>
<ul>
<li><code>filtered_datasets</code>: A list of filtered datasets.</li>
<li><code>Y</code>: The name of the outcome variable.</li>
<li><code>treat</code>: The name of the binary treatment indicator variable.</li>
<li><code>covar</code>: A vector of covariate names.</li>
<li><code>bm</code>: A vector of baseline variable names.</li>
<li><code>plot_titles</code>: A vector of titles for plots corresponding to datasets.</li>
<li><code>prefix</code>: String prefix for saving output PDF files.</li>
</ul>
<div class="callout-note">
<p>Please refer to the accompanying paper for a detailed explanation of the metrics used in the analysis, including absolute standardized mean differences (SMDs), effective sample sizes (ESS), and the composite scoring approach employed to evaluate covariate balance and overlap across multiple methods.</p>
</div>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="index.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="references.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
  "sharing": {
    "github": false,
    "facebook": true,
    "twitter": true,
    "linkedin": false,
    "weibo": false,
    "instapaper": false,
    "vk": false,
    "whatsapp": false,
    "all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
  },
  "fontsettings": {
    "theme": "white",
    "family": "sans",
    "size": 2
  },
  "edit": {
    "link": "https://github.com/USERNAME/REPO/edit/BRANCH/tutorial/01-Start.Rmd",
    "text": "Edit"
  },
  "history": {
    "link": null,
    "text": null
  },
  "view": {
    "link": null,
    "text": null
  },
  "download": ["Outcome-Weights.pdf", "Outcome-Weights.epub"],
  "search": {
    "engine": "fuse",
    "options": null
  },
  "toc": {
    "collapse": "subsection"
  }
});
});
</script>

</body>

</html>

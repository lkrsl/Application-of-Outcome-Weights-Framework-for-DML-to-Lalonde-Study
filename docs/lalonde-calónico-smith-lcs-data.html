<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 1 LaLonde-Calónico-Smith (LCS) Data | Application of the Outcome Weights Framework for Double Machine Learning to the Lalonde Study</title>
  <meta name="description" content="<p>This book replicates the LaLonde study by Imbens &amp; Xu (2024) and extends it by comparing a
full with a reduced covariate model to mitigate potential confounding.
It evaluates various methods to improve overlap and covariate balance for robust
treatment effect estimation and applies the outcome weights framework by Knaus &amp; Pfleiderer (2024)
to assess another estimator and analyse the distributional properties of outcome weights.
The analysis draws on the original LaLonde dataset as well as the LaLonde–Dehejia–Wahba (LDW) and LaLonde–Calónico–Smith (LCS) datasets.</p>" />
  <meta name="generator" content="bookdown 0.45 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 1 LaLonde-Calónico-Smith (LCS) Data | Application of the Outcome Weights Framework for Double Machine Learning to the Lalonde Study" />
  <meta property="og:type" content="book" />
  
  <meta property="og:description" content="<p>This book replicates the LaLonde study by Imbens &amp; Xu (2024) and extends it by comparing a
full with a reduced covariate model to mitigate potential confounding.
It evaluates various methods to improve overlap and covariate balance for robust
treatment effect estimation and applies the outcome weights framework by Knaus &amp; Pfleiderer (2024)
to assess another estimator and analyse the distributional properties of outcome weights.
The analysis draws on the original LaLonde dataset as well as the LaLonde–Dehejia–Wahba (LDW) and LaLonde–Calónico–Smith (LCS) datasets.</p>" />
  <meta name="github-repo" content="lkrsl/Application-of-Outcome-Weights-Framework-for-DML-to-Lalonde-Study" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 1 LaLonde-Calónico-Smith (LCS) Data | Application of the Outcome Weights Framework for Double Machine Learning to the Lalonde Study" />
  
  <meta name="twitter:description" content="<p>This book replicates the LaLonde study by Imbens &amp; Xu (2024) and extends it by comparing a
full with a reduced covariate model to mitigate potential confounding.
It evaluates various methods to improve overlap and covariate balance for robust
treatment effect estimation and applies the outcome weights framework by Knaus &amp; Pfleiderer (2024)
to assess another estimator and analyse the distributional properties of outcome weights.
The analysis draws on the original LaLonde dataset as well as the LaLonde–Dehejia–Wahba (LDW) and LaLonde–Calónico–Smith (LCS) datasets.</p>" />
  

<meta name="author" content="Laura Kreisel" />


<meta name="date" content="2025-11-13" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="index.html"/>
<link rel="next" href="references.html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>
<link href="libs/htmltools-fill-0.5.8.1/fill.css" rel="stylesheet" />
<script src="libs/htmlwidgets-1.6.4/htmlwidgets.js"></script>
<link href="libs/datatables-css-0.0.0/datatables-crosstalk.css" rel="stylesheet" />
<script src="libs/datatables-binding-0.34.0/datatables.js"></script>
<link href="libs/dt-core-1.13.6/css/jquery.dataTables.min.css" rel="stylesheet" />
<link href="libs/dt-core-1.13.6/css/jquery.dataTables.extra.css" rel="stylesheet" />
<script src="libs/dt-core-1.13.6/js/jquery.dataTables.min.js"></script>
<link href="libs/crosstalk-1.2.2/css/crosstalk.min.css" rel="stylesheet" />
<script src="libs/crosstalk-1.2.2/js/crosstalk.min.js"></script>


<style type="text/css">
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
  
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
</style>
<style type="text/css">
/* Used with Pandoc 2.11+ new --citeproc when CSL is used */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
  margin-bottom: 0em;
}
.hanging div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}
</style>

<link rel="stylesheet" href="tutorial/style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Application of Outcome Weights Framework for DML to Lalonde Study</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Preface</a></li>
<li class="chapter" data-level="1" data-path="lalonde-calónico-smith-lcs-data.html"><a href="lalonde-calónico-smith-lcs-data.html"><i class="fa fa-check"></i><b>1</b> LaLonde-Calónico-Smith (LCS) Data</a>
<ul>
<li class="chapter" data-level="1.1" data-path="lalonde-calónico-smith-lcs-data.html"><a href="lalonde-calónico-smith-lcs-data.html#set-up"><i class="fa fa-check"></i><b>1.1</b> Set up</a>
<ul>
<li class="chapter" data-level="1.1.1" data-path="lalonde-calónico-smith-lcs-data.html"><a href="lalonde-calónico-smith-lcs-data.html#source-functions-and-load-data"><i class="fa fa-check"></i><b>1.1.1</b> Source functions and load data</a></li>
<li class="chapter" data-level="1.1.2" data-path="lalonde-calónico-smith-lcs-data.html"><a href="lalonde-calónico-smith-lcs-data.html#load-and-preprocess-data"><i class="fa fa-check"></i><b>1.1.2</b> Load and preprocess data</a></li>
<li class="chapter" data-level="1.1.3" data-path="lalonde-calónico-smith-lcs-data.html"><a href="lalonde-calónico-smith-lcs-data.html#inspect-data"><i class="fa fa-check"></i><b>1.1.3</b> Inspect data</a></li>
</ul></li>
<li class="chapter" data-level="1.2" data-path="lalonde-calónico-smith-lcs-data.html"><a href="lalonde-calónico-smith-lcs-data.html#model"><i class="fa fa-check"></i><b>1.2</b> Model</a>
<ul>
<li class="chapter" data-level="1.2.1" data-path="lalonde-calónico-smith-lcs-data.html"><a href="lalonde-calónico-smith-lcs-data.html#assessing-overlap-and-covariate-balance"><i class="fa fa-check"></i><b>1.2.1</b> Assessing overlap and covariate balance</a></li>
</ul></li>
<li class="chapter" data-level="1.3" data-path="lalonde-calónico-smith-lcs-data.html"><a href="lalonde-calónico-smith-lcs-data.html#improving-primarily-covariate-balance"><i class="fa fa-check"></i><b>1.3</b> Improving primarily covariate balance</a>
<ul>
<li class="chapter" data-level="1.3.1" data-path="lalonde-calónico-smith-lcs-data.html"><a href="lalonde-calónico-smith-lcs-data.html#matching"><i class="fa fa-check"></i><b>1.3.1</b> Matching</a></li>
<li class="chapter" data-level="1.3.2" data-path="lalonde-calónico-smith-lcs-data.html"><a href="lalonde-calónico-smith-lcs-data.html#weighting"><i class="fa fa-check"></i><b>1.3.2</b> Weighting</a></li>
</ul></li>
<li class="chapter" data-level="1.4" data-path="lalonde-calónico-smith-lcs-data.html"><a href="lalonde-calónico-smith-lcs-data.html#improving-primarily-overlap"><i class="fa fa-check"></i><b>1.4</b> Improving primarily overlap</a>
<ul>
<li class="chapter" data-level="1.4.1" data-path="lalonde-calónico-smith-lcs-data.html"><a href="lalonde-calónico-smith-lcs-data.html#trimming"><i class="fa fa-check"></i><b>1.4.1</b> Trimming</a></li>
</ul></li>
<li class="chapter" data-level="1.5" data-path="lalonde-calónico-smith-lcs-data.html"><a href="lalonde-calónico-smith-lcs-data.html#integrated-methods"><i class="fa fa-check"></i><b>1.5</b> Integrated methods</a>
<ul>
<li class="chapter" data-level="1.5.1" data-path="lalonde-calónico-smith-lcs-data.html"><a href="lalonde-calónico-smith-lcs-data.html#trimming-and-matching"><i class="fa fa-check"></i><b>1.5.1</b> Trimming and matching</a></li>
<li class="chapter" data-level="1.5.2" data-path="lalonde-calónico-smith-lcs-data.html"><a href="lalonde-calónico-smith-lcs-data.html#trimming-and-weighting"><i class="fa fa-check"></i><b>1.5.2</b> Trimming and weighting</a></li>
<li class="chapter" data-level="1.5.3" data-path="lalonde-calónico-smith-lcs-data.html"><a href="lalonde-calónico-smith-lcs-data.html#truncation-and-weighting"><i class="fa fa-check"></i><b>1.5.3</b> Truncation and weighting</a></li>
</ul></li>
<li class="chapter" data-level="1.6" data-path="lalonde-calónico-smith-lcs-data.html"><a href="lalonde-calónico-smith-lcs-data.html#reassessing-methods"><i class="fa fa-check"></i><b>1.6</b> Reassessing methods</a>
<ul>
<li class="chapter" data-level="1.6.1" data-path="lalonde-calónico-smith-lcs-data.html"><a href="lalonde-calónico-smith-lcs-data.html#matching-1"><i class="fa fa-check"></i><b>1.6.1</b> Matching</a></li>
<li class="chapter" data-level="1.6.2" data-path="lalonde-calónico-smith-lcs-data.html"><a href="lalonde-calónico-smith-lcs-data.html#weighting-1"><i class="fa fa-check"></i><b>1.6.2</b> Weighting</a></li>
<li class="chapter" data-level="1.6.3" data-path="lalonde-calónico-smith-lcs-data.html"><a href="lalonde-calónico-smith-lcs-data.html#truncation"><i class="fa fa-check"></i><b>1.6.3</b> Truncation</a></li>
<li class="chapter" data-level="1.6.4" data-path="lalonde-calónico-smith-lcs-data.html"><a href="lalonde-calónico-smith-lcs-data.html#trimming-1"><i class="fa fa-check"></i><b>1.6.4</b> Trimming</a></li>
</ul></li>
<li class="chapter" data-level="1.7" data-path="lalonde-calónico-smith-lcs-data.html"><a href="lalonde-calónico-smith-lcs-data.html#integrated-methods-1"><i class="fa fa-check"></i><b>1.7</b> Integrated methods</a>
<ul>
<li class="chapter" data-level="1.7.1" data-path="lalonde-calónico-smith-lcs-data.html"><a href="lalonde-calónico-smith-lcs-data.html#trimming-and-matching-1"><i class="fa fa-check"></i><b>1.7.1</b> Trimming and matching</a></li>
<li class="chapter" data-level="1.7.2" data-path="lalonde-calónico-smith-lcs-data.html"><a href="lalonde-calónico-smith-lcs-data.html#trimming-and-weighting-1"><i class="fa fa-check"></i><b>1.7.2</b> Trimming and weighting</a></li>
<li class="chapter" data-level="1.7.3" data-path="lalonde-calónico-smith-lcs-data.html"><a href="lalonde-calónico-smith-lcs-data.html#truncation-and-weighting-1"><i class="fa fa-check"></i><b>1.7.3</b> Truncation and weighting</a></li>
</ul></li>
<li class="chapter" data-level="1.8" data-path="lalonde-calónico-smith-lcs-data.html"><a href="lalonde-calónico-smith-lcs-data.html#identifying-best-methods"><i class="fa fa-check"></i><b>1.8</b> Identifying best methods</a>
<ul>
<li class="chapter" data-level="1.8.1" data-path="lalonde-calónico-smith-lcs-data.html"><a href="lalonde-calónico-smith-lcs-data.html#ranking"><i class="fa fa-check"></i><b>1.8.1</b> Ranking</a></li>
<li class="chapter" data-level="1.8.2" data-path="lalonde-calónico-smith-lcs-data.html"><a href="lalonde-calónico-smith-lcs-data.html#dataset-construction"><i class="fa fa-check"></i><b>1.8.2</b> Dataset construction</a></li>
<li class="chapter" data-level="1.8.3" data-path="lalonde-calónico-smith-lcs-data.html"><a href="lalonde-calónico-smith-lcs-data.html#visuals"><i class="fa fa-check"></i><b>1.8.3</b> Visuals</a></li>
</ul></li>
<li class="chapter" data-level="1.9" data-path="lalonde-calónico-smith-lcs-data.html"><a href="lalonde-calónico-smith-lcs-data.html#estimating"><i class="fa fa-check"></i><b>1.9</b> Estimating</a>
<ul>
<li class="chapter" data-level="1.9.1" data-path="lalonde-calónico-smith-lcs-data.html"><a href="lalonde-calónico-smith-lcs-data.html#average-treatment-effect-on-the-treated-att"><i class="fa fa-check"></i><b>1.9.1</b> Average treatment effect on the treated (ATT)</a></li>
<li class="chapter" data-level="1.9.2" data-path="lalonde-calónico-smith-lcs-data.html"><a href="lalonde-calónico-smith-lcs-data.html#conditional-average-treatment-effect-on-the-treated-catt"><i class="fa fa-check"></i><b>1.9.2</b> Conditional average treatment effect on the treated (CATT)</a></li>
<li class="chapter" data-level="1.9.3" data-path="lalonde-calónico-smith-lcs-data.html"><a href="lalonde-calónico-smith-lcs-data.html#quantile-treatment-effect-on-the-treated-qtet"><i class="fa fa-check"></i><b>1.9.3</b> Quantile treatment effect on the treated (QTET)</a></li>
<li class="chapter" data-level="1.9.4" data-path="lalonde-calónico-smith-lcs-data.html"><a href="lalonde-calónico-smith-lcs-data.html#assessing-outcome-weights-ow"><i class="fa fa-check"></i><b>1.9.4</b> Assessing outcome weights (OW)</a></li>
</ul></li>
<li class="chapter" data-level="1.10" data-path="lalonde-calónico-smith-lcs-data.html"><a href="lalonde-calónico-smith-lcs-data.html#validation-through-placebo-analyses"><i class="fa fa-check"></i><b>1.10</b> Validation through placebo analyses</a></li>
<li class="chapter" data-level="1.11" data-path="lalonde-calónico-smith-lcs-data.html"><a href="lalonde-calónico-smith-lcs-data.html#validation-through-sensitivity-analyses"><i class="fa fa-check"></i><b>1.11</b> Validation through sensitivity analyses</a></li>
<li class="chapter" data-level="1.12" data-path="lalonde-calónico-smith-lcs-data.html"><a href="lalonde-calónico-smith-lcs-data.html#summary"><i class="fa fa-check"></i><b>1.12</b> Summary</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i>References</a></li>
<li class="divider"></li>
<li><a href="https://github.com/lkrsl/Application-of-Outcome-Weights-Framework-for-DML-to-Lalonde-Study" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Application of the Outcome Weights Framework for Double Machine Learning to the Lalonde Study</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="lalonde-calónico-smith-lcs-data" class="section level1 hasAnchor" number="1">
<h1><span class="header-section-number">Chapter 1</span> LaLonde-Calónico-Smith (LCS) Data<a href="lalonde-calónico-smith-lcs-data.html#lalonde-cal%C3%B3nico-smith-lcs-data" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<p>This section (5) examines the LaLonde female samples reconstructed by <span class="citation">Calónico and Smith (<a href="#ref-calonico_smith_2017">2017</a>)</span>, referred to as the LaLonde-Calónico-Smith (LCS) sample (loaded as <code>lcs</code> below, similar to <span class="citation">Imbens and Xu (<a href="#ref-imbens2024">2024</a>)</span>).</p>
<p>For detailed explanations of the analysis steps and notes, please refer to section 2. Here, we only present and explain the LCS–specific results.</p>
<div id="set-up" class="section level2 hasAnchor" number="1.1">
<h2><span class="header-section-number">1.1</span> Set up<a href="lalonde-calónico-smith-lcs-data.html#set-up" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div id="source-functions-and-load-data" class="section level3 hasAnchor" number="1.1.1">
<h3><span class="header-section-number">1.1.1</span> Source functions and load data<a href="lalonde-calónico-smith-lcs-data.html#source-functions-and-load-data" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="lalonde-calónico-smith-lcs-data.html#cb1-1" tabindex="-1"></a><span class="co"># source functions</span></span>
<span id="cb1-2"><a href="lalonde-calónico-smith-lcs-data.html#cb1-2" tabindex="-1"></a><span class="fu">source</span>(<span class="st">&quot;https://github.com/xuyiqing/lalonde/blob/main/tutorial/functions.R?raw=TRUE&quot;</span>)</span>
<span id="cb1-3"><a href="lalonde-calónico-smith-lcs-data.html#cb1-3" tabindex="-1"></a><span class="fu">source</span>(<span class="st">&quot;tutorial/functions.R&quot;</span>)</span></code></pre></div>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="lalonde-calónico-smith-lcs-data.html#cb2-1" tabindex="-1"></a><span class="co"># load data</span></span>
<span id="cb2-2"><a href="lalonde-calónico-smith-lcs-data.html#cb2-2" tabindex="-1"></a><span class="fu">load</span>(<span class="st">&quot;data/lcs.RData&quot;</span>)</span></code></pre></div>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="lalonde-calónico-smith-lcs-data.html#cb3-1" tabindex="-1"></a><span class="co"># set seed</span></span>
<span id="cb3-2"><a href="lalonde-calónico-smith-lcs-data.html#cb3-2" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">42</span>)</span></code></pre></div>
</div>
<div id="load-and-preprocess-data" class="section level3 hasAnchor" number="1.1.2">
<h3><span class="header-section-number">1.1.2</span> Load and preprocess data<a href="lalonde-calónico-smith-lcs-data.html#load-and-preprocess-data" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="lalonde-calónico-smith-lcs-data.html#cb4-1" tabindex="-1"></a><span class="co"># expc = 0: experimental treated; </span></span>
<span id="cb4-2"><a href="lalonde-calónico-smith-lcs-data.html#cb4-2" tabindex="-1"></a><span class="co"># expc = 1: experimental control; </span></span>
<span id="cb4-3"><a href="lalonde-calónico-smith-lcs-data.html#cb4-3" tabindex="-1"></a><span class="co"># expc = 2: psid control;</span></span>
<span id="cb4-4"><a href="lalonde-calónico-smith-lcs-data.html#cb4-4" tabindex="-1"></a></span>
<span id="cb4-5"><a href="lalonde-calónico-smith-lcs-data.html#cb4-5" tabindex="-1"></a>lcs_psid<span class="sc">$</span>expc <span class="ot">&lt;-</span> <span class="dv">0</span> </span>
<span id="cb4-6"><a href="lalonde-calónico-smith-lcs-data.html#cb4-6" tabindex="-1"></a>lcs_psid[lcs_psid<span class="sc">$</span>treat<span class="sc">==</span><span class="dv">0</span>, ]<span class="sc">$</span>expc <span class="ot">&lt;-</span> <span class="dv">2</span> </span>
<span id="cb4-7"><a href="lalonde-calónico-smith-lcs-data.html#cb4-7" tabindex="-1"></a>lcs_tr <span class="ot">&lt;-</span> lcs[lcs<span class="sc">$</span>treat<span class="sc">==</span><span class="dv">1</span>, ]</span>
<span id="cb4-8"><a href="lalonde-calónico-smith-lcs-data.html#cb4-8" tabindex="-1"></a>lcs_co <span class="ot">&lt;-</span> lcs[lcs<span class="sc">$</span>treat<span class="sc">==</span><span class="dv">0</span>, ]</span>
<span id="cb4-9"><a href="lalonde-calónico-smith-lcs-data.html#cb4-9" tabindex="-1"></a>lcs_co<span class="sc">$</span>treat <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb4-10"><a href="lalonde-calónico-smith-lcs-data.html#cb4-10" tabindex="-1"></a>lcs_co<span class="sc">$</span>expc <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb4-11"><a href="lalonde-calónico-smith-lcs-data.html#cb4-11" tabindex="-1"></a>lcs_psid_plus <span class="ot">&lt;-</span> <span class="fu">rbind.data.frame</span>(lcs_psid, lcs_co)</span></code></pre></div>
</div>
<div id="inspect-data" class="section level3 hasAnchor" number="1.1.3">
<h3><span class="header-section-number">1.1.3</span> Inspect data<a href="lalonde-calónico-smith-lcs-data.html#inspect-data" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="lalonde-calónico-smith-lcs-data.html#cb5-1" tabindex="-1"></a><span class="co"># collect datasets in a list</span></span>
<span id="cb5-2"><a href="lalonde-calónico-smith-lcs-data.html#cb5-2" tabindex="-1"></a>data <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="at">lcs =</span> lcs, <span class="at">lcs_psid =</span> lcs_psid, <span class="at">lcs_psid_plus =</span> lcs_psid_plus)</span>
<span id="cb5-3"><a href="lalonde-calónico-smith-lcs-data.html#cb5-3" tabindex="-1"></a></span>
<span id="cb5-4"><a href="lalonde-calónico-smith-lcs-data.html#cb5-4" tabindex="-1"></a><span class="co"># inspect key metrics of each dataset</span></span>
<span id="cb5-5"><a href="lalonde-calónico-smith-lcs-data.html#cb5-5" tabindex="-1"></a>summary_stats <span class="ot">&lt;-</span> <span class="fu">inspect_data</span>(data)</span>
<span id="cb5-6"><a href="lalonde-calónico-smith-lcs-data.html#cb5-6" tabindex="-1"></a><span class="fu">datatable</span>(summary_stats, <span class="at">caption =</span> <span class="st">&quot;Summary Statistics&quot;</span>,</span>
<span id="cb5-7"><a href="lalonde-calónico-smith-lcs-data.html#cb5-7" tabindex="-1"></a>          <span class="at">options =</span> <span class="fu">list</span>(<span class="at">scrollX =</span> <span class="cn">TRUE</span>, <span class="at">paging =</span> <span class="cn">FALSE</span>, <span class="at">pageLength =</span> <span class="sc">-</span><span class="dv">1</span>, <span class="at">searching =</span> <span class="cn">FALSE</span>))</span></code></pre></div>
<div class="datatables html-widget html-fill-item" id="htmlwidget-30e4409849e39179307f" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-30e4409849e39179307f">{"x":{"filter":"none","vertical":false,"caption":"<caption>Summary Statistics<\/caption>","data":[["1","2","3"],["lcs","lcs_psid","lcs_psid_plus"],[1185,1248,1833],[600,600,1185],[585,648,648],[11,12,12],["re79, treat, age, educ, nodegree, married, black, hisp, nchildren75, re75, u75","re79, treat, age, educ, nodegree, married, black, hisp, nchildren75, re75, u75, expc","re79, treat, age, educ, nodegree, married, black, hisp, nchildren75, re75, u75, expc"]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>dataset<\/th>\n      <th>num_obs<\/th>\n      <th>num_treated<\/th>\n      <th>num_controls<\/th>\n      <th>num_vars<\/th>\n      <th>name_vars<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"scrollX":true,"paging":false,"pageLength":-1,"searching":false,"columnDefs":[{"className":"dt-right","targets":[2,3,4,5]},{"orderable":false,"targets":0},{"name":" ","targets":0},{"name":"dataset","targets":1},{"name":"num_obs","targets":2},{"name":"num_treated","targets":3},{"name":"num_controls","targets":4},{"name":"num_vars","targets":5},{"name":"name_vars","targets":6}],"order":[],"autoWidth":false,"orderClasses":false,"lengthMenu":[-1,10,25,50,100]}},"evals":[],"jsHooks":[]}</script>
</div>
</div>
<div id="model" class="section level2 hasAnchor" number="1.2">
<h2><span class="header-section-number">1.2</span> Model<a href="lalonde-calónico-smith-lcs-data.html#model" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="lalonde-calónico-smith-lcs-data.html#cb6-1" tabindex="-1"></a><span class="co"># define variables</span></span>
<span id="cb6-2"><a href="lalonde-calónico-smith-lcs-data.html#cb6-2" tabindex="-1"></a>Y <span class="ot">&lt;-</span> <span class="st">&quot;re79&quot;</span></span>
<span id="cb6-3"><a href="lalonde-calónico-smith-lcs-data.html#cb6-3" tabindex="-1"></a>treat <span class="ot">&lt;-</span> <span class="st">&quot;treat&quot;</span></span>
<span id="cb6-4"><a href="lalonde-calónico-smith-lcs-data.html#cb6-4" tabindex="-1"></a><span class="co"># redefine covariates: removing &quot;nchildren75&quot; to be used as placebo outcome</span></span>
<span id="cb6-5"><a href="lalonde-calónico-smith-lcs-data.html#cb6-5" tabindex="-1"></a>covar <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;age&quot;</span>, <span class="st">&quot;educ&quot;</span>, <span class="st">&quot;nodegree&quot;</span>, <span class="st">&quot;married&quot;</span>, <span class="st">&quot;black&quot;</span>, <span class="st">&quot;hisp&quot;</span>, </span>
<span id="cb6-6"><a href="lalonde-calónico-smith-lcs-data.html#cb6-6" tabindex="-1"></a>           <span class="st">&quot;re75&quot;</span>, <span class="st">&quot;u75&quot;</span>)</span></code></pre></div>
<div class="callout-note">
<p>In the following analysis, only PSID1 data is used as the original LaLonde study and its reconstruction by Calónico and Smith (2017) designate PSID1 as the appropriate nonexperimental control group for women, providing a comparable observational dataset that aligns with the experimental sample’s characteristics.</p>
</div>
<div id="assessing-overlap-and-covariate-balance" class="section level3 hasAnchor" number="1.2.1">
<h3><span class="header-section-number">1.2.1</span> Assessing overlap and covariate balance<a href="lalonde-calónico-smith-lcs-data.html#assessing-overlap-and-covariate-balance" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div id="overlap" class="section level4 hasAnchor" number="1.2.1.1">
<h4><span class="header-section-number">1.2.1.1</span> Overlap<a href="lalonde-calónico-smith-lcs-data.html#overlap" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="lalonde-calónico-smith-lcs-data.html#cb7-1" tabindex="-1"></a>lcs.ps <span class="ot">&lt;-</span> <span class="fu">assess_overlap</span>(<span class="at">data =</span> lcs, <span class="at">treat =</span> treat, <span class="at">cov =</span> covar, <span class="at">xlim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="fl">1.5</span>, <span class="fl">1.5</span>), <span class="at">breaks =</span> <span class="dv">40</span>)</span></code></pre></div>
<div class="figure"><span style="display:block;" id="fig:unnamed-chunk-8-1"></span>
<img src="Outcome-Weights_files/figure-html/unnamed-chunk-8-1.png" alt="FIGURED1. SubfigureA:LCS-Experimental. SubfigureB:LCS-PSID1." width="100%" />
<p class="caption">
Figure 1.1: FIGURED1. SubfigureA:LCS-Experimental. SubfigureB:LCS-PSID1.
</p>
</div>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="lalonde-calónico-smith-lcs-data.html#cb8-1" tabindex="-1"></a>lcs_psid.ps <span class="ot">&lt;-</span> <span class="fu">assess_overlap</span>(<span class="at">data =</span> lcs_psid, <span class="at">treat =</span> treat, <span class="at">cov =</span> covar, <span class="at">xlim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">11</span>, <span class="dv">7</span>), <span class="at">breaks =</span> <span class="dv">40</span>)</span></code></pre></div>
<div class="figure"><span style="display:block;" id="fig:unnamed-chunk-8-2"></span>
<img src="Outcome-Weights_files/figure-html/unnamed-chunk-8-2.png" alt="FIGURED1. SubfigureA:LCS-Experimental. SubfigureB:LCS-PSID1." width="100%" />
<p class="caption">
Figure 1.2: FIGURED1. SubfigureA:LCS-Experimental. SubfigureB:LCS-PSID1.
</p>
</div>
<p>As anticipated, the LCS-Experimental data exhibit an almost perfect overlap. In contrast, the observational dataset LCS-PSID1 displays weak overlap.</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="lalonde-calónico-smith-lcs-data.html#cb9-1" tabindex="-1"></a>lcs_psid_plus.ps <span class="ot">&lt;-</span> <span class="fu">assess_overlap</span>(<span class="at">data =</span> lcs_psid_plus, <span class="at">treat =</span> treat, <span class="at">cov =</span> covar, <span class="at">xlim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">15</span>, <span class="dv">5</span>))</span></code></pre></div>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:unnamed-chunk-9"></span>
<img src="Outcome-Weights_files/figure-html/unnamed-chunk-9-1.png" alt="FIGURED1. SubfigureC:LCS-PSID1-PLUS." width="80%" />
<p class="caption">
Figure 1.3: FIGURED1. SubfigureC:LCS-PSID1-PLUS.
</p>
</div>
<p>With the expanded dataset LCS-PSID1, it is evident that the degree of overlap between treated and control groups has improved, as seen by a greater spread of log-odds densities across both samples.</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="lalonde-calónico-smith-lcs-data.html#cb10-1" tabindex="-1"></a><span class="co"># set model formula</span></span>
<span id="cb10-2"><a href="lalonde-calónico-smith-lcs-data.html#cb10-2" tabindex="-1"></a>model <span class="ot">&lt;-</span> <span class="fu">as.formula</span>(<span class="fu">paste</span>(treat, <span class="st">&quot;~&quot;</span>, <span class="fu">paste</span>(covar, <span class="at">collapse =</span> <span class="st">&quot; + &quot;</span>)))</span></code></pre></div>
</div>
<div id="covariate-balance" class="section level4 hasAnchor" number="1.2.1.2">
<h4><span class="header-section-number">1.2.1.2</span> Covariate balance<a href="lalonde-calónico-smith-lcs-data.html#covariate-balance" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb11-1"><a href="lalonde-calónico-smith-lcs-data.html#cb11-1" tabindex="-1"></a><span class="fu">plot_balance</span>(lcs, lcs_psid, treat, <span class="at">covar =</span> covar, <span class="at">title =</span> <span class="st">&quot;LCS-PSID1&quot;</span>)</span></code></pre></div>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:unnamed-chunk-11-1"></span>
<img src="Outcome-Weights_files/figure-html/unnamed-chunk-11-1.png" alt="FIGURED2. SubfigureA:LDW-PSID1. SubfigureB:LDW-PSID1-PLUS." width="80%" />
<p class="caption">
Figure 1.4: FIGURED2. SubfigureA:LDW-PSID1. SubfigureB:LDW-PSID1-PLUS.
</p>
</div>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb12-1"><a href="lalonde-calónico-smith-lcs-data.html#cb12-1" tabindex="-1"></a><span class="fu">plot_balance</span>(lcs, lcs_psid_plus, treat, <span class="at">covar =</span> covar, <span class="at">title =</span> <span class="st">&quot;LCS-PSID1-PLUS&quot;</span>)</span></code></pre></div>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:unnamed-chunk-11-2"></span>
<img src="Outcome-Weights_files/figure-html/unnamed-chunk-11-2.png" alt="FIGURED2. SubfigureA:LDW-PSID1. SubfigureB:LDW-PSID1-PLUS." width="80%" />
<p class="caption">
Figure 1.5: FIGURED2. SubfigureA:LDW-PSID1. SubfigureB:LDW-PSID1-PLUS.
</p>
</div>
<div class="callout-note">
<p>Due to computational constraints, we use a reduced set of matching methods, consistent with previous sections.</p>
</div>
</div>
</div>
</div>
<div id="improving-primarily-covariate-balance" class="section level2 hasAnchor" number="1.3">
<h2><span class="header-section-number">1.3</span> Improving primarily covariate balance<a href="lalonde-calónico-smith-lcs-data.html#improving-primarily-covariate-balance" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div id="matching" class="section level3 hasAnchor" number="1.3.1">
<h3><span class="header-section-number">1.3.1</span> Matching<a href="lalonde-calónico-smith-lcs-data.html#matching" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div id="distance-matching" class="section level4 hasAnchor" number="1.3.1.1">
<h4><span class="header-section-number">1.3.1.1</span> Distance Matching<a href="lalonde-calónico-smith-lcs-data.html#distance-matching" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<div id="optimal-pair-matching" class="section level5 hasAnchor" number="1.3.1.1.1">
<h5><span class="header-section-number">1.3.1.1.1</span> Optimal pair matching<a href="lalonde-calónico-smith-lcs-data.html#optimal-pair-matching" class="anchor-section" aria-label="Anchor link to header"></a></h5>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb13-1"><a href="lalonde-calónico-smith-lcs-data.html#cb13-1" tabindex="-1"></a><span class="co"># perform optimal pair matching that minimizes total within-pair distance on propensity scores</span></span>
<span id="cb13-2"><a href="lalonde-calónico-smith-lcs-data.html#cb13-2" tabindex="-1"></a>m.out.psid.optimal_pair <span class="ot">&lt;-</span> <span class="fu">matchit</span>(model, <span class="at">data =</span> lcs_psid, <span class="at">method =</span> <span class="st">&quot;optimal&quot;</span>, <span class="at">distance =</span> <span class="st">&quot;glm&quot;</span>, <span class="at">link =</span> <span class="st">&quot;logit&quot;</span>)</span></code></pre></div>
</div>
<div id="optimal-full-matching" class="section level5 hasAnchor" number="1.3.1.1.2">
<h5><span class="header-section-number">1.3.1.1.2</span> Optimal full matching<a href="lalonde-calónico-smith-lcs-data.html#optimal-full-matching" class="anchor-section" aria-label="Anchor link to header"></a></h5>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb14-1"><a href="lalonde-calónico-smith-lcs-data.html#cb14-1" tabindex="-1"></a><span class="co"># perform optimal full matching allowing sets with varying ratios of treated to controls and minimizing a global distance criterion</span></span>
<span id="cb14-2"><a href="lalonde-calónico-smith-lcs-data.html#cb14-2" tabindex="-1"></a>m.out.psid.optimal_full <span class="ot">&lt;-</span> <span class="fu">matchit</span>(model, <span class="at">data =</span> lcs_psid, <span class="at">method =</span> <span class="st">&quot;full&quot;</span>, <span class="at">distance =</span> <span class="st">&quot;glm&quot;</span>, <span class="at">link =</span> <span class="st">&quot;logit&quot;</span>)</span></code></pre></div>
</div>
</div>
<div id="stratum-matching" class="section level4 hasAnchor" number="1.3.1.2">
<h4><span class="header-section-number">1.3.1.2</span> Stratum matching<a href="lalonde-calónico-smith-lcs-data.html#stratum-matching" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<div id="coarsened-matching-cem" class="section level5 hasAnchor" number="1.3.1.2.1">
<h5><span class="header-section-number">1.3.1.2.1</span> Coarsened matching (cem)<a href="lalonde-calónico-smith-lcs-data.html#coarsened-matching-cem" class="anchor-section" aria-label="Anchor link to header"></a></h5>
<p>Strata = coarsened versions of covariates</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb15-1"><a href="lalonde-calónico-smith-lcs-data.html#cb15-1" tabindex="-1"></a><span class="co"># match units exactly within coarse strata </span></span>
<span id="cb15-2"><a href="lalonde-calónico-smith-lcs-data.html#cb15-2" tabindex="-1"></a>m.out.psid.cem <span class="ot">&lt;-</span> <span class="fu">matchit</span>(model, <span class="at">data =</span> lcs_psid, <span class="at">method =</span> <span class="st">&quot;cem&quot;</span>)</span></code></pre></div>
</div>
<div id="subclassification" class="section level5 hasAnchor" number="1.3.1.2.2">
<h5><span class="header-section-number">1.3.1.2.2</span> Subclassification<a href="lalonde-calónico-smith-lcs-data.html#subclassification" class="anchor-section" aria-label="Anchor link to header"></a></h5>
<p>Strata = bins of the propensity score</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb16-1"><a href="lalonde-calónico-smith-lcs-data.html#cb16-1" tabindex="-1"></a><span class="co"># partition sample into fixed number of bins based on propensity score </span></span>
<span id="cb16-2"><a href="lalonde-calónico-smith-lcs-data.html#cb16-2" tabindex="-1"></a>m.out.psid.subcl <span class="ot">&lt;-</span> <span class="fu">matchit</span>(model, <span class="at">data =</span> lcs_psid, <span class="at">method =</span> <span class="st">&quot;subclass&quot;</span>, <span class="at">subclass =</span> <span class="dv">5</span>)</span></code></pre></div>
</div>
</div>
<div id="pure-subset-selection" class="section level4 hasAnchor" number="1.3.1.3">
<h4><span class="header-section-number">1.3.1.3</span> Pure subset selection<a href="lalonde-calónico-smith-lcs-data.html#pure-subset-selection" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<div id="cardinality-profile-matching" class="section level5 hasAnchor" number="1.3.1.3.1">
<h5><span class="header-section-number">1.3.1.3.1</span> Cardinality profile matching<a href="lalonde-calónico-smith-lcs-data.html#cardinality-profile-matching" class="anchor-section" aria-label="Anchor link to header"></a></h5>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb17-1"><a href="lalonde-calónico-smith-lcs-data.html#cb17-1" tabindex="-1"></a><span class="co"># select largest balanced subsample meeting covariate balance tolerances and a fixed ratio of controls to treated units</span></span>
<span id="cb17-2"><a href="lalonde-calónico-smith-lcs-data.html#cb17-2" tabindex="-1"></a>m.out.psid.card <span class="ot">&lt;-</span> <span class="fu">matchit</span>(model, <span class="at">data =</span> lcs_psid, <span class="at">method =</span> <span class="st">&quot;cardinality&quot;</span>, <span class="at">tols =</span> <span class="fl">0.1</span>, <span class="at">ratio =</span> <span class="dv">1</span>, <span class="at">time =</span> <span class="dv">1200</span>)</span></code></pre></div>
</div>
<div id="profile-matching" class="section level5 hasAnchor" number="1.3.1.3.2">
<h5><span class="header-section-number">1.3.1.3.2</span> Profile matching<a href="lalonde-calónico-smith-lcs-data.html#profile-matching" class="anchor-section" aria-label="Anchor link to header"></a></h5>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb18-1"><a href="lalonde-calónico-smith-lcs-data.html#cb18-1" tabindex="-1"></a><span class="co"># select the largest control group subset balanced to the treated group (for ATT), leaving the treated group intact</span></span>
<span id="cb18-2"><a href="lalonde-calónico-smith-lcs-data.html#cb18-2" tabindex="-1"></a>m.out.psid.profile <span class="ot">&lt;-</span> <span class="fu">matchit</span>(model, <span class="at">data =</span> lcs_psid, <span class="at">method =</span> <span class="st">&quot;cardinality&quot;</span>, <span class="at">estimand =</span> <span class="st">&quot;ATT&quot;</span>, <span class="at">tols =</span> <span class="fl">0.1</span>, <span class="at">ratio =</span> <span class="cn">NA</span>, <span class="at">time =</span> <span class="dv">1200</span>)</span></code></pre></div>
</div>
</div>
</div>
<div id="weighting" class="section level3 hasAnchor" number="1.3.2">
<h3><span class="header-section-number">1.3.2</span> Weighting<a href="lalonde-calónico-smith-lcs-data.html#weighting" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div id="inverse-probability-weights-ipw" class="section level4 hasAnchor" number="1.3.2.1">
<h4><span class="header-section-number">1.3.2.1</span> Inverse probability weights (IPW)<a href="lalonde-calónico-smith-lcs-data.html#inverse-probability-weights-ipw" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb19-1"><a href="lalonde-calónico-smith-lcs-data.html#cb19-1" tabindex="-1"></a><span class="co"># estimates propensity scores with a parametric generalized linear model and converts them into weights</span></span>
<span id="cb19-2"><a href="lalonde-calónico-smith-lcs-data.html#cb19-2" tabindex="-1"></a>w.out.psid.ipw <span class="ot">&lt;-</span> WeightIt<span class="sc">::</span><span class="fu">weightit</span>(model, <span class="at">data =</span> lcs_psid, <span class="at">estimand =</span> <span class="st">&quot;ATT&quot;</span>, <span class="at">method =</span> <span class="st">&quot;glm&quot;</span>)</span>
<span id="cb19-3"><a href="lalonde-calónico-smith-lcs-data.html#cb19-3" tabindex="-1"></a>lcs_psid.ps<span class="sc">$</span>ipw_weight <span class="ot">&lt;-</span> w.out.psid.ipw<span class="sc">$</span>weights</span></code></pre></div>
</div>
<div id="covariate-balance-propensity-score-weights" class="section level4 hasAnchor" number="1.3.2.2">
<h4><span class="header-section-number">1.3.2.2</span> Covariate balance propensity score weights<a href="lalonde-calónico-smith-lcs-data.html#covariate-balance-propensity-score-weights" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<div class="sourceCode" id="cb20"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb20-1"><a href="lalonde-calónico-smith-lcs-data.html#cb20-1" tabindex="-1"></a><span class="co"># estimates propensity scores using generalized method of moments and then converts them into weights</span></span>
<span id="cb20-2"><a href="lalonde-calónico-smith-lcs-data.html#cb20-2" tabindex="-1"></a>w.out.psid.cbps <span class="ot">&lt;-</span> WeightIt<span class="sc">::</span><span class="fu">weightit</span>(model, <span class="at">data =</span> lcs_psid, <span class="at">estimand =</span> <span class="st">&quot;ATT&quot;</span>, <span class="at">method =</span> <span class="st">&quot;cbps&quot;</span>)</span>
<span id="cb20-3"><a href="lalonde-calónico-smith-lcs-data.html#cb20-3" tabindex="-1"></a>lcs_psid.ps<span class="sc">$</span>cbps_weight <span class="ot">&lt;-</span> w.out.psid.cbps<span class="sc">$</span>weights</span></code></pre></div>
</div>
<div id="stable-balancing-weights" class="section level4 hasAnchor" number="1.3.2.3">
<h4><span class="header-section-number">1.3.2.3</span> Stable balancing weights<a href="lalonde-calónico-smith-lcs-data.html#stable-balancing-weights" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<div class="sourceCode" id="cb21"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb21-1"><a href="lalonde-calónico-smith-lcs-data.html#cb21-1" tabindex="-1"></a><span class="co"># estimates weights by solving a quadratic programming problem </span></span>
<span id="cb21-2"><a href="lalonde-calónico-smith-lcs-data.html#cb21-2" tabindex="-1"></a>w.out.psid.opt <span class="ot">&lt;-</span> WeightIt<span class="sc">::</span><span class="fu">weightit</span>(model, <span class="at">data =</span> lcs_psid, <span class="at">estimand =</span> <span class="st">&quot;ATT&quot;</span>, <span class="at">method =</span> <span class="st">&quot;optweight&quot;</span>)</span>
<span id="cb21-3"><a href="lalonde-calónico-smith-lcs-data.html#cb21-3" tabindex="-1"></a>lcs_psid.ps<span class="sc">$</span>opt_weight <span class="ot">&lt;-</span> w.out.psid.opt<span class="sc">$</span>weights</span></code></pre></div>
</div>
<div id="entropy-balancing-weights" class="section level4 hasAnchor" number="1.3.2.4">
<h4><span class="header-section-number">1.3.2.4</span> Entropy balancing weights<a href="lalonde-calónico-smith-lcs-data.html#entropy-balancing-weights" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<div class="sourceCode" id="cb22"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb22-1"><a href="lalonde-calónico-smith-lcs-data.html#cb22-1" tabindex="-1"></a><span class="co"># estimates weights by minimizing the negative entropy of the weights subject to exact moment balancing constraints</span></span>
<span id="cb22-2"><a href="lalonde-calónico-smith-lcs-data.html#cb22-2" tabindex="-1"></a>w.out.psid.ebal <span class="ot">&lt;-</span> WeightIt<span class="sc">::</span><span class="fu">weightit</span>(model, <span class="at">data =</span> lcs_psid, <span class="at">estimand =</span> <span class="st">&quot;ATT&quot;</span>, <span class="at">method =</span> <span class="st">&quot;ebal&quot;</span>)</span>
<span id="cb22-3"><a href="lalonde-calónico-smith-lcs-data.html#cb22-3" tabindex="-1"></a>lcs_psid.ps<span class="sc">$</span>ebal_weight <span class="ot">&lt;-</span> w.out.psid.ebal<span class="sc">$</span>weights</span></code></pre></div>
</div>
</div>
</div>
<div id="improving-primarily-overlap" class="section level2 hasAnchor" number="1.4">
<h2><span class="header-section-number">1.4</span> Improving primarily overlap<a href="lalonde-calónico-smith-lcs-data.html#improving-primarily-overlap" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div id="fixed-value-truncation" class="section level4 hasAnchor" number="1.4.0.1">
<h4><span class="header-section-number">1.4.0.1</span> Fixed value truncation<a href="lalonde-calónico-smith-lcs-data.html#fixed-value-truncation" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<div class="sourceCode" id="cb23"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb23-1"><a href="lalonde-calónico-smith-lcs-data.html#cb23-1" tabindex="-1"></a><span class="co"># truncate weights by imposing a minimum and maximum </span></span>
<span id="cb23-2"><a href="lalonde-calónico-smith-lcs-data.html#cb23-2" tabindex="-1"></a>lcs_psid.ps_fixed <span class="ot">&lt;-</span> <span class="fu">truncate_ps_fixed</span>(lcs_psid.ps, <span class="at">treat =</span> <span class="st">&quot;treat&quot;</span>, <span class="at">ps =</span> <span class="st">&quot;ps_assoverlap&quot;</span>, <span class="at">lower =</span> <span class="fl">0.05</span>, <span class="at">upper =</span> <span class="fl">0.95</span>)</span></code></pre></div>
</div>
<div id="at-percentile-truncation" class="section level4 hasAnchor" number="1.4.0.2">
<h4><span class="header-section-number">1.4.0.2</span> At percentile truncation<a href="lalonde-calónico-smith-lcs-data.html#at-percentile-truncation" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<div class="sourceCode" id="cb24"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb24-1"><a href="lalonde-calónico-smith-lcs-data.html#cb24-1" tabindex="-1"></a><span class="co"># truncate weights such that values below the 5th percentile and above the 95th percentile are capped</span></span>
<span id="cb24-2"><a href="lalonde-calónico-smith-lcs-data.html#cb24-2" tabindex="-1"></a>lcs_psid.ps_percent <span class="ot">&lt;-</span> <span class="fu">truncate_ps_percentile</span>(lcs_psid.ps, <span class="at">ps =</span> <span class="st">&quot;ps_assoverlap&quot;</span>, <span class="at">lower_percentile =</span> <span class="dv">5</span>, <span class="at">upper_percentile =</span> <span class="dv">95</span>)</span></code></pre></div>
</div>
<div id="adaptive-weight-truncation" class="section level4 hasAnchor" number="1.4.0.3">
<h4><span class="header-section-number">1.4.0.3</span> Adaptive weight truncation<a href="lalonde-calónico-smith-lcs-data.html#adaptive-weight-truncation" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<div class="sourceCode" id="cb25"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb25-1"><a href="lalonde-calónico-smith-lcs-data.html#cb25-1" tabindex="-1"></a><span class="co"># truncate weights using data-driven quantile selection</span></span>
<span id="cb25-2"><a href="lalonde-calónico-smith-lcs-data.html#cb25-2" tabindex="-1"></a>lcs_psid.ps_adapt <span class="ot">&lt;-</span> <span class="fu">truncate_ps_adaptive</span>(lcs_psid.ps, <span class="at">treat =</span> <span class="st">&quot;treat&quot;</span>, <span class="at">ps =</span> <span class="st">&quot;ps_assoverlap&quot;</span>, <span class="at">folds =</span> <span class="dv">5</span>,</span>
<span id="cb25-3"><a href="lalonde-calónico-smith-lcs-data.html#cb25-3" tabindex="-1"></a>                                         <span class="at">lower_grid =</span> <span class="fu">seq</span>(<span class="fl">0.01</span>, <span class="fl">0.10</span>, <span class="at">by =</span> <span class="fl">0.01</span>),</span>
<span id="cb25-4"><a href="lalonde-calónico-smith-lcs-data.html#cb25-4" tabindex="-1"></a>                                         <span class="at">upper_grid =</span> <span class="fu">seq</span>(<span class="fl">0.90</span>, <span class="fl">0.99</span>, <span class="at">by =</span> <span class="fl">0.01</span>))</span></code></pre></div>
</div>
<div id="trimming" class="section level3 hasAnchor" number="1.4.1">
<h3><span class="header-section-number">1.4.1</span> Trimming<a href="lalonde-calónico-smith-lcs-data.html#trimming" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div id="propensity-score-threshold-trimming" class="section level4 hasAnchor" number="1.4.1.1">
<h4><span class="header-section-number">1.4.1.1</span> Propensity score threshold trimming<a href="lalonde-calónico-smith-lcs-data.html#propensity-score-threshold-trimming" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<div class="sourceCode" id="cb26"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb26-1"><a href="lalonde-calónico-smith-lcs-data.html#cb26-1" tabindex="-1"></a><span class="co"># apply trimming with threshold 0.9</span></span>
<span id="cb26-2"><a href="lalonde-calónico-smith-lcs-data.html#cb26-2" tabindex="-1"></a>lcs_psid.ps_trim <span class="ot">&lt;-</span> <span class="fu">ps_trim</span>(lcs_psid.ps, <span class="at">threshold =</span> <span class="fl">0.9</span>)</span>
<span id="cb26-3"><a href="lalonde-calónico-smith-lcs-data.html#cb26-3" tabindex="-1"></a></span>
<span id="cb26-4"><a href="lalonde-calónico-smith-lcs-data.html#cb26-4" tabindex="-1"></a><span class="co"># re-estimate propensity scores on trimmed data </span></span>
<span id="cb26-5"><a href="lalonde-calónico-smith-lcs-data.html#cb26-5" tabindex="-1"></a>lcs_psid.ps_trim <span class="ot">&lt;-</span> <span class="fu">ps_estimate</span>(<span class="at">data =</span> lcs_psid.ps_trim, <span class="at">treat =</span> treat, <span class="at">cov =</span> covar)</span></code></pre></div>
</div>
<div id="common-range-trimming" class="section level4 hasAnchor" number="1.4.1.2">
<h4><span class="header-section-number">1.4.1.2</span> Common range trimming<a href="lalonde-calónico-smith-lcs-data.html#common-range-trimming" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<div class="sourceCode" id="cb27"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb27-1"><a href="lalonde-calónico-smith-lcs-data.html#cb27-1" tabindex="-1"></a><span class="co"># trim observations outside the common support region of propensity scores</span></span>
<span id="cb27-2"><a href="lalonde-calónico-smith-lcs-data.html#cb27-2" tabindex="-1"></a>lcs_psid.ps_common  <span class="ot">&lt;-</span> <span class="fu">common_range_trim</span>(lcs_psid.ps)</span>
<span id="cb27-3"><a href="lalonde-calónico-smith-lcs-data.html#cb27-3" tabindex="-1"></a></span>
<span id="cb27-4"><a href="lalonde-calónico-smith-lcs-data.html#cb27-4" tabindex="-1"></a><span class="co"># re-estimate propensity scores on trimmed data </span></span>
<span id="cb27-5"><a href="lalonde-calónico-smith-lcs-data.html#cb27-5" tabindex="-1"></a>lcs_psid.ps_common <span class="ot">&lt;-</span> <span class="fu">ps_estimate</span>(<span class="at">data =</span> lcs_psid.ps_common, <span class="at">treat =</span> treat, <span class="at">cov =</span> covar)</span></code></pre></div>
</div>
<div id="crump-trimming" class="section level4 hasAnchor" number="1.4.1.3">
<h4><span class="header-section-number">1.4.1.3</span> Crump trimming<a href="lalonde-calónico-smith-lcs-data.html#crump-trimming" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<div class="sourceCode" id="cb28"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb28-1"><a href="lalonde-calónico-smith-lcs-data.html#cb28-1" tabindex="-1"></a><span class="co"># trim observations with propensity scores outside [0.1, 0.9] interval</span></span>
<span id="cb28-2"><a href="lalonde-calónico-smith-lcs-data.html#cb28-2" tabindex="-1"></a>lcs_psid.ps_crump <span class="ot">&lt;-</span> <span class="fu">crump_trim</span>(lcs_psid.ps, <span class="at">lower =</span> <span class="fl">0.1</span>, <span class="at">upper =</span> <span class="fl">0.9</span>)</span>
<span id="cb28-3"><a href="lalonde-calónico-smith-lcs-data.html#cb28-3" tabindex="-1"></a></span>
<span id="cb28-4"><a href="lalonde-calónico-smith-lcs-data.html#cb28-4" tabindex="-1"></a><span class="co"># re-estimate propensity scores on trimmed data </span></span>
<span id="cb28-5"><a href="lalonde-calónico-smith-lcs-data.html#cb28-5" tabindex="-1"></a>lcs_psid.ps_crump <span class="ot">&lt;-</span> <span class="fu">ps_estimate</span>(<span class="at">data =</span> lcs_psid.ps_crump, <span class="at">treat =</span> treat, <span class="at">cov =</span> covar)</span></code></pre></div>
</div>
<div id="stuermer-trimming" class="section level4 hasAnchor" number="1.4.1.4">
<h4><span class="header-section-number">1.4.1.4</span> Stuermer trimming<a href="lalonde-calónico-smith-lcs-data.html#stuermer-trimming" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<div class="sourceCode" id="cb29"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb29-1"><a href="lalonde-calónico-smith-lcs-data.html#cb29-1" tabindex="-1"></a><span class="co"># trim observations based on propensity score quantiles separately for treated and control</span></span>
<span id="cb29-2"><a href="lalonde-calónico-smith-lcs-data.html#cb29-2" tabindex="-1"></a>lcs_psid.ps_stuermer <span class="ot">&lt;-</span> <span class="fu">stuermer_trim</span>(lcs_psid.ps)</span>
<span id="cb29-3"><a href="lalonde-calónico-smith-lcs-data.html#cb29-3" tabindex="-1"></a></span>
<span id="cb29-4"><a href="lalonde-calónico-smith-lcs-data.html#cb29-4" tabindex="-1"></a><span class="co"># re-estimate propensity scores on trimmed data </span></span>
<span id="cb29-5"><a href="lalonde-calónico-smith-lcs-data.html#cb29-5" tabindex="-1"></a>lcs_psid.ps_stuermer <span class="ot">&lt;-</span> <span class="fu">ps_estimate</span>(<span class="at">data =</span> lcs_psid.ps_stuermer, <span class="at">treat =</span> treat, <span class="at">cov =</span> covar)</span></code></pre></div>
</div>
<div id="walker-trimming" class="section level4 hasAnchor" number="1.4.1.5">
<h4><span class="header-section-number">1.4.1.5</span> Walker trimming<a href="lalonde-calónico-smith-lcs-data.html#walker-trimming" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<div class="sourceCode" id="cb30"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb30-1"><a href="lalonde-calónico-smith-lcs-data.html#cb30-1" tabindex="-1"></a><span class="co"># trim observations based on preference scores that adjust for treatment prevalence using logit transformations</span></span>
<span id="cb30-2"><a href="lalonde-calónico-smith-lcs-data.html#cb30-2" tabindex="-1"></a>lcs_psid.ps_walker <span class="ot">&lt;-</span> <span class="fu">walker_trim</span>(lcs_psid.ps)</span>
<span id="cb30-3"><a href="lalonde-calónico-smith-lcs-data.html#cb30-3" tabindex="-1"></a></span>
<span id="cb30-4"><a href="lalonde-calónico-smith-lcs-data.html#cb30-4" tabindex="-1"></a><span class="co"># re-estimate propensity scores on trimmed data </span></span>
<span id="cb30-5"><a href="lalonde-calónico-smith-lcs-data.html#cb30-5" tabindex="-1"></a>lcs_psid.ps_walker <span class="ot">&lt;-</span> <span class="fu">ps_estimate</span>(<span class="at">data =</span> lcs_psid.ps_walker, <span class="at">treat =</span> treat, <span class="at">cov =</span> covar)</span></code></pre></div>
</div>
</div>
</div>
<div id="integrated-methods" class="section level2 hasAnchor" number="1.5">
<h2><span class="header-section-number">1.5</span> Integrated methods<a href="lalonde-calónico-smith-lcs-data.html#integrated-methods" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div id="trimming-and-matching" class="section level3 hasAnchor" number="1.5.1">
<h3><span class="header-section-number">1.5.1</span> Trimming and matching<a href="lalonde-calónico-smith-lcs-data.html#trimming-and-matching" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div id="propensity-score-threshold-trimming-and-nn-matching" class="section level4 hasAnchor" number="1.5.1.1">
<h4><span class="header-section-number">1.5.1.1</span> Propensity score threshold trimming and nn matching<a href="lalonde-calónico-smith-lcs-data.html#propensity-score-threshold-trimming-and-nn-matching" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>(Similar to tutorial of <span class="citation">Imbens and Xu (<a href="#ref-imbens2024">2024</a>)</span>)</p>
<div class="sourceCode" id="cb31"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb31-1"><a href="lalonde-calónico-smith-lcs-data.html#cb31-1" tabindex="-1"></a><span class="co"># apply trimming with threshold 0.9</span></span>
<span id="cb31-2"><a href="lalonde-calónico-smith-lcs-data.html#cb31-2" tabindex="-1"></a>lcs_psid_trim <span class="ot">&lt;-</span> <span class="fu">ps_trim</span>(lcs_psid_plus.ps, <span class="at">threshold =</span> <span class="fl">0.9</span>)</span>
<span id="cb31-3"><a href="lalonde-calónico-smith-lcs-data.html#cb31-3" tabindex="-1"></a></span>
<span id="cb31-4"><a href="lalonde-calónico-smith-lcs-data.html#cb31-4" tabindex="-1"></a><span class="co"># exclude experimental controls</span></span>
<span id="cb31-5"><a href="lalonde-calónico-smith-lcs-data.html#cb31-5" tabindex="-1"></a>lcs_psid_trim_match <span class="ot">&lt;-</span> <span class="fu">subset</span>(lcs_psid_trim, expc <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">2</span>) <span class="sc">&amp;</span> ps_assoverlap)</span>
<span id="cb31-6"><a href="lalonde-calónico-smith-lcs-data.html#cb31-6" tabindex="-1"></a></span>
<span id="cb31-7"><a href="lalonde-calónico-smith-lcs-data.html#cb31-7" tabindex="-1"></a><span class="co"># re-estimate propensity scores and employ 1:1 matching</span></span>
<span id="cb31-8"><a href="lalonde-calónico-smith-lcs-data.html#cb31-8" tabindex="-1"></a>lcs_psid_trim_match <span class="ot">&lt;-</span> <span class="fu">psmatch</span>(<span class="at">data =</span> lcs_psid_trim_match, <span class="at">Y =</span> <span class="st">&quot;re79&quot;</span>, <span class="at">treat =</span> <span class="st">&quot;treat&quot;</span>, <span class="at">cov =</span> covar)</span>
<span id="cb31-9"><a href="lalonde-calónico-smith-lcs-data.html#cb31-9" tabindex="-1"></a></span>
<span id="cb31-10"><a href="lalonde-calónico-smith-lcs-data.html#cb31-10" tabindex="-1"></a><span class="co"># trim experimental data</span></span>
<span id="cb31-11"><a href="lalonde-calónico-smith-lcs-data.html#cb31-11" tabindex="-1"></a>lcs_trim_psid <span class="ot">&lt;-</span> <span class="fu">subset</span>(lcs_psid_trim, expc <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>))</span>
<span id="cb31-12"><a href="lalonde-calónico-smith-lcs-data.html#cb31-12" tabindex="-1"></a>lcs_trim_psid<span class="sc">$</span>treat[<span class="fu">which</span>(lcs_trim_psid<span class="sc">$</span>expc <span class="sc">==</span> <span class="dv">1</span>)] <span class="ot">&lt;-</span> <span class="dv">0</span></span></code></pre></div>
</div>
</div>
<div id="trimming-and-weighting" class="section level3 hasAnchor" number="1.5.2">
<h3><span class="header-section-number">1.5.2</span> Trimming and weighting<a href="lalonde-calónico-smith-lcs-data.html#trimming-and-weighting" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb32"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb32-1"><a href="lalonde-calónico-smith-lcs-data.html#cb32-1" tabindex="-1"></a><span class="co"># list trimming objects</span></span>
<span id="cb32-2"><a href="lalonde-calónico-smith-lcs-data.html#cb32-2" tabindex="-1"></a>all_trim.psid  <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="at">ps_threshold =</span> lcs_psid.ps_trim, </span>
<span id="cb32-3"><a href="lalonde-calónico-smith-lcs-data.html#cb32-3" tabindex="-1"></a>                     <span class="at">common_range =</span> lcs_psid.ps_common, </span>
<span id="cb32-4"><a href="lalonde-calónico-smith-lcs-data.html#cb32-4" tabindex="-1"></a>                     <span class="at">stuermer =</span> lcs_psid.ps_stuermer, </span>
<span id="cb32-5"><a href="lalonde-calónico-smith-lcs-data.html#cb32-5" tabindex="-1"></a>                     <span class="at">walker =</span> lcs_psid.ps_walker, </span>
<span id="cb32-6"><a href="lalonde-calónico-smith-lcs-data.html#cb32-6" tabindex="-1"></a>                     <span class="at">crump =</span> lcs_psid.ps_crump)</span></code></pre></div>
<div id="ipw-with-1-propensity-threshold-2-common-range-3-stuermer-4-walker-5-crump" class="section level4 hasAnchor" number="1.5.2.1">
<h4><span class="header-section-number">1.5.2.1</span> IPW with 1) propensity threshold 2) common range 3) stuermer 4) walker 5) crump<a href="lalonde-calónico-smith-lcs-data.html#ipw-with-1-propensity-threshold-2-common-range-3-stuermer-4-walker-5-crump" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<div class="sourceCode" id="cb33"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb33-1"><a href="lalonde-calónico-smith-lcs-data.html#cb33-1" tabindex="-1"></a><span class="co"># apply inverse probability weighting (IPW) with trimming and attach IPW weights</span></span>
<span id="cb33-2"><a href="lalonde-calónico-smith-lcs-data.html#cb33-2" tabindex="-1"></a>ipw_comb.psid <span class="ot">&lt;-</span> <span class="fu">attach_weights</span>(all_trim.psid, model, <span class="st">&quot;ipw_weight&quot;</span>)</span></code></pre></div>
</div>
<div id="stable-balancing-weights-with-1-propensity-threshold-2-common-range-3-stuermer-4-walker-5-crump" class="section level4 hasAnchor" number="1.5.2.2">
<h4><span class="header-section-number">1.5.2.2</span> Stable balancing weights with 1) propensity threshold 2) common range 3) stuermer 4) walker 5) crump<a href="lalonde-calónico-smith-lcs-data.html#stable-balancing-weights-with-1-propensity-threshold-2-common-range-3-stuermer-4-walker-5-crump" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<div class="sourceCode" id="cb34"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb34-1"><a href="lalonde-calónico-smith-lcs-data.html#cb34-1" tabindex="-1"></a><span class="co"># apply stable balancing with trimming and attach stable balance weights</span></span>
<span id="cb34-2"><a href="lalonde-calónico-smith-lcs-data.html#cb34-2" tabindex="-1"></a>opt_comb.psid <span class="ot">&lt;-</span> <span class="fu">attach_weights</span>(all_trim.psid, model, <span class="st">&quot;opt_weight&quot;</span>)</span></code></pre></div>
</div>
<div id="propensity-score-weights-with-1-propensity-threshold-2-common-range-3-stuermer-4-walker-5-crump" class="section level4 hasAnchor" number="1.5.2.3">
<h4><span class="header-section-number">1.5.2.3</span> Propensity score weights with 1) propensity threshold 2) common range 3) stuermer 4) walker 5) crump<a href="lalonde-calónico-smith-lcs-data.html#propensity-score-weights-with-1-propensity-threshold-2-common-range-3-stuermer-4-walker-5-crump" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<div class="sourceCode" id="cb35"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb35-1"><a href="lalonde-calónico-smith-lcs-data.html#cb35-1" tabindex="-1"></a><span class="co"># apply propensity score weighting with trimming and attach propensity score weights</span></span>
<span id="cb35-2"><a href="lalonde-calónico-smith-lcs-data.html#cb35-2" tabindex="-1"></a>cbps_comb.psid <span class="ot">&lt;-</span> <span class="fu">attach_weights</span>(all_trim.psid, model, <span class="st">&quot;cbps_weight&quot;</span>)</span></code></pre></div>
</div>
<div id="entropy-balancing-weights-with-1-propensity-threshold-2-common-range-3-stuermer-4-walker-5-crump" class="section level4 hasAnchor" number="1.5.2.4">
<h4><span class="header-section-number">1.5.2.4</span> Entropy balancing weights with 1) propensity threshold 2) common range 3) stuermer 4) walker 5) crump<a href="lalonde-calónico-smith-lcs-data.html#entropy-balancing-weights-with-1-propensity-threshold-2-common-range-3-stuermer-4-walker-5-crump" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<div class="sourceCode" id="cb36"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb36-1"><a href="lalonde-calónico-smith-lcs-data.html#cb36-1" tabindex="-1"></a><span class="co"># apply entropy balancing weights with trimming and attach entropy weights</span></span>
<span id="cb36-2"><a href="lalonde-calónico-smith-lcs-data.html#cb36-2" tabindex="-1"></a>ebal_comb.psid <span class="ot">&lt;-</span> <span class="fu">attach_weights</span>(all_trim.psid, model, <span class="st">&quot;ebal_weight&quot;</span>)</span></code></pre></div>
</div>
</div>
<div id="truncation-and-weighting" class="section level3 hasAnchor" number="1.5.3">
<h3><span class="header-section-number">1.5.3</span> Truncation and weighting<a href="lalonde-calónico-smith-lcs-data.html#truncation-and-weighting" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb37"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb37-1"><a href="lalonde-calónico-smith-lcs-data.html#cb37-1" tabindex="-1"></a><span class="co"># list weight columns to apply truncation </span></span>
<span id="cb37-2"><a href="lalonde-calónico-smith-lcs-data.html#cb37-2" tabindex="-1"></a>weight_columns <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;ipw_weight&quot;</span>, <span class="st">&quot;opt_weight&quot;</span>, <span class="st">&quot;cbps_weight&quot;</span>, <span class="st">&quot;ebal_weight&quot;</span>)</span></code></pre></div>
<div id="ipw-stable-balancing-propensity-score-and-entropy-weights-with-1-fixed-maximum-value-truncation" class="section level4 hasAnchor" number="1.5.3.1">
<h4><span class="header-section-number">1.5.3.1</span> IPW, stable balancing, propensity score and entropy weights with 1) fixed maximum value truncation<a href="lalonde-calónico-smith-lcs-data.html#ipw-stable-balancing-propensity-score-and-entropy-weights-with-1-fixed-maximum-value-truncation" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<div class="sourceCode" id="cb38"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb38-1"><a href="lalonde-calónico-smith-lcs-data.html#cb38-1" tabindex="-1"></a><span class="co"># truncate weights by imposing a minimum and maximum threshold</span></span>
<span id="cb38-2"><a href="lalonde-calónico-smith-lcs-data.html#cb38-2" tabindex="-1"></a>fixed_comb.psid <span class="ot">&lt;-</span> lcs_psid.ps</span>
<span id="cb38-3"><a href="lalonde-calónico-smith-lcs-data.html#cb38-3" tabindex="-1"></a><span class="cf">for</span> (wcol <span class="cf">in</span> weight_columns) {</span>
<span id="cb38-4"><a href="lalonde-calónico-smith-lcs-data.html#cb38-4" tabindex="-1"></a>  <span class="cf">if</span> (wcol <span class="sc">%in%</span> <span class="fu">names</span>(fixed_comb.psid)) {</span>
<span id="cb38-5"><a href="lalonde-calónico-smith-lcs-data.html#cb38-5" tabindex="-1"></a>    fixed_comb.psid <span class="ot">&lt;-</span> <span class="fu">truncate_weights_fixed</span>(fixed_comb.psid, <span class="at">weight_col =</span> wcol, <span class="at">lower =</span> <span class="fl">0.025</span>, <span class="at">upper =</span> <span class="fl">0.975</span>)</span>
<span id="cb38-6"><a href="lalonde-calónico-smith-lcs-data.html#cb38-6" tabindex="-1"></a>  }</span>
<span id="cb38-7"><a href="lalonde-calónico-smith-lcs-data.html#cb38-7" tabindex="-1"></a>}</span></code></pre></div>
</div>
<div id="ipw-stable-balancing-propensity-score-and-entropy-weights-with-2-at-percentile-truncation" class="section level4 hasAnchor" number="1.5.3.2">
<h4><span class="header-section-number">1.5.3.2</span> IPW, stable balancing, propensity score and entropy weights with 2) at percentile truncation<a href="lalonde-calónico-smith-lcs-data.html#ipw-stable-balancing-propensity-score-and-entropy-weights-with-2-at-percentile-truncation" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<div class="sourceCode" id="cb39"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb39-1"><a href="lalonde-calónico-smith-lcs-data.html#cb39-1" tabindex="-1"></a><span class="co"># truncate weights such that values below the 5th percentile and above the 95th percentile are capped</span></span>
<span id="cb39-2"><a href="lalonde-calónico-smith-lcs-data.html#cb39-2" tabindex="-1"></a>percent_comb.psid <span class="ot">&lt;-</span> lcs_psid.ps</span>
<span id="cb39-3"><a href="lalonde-calónico-smith-lcs-data.html#cb39-3" tabindex="-1"></a><span class="cf">for</span> (wcol <span class="cf">in</span> weight_columns) {</span>
<span id="cb39-4"><a href="lalonde-calónico-smith-lcs-data.html#cb39-4" tabindex="-1"></a>  <span class="cf">if</span> (wcol <span class="sc">%in%</span> <span class="fu">names</span>(percent_comb.psid)) {</span>
<span id="cb39-5"><a href="lalonde-calónico-smith-lcs-data.html#cb39-5" tabindex="-1"></a>    percent_comb.psid <span class="ot">&lt;-</span> <span class="fu">truncate_weights_percentile</span>(percent_comb.psid, <span class="at">weight_col =</span> wcol, <span class="at">lower =</span> <span class="fl">0.05</span>, <span class="at">upper =</span> <span class="fl">0.95</span>)</span>
<span id="cb39-6"><a href="lalonde-calónico-smith-lcs-data.html#cb39-6" tabindex="-1"></a>  }</span>
<span id="cb39-7"><a href="lalonde-calónico-smith-lcs-data.html#cb39-7" tabindex="-1"></a>}</span></code></pre></div>
</div>
<div id="ipw-stable-balancing-propensity-score-and-entropy-weights-with-3-adaptive-weight-truncation" class="section level4 hasAnchor" number="1.5.3.3">
<h4><span class="header-section-number">1.5.3.3</span> IPW, stable balancing, propensity score and entropy weights with 3) adaptive weight truncation<a href="lalonde-calónico-smith-lcs-data.html#ipw-stable-balancing-propensity-score-and-entropy-weights-with-3-adaptive-weight-truncation" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<div class="sourceCode" id="cb40"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb40-1"><a href="lalonde-calónico-smith-lcs-data.html#cb40-1" tabindex="-1"></a><span class="co"># truncate weights using data-driven quantile selection</span></span>
<span id="cb40-2"><a href="lalonde-calónico-smith-lcs-data.html#cb40-2" tabindex="-1"></a>adapt_comb.psid <span class="ot">&lt;-</span> lcs_psid.ps</span>
<span id="cb40-3"><a href="lalonde-calónico-smith-lcs-data.html#cb40-3" tabindex="-1"></a><span class="cf">for</span> (wcol <span class="cf">in</span> weight_columns) {</span>
<span id="cb40-4"><a href="lalonde-calónico-smith-lcs-data.html#cb40-4" tabindex="-1"></a>  <span class="cf">if</span> (wcol <span class="sc">%in%</span> <span class="fu">names</span>(adapt_comb.psid)) {</span>
<span id="cb40-5"><a href="lalonde-calónico-smith-lcs-data.html#cb40-5" tabindex="-1"></a>    adapt_comb.psid <span class="ot">&lt;-</span> <span class="fu">truncate_weights_adaptive</span>(adapt_comb.psid, <span class="at">weight_col =</span> wcol)</span>
<span id="cb40-6"><a href="lalonde-calónico-smith-lcs-data.html#cb40-6" tabindex="-1"></a>  }</span>
<span id="cb40-7"><a href="lalonde-calónico-smith-lcs-data.html#cb40-7" tabindex="-1"></a>}</span></code></pre></div>
</div>
</div>
</div>
<div id="reassessing-methods" class="section level2 hasAnchor" number="1.6">
<h2><span class="header-section-number">1.6</span> Reassessing methods<a href="lalonde-calónico-smith-lcs-data.html#reassessing-methods" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div id="matching-1" class="section level3 hasAnchor" number="1.6.1">
<h3><span class="header-section-number">1.6.1</span> Matching<a href="lalonde-calónico-smith-lcs-data.html#matching-1" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb41"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb41-1"><a href="lalonde-calónico-smith-lcs-data.html#cb41-1" tabindex="-1"></a><span class="co"># list all matching objects</span></span>
<span id="cb41-2"><a href="lalonde-calónico-smith-lcs-data.html#cb41-2" tabindex="-1"></a>all_match.psid <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb41-3"><a href="lalonde-calónico-smith-lcs-data.html#cb41-3" tabindex="-1"></a>  <span class="at">optimal_pair =</span> m.out.psid.optimal_pair,</span>
<span id="cb41-4"><a href="lalonde-calónico-smith-lcs-data.html#cb41-4" tabindex="-1"></a>  <span class="at">optimal_full =</span> m.out.psid.optimal_full,</span>
<span id="cb41-5"><a href="lalonde-calónico-smith-lcs-data.html#cb41-5" tabindex="-1"></a>  <span class="at">cem =</span> m.out.psid.cem,</span>
<span id="cb41-6"><a href="lalonde-calónico-smith-lcs-data.html#cb41-6" tabindex="-1"></a>  <span class="at">card =</span> m.out.psid.card,</span>
<span id="cb41-7"><a href="lalonde-calónico-smith-lcs-data.html#cb41-7" tabindex="-1"></a>  <span class="at">profile =</span> m.out.psid.profile,</span>
<span id="cb41-8"><a href="lalonde-calónico-smith-lcs-data.html#cb41-8" tabindex="-1"></a>  <span class="at">subcl =</span> m.out.psid.subcl</span>
<span id="cb41-9"><a href="lalonde-calónico-smith-lcs-data.html#cb41-9" tabindex="-1"></a>)</span></code></pre></div>
<div id="smd" class="section level4 hasAnchor" number="1.6.1.1">
<h4><span class="header-section-number">1.6.1.1</span> SMD<a href="lalonde-calónico-smith-lcs-data.html#smd" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<div class="sourceCode" id="cb42"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb42-1"><a href="lalonde-calónico-smith-lcs-data.html#cb42-1" tabindex="-1"></a><span class="co"># compute absolute SMD</span></span>
<span id="cb42-2"><a href="lalonde-calónico-smith-lcs-data.html#cb42-2" tabindex="-1"></a>smd_matchit.psid <span class="ot">&lt;-</span> <span class="fu">compute_abs_smd_matchit</span>(all_match.psid)</span></code></pre></div>
</div>
<div id="ovl" class="section level4 hasAnchor" number="1.6.1.2">
<h4><span class="header-section-number">1.6.1.2</span> OVL<a href="lalonde-calónico-smith-lcs-data.html#ovl" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<div class="sourceCode" id="cb43"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb43-1"><a href="lalonde-calónico-smith-lcs-data.html#cb43-1" tabindex="-1"></a><span class="co"># calculate overlap coefficient</span></span>
<span id="cb43-2"><a href="lalonde-calónico-smith-lcs-data.html#cb43-2" tabindex="-1"></a>ovl_matchit.psid <span class="ot">&lt;-</span> <span class="fu">compute_ovl_matchit</span>(all_match.psid, <span class="at">ps_col =</span> <span class="st">&quot;distance&quot;</span>, <span class="at">treat_col =</span> <span class="st">&quot;treat&quot;</span>, <span class="at">covar =</span> covar)</span></code></pre></div>
</div>
</div>
<div id="weighting-1" class="section level3 hasAnchor" number="1.6.2">
<h3><span class="header-section-number">1.6.2</span> Weighting<a href="lalonde-calónico-smith-lcs-data.html#weighting-1" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb44"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb44-1"><a href="lalonde-calónico-smith-lcs-data.html#cb44-1" tabindex="-1"></a><span class="co"># list all weights</span></span>
<span id="cb44-2"><a href="lalonde-calónico-smith-lcs-data.html#cb44-2" tabindex="-1"></a>all_weight.psid <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb44-3"><a href="lalonde-calónico-smith-lcs-data.html#cb44-3" tabindex="-1"></a>  <span class="at">ipw_weight =</span> lcs_psid.ps<span class="sc">$</span>ipw_weight,</span>
<span id="cb44-4"><a href="lalonde-calónico-smith-lcs-data.html#cb44-4" tabindex="-1"></a>  <span class="at">opt_weight =</span> lcs_psid.ps<span class="sc">$</span>opt_weight,</span>
<span id="cb44-5"><a href="lalonde-calónico-smith-lcs-data.html#cb44-5" tabindex="-1"></a>  <span class="at">cbps_weight =</span> lcs_psid.ps<span class="sc">$</span>cbps_weight,</span>
<span id="cb44-6"><a href="lalonde-calónico-smith-lcs-data.html#cb44-6" tabindex="-1"></a>  <span class="at">ebal_weight =</span> lcs_psid.ps<span class="sc">$</span>ebal_weight</span>
<span id="cb44-7"><a href="lalonde-calónico-smith-lcs-data.html#cb44-7" tabindex="-1"></a>)</span></code></pre></div>
<div id="smd-1" class="section level4 hasAnchor" number="1.6.2.1">
<h4><span class="header-section-number">1.6.2.1</span> SMD<a href="lalonde-calónico-smith-lcs-data.html#smd-1" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<div class="sourceCode" id="cb45"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb45-1"><a href="lalonde-calónico-smith-lcs-data.html#cb45-1" tabindex="-1"></a><span class="co"># compute absolute SMD</span></span>
<span id="cb45-2"><a href="lalonde-calónico-smith-lcs-data.html#cb45-2" tabindex="-1"></a>smd_weight.psid <span class="ot">&lt;-</span> <span class="fu">compute_abs_smd_weight</span>(lcs_psid.ps, treat, covar, all_weight.psid)</span></code></pre></div>
</div>
<div id="ovl-1" class="section level4 hasAnchor" number="1.6.2.2">
<h4><span class="header-section-number">1.6.2.2</span> OVL<a href="lalonde-calónico-smith-lcs-data.html#ovl-1" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<div class="sourceCode" id="cb46"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb46-1"><a href="lalonde-calónico-smith-lcs-data.html#cb46-1" tabindex="-1"></a><span class="co"># compute overlap coefficients</span></span>
<span id="cb46-2"><a href="lalonde-calónico-smith-lcs-data.html#cb46-2" tabindex="-1"></a>ovl_weight.psid <span class="ot">&lt;-</span> <span class="fu">compute_ovl_weight</span>(<span class="at">data =</span> lcs_psid.ps, <span class="at">treat_col =</span> <span class="st">&quot;treat&quot;</span>, <span class="at">ps_col =</span> <span class="st">&quot;ps_assoverlap&quot;</span>, <span class="at">weights_list =</span> all_weight.psid, <span class="at">covar =</span> covar, <span class="at">n_points =</span> <span class="dv">512</span>)</span></code></pre></div>
</div>
</div>
<div id="truncation" class="section level3 hasAnchor" number="1.6.3">
<h3><span class="header-section-number">1.6.3</span> Truncation<a href="lalonde-calónico-smith-lcs-data.html#truncation" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb47"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb47-1"><a href="lalonde-calónico-smith-lcs-data.html#cb47-1" tabindex="-1"></a><span class="co"># list truncation methods</span></span>
<span id="cb47-2"><a href="lalonde-calónico-smith-lcs-data.html#cb47-2" tabindex="-1"></a>all_trunc.psid <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb47-3"><a href="lalonde-calónico-smith-lcs-data.html#cb47-3" tabindex="-1"></a>  <span class="at">fix_value =</span> lcs_psid.ps_fixed,</span>
<span id="cb47-4"><a href="lalonde-calónico-smith-lcs-data.html#cb47-4" tabindex="-1"></a>  <span class="at">at_perc =</span> lcs_psid.ps_percent,</span>
<span id="cb47-5"><a href="lalonde-calónico-smith-lcs-data.html#cb47-5" tabindex="-1"></a>  <span class="at">adapt =</span> lcs_psid.ps_adapt</span>
<span id="cb47-6"><a href="lalonde-calónico-smith-lcs-data.html#cb47-6" tabindex="-1"></a>)</span></code></pre></div>
<div id="smd-2" class="section level4 hasAnchor" number="1.6.3.1">
<h4><span class="header-section-number">1.6.3.1</span> SMD<a href="lalonde-calónico-smith-lcs-data.html#smd-2" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<div class="sourceCode" id="cb48"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb48-1"><a href="lalonde-calónico-smith-lcs-data.html#cb48-1" tabindex="-1"></a><span class="co"># compute absolute SMD</span></span>
<span id="cb48-2"><a href="lalonde-calónico-smith-lcs-data.html#cb48-2" tabindex="-1"></a>smd_trunc.psid <span class="ot">&lt;-</span> <span class="fu">compute_abs_smd_trunc</span>(all_trunc.psid, <span class="st">&quot;treat&quot;</span>, covar, <span class="st">&quot;ps_assoverlap&quot;</span>)</span></code></pre></div>
</div>
<div id="ovl-2" class="section level4 hasAnchor" number="1.6.3.2">
<h4><span class="header-section-number">1.6.3.2</span> OVL<a href="lalonde-calónico-smith-lcs-data.html#ovl-2" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<div class="sourceCode" id="cb49"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb49-1"><a href="lalonde-calónico-smith-lcs-data.html#cb49-1" tabindex="-1"></a><span class="co"># compute overlap coefficients</span></span>
<span id="cb49-2"><a href="lalonde-calónico-smith-lcs-data.html#cb49-2" tabindex="-1"></a>ovl_trunc.psid <span class="ot">&lt;-</span> <span class="fu">compute_ovl_trunc</span>(all_trunc.psid, <span class="st">&quot;ps_assoverlap&quot;</span>, <span class="st">&quot;treat&quot;</span>)</span></code></pre></div>
</div>
</div>
<div id="trimming-1" class="section level3 hasAnchor" number="1.6.4">
<h3><span class="header-section-number">1.6.4</span> Trimming<a href="lalonde-calónico-smith-lcs-data.html#trimming-1" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb50"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb50-1"><a href="lalonde-calónico-smith-lcs-data.html#cb50-1" tabindex="-1"></a><span class="co"># list trimming object plus original</span></span>
<span id="cb50-2"><a href="lalonde-calónico-smith-lcs-data.html#cb50-2" tabindex="-1"></a>all_trim.psid <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb50-3"><a href="lalonde-calónico-smith-lcs-data.html#cb50-3" tabindex="-1"></a>  <span class="at">original =</span> lcs_psid.ps,</span>
<span id="cb50-4"><a href="lalonde-calónico-smith-lcs-data.html#cb50-4" tabindex="-1"></a>  <span class="at">ps_threshold =</span> lcs_psid.ps_trim,</span>
<span id="cb50-5"><a href="lalonde-calónico-smith-lcs-data.html#cb50-5" tabindex="-1"></a>  <span class="at">common_range =</span> lcs_psid.ps_common,</span>
<span id="cb50-6"><a href="lalonde-calónico-smith-lcs-data.html#cb50-6" tabindex="-1"></a>  <span class="at">crump =</span> lcs_psid.ps_crump,</span>
<span id="cb50-7"><a href="lalonde-calónico-smith-lcs-data.html#cb50-7" tabindex="-1"></a>  <span class="at">stuermer =</span> lcs_psid.ps_stuermer,</span>
<span id="cb50-8"><a href="lalonde-calónico-smith-lcs-data.html#cb50-8" tabindex="-1"></a>  <span class="at">walker =</span> lcs_psid.ps_walker</span>
<span id="cb50-9"><a href="lalonde-calónico-smith-lcs-data.html#cb50-9" tabindex="-1"></a>)</span></code></pre></div>
<div id="smd-3" class="section level4 hasAnchor" number="1.6.4.1">
<h4><span class="header-section-number">1.6.4.1</span> SMD<a href="lalonde-calónico-smith-lcs-data.html#smd-3" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<div class="sourceCode" id="cb51"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb51-1"><a href="lalonde-calónico-smith-lcs-data.html#cb51-1" tabindex="-1"></a><span class="co"># compute absolute SMD</span></span>
<span id="cb51-2"><a href="lalonde-calónico-smith-lcs-data.html#cb51-2" tabindex="-1"></a>smd_trim.psid <span class="ot">&lt;-</span> <span class="fu">compute_abs_smd_trim</span>(all_trim.psid, <span class="st">&quot;treat&quot;</span>, covar)</span></code></pre></div>
</div>
<div id="ovl-3" class="section level4 hasAnchor" number="1.6.4.2">
<h4><span class="header-section-number">1.6.4.2</span> OVL<a href="lalonde-calónico-smith-lcs-data.html#ovl-3" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<div class="sourceCode" id="cb52"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb52-1"><a href="lalonde-calónico-smith-lcs-data.html#cb52-1" tabindex="-1"></a><span class="co"># compute overlap coefficients</span></span>
<span id="cb52-2"><a href="lalonde-calónico-smith-lcs-data.html#cb52-2" tabindex="-1"></a>ovl_trim.psid <span class="ot">&lt;-</span> <span class="fu">compute_ovl_trim</span>(all_trim.psid, <span class="st">&quot;ps_assoverlap&quot;</span>, <span class="st">&quot;treat&quot;</span>)</span></code></pre></div>
</div>
</div>
</div>
<div id="integrated-methods-1" class="section level2 hasAnchor" number="1.7">
<h2><span class="header-section-number">1.7</span> Integrated methods<a href="lalonde-calónico-smith-lcs-data.html#integrated-methods-1" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div id="trimming-and-matching-1" class="section level3 hasAnchor" number="1.7.1">
<h3><span class="header-section-number">1.7.1</span> Trimming and matching<a href="lalonde-calónico-smith-lcs-data.html#trimming-and-matching-1" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>(Similar to tutorial by <span class="citation">Imbens and Xu (<a href="#ref-imbens2024">2024</a>)</span>)</p>
<div class="sourceCode" id="cb53"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb53-1"><a href="lalonde-calónico-smith-lcs-data.html#cb53-1" tabindex="-1"></a><span class="co"># list all trimmed and matched samples</span></span>
<span id="cb53-2"><a href="lalonde-calónico-smith-lcs-data.html#cb53-2" tabindex="-1"></a>trim_match_comb.psid <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb53-3"><a href="lalonde-calónico-smith-lcs-data.html#cb53-3" tabindex="-1"></a>  <span class="at">ps_threshold_match =</span> lcs_psid_trim_match</span>
<span id="cb53-4"><a href="lalonde-calónico-smith-lcs-data.html#cb53-4" tabindex="-1"></a>)</span></code></pre></div>
<div id="smd-4" class="section level4 hasAnchor" number="1.7.1.1">
<h4><span class="header-section-number">1.7.1.1</span> SMD<a href="lalonde-calónico-smith-lcs-data.html#smd-4" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<div class="sourceCode" id="cb54"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb54-1"><a href="lalonde-calónico-smith-lcs-data.html#cb54-1" tabindex="-1"></a><span class="co"># compute absolute SMD</span></span>
<span id="cb54-2"><a href="lalonde-calónico-smith-lcs-data.html#cb54-2" tabindex="-1"></a>smd_trim_match_comb.psid <span class="ot">&lt;-</span> <span class="fu">compute_abs_smd_trim</span>(trim_match_comb.psid, <span class="st">&quot;treat&quot;</span>, covar)</span></code></pre></div>
</div>
<div id="ovl-4" class="section level4 hasAnchor" number="1.7.1.2">
<h4><span class="header-section-number">1.7.1.2</span> OVL<a href="lalonde-calónico-smith-lcs-data.html#ovl-4" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<div class="sourceCode" id="cb55"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb55-1"><a href="lalonde-calónico-smith-lcs-data.html#cb55-1" tabindex="-1"></a><span class="co"># compute overlap coefficients</span></span>
<span id="cb55-2"><a href="lalonde-calónico-smith-lcs-data.html#cb55-2" tabindex="-1"></a>ovl_trim_match_comb.psid <span class="ot">&lt;-</span> <span class="fu">compute_ovl_trim_match</span>(trim_match_comb.psid, <span class="at">ps_col =</span> <span class="st">&quot;distance&quot;</span>, <span class="at">treat_col =</span> <span class="st">&quot;treat&quot;</span>, <span class="at">covar =</span> covar)</span></code></pre></div>
</div>
</div>
<div id="trimming-and-weighting-1" class="section level3 hasAnchor" number="1.7.2">
<h3><span class="header-section-number">1.7.2</span> Trimming and weighting<a href="lalonde-calónico-smith-lcs-data.html#trimming-and-weighting-1" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb56"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb56-1"><a href="lalonde-calónico-smith-lcs-data.html#cb56-1" tabindex="-1"></a><span class="co"># list all combined results</span></span>
<span id="cb56-2"><a href="lalonde-calónico-smith-lcs-data.html#cb56-2" tabindex="-1"></a>trim_weight_comb.psid <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb56-3"><a href="lalonde-calónico-smith-lcs-data.html#cb56-3" tabindex="-1"></a>  <span class="at">ipw =</span> ipw_comb.psid,</span>
<span id="cb56-4"><a href="lalonde-calónico-smith-lcs-data.html#cb56-4" tabindex="-1"></a>  <span class="at">opt =</span> opt_comb.psid,</span>
<span id="cb56-5"><a href="lalonde-calónico-smith-lcs-data.html#cb56-5" tabindex="-1"></a>  <span class="at">cbps =</span> cbps_comb.psid,</span>
<span id="cb56-6"><a href="lalonde-calónico-smith-lcs-data.html#cb56-6" tabindex="-1"></a>  <span class="at">ebal =</span> ebal_comb.psid</span>
<span id="cb56-7"><a href="lalonde-calónico-smith-lcs-data.html#cb56-7" tabindex="-1"></a>)</span></code></pre></div>
<div id="smd-5" class="section level4 hasAnchor" number="1.7.2.1">
<h4><span class="header-section-number">1.7.2.1</span> SMD<a href="lalonde-calónico-smith-lcs-data.html#smd-5" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<div class="sourceCode" id="cb57"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb57-1"><a href="lalonde-calónico-smith-lcs-data.html#cb57-1" tabindex="-1"></a><span class="co"># compute absolute SMD</span></span>
<span id="cb57-2"><a href="lalonde-calónico-smith-lcs-data.html#cb57-2" tabindex="-1"></a>smd_trim_weight_comb.psid <span class="ot">&lt;-</span> <span class="fu">compute_abs_smd_trim_weight</span>(trim_weight_comb.psid, <span class="st">&quot;treat&quot;</span>, covar)</span></code></pre></div>
</div>
<div id="ovl-5" class="section level4 hasAnchor" number="1.7.2.2">
<h4><span class="header-section-number">1.7.2.2</span> OVL<a href="lalonde-calónico-smith-lcs-data.html#ovl-5" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<div class="sourceCode" id="cb58"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb58-1"><a href="lalonde-calónico-smith-lcs-data.html#cb58-1" tabindex="-1"></a><span class="co"># compute overlap coefficients</span></span>
<span id="cb58-2"><a href="lalonde-calónico-smith-lcs-data.html#cb58-2" tabindex="-1"></a>ovl_trim_weight_comb.psid <span class="ot">&lt;-</span> <span class="fu">compute_ovl_trim_weight</span>(trim_weight_comb.psid, <span class="at">treat_col =</span> <span class="st">&quot;treat&quot;</span>, <span class="at">ps_col =</span> <span class="st">&quot;ps_assoverlap&quot;</span>)</span></code></pre></div>
</div>
</div>
<div id="truncation-and-weighting-1" class="section level3 hasAnchor" number="1.7.3">
<h3><span class="header-section-number">1.7.3</span> Truncation and weighting<a href="lalonde-calónico-smith-lcs-data.html#truncation-and-weighting-1" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb59"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb59-1"><a href="lalonde-calónico-smith-lcs-data.html#cb59-1" tabindex="-1"></a><span class="co"># list all combined results</span></span>
<span id="cb59-2"><a href="lalonde-calónico-smith-lcs-data.html#cb59-2" tabindex="-1"></a>trunc_weight_comb.psid <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb59-3"><a href="lalonde-calónico-smith-lcs-data.html#cb59-3" tabindex="-1"></a>  <span class="at">fix_value =</span> fixed_comb.psid,</span>
<span id="cb59-4"><a href="lalonde-calónico-smith-lcs-data.html#cb59-4" tabindex="-1"></a>  <span class="at">at_perc =</span> percent_comb.psid,</span>
<span id="cb59-5"><a href="lalonde-calónico-smith-lcs-data.html#cb59-5" tabindex="-1"></a>  <span class="at">adapt =</span> adapt_comb.psid</span>
<span id="cb59-6"><a href="lalonde-calónico-smith-lcs-data.html#cb59-6" tabindex="-1"></a>)</span></code></pre></div>
<div id="smd-6" class="section level4 hasAnchor" number="1.7.3.1">
<h4><span class="header-section-number">1.7.3.1</span> SMD<a href="lalonde-calónico-smith-lcs-data.html#smd-6" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<div class="sourceCode" id="cb60"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb60-1"><a href="lalonde-calónico-smith-lcs-data.html#cb60-1" tabindex="-1"></a><span class="co"># compute absolute SMD</span></span>
<span id="cb60-2"><a href="lalonde-calónico-smith-lcs-data.html#cb60-2" tabindex="-1"></a>smd_trunc_weight_comb.psid <span class="ot">&lt;-</span> <span class="fu">compute_abs_smd_trunc_weight</span>(trunc_weight_comb.psid, <span class="st">&quot;treat&quot;</span>, covar, weight_columns)</span></code></pre></div>
</div>
<div id="ovl-6" class="section level4 hasAnchor" number="1.7.3.2">
<h4><span class="header-section-number">1.7.3.2</span> OVL<a href="lalonde-calónico-smith-lcs-data.html#ovl-6" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<div class="sourceCode" id="cb61"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb61-1"><a href="lalonde-calónico-smith-lcs-data.html#cb61-1" tabindex="-1"></a><span class="co"># compute overlap coefficients</span></span>
<span id="cb61-2"><a href="lalonde-calónico-smith-lcs-data.html#cb61-2" tabindex="-1"></a>ovl_trunc_weight_comb.psid <span class="ot">&lt;-</span> <span class="fu">compute_ovl_trunc_weight</span>(trunc_weight_comb.psid, <span class="at">treat_col =</span> <span class="st">&quot;treat&quot;</span>, <span class="at">ps_col =</span> <span class="st">&quot;ps_assoverlap&quot;</span>)</span></code></pre></div>
</div>
</div>
</div>
<div id="identifying-best-methods" class="section level2 hasAnchor" number="1.8">
<h2><span class="header-section-number">1.8</span> Identifying best methods<a href="lalonde-calónico-smith-lcs-data.html#identifying-best-methods" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div id="ranking" class="section level3 hasAnchor" number="1.8.1">
<h3><span class="header-section-number">1.8.1</span> Ranking<a href="lalonde-calónico-smith-lcs-data.html#ranking" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div id="initial-dataset" class="section level4 hasAnchor" number="1.8.1.1">
<h4><span class="header-section-number">1.8.1.1</span> Initial dataset<a href="lalonde-calónico-smith-lcs-data.html#initial-dataset" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<div class="sourceCode" id="cb62"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb62-1"><a href="lalonde-calónico-smith-lcs-data.html#cb62-1" tabindex="-1"></a><span class="co"># combine all results</span></span>
<span id="cb62-2"><a href="lalonde-calónico-smith-lcs-data.html#cb62-2" tabindex="-1"></a>all_psid <span class="ot">&lt;-</span> <span class="fu">combine_results</span>(<span class="st">&quot;psid&quot;</span>) </span>
<span id="cb62-3"><a href="lalonde-calónico-smith-lcs-data.html#cb62-3" tabindex="-1"></a></span>
<span id="cb62-4"><a href="lalonde-calónico-smith-lcs-data.html#cb62-4" tabindex="-1"></a><span class="co"># save results </span></span>
<span id="cb62-5"><a href="lalonde-calónico-smith-lcs-data.html#cb62-5" tabindex="-1"></a><span class="fu">save_csv</span>(all_psid, <span class="st">&quot;lcs_psid1_all_results&quot;</span>)</span></code></pre></div>
<div class="sourceCode" id="cb63"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb63-1"><a href="lalonde-calónico-smith-lcs-data.html#cb63-1" tabindex="-1"></a><span class="co"># assess and rank methods</span></span>
<span id="cb63-2"><a href="lalonde-calónico-smith-lcs-data.html#cb63-2" tabindex="-1"></a>ranked_psid <span class="ot">&lt;-</span> <span class="fu">assess_methods</span>(all_psid)</span>
<span id="cb63-3"><a href="lalonde-calónico-smith-lcs-data.html#cb63-3" tabindex="-1"></a></span>
<span id="cb63-4"><a href="lalonde-calónico-smith-lcs-data.html#cb63-4" tabindex="-1"></a><span class="co"># get top 5 methods </span></span>
<span id="cb63-5"><a href="lalonde-calónico-smith-lcs-data.html#cb63-5" tabindex="-1"></a>top5_methods.psid <span class="ot">&lt;-</span> <span class="fu">get_top_methods</span>(ranked_psid, <span class="at">top_n =</span> <span class="dv">5</span>)</span>
<span id="cb63-6"><a href="lalonde-calónico-smith-lcs-data.html#cb63-6" tabindex="-1"></a></span>
<span id="cb63-7"><a href="lalonde-calónico-smith-lcs-data.html#cb63-7" tabindex="-1"></a><span class="co"># save results </span></span>
<span id="cb63-8"><a href="lalonde-calónico-smith-lcs-data.html#cb63-8" tabindex="-1"></a><span class="fu">save_csv</span>(top5_methods.psid, <span class="st">&quot;lcs_psid1_top5_methods&quot;</span>)</span></code></pre></div>
<div class="sourceCode" id="cb64"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb64-1"><a href="lalonde-calónico-smith-lcs-data.html#cb64-1" tabindex="-1"></a><span class="co"># print results</span></span>
<span id="cb64-2"><a href="lalonde-calónico-smith-lcs-data.html#cb64-2" tabindex="-1"></a>top5_methods_df.psid <span class="ot">&lt;-</span> ranked_psid <span class="sc">%&gt;%</span> <span class="fu">arrange</span>(<span class="fu">desc</span>(Score)) <span class="sc">%&gt;%</span> <span class="fu">head</span>(<span class="dv">5</span>)</span>
<span id="cb64-3"><a href="lalonde-calónico-smith-lcs-data.html#cb64-3" tabindex="-1"></a></span>
<span id="cb64-4"><a href="lalonde-calónico-smith-lcs-data.html#cb64-4" tabindex="-1"></a><span class="fu">datatable</span>(top5_methods_df.psid, <span class="at">caption =</span> <span class="st">&quot;Top 5 Methods for PSID1&quot;</span>,</span>
<span id="cb64-5"><a href="lalonde-calónico-smith-lcs-data.html#cb64-5" tabindex="-1"></a>          <span class="at">options =</span> <span class="fu">list</span>(<span class="at">scrollX =</span> <span class="cn">TRUE</span>, <span class="at">paging =</span> <span class="cn">FALSE</span>, <span class="at">pageLength =</span> <span class="sc">-</span><span class="dv">1</span>, <span class="at">searching =</span> <span class="cn">FALSE</span>))</span></code></pre></div>
<div class="datatables html-widget html-fill-item" id="htmlwidget-2e17466358a46d139971" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-2e17466358a46d139971">{"x":{"filter":"none","vertical":false,"caption":"<caption>Top 5 Methods for PSID1<\/caption>","data":[["1","2","3","4","5"],["opt_weight","ebal_weight","cbps_weight","at_perc_opt_weight","at_perc_ipw_weight"],[0.8980228909830388,0.8957802423373306,0.8957057645113179,0.8794007500981091,0.8790493271801862]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>Method<\/th>\n      <th>Score<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"scrollX":true,"paging":false,"pageLength":-1,"searching":false,"columnDefs":[{"className":"dt-right","targets":2},{"orderable":false,"targets":0},{"name":" ","targets":0},{"name":"Method","targets":1},{"name":"Score","targets":2}],"order":[],"autoWidth":false,"orderClasses":false,"lengthMenu":[-1,10,25,50,100]}},"evals":[],"jsHooks":[]}</script>
</div>
<div id="extended-dataset" class="section level4 hasAnchor" number="1.8.1.2">
<h4><span class="header-section-number">1.8.1.2</span> Extended dataset<a href="lalonde-calónico-smith-lcs-data.html#extended-dataset" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<div class="sourceCode" id="cb65"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb65-1"><a href="lalonde-calónico-smith-lcs-data.html#cb65-1" tabindex="-1"></a><span class="co"># combine results</span></span>
<span id="cb65-2"><a href="lalonde-calónico-smith-lcs-data.html#cb65-2" tabindex="-1"></a>all_psid_plus <span class="ot">&lt;-</span> <span class="fu">combine_results_plus</span>(<span class="st">&quot;psid&quot;</span>)</span>
<span id="cb65-3"><a href="lalonde-calónico-smith-lcs-data.html#cb65-3" tabindex="-1"></a></span>
<span id="cb65-4"><a href="lalonde-calónico-smith-lcs-data.html#cb65-4" tabindex="-1"></a><span class="co"># save results </span></span>
<span id="cb65-5"><a href="lalonde-calónico-smith-lcs-data.html#cb65-5" tabindex="-1"></a><span class="fu">save_csv</span>(all_psid_plus, <span class="st">&quot;lcs_psid1_plus_all_results&quot;</span>)</span></code></pre></div>
<div class="sourceCode" id="cb66"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb66-1"><a href="lalonde-calónico-smith-lcs-data.html#cb66-1" tabindex="-1"></a><span class="co"># assess composite scores</span></span>
<span id="cb66-2"><a href="lalonde-calónico-smith-lcs-data.html#cb66-2" tabindex="-1"></a>ranked_psid_plus <span class="ot">&lt;-</span> <span class="fu">assess_methods</span>(all_psid_plus)</span>
<span id="cb66-3"><a href="lalonde-calónico-smith-lcs-data.html#cb66-3" tabindex="-1"></a></span>
<span id="cb66-4"><a href="lalonde-calónico-smith-lcs-data.html#cb66-4" tabindex="-1"></a><span class="co"># get top 5 methods </span></span>
<span id="cb66-5"><a href="lalonde-calónico-smith-lcs-data.html#cb66-5" tabindex="-1"></a>top5_methods.psid_plus <span class="ot">&lt;-</span> <span class="fu">get_top_methods</span>(ranked_psid_plus, <span class="at">top_n =</span> <span class="dv">5</span>)</span>
<span id="cb66-6"><a href="lalonde-calónico-smith-lcs-data.html#cb66-6" tabindex="-1"></a></span>
<span id="cb66-7"><a href="lalonde-calónico-smith-lcs-data.html#cb66-7" tabindex="-1"></a><span class="co"># save results </span></span>
<span id="cb66-8"><a href="lalonde-calónico-smith-lcs-data.html#cb66-8" tabindex="-1"></a><span class="fu">save_csv</span>(top5_methods.psid_plus, <span class="st">&quot;lcs_psid1_plus_top5_methods&quot;</span>)</span></code></pre></div>
<div class="sourceCode" id="cb67"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb67-1"><a href="lalonde-calónico-smith-lcs-data.html#cb67-1" tabindex="-1"></a><span class="co"># print results</span></span>
<span id="cb67-2"><a href="lalonde-calónico-smith-lcs-data.html#cb67-2" tabindex="-1"></a>top5_methods_df.psid_plus <span class="ot">&lt;-</span> ranked_psid_plus <span class="sc">%&gt;%</span> <span class="fu">arrange</span>(<span class="fu">desc</span>(Score)) <span class="sc">%&gt;%</span> <span class="fu">head</span>(<span class="dv">5</span>)</span>
<span id="cb67-3"><a href="lalonde-calónico-smith-lcs-data.html#cb67-3" tabindex="-1"></a></span>
<span id="cb67-4"><a href="lalonde-calónico-smith-lcs-data.html#cb67-4" tabindex="-1"></a><span class="fu">datatable</span>(top5_methods_df.psid_plus, <span class="at">caption =</span> <span class="st">&quot;Top 5 Methods for PSID1 and PSID1-PLUS&quot;</span>,</span>
<span id="cb67-5"><a href="lalonde-calónico-smith-lcs-data.html#cb67-5" tabindex="-1"></a>          <span class="at">options =</span> <span class="fu">list</span>(<span class="at">scrollX =</span> <span class="cn">TRUE</span>, <span class="at">paging =</span> <span class="cn">FALSE</span>, <span class="at">pageLength =</span> <span class="sc">-</span><span class="dv">1</span>, <span class="at">searching =</span> <span class="cn">FALSE</span>))</span></code></pre></div>
<div class="datatables html-widget html-fill-item" id="htmlwidget-6e8228581aa3e4de6c04" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-6e8228581aa3e4de6c04">{"x":{"filter":"none","vertical":false,"caption":"<caption>Top 5 Methods for PSID1 and PSID1-PLUS<\/caption>","data":[["1","2","3","4","5"],["opt_weight","ebal_weight","cbps_weight","at_perc_opt_weight","at_perc_ipw_weight"],[0.8980228909830388,0.8957802423373306,0.8957057645113179,0.8794007500981091,0.8790493271801862]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>Method<\/th>\n      <th>Score<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"scrollX":true,"paging":false,"pageLength":-1,"searching":false,"columnDefs":[{"className":"dt-right","targets":2},{"orderable":false,"targets":0},{"name":" ","targets":0},{"name":"Method","targets":1},{"name":"Score","targets":2}],"order":[],"autoWidth":false,"orderClasses":false,"lengthMenu":[-1,10,25,50,100]}},"evals":[],"jsHooks":[]}</script>
</div>
</div>
<div id="dataset-construction" class="section level3 hasAnchor" number="1.8.2">
<h3><span class="header-section-number">1.8.2</span> Dataset construction<a href="lalonde-calónico-smith-lcs-data.html#dataset-construction" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>The table shows that for PSID1 the top methods include only matching and integrated approaches, with <code>card</code> as the best method.</p>
<div class="sourceCode" id="cb68"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb68-1"><a href="lalonde-calónico-smith-lcs-data.html#cb68-1" tabindex="-1"></a>list_psid <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb68-2"><a href="lalonde-calónico-smith-lcs-data.html#cb68-2" tabindex="-1"></a>  <span class="st">&quot;All&quot;</span> <span class="ot">=</span> lcs_psid,</span>
<span id="cb68-3"><a href="lalonde-calónico-smith-lcs-data.html#cb68-3" tabindex="-1"></a>  <span class="st">&quot;original&quot;</span> <span class="ot">=</span> lcs_psid.ps,</span>
<span id="cb68-4"><a href="lalonde-calónico-smith-lcs-data.html#cb68-4" tabindex="-1"></a>  <span class="st">&quot;card&quot;</span> <span class="ot">=</span> m.out.psid.card,</span>
<span id="cb68-5"><a href="lalonde-calónico-smith-lcs-data.html#cb68-5" tabindex="-1"></a>  <span class="st">&quot;optimal_full&quot;</span> <span class="ot">=</span> m.out.psid.optimal_full,</span>
<span id="cb68-6"><a href="lalonde-calónico-smith-lcs-data.html#cb68-6" tabindex="-1"></a>  <span class="st">&quot;optimal_pair&quot;</span> <span class="ot">=</span> m.out.psid.optimal_pair,</span>
<span id="cb68-7"><a href="lalonde-calónico-smith-lcs-data.html#cb68-7" tabindex="-1"></a>  <span class="st">&quot;subcl&quot;</span> <span class="ot">=</span> m.out.psid.subcl,</span>
<span id="cb68-8"><a href="lalonde-calónico-smith-lcs-data.html#cb68-8" tabindex="-1"></a>  <span class="st">&quot;profile&quot;</span> <span class="ot">=</span> m.out.psid.profile,</span>
<span id="cb68-9"><a href="lalonde-calónico-smith-lcs-data.html#cb68-9" tabindex="-1"></a>  <span class="st">&quot;ipw_weight&quot;</span> <span class="ot">=</span> lcs_psid.ps<span class="sc">$</span>ipw_weight, </span>
<span id="cb68-10"><a href="lalonde-calónico-smith-lcs-data.html#cb68-10" tabindex="-1"></a>  <span class="st">&quot;opt_weight&quot;</span> <span class="ot">=</span> lcs_psid.ps<span class="sc">$</span>opt_weight,</span>
<span id="cb68-11"><a href="lalonde-calónico-smith-lcs-data.html#cb68-11" tabindex="-1"></a>  <span class="st">&quot;cbps_weight&quot;</span> <span class="ot">=</span> lcs_psid.ps<span class="sc">$</span>cbps_weight,</span>
<span id="cb68-12"><a href="lalonde-calónico-smith-lcs-data.html#cb68-12" tabindex="-1"></a>  <span class="st">&quot;ebal_weight&quot;</span> <span class="ot">=</span> lcs_psid.ps<span class="sc">$</span>ebal_weight,</span>
<span id="cb68-13"><a href="lalonde-calónico-smith-lcs-data.html#cb68-13" tabindex="-1"></a>  <span class="st">&quot;fix_value_ipw_weight&quot;</span> <span class="ot">=</span> fixed_comb.psid<span class="sc">$</span>ipw_weight,</span>
<span id="cb68-14"><a href="lalonde-calónico-smith-lcs-data.html#cb68-14" tabindex="-1"></a>  <span class="st">&quot;fix_value_opt_weight&quot;</span> <span class="ot">=</span> fixed_comb.psid<span class="sc">$</span>opt_weight,</span>
<span id="cb68-15"><a href="lalonde-calónico-smith-lcs-data.html#cb68-15" tabindex="-1"></a>  <span class="st">&quot;fix_value_cbps_weight&quot;</span> <span class="ot">=</span> fixed_comb.psid<span class="sc">$</span>cbps_weight,</span>
<span id="cb68-16"><a href="lalonde-calónico-smith-lcs-data.html#cb68-16" tabindex="-1"></a>  <span class="st">&quot;fix_value_ebal_weight&quot;</span> <span class="ot">=</span> fixed_comb.psid<span class="sc">$</span>ebal_weight,</span>
<span id="cb68-17"><a href="lalonde-calónico-smith-lcs-data.html#cb68-17" tabindex="-1"></a>  <span class="st">&quot;at_perc_ipw_weight&quot;</span> <span class="ot">=</span> percent_comb.psid<span class="sc">$</span>ipw_weight,</span>
<span id="cb68-18"><a href="lalonde-calónico-smith-lcs-data.html#cb68-18" tabindex="-1"></a>  <span class="st">&quot;at_perc_opt_weight&quot;</span> <span class="ot">=</span> percent_comb.psid<span class="sc">$</span>opt_weight,</span>
<span id="cb68-19"><a href="lalonde-calónico-smith-lcs-data.html#cb68-19" tabindex="-1"></a>  <span class="st">&quot;at_perc_cbps_weight&quot;</span> <span class="ot">=</span> percent_comb.psid<span class="sc">$</span>cbps_weight,</span>
<span id="cb68-20"><a href="lalonde-calónico-smith-lcs-data.html#cb68-20" tabindex="-1"></a>  <span class="st">&quot;at_perc_ebal_weight&quot;</span> <span class="ot">=</span> percent_comb.psid<span class="sc">$</span>ebal_weight,</span>
<span id="cb68-21"><a href="lalonde-calónico-smith-lcs-data.html#cb68-21" tabindex="-1"></a>  <span class="st">&quot;adapt_ipw_weight&quot;</span> <span class="ot">=</span> adapt_comb.psid<span class="sc">$</span>ipw_weight,</span>
<span id="cb68-22"><a href="lalonde-calónico-smith-lcs-data.html#cb68-22" tabindex="-1"></a>  <span class="st">&quot;adapt_opt_weight&quot;</span> <span class="ot">=</span> adapt_comb.psid<span class="sc">$</span>opt_weight,</span>
<span id="cb68-23"><a href="lalonde-calónico-smith-lcs-data.html#cb68-23" tabindex="-1"></a>  <span class="st">&quot;adapt_cbps_weight&quot;</span> <span class="ot">=</span> adapt_comb.psid<span class="sc">$</span>cbps_weight,</span>
<span id="cb68-24"><a href="lalonde-calónico-smith-lcs-data.html#cb68-24" tabindex="-1"></a>  <span class="st">&quot;adapt_ebal_weight&quot;</span> <span class="ot">=</span> adapt_comb.psid<span class="sc">$</span>ebal_weight,</span>
<span id="cb68-25"><a href="lalonde-calónico-smith-lcs-data.html#cb68-25" tabindex="-1"></a>  <span class="st">&quot;ps_threshold&quot;</span> <span class="ot">=</span> lcs_psid.ps_trim,</span>
<span id="cb68-26"><a href="lalonde-calónico-smith-lcs-data.html#cb68-26" tabindex="-1"></a>  <span class="st">&quot;common_range&quot;</span> <span class="ot">=</span> lcs_psid.ps_common,</span>
<span id="cb68-27"><a href="lalonde-calónico-smith-lcs-data.html#cb68-27" tabindex="-1"></a>  <span class="st">&quot;stuermer&quot;</span> <span class="ot">=</span> lcs_psid.ps_stuermer,</span>
<span id="cb68-28"><a href="lalonde-calónico-smith-lcs-data.html#cb68-28" tabindex="-1"></a>  <span class="st">&quot;walker&quot;</span> <span class="ot">=</span> lcs_psid.ps_walker,</span>
<span id="cb68-29"><a href="lalonde-calónico-smith-lcs-data.html#cb68-29" tabindex="-1"></a>  <span class="st">&quot;crump&quot;</span> <span class="ot">=</span> lcs_psid.ps_crump,</span>
<span id="cb68-30"><a href="lalonde-calónico-smith-lcs-data.html#cb68-30" tabindex="-1"></a>  <span class="st">&quot;ipw_ps_threshold&quot;</span><span class="ot">=</span> ipw_comb.psid[[<span class="dv">1</span>]],</span>
<span id="cb68-31"><a href="lalonde-calónico-smith-lcs-data.html#cb68-31" tabindex="-1"></a>  <span class="st">&quot;ipw_common_range&quot;</span> <span class="ot">=</span> ipw_comb.psid[[<span class="dv">2</span>]],</span>
<span id="cb68-32"><a href="lalonde-calónico-smith-lcs-data.html#cb68-32" tabindex="-1"></a>  <span class="st">&quot;ipw_stuermer&quot;</span><span class="ot">=</span> ipw_comb.psid[[<span class="dv">3</span>]],</span>
<span id="cb68-33"><a href="lalonde-calónico-smith-lcs-data.html#cb68-33" tabindex="-1"></a>  <span class="st">&quot;ipw_walker&quot;</span> <span class="ot">=</span> ipw_comb.psid[[<span class="dv">4</span>]],</span>
<span id="cb68-34"><a href="lalonde-calónico-smith-lcs-data.html#cb68-34" tabindex="-1"></a>  <span class="st">&quot;ipw_crump&quot;</span><span class="ot">=</span> ipw_comb.psid[[<span class="dv">5</span>]],</span>
<span id="cb68-35"><a href="lalonde-calónico-smith-lcs-data.html#cb68-35" tabindex="-1"></a>  <span class="st">&quot;opt_ps_threshold&quot;</span> <span class="ot">=</span> opt_comb.psid[[<span class="dv">1</span>]],</span>
<span id="cb68-36"><a href="lalonde-calónico-smith-lcs-data.html#cb68-36" tabindex="-1"></a>  <span class="st">&quot;opt_common_range&quot;</span> <span class="ot">=</span> opt_comb.psid[[<span class="dv">2</span>]],</span>
<span id="cb68-37"><a href="lalonde-calónico-smith-lcs-data.html#cb68-37" tabindex="-1"></a>   <span class="st">&quot;opt_stuermer&quot;</span> <span class="ot">=</span> opt_comb.psid[[<span class="dv">3</span>]],</span>
<span id="cb68-38"><a href="lalonde-calónico-smith-lcs-data.html#cb68-38" tabindex="-1"></a>  <span class="st">&quot;opt_walker&quot;</span> <span class="ot">=</span> opt_comb.psid[[<span class="dv">4</span>]],</span>
<span id="cb68-39"><a href="lalonde-calónico-smith-lcs-data.html#cb68-39" tabindex="-1"></a>  <span class="st">&quot;opt_crump&quot;</span> <span class="ot">=</span> opt_comb.psid[[<span class="dv">5</span>]],</span>
<span id="cb68-40"><a href="lalonde-calónico-smith-lcs-data.html#cb68-40" tabindex="-1"></a>  <span class="st">&quot;cbps_ps_threshold&quot;</span>  <span class="ot">=</span> cbps_comb.psid[[<span class="dv">1</span>]],</span>
<span id="cb68-41"><a href="lalonde-calónico-smith-lcs-data.html#cb68-41" tabindex="-1"></a>  <span class="st">&quot;cbps_common_range&quot;</span> <span class="ot">=</span> cbps_comb.psid[[<span class="dv">2</span>]],</span>
<span id="cb68-42"><a href="lalonde-calónico-smith-lcs-data.html#cb68-42" tabindex="-1"></a>  <span class="st">&quot;cbps_stuermer&quot;</span> <span class="ot">=</span> cbps_comb.psid[[<span class="dv">3</span>]],</span>
<span id="cb68-43"><a href="lalonde-calónico-smith-lcs-data.html#cb68-43" tabindex="-1"></a>  <span class="st">&quot;cbps_walker&quot;</span><span class="ot">=</span> cbps_comb.psid[[<span class="dv">4</span>]],</span>
<span id="cb68-44"><a href="lalonde-calónico-smith-lcs-data.html#cb68-44" tabindex="-1"></a>  <span class="st">&quot;cbps_crump&quot;</span> <span class="ot">=</span> cbps_comb.psid[[<span class="dv">5</span>]],</span>
<span id="cb68-45"><a href="lalonde-calónico-smith-lcs-data.html#cb68-45" tabindex="-1"></a>  <span class="st">&quot;ebal_ps_threshold&quot;</span> <span class="ot">=</span> ebal_comb.psid[[<span class="dv">1</span>]],</span>
<span id="cb68-46"><a href="lalonde-calónico-smith-lcs-data.html#cb68-46" tabindex="-1"></a>  <span class="st">&quot;ebal_common_range&quot;</span> <span class="ot">=</span> ebal_comb.psid[[<span class="dv">2</span>]],</span>
<span id="cb68-47"><a href="lalonde-calónico-smith-lcs-data.html#cb68-47" tabindex="-1"></a>  <span class="st">&quot;ebal_stuermer&quot;</span> <span class="ot">=</span> ebal_comb.psid[[<span class="dv">3</span>]],</span>
<span id="cb68-48"><a href="lalonde-calónico-smith-lcs-data.html#cb68-48" tabindex="-1"></a>  <span class="st">&quot;ebal_walker&quot;</span> <span class="ot">=</span> ebal_comb.psid[[<span class="dv">4</span>]],</span>
<span id="cb68-49"><a href="lalonde-calónico-smith-lcs-data.html#cb68-49" tabindex="-1"></a>  <span class="st">&quot;ebal_crump&quot;</span> <span class="ot">=</span> ebal_comb.psid[[<span class="dv">5</span>]],</span>
<span id="cb68-50"><a href="lalonde-calónico-smith-lcs-data.html#cb68-50" tabindex="-1"></a>  <span class="st">&quot;ps_threshold_match&quot;</span> <span class="ot">=</span> lcs_psid_trim_match)</span></code></pre></div>
<div class="sourceCode" id="cb69"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb69-1"><a href="lalonde-calónico-smith-lcs-data.html#cb69-1" tabindex="-1"></a><span class="co"># create the datasets from combined lists for your top 5 methods:</span></span>
<span id="cb69-2"><a href="lalonde-calónico-smith-lcs-data.html#cb69-2" tabindex="-1"></a>top5_datasets.psid <span class="ot">&lt;-</span> <span class="fu">create_top5_datasets</span>(list_psid, top5_methods.psid)</span></code></pre></div>
<div class="sourceCode" id="cb70"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb70-1"><a href="lalonde-calónico-smith-lcs-data.html#cb70-1" tabindex="-1"></a><span class="co"># save them into .RData files</span></span>
<span id="cb70-2"><a href="lalonde-calónico-smith-lcs-data.html#cb70-2" tabindex="-1"></a><span class="fu">save_top5_datasets</span>(list_psid, top5_methods.psid, <span class="at">prefix =</span> <span class="st">&quot;lcs_psid1&quot;</span>)</span></code></pre></div>
</div>
<div id="visuals" class="section level3 hasAnchor" number="1.8.3">
<h3><span class="header-section-number">1.8.3</span> Visuals<a href="lalonde-calónico-smith-lcs-data.html#visuals" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb71"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb71-1"><a href="lalonde-calónico-smith-lcs-data.html#cb71-1" tabindex="-1"></a><span class="co"># visualize results</span></span>
<span id="cb71-2"><a href="lalonde-calónico-smith-lcs-data.html#cb71-2" tabindex="-1"></a>top5_objects.psid <span class="ot">&lt;-</span> list_psid[top5_methods.psid]</span>
<span id="cb71-3"><a href="lalonde-calónico-smith-lcs-data.html#cb71-3" tabindex="-1"></a></span>
<span id="cb71-4"><a href="lalonde-calónico-smith-lcs-data.html#cb71-4" tabindex="-1"></a><span class="co"># covariate balance</span></span>
<span id="cb71-5"><a href="lalonde-calónico-smith-lcs-data.html#cb71-5" tabindex="-1"></a><span class="fu">plot_weighting_balance</span>(lcs_psid, treat, covar, top5_objects.psid, <span class="st">&quot;PSID1 Top 5 Methods&quot;</span>)</span></code></pre></div>
<pre><code>## $opt_weight</code></pre>
<p><img src="Outcome-Weights_files/figure-html/unnamed-chunk-70-1.png" width="672" /></p>
<pre><code>## 
## $ebal_weight</code></pre>
<p><img src="Outcome-Weights_files/figure-html/unnamed-chunk-70-2.png" width="672" /></p>
<pre><code>## 
## $cbps_weight</code></pre>
<p><img src="Outcome-Weights_files/figure-html/unnamed-chunk-70-3.png" width="672" /></p>
<pre><code>## 
## $at_perc_opt_weight</code></pre>
<p><img src="Outcome-Weights_files/figure-html/unnamed-chunk-70-4.png" width="672" /></p>
<pre><code>## 
## $at_perc_ipw_weight</code></pre>
<p><img src="Outcome-Weights_files/figure-html/unnamed-chunk-70-5.png" width="672" /></p>
<div class="sourceCode" id="cb77"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb77-1"><a href="lalonde-calónico-smith-lcs-data.html#cb77-1" tabindex="-1"></a><span class="co"># overlap</span></span>
<span id="cb77-2"><a href="lalonde-calónico-smith-lcs-data.html#cb77-2" tabindex="-1"></a><span class="co"># plot_weighting_overlap(lcs_psid, treat_col = &quot;treat&quot;, weights_list = top5_objects.psid, covar = covar, prefix = &quot;PSID1&quot;)</span></span></code></pre></div>
<div class="sourceCode" id="cb78"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb78-1"><a href="lalonde-calónico-smith-lcs-data.html#cb78-1" tabindex="-1"></a><span class="co"># save results</span></span></code></pre></div>
<div class="sourceCode" id="cb79"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb79-1"><a href="lalonde-calónico-smith-lcs-data.html#cb79-1" tabindex="-1"></a><span class="co"># visualize covariate balance of specific results (sort for type)</span></span>
<span id="cb79-2"><a href="lalonde-calónico-smith-lcs-data.html#cb79-2" tabindex="-1"></a>top5_objects.psid_plus <span class="ot">&lt;-</span> list_psid[top5_methods.psid_plus]</span>
<span id="cb79-3"><a href="lalonde-calónico-smith-lcs-data.html#cb79-3" tabindex="-1"></a></span>
<span id="cb79-4"><a href="lalonde-calónico-smith-lcs-data.html#cb79-4" tabindex="-1"></a><span class="co"># covariate balance</span></span>
<span id="cb79-5"><a href="lalonde-calónico-smith-lcs-data.html#cb79-5" tabindex="-1"></a><span class="fu">plot_weighting_balance</span>(lcs_psid, treat, covar, top5_objects.psid_plus, <span class="st">&quot;PSID1-PLUS Top 5 Methods&quot;</span>)</span></code></pre></div>
<pre><code>## $opt_weight</code></pre>
<p><img src="Outcome-Weights_files/figure-html/unnamed-chunk-72-1.png" width="672" /></p>
<pre><code>## 
## $ebal_weight</code></pre>
<p><img src="Outcome-Weights_files/figure-html/unnamed-chunk-72-2.png" width="672" /></p>
<pre><code>## 
## $cbps_weight</code></pre>
<p><img src="Outcome-Weights_files/figure-html/unnamed-chunk-72-3.png" width="672" /></p>
<pre><code>## 
## $at_perc_opt_weight</code></pre>
<p><img src="Outcome-Weights_files/figure-html/unnamed-chunk-72-4.png" width="672" /></p>
<pre><code>## 
## $at_perc_ipw_weight</code></pre>
<p><img src="Outcome-Weights_files/figure-html/unnamed-chunk-72-5.png" width="672" /></p>
<div class="sourceCode" id="cb85"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb85-1"><a href="lalonde-calónico-smith-lcs-data.html#cb85-1" tabindex="-1"></a><span class="co"># overlap </span></span>
<span id="cb85-2"><a href="lalonde-calónico-smith-lcs-data.html#cb85-2" tabindex="-1"></a><span class="co"># plot_weighting_overlap(lcs_psid, treat_col = &quot;treat&quot;, weights_list = top5_objects.psid_plus, covar = covar, prefix = &quot;PSID1-PLUS&quot;)</span></span></code></pre></div>
<div class="sourceCode" id="cb86"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb86-1"><a href="lalonde-calónico-smith-lcs-data.html#cb86-1" tabindex="-1"></a><span class="co"># save results </span></span></code></pre></div>
</div>
</div>
<div id="estimating" class="section level2 hasAnchor" number="1.9">
<h2><span class="header-section-number">1.9</span> Estimating<a href="lalonde-calónico-smith-lcs-data.html#estimating" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div id="average-treatment-effect-on-the-treated-att" class="section level3 hasAnchor" number="1.9.1">
<h3><span class="header-section-number">1.9.1</span> Average treatment effect on the treated (ATT)<a href="lalonde-calónico-smith-lcs-data.html#average-treatment-effect-on-the-treated-att" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb87"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb87-1"><a href="lalonde-calónico-smith-lcs-data.html#cb87-1" tabindex="-1"></a><span class="co"># get estimates</span></span>
<span id="cb87-2"><a href="lalonde-calónico-smith-lcs-data.html#cb87-2" tabindex="-1"></a>out1 <span class="ot">&lt;-</span> <span class="fu">estimate_all</span>(lcs, <span class="st">&quot;re79&quot;</span>, <span class="st">&quot;treat&quot;</span>, covar)</span>
<span id="cb87-3"><a href="lalonde-calónico-smith-lcs-data.html#cb87-3" tabindex="-1"></a>out2 <span class="ot">&lt;-</span> <span class="fu">estimate_all</span>(lcs_psid, <span class="st">&quot;re79&quot;</span>, <span class="st">&quot;treat&quot;</span>, covar)</span>
<span id="cb87-4"><a href="lalonde-calónico-smith-lcs-data.html#cb87-4" tabindex="-1"></a></span>
<span id="cb87-5"><a href="lalonde-calónico-smith-lcs-data.html#cb87-5" tabindex="-1"></a>out.psid <span class="ot">&lt;-</span> <span class="fu">lapply</span>(top5_datasets.psid, <span class="cf">function</span>(d) <span class="fu">estimate_all</span>(d, <span class="st">&quot;re79&quot;</span>, <span class="st">&quot;treat&quot;</span>, covar))</span>
<span id="cb87-6"><a href="lalonde-calónico-smith-lcs-data.html#cb87-6" tabindex="-1"></a>out3 <span class="ot">&lt;-</span> out.psid[[<span class="dv">1</span>]]</span>
<span id="cb87-7"><a href="lalonde-calónico-smith-lcs-data.html#cb87-7" tabindex="-1"></a>out4 <span class="ot">&lt;-</span> out.psid[[<span class="dv">2</span>]]</span>
<span id="cb87-8"><a href="lalonde-calónico-smith-lcs-data.html#cb87-8" tabindex="-1"></a>out5 <span class="ot">&lt;-</span> out.psid[[<span class="dv">3</span>]]</span>
<span id="cb87-9"><a href="lalonde-calónico-smith-lcs-data.html#cb87-9" tabindex="-1"></a>out6 <span class="ot">&lt;-</span> out.psid[[<span class="dv">4</span>]]</span>
<span id="cb87-10"><a href="lalonde-calónico-smith-lcs-data.html#cb87-10" tabindex="-1"></a>out7 <span class="ot">&lt;-</span> out.psid[[<span class="dv">5</span>]]</span>
<span id="cb87-11"><a href="lalonde-calónico-smith-lcs-data.html#cb87-11" tabindex="-1"></a></span>
<span id="cb87-12"><a href="lalonde-calónico-smith-lcs-data.html#cb87-12" tabindex="-1"></a><span class="fu">load</span>(<span class="st">&quot;data/lcs.RData&quot;</span>)</span>
<span id="cb87-13"><a href="lalonde-calónico-smith-lcs-data.html#cb87-13" tabindex="-1"></a>out8 <span class="ot">&lt;-</span> <span class="fu">estimate_all</span>(lcs_trim_psid, Y, <span class="st">&quot;treat&quot;</span>, covar)</span>
<span id="cb87-14"><a href="lalonde-calónico-smith-lcs-data.html#cb87-14" tabindex="-1"></a>out9 <span class="ot">&lt;-</span> <span class="fu">estimate_all</span>(lcs_psid_trim, Y, <span class="st">&quot;treat&quot;</span>, covar)</span></code></pre></div>
<div class="sourceCode" id="cb88"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb88-1"><a href="lalonde-calónico-smith-lcs-data.html#cb88-1" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">4</span>, <span class="dv">1</span>), <span class="at">mar =</span> <span class="fu">c</span>(<span class="dv">4</span>, <span class="dv">4</span>, <span class="dv">2</span>, <span class="dv">1</span>))</span>
<span id="cb88-2"><a href="lalonde-calónico-smith-lcs-data.html#cb88-2" tabindex="-1"></a></span>
<span id="cb88-3"><a href="lalonde-calónico-smith-lcs-data.html#cb88-3" tabindex="-1"></a><span class="co"># experimental benchmarks</span></span>
<span id="cb88-4"><a href="lalonde-calónico-smith-lcs-data.html#cb88-4" tabindex="-1"></a>band.exp <span class="ot">&lt;-</span> out1[<span class="dv">1</span>, <span class="dv">3</span><span class="sc">:</span><span class="dv">4</span>]</span>
<span id="cb88-5"><a href="lalonde-calónico-smith-lcs-data.html#cb88-5" tabindex="-1"></a>est.exp  <span class="ot">&lt;-</span> out1[<span class="dv">1</span>, <span class="dv">1</span>]</span>
<span id="cb88-6"><a href="lalonde-calónico-smith-lcs-data.html#cb88-6" tabindex="-1"></a></span>
<span id="cb88-7"><a href="lalonde-calónico-smith-lcs-data.html#cb88-7" tabindex="-1"></a><span class="co"># plot results</span></span>
<span id="cb88-8"><a href="lalonde-calónico-smith-lcs-data.html#cb88-8" tabindex="-1"></a><span class="fu">plot_coef</span>(out1,  <span class="at">band =</span> band.exp, <span class="at">line =</span> est.exp, </span>
<span id="cb88-9"><a href="lalonde-calónico-smith-lcs-data.html#cb88-9" tabindex="-1"></a>          <span class="at">ylim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">15500</span>, <span class="dv">5500</span>), <span class="at">main =</span> <span class="st">&quot;(A) LCS-Experimental&quot;</span>)</span>
<span id="cb88-10"><a href="lalonde-calónico-smith-lcs-data.html#cb88-10" tabindex="-1"></a></span>
<span id="cb88-11"><a href="lalonde-calónico-smith-lcs-data.html#cb88-11" tabindex="-1"></a><span class="fu">plot_coef</span>(out2,  <span class="at">band =</span> band.exp, <span class="at">line =</span> est.exp, </span>
<span id="cb88-12"><a href="lalonde-calónico-smith-lcs-data.html#cb88-12" tabindex="-1"></a>          <span class="at">ylim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">15500</span>, <span class="dv">5500</span>), <span class="at">main =</span> <span class="st">&quot;(B) LCS-PSID1&quot;</span>)</span>
<span id="cb88-13"><a href="lalonde-calónico-smith-lcs-data.html#cb88-13" tabindex="-1"></a></span>
<span id="cb88-14"><a href="lalonde-calónico-smith-lcs-data.html#cb88-14" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="fu">seq_along</span>(out.psid)) {</span>
<span id="cb88-15"><a href="lalonde-calónico-smith-lcs-data.html#cb88-15" tabindex="-1"></a>  this_title <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">&quot;(&quot;</span>, LETTERS[i<span class="sc">+</span><span class="dv">2</span>], <span class="st">&quot;) Top PSID1: &quot;</span>, top5_methods.psid[i])</span>
<span id="cb88-16"><a href="lalonde-calónico-smith-lcs-data.html#cb88-16" tabindex="-1"></a>  <span class="fu">plot_coef</span>(out.psid[[i]], <span class="at">band =</span> band.exp, <span class="at">line =</span> est.exp,</span>
<span id="cb88-17"><a href="lalonde-calónico-smith-lcs-data.html#cb88-17" tabindex="-1"></a>            <span class="at">ylim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">15500</span>, <span class="dv">5500</span>), <span class="at">main =</span> this_title)</span>
<span id="cb88-18"><a href="lalonde-calónico-smith-lcs-data.html#cb88-18" tabindex="-1"></a>}</span></code></pre></div>
<div class="figure"><span style="display:block;" id="fig:unnamed-chunk-75-1"></span>
<img src="Outcome-Weights_files/figure-html/unnamed-chunk-75-1.png" alt="FIGURED10. SubfigureA:LCS-Experimental. SubfigureB:LCS-PSID1. SubfigureC-G:Top-LCS-PSID1. SubfigureH:LCS-PSID1-PLUS. ATT Estimates Given Unconfoundedness using LCS Samples" width="100%" />
<p class="caption">
Figure 1.6: FIGURED10. SubfigureA:LCS-Experimental. SubfigureB:LCS-PSID1. SubfigureC-G:Top-LCS-PSID1. SubfigureH:LCS-PSID1-PLUS. ATT Estimates Given Unconfoundedness using LCS Samples
</p>
</div>
<div class="sourceCode" id="cb89"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb89-1"><a href="lalonde-calónico-smith-lcs-data.html#cb89-1" tabindex="-1"></a><span class="co"># nonexperimtenal benchmarks</span></span>
<span id="cb89-2"><a href="lalonde-calónico-smith-lcs-data.html#cb89-2" tabindex="-1"></a>band.psid_plus <span class="ot">&lt;-</span> out8[<span class="dv">1</span>, <span class="dv">3</span><span class="sc">:</span><span class="dv">4</span>]</span>
<span id="cb89-3"><a href="lalonde-calónico-smith-lcs-data.html#cb89-3" tabindex="-1"></a>est.psid_plus <span class="ot">&lt;-</span> out8[<span class="dv">1</span>, <span class="dv">1</span>]</span>
<span id="cb89-4"><a href="lalonde-calónico-smith-lcs-data.html#cb89-4" tabindex="-1"></a></span>
<span id="cb89-5"><a href="lalonde-calónico-smith-lcs-data.html#cb89-5" tabindex="-1"></a><span class="co"># plot results</span></span>
<span id="cb89-6"><a href="lalonde-calónico-smith-lcs-data.html#cb89-6" tabindex="-1"></a><span class="fu">plot_coef</span>(out9, <span class="at">band =</span> band.psid_plus, <span class="at">line =</span> est.psid_plus, </span>
<span id="cb89-7"><a href="lalonde-calónico-smith-lcs-data.html#cb89-7" tabindex="-1"></a>          <span class="at">ylim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">15500</span>, <span class="dv">5500</span>), <span class="at">main =</span> <span class="st">&quot;(H) Trimmed LCS-PSID1-PLUS&quot;</span>)</span></code></pre></div>
<div class="figure"><span style="display:block;" id="fig:unnamed-chunk-75-2"></span>
<img src="Outcome-Weights_files/figure-html/unnamed-chunk-75-2.png" alt="FIGURED10. SubfigureA:LCS-Experimental. SubfigureB:LCS-PSID1. SubfigureC-G:Top-LCS-PSID1. SubfigureH:LCS-PSID1-PLUS. ATT Estimates Given Unconfoundedness using LCS Samples" width="100%" />
<p class="caption">
Figure 1.7: FIGURED10. SubfigureA:LCS-Experimental. SubfigureB:LCS-PSID1. SubfigureC-G:Top-LCS-PSID1. SubfigureH:LCS-PSID1-PLUS. ATT Estimates Given Unconfoundedness using LCS Samples
</p>
</div>
<div class="sourceCode" id="cb90"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb90-1"><a href="lalonde-calónico-smith-lcs-data.html#cb90-1" tabindex="-1"></a><span class="co"># save results</span></span>
<span id="cb90-2"><a href="lalonde-calónico-smith-lcs-data.html#cb90-2" tabindex="-1"></a><span class="fu">save_att_panels</span>(</span>
<span id="cb90-3"><a href="lalonde-calónico-smith-lcs-data.html#cb90-3" tabindex="-1"></a>  <span class="at">out_list =</span> <span class="fu">list</span>(out1, out2),</span>
<span id="cb90-4"><a href="lalonde-calónico-smith-lcs-data.html#cb90-4" tabindex="-1"></a>  <span class="at">plot_titles =</span> <span class="fu">c</span>(<span class="st">&quot;(A) LCS-Experimental&quot;</span>, <span class="st">&quot;(B) LCS-PSID1&quot;</span>),</span>
<span id="cb90-5"><a href="lalonde-calónico-smith-lcs-data.html#cb90-5" tabindex="-1"></a>  <span class="at">band_list =</span> <span class="fu">list</span>(band.exp, band.exp),</span>
<span id="cb90-6"><a href="lalonde-calónico-smith-lcs-data.html#cb90-6" tabindex="-1"></a>  <span class="at">est_list  =</span> <span class="fu">list</span>(est.exp, est.exp),</span>
<span id="cb90-7"><a href="lalonde-calónico-smith-lcs-data.html#cb90-7" tabindex="-1"></a>  <span class="at">prefix =</span> <span class="st">&quot;lcs_est_exp&quot;</span></span>
<span id="cb90-8"><a href="lalonde-calónico-smith-lcs-data.html#cb90-8" tabindex="-1"></a>)</span>
<span id="cb90-9"><a href="lalonde-calónico-smith-lcs-data.html#cb90-9" tabindex="-1"></a></span>
<span id="cb90-10"><a href="lalonde-calónico-smith-lcs-data.html#cb90-10" tabindex="-1"></a><span class="fu">save_att_panels</span>(</span>
<span id="cb90-11"><a href="lalonde-calónico-smith-lcs-data.html#cb90-11" tabindex="-1"></a>  <span class="at">out_list =</span> out.psid,</span>
<span id="cb90-12"><a href="lalonde-calónico-smith-lcs-data.html#cb90-12" tabindex="-1"></a>  <span class="at">plot_titles =</span> <span class="fu">paste0</span>(<span class="st">&quot;(&quot;</span>, LETTERS[<span class="dv">3</span><span class="sc">:</span><span class="dv">7</span>], <span class="st">&quot;) Top PSID1: &quot;</span>, top5_methods.psid),</span>
<span id="cb90-13"><a href="lalonde-calónico-smith-lcs-data.html#cb90-13" tabindex="-1"></a>  <span class="at">band_list =</span> <span class="fu">replicate</span>(<span class="fu">length</span>(out.psid), band.exp, <span class="at">simplify =</span> <span class="cn">FALSE</span>),</span>
<span id="cb90-14"><a href="lalonde-calónico-smith-lcs-data.html#cb90-14" tabindex="-1"></a>  <span class="at">est_list  =</span> <span class="fu">replicate</span>(<span class="fu">length</span>(out.psid), est.exp, <span class="at">simplify =</span> <span class="cn">FALSE</span>),</span>
<span id="cb90-15"><a href="lalonde-calónico-smith-lcs-data.html#cb90-15" tabindex="-1"></a>  <span class="at">prefix =</span> <span class="st">&quot;ldw_model_a_est_top_psid&quot;</span></span>
<span id="cb90-16"><a href="lalonde-calónico-smith-lcs-data.html#cb90-16" tabindex="-1"></a>)</span>
<span id="cb90-17"><a href="lalonde-calónico-smith-lcs-data.html#cb90-17" tabindex="-1"></a></span>
<span id="cb90-18"><a href="lalonde-calónico-smith-lcs-data.html#cb90-18" tabindex="-1"></a><span class="fu">save_att_panels</span>(</span>
<span id="cb90-19"><a href="lalonde-calónico-smith-lcs-data.html#cb90-19" tabindex="-1"></a>  <span class="at">out_list =</span> <span class="fu">list</span>(out9),</span>
<span id="cb90-20"><a href="lalonde-calónico-smith-lcs-data.html#cb90-20" tabindex="-1"></a>  <span class="at">plot_titles =</span> <span class="fu">c</span>(<span class="st">&quot;(H) Trimmed LCS-CPS1-PLUS&quot;</span>),</span>
<span id="cb90-21"><a href="lalonde-calónico-smith-lcs-data.html#cb90-21" tabindex="-1"></a>  <span class="at">band_list =</span> <span class="fu">list</span>(band.psid_plus),</span>
<span id="cb90-22"><a href="lalonde-calónico-smith-lcs-data.html#cb90-22" tabindex="-1"></a>  <span class="at">est_list  =</span> <span class="fu">list</span>(est.psid_plus),</span>
<span id="cb90-23"><a href="lalonde-calónico-smith-lcs-data.html#cb90-23" tabindex="-1"></a>  <span class="at">prefix =</span> <span class="st">&quot;ldw_model_a_est_plus&quot;</span></span>
<span id="cb90-24"><a href="lalonde-calónico-smith-lcs-data.html#cb90-24" tabindex="-1"></a>)</span></code></pre></div>
<p>The above figures show the ATT estimates and their 95% confidence intervals for eight samples: LCS-Experimental, LCS-PSID1, a series of top-ranked subsamples of LCS-PSID1 based on various matching, weighting, truncation, trimming or integrated criteria, as well as a trimmed version of the LCS-PSID1-PLUS sample (analogous to <span class="citation">Imbens and Xu (<a href="#ref-imbens2024">2024</a>)</span>).</p>
<p>Figure (A) presents the benchmark from the experimental sample (LCS-Experimental), serving as a reference for bias and variance assessment of observational samples. Figures (B) shows results for the observational sample LCS-PSID1 and figures (C) through (G) display results for LCS-PSID1-based top-ranked subsamples. Figure (H) shows results for a trimmed version of LCS-PSID1-PLUS, replicating the tutorial results of Imbens &amp; Xu (2024).</p>
<p>Across the LCS-PSID1 dataset and its top-ranked subsamples, all estimators yield ATT estimates that largely cluster around the experimental benchmark except <code>Diff-in-Means</code>, which tends to produce estimates that deviate slightly more from the benchmark.</p>
<div class="sourceCode" id="cb91"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb91-1"><a href="lalonde-calónico-smith-lcs-data.html#cb91-1" tabindex="-1"></a><span class="co"># get all outputs</span></span>
<span id="cb91-2"><a href="lalonde-calónico-smith-lcs-data.html#cb91-2" tabindex="-1"></a>all_outs <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fu">list</span>(out1, out2), </span>
<span id="cb91-3"><a href="lalonde-calónico-smith-lcs-data.html#cb91-3" tabindex="-1"></a>              out.psid, </span>
<span id="cb91-4"><a href="lalonde-calónico-smith-lcs-data.html#cb91-4" tabindex="-1"></a>              <span class="fu">list</span>(out9))</span>
<span id="cb91-5"><a href="lalonde-calónico-smith-lcs-data.html#cb91-5" tabindex="-1"></a></span>
<span id="cb91-6"><a href="lalonde-calónico-smith-lcs-data.html#cb91-6" tabindex="-1"></a><span class="co"># get plot titles</span></span>
<span id="cb91-7"><a href="lalonde-calónico-smith-lcs-data.html#cb91-7" tabindex="-1"></a>all_plot_titles <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;(A) LCS-Experimental&quot;</span>, <span class="st">&quot;(B) LCS-PSID1&quot;</span>,</span>
<span id="cb91-8"><a href="lalonde-calónico-smith-lcs-data.html#cb91-8" tabindex="-1"></a>                      <span class="fu">paste0</span>(<span class="st">&quot;(&quot;</span>, LETTERS[<span class="dv">3</span><span class="sc">:</span><span class="dv">7</span>], <span class="st">&quot;) Top PSID1: &quot;</span>, top5_methods.psid),</span>
<span id="cb91-9"><a href="lalonde-calónico-smith-lcs-data.html#cb91-9" tabindex="-1"></a>                      <span class="st">&quot;(H) Trimmed LCS-PSID1-PLUS&quot;</span>)</span>
<span id="cb91-10"><a href="lalonde-calónico-smith-lcs-data.html#cb91-10" tabindex="-1"></a></span>
<span id="cb91-11"><a href="lalonde-calónico-smith-lcs-data.html#cb91-11" tabindex="-1"></a><span class="co"># evaluate results</span></span>
<span id="cb91-12"><a href="lalonde-calónico-smith-lcs-data.html#cb91-12" tabindex="-1"></a>all_summaries <span class="ot">&lt;-</span> <span class="fu">lapply</span>(all_outs, eval_att)</span>
<span id="cb91-13"><a href="lalonde-calónico-smith-lcs-data.html#cb91-13" tabindex="-1"></a>att_summary <span class="ot">&lt;-</span> <span class="fu">do.call</span>(rbind, all_summaries)</span>
<span id="cb91-14"><a href="lalonde-calónico-smith-lcs-data.html#cb91-14" tabindex="-1"></a><span class="fu">rownames</span>(att_summary) <span class="ot">&lt;-</span> all_plot_titles</span>
<span id="cb91-15"><a href="lalonde-calónico-smith-lcs-data.html#cb91-15" tabindex="-1"></a></span>
<span id="cb91-16"><a href="lalonde-calónico-smith-lcs-data.html#cb91-16" tabindex="-1"></a><span class="co"># print results</span></span>
<span id="cb91-17"><a href="lalonde-calónico-smith-lcs-data.html#cb91-17" tabindex="-1"></a><span class="fu">datatable</span>(att_summary, <span class="at">caption =</span> <span class="st">&quot;ATT Summary Statistics&quot;</span>,</span>
<span id="cb91-18"><a href="lalonde-calónico-smith-lcs-data.html#cb91-18" tabindex="-1"></a>          <span class="at">options =</span> <span class="fu">list</span>(<span class="at">scrollX =</span> <span class="cn">TRUE</span>, <span class="at">paging =</span> <span class="cn">FALSE</span>, <span class="at">pageLength =</span> <span class="sc">-</span><span class="dv">1</span>, <span class="at">searching =</span> <span class="cn">FALSE</span>))</span></code></pre></div>
<div class="datatables html-widget html-fill-item" id="htmlwidget-d3a15b670239e029179d" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-d3a15b670239e029179d">{"x":{"filter":"none","vertical":false,"caption":"<caption>ATT Summary Statistics<\/caption>","data":[["(A) LCS-Experimental","(B) LCS-PSID1","(C) Top PSID1: opt_weight","(D) Top PSID1: ebal_weight","(E) Top PSID1: cbps_weight","(F) Top PSID1: at_perc_opt_weight","(G) Top PSID1: at_perc_ipw_weight","(H) Trimmed LCS-PSID1-PLUS"],[296.1888066394997,405.1061257426475,401.6774714250153,400.9250708000495,400.9248570740808,399.9896100467516,398.2114670381396,416.7709240175481],[787.7793476149064,-4172.176210511275,-4172.176210511275,-4172.176210511275,-4172.176210511275,-4172.176210511275,-4172.176210511275,-803.6762546357646],[1059.066321794808,1228.659770721612,1228.659770721612,1229.53894852624,1229.643168871219,1228.659770721612,1228.659770721612,673.3452725207526],[271.2869741799017,5400.835981232887,5400.835981232887,5401.715159037514,5401.819379382494,5400.835981232887,5400.835981232887,1477.021527156517]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>Mean_SE<\/th>\n      <th>Min_Estimate<\/th>\n      <th>Max_Estimate<\/th>\n      <th>Diff_Estimate<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"scrollX":true,"paging":false,"pageLength":-1,"searching":false,"columnDefs":[{"className":"dt-right","targets":[1,2,3,4]},{"orderable":false,"targets":0},{"name":" ","targets":0},{"name":"Mean_SE","targets":1},{"name":"Min_Estimate","targets":2},{"name":"Max_Estimate","targets":3},{"name":"Diff_Estimate","targets":4}],"order":[],"autoWidth":false,"orderClasses":false,"lengthMenu":[-1,10,25,50,100]}},"evals":[],"jsHooks":[]}</script>
<p>The ATT results are presented in the table below:</p>
<div class="sourceCode" id="cb92"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb92-1"><a href="lalonde-calónico-smith-lcs-data.html#cb92-1" tabindex="-1"></a><span class="co"># create result matrix</span></span>
<span id="cb92-2"><a href="lalonde-calónico-smith-lcs-data.html#cb92-2" tabindex="-1"></a>result_mat <span class="ot">&lt;-</span> <span class="fu">create_matrix_results</span>(all_outs, all_plot_titles)</span>
<span id="cb92-3"><a href="lalonde-calónico-smith-lcs-data.html#cb92-3" tabindex="-1"></a></span>
<span id="cb92-4"><a href="lalonde-calónico-smith-lcs-data.html#cb92-4" tabindex="-1"></a><span class="co"># render formatted table output</span></span>
<span id="cb92-5"><a href="lalonde-calónico-smith-lcs-data.html#cb92-5" tabindex="-1"></a><span class="fu">datatable</span>(result_mat, <span class="at">caption =</span> <span class="st">&quot;ATT Estimates and SEs&quot;</span>,</span>
<span id="cb92-6"><a href="lalonde-calónico-smith-lcs-data.html#cb92-6" tabindex="-1"></a>          <span class="at">options =</span> <span class="fu">list</span>(<span class="at">scrollX =</span> <span class="cn">TRUE</span>, <span class="at">paging =</span> <span class="cn">FALSE</span>, <span class="at">pageLength =</span> <span class="sc">-</span><span class="dv">1</span>, <span class="at">searching =</span> <span class="cn">FALSE</span>))</span></code></pre></div>
<div class="datatables html-widget html-fill-item" id="htmlwidget-2a8e9539872343d5916c" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-2a8e9539872343d5916c">{"x":{"filter":"none","vertical":false,"caption":"<caption>ATT Estimates and SEs<\/caption>","data":[["Experimental Benchmark","diff","reg","om.reg","om.grf","matching","psm","ipw","cbps","ebal","dml","aipw_grf","aipw_ow"],["821.49","821.49","848.63","895.65","879.63","1059.07","825.60","906.05","896.05","896.09","787.78","914.66","833.45"],["(307.89)","(307.89)","(303.41)","(230.21)","(229.81)","(320.55)","(304.24)","(313.86)","(304.69)","(304.69)","(300.62)","(316.70)","(317.61)"],["821.49","-4172.18","808.44","1128.29","937.89","1036.86","1021.17","994.63","1216.52","1228.66","813.84","1058.28","1127.15"],["(307.89)","(412.18)","(389.48)","(239.37)","(238.14)","(531.41)","(330.85)","(478.86)","(429.26)","(429.73)","(387.60)","(508.02)","(486.38)"],["821.49","-4172.18","808.44","1128.29","916.81","1036.86","1009.36","1135.31","1135.31","1228.66","813.84","1058.28","1127.15"],["(307.89)","(412.18)","(389.48)","(239.37)","(238.07)","(531.41)","(329.34)","(434.27)","(434.27)","(429.73)","(387.60)","(508.02)","(486.38)"],["-4172.18","-4172.18","808.44","1128.29","916.81","1036.86","1009.36","1229.54","1229.54","1228.66","813.84","1058.28","1127.15"],["(412.18)","(412.18)","(389.48)","(239.37)","(238.07)","(531.41)","(329.34)","(429.76)","(429.76)","(429.73)","(387.60)","(508.02)","(486.38)"],["-4172.18","-4172.18","808.44","1128.29","916.81","1036.86","1009.36","1229.64","1229.64","1228.66","813.84","1058.28","1127.15"],["(412.18)","(412.18)","(389.48)","(239.37)","(238.07)","(531.41)","(329.34)","(429.76)","(429.76)","(429.73)","(387.60)","(508.02)","(486.38)"],["-4172.18","-4172.18","808.44","1128.29","916.81","1036.86","1009.36","1093.19","1093.19","1228.66","813.84","1058.28","1127.15"],["(412.18)","(412.18)","(389.48)","(239.37)","(238.07)","(531.41)","(329.34)","(424.14)","(424.14)","(429.73)","(387.60)","(508.02)","(486.38)"],["-4172.18","-4172.18","808.44","1128.29","916.81","1036.86","1009.36","1012.68","1012.68","1228.66","813.84","1058.28","1127.15"],["(412.18)","(412.18)","(389.48)","(239.37)","(238.07)","(531.41)","(329.34)","(413.48)","(413.48)","(429.73)","(387.60)","(508.02)","(486.38)"],["-4172.18","-803.68","359.39","608.26","419.06","443.20","454.36","495.32","670.20","673.35","411.44","435.37","400.39"],["(412.18)","(422.28)","(414.17)","(295.58)","(296.12)","(519.34)","(401.98)","(457.22)","(434.59)","(435.61)","(409.94)","(459.72)","(454.72)"]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>(A) LCS-Experimental<\/th>\n      <th>V2<\/th>\n      <th>(B) LCS-PSID1<\/th>\n      <th>V4<\/th>\n      <th>(C) Top PSID1: opt_weight<\/th>\n      <th>V6<\/th>\n      <th>(D) Top PSID1: ebal_weight<\/th>\n      <th>V8<\/th>\n      <th>(E) Top PSID1: cbps_weight<\/th>\n      <th>V10<\/th>\n      <th>(F) Top PSID1: at_perc_opt_weight<\/th>\n      <th>V12<\/th>\n      <th>(G) Top PSID1: at_perc_ipw_weight<\/th>\n      <th>V14<\/th>\n      <th>(H) Trimmed LCS-PSID1-PLUS<\/th>\n      <th>V16<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"scrollX":true,"paging":false,"pageLength":-1,"searching":false,"columnDefs":[{"orderable":false,"targets":0},{"name":" ","targets":0},{"name":"(A) LCS-Experimental","targets":1},{"name":"V2","targets":2},{"name":"(B) LCS-PSID1","targets":3},{"name":"V4","targets":4},{"name":"(C) Top PSID1: opt_weight","targets":5},{"name":"V6","targets":6},{"name":"(D) Top PSID1: ebal_weight","targets":7},{"name":"V8","targets":8},{"name":"(E) Top PSID1: cbps_weight","targets":9},{"name":"V10","targets":10},{"name":"(F) Top PSID1: at_perc_opt_weight","targets":11},{"name":"V12","targets":12},{"name":"(G) Top PSID1: at_perc_ipw_weight","targets":13},{"name":"V14","targets":14},{"name":"(H) Trimmed LCS-PSID1-PLUS","targets":15},{"name":"V16","targets":16}],"order":[],"autoWidth":false,"orderClasses":false,"lengthMenu":[-1,10,25,50,100]}},"evals":[],"jsHooks":[]}</script>
<p>The tabulated results confirm visual patterns: Column (A) reports the estimates for the LCS-Experimental sample, column (B) for the LCS-PSID1 sample, columns (D)-(H) for the top-ranked subsample of LCS-PSID1, and column (C) for its trimmed version of LCS-PSID-PLUS.</p>
<p>For all PSID1-based samples, the ATT estimates remain overly positive. However, the estimates obtained with the <code>Diff-in-Means</code> estimator are consistently negative, except for the sample constructed with the <code>card</code> method, where the estimates are positive across all estimators.</p>
<div class="sourceCode" id="cb93"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb93-1"><a href="lalonde-calónico-smith-lcs-data.html#cb93-1" tabindex="-1"></a><span class="co"># save results </span></span>
<span id="cb93-2"><a href="lalonde-calónico-smith-lcs-data.html#cb93-2" tabindex="-1"></a><span class="fu">save_csv</span>(result_mat, <span class="st">&quot;lcs_att_est&quot;</span>)</span></code></pre></div>
</div>
<div id="conditional-average-treatment-effect-on-the-treated-catt" class="section level3 hasAnchor" number="1.9.2">
<h3><span class="header-section-number">1.9.2</span> Conditional average treatment effect on the treated (CATT)<a href="lalonde-calónico-smith-lcs-data.html#conditional-average-treatment-effect-on-the-treated-catt" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb94"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb94-1"><a href="lalonde-calónico-smith-lcs-data.html#cb94-1" tabindex="-1"></a>catt.lcs <span class="ot">&lt;-</span> <span class="fu">catt</span>(lcs, Y, treat, covar)</span>
<span id="cb94-2"><a href="lalonde-calónico-smith-lcs-data.html#cb94-2" tabindex="-1"></a>catt.psid <span class="ot">&lt;-</span> <span class="fu">catt</span>(lcs_psid, Y, treat, covar)</span>
<span id="cb94-3"><a href="lalonde-calónico-smith-lcs-data.html#cb94-3" tabindex="-1"></a>catt.top5_psid <span class="ot">&lt;-</span> <span class="fu">lapply</span>(top5_datasets.psid, <span class="cf">function</span>(d) <span class="fu">catt</span>(d, Y, treat, covar))</span></code></pre></div>
<div class="sourceCode" id="cb95"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb95-1"><a href="lalonde-calónico-smith-lcs-data.html#cb95-1" tabindex="-1"></a>catt.lcs.psid <span class="ot">&lt;-</span> <span class="fu">catt</span>(lcs_trim_psid, Y, treat, covar)</span>
<span id="cb95-2"><a href="lalonde-calónico-smith-lcs-data.html#cb95-2" tabindex="-1"></a>catt.psid.trim <span class="ot">&lt;-</span> <span class="fu">catt</span>(lcs_psid_trim, Y, treat, covar)</span></code></pre></div>
<div class="sourceCode" id="cb96"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb96-1"><a href="lalonde-calónico-smith-lcs-data.html#cb96-1" tabindex="-1"></a><span class="co"># plot results</span></span>
<span id="cb96-2"><a href="lalonde-calónico-smith-lcs-data.html#cb96-2" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">2</span>)) </span>
<span id="cb96-3"><a href="lalonde-calónico-smith-lcs-data.html#cb96-3" tabindex="-1"></a><span class="fu">par</span>(<span class="at">cex.main =</span> <span class="fl">0.9</span>)</span>
<span id="cb96-4"><a href="lalonde-calónico-smith-lcs-data.html#cb96-4" tabindex="-1"></a><span class="fu">plot_catt</span>(</span>
<span id="cb96-5"><a href="lalonde-calónico-smith-lcs-data.html#cb96-5" tabindex="-1"></a>  <span class="at">catt1 =</span> catt.lcs<span class="sc">$</span>catt,</span>
<span id="cb96-6"><a href="lalonde-calónico-smith-lcs-data.html#cb96-6" tabindex="-1"></a>  <span class="at">catt2 =</span> catt.psid<span class="sc">$</span>catt,</span>
<span id="cb96-7"><a href="lalonde-calónico-smith-lcs-data.html#cb96-7" tabindex="-1"></a>  <span class="at">att1  =</span> catt.lcs<span class="sc">$</span>att[<span class="dv">1</span>],</span>
<span id="cb96-8"><a href="lalonde-calónico-smith-lcs-data.html#cb96-8" tabindex="-1"></a>  <span class="at">att2  =</span> catt.psid<span class="sc">$</span>att[<span class="dv">1</span>],</span>
<span id="cb96-9"><a href="lalonde-calónico-smith-lcs-data.html#cb96-9" tabindex="-1"></a>  <span class="at">xlab  =</span> <span class="st">&quot;CATT (Experimental)&quot;</span>,</span>
<span id="cb96-10"><a href="lalonde-calónico-smith-lcs-data.html#cb96-10" tabindex="-1"></a>  <span class="at">ylab  =</span> <span class="st">&quot;CATT (CPS1)&quot;</span>,</span>
<span id="cb96-11"><a href="lalonde-calónico-smith-lcs-data.html#cb96-11" tabindex="-1"></a>  <span class="at">main  =</span> <span class="st">&quot;(B) LCS-PSID1&quot;</span>, </span>
<span id="cb96-12"><a href="lalonde-calónico-smith-lcs-data.html#cb96-12" tabindex="-1"></a>  <span class="at">axes.range =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">8000</span>, <span class="dv">8000</span>)</span>
<span id="cb96-13"><a href="lalonde-calónico-smith-lcs-data.html#cb96-13" tabindex="-1"></a>)</span>
<span id="cb96-14"><a href="lalonde-calónico-smith-lcs-data.html#cb96-14" tabindex="-1"></a></span>
<span id="cb96-15"><a href="lalonde-calónico-smith-lcs-data.html#cb96-15" tabindex="-1"></a><span class="fu">plot_catt_panels</span>(</span>
<span id="cb96-16"><a href="lalonde-calónico-smith-lcs-data.html#cb96-16" tabindex="-1"></a>  <span class="at">exp_catt =</span> catt.lcs,</span>
<span id="cb96-17"><a href="lalonde-calónico-smith-lcs-data.html#cb96-17" tabindex="-1"></a>  <span class="at">catt_list  =</span> catt.top5_psid,</span>
<span id="cb96-18"><a href="lalonde-calónico-smith-lcs-data.html#cb96-18" tabindex="-1"></a>  <span class="at">plot_titles =</span> <span class="fu">paste0</span>(<span class="st">&quot;(&quot;</span>, LETTERS[<span class="dv">3</span><span class="sc">:</span><span class="dv">7</span>], <span class="st">&quot;) Top PSID1: &quot;</span>, top5_methods.psid)</span>
<span id="cb96-19"><a href="lalonde-calónico-smith-lcs-data.html#cb96-19" tabindex="-1"></a>)</span></code></pre></div>
<div class="figure"><span style="display:block;" id="fig:unnamed-chunk-82-1"></span>
<img src="Outcome-Weights_files/figure-html/unnamed-chunk-82-1.png" alt="FIGURED11. SubfigureB:LCS-PSID1. SubfigureC-G:Top-LCS-PSID1. SubfigureH:LCS-PSID1-PLUS. CATT Estimates using LCS Data: Experimental vs. Nonexperimental" width="100%" />
<p class="caption">
Figure 1.8: FIGURED11. SubfigureB:LCS-PSID1. SubfigureC-G:Top-LCS-PSID1. SubfigureH:LCS-PSID1-PLUS. CATT Estimates using LCS Data: Experimental vs. Nonexperimental
</p>
</div>
<div class="figure"><span style="display:block;" id="fig:unnamed-chunk-82-2"></span>
<img src="Outcome-Weights_files/figure-html/unnamed-chunk-82-2.png" alt="FIGURED11. SubfigureB:LCS-PSID1. SubfigureC-G:Top-LCS-PSID1. SubfigureH:LCS-PSID1-PLUS. CATT Estimates using LCS Data: Experimental vs. Nonexperimental" width="100%" />
<p class="caption">
Figure 1.9: FIGURED11. SubfigureB:LCS-PSID1. SubfigureC-G:Top-LCS-PSID1. SubfigureH:LCS-PSID1-PLUS. CATT Estimates using LCS Data: Experimental vs. Nonexperimental
</p>
</div>
<div class="sourceCode" id="cb97"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb97-1"><a href="lalonde-calónico-smith-lcs-data.html#cb97-1" tabindex="-1"></a><span class="fu">plot_catt</span>(</span>
<span id="cb97-2"><a href="lalonde-calónico-smith-lcs-data.html#cb97-2" tabindex="-1"></a>  catt1 <span class="ot">&lt;-</span> catt.lcs.psid<span class="sc">$</span>catt,</span>
<span id="cb97-3"><a href="lalonde-calónico-smith-lcs-data.html#cb97-3" tabindex="-1"></a>  catt2 <span class="ot">&lt;-</span> catt.psid.trim<span class="sc">$</span>catt,</span>
<span id="cb97-4"><a href="lalonde-calónico-smith-lcs-data.html#cb97-4" tabindex="-1"></a>  att1 <span class="ot">&lt;-</span> catt.lcs.psid<span class="sc">$</span>att[<span class="dv">1</span>],</span>
<span id="cb97-5"><a href="lalonde-calónico-smith-lcs-data.html#cb97-5" tabindex="-1"></a>  att2 <span class="ot">&lt;-</span> catt.psid.trim<span class="sc">$</span>att[<span class="dv">1</span>],</span>
<span id="cb97-6"><a href="lalonde-calónico-smith-lcs-data.html#cb97-6" tabindex="-1"></a>  <span class="at">xlab  =</span> <span class="st">&quot;CATT (Experimental)&quot;</span>,</span>
<span id="cb97-7"><a href="lalonde-calónico-smith-lcs-data.html#cb97-7" tabindex="-1"></a>  <span class="at">ylab  =</span> <span class="st">&quot;CATT (PSID1-PLUS-Trimmed)&quot;</span>,</span>
<span id="cb97-8"><a href="lalonde-calónico-smith-lcs-data.html#cb97-8" tabindex="-1"></a>  <span class="at">main  =</span> <span class="st">&quot;(H) Trimmed LCS-PSID1-PLUS&quot;</span>,</span>
<span id="cb97-9"><a href="lalonde-calónico-smith-lcs-data.html#cb97-9" tabindex="-1"></a>  <span class="at">axes.range =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">8000</span>, <span class="dv">8000</span>)</span>
<span id="cb97-10"><a href="lalonde-calónico-smith-lcs-data.html#cb97-10" tabindex="-1"></a>)</span></code></pre></div>
<div class="figure"><span style="display:block;" id="fig:unnamed-chunk-82-3"></span>
<img src="Outcome-Weights_files/figure-html/unnamed-chunk-82-3.png" alt="FIGURED11. SubfigureB:LCS-PSID1. SubfigureC-G:Top-LCS-PSID1. SubfigureH:LCS-PSID1-PLUS. CATT Estimates using LCS Data: Experimental vs. Nonexperimental" width="100%" />
<p class="caption">
Figure 1.10: FIGURED11. SubfigureB:LCS-PSID1. SubfigureC-G:Top-LCS-PSID1. SubfigureH:LCS-PSID1-PLUS. CATT Estimates using LCS Data: Experimental vs. Nonexperimental
</p>
</div>
<div class="sourceCode" id="cb98"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb98-1"><a href="lalonde-calónico-smith-lcs-data.html#cb98-1" tabindex="-1"></a><span class="co"># combine all catt objects </span></span>
<span id="cb98-2"><a href="lalonde-calónico-smith-lcs-data.html#cb98-2" tabindex="-1"></a>all_catt <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fu">list</span>(catt.lcs, catt.psid), </span>
<span id="cb98-3"><a href="lalonde-calónico-smith-lcs-data.html#cb98-3" tabindex="-1"></a>              catt.top5_psid, </span>
<span id="cb98-4"><a href="lalonde-calónico-smith-lcs-data.html#cb98-4" tabindex="-1"></a>              <span class="fu">list</span>(catt.psid.trim))</span>
<span id="cb98-5"><a href="lalonde-calónico-smith-lcs-data.html#cb98-5" tabindex="-1"></a></span>
<span id="cb98-6"><a href="lalonde-calónico-smith-lcs-data.html#cb98-6" tabindex="-1"></a>all_catt_eval <span class="ot">&lt;-</span> <span class="fu">eval_catt</span>(all_catt, all_plot_titles)</span>
<span id="cb98-7"><a href="lalonde-calónico-smith-lcs-data.html#cb98-7" tabindex="-1"></a><span class="fu">datatable</span>(all_catt_eval, <span class="at">caption =</span> <span class="st">&quot;CATT Summary Statistics&quot;</span>,</span>
<span id="cb98-8"><a href="lalonde-calónico-smith-lcs-data.html#cb98-8" tabindex="-1"></a>          <span class="at">options =</span> <span class="fu">list</span>(<span class="at">scrollX =</span> <span class="cn">TRUE</span>, <span class="at">paging =</span> <span class="cn">FALSE</span>, <span class="at">pageLength =</span> <span class="sc">-</span><span class="dv">1</span>, <span class="at">searching =</span> <span class="cn">FALSE</span>))</span></code></pre></div>
<div class="figure"><span style="display:block;" id="fig:unnamed-chunk-83"></span>
<div class="datatables html-widget html-fill-item" id="htmlwidget-5bc403e1f7b162d7d6b0" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-5bc403e1f7b162d7d6b0">{"x":{"filter":"none","vertical":false,"caption":"<caption>CATT Summary Statistics<\/caption>","data":[["1","2","3","4","5","6","7","8"],["(A) LCS-Experimental","(B) LCS-PSID1","(C) Top PSID1: opt_weight","(D) Top PSID1: ebal_weight","(E) Top PSID1: cbps_weight","(F) Top PSID1: at_perc_opt_weight","(G) Top PSID1: at_perc_ipw_weight","(H) Trimmed LCS-PSID1-PLUS"],[-478.4521332633424,-3149.809663918374,-3120.420476931732,-3144.790649449389,-3102.353692975883,-2883.005210910535,-3410.736982027173,-3093.05913251714],[2895.229624805902,2395.656951386139,2490.289099233396,2395.277881694382,2517.532713732877,2407.851634654647,2370.940833224179,2465.360156741316],[886.3147184494835,791.7071137147884,755.5115666307715,771.8531923641042,756.6437454168662,769.3921004055975,726.959276071614,279.5013701997277],[3373.681758069245,5545.466615304513,5610.709576165127,5540.06853114377,5619.88640670876,5290.856845565182,5781.677815251353,5558.419289258456]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>Method<\/th>\n      <th>Min_Catt<\/th>\n      <th>Max_Catt<\/th>\n      <th>Mean_Catt<\/th>\n      <th>Diff_Catt<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"scrollX":true,"paging":false,"pageLength":-1,"searching":false,"columnDefs":[{"className":"dt-right","targets":[2,3,4,5]},{"orderable":false,"targets":0},{"name":" ","targets":0},{"name":"Method","targets":1},{"name":"Min_Catt","targets":2},{"name":"Max_Catt","targets":3},{"name":"Mean_Catt","targets":4},{"name":"Diff_Catt","targets":5}],"order":[],"autoWidth":false,"orderClasses":false,"lengthMenu":[-1,10,25,50,100]}},"evals":[],"jsHooks":[]}</script>
<p class="caption">
Figure 1.11: FIGURED12. CATT Estimates using LCS Data
</p>
</div>
<p>With LCS-PSID1, CATT estimates span from $-3,149.81 to $2,395.66, contrasting with the CATT estimated from experimental data which ranges from $-478.45 to $2,895.23, with a mean CATT estimate of $886.31.</p>
<p>In contract, across the LCS-PSID1-based subsamples, the ranges of CATT estimates are relatively similar. Importantly, the mean CATT estimates remain positive in all cases and for the <code>card</code> subsample as well as the trimmed plus-sample the mean CATT values are notably reduced.</p>
<div class="sourceCode" id="cb99"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb99-1"><a href="lalonde-calónico-smith-lcs-data.html#cb99-1" tabindex="-1"></a><span class="fu">save_main_catt_panels</span>(</span>
<span id="cb99-2"><a href="lalonde-calónico-smith-lcs-data.html#cb99-2" tabindex="-1"></a>  <span class="at">catt_refs =</span> <span class="fu">list</span>(catt.lcs),</span>
<span id="cb99-3"><a href="lalonde-calónico-smith-lcs-data.html#cb99-3" tabindex="-1"></a>  <span class="at">catt_comps =</span> <span class="fu">list</span>(catt.psid),</span>
<span id="cb99-4"><a href="lalonde-calónico-smith-lcs-data.html#cb99-4" tabindex="-1"></a>  <span class="at">ylabels =</span> <span class="fu">c</span>(<span class="st">&quot;CATT (PSID1)&quot;</span>),</span>
<span id="cb99-5"><a href="lalonde-calónico-smith-lcs-data.html#cb99-5" tabindex="-1"></a>  <span class="at">prefix =</span> <span class="st">&quot;lcs_catt_main_panels&quot;</span>,</span>
<span id="cb99-6"><a href="lalonde-calónico-smith-lcs-data.html#cb99-6" tabindex="-1"></a>  <span class="at">main_titles =</span> <span class="fu">c</span>(<span class="st">&quot;(B) LCS-PSID1&quot;</span>)</span>
<span id="cb99-7"><a href="lalonde-calónico-smith-lcs-data.html#cb99-7" tabindex="-1"></a>)</span>
<span id="cb99-8"><a href="lalonde-calónico-smith-lcs-data.html#cb99-8" tabindex="-1"></a></span>
<span id="cb99-9"><a href="lalonde-calónico-smith-lcs-data.html#cb99-9" tabindex="-1"></a><span class="fu">save_catt_panels</span>(</span>
<span id="cb99-10"><a href="lalonde-calónico-smith-lcs-data.html#cb99-10" tabindex="-1"></a>  <span class="at">exp_catt =</span> catt.lcs,</span>
<span id="cb99-11"><a href="lalonde-calónico-smith-lcs-data.html#cb99-11" tabindex="-1"></a>  <span class="at">catt_list  =</span> catt.top5_psid,</span>
<span id="cb99-12"><a href="lalonde-calónico-smith-lcs-data.html#cb99-12" tabindex="-1"></a>  <span class="at">plot_titles =</span> <span class="fu">paste0</span>(<span class="st">&quot;(&quot;</span>, LETTERS[<span class="dv">3</span><span class="sc">:</span><span class="dv">7</span>], <span class="st">&quot;) Top PSID1: &quot;</span>, top5_methods.psid),</span>
<span id="cb99-13"><a href="lalonde-calónico-smith-lcs-data.html#cb99-13" tabindex="-1"></a>  <span class="at">prefix =</span> <span class="st">&quot;lcs_catt_top5_psid&quot;</span></span>
<span id="cb99-14"><a href="lalonde-calónico-smith-lcs-data.html#cb99-14" tabindex="-1"></a>)</span>
<span id="cb99-15"><a href="lalonde-calónico-smith-lcs-data.html#cb99-15" tabindex="-1"></a></span>
<span id="cb99-16"><a href="lalonde-calónico-smith-lcs-data.html#cb99-16" tabindex="-1"></a><span class="fu">save_plus_catt_panels</span>(</span>
<span id="cb99-17"><a href="lalonde-calónico-smith-lcs-data.html#cb99-17" tabindex="-1"></a>  <span class="at">catt1_list =</span> <span class="fu">list</span>(catt.lcs.psid),</span>
<span id="cb99-18"><a href="lalonde-calónico-smith-lcs-data.html#cb99-18" tabindex="-1"></a>  <span class="at">catt2_list =</span> <span class="fu">list</span>(catt.psid.trim),</span>
<span id="cb99-19"><a href="lalonde-calónico-smith-lcs-data.html#cb99-19" tabindex="-1"></a>  <span class="at">ylabels =</span> <span class="fu">c</span>(<span class="st">&quot;CATT (PSID1-PLUS-Trimmed)&quot;</span>),</span>
<span id="cb99-20"><a href="lalonde-calónico-smith-lcs-data.html#cb99-20" tabindex="-1"></a>  <span class="at">prefix =</span> <span class="st">&quot;lcs_catt_plus_panels&quot;</span>,</span>
<span id="cb99-21"><a href="lalonde-calónico-smith-lcs-data.html#cb99-21" tabindex="-1"></a>  <span class="at">main_titles =</span> <span class="fu">c</span>(<span class="st">&quot;(H) Trimmed LCS-PSID1-PLUS&quot;</span>)</span>
<span id="cb99-22"><a href="lalonde-calónico-smith-lcs-data.html#cb99-22" tabindex="-1"></a>)</span></code></pre></div>
</div>
<div id="quantile-treatment-effect-on-the-treated-qtet" class="section level3 hasAnchor" number="1.9.3">
<h3><span class="header-section-number">1.9.3</span> Quantile treatment effect on the treated (QTET)<a href="lalonde-calónico-smith-lcs-data.html#quantile-treatment-effect-on-the-treated-qtet" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb100"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb100-1"><a href="lalonde-calónico-smith-lcs-data.html#cb100-1" tabindex="-1"></a>qte.lcs <span class="ot">&lt;-</span> <span class="fu">est_qte</span>(Y, treat, covar, <span class="at">data =</span> lcs, <span class="at">cores =</span> <span class="dv">4</span>)</span>
<span id="cb100-2"><a href="lalonde-calónico-smith-lcs-data.html#cb100-2" tabindex="-1"></a>qte.lcs_psid <span class="ot">&lt;-</span> <span class="fu">est_qte</span>(Y, treat, covar, <span class="at">data =</span> lcs_psid)</span>
<span id="cb100-3"><a href="lalonde-calónico-smith-lcs-data.html#cb100-3" tabindex="-1"></a>qte.top5_psid <span class="ot">&lt;-</span> <span class="fu">lapply</span>(top5_datasets.psid, <span class="cf">function</span>(d) <span class="fu">est_qte</span>(Y, treat, covar, <span class="at">data =</span> d))</span></code></pre></div>
<div class="sourceCode" id="cb101"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb101-1"><a href="lalonde-calónico-smith-lcs-data.html#cb101-1" tabindex="-1"></a>qte.lcs.psid <span class="ot">&lt;-</span> <span class="fu">est_qte</span>(Y, treat, <span class="cn">NULL</span>, <span class="at">data =</span> lcs_trim_psid)</span>
<span id="cb101-2"><a href="lalonde-calónico-smith-lcs-data.html#cb101-2" tabindex="-1"></a>qte.lcs_psid.trim <span class="ot">&lt;-</span> <span class="fu">est_qte</span>(Y, treat, covar, <span class="at">data =</span> lcs_psid_trim)</span></code></pre></div>
<div class="sourceCode" id="cb102"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb102-1"><a href="lalonde-calónico-smith-lcs-data.html#cb102-1" tabindex="-1"></a>qte.lcs0 <span class="ot">&lt;-</span> <span class="fu">est_qte</span>(Y, treat, <span class="cn">NULL</span>, <span class="at">data =</span> lcs)</span>
<span id="cb102-2"><a href="lalonde-calónico-smith-lcs-data.html#cb102-2" tabindex="-1"></a>qte.lcs_psid0 <span class="ot">&lt;-</span> <span class="fu">est_qte</span>(Y, treat, <span class="cn">NULL</span>, <span class="at">data =</span> lcs_psid)</span>
<span id="cb102-3"><a href="lalonde-calónico-smith-lcs-data.html#cb102-3" tabindex="-1"></a>qte.top5_psid0 <span class="ot">&lt;-</span> <span class="fu">lapply</span>(top5_datasets.psid, <span class="cf">function</span>(d) <span class="fu">est_qte</span>(Y, treat, <span class="cn">NULL</span>, <span class="at">data =</span> d))</span></code></pre></div>
<div class="sourceCode" id="cb103"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb103-1"><a href="lalonde-calónico-smith-lcs-data.html#cb103-1" tabindex="-1"></a>qte.lcs_psid.trim0 <span class="ot">&lt;-</span> <span class="fu">est_qte</span>(Y, treat, <span class="cn">NULL</span>, <span class="at">data =</span> lcs_psid_trim)</span></code></pre></div>
<div class="sourceCode" id="cb104"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb104-1"><a href="lalonde-calónico-smith-lcs-data.html#cb104-1" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">2</span>))</span>
<span id="cb104-2"><a href="lalonde-calónico-smith-lcs-data.html#cb104-2" tabindex="-1"></a><span class="fu">par</span>(<span class="at">cex.main =</span> <span class="fl">0.9</span>)</span>
<span id="cb104-3"><a href="lalonde-calónico-smith-lcs-data.html#cb104-3" tabindex="-1"></a>ylim <span class="ot">=</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">25000</span>, <span class="dv">15000</span>)</span>
<span id="cb104-4"><a href="lalonde-calónico-smith-lcs-data.html#cb104-4" tabindex="-1"></a><span class="co"># PSID1</span></span>
<span id="cb104-5"><a href="lalonde-calónico-smith-lcs-data.html#cb104-5" tabindex="-1"></a><span class="fu">plot_qte</span>(qte.lcs_psid, qte.lcs_psid0, qte.lcs, <span class="at">main =</span> <span class="st">&quot;(B) LCS-PSID1&quot;</span>, ylim)</span>
<span id="cb104-6"><a href="lalonde-calónico-smith-lcs-data.html#cb104-6" tabindex="-1"></a><span class="fu">legend</span>(<span class="st">&quot;bottomleft&quot;</span>, <span class="at">legend =</span> <span class="fu">c</span>(<span class="st">&quot;Experimental&quot;</span>, <span class="st">&quot;Unadjusted&quot;</span>, <span class="st">&quot;Adjusted&quot;</span>), </span>
<span id="cb104-7"><a href="lalonde-calónico-smith-lcs-data.html#cb104-7" tabindex="-1"></a>       <span class="at">lty =</span> <span class="dv">1</span>, <span class="at">pch =</span> <span class="fu">c</span>(<span class="dv">16</span>, <span class="dv">17</span>, <span class="dv">16</span>), <span class="at">col =</span> <span class="fu">c</span>(<span class="dv">4</span>, <span class="dv">2</span>, <span class="dv">1</span>), <span class="at">bty =</span> <span class="st">&quot;n&quot;</span>)</span>
<span id="cb104-8"><a href="lalonde-calónico-smith-lcs-data.html#cb104-8" tabindex="-1"></a></span>
<span id="cb104-9"><a href="lalonde-calónico-smith-lcs-data.html#cb104-9" tabindex="-1"></a><span class="co"># PSID1 top methods</span></span>
<span id="cb104-10"><a href="lalonde-calónico-smith-lcs-data.html#cb104-10" tabindex="-1"></a><span class="fu">plot_qte_top</span>(qte.top5_psid, qte.top5_psid0, qte.lcs, all_plot_titles, <span class="at">main_start =</span> <span class="dv">3</span>)</span></code></pre></div>
<div class="figure"><span style="display:block;" id="fig:unnamed-chunk-89-1"></span>
<img src="Outcome-Weights_files/figure-html/unnamed-chunk-89-1.png" alt="FIGURED13. SubfigureB:LCS-PSID1.  SubfigureC-G:Top-LCS-PSID1. SubfigureH:LCS-PSID1-PLUS. QTET Estimates using LCS Data: Experimental vs. Nonexperimental" width="100%" />
<p class="caption">
Figure 1.12: FIGURED13. SubfigureB:LCS-PSID1. SubfigureC-G:Top-LCS-PSID1. SubfigureH:LCS-PSID1-PLUS. QTET Estimates using LCS Data: Experimental vs. Nonexperimental
</p>
</div>
<div class="sourceCode" id="cb105"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb105-1"><a href="lalonde-calónico-smith-lcs-data.html#cb105-1" tabindex="-1"></a><span class="co"># PSID1-PLUS trimmed</span></span>
<span id="cb105-2"><a href="lalonde-calónico-smith-lcs-data.html#cb105-2" tabindex="-1"></a><span class="fu">plot_qte</span>(qte.lcs_psid.trim, qte.lcs_psid.trim0, qte.lcs.psid, <span class="at">main =</span> <span class="st">&quot;(H) LCS-PSID1-PLUS (Trimmed)&quot;</span>, ylim)</span>
<span id="cb105-3"><a href="lalonde-calónico-smith-lcs-data.html#cb105-3" tabindex="-1"></a><span class="fu">legend</span>(<span class="st">&quot;bottomleft&quot;</span>, <span class="at">legend =</span> <span class="fu">c</span>(<span class="st">&quot;Experimental&quot;</span>, <span class="st">&quot;Unadjusted&quot;</span>, <span class="st">&quot;Adjusted&quot;</span>), </span>
<span id="cb105-4"><a href="lalonde-calónico-smith-lcs-data.html#cb105-4" tabindex="-1"></a>    <span class="at">lty =</span> <span class="dv">1</span>, <span class="at">pch =</span> <span class="fu">c</span>(<span class="dv">16</span>, <span class="dv">17</span>, <span class="dv">16</span>), <span class="at">col =</span> <span class="fu">c</span>(<span class="dv">4</span>, <span class="dv">2</span>, <span class="dv">1</span>), <span class="at">bty =</span> <span class="st">&quot;n&quot;</span>)</span></code></pre></div>
<div class="figure"><span style="display:block;" id="fig:unnamed-chunk-89-2"></span>
<img src="Outcome-Weights_files/figure-html/unnamed-chunk-89-2.png" alt="FIGURED13. SubfigureB:LCS-PSID1.  SubfigureC-G:Top-LCS-PSID1. SubfigureH:LCS-PSID1-PLUS. QTET Estimates using LCS Data: Experimental vs. Nonexperimental" width="100%" />
<p class="caption">
Figure 1.13: FIGURED13. SubfigureB:LCS-PSID1. SubfigureC-G:Top-LCS-PSID1. SubfigureH:LCS-PSID1-PLUS. QTET Estimates using LCS Data: Experimental vs. Nonexperimental
</p>
</div>
<p>These figures present QTET estimates obtained from LCS-Experimental sample and several observational samples. The QTETs estimated from both the original and trimmed LCS-PSID1 samples (B and C), as well as from the top-ranked subsamples (E through H), align comparatively close with the true QTET. However, the QTETs from subsample (F) exhibit a stronger bias, suggesting greater estimation uncertainty.</p>
<div class="sourceCode" id="cb106"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb106-1"><a href="lalonde-calónico-smith-lcs-data.html#cb106-1" tabindex="-1"></a><span class="co"># list results</span></span>
<span id="cb106-2"><a href="lalonde-calónico-smith-lcs-data.html#cb106-2" tabindex="-1"></a>plots_lcs <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb106-3"><a href="lalonde-calónico-smith-lcs-data.html#cb106-3" tabindex="-1"></a>  <span class="fu">list</span>(<span class="at">mod =</span> qte.lcs_psid, <span class="at">mod0 =</span> qte.lcs_psid0, <span class="at">bm =</span> qte.lcs, </span>
<span id="cb106-4"><a href="lalonde-calónico-smith-lcs-data.html#cb106-4" tabindex="-1"></a>       <span class="at">main =</span> <span class="st">&quot;(B) LCS-PSID1&quot;</span>),</span>
<span id="cb106-5"><a href="lalonde-calónico-smith-lcs-data.html#cb106-5" tabindex="-1"></a>  <span class="fu">list</span>(<span class="at">mod =</span> qte.lcs_psid.trim, <span class="at">mod0 =</span> qte.lcs_psid.trim0, <span class="at">bm =</span> qte.lcs.psid, </span>
<span id="cb106-6"><a href="lalonde-calónico-smith-lcs-data.html#cb106-6" tabindex="-1"></a>       <span class="at">main =</span> <span class="st">&quot;(H) LCS-PSID1-PLUS (Trimmed)&quot;</span>)</span>
<span id="cb106-7"><a href="lalonde-calónico-smith-lcs-data.html#cb106-7" tabindex="-1"></a>)</span>
<span id="cb106-8"><a href="lalonde-calónico-smith-lcs-data.html#cb106-8" tabindex="-1"></a></span>
<span id="cb106-9"><a href="lalonde-calónico-smith-lcs-data.html#cb106-9" tabindex="-1"></a><span class="co"># save results</span></span>
<span id="cb106-10"><a href="lalonde-calónico-smith-lcs-data.html#cb106-10" tabindex="-1"></a><span class="fu">save_qtet</span>(plots_lcs, <span class="at">prefix =</span> <span class="st">&quot;lcs&quot;</span>)</span>
<span id="cb106-11"><a href="lalonde-calónico-smith-lcs-data.html#cb106-11" tabindex="-1"></a><span class="fu">save_qte_top</span>(qte.top5_psid, qte.top5_psid0, qte.lcs, all_plot_titles, </span>
<span id="cb106-12"><a href="lalonde-calónico-smith-lcs-data.html#cb106-12" tabindex="-1"></a>             <span class="at">main_start =</span> <span class="dv">13</span>, <span class="at">prefix =</span> <span class="st">&quot;lcs_top&quot;</span>)</span></code></pre></div>
</div>
<div id="assessing-outcome-weights-ow" class="section level3 hasAnchor" number="1.9.4">
<h3><span class="header-section-number">1.9.4</span> Assessing outcome weights (OW)<a href="lalonde-calónico-smith-lcs-data.html#assessing-outcome-weights-ow" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb107"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb107-1"><a href="lalonde-calónico-smith-lcs-data.html#cb107-1" tabindex="-1"></a><span class="co"># list all datasets</span></span>
<span id="cb107-2"><a href="lalonde-calónico-smith-lcs-data.html#cb107-2" tabindex="-1"></a>all_datasets <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fu">list</span>(lcs, lcs_psid), </span>
<span id="cb107-3"><a href="lalonde-calónico-smith-lcs-data.html#cb107-3" tabindex="-1"></a>                  top5_datasets.psid, </span>
<span id="cb107-4"><a href="lalonde-calónico-smith-lcs-data.html#cb107-4" tabindex="-1"></a>                  <span class="fu">list</span>(lcs_trim_psid))</span></code></pre></div>
<div class="sourceCode" id="cb108"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb108-1"><a href="lalonde-calónico-smith-lcs-data.html#cb108-1" tabindex="-1"></a><span class="co"># estimate ATT </span></span>
<span id="cb108-2"><a href="lalonde-calónico-smith-lcs-data.html#cb108-2" tabindex="-1"></a>res_att <span class="ot">&lt;-</span> <span class="fu">get_res_att</span>(all_datasets, Y, treat, covar)</span>
<span id="cb108-3"><a href="lalonde-calónico-smith-lcs-data.html#cb108-3" tabindex="-1"></a><span class="co"># extract outcome weights</span></span>
<span id="cb108-4"><a href="lalonde-calónico-smith-lcs-data.html#cb108-4" tabindex="-1"></a>ow_att <span class="ot">&lt;-</span> <span class="fu">derive_ow</span>(res_att)</span></code></pre></div>
<div class="sourceCode" id="cb109"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb109-1"><a href="lalonde-calónico-smith-lcs-data.html#cb109-1" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">2</span>))</span>
<span id="cb109-2"><a href="lalonde-calónico-smith-lcs-data.html#cb109-2" tabindex="-1"></a><span class="fu">par</span>(<span class="at">cex.main =</span> <span class="fl">0.9</span>)</span>
<span id="cb109-3"><a href="lalonde-calónico-smith-lcs-data.html#cb109-3" tabindex="-1"></a><span class="co"># plot outcome weights distribution</span></span>
<span id="cb109-4"><a href="lalonde-calónico-smith-lcs-data.html#cb109-4" tabindex="-1"></a><span class="fu">plot_ow</span>(ow_att, all_plot_titles) </span></code></pre></div>
<div class="figure"><span style="display:block;" id="fig:unnamed-chunk-93-1"></span>
<img src="Outcome-Weights_files/figure-html/unnamed-chunk-93-1.png" alt="FIGURED14. Outcome Weights using LCS Data" width="100%" />
<p class="caption">
Figure 1.14: FIGURED14. Outcome Weights using LCS Data
</p>
</div>
<div class="figure"><span style="display:block;" id="fig:unnamed-chunk-93-2"></span>
<img src="Outcome-Weights_files/figure-html/unnamed-chunk-93-2.png" alt="FIGURED14. Outcome Weights using LCS Data" width="100%" />
<p class="caption">
Figure 1.15: FIGURED14. Outcome Weights using LCS Data
</p>
</div>
<div class="sourceCode" id="cb110"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb110-1"><a href="lalonde-calónico-smith-lcs-data.html#cb110-1" tabindex="-1"></a><span class="co"># evaluate results</span></span>
<span id="cb110-2"><a href="lalonde-calónico-smith-lcs-data.html#cb110-2" tabindex="-1"></a>res_ow <span class="ot">&lt;-</span> <span class="fu">eval_ow</span>(ow_att, all_datasets, all_plot_titles, treat, <span class="st">&quot;AIPW-ATT&quot;</span>)</span>
<span id="cb110-3"><a href="lalonde-calónico-smith-lcs-data.html#cb110-3" tabindex="-1"></a><span class="fu">datatable</span>(res_ow, <span class="at">caption =</span> <span class="st">&quot;Outcome Weights for Treated and Untreated&quot;</span>,</span>
<span id="cb110-4"><a href="lalonde-calónico-smith-lcs-data.html#cb110-4" tabindex="-1"></a>          <span class="at">options =</span> <span class="fu">list</span>(<span class="at">scrollX =</span> <span class="cn">TRUE</span>, <span class="at">paging =</span> <span class="cn">FALSE</span>, <span class="at">pageLength =</span> <span class="sc">-</span><span class="dv">1</span>, <span class="at">searching =</span> <span class="cn">FALSE</span>))</span></code></pre></div>
<div class="datatables html-widget html-fill-item" id="htmlwidget-f4997105858173027594" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-f4997105858173027594">{"x":{"filter":"none","vertical":false,"caption":"<caption>Outcome Weights for Treated and Untreated<\/caption>","data":[["1","2","3","4","5","6","7","8"],["(A) LCS-Experimental","(B) LCS-PSID1","(C) Top PSID1: opt_weight","(D) Top PSID1: ebal_weight","(E) Top PSID1: cbps_weight","(F) Top PSID1: at_perc_opt_weight","(G) Top PSID1: at_perc_ipw_weight","(H) Trimmed LCS-PSID1-PLUS"],[0.9999999999999999,1,1,1,1,1,1,1],[-1,-1,-1,-0.9999999999999999,-1,-1,-1,-1]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>Method<\/th>\n      <th>Sum_Treated<\/th>\n      <th>Sum_Untreated<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"scrollX":true,"paging":false,"pageLength":-1,"searching":false,"columnDefs":[{"className":"dt-right","targets":[2,3]},{"orderable":false,"targets":0},{"name":" ","targets":0},{"name":"Method","targets":1},{"name":"Sum_Treated","targets":2},{"name":"Sum_Untreated","targets":3}],"order":[],"autoWidth":false,"orderClasses":false,"lengthMenu":[-1,10,25,50,100]}},"evals":[],"jsHooks":[]}</script>
<p>Consistent with the preceding sections, the evaluation shows that, across each sample, the estimated outcome weights sum to one within the treated group and to minus one within the untreated group, yielding an overall total of zero.</p>
<div class="sourceCode" id="cb111"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb111-1"><a href="lalonde-calónico-smith-lcs-data.html#cb111-1" tabindex="-1"></a><span class="co"># save results</span></span>
<span id="cb111-2"><a href="lalonde-calónico-smith-lcs-data.html#cb111-2" tabindex="-1"></a><span class="fu">save_ow</span>(ow_att, all_plot_titles, <span class="at">prefix =</span> <span class="st">&quot;lcs&quot;</span>)</span></code></pre></div>
</div>
</div>
<div id="validation-through-placebo-analyses" class="section level2 hasAnchor" number="1.10">
<h2><span class="header-section-number">1.10</span> Validation through placebo analyses<a href="lalonde-calónico-smith-lcs-data.html#validation-through-placebo-analyses" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div class="sourceCode" id="cb112"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb112-1"><a href="lalonde-calónico-smith-lcs-data.html#cb112-1" tabindex="-1"></a><span class="co"># define variables</span></span>
<span id="cb112-2"><a href="lalonde-calónico-smith-lcs-data.html#cb112-2" tabindex="-1"></a>Y <span class="ot">&lt;-</span> <span class="st">&quot;nchildren75&quot;</span></span>
<span id="cb112-3"><a href="lalonde-calónico-smith-lcs-data.html#cb112-3" tabindex="-1"></a>treat <span class="ot">&lt;-</span> <span class="st">&quot;treat&quot;</span></span>
<span id="cb112-4"><a href="lalonde-calónico-smith-lcs-data.html#cb112-4" tabindex="-1"></a>covar <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;age&quot;</span>, <span class="st">&quot;educ&quot;</span>, <span class="st">&quot;nodegree&quot;</span>, <span class="st">&quot;married&quot;</span>, <span class="st">&quot;black&quot;</span>, <span class="st">&quot;hisp&quot;</span>, <span class="st">&quot;re75&quot;</span>, <span class="st">&quot;u75&quot;</span>)</span></code></pre></div>
<div class="sourceCode" id="cb113"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb113-1"><a href="lalonde-calónico-smith-lcs-data.html#cb113-1" tabindex="-1"></a><span class="co"># estimate placebo ATT on original and observational dataset</span></span>
<span id="cb113-2"><a href="lalonde-calónico-smith-lcs-data.html#cb113-2" tabindex="-1"></a>out1_pl <span class="ot">&lt;-</span> <span class="fu">estimate_all</span>(lcs, Y, <span class="st">&quot;treat&quot;</span>, covar)</span>
<span id="cb113-3"><a href="lalonde-calónico-smith-lcs-data.html#cb113-3" tabindex="-1"></a>out2_pl <span class="ot">&lt;-</span> <span class="fu">estimate_all</span>(lcs_psid, Y, <span class="st">&quot;treat&quot;</span>, covar)</span></code></pre></div>
<div class="sourceCode" id="cb114"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb114-1"><a href="lalonde-calónico-smith-lcs-data.html#cb114-1" tabindex="-1"></a><span class="co"># estimate placebo ATT on top ranked datasets</span></span>
<span id="cb114-2"><a href="lalonde-calónico-smith-lcs-data.html#cb114-2" tabindex="-1"></a>out.psid_pl <span class="ot">&lt;-</span> <span class="fu">lapply</span>(top5_datasets.psid, <span class="cf">function</span>(d) <span class="fu">estimate_all</span>(d, Y, <span class="st">&quot;treat&quot;</span>, covar))</span>
<span id="cb114-3"><a href="lalonde-calónico-smith-lcs-data.html#cb114-3" tabindex="-1"></a>out3_pl <span class="ot">&lt;-</span> out.psid_pl[[<span class="dv">1</span>]]</span>
<span id="cb114-4"><a href="lalonde-calónico-smith-lcs-data.html#cb114-4" tabindex="-1"></a>out4_pl <span class="ot">&lt;-</span> out.psid_pl[[<span class="dv">2</span>]]</span>
<span id="cb114-5"><a href="lalonde-calónico-smith-lcs-data.html#cb114-5" tabindex="-1"></a>out5_pl <span class="ot">&lt;-</span> out.psid_pl[[<span class="dv">3</span>]]</span>
<span id="cb114-6"><a href="lalonde-calónico-smith-lcs-data.html#cb114-6" tabindex="-1"></a>out6_pl <span class="ot">&lt;-</span> out.psid_pl[[<span class="dv">4</span>]]</span>
<span id="cb114-7"><a href="lalonde-calónico-smith-lcs-data.html#cb114-7" tabindex="-1"></a>out7_pl <span class="ot">&lt;-</span> out.psid_pl[[<span class="dv">5</span>]]</span></code></pre></div>
<div class="sourceCode" id="cb115"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb115-1"><a href="lalonde-calónico-smith-lcs-data.html#cb115-1" tabindex="-1"></a><span class="co"># estimate placebo ATT on plus datasets</span></span>
<span id="cb115-2"><a href="lalonde-calónico-smith-lcs-data.html#cb115-2" tabindex="-1"></a><span class="fu">load</span>(<span class="st">&quot;data/trimmed.RData&quot;</span>)</span>
<span id="cb115-3"><a href="lalonde-calónico-smith-lcs-data.html#cb115-3" tabindex="-1"></a>out8_pl <span class="ot">&lt;-</span> <span class="fu">estimate_all</span>(lcs_trim_psid, Y, <span class="st">&quot;treat&quot;</span>, covar)</span>
<span id="cb115-4"><a href="lalonde-calónico-smith-lcs-data.html#cb115-4" tabindex="-1"></a>out9_pl <span class="ot">&lt;-</span> <span class="fu">estimate_all</span>(lcs_psid_trim, Y, <span class="st">&quot;treat&quot;</span>, covar)</span></code></pre></div>
<div class="sourceCode" id="cb116"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb116-1"><a href="lalonde-calónico-smith-lcs-data.html#cb116-1" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">4</span>, <span class="dv">1</span>), <span class="at">mar =</span> <span class="fu">c</span>(<span class="dv">4</span>, <span class="dv">4</span>, <span class="dv">2</span>, <span class="dv">1</span>))</span>
<span id="cb116-2"><a href="lalonde-calónico-smith-lcs-data.html#cb116-2" tabindex="-1"></a></span>
<span id="cb116-3"><a href="lalonde-calónico-smith-lcs-data.html#cb116-3" tabindex="-1"></a><span class="co"># experimental benchmarks</span></span>
<span id="cb116-4"><a href="lalonde-calónico-smith-lcs-data.html#cb116-4" tabindex="-1"></a>band.exp_pl <span class="ot">&lt;-</span> out1_pl[<span class="dv">1</span>, <span class="dv">3</span><span class="sc">:</span><span class="dv">4</span>]</span>
<span id="cb116-5"><a href="lalonde-calónico-smith-lcs-data.html#cb116-5" tabindex="-1"></a>est.exp_pl <span class="ot">&lt;-</span> out1_pl[<span class="dv">1</span>, <span class="dv">1</span>]</span>
<span id="cb116-6"><a href="lalonde-calónico-smith-lcs-data.html#cb116-6" tabindex="-1"></a></span>
<span id="cb116-7"><a href="lalonde-calónico-smith-lcs-data.html#cb116-7" tabindex="-1"></a><span class="co"># plot placebo results</span></span>
<span id="cb116-8"><a href="lalonde-calónico-smith-lcs-data.html#cb116-8" tabindex="-1"></a><span class="fu">plot_coef</span>(out1_pl,  <span class="at">band =</span> band.exp_pl, <span class="at">line =</span> est.exp_pl, </span>
<span id="cb116-9"><a href="lalonde-calónico-smith-lcs-data.html#cb116-9" tabindex="-1"></a>          <span class="at">ylim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="fl">1.5</span>, <span class="dv">1</span>), <span class="at">main =</span> <span class="st">&quot;(A) LCS-Experimental&quot;</span>)</span>
<span id="cb116-10"><a href="lalonde-calónico-smith-lcs-data.html#cb116-10" tabindex="-1"></a></span>
<span id="cb116-11"><a href="lalonde-calónico-smith-lcs-data.html#cb116-11" tabindex="-1"></a><span class="fu">plot_coef</span>(out2_pl,  <span class="at">band =</span> band.exp_pl, <span class="at">line =</span> est.exp_pl,</span>
<span id="cb116-12"><a href="lalonde-calónico-smith-lcs-data.html#cb116-12" tabindex="-1"></a>          <span class="at">ylim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="fl">1.5</span>, <span class="dv">1</span>), <span class="at">main =</span> <span class="st">&quot;(B) LCS-PSID1&quot;</span>)</span>
<span id="cb116-13"><a href="lalonde-calónico-smith-lcs-data.html#cb116-13" tabindex="-1"></a></span>
<span id="cb116-14"><a href="lalonde-calónico-smith-lcs-data.html#cb116-14" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="fu">seq_along</span>(out.psid_pl)) {</span>
<span id="cb116-15"><a href="lalonde-calónico-smith-lcs-data.html#cb116-15" tabindex="-1"></a>  this_title <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">&quot;(&quot;</span>, LETTERS[i<span class="sc">+</span><span class="dv">2</span>], <span class="st">&quot;) Top PSID1: &quot;</span>, top5_methods.psid[i])</span>
<span id="cb116-16"><a href="lalonde-calónico-smith-lcs-data.html#cb116-16" tabindex="-1"></a>  <span class="fu">plot_coef</span>(out.psid_pl[[i]], <span class="at">band =</span> band.exp_pl, <span class="at">line =</span> est.exp_pl,</span>
<span id="cb116-17"><a href="lalonde-calónico-smith-lcs-data.html#cb116-17" tabindex="-1"></a>            <span class="at">ylim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="fl">1.5</span>, <span class="dv">1</span>), <span class="at">main =</span> this_title)</span>
<span id="cb116-18"><a href="lalonde-calónico-smith-lcs-data.html#cb116-18" tabindex="-1"></a>}</span></code></pre></div>
<div class="figure"><span style="display:block;" id="fig:unnamed-chunk-100-1"></span>
<img src="Outcome-Weights_files/figure-html/unnamed-chunk-100-1.png" alt="FIGURED15. SubfigureA:LCS-Experimental. SubfigureB:LCS-PSID1. SubfigureC-G:Top-LCS-PSID1. Placebo Test: Number of Children in 1975 as the Outcome" width="100%" />
<p class="caption">
Figure 1.16: FIGURED15. SubfigureA:LCS-Experimental. SubfigureB:LCS-PSID1. SubfigureC-G:Top-LCS-PSID1. Placebo Test: Number of Children in 1975 as the Outcome
</p>
</div>
<div class="figure"><span style="display:block;" id="fig:unnamed-chunk-100-2"></span>
<img src="Outcome-Weights_files/figure-html/unnamed-chunk-100-2.png" alt="FIGURED15. SubfigureA:LCS-Experimental. SubfigureB:LCS-PSID1. SubfigureC-G:Top-LCS-PSID1. Placebo Test: Number of Children in 1975 as the Outcome" width="100%" />
<p class="caption">
Figure 1.17: FIGURED15. SubfigureA:LCS-Experimental. SubfigureB:LCS-PSID1. SubfigureC-G:Top-LCS-PSID1. Placebo Test: Number of Children in 1975 as the Outcome
</p>
</div>
<div class="sourceCode" id="cb117"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb117-1"><a href="lalonde-calónico-smith-lcs-data.html#cb117-1" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">4</span>, <span class="dv">1</span>))</span>
<span id="cb117-2"><a href="lalonde-calónico-smith-lcs-data.html#cb117-2" tabindex="-1"></a></span>
<span id="cb117-3"><a href="lalonde-calónico-smith-lcs-data.html#cb117-3" tabindex="-1"></a><span class="co"># nonexperimtenal benchmarks</span></span>
<span id="cb117-4"><a href="lalonde-calónico-smith-lcs-data.html#cb117-4" tabindex="-1"></a>band.psid_plus_pl <span class="ot">&lt;-</span> out8_pl[<span class="dv">1</span>, <span class="dv">3</span><span class="sc">:</span><span class="dv">4</span>]</span>
<span id="cb117-5"><a href="lalonde-calónico-smith-lcs-data.html#cb117-5" tabindex="-1"></a>est.psid_plus_pl <span class="ot">&lt;-</span> out8_pl[<span class="dv">1</span>, <span class="dv">1</span>]</span>
<span id="cb117-6"><a href="lalonde-calónico-smith-lcs-data.html#cb117-6" tabindex="-1"></a></span>
<span id="cb117-7"><a href="lalonde-calónico-smith-lcs-data.html#cb117-7" tabindex="-1"></a><span class="co"># plot results</span></span>
<span id="cb117-8"><a href="lalonde-calónico-smith-lcs-data.html#cb117-8" tabindex="-1"></a><span class="fu">plot_coef</span>(out9_pl, <span class="at">band =</span> band.psid_plus_pl, <span class="at">line =</span> est.psid_plus_pl, </span>
<span id="cb117-9"><a href="lalonde-calónico-smith-lcs-data.html#cb117-9" tabindex="-1"></a>          <span class="at">ylim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="fl">1.5</span>, <span class="dv">1</span>), <span class="at">main =</span> <span class="st">&quot;(H) LCS-PSID1-PLUS (Trimmed)&quot;</span>)</span></code></pre></div>
<div class="figure"><span style="display:block;" id="fig:unnamed-chunk-101"></span>
<img src="Outcome-Weights_files/figure-html/unnamed-chunk-101-1.png" alt="FIGUREA15. SubfigureH:LCS-PSID1-PLUS. Placebo Test: Number of Children in 1975 as the Outcome" width="100%" />
<p class="caption">
Figure 1.18: FIGUREA15. SubfigureH:LCS-PSID1-PLUS. Placebo Test: Number of Children in 1975 as the Outcome
</p>
</div>
<div class="sourceCode" id="cb118"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb118-1"><a href="lalonde-calónico-smith-lcs-data.html#cb118-1" tabindex="-1"></a><span class="co"># save results</span></span>
<span id="cb118-2"><a href="lalonde-calónico-smith-lcs-data.html#cb118-2" tabindex="-1"></a><span class="fu">save_att_panels</span>(</span>
<span id="cb118-3"><a href="lalonde-calónico-smith-lcs-data.html#cb118-3" tabindex="-1"></a>  <span class="at">out_list =</span> <span class="fu">list</span>(out1_pl, out2_pl),</span>
<span id="cb118-4"><a href="lalonde-calónico-smith-lcs-data.html#cb118-4" tabindex="-1"></a>  <span class="at">plot_titles =</span> <span class="fu">c</span>(<span class="st">&quot;(A) LCS-Experimental&quot;</span>, <span class="st">&quot;(B) LCS-CPS1&quot;</span>),</span>
<span id="cb118-5"><a href="lalonde-calónico-smith-lcs-data.html#cb118-5" tabindex="-1"></a>  <span class="at">band_list =</span> <span class="fu">list</span>(band.exp_pl, band.exp_pl),</span>
<span id="cb118-6"><a href="lalonde-calónico-smith-lcs-data.html#cb118-6" tabindex="-1"></a>  <span class="at">est_list  =</span> <span class="fu">list</span>(est.exp_pl, est.exp_pl),</span>
<span id="cb118-7"><a href="lalonde-calónico-smith-lcs-data.html#cb118-7" tabindex="-1"></a>  <span class="at">prefix =</span> <span class="st">&quot;lcs_pl_est_exp&quot;</span></span>
<span id="cb118-8"><a href="lalonde-calónico-smith-lcs-data.html#cb118-8" tabindex="-1"></a>)</span>
<span id="cb118-9"><a href="lalonde-calónico-smith-lcs-data.html#cb118-9" tabindex="-1"></a></span>
<span id="cb118-10"><a href="lalonde-calónico-smith-lcs-data.html#cb118-10" tabindex="-1"></a><span class="fu">save_att_panels</span>(</span>
<span id="cb118-11"><a href="lalonde-calónico-smith-lcs-data.html#cb118-11" tabindex="-1"></a>  <span class="at">out_list =</span> out.psid_pl,</span>
<span id="cb118-12"><a href="lalonde-calónico-smith-lcs-data.html#cb118-12" tabindex="-1"></a>  <span class="at">plot_titles =</span> <span class="fu">paste0</span>(<span class="st">&quot;(&quot;</span>, LETTERS[<span class="dv">3</span><span class="sc">:</span><span class="dv">7</span>], <span class="st">&quot;) Top PSID1: &quot;</span>, top5_methods.psid),</span>
<span id="cb118-13"><a href="lalonde-calónico-smith-lcs-data.html#cb118-13" tabindex="-1"></a>  <span class="at">band_list =</span> <span class="fu">replicate</span>(<span class="fu">length</span>(out.psid_pl), band.exp_pl, <span class="at">simplify =</span> <span class="cn">FALSE</span>),</span>
<span id="cb118-14"><a href="lalonde-calónico-smith-lcs-data.html#cb118-14" tabindex="-1"></a>  <span class="at">est_list  =</span> <span class="fu">replicate</span>(<span class="fu">length</span>(out.psid_pl), est.exp_pl, <span class="at">simplify =</span> <span class="cn">FALSE</span>),</span>
<span id="cb118-15"><a href="lalonde-calónico-smith-lcs-data.html#cb118-15" tabindex="-1"></a>  <span class="at">prefix =</span> <span class="st">&quot;lcs_pl_est_top_psid&quot;</span></span>
<span id="cb118-16"><a href="lalonde-calónico-smith-lcs-data.html#cb118-16" tabindex="-1"></a>)</span>
<span id="cb118-17"><a href="lalonde-calónico-smith-lcs-data.html#cb118-17" tabindex="-1"></a></span>
<span id="cb118-18"><a href="lalonde-calónico-smith-lcs-data.html#cb118-18" tabindex="-1"></a><span class="fu">save_att_panels</span>(</span>
<span id="cb118-19"><a href="lalonde-calónico-smith-lcs-data.html#cb118-19" tabindex="-1"></a>  <span class="at">out_list =</span> <span class="fu">list</span>(out9_pl),</span>
<span id="cb118-20"><a href="lalonde-calónico-smith-lcs-data.html#cb118-20" tabindex="-1"></a>  <span class="at">plot_titles =</span> <span class="fu">c</span>(<span class="st">&quot;(H) LCS-PSID1-PLUS (Trimmed)&quot;</span>),</span>
<span id="cb118-21"><a href="lalonde-calónico-smith-lcs-data.html#cb118-21" tabindex="-1"></a>  <span class="at">band_list =</span> <span class="fu">list</span>(band.psid_plus_pl),</span>
<span id="cb118-22"><a href="lalonde-calónico-smith-lcs-data.html#cb118-22" tabindex="-1"></a>  <span class="at">est_list  =</span> <span class="fu">list</span>(est.psid_plus_pl),</span>
<span id="cb118-23"><a href="lalonde-calónico-smith-lcs-data.html#cb118-23" tabindex="-1"></a>  <span class="at">prefix =</span> <span class="st">&quot;lcs_pl_est_plus&quot;</span>,</span>
<span id="cb118-24"><a href="lalonde-calónico-smith-lcs-data.html#cb118-24" tabindex="-1"></a>  <span class="at">ylim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">12000</span>, <span class="dv">2000</span>)</span>
<span id="cb118-25"><a href="lalonde-calónico-smith-lcs-data.html#cb118-25" tabindex="-1"></a>)</span></code></pre></div>
<div class="sourceCode" id="cb119"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb119-1"><a href="lalonde-calónico-smith-lcs-data.html#cb119-1" tabindex="-1"></a><span class="co"># print placebo results</span></span>
<span id="cb119-2"><a href="lalonde-calónico-smith-lcs-data.html#cb119-2" tabindex="-1"></a>all_outs.pl <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fu">list</span>(out1_pl, out2_pl), </span>
<span id="cb119-3"><a href="lalonde-calónico-smith-lcs-data.html#cb119-3" tabindex="-1"></a>                 out.psid_pl, </span>
<span id="cb119-4"><a href="lalonde-calónico-smith-lcs-data.html#cb119-4" tabindex="-1"></a>                 <span class="fu">list</span>(out9_pl))</span>
<span id="cb119-5"><a href="lalonde-calónico-smith-lcs-data.html#cb119-5" tabindex="-1"></a></span>
<span id="cb119-6"><a href="lalonde-calónico-smith-lcs-data.html#cb119-6" tabindex="-1"></a>result_mat_pl <span class="ot">&lt;-</span> <span class="fu">create_matrix_results</span>(all_outs.pl, all_plot_titles)</span>
<span id="cb119-7"><a href="lalonde-calónico-smith-lcs-data.html#cb119-7" tabindex="-1"></a></span>
<span id="cb119-8"><a href="lalonde-calónico-smith-lcs-data.html#cb119-8" tabindex="-1"></a><span class="fu">datatable</span>(result_mat_pl, <span class="at">caption =</span> <span class="st">&quot;Placebo ATT Estimates and SEs&quot;</span>,</span>
<span id="cb119-9"><a href="lalonde-calónico-smith-lcs-data.html#cb119-9" tabindex="-1"></a>          <span class="at">options =</span> <span class="fu">list</span>(<span class="at">scrollX =</span> <span class="cn">TRUE</span>, <span class="at">paging =</span> <span class="cn">FALSE</span>, <span class="at">pageLength =</span> <span class="sc">-</span><span class="dv">1</span>, <span class="at">searching =</span> <span class="cn">FALSE</span>))</span></code></pre></div>
<div class="datatables html-widget html-fill-item" id="htmlwidget-01f665b989270420b066" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-01f665b989270420b066">{"x":{"filter":"none","vertical":false,"caption":"<caption>Placebo ATT Estimates and SEs<\/caption>","data":[["Experimental Benchmark","diff","reg","om.reg","om.grf","matching","psm","ipw","cbps","ebal","dml","aipw_grf","aipw_ow"],["-0.05","-0.05","-0.05","-0.05","-0.04","-0.06","-0.07","-0.05","-0.05","-0.05","-0.04","-0.05","-0.06"],["(0.08)","(0.08)","(0.08)","(0.05)","(0.06)","(0.07)","(0.08)","(0.08)","(0.08)","(0.08)","(0.07)","(0.07)","(0.08)"],["-0.05","0.47","-0.18","-0.22","-0.52","-0.71","-0.74","-0.69","-0.27","-0.27","-0.18","-0.78","-0.67"],["(0.08)","(0.09)","(0.11)","(0.06)","(0.06)","(0.14)","(0.09)","(0.15)","(0.14)","(0.14)","(0.11)","(0.15)","(0.15)"],["-0.05","0.47","-0.18","-0.22","-0.53","-0.71","-0.74","-0.28","-0.28","-0.27","-0.18","-0.78","-0.67"],["(0.08)","(0.09)","(0.11)","(0.06)","(0.06)","(0.14)","(0.09)","(0.14)","(0.14)","(0.14)","(0.11)","(0.15)","(0.15)"],["0.47","0.47","-0.18","-0.22","-0.53","-0.71","-0.74","-0.27","-0.27","-0.27","-0.18","-0.78","-0.67"],["(0.09)","(0.09)","(0.11)","(0.06)","(0.06)","(0.14)","(0.09)","(0.14)","(0.14)","(0.14)","(0.11)","(0.15)","(0.15)"],["0.47","0.47","-0.18","-0.22","-0.53","-0.71","-0.74","-0.27","-0.27","-0.27","-0.18","-0.78","-0.67"],["(0.09)","(0.09)","(0.11)","(0.06)","(0.06)","(0.14)","(0.09)","(0.14)","(0.14)","(0.14)","(0.11)","(0.15)","(0.15)"],["0.47","0.47","-0.18","-0.22","-0.53","-0.71","-0.74","-0.33","-0.33","-0.27","-0.18","-0.78","-0.67"],["(0.09)","(0.09)","(0.11)","(0.06)","(0.06)","(0.14)","(0.09)","(0.14)","(0.14)","(0.14)","(0.11)","(0.15)","(0.15)"],["0.47","0.47","-0.18","-0.22","-0.53","-0.71","-0.74","-0.35","-0.35","-0.27","-0.18","-0.78","-0.67"],["(0.09)","(0.09)","(0.11)","(0.06)","(0.06)","(0.14)","(0.09)","(0.13)","(0.13)","(0.14)","(0.11)","(0.15)","(0.15)"],["0.47","0.14","-0.05","-0.15","-0.35","-0.49","-0.48","-0.41","-0.12","-0.12","-0.03","-0.49","-0.50"],["(0.09)","(0.11)","(0.12)","(0.07)","(0.07)","(0.14)","(0.11)","(0.14)","(0.13)","(0.13)","(0.12)","(0.14)","(0.14)"]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>(A) LCS-Experimental<\/th>\n      <th>V2<\/th>\n      <th>(B) LCS-PSID1<\/th>\n      <th>V4<\/th>\n      <th>(C) Top PSID1: opt_weight<\/th>\n      <th>V6<\/th>\n      <th>(D) Top PSID1: ebal_weight<\/th>\n      <th>V8<\/th>\n      <th>(E) Top PSID1: cbps_weight<\/th>\n      <th>V10<\/th>\n      <th>(F) Top PSID1: at_perc_opt_weight<\/th>\n      <th>V12<\/th>\n      <th>(G) Top PSID1: at_perc_ipw_weight<\/th>\n      <th>V14<\/th>\n      <th>(H) Trimmed LCS-PSID1-PLUS<\/th>\n      <th>V16<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"scrollX":true,"paging":false,"pageLength":-1,"searching":false,"columnDefs":[{"orderable":false,"targets":0},{"name":" ","targets":0},{"name":"(A) LCS-Experimental","targets":1},{"name":"V2","targets":2},{"name":"(B) LCS-PSID1","targets":3},{"name":"V4","targets":4},{"name":"(C) Top PSID1: opt_weight","targets":5},{"name":"V6","targets":6},{"name":"(D) Top PSID1: ebal_weight","targets":7},{"name":"V8","targets":8},{"name":"(E) Top PSID1: cbps_weight","targets":9},{"name":"V10","targets":10},{"name":"(F) Top PSID1: at_perc_opt_weight","targets":11},{"name":"V12","targets":12},{"name":"(G) Top PSID1: at_perc_ipw_weight","targets":13},{"name":"V14","targets":14},{"name":"(H) Trimmed LCS-PSID1-PLUS","targets":15},{"name":"V16","targets":16}],"order":[],"autoWidth":false,"orderClasses":false,"lengthMenu":[-1,10,25,50,100]}},"evals":[],"jsHooks":[]}</script>
<p>The placebo analysis shows that the experimental benchmark is close to zero and statistically insignificant, while all estimators applied to the observational datasets produce comparable results.</p>
<div class="sourceCode" id="cb120"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb120-1"><a href="lalonde-calónico-smith-lcs-data.html#cb120-1" tabindex="-1"></a><span class="co"># save results </span></span>
<span id="cb120-2"><a href="lalonde-calónico-smith-lcs-data.html#cb120-2" tabindex="-1"></a><span class="fu">save_csv</span>(result_mat_pl, <span class="st">&quot;lcs_att_estimates_pl&quot;</span>)</span></code></pre></div>
</div>
<div id="validation-through-sensitivity-analyses" class="section level2 hasAnchor" number="1.11">
<h2><span class="header-section-number">1.11</span> Validation through sensitivity analyses<a href="lalonde-calónico-smith-lcs-data.html#validation-through-sensitivity-analyses" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div class="sourceCode" id="cb121"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb121-1"><a href="lalonde-calónico-smith-lcs-data.html#cb121-1" tabindex="-1"></a><span class="co"># define variables</span></span>
<span id="cb121-2"><a href="lalonde-calónico-smith-lcs-data.html#cb121-2" tabindex="-1"></a>Y <span class="ot">&lt;-</span> <span class="st">&quot;re79&quot;</span></span>
<span id="cb121-3"><a href="lalonde-calónico-smith-lcs-data.html#cb121-3" tabindex="-1"></a>treat <span class="ot">&lt;-</span> <span class="st">&quot;treat&quot;</span></span>
<span id="cb121-4"><a href="lalonde-calónico-smith-lcs-data.html#cb121-4" tabindex="-1"></a><span class="co"># redefine covariates</span></span>
<span id="cb121-5"><a href="lalonde-calónico-smith-lcs-data.html#cb121-5" tabindex="-1"></a>covar <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;age&quot;</span>, <span class="st">&quot;educ&quot;</span>, <span class="st">&quot;nodegree&quot;</span>, <span class="st">&quot;married&quot;</span>, <span class="st">&quot;black&quot;</span>, <span class="st">&quot;hisp&quot;</span>, <span class="st">&quot;re75&quot;</span>, <span class="st">&quot;u75&quot;</span>)</span>
<span id="cb121-6"><a href="lalonde-calónico-smith-lcs-data.html#cb121-6" tabindex="-1"></a>bm <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;re75&quot;</span>)</span></code></pre></div>
<div class="sourceCode" id="cb122"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb122-1"><a href="lalonde-calónico-smith-lcs-data.html#cb122-1" tabindex="-1"></a><span class="co"># check for valid datasets </span></span>
<span id="cb122-2"><a href="lalonde-calónico-smith-lcs-data.html#cb122-2" tabindex="-1"></a>filtered_datasets_sens <span class="ot">&lt;-</span> <span class="fu">check_filter_datasets</span>(all_datasets, Y, treat, covar, bm)</span></code></pre></div>
<div class="sourceCode" id="cb123"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb123-1"><a href="lalonde-calónico-smith-lcs-data.html#cb123-1" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">2</span>))</span>
<span id="cb123-2"><a href="lalonde-calónico-smith-lcs-data.html#cb123-2" tabindex="-1"></a><span class="fu">par</span>(<span class="at">cex.main =</span> <span class="fl">0.8</span>)</span>
<span id="cb123-3"><a href="lalonde-calónico-smith-lcs-data.html#cb123-3" tabindex="-1"></a><span class="co"># loop over valid datasets and assign index</span></span>
<span id="cb123-4"><a href="lalonde-calónico-smith-lcs-data.html#cb123-4" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="fu">seq_along</span>(filtered_datasets_sens)) {</span>
<span id="cb123-5"><a href="lalonde-calónico-smith-lcs-data.html#cb123-5" tabindex="-1"></a>    idx <span class="ot">&lt;-</span> <span class="fu">which</span>(<span class="fu">sapply</span>(all_datasets, identical, filtered_datasets_sens[[i]]))</span>
<span id="cb123-6"><a href="lalonde-calónico-smith-lcs-data.html#cb123-6" tabindex="-1"></a>    <span class="fu">sens_ana</span>(filtered_datasets_sens[[i]], Y, treat, covar, bm, <span class="at">kd =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>)</span>
<span id="cb123-7"><a href="lalonde-calónico-smith-lcs-data.html#cb123-7" tabindex="-1"></a>    <span class="fu">title</span>(<span class="at">main =</span> all_plot_titles[idx]) </span>
<span id="cb123-8"><a href="lalonde-calónico-smith-lcs-data.html#cb123-8" tabindex="-1"></a>}</span></code></pre></div>
<div class="figure"><span style="display:block;" id="fig:unnamed-chunk-107-1"></span>
<img src="Outcome-Weights_files/figure-html/unnamed-chunk-107-1.png" alt="FIGURED16. Sensitivity Analyses LCS" width="100%" />
<p class="caption">
Figure 1.19: FIGURED16. Sensitivity Analyses LCS
</p>
</div>
<div class="figure"><span style="display:block;" id="fig:unnamed-chunk-107-2"></span>
<img src="Outcome-Weights_files/figure-html/unnamed-chunk-107-2.png" alt="FIGURED16. Sensitivity Analyses LCS" width="100%" />
<p class="caption">
Figure 1.20: FIGURED16. Sensitivity Analyses LCS
</p>
</div>
<div class="sourceCode" id="cb124"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb124-1"><a href="lalonde-calónico-smith-lcs-data.html#cb124-1" tabindex="-1"></a><span class="co"># save results</span></span>
<span id="cb124-2"><a href="lalonde-calónico-smith-lcs-data.html#cb124-2" tabindex="-1"></a><span class="fu">save_sensitivity_plots</span>(filtered_datasets_sens, Y, treat, covar, bm, all_plot_titles, <span class="st">&quot;lcs&quot;</span>)</span></code></pre></div>
<p>The sensitivity analysis shows that treatment effect estimates in LCS-Experimental (A) are robust to unmeasured confounding, as expected. Observational samples instead show varying degrees of sensitivity, with the full observational sample (B) being more sensitive than the trimmed version (H). The top-ranked PSID1 subsamples (C-G) show that despite employing advanced criteria to improve balance and overlap, treatment effect estimates can exhibit increasing bias under plausible stronger confounding scenarios based on the reference confounder strength.</p>
</div>
<div id="summary" class="section level2 hasAnchor" number="1.12">
<h2><span class="header-section-number">1.12</span> Summary<a href="lalonde-calónico-smith-lcs-data.html#summary" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>After reexamining the LaLonde-Calónico-Smith (LCS) data, the results confirm that, as with the NSW and LDW datasets, overlap between treated and control groups is generally stronger in the experimental sample than in the observational (PSID-1) controls. Augmenting the sample with experimental controls improves overlap but does not consistently resolve covariate imbalance.</p>
<p>The findings for the LCS sample closely mirror those from the LDW and NSW analyses: while certain methods can bring effect estimates closer to experimental benchmarks, substantial estimator-dependent variability and sensitivity to sample construction persist. Placebo and sensitivity analyses again show that unconfoundedness is difficult to verify, and that treatment effect estimates from observational data remain fragile. This underscores the ongoing challenge of obtaining reliable causal estimates for the LCS data.</p>

</div>
</div>
<h3>References<a href="references.html#references" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div id="refs" class="references csl-bib-body hanging-indent" entry-spacing="0">
<div id="ref-calonico_smith_2017" class="csl-entry">
Calónico, Sebastian, and Jeffrey Smith. 2017. <span>“The Women of the National Supported Work Demonstration.”</span>
</div>
<div id="ref-imbens2024" class="csl-entry">
Imbens, Guido W., and Yiqing Xu. 2024. <span>“LaLonde (1986) After Nearly Four Decades: Lessons Learned.”</span>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="index.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="references.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
  "sharing": {
    "github": false,
    "facebook": true,
    "twitter": true,
    "linkedin": false,
    "weibo": false,
    "instapaper": false,
    "vk": false,
    "whatsapp": false,
    "all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
  },
  "fontsettings": {
    "theme": "white",
    "family": "sans",
    "size": 2
  },
  "edit": {
    "link": "https://github.com/lkrsl/Application-of-Outcome-Weights-Framework-for-DML-to-Lalonde-Study/edit/main/tutorial/05-LCS.Rmd",
    "text": "Edit"
  },
  "history": {
    "link": null,
    "text": null
  },
  "view": {
    "link": null,
    "text": null
  },
  "download": ["Outcome-Weights.pdf", "Outcome-Weights.epub"],
  "search": {
    "engine": "fuse",
    "options": null
  },
  "toc": {
    "collapse": "subsection"
  }
});
});
</script>

</body>

</html>

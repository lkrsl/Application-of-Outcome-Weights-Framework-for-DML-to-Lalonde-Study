<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 3 LaLonde (NSW) Data | Application of the Outcome Weights Framework for Double Machine Learning to the Lalonde Study</title>
  <meta name="description" content="<p>This book replicates the LaLonde study by Imbens &amp; Xu (2024) and extends it by comparing a
full with a reduced covariate model to mitigate potential confounding.
It evaluates various methods to improve overlap and covariate balance for robust
treatment effect estimation and applies the outcome weights framework by Knaus &amp; Pfleiderer (2024)
to assess another estimator and analyse the distributional properties of outcome weights.
The analysis draws on the original LaLonde dataset as well as the LaLonde–Dehejia–Wahba (LDW) and LaLonde–Calónico–Smith (LCS) datasets.</p>" />
  <meta name="generator" content="bookdown 0.45 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 3 LaLonde (NSW) Data | Application of the Outcome Weights Framework for Double Machine Learning to the Lalonde Study" />
  <meta property="og:type" content="book" />
  
  <meta property="og:description" content="<p>This book replicates the LaLonde study by Imbens &amp; Xu (2024) and extends it by comparing a
full with a reduced covariate model to mitigate potential confounding.
It evaluates various methods to improve overlap and covariate balance for robust
treatment effect estimation and applies the outcome weights framework by Knaus &amp; Pfleiderer (2024)
to assess another estimator and analyse the distributional properties of outcome weights.
The analysis draws on the original LaLonde dataset as well as the LaLonde–Dehejia–Wahba (LDW) and LaLonde–Calónico–Smith (LCS) datasets.</p>" />
  <meta name="github-repo" content="lkrsl/Application-of-Outcome-Weights-Framework-for-DML-to-Lalonde-Study" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 3 LaLonde (NSW) Data | Application of the Outcome Weights Framework for Double Machine Learning to the Lalonde Study" />
  
  <meta name="twitter:description" content="<p>This book replicates the LaLonde study by Imbens &amp; Xu (2024) and extends it by comparing a
full with a reduced covariate model to mitigate potential confounding.
It evaluates various methods to improve overlap and covariate balance for robust
treatment effect estimation and applies the outcome weights framework by Knaus &amp; Pfleiderer (2024)
to assess another estimator and analyse the distributional properties of outcome weights.
The analysis draws on the original LaLonde dataset as well as the LaLonde–Dehejia–Wahba (LDW) and LaLonde–Calónico–Smith (LCS) datasets.</p>" />
  

<meta name="author" content="Laura Kreisel" />


<meta name="date" content="2025-10-27" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="lalonde-dehejia-wahba-ldw-data.html"/>

<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>
<script src="libs/kePrint-0.0.1/kePrint.js"></script>
<link href="libs/lightable-0.0.1/lightable.css" rel="stylesheet" />


<style type="text/css">
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
  
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
</style>
<style type="text/css">
/* Used with Pandoc 2.11+ new --citeproc when CSL is used */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
  margin-bottom: 0em;
}
.hanging div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}
</style>

<link rel="stylesheet" href="tutorial/style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Application of Outcome Weights Framework for DML to Lalonde Study</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Preface</a></li>
<li class="chapter" data-level="1" data-path="getting-started.html"><a href="getting-started.html"><i class="fa fa-check"></i><b>1</b> Getting started</a>
<ul>
<li class="chapter" data-level="1.1" data-path="getting-started.html"><a href="getting-started.html#installation"><i class="fa fa-check"></i><b>1.1</b> Installation</a></li>
<li class="chapter" data-level="1.2" data-path="getting-started.html"><a href="getting-started.html#wrapper-functions"><i class="fa fa-check"></i><b>1.2</b> Wrapper functions</a>
<ul>
<li class="chapter" data-level="1.2.1" data-path="getting-started.html"><a href="getting-started.html#overview"><i class="fa fa-check"></i><b>1.2.1</b> Overview</a></li>
<li class="chapter" data-level="1.2.2" data-path="getting-started.html"><a href="getting-started.html#inspection"><i class="fa fa-check"></i><b>1.2.2</b> Inspection</a></li>
<li class="chapter" data-level="1.2.3" data-path="getting-started.html"><a href="getting-started.html#improving-covariate-balance-and-overlap"><i class="fa fa-check"></i><b>1.2.3</b> Improving covariate balance and overlap</a></li>
<li class="chapter" data-level="1.2.4" data-path="getting-started.html"><a href="getting-started.html#reassessing-methods"><i class="fa fa-check"></i><b>1.2.4</b> Reassessing methods</a></li>
<li class="chapter" data-level="1.2.5" data-path="getting-started.html"><a href="getting-started.html#estimating"><i class="fa fa-check"></i><b>1.2.5</b> Estimating</a></li>
<li class="chapter" data-level="1.2.6" data-path="getting-started.html"><a href="getting-started.html#outcome-weights-analysis"><i class="fa fa-check"></i><b>1.2.6</b> Outcome weights analysis</a></li>
<li class="chapter" data-level="1.2.7" data-path="getting-started.html"><a href="getting-started.html#sensitivity-analysis"><i class="fa fa-check"></i><b>1.2.7</b> Sensitivity analysis</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="2" data-path="lalonde-dehejia-wahba-ldw-data.html"><a href="lalonde-dehejia-wahba-ldw-data.html"><i class="fa fa-check"></i><b>2</b> LaLonde-Dehejia-Wahba (LDW) Data</a>
<ul>
<li class="chapter" data-level="2.1" data-path="lalonde-dehejia-wahba-ldw-data.html"><a href="lalonde-dehejia-wahba-ldw-data.html#set-up"><i class="fa fa-check"></i><b>2.1</b> Set up</a>
<ul>
<li class="chapter" data-level="2.1.1" data-path="lalonde-dehejia-wahba-ldw-data.html"><a href="lalonde-dehejia-wahba-ldw-data.html#source-functions-and-load-data"><i class="fa fa-check"></i><b>2.1.1</b> Source functions and load data</a></li>
<li class="chapter" data-level="2.1.2" data-path="lalonde-dehejia-wahba-ldw-data.html"><a href="lalonde-dehejia-wahba-ldw-data.html#inspect-data"><i class="fa fa-check"></i><b>2.1.2</b> Inspect data</a></li>
<li class="chapter" data-level="2.1.3" data-path="lalonde-dehejia-wahba-ldw-data.html"><a href="lalonde-dehejia-wahba-ldw-data.html#load-and-preprocess-data"><i class="fa fa-check"></i><b>2.1.3</b> Load and preprocess data</a></li>
</ul></li>
<li class="chapter" data-level="2.2" data-path="lalonde-dehejia-wahba-ldw-data.html"><a href="lalonde-dehejia-wahba-ldw-data.html#model-a"><i class="fa fa-check"></i><b>2.2</b> Model A</a>
<ul>
<li class="chapter" data-level="2.2.1" data-path="lalonde-dehejia-wahba-ldw-data.html"><a href="lalonde-dehejia-wahba-ldw-data.html#assessing-overlap-and-covariate-balance"><i class="fa fa-check"></i><b>2.2.1</b> Assessing overlap and covariate balance</a></li>
</ul></li>
<li class="chapter" data-level="2.3" data-path="lalonde-dehejia-wahba-ldw-data.html"><a href="lalonde-dehejia-wahba-ldw-data.html#improving-primarily-covariate-balance"><i class="fa fa-check"></i><b>2.3</b> Improving primarily covariate balance</a>
<ul>
<li class="chapter" data-level="2.3.1" data-path="lalonde-dehejia-wahba-ldw-data.html"><a href="lalonde-dehejia-wahba-ldw-data.html#matching-2"><i class="fa fa-check"></i><b>2.3.1</b> Matching</a></li>
<li class="chapter" data-level="2.3.2" data-path="lalonde-dehejia-wahba-ldw-data.html"><a href="lalonde-dehejia-wahba-ldw-data.html#weighting-2"><i class="fa fa-check"></i><b>2.3.2</b> Weighting</a></li>
</ul></li>
<li class="chapter" data-level="2.4" data-path="lalonde-dehejia-wahba-ldw-data.html"><a href="lalonde-dehejia-wahba-ldw-data.html#improving-primarily-overlap"><i class="fa fa-check"></i><b>2.4</b> Improving primarily overlap</a>
<ul>
<li class="chapter" data-level="2.4.1" data-path="lalonde-dehejia-wahba-ldw-data.html"><a href="lalonde-dehejia-wahba-ldw-data.html#truncation-2"><i class="fa fa-check"></i><b>2.4.1</b> Truncation</a></li>
<li class="chapter" data-level="2.4.2" data-path="lalonde-dehejia-wahba-ldw-data.html"><a href="lalonde-dehejia-wahba-ldw-data.html#trimming-2"><i class="fa fa-check"></i><b>2.4.2</b> Trimming</a></li>
</ul></li>
<li class="chapter" data-level="2.5" data-path="lalonde-dehejia-wahba-ldw-data.html"><a href="lalonde-dehejia-wahba-ldw-data.html#integrated-methods"><i class="fa fa-check"></i><b>2.5</b> Integrated methods</a>
<ul>
<li class="chapter" data-level="2.5.1" data-path="lalonde-dehejia-wahba-ldw-data.html"><a href="lalonde-dehejia-wahba-ldw-data.html#trimming-and-matching"><i class="fa fa-check"></i><b>2.5.1</b> Trimming and matching</a></li>
<li class="chapter" data-level="2.5.2" data-path="lalonde-dehejia-wahba-ldw-data.html"><a href="lalonde-dehejia-wahba-ldw-data.html#trimming-and-weighting"><i class="fa fa-check"></i><b>2.5.2</b> Trimming and weighting</a></li>
</ul></li>
<li class="chapter" data-level="2.6" data-path="lalonde-dehejia-wahba-ldw-data.html"><a href="lalonde-dehejia-wahba-ldw-data.html#reassessing-methods-1"><i class="fa fa-check"></i><b>2.6</b> Reassessing methods</a>
<ul>
<li class="chapter" data-level="2.6.1" data-path="lalonde-dehejia-wahba-ldw-data.html"><a href="lalonde-dehejia-wahba-ldw-data.html#matching-3"><i class="fa fa-check"></i><b>2.6.1</b> Matching</a></li>
<li class="chapter" data-level="2.6.2" data-path="lalonde-dehejia-wahba-ldw-data.html"><a href="lalonde-dehejia-wahba-ldw-data.html#weighting-3"><i class="fa fa-check"></i><b>2.6.2</b> Weighting</a></li>
<li class="chapter" data-level="2.6.3" data-path="lalonde-dehejia-wahba-ldw-data.html"><a href="lalonde-dehejia-wahba-ldw-data.html#truncation-3"><i class="fa fa-check"></i><b>2.6.3</b> Truncation</a></li>
<li class="chapter" data-level="2.6.4" data-path="lalonde-dehejia-wahba-ldw-data.html"><a href="lalonde-dehejia-wahba-ldw-data.html#trimming-3"><i class="fa fa-check"></i><b>2.6.4</b> Trimming</a></li>
</ul></li>
<li class="chapter" data-level="2.7" data-path="lalonde-dehejia-wahba-ldw-data.html"><a href="lalonde-dehejia-wahba-ldw-data.html#integrated-methods-1"><i class="fa fa-check"></i><b>2.7</b> Integrated methods</a>
<ul>
<li class="chapter" data-level="2.7.1" data-path="lalonde-dehejia-wahba-ldw-data.html"><a href="lalonde-dehejia-wahba-ldw-data.html#trimming-and-matching-1"><i class="fa fa-check"></i><b>2.7.1</b> Trimming and matching</a></li>
<li class="chapter" data-level="2.7.2" data-path="lalonde-dehejia-wahba-ldw-data.html"><a href="lalonde-dehejia-wahba-ldw-data.html#trimming-and-weighting-1"><i class="fa fa-check"></i><b>2.7.2</b> Trimming and weighting</a></li>
</ul></li>
<li class="chapter" data-level="2.8" data-path="lalonde-dehejia-wahba-ldw-data.html"><a href="lalonde-dehejia-wahba-ldw-data.html#identifying-best-methods"><i class="fa fa-check"></i><b>2.8</b> Identifying best methods</a></li>
<li class="chapter" data-level="2.9" data-path="lalonde-dehejia-wahba-ldw-data.html"><a href="lalonde-dehejia-wahba-ldw-data.html#estimating-1"><i class="fa fa-check"></i><b>2.9</b> Estimating</a>
<ul>
<li class="chapter" data-level="2.9.1" data-path="lalonde-dehejia-wahba-ldw-data.html"><a href="lalonde-dehejia-wahba-ldw-data.html#average-treatment-effect-on-the-treated-att"><i class="fa fa-check"></i><b>2.9.1</b> Average treatment effect on the treated (ATT)</a></li>
</ul></li>
</ul></li>
<li class="divider"></li>
<li><a href="https://github.com/lkrsl/Application-of-Outcome-Weights-Framework-for-DML-to-Lalonde-Study" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Application of the Outcome Weights Framework for Double Machine Learning to the Lalonde Study</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="lalonde-nsw-data" class="section level1 hasAnchor" number="3">
<h1><span class="header-section-number">Chapter 3</span> LaLonde (NSW) Data<a href="lalonde-nsw-data.html#lalonde-nsw-data" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<p>This section (4) examines the effect of the treatment (participation in the job training program) on the participants’ earnings in 1978 (<code>re78</code>) in the original LaLonde dataset (loaded as <code>nsw</code>, similar to <span class="citation">Imbens and Xu (<a href="#ref-imbens2024">2024</a>)</span>).</p>
<p>For detailed explanations of the analysis steps and notes, please refer to section 2. Here, we only explain the NSW–specific results.</p>
<div id="set-up-1" class="section level2 hasAnchor" number="3.1">
<h2><span class="header-section-number">3.1</span> Set up<a href="lalonde-nsw-data.html#set-up-1" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div id="source-functions-and-load-data-1" class="section level3 hasAnchor" number="3.1.1">
<h3><span class="header-section-number">3.1.1</span> Source functions and load data<a href="lalonde-nsw-data.html#source-functions-and-load-data-1" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb308"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb308-1"><a href="lalonde-nsw-data.html#cb308-1" tabindex="-1"></a><span class="co"># source functions</span></span>
<span id="cb308-2"><a href="lalonde-nsw-data.html#cb308-2" tabindex="-1"></a><span class="fu">source</span>(<span class="st">&quot;https://github.com/xuyiqing/lalonde/blob/main/tutorial/functions.R?raw=TRUE&quot;</span>)</span>
<span id="cb308-3"><a href="lalonde-nsw-data.html#cb308-3" tabindex="-1"></a><span class="fu">source</span>(<span class="st">&quot;tutorial/functions.R&quot;</span>)</span></code></pre></div>
<div class="sourceCode" id="cb309"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb309-1"><a href="lalonde-nsw-data.html#cb309-1" tabindex="-1"></a><span class="co"># load data</span></span>
<span id="cb309-2"><a href="lalonde-nsw-data.html#cb309-2" tabindex="-1"></a><span class="fu">load</span>(<span class="st">&quot;data/lalonde.RData&quot;</span>)</span></code></pre></div>
<div class="sourceCode" id="cb310"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb310-1"><a href="lalonde-nsw-data.html#cb310-1" tabindex="-1"></a><span class="co"># set seed</span></span>
<span id="cb310-2"><a href="lalonde-nsw-data.html#cb310-2" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">42</span>)</span></code></pre></div>
</div>
<div id="load-and-preprocess-data-1" class="section level3 hasAnchor" number="3.1.2">
<h3><span class="header-section-number">3.1.2</span> Load and preprocess data<a href="lalonde-nsw-data.html#load-and-preprocess-data-1" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb311"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb311-1"><a href="lalonde-nsw-data.html#cb311-1" tabindex="-1"></a>treat <span class="ot">&lt;-</span> <span class="st">&quot;treat&quot;</span></span>
<span id="cb311-2"><a href="lalonde-nsw-data.html#cb311-2" tabindex="-1"></a>nsw_co<span class="sc">$</span>treat <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb311-3"><a href="lalonde-nsw-data.html#cb311-3" tabindex="-1"></a></span>
<span id="cb311-4"><a href="lalonde-nsw-data.html#cb311-4" tabindex="-1"></a><span class="co"># drop re74, u74, tau from CPS1 and PSID1 and merge data</span></span>
<span id="cb311-5"><a href="lalonde-nsw-data.html#cb311-5" tabindex="-1"></a>cps1a <span class="ot">&lt;-</span> <span class="fu">subset</span>(cps1, <span class="at">select =</span>  <span class="sc">-</span><span class="fu">c</span>(re74, u74))</span>
<span id="cb311-6"><a href="lalonde-nsw-data.html#cb311-6" tabindex="-1"></a>nsw_cps <span class="ot">&lt;-</span> <span class="fu">rbind.data.frame</span>(nsw_tr, cps1a)</span>
<span id="cb311-7"><a href="lalonde-nsw-data.html#cb311-7" tabindex="-1"></a></span>
<span id="cb311-8"><a href="lalonde-nsw-data.html#cb311-8" tabindex="-1"></a>psid1a <span class="ot">&lt;-</span> <span class="fu">subset</span>(psid1, <span class="at">select =</span>  <span class="sc">-</span><span class="fu">c</span>(re74, u74))</span>
<span id="cb311-9"><a href="lalonde-nsw-data.html#cb311-9" tabindex="-1"></a>nsw_psid <span class="ot">&lt;-</span> <span class="fu">rbind.data.frame</span>(nsw_tr, psid1a)</span>
<span id="cb311-10"><a href="lalonde-nsw-data.html#cb311-10" tabindex="-1"></a></span>
<span id="cb311-11"><a href="lalonde-nsw-data.html#cb311-11" tabindex="-1"></a>nsw_cps_plus <span class="ot">&lt;-</span> <span class="fu">rbind.data.frame</span>(nsw_cps, nsw_co)</span>
<span id="cb311-12"><a href="lalonde-nsw-data.html#cb311-12" tabindex="-1"></a>nsw_psid_plus <span class="ot">&lt;-</span> <span class="fu">rbind.data.frame</span>(nsw_psid, nsw_co)</span></code></pre></div>
</div>
<div id="inspect-data-1" class="section level3 hasAnchor" number="3.1.3">
<h3><span class="header-section-number">3.1.3</span> Inspect data<a href="lalonde-nsw-data.html#inspect-data-1" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb312"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb312-1"><a href="lalonde-nsw-data.html#cb312-1" tabindex="-1"></a><span class="co"># collect datasets in a list</span></span>
<span id="cb312-2"><a href="lalonde-nsw-data.html#cb312-2" tabindex="-1"></a>data <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="at">nsw =</span> nsw, <span class="at">nsw_cps =</span> nsw_cps, <span class="at">nsw_psid =</span> nsw_psid, <span class="at">nsw_cps_plus =</span> nsw_cps_plus, <span class="at">nsw_psid_plus =</span> nsw_psid_plus)</span>
<span id="cb312-3"><a href="lalonde-nsw-data.html#cb312-3" tabindex="-1"></a></span>
<span id="cb312-4"><a href="lalonde-nsw-data.html#cb312-4" tabindex="-1"></a><span class="co"># inspect key metrics of each dataset</span></span>
<span id="cb312-5"><a href="lalonde-nsw-data.html#cb312-5" tabindex="-1"></a>summary_stats <span class="ot">&lt;-</span> <span class="fu">inspect_data</span>(data)</span>
<span id="cb312-6"><a href="lalonde-nsw-data.html#cb312-6" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">kable</span>(summary_stats, <span class="at">caption =</span> <span class="st">&quot;Summary Statistics&quot;</span>)</span></code></pre></div>
<table>
<caption><span id="tab:unnamed-chunk-186">Table 3.1: </span>Summary Statistics</caption>
<colgroup>
<col width="9%" />
<col width="5%" />
<col width="8%" />
<col width="8%" />
<col width="6%" />
<col width="62%" />
</colgroup>
<thead>
<tr class="header">
<th align="left">dataset</th>
<th align="right">num_obs</th>
<th align="right">num_treated</th>
<th align="right">num_controls</th>
<th align="right">num_vars</th>
<th align="left">name_vars</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">nsw</td>
<td align="right">722</td>
<td align="right">297</td>
<td align="right">425</td>
<td align="right">12</td>
<td align="left">data_id, treat, age, education, black, hispanic, married, nodegree, re75, re78, u75, sample</td>
</tr>
<tr class="even">
<td align="left">nsw_cps</td>
<td align="right">16289</td>
<td align="right">297</td>
<td align="right">15992</td>
<td align="right">12</td>
<td align="left">data_id, treat, age, education, black, hispanic, married, nodegree, re75, re78, u75, sample</td>
</tr>
<tr class="odd">
<td align="left">nsw_psid</td>
<td align="right">2787</td>
<td align="right">297</td>
<td align="right">2490</td>
<td align="right">12</td>
<td align="left">data_id, treat, age, education, black, hispanic, married, nodegree, re75, re78, u75, sample</td>
</tr>
<tr class="even">
<td align="left">nsw_cps_plus</td>
<td align="right">16714</td>
<td align="right">722</td>
<td align="right">15992</td>
<td align="right">12</td>
<td align="left">data_id, treat, age, education, black, hispanic, married, nodegree, re75, re78, u75, sample</td>
</tr>
<tr class="odd">
<td align="left">nsw_psid_plus</td>
<td align="right">3212</td>
<td align="right">722</td>
<td align="right">2490</td>
<td align="right">12</td>
<td align="left">data_id, treat, age, education, black, hispanic, married, nodegree, re75, re78, u75, sample</td>
</tr>
</tbody>
</table>
</div>
</div>
<div id="nsw" class="section level2 hasAnchor" number="3.2">
<h2><span class="header-section-number">3.2</span> NSW<a href="lalonde-nsw-data.html#nsw" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div class="sourceCode" id="cb313"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb313-1"><a href="lalonde-nsw-data.html#cb313-1" tabindex="-1"></a><span class="co"># define variables</span></span>
<span id="cb313-2"><a href="lalonde-nsw-data.html#cb313-2" tabindex="-1"></a>Y <span class="ot">&lt;-</span> <span class="st">&quot;re78&quot;</span> </span>
<span id="cb313-3"><a href="lalonde-nsw-data.html#cb313-3" tabindex="-1"></a>treat <span class="ot">&lt;-</span> <span class="st">&quot;treat&quot;</span> </span>
<span id="cb313-4"><a href="lalonde-nsw-data.html#cb313-4" tabindex="-1"></a>covar <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;age&quot;</span>, <span class="st">&quot;education&quot;</span>, <span class="st">&quot;black&quot;</span>, <span class="st">&quot;hispanic&quot;</span>, <span class="st">&quot;married&quot;</span>, </span>
<span id="cb313-5"><a href="lalonde-nsw-data.html#cb313-5" tabindex="-1"></a>           <span class="st">&quot;nodegree&quot;</span>, <span class="st">&quot;re75&quot;</span>, <span class="st">&quot;u75&quot;</span>)</span></code></pre></div>
<div id="assessing-overlap-and-covariate-balance-1" class="section level3 hasAnchor" number="3.2.1">
<h3><span class="header-section-number">3.2.1</span> Assessing overlap and covariate balance<a href="lalonde-nsw-data.html#assessing-overlap-and-covariate-balance-1" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div id="overlap-1" class="section level4 hasAnchor" number="3.2.1.1">
<h4><span class="header-section-number">3.2.1.1</span> Overlap<a href="lalonde-nsw-data.html#overlap-1" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<div class="sourceCode" id="cb314"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb314-1"><a href="lalonde-nsw-data.html#cb314-1" tabindex="-1"></a>nsw.ps <span class="ot">&lt;-</span> <span class="fu">assess_overlap</span>(<span class="at">data =</span> nsw, <span class="at">treat =</span> treat, <span class="at">cov =</span> covar)</span></code></pre></div>
<pre><code>## -1.375215 0.6394217</code></pre>
<div class="figure"><span style="display:block;" id="fig:unnamed-chunk-188-1"></span>
<img src="Outcome-Weights_files/figure-html/unnamed-chunk-188-1.png" alt="FIGUREC1. SubfigureA:NSW-Experimental. SubfigureB:NSW-CPS1. SubfigureC:NSW-PSID1." width="100%" />
<p class="caption">
Figure 3.1: FIGUREC1. SubfigureA:NSW-Experimental. SubfigureB:NSW-CPS1. SubfigureC:NSW-PSID1.
</p>
</div>
<div class="sourceCode" id="cb316"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb316-1"><a href="lalonde-nsw-data.html#cb316-1" tabindex="-1"></a>nsw_cps.ps <span class="ot">&lt;-</span> <span class="fu">assess_overlap</span>(<span class="at">data =</span> nsw_cps, <span class="at">treat =</span> treat, <span class="at">cov =</span> covar) </span></code></pre></div>
<pre><code>## -12.49703 1.660349</code></pre>
<div class="figure"><span style="display:block;" id="fig:unnamed-chunk-188-2"></span>
<img src="Outcome-Weights_files/figure-html/unnamed-chunk-188-2.png" alt="FIGUREC1. SubfigureA:NSW-Experimental. SubfigureB:NSW-CPS1. SubfigureC:NSW-PSID1." width="100%" />
<p class="caption">
Figure 3.2: FIGUREC1. SubfigureA:NSW-Experimental. SubfigureB:NSW-CPS1. SubfigureC:NSW-PSID1.
</p>
</div>
<div class="sourceCode" id="cb318"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb318-1"><a href="lalonde-nsw-data.html#cb318-1" tabindex="-1"></a>nsw_psid.ps <span class="ot">&lt;-</span> <span class="fu">assess_overlap</span>(<span class="at">data =</span> nsw_psid, <span class="at">treat =</span> treat, <span class="at">cov =</span> covar) </span></code></pre></div>
<pre><code>## -10.70941 3.573044</code></pre>
<div class="figure"><span style="display:block;" id="fig:unnamed-chunk-188-3"></span>
<img src="Outcome-Weights_files/figure-html/unnamed-chunk-188-3.png" alt="FIGUREC1. SubfigureA:NSW-Experimental. SubfigureB:NSW-CPS1. SubfigureC:NSW-PSID1." width="100%" />
<p class="caption">
Figure 3.3: FIGUREC1. SubfigureA:NSW-Experimental. SubfigureB:NSW-CPS1. SubfigureC:NSW-PSID1.
</p>
</div>
<p>As anticipated, the NSW-Experimental data exhibit an almost perfect overlap. In contrast, the observational datasets NSW-CPS1 and NSW-PSID1 display weak overlap.</p>
<div class="sourceCode" id="cb320"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb320-1"><a href="lalonde-nsw-data.html#cb320-1" tabindex="-1"></a>nsw_cps_plus.ps <span class="ot">&lt;-</span> <span class="fu">assess_overlap</span>(<span class="at">data =</span> nsw_cps_plus, <span class="at">treat =</span> treat, <span class="at">cov =</span> covar)  </span></code></pre></div>
<pre><code>## -11.56837 2.929738</code></pre>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:unnamed-chunk-189-1"></span>
<img src="Outcome-Weights_files/figure-html/unnamed-chunk-189-1.png" alt="FIGUREC1. SubfigureD:NSW-CPS1-PLUS. SubfigureE:NSW-PSID1-PLUS." width="80%" />
<p class="caption">
Figure 3.4: FIGUREC1. SubfigureD:NSW-CPS1-PLUS. SubfigureE:NSW-PSID1-PLUS.
</p>
</div>
<div class="sourceCode" id="cb322"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb322-1"><a href="lalonde-nsw-data.html#cb322-1" tabindex="-1"></a>nsw_psid_plus.ps <span class="ot">&lt;-</span> <span class="fu">assess_overlap</span>(<span class="at">data =</span> nsw_psid_plus, <span class="at">treat =</span> treat, <span class="at">cov =</span> covar)</span></code></pre></div>
<pre><code>## -9.367327 6.41566</code></pre>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:unnamed-chunk-189-2"></span>
<img src="Outcome-Weights_files/figure-html/unnamed-chunk-189-2.png" alt="FIGUREC1. SubfigureD:NSW-CPS1-PLUS. SubfigureE:NSW-PSID1-PLUS." width="80%" />
<p class="caption">
Figure 3.5: FIGUREC1. SubfigureD:NSW-CPS1-PLUS. SubfigureE:NSW-PSID1-PLUS.
</p>
</div>
<p>With the expanded datasets NSW-CPS1-PLUS and NSW-PSID1-PLUS, it is evident that the degree of overlap between treated and control groups has improved, as seen by a greater coverage of log-odds densities across both samples.</p>
<div class="sourceCode" id="cb324"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb324-1"><a href="lalonde-nsw-data.html#cb324-1" tabindex="-1"></a><span class="co"># set model formula</span></span>
<span id="cb324-2"><a href="lalonde-nsw-data.html#cb324-2" tabindex="-1"></a>model <span class="ot">&lt;-</span> <span class="fu">as.formula</span>(<span class="fu">paste</span>(treat, <span class="st">&quot;~&quot;</span>, <span class="fu">paste</span>(covar, <span class="at">collapse =</span> <span class="st">&quot; + &quot;</span>)))</span></code></pre></div>
</div>
<div id="covariate-balance-1" class="section level4 hasAnchor" number="3.2.1.2">
<h4><span class="header-section-number">3.2.1.2</span> Covariate balance<a href="lalonde-nsw-data.html#covariate-balance-1" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<div class="sourceCode" id="cb325"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb325-1"><a href="lalonde-nsw-data.html#cb325-1" tabindex="-1"></a><span class="fu">love.plot</span>(nsw, nsw_cps, treat, <span class="at">covar =</span> covar, <span class="at">title =</span> <span class="st">&quot;NSW-CPS1&quot;</span>)</span></code></pre></div>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:unnamed-chunk-191-1"></span>
<img src="Outcome-Weights_files/figure-html/unnamed-chunk-191-1.png" alt="FIGUREC2. SubfigureA:NSW-CPS1. SubfigureB:NSW-CPS1-PLUS. SubfigureC:NSW-PSID1. SubfigureD:NSW-PSID1-PLUS." width="80%" />
<p class="caption">
Figure 3.6: FIGUREC2. SubfigureA:NSW-CPS1. SubfigureB:NSW-CPS1-PLUS. SubfigureC:NSW-PSID1. SubfigureD:NSW-PSID1-PLUS.
</p>
</div>
<div class="sourceCode" id="cb326"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb326-1"><a href="lalonde-nsw-data.html#cb326-1" tabindex="-1"></a><span class="fu">love.plot</span>(nsw, nsw_psid, treat, <span class="at">covar =</span> covar, <span class="at">title =</span> <span class="st">&quot;NSW-PSID1&quot;</span>)</span></code></pre></div>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:unnamed-chunk-191-2"></span>
<img src="Outcome-Weights_files/figure-html/unnamed-chunk-191-2.png" alt="FIGUREC2. SubfigureA:NSW-CPS1. SubfigureB:NSW-CPS1-PLUS. SubfigureC:NSW-PSID1. SubfigureD:NSW-PSID1-PLUS." width="80%" />
<p class="caption">
Figure 3.7: FIGUREC2. SubfigureA:NSW-CPS1. SubfigureB:NSW-CPS1-PLUS. SubfigureC:NSW-PSID1. SubfigureD:NSW-PSID1-PLUS.
</p>
</div>
<div class="sourceCode" id="cb327"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb327-1"><a href="lalonde-nsw-data.html#cb327-1" tabindex="-1"></a><span class="fu">love.plot</span>(nsw, nsw_cps_plus, treat, <span class="at">covar =</span> covar, <span class="at">title =</span> <span class="st">&quot;NSW-CPS1-PLUS&quot;</span>)</span></code></pre></div>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:unnamed-chunk-191-3"></span>
<img src="Outcome-Weights_files/figure-html/unnamed-chunk-191-3.png" alt="FIGUREC2. SubfigureA:NSW-CPS1. SubfigureB:NSW-CPS1-PLUS. SubfigureC:NSW-PSID1. SubfigureD:NSW-PSID1-PLUS." width="80%" />
<p class="caption">
Figure 3.8: FIGUREC2. SubfigureA:NSW-CPS1. SubfigureB:NSW-CPS1-PLUS. SubfigureC:NSW-PSID1. SubfigureD:NSW-PSID1-PLUS.
</p>
</div>
<div class="sourceCode" id="cb328"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb328-1"><a href="lalonde-nsw-data.html#cb328-1" tabindex="-1"></a><span class="fu">love.plot</span>(nsw, nsw_psid_plus, treat, <span class="at">covar =</span> covar, <span class="at">title =</span> <span class="st">&quot;NSW-PSID1-PLUS&quot;</span>)</span></code></pre></div>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:unnamed-chunk-191-4"></span>
<img src="Outcome-Weights_files/figure-html/unnamed-chunk-191-4.png" alt="FIGUREC2. SubfigureA:NSW-CPS1. SubfigureB:NSW-CPS1-PLUS. SubfigureC:NSW-PSID1. SubfigureD:NSW-PSID1-PLUS." width="80%" />
<p class="caption">
Figure 3.9: FIGUREC2. SubfigureA:NSW-CPS1. SubfigureB:NSW-CPS1-PLUS. SubfigureC:NSW-PSID1. SubfigureD:NSW-PSID1-PLUS.
</p>
</div>
<p>Neither NSW-CPS1-PLUS nor NSW-PSID1-PLUS shows consistently improved covariate balance compared with their non-plus counterparts based on raw standardized differences. Although some specific covariates improve slightly, most show the same or increased imbalance.</p>
<div class="callout-note">
<p>In the subsequent analysis, that is focused on improving covariate balance and overlap, only the original datasets NSW-CPS1 and NSW-PSID1 are considered. The NSW-CPS1-PLUS and NSW-PSID1-PLUS datasets are included exclusively for comparison and replication purposes. The NSW-Experimental data is excluded from these steps, as randomization already ensures adequate covariate balance and overlap.</p>
</div>
</div>
</div>
</div>
<div id="improving-primarily-covariate-balance-1" class="section level2 hasAnchor" number="3.3">
<h2><span class="header-section-number">3.3</span> Improving primarily covariate balance<a href="lalonde-nsw-data.html#improving-primarily-covariate-balance-1" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div id="matching-4" class="section level3 hasAnchor" number="3.3.1">
<h3><span class="header-section-number">3.3.1</span> Matching<a href="lalonde-nsw-data.html#matching-4" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div id="distance-matching-1" class="section level4 hasAnchor" number="3.3.1.1">
<h4><span class="header-section-number">3.3.1.1</span> Distance Matching<a href="lalonde-nsw-data.html#distance-matching-1" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<div id="nearest-neighbor-matching-1" class="section level5 hasAnchor" number="3.3.1.1.1">
<h5><span class="header-section-number">3.3.1.1.1</span> 1:1 Nearest neighbor matching<a href="lalonde-nsw-data.html#nearest-neighbor-matching-1" class="anchor-section" aria-label="Anchor link to header"></a></h5>
<div class="sourceCode" id="cb329"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb329-1"><a href="lalonde-nsw-data.html#cb329-1" tabindex="-1"></a><span class="co"># perform nearest neighbor matching with k=1, logistic propensity score and replacement</span></span>
<span id="cb329-2"><a href="lalonde-nsw-data.html#cb329-2" tabindex="-1"></a>m.out.cps.nearest <span class="ot">&lt;-</span> <span class="fu">matchit</span>(model, <span class="at">data =</span> nsw_cps, <span class="at">method =</span> <span class="st">&quot;nearest&quot;</span>, <span class="at">distance =</span> <span class="st">&quot;logit&quot;</span>, <span class="at">replace =</span> <span class="cn">TRUE</span>)</span>
<span id="cb329-3"><a href="lalonde-nsw-data.html#cb329-3" tabindex="-1"></a>m.out.psid.nearest <span class="ot">&lt;-</span> <span class="fu">matchit</span>(model, <span class="at">data =</span> nsw_psid, <span class="at">method =</span> <span class="st">&quot;nearest&quot;</span>, <span class="at">distance =</span> <span class="st">&quot;logit&quot;</span>, <span class="at">replace =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
</div>
<div id="k1-matching-k2-1" class="section level5 hasAnchor" number="3.3.1.1.2">
<h5><span class="header-section-number">3.3.1.1.2</span> k:1 matching (k=2)<a href="lalonde-nsw-data.html#k1-matching-k2-1" class="anchor-section" aria-label="Anchor link to header"></a></h5>
<div class="sourceCode" id="cb330"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb330-1"><a href="lalonde-nsw-data.html#cb330-1" tabindex="-1"></a>k<span class="ot">&lt;-</span><span class="dv">2</span></span>
<span id="cb330-2"><a href="lalonde-nsw-data.html#cb330-2" tabindex="-1"></a><span class="co"># perform nearest neighbor matching with k=2, logistic propensity score and replacement</span></span>
<span id="cb330-3"><a href="lalonde-nsw-data.html#cb330-3" tabindex="-1"></a>m.out.cps.k2 <span class="ot">&lt;-</span> <span class="fu">matchit</span>(model, <span class="at">data =</span> nsw_cps, <span class="at">method =</span> <span class="st">&quot;nearest&quot;</span>, <span class="at">distance =</span> <span class="st">&quot;logit&quot;</span>, <span class="at">ratio =</span> k, <span class="at">replace =</span> <span class="cn">TRUE</span>)</span>
<span id="cb330-4"><a href="lalonde-nsw-data.html#cb330-4" tabindex="-1"></a>m.out.psid.k2 <span class="ot">&lt;-</span> <span class="fu">matchit</span>(model, <span class="at">data =</span> nsw_psid, <span class="at">method =</span> <span class="st">&quot;nearest&quot;</span>, <span class="at">distance =</span> <span class="st">&quot;logit&quot;</span>, <span class="at">ratio =</span> k, <span class="at">replace =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
</div>
<div id="k1-matching-k3-1" class="section level5 hasAnchor" number="3.3.1.1.3">
<h5><span class="header-section-number">3.3.1.1.3</span> k:1 matching (k=3)<a href="lalonde-nsw-data.html#k1-matching-k3-1" class="anchor-section" aria-label="Anchor link to header"></a></h5>
<div class="sourceCode" id="cb331"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb331-1"><a href="lalonde-nsw-data.html#cb331-1" tabindex="-1"></a>k<span class="ot">&lt;-</span><span class="dv">3</span></span>
<span id="cb331-2"><a href="lalonde-nsw-data.html#cb331-2" tabindex="-1"></a><span class="co"># perform nearest neighbor matching with k=3, logistic propensity score and replacement</span></span>
<span id="cb331-3"><a href="lalonde-nsw-data.html#cb331-3" tabindex="-1"></a>m.out.cps.k3 <span class="ot">&lt;-</span> <span class="fu">matchit</span>(model, <span class="at">data =</span> nsw_cps, <span class="at">method =</span> <span class="st">&quot;nearest&quot;</span>, <span class="at">distance =</span> <span class="st">&quot;logit&quot;</span>, <span class="at">ratio =</span> k, <span class="at">replace =</span> <span class="cn">TRUE</span>)</span>
<span id="cb331-4"><a href="lalonde-nsw-data.html#cb331-4" tabindex="-1"></a>m.out.psid.k3 <span class="ot">&lt;-</span> <span class="fu">matchit</span>(model, <span class="at">data =</span> nsw_psid, <span class="at">method =</span> <span class="st">&quot;nearest&quot;</span>, <span class="at">distance =</span> <span class="st">&quot;logit&quot;</span>, <span class="at">ratio =</span> k, <span class="at">replace =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
</div>
<div id="caliper-matching-1" class="section level5 hasAnchor" number="3.3.1.1.4">
<h5><span class="header-section-number">3.3.1.1.4</span> Caliper matching<a href="lalonde-nsw-data.html#caliper-matching-1" class="anchor-section" aria-label="Anchor link to header"></a></h5>
<div class="sourceCode" id="cb332"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb332-1"><a href="lalonde-nsw-data.html#cb332-1" tabindex="-1"></a><span class="co"># perform nearest neighbor matching with a caliper of 0.1 on the logistic propensity score </span></span>
<span id="cb332-2"><a href="lalonde-nsw-data.html#cb332-2" tabindex="-1"></a>m.out.cps.caliper <span class="ot">&lt;-</span> <span class="fu">matchit</span>(model, <span class="at">data =</span> nsw_cps, <span class="at">method =</span> <span class="st">&quot;nearest&quot;</span>, <span class="at">distance =</span> <span class="st">&quot;logit&quot;</span>, <span class="at">caliper =</span> <span class="fl">0.1</span>, <span class="at">replace =</span> <span class="cn">TRUE</span>)</span>
<span id="cb332-3"><a href="lalonde-nsw-data.html#cb332-3" tabindex="-1"></a>m.out.psid.caliper <span class="ot">&lt;-</span> <span class="fu">matchit</span>(model, <span class="at">data =</span> nsw_psid, <span class="at">method =</span> <span class="st">&quot;nearest&quot;</span>, <span class="at">distance =</span> <span class="st">&quot;logit&quot;</span>, <span class="at">caliper =</span> <span class="fl">0.1</span>, <span class="at">replace =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
</div>
<div id="common-support-restriction-matching-1" class="section level5 hasAnchor" number="3.3.1.1.5">
<h5><span class="header-section-number">3.3.1.1.5</span> Common support restriction matching<a href="lalonde-nsw-data.html#common-support-restriction-matching-1" class="anchor-section" aria-label="Anchor link to header"></a></h5>
<div class="sourceCode" id="cb333"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb333-1"><a href="lalonde-nsw-data.html#cb333-1" tabindex="-1"></a><span class="co"># perform nearest neighbor matching with exclusion of units outside common support</span></span>
<span id="cb333-2"><a href="lalonde-nsw-data.html#cb333-2" tabindex="-1"></a>m.out.cps.cs <span class="ot">&lt;-</span> <span class="fu">matchit</span>(model, <span class="at">data =</span> nsw_cps, <span class="at">method =</span> <span class="st">&quot;nearest&quot;</span>, <span class="at">distance =</span> <span class="st">&quot;logit&quot;</span>, <span class="at">discard =</span> <span class="st">&quot;both&quot;</span>, <span class="at">reestimate =</span> <span class="cn">TRUE</span>, <span class="at">replace =</span> <span class="cn">TRUE</span>)</span>
<span id="cb333-3"><a href="lalonde-nsw-data.html#cb333-3" tabindex="-1"></a>m.out.psid.cs <span class="ot">&lt;-</span> <span class="fu">matchit</span>(model, <span class="at">data =</span> nsw_psid, <span class="at">method =</span> <span class="st">&quot;nearest&quot;</span>, <span class="at">distance =</span> <span class="st">&quot;logit&quot;</span>, <span class="at">discard =</span> <span class="st">&quot;both&quot;</span>, <span class="at">reestimate =</span> <span class="cn">TRUE</span>, <span class="at">replace =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
</div>
<div id="mahalanobis-distance-matching-mahvars-1" class="section level5 hasAnchor" number="3.3.1.1.6">
<h5><span class="header-section-number">3.3.1.1.6</span> Mahalanobis distance matching (mahvars)<a href="lalonde-nsw-data.html#mahalanobis-distance-matching-mahvars-1" class="anchor-section" aria-label="Anchor link to header"></a></h5>
<div class="sourceCode" id="cb334"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb334-1"><a href="lalonde-nsw-data.html#cb334-1" tabindex="-1"></a><span class="co"># perform nearest neighbor matching using mahalanobis distance on selected covariates</span></span>
<span id="cb334-2"><a href="lalonde-nsw-data.html#cb334-2" tabindex="-1"></a>m.out.cps.mahvars <span class="ot">&lt;-</span> <span class="fu">matchit</span>(model, <span class="at">data =</span> nsw_cps, <span class="at">method =</span> <span class="st">&quot;nearest&quot;</span>, <span class="at">distance =</span> <span class="st">&quot;logit&quot;</span>, <span class="at">caliper =</span> <span class="fl">0.2</span>, <span class="at">mahvars =</span> <span class="sc">~</span> age <span class="sc">+</span> education <span class="sc">+</span> re75, <span class="at">replace =</span> <span class="cn">FALSE</span>)</span>
<span id="cb334-3"><a href="lalonde-nsw-data.html#cb334-3" tabindex="-1"></a>m.out.psid.mahvars <span class="ot">&lt;-</span> <span class="fu">matchit</span>(model, <span class="at">data =</span> nsw_psid, <span class="at">method =</span> <span class="st">&quot;nearest&quot;</span>, <span class="at">distance =</span> <span class="st">&quot;logit&quot;</span>, <span class="at">caliper =</span> <span class="fl">0.2</span>, <span class="at">mahvars =</span> <span class="sc">~</span> age <span class="sc">+</span> education <span class="sc">+</span> re75, <span class="at">replace =</span> <span class="cn">FALSE</span>)</span></code></pre></div>
</div>
<div id="optimal-pair-matching-1" class="section level5 hasAnchor" number="3.3.1.1.7">
<h5><span class="header-section-number">3.3.1.1.7</span> Optimal pair matching<a href="lalonde-nsw-data.html#optimal-pair-matching-1" class="anchor-section" aria-label="Anchor link to header"></a></h5>
<div class="sourceCode" id="cb335"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb335-1"><a href="lalonde-nsw-data.html#cb335-1" tabindex="-1"></a><span class="co"># perform optimal pair matching that minimizes total within-pair distance on propensity scores</span></span>
<span id="cb335-2"><a href="lalonde-nsw-data.html#cb335-2" tabindex="-1"></a>m.out.cps.optimal_pair <span class="ot">&lt;-</span> <span class="fu">matchit</span>(model, <span class="at">data =</span> nsw_cps, <span class="at">method =</span> <span class="st">&quot;optimal&quot;</span>, <span class="at">distance =</span> <span class="st">&quot;logit&quot;</span>)</span>
<span id="cb335-3"><a href="lalonde-nsw-data.html#cb335-3" tabindex="-1"></a>m.out.psid.optimal_pair <span class="ot">&lt;-</span> <span class="fu">matchit</span>(model, <span class="at">data =</span> nsw_psid, <span class="at">method =</span> <span class="st">&quot;optimal&quot;</span>, <span class="at">distance =</span> <span class="st">&quot;logit&quot;</span>)</span></code></pre></div>
</div>
<div id="optimal-full-matching-1" class="section level5 hasAnchor" number="3.3.1.1.8">
<h5><span class="header-section-number">3.3.1.1.8</span> Optimal full matching<a href="lalonde-nsw-data.html#optimal-full-matching-1" class="anchor-section" aria-label="Anchor link to header"></a></h5>
<div class="sourceCode" id="cb336"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb336-1"><a href="lalonde-nsw-data.html#cb336-1" tabindex="-1"></a><span class="co"># perform optimal full matching allowing sets with varying ratios of treated to controls and minimizing a global distance criterion</span></span>
<span id="cb336-2"><a href="lalonde-nsw-data.html#cb336-2" tabindex="-1"></a>m.out.cps.optimal_full <span class="ot">&lt;-</span> <span class="fu">matchit</span>(model, <span class="at">data =</span> nsw_cps, <span class="at">method =</span> <span class="st">&quot;full&quot;</span>, <span class="at">distance =</span> <span class="st">&quot;logit&quot;</span>)</span>
<span id="cb336-3"><a href="lalonde-nsw-data.html#cb336-3" tabindex="-1"></a>m.out.psid.optimal_full <span class="ot">&lt;-</span> <span class="fu">matchit</span>(model, <span class="at">data =</span> nsw_psid, <span class="at">method =</span> <span class="st">&quot;full&quot;</span>, <span class="at">distance =</span> <span class="st">&quot;logit&quot;</span>)</span></code></pre></div>
</div>
<div id="generalized-full-matching-1" class="section level5 hasAnchor" number="3.3.1.1.9">
<h5><span class="header-section-number">3.3.1.1.9</span> Generalized full matching<a href="lalonde-nsw-data.html#generalized-full-matching-1" class="anchor-section" aria-label="Anchor link to header"></a></h5>
<div class="sourceCode" id="cb337"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb337-1"><a href="lalonde-nsw-data.html#cb337-1" tabindex="-1"></a><span class="co"># perform generalized full matching using fast approximation and producing matched sets with flexible treated/control ratios </span></span>
<span id="cb337-2"><a href="lalonde-nsw-data.html#cb337-2" tabindex="-1"></a>m.out.cps.general_full <span class="ot">&lt;-</span> <span class="fu">matchit</span>(model, <span class="at">data =</span> nsw_cps, <span class="at">method =</span> <span class="st">&quot;quick&quot;</span>, <span class="at">distance =</span> <span class="st">&quot;logit&quot;</span>)</span>
<span id="cb337-3"><a href="lalonde-nsw-data.html#cb337-3" tabindex="-1"></a>m.out.psid.general_full <span class="ot">&lt;-</span> <span class="fu">matchit</span>(model, <span class="at">data =</span> nsw_psid, <span class="at">method =</span> <span class="st">&quot;quick&quot;</span>, <span class="at">distance =</span> <span class="st">&quot;logit&quot;</span>)</span></code></pre></div>
</div>
<div id="genetic-matching-1" class="section level5 hasAnchor" number="3.3.1.1.10">
<h5><span class="header-section-number">3.3.1.1.10</span> Genetic matching<a href="lalonde-nsw-data.html#genetic-matching-1" class="anchor-section" aria-label="Anchor link to header"></a></h5>
<div class="sourceCode" id="cb338"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb338-1"><a href="lalonde-nsw-data.html#cb338-1" tabindex="-1"></a><span class="co"># perform genetic matching </span></span>
<span id="cb338-2"><a href="lalonde-nsw-data.html#cb338-2" tabindex="-1"></a>m.out.cps.genetic <span class="ot">&lt;-</span> <span class="fu">matchit</span>(model, <span class="at">data =</span> nsw_cps, <span class="at">method =</span> <span class="st">&quot;genetic&quot;</span>, <span class="at">distance =</span> <span class="st">&quot;logit&quot;</span>, <span class="at">replace =</span> <span class="cn">TRUE</span>, <span class="at">pop.size =</span> <span class="dv">100</span>)</span>
<span id="cb338-3"><a href="lalonde-nsw-data.html#cb338-3" tabindex="-1"></a>m.out.psid.genetic <span class="ot">&lt;-</span> <span class="fu">matchit</span>(model, <span class="at">data =</span> nsw_psid, <span class="at">method =</span> <span class="st">&quot;genetic&quot;</span>, <span class="at">distance =</span> <span class="st">&quot;logit&quot;</span>, <span class="at">replace =</span> <span class="cn">TRUE</span>, <span class="at">pop.size =</span> <span class="dv">100</span>)</span></code></pre></div>
</div>
</div>
<div id="stratum-matching-1" class="section level4 hasAnchor" number="3.3.1.2">
<h4><span class="header-section-number">3.3.1.2</span> Stratum matching<a href="lalonde-nsw-data.html#stratum-matching-1" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<div id="exact-matching-exact-1" class="section level5 hasAnchor" number="3.3.1.2.1">
<h5><span class="header-section-number">3.3.1.2.1</span> Exact matching (exact)<a href="lalonde-nsw-data.html#exact-matching-exact-1" class="anchor-section" aria-label="Anchor link to header"></a></h5>
<p>Strata = unique covariate profiles (raw covariates)</p>
<div class="sourceCode" id="cb339"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb339-1"><a href="lalonde-nsw-data.html#cb339-1" tabindex="-1"></a><span class="co"># match units exactly by raw covariate profiles </span></span>
<span id="cb339-2"><a href="lalonde-nsw-data.html#cb339-2" tabindex="-1"></a>m.out.cps.exact <span class="ot">&lt;-</span> <span class="fu">matchit</span>(model, <span class="at">data =</span> nsw_cps, <span class="at">method =</span> <span class="st">&quot;exact&quot;</span>)</span>
<span id="cb339-3"><a href="lalonde-nsw-data.html#cb339-3" tabindex="-1"></a>m.out.psid.exact <span class="ot">&lt;-</span> <span class="fu">matchit</span>(model, <span class="at">data =</span> nsw_psid, <span class="at">method =</span> <span class="st">&quot;exact&quot;</span>)</span></code></pre></div>
</div>
<div id="coarsened-matching-cem-1" class="section level5 hasAnchor" number="3.3.1.2.2">
<h5><span class="header-section-number">3.3.1.2.2</span> Coarsened matching (cem)<a href="lalonde-nsw-data.html#coarsened-matching-cem-1" class="anchor-section" aria-label="Anchor link to header"></a></h5>
<p>Strata = coarsened versions of covariates</p>
<div class="sourceCode" id="cb340"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb340-1"><a href="lalonde-nsw-data.html#cb340-1" tabindex="-1"></a><span class="co"># match units exactly within coarse strata </span></span>
<span id="cb340-2"><a href="lalonde-nsw-data.html#cb340-2" tabindex="-1"></a>m.out.cps.cem <span class="ot">&lt;-</span> <span class="fu">matchit</span>(model, <span class="at">data =</span> nsw_cps, <span class="at">method =</span> <span class="st">&quot;cem&quot;</span>)</span>
<span id="cb340-3"><a href="lalonde-nsw-data.html#cb340-3" tabindex="-1"></a>m.out.psid.cem <span class="ot">&lt;-</span> <span class="fu">matchit</span>(model, <span class="at">data =</span> nsw_psid, <span class="at">method =</span> <span class="st">&quot;cem&quot;</span>)</span></code></pre></div>
</div>
<div id="subclassification-1" class="section level5 hasAnchor" number="3.3.1.2.3">
<h5><span class="header-section-number">3.3.1.2.3</span> Subclassification<a href="lalonde-nsw-data.html#subclassification-1" class="anchor-section" aria-label="Anchor link to header"></a></h5>
<p>Strata = bins of the propensity score</p>
<div class="sourceCode" id="cb341"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb341-1"><a href="lalonde-nsw-data.html#cb341-1" tabindex="-1"></a><span class="co"># partition sample into fixed number of bins based on propensity score </span></span>
<span id="cb341-2"><a href="lalonde-nsw-data.html#cb341-2" tabindex="-1"></a>m.out.cps.subcl <span class="ot">&lt;-</span> <span class="fu">matchit</span>(model, <span class="at">data =</span> nsw_cps, <span class="at">method =</span> <span class="st">&quot;subclass&quot;</span>, <span class="at">subclass =</span> <span class="dv">5</span>)</span>
<span id="cb341-3"><a href="lalonde-nsw-data.html#cb341-3" tabindex="-1"></a>m.out.psid.subcl <span class="ot">&lt;-</span> <span class="fu">matchit</span>(model, <span class="at">data =</span> nsw_psid, <span class="at">method =</span> <span class="st">&quot;subclass&quot;</span>, <span class="at">subclass =</span> <span class="dv">5</span>)</span></code></pre></div>
</div>
</div>
<div id="pure-subset-selection-1" class="section level4 hasAnchor" number="3.3.1.3">
<h4><span class="header-section-number">3.3.1.3</span> Pure subset selection<a href="lalonde-nsw-data.html#pure-subset-selection-1" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<div id="cardinality-profile-matching-1" class="section level5 hasAnchor" number="3.3.1.3.1">
<h5><span class="header-section-number">3.3.1.3.1</span> Cardinality profile matching<a href="lalonde-nsw-data.html#cardinality-profile-matching-1" class="anchor-section" aria-label="Anchor link to header"></a></h5>
<div class="sourceCode" id="cb342"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb342-1"><a href="lalonde-nsw-data.html#cb342-1" tabindex="-1"></a><span class="co"># select largest balanced subsample meeting covariate balance tolerances and a fixed ratio of controls to treated units</span></span>
<span id="cb342-2"><a href="lalonde-nsw-data.html#cb342-2" tabindex="-1"></a>m.out.cps.card <span class="ot">&lt;-</span> <span class="fu">matchit</span>(model, <span class="at">data =</span> nsw_cps, <span class="at">method =</span> <span class="st">&quot;cardinality&quot;</span>, <span class="at">tols =</span> <span class="fl">0.1</span>, <span class="at">ratio =</span> <span class="dv">1</span>, <span class="at">time =</span> <span class="dv">1200</span>)</span>
<span id="cb342-3"><a href="lalonde-nsw-data.html#cb342-3" tabindex="-1"></a>m.out.psid.card <span class="ot">&lt;-</span> <span class="fu">matchit</span>(model, <span class="at">data =</span> nsw_psid, <span class="at">method =</span> <span class="st">&quot;cardinality&quot;</span>, <span class="at">tols =</span> <span class="fl">0.1</span>, <span class="at">ratio =</span> <span class="dv">1</span>, <span class="at">time =</span> <span class="dv">1200</span>)</span></code></pre></div>
</div>
<div id="profile-matching-1" class="section level5 hasAnchor" number="3.3.1.3.2">
<h5><span class="header-section-number">3.3.1.3.2</span> Profile matching<a href="lalonde-nsw-data.html#profile-matching-1" class="anchor-section" aria-label="Anchor link to header"></a></h5>
<div class="sourceCode" id="cb343"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb343-1"><a href="lalonde-nsw-data.html#cb343-1" tabindex="-1"></a><span class="co"># select the largest control group subset balanced to the treated group (for ATT), leaving the treated group intact</span></span>
<span id="cb343-2"><a href="lalonde-nsw-data.html#cb343-2" tabindex="-1"></a>m.out.cps.profile <span class="ot">&lt;-</span> <span class="fu">matchit</span>(model, <span class="at">data =</span> nsw_cps, <span class="at">method =</span> <span class="st">&quot;cardinality&quot;</span>, <span class="at">estimand =</span> <span class="st">&quot;ATT&quot;</span>, <span class="at">tols =</span> <span class="fl">0.1</span>, <span class="at">ratio =</span> <span class="cn">NA</span>, <span class="at">solver =</span> <span class="st">&quot;highs&quot;</span>, <span class="at">time =</span> <span class="dv">1200</span>)</span>
<span id="cb343-3"><a href="lalonde-nsw-data.html#cb343-3" tabindex="-1"></a>m.out.psid.profile <span class="ot">&lt;-</span> <span class="fu">matchit</span>(model, <span class="at">data =</span> nsw_psid, <span class="at">method =</span> <span class="st">&quot;cardinality&quot;</span>, <span class="at">estimand =</span> <span class="st">&quot;ATT&quot;</span>, <span class="at">tols =</span> <span class="fl">0.1</span>, <span class="at">ratio =</span> <span class="cn">NA</span>, <span class="at">solver =</span> <span class="st">&quot;highs&quot;</span>, <span class="at">time =</span> <span class="dv">1200</span>)</span></code></pre></div>
</div>
</div>
</div>
<div id="weighting-4" class="section level3 hasAnchor" number="3.3.2">
<h3><span class="header-section-number">3.3.2</span> Weighting<a href="lalonde-nsw-data.html#weighting-4" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div id="inverse-probability-weights-ipw-1" class="section level4 hasAnchor" number="3.3.2.1">
<h4><span class="header-section-number">3.3.2.1</span> Inverse probability weights (IPW)<a href="lalonde-nsw-data.html#inverse-probability-weights-ipw-1" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<div class="sourceCode" id="cb344"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb344-1"><a href="lalonde-nsw-data.html#cb344-1" tabindex="-1"></a><span class="co"># estimates propensity scores with a parametric generalized linear model and converts them into weights</span></span>
<span id="cb344-2"><a href="lalonde-nsw-data.html#cb344-2" tabindex="-1"></a>w.out.cps.ipw <span class="ot">&lt;-</span> WeightIt<span class="sc">::</span><span class="fu">weightit</span>(model, <span class="at">data =</span> nsw_cps, <span class="at">estimand =</span> <span class="st">&quot;ATT&quot;</span>, <span class="at">method =</span> <span class="st">&quot;glm&quot;</span>)</span>
<span id="cb344-3"><a href="lalonde-nsw-data.html#cb344-3" tabindex="-1"></a>nsw_cps<span class="sc">$</span>ipw_weight <span class="ot">&lt;-</span> w.out.cps.ipw<span class="sc">$</span>weights</span>
<span id="cb344-4"><a href="lalonde-nsw-data.html#cb344-4" tabindex="-1"></a>w.out.psid.ipw <span class="ot">&lt;-</span> WeightIt<span class="sc">::</span><span class="fu">weightit</span>(model, <span class="at">data =</span> nsw_psid, <span class="at">estimand =</span> <span class="st">&quot;ATT&quot;</span>, <span class="at">method =</span> <span class="st">&quot;glm&quot;</span>)</span>
<span id="cb344-5"><a href="lalonde-nsw-data.html#cb344-5" tabindex="-1"></a>nsw_psid<span class="sc">$</span>ipw_weight <span class="ot">&lt;-</span> w.out.psid.ipw<span class="sc">$</span>weights</span></code></pre></div>
</div>
<div id="stable-balancing-weights-1" class="section level4 hasAnchor" number="3.3.2.2">
<h4><span class="header-section-number">3.3.2.2</span> Stable balancing weights<a href="lalonde-nsw-data.html#stable-balancing-weights-1" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<div class="sourceCode" id="cb345"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb345-1"><a href="lalonde-nsw-data.html#cb345-1" tabindex="-1"></a><span class="co"># estimates weights by solving a quadratic programming problem </span></span>
<span id="cb345-2"><a href="lalonde-nsw-data.html#cb345-2" tabindex="-1"></a>w.out.cps.opt <span class="ot">&lt;-</span> optweight<span class="sc">::</span><span class="fu">optweight</span>(model, <span class="at">data =</span> nsw_cps, <span class="at">estimand =</span> <span class="st">&quot;ATT&quot;</span>)</span>
<span id="cb345-3"><a href="lalonde-nsw-data.html#cb345-3" tabindex="-1"></a>nsw_cps<span class="sc">$</span>opt_weight <span class="ot">&lt;-</span> w.out.cps.opt<span class="sc">$</span>weights</span>
<span id="cb345-4"><a href="lalonde-nsw-data.html#cb345-4" tabindex="-1"></a>w.out.psid.opt <span class="ot">&lt;-</span> optweight<span class="sc">::</span><span class="fu">optweight</span>(model, <span class="at">data =</span> nsw_psid, <span class="at">estimand =</span> <span class="st">&quot;ATT&quot;</span>)</span>
<span id="cb345-5"><a href="lalonde-nsw-data.html#cb345-5" tabindex="-1"></a>nsw_psid<span class="sc">$</span>opt_weight <span class="ot">&lt;-</span> w.out.psid.opt<span class="sc">$</span>weights</span></code></pre></div>
</div>
<div id="covariate-balance-propensity-score-weights-1" class="section level4 hasAnchor" number="3.3.2.3">
<h4><span class="header-section-number">3.3.2.3</span> Covariate balance propensity score weights<a href="lalonde-nsw-data.html#covariate-balance-propensity-score-weights-1" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<div class="sourceCode" id="cb346"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb346-1"><a href="lalonde-nsw-data.html#cb346-1" tabindex="-1"></a><span class="co"># estimates propensity scores using generalized method of moments and then converts them into weights</span></span>
<span id="cb346-2"><a href="lalonde-nsw-data.html#cb346-2" tabindex="-1"></a>w.out.cps.cbps <span class="ot">&lt;-</span> WeightIt<span class="sc">::</span><span class="fu">weightit</span>(model, <span class="at">data =</span> nsw_cps, <span class="at">estimand =</span> <span class="st">&quot;ATT&quot;</span>, <span class="at">method =</span> <span class="st">&quot;cbps&quot;</span>)</span>
<span id="cb346-3"><a href="lalonde-nsw-data.html#cb346-3" tabindex="-1"></a>nsw_cps<span class="sc">$</span>cbps_weight <span class="ot">&lt;-</span> w.out.cps.cbps<span class="sc">$</span>weights</span>
<span id="cb346-4"><a href="lalonde-nsw-data.html#cb346-4" tabindex="-1"></a>w.out.psid.cbps <span class="ot">&lt;-</span> WeightIt<span class="sc">::</span><span class="fu">weightit</span>(model, <span class="at">data =</span> nsw_psid, <span class="at">estimand =</span> <span class="st">&quot;ATT&quot;</span>, <span class="at">method =</span> <span class="st">&quot;cbps&quot;</span>)</span>
<span id="cb346-5"><a href="lalonde-nsw-data.html#cb346-5" tabindex="-1"></a>nsw_psid<span class="sc">$</span>cbps_weight <span class="ot">&lt;-</span> w.out.psid.cbps<span class="sc">$</span>weights</span></code></pre></div>
</div>
<div id="entropy-balancing-weights-1" class="section level4 hasAnchor" number="3.3.2.4">
<h4><span class="header-section-number">3.3.2.4</span> Entropy balancing weights<a href="lalonde-nsw-data.html#entropy-balancing-weights-1" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<div class="sourceCode" id="cb347"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb347-1"><a href="lalonde-nsw-data.html#cb347-1" tabindex="-1"></a><span class="co"># estimates weights by minimizing the negative entropy of the weights subject to exact moment balancing constraints</span></span>
<span id="cb347-2"><a href="lalonde-nsw-data.html#cb347-2" tabindex="-1"></a>w.out.cps.ebal <span class="ot">&lt;-</span> WeightIt<span class="sc">::</span><span class="fu">weightit</span>(model, <span class="at">data =</span> nsw_cps, <span class="at">estimand =</span> <span class="st">&quot;ATT&quot;</span>, <span class="at">method =</span> <span class="st">&quot;ebal&quot;</span>)</span>
<span id="cb347-3"><a href="lalonde-nsw-data.html#cb347-3" tabindex="-1"></a>nsw_cps<span class="sc">$</span>ebal_weight <span class="ot">&lt;-</span> w.out.cps.ebal<span class="sc">$</span>weights</span>
<span id="cb347-4"><a href="lalonde-nsw-data.html#cb347-4" tabindex="-1"></a>w.out.psid.ebal <span class="ot">&lt;-</span> WeightIt<span class="sc">::</span><span class="fu">weightit</span>(model, <span class="at">data =</span> nsw_psid, <span class="at">estimand =</span> <span class="st">&quot;ATT&quot;</span>, <span class="at">method =</span> <span class="st">&quot;ebal&quot;</span>)</span>
<span id="cb347-5"><a href="lalonde-nsw-data.html#cb347-5" tabindex="-1"></a>nsw_psid<span class="sc">$</span>ebal_weight <span class="ot">&lt;-</span> w.out.psid.ebal<span class="sc">$</span>weights</span></code></pre></div>
</div>
</div>
</div>
<div id="improving-primarily-overlap-1" class="section level2 hasAnchor" number="3.4">
<h2><span class="header-section-number">3.4</span> Improving primarily overlap<a href="lalonde-nsw-data.html#improving-primarily-overlap-1" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div id="truncation-4" class="section level3 hasAnchor" number="3.4.1">
<h3><span class="header-section-number">3.4.1</span> Truncation<a href="lalonde-nsw-data.html#truncation-4" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb348"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb348-1"><a href="lalonde-nsw-data.html#cb348-1" tabindex="-1"></a><span class="co"># list weight columns to apply truncation </span></span>
<span id="cb348-2"><a href="lalonde-nsw-data.html#cb348-2" tabindex="-1"></a>weight_columns <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;ipw_weight&quot;</span>, <span class="st">&quot;opt_weight&quot;</span>, <span class="st">&quot;cbps_weight&quot;</span>, <span class="st">&quot;ebal_weight&quot;</span>)</span></code></pre></div>
<div id="fixed-maximum-value-truncation-1" class="section level4 hasAnchor" number="3.4.1.1">
<h4><span class="header-section-number">3.4.1.1</span> Fixed maximum value truncation<a href="lalonde-nsw-data.html#fixed-maximum-value-truncation-1" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<div class="sourceCode" id="cb349"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb349-1"><a href="lalonde-nsw-data.html#cb349-1" tabindex="-1"></a><span class="co"># truncate weights by imposing a minimum and maximum threshold</span></span>
<span id="cb349-2"><a href="lalonde-nsw-data.html#cb349-2" tabindex="-1"></a>nsw_cps.fixed <span class="ot">&lt;-</span> nsw_cps</span>
<span id="cb349-3"><a href="lalonde-nsw-data.html#cb349-3" tabindex="-1"></a><span class="cf">for</span> (wcol <span class="cf">in</span> weight_columns) {</span>
<span id="cb349-4"><a href="lalonde-nsw-data.html#cb349-4" tabindex="-1"></a>  <span class="cf">if</span> (wcol <span class="sc">%in%</span> <span class="fu">names</span>(nsw_cps.fixed)) {</span>
<span id="cb349-5"><a href="lalonde-nsw-data.html#cb349-5" tabindex="-1"></a>    nsw_cps.fixed <span class="ot">&lt;-</span> <span class="fu">truncate_weights_fixed</span>(nsw_cps.fixed, <span class="at">weight_col =</span> wcol, <span class="at">lower =</span> <span class="fl">0.025</span>, <span class="at">upper =</span> <span class="fl">0.975</span>)</span>
<span id="cb349-6"><a href="lalonde-nsw-data.html#cb349-6" tabindex="-1"></a>  }</span>
<span id="cb349-7"><a href="lalonde-nsw-data.html#cb349-7" tabindex="-1"></a>}</span>
<span id="cb349-8"><a href="lalonde-nsw-data.html#cb349-8" tabindex="-1"></a></span>
<span id="cb349-9"><a href="lalonde-nsw-data.html#cb349-9" tabindex="-1"></a>nsw_psid.fixed <span class="ot">&lt;-</span> nsw_psid</span>
<span id="cb349-10"><a href="lalonde-nsw-data.html#cb349-10" tabindex="-1"></a><span class="cf">for</span> (wcol <span class="cf">in</span> weight_columns) {</span>
<span id="cb349-11"><a href="lalonde-nsw-data.html#cb349-11" tabindex="-1"></a>  <span class="cf">if</span> (wcol <span class="sc">%in%</span> <span class="fu">names</span>(nsw_psid.fixed)) {</span>
<span id="cb349-12"><a href="lalonde-nsw-data.html#cb349-12" tabindex="-1"></a>    nsw_psid.fixed <span class="ot">&lt;-</span> <span class="fu">truncate_weights_fixed</span>(nsw_psid.fixed, <span class="at">weight_col =</span> wcol, <span class="at">lower =</span> <span class="fl">0.025</span>, <span class="at">upper =</span> <span class="fl">0.975</span>)</span>
<span id="cb349-13"><a href="lalonde-nsw-data.html#cb349-13" tabindex="-1"></a>  }</span>
<span id="cb349-14"><a href="lalonde-nsw-data.html#cb349-14" tabindex="-1"></a>}</span></code></pre></div>
</div>
<div id="at-percentile-truncation-1" class="section level4 hasAnchor" number="3.4.1.2">
<h4><span class="header-section-number">3.4.1.2</span> At percentile truncation<a href="lalonde-nsw-data.html#at-percentile-truncation-1" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<div class="sourceCode" id="cb350"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb350-1"><a href="lalonde-nsw-data.html#cb350-1" tabindex="-1"></a><span class="co"># truncate weights such that values below the 5th percentile and above the 95th percentile are capped</span></span>
<span id="cb350-2"><a href="lalonde-nsw-data.html#cb350-2" tabindex="-1"></a>nsw_cps.percent <span class="ot">&lt;-</span> nsw_cps</span>
<span id="cb350-3"><a href="lalonde-nsw-data.html#cb350-3" tabindex="-1"></a><span class="cf">for</span> (wcol <span class="cf">in</span> weight_columns) {</span>
<span id="cb350-4"><a href="lalonde-nsw-data.html#cb350-4" tabindex="-1"></a>  <span class="cf">if</span> (wcol <span class="sc">%in%</span> <span class="fu">names</span>(nsw_cps.percent)) {</span>
<span id="cb350-5"><a href="lalonde-nsw-data.html#cb350-5" tabindex="-1"></a>    nsw_cps.percent <span class="ot">&lt;-</span> <span class="fu">truncate_weights_percentile</span>(nsw_cps.percent, <span class="at">weight_col =</span> wcol, <span class="at">lower =</span> <span class="fl">0.01</span>, <span class="at">upper =</span> <span class="fl">0.99</span>)</span>
<span id="cb350-6"><a href="lalonde-nsw-data.html#cb350-6" tabindex="-1"></a>  }</span>
<span id="cb350-7"><a href="lalonde-nsw-data.html#cb350-7" tabindex="-1"></a>}</span>
<span id="cb350-8"><a href="lalonde-nsw-data.html#cb350-8" tabindex="-1"></a></span>
<span id="cb350-9"><a href="lalonde-nsw-data.html#cb350-9" tabindex="-1"></a>nsw_psid.percent <span class="ot">&lt;-</span> nsw_psid</span>
<span id="cb350-10"><a href="lalonde-nsw-data.html#cb350-10" tabindex="-1"></a><span class="cf">for</span> (wcol <span class="cf">in</span> weight_columns) {</span>
<span id="cb350-11"><a href="lalonde-nsw-data.html#cb350-11" tabindex="-1"></a>  <span class="cf">if</span> (wcol <span class="sc">%in%</span> <span class="fu">names</span>(nsw_psid.percent)) {</span>
<span id="cb350-12"><a href="lalonde-nsw-data.html#cb350-12" tabindex="-1"></a>    nsw_psid.percent <span class="ot">&lt;-</span> <span class="fu">truncate_weights_percentile</span>(nsw_psid.percent, <span class="at">weight_col =</span> wcol, <span class="at">lower =</span> <span class="fl">0.01</span>, <span class="at">upper =</span> <span class="fl">0.99</span>)</span>
<span id="cb350-13"><a href="lalonde-nsw-data.html#cb350-13" tabindex="-1"></a>  }</span>
<span id="cb350-14"><a href="lalonde-nsw-data.html#cb350-14" tabindex="-1"></a>}</span></code></pre></div>
</div>
<div id="adaptive-weight-truncation-1" class="section level4 hasAnchor" number="3.4.1.3">
<h4><span class="header-section-number">3.4.1.3</span> Adaptive weight truncation<a href="lalonde-nsw-data.html#adaptive-weight-truncation-1" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<div class="sourceCode" id="cb351"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb351-1"><a href="lalonde-nsw-data.html#cb351-1" tabindex="-1"></a><span class="co"># inspect variance of weights </span></span>
<span id="cb351-2"><a href="lalonde-nsw-data.html#cb351-2" tabindex="-1"></a>cps_results <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb351-3"><a href="lalonde-nsw-data.html#cb351-3" tabindex="-1"></a>psid_results <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb351-4"><a href="lalonde-nsw-data.html#cb351-4" tabindex="-1"></a></span>
<span id="cb351-5"><a href="lalonde-nsw-data.html#cb351-5" tabindex="-1"></a><span class="cf">for</span> (wcol <span class="cf">in</span> weight_columns) {</span>
<span id="cb351-6"><a href="lalonde-nsw-data.html#cb351-6" tabindex="-1"></a>  <span class="cf">if</span> (wcol <span class="sc">%in%</span> <span class="fu">names</span>(nsw_cps)) {</span>
<span id="cb351-7"><a href="lalonde-nsw-data.html#cb351-7" tabindex="-1"></a>    cps_results[[<span class="fu">paste0</span>(<span class="st">&quot;cps_&quot;</span>, wcol)]] <span class="ot">&lt;-</span> <span class="fu">check_weights</span>(nsw_cps, wcol)</span>
<span id="cb351-8"><a href="lalonde-nsw-data.html#cb351-8" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb351-9"><a href="lalonde-nsw-data.html#cb351-9" tabindex="-1"></a>    <span class="fu">warning</span>(<span class="fu">paste</span>(<span class="st">&quot;Column&quot;</span>, wcol, <span class="st">&quot;not found in NSW-CPS1&quot;</span>))</span>
<span id="cb351-10"><a href="lalonde-nsw-data.html#cb351-10" tabindex="-1"></a>  }</span>
<span id="cb351-11"><a href="lalonde-nsw-data.html#cb351-11" tabindex="-1"></a>}</span>
<span id="cb351-12"><a href="lalonde-nsw-data.html#cb351-12" tabindex="-1"></a></span>
<span id="cb351-13"><a href="lalonde-nsw-data.html#cb351-13" tabindex="-1"></a><span class="cf">for</span> (wcol <span class="cf">in</span> weight_columns) {</span>
<span id="cb351-14"><a href="lalonde-nsw-data.html#cb351-14" tabindex="-1"></a>  <span class="cf">if</span> (wcol <span class="sc">%in%</span> <span class="fu">names</span>(nsw_psid)) {</span>
<span id="cb351-15"><a href="lalonde-nsw-data.html#cb351-15" tabindex="-1"></a>    psid_results[[<span class="fu">paste0</span>(<span class="st">&quot;psid_&quot;</span>, wcol)]] <span class="ot">&lt;-</span> <span class="fu">check_weights</span>(nsw_psid, wcol)</span>
<span id="cb351-16"><a href="lalonde-nsw-data.html#cb351-16" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb351-17"><a href="lalonde-nsw-data.html#cb351-17" tabindex="-1"></a>    <span class="fu">warning</span>(<span class="fu">paste</span>(<span class="st">&quot;Column&quot;</span>, wcol, <span class="st">&quot;not found in NSW-PSID1&quot;</span>))</span>
<span id="cb351-18"><a href="lalonde-nsw-data.html#cb351-18" tabindex="-1"></a>  }</span>
<span id="cb351-19"><a href="lalonde-nsw-data.html#cb351-19" tabindex="-1"></a>}</span>
<span id="cb351-20"><a href="lalonde-nsw-data.html#cb351-20" tabindex="-1"></a></span>
<span id="cb351-21"><a href="lalonde-nsw-data.html#cb351-21" tabindex="-1"></a>var_cps_table <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(cps_results)</span>
<span id="cb351-22"><a href="lalonde-nsw-data.html#cb351-22" tabindex="-1"></a>var_psid_table <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(psid_results)</span>
<span id="cb351-23"><a href="lalonde-nsw-data.html#cb351-23" tabindex="-1"></a></span>
<span id="cb351-24"><a href="lalonde-nsw-data.html#cb351-24" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">kable</span>(var_cps_table, <span class="at">caption =</span> <span class="st">&quot;Variance of Weights (NSW-CPS1)&quot;</span>)</span></code></pre></div>
<table>
<caption><span id="tab:unnamed-chunk-214">Table 3.2: </span>Variance of Weights (NSW-CPS1)</caption>
<thead>
<tr class="header">
<th align="left">Weight_Column</th>
<th align="right">Variance</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">ipw_weight</td>
<td align="right">2.896830e-02</td>
</tr>
<tr class="even">
<td align="left">opt_weight</td>
<td align="right">8.223537e+16</td>
</tr>
<tr class="odd">
<td align="left">cbps_weight</td>
<td align="right">2.764510e-02</td>
</tr>
<tr class="even">
<td align="left">ebal_weight</td>
<td align="right">3.016606e+01</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb352"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb352-1"><a href="lalonde-nsw-data.html#cb352-1" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">kable</span>(var_psid_table, <span class="at">caption =</span> <span class="st">&quot;Variance of Weights (NSW-PSID1)&quot;</span>)</span></code></pre></div>
<table>
<caption><span id="tab:unnamed-chunk-214">Table 3.2: </span>Variance of Weights (NSW-PSID1)</caption>
<thead>
<tr class="header">
<th align="left">Weight_Column</th>
<th align="right">Variance</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">ipw_weight</td>
<td align="right">0.6650298</td>
</tr>
<tr class="even">
<td align="left">opt_weight</td>
<td align="right">23.2087737</td>
</tr>
<tr class="odd">
<td align="left">cbps_weight</td>
<td align="right">0.5383566</td>
</tr>
<tr class="even">
<td align="left">ebal_weight</td>
<td align="right">32.8004541</td>
</tr>
</tbody>
</table>
<p>Regarding these results we apply adaptive weight truncation to all considered weights.</p>
<div class="sourceCode" id="cb353"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb353-1"><a href="lalonde-nsw-data.html#cb353-1" tabindex="-1"></a><span class="co"># truncate adaptively at mean + 3 standard deviations </span></span>
<span id="cb353-2"><a href="lalonde-nsw-data.html#cb353-2" tabindex="-1"></a>nsw_cps.adapt <span class="ot">&lt;-</span> nsw_cps</span>
<span id="cb353-3"><a href="lalonde-nsw-data.html#cb353-3" tabindex="-1"></a><span class="cf">for</span> (wcol <span class="cf">in</span> weight_columns) {</span>
<span id="cb353-4"><a href="lalonde-nsw-data.html#cb353-4" tabindex="-1"></a>  <span class="cf">if</span> (wcol <span class="sc">%in%</span> <span class="fu">names</span>(nsw_cps.adapt)) {</span>
<span id="cb353-5"><a href="lalonde-nsw-data.html#cb353-5" tabindex="-1"></a>    nsw_cps.adapt <span class="ot">&lt;-</span> <span class="fu">truncate_weights_adaptive</span>(nsw_cps.adapt, <span class="at">weight_col =</span> wcol, <span class="at">c =</span> <span class="dv">3</span>)</span>
<span id="cb353-6"><a href="lalonde-nsw-data.html#cb353-6" tabindex="-1"></a>  }</span>
<span id="cb353-7"><a href="lalonde-nsw-data.html#cb353-7" tabindex="-1"></a>}</span>
<span id="cb353-8"><a href="lalonde-nsw-data.html#cb353-8" tabindex="-1"></a></span>
<span id="cb353-9"><a href="lalonde-nsw-data.html#cb353-9" tabindex="-1"></a>nsw_psid.adapt <span class="ot">&lt;-</span> nsw_psid</span>
<span id="cb353-10"><a href="lalonde-nsw-data.html#cb353-10" tabindex="-1"></a><span class="cf">for</span> (wcol <span class="cf">in</span> weight_columns) {</span>
<span id="cb353-11"><a href="lalonde-nsw-data.html#cb353-11" tabindex="-1"></a>  <span class="cf">if</span> (wcol <span class="sc">%in%</span> <span class="fu">names</span>(nsw_psid.adapt)) {</span>
<span id="cb353-12"><a href="lalonde-nsw-data.html#cb353-12" tabindex="-1"></a>    nsw_psid.adapt <span class="ot">&lt;-</span> <span class="fu">truncate_weights_adaptive</span>(nsw_psid.adapt, <span class="at">weight_col =</span> wcol, <span class="at">c =</span> <span class="dv">3</span>)</span>
<span id="cb353-13"><a href="lalonde-nsw-data.html#cb353-13" tabindex="-1"></a>  }</span>
<span id="cb353-14"><a href="lalonde-nsw-data.html#cb353-14" tabindex="-1"></a>}</span></code></pre></div>
</div>
</div>
<div id="trimming-4" class="section level3 hasAnchor" number="3.4.2">
<h3><span class="header-section-number">3.4.2</span> Trimming<a href="lalonde-nsw-data.html#trimming-4" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div id="propensity-score-threshold-trimming-2" class="section level4 hasAnchor" number="3.4.2.1">
<h4><span class="header-section-number">3.4.2.1</span> Propensity score threshold trimming<a href="lalonde-nsw-data.html#propensity-score-threshold-trimming-2" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<div class="sourceCode" id="cb354"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb354-1"><a href="lalonde-nsw-data.html#cb354-1" tabindex="-1"></a><span class="co"># apply trimming with threshold 0.9</span></span>
<span id="cb354-2"><a href="lalonde-nsw-data.html#cb354-2" tabindex="-1"></a>nsw_cps.trim <span class="ot">&lt;-</span> <span class="fu">ps_trim</span>(nsw_cps.ps, <span class="at">threshold =</span> <span class="fl">0.9</span>)</span>
<span id="cb354-3"><a href="lalonde-nsw-data.html#cb354-3" tabindex="-1"></a>nsw_psid.trim <span class="ot">&lt;-</span> <span class="fu">ps_trim</span>(nsw_psid.ps, <span class="at">threshold =</span> <span class="fl">0.9</span>)</span>
<span id="cb354-4"><a href="lalonde-nsw-data.html#cb354-4" tabindex="-1"></a></span>
<span id="cb354-5"><a href="lalonde-nsw-data.html#cb354-5" tabindex="-1"></a><span class="co"># re-estimate propensity scores on trimmed data </span></span>
<span id="cb354-6"><a href="lalonde-nsw-data.html#cb354-6" tabindex="-1"></a>nsw_cps.trim <span class="ot">&lt;-</span> <span class="fu">ps_estimate</span>(<span class="at">data =</span> nsw_cps.trim, <span class="at">Y =</span> <span class="st">&quot;re78&quot;</span>, <span class="at">treat =</span> <span class="st">&quot;treat&quot;</span>, <span class="at">cov =</span> covar)</span>
<span id="cb354-7"><a href="lalonde-nsw-data.html#cb354-7" tabindex="-1"></a>nsw_psid.trim <span class="ot">&lt;-</span> <span class="fu">ps_estimate</span>(<span class="at">data =</span> nsw_psid.trim, <span class="at">Y =</span> <span class="st">&quot;re78&quot;</span>, <span class="at">treat =</span> <span class="st">&quot;treat&quot;</span>, <span class="at">cov =</span> covar)</span></code></pre></div>
</div>
<div id="common-range-trimming-1" class="section level4 hasAnchor" number="3.4.2.2">
<h4><span class="header-section-number">3.4.2.2</span> Common range trimming<a href="lalonde-nsw-data.html#common-range-trimming-1" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<div class="sourceCode" id="cb355"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb355-1"><a href="lalonde-nsw-data.html#cb355-1" tabindex="-1"></a><span class="co"># trim observations outside the common support region of propensity scores</span></span>
<span id="cb355-2"><a href="lalonde-nsw-data.html#cb355-2" tabindex="-1"></a>nsw_cps.common   <span class="ot">&lt;-</span> <span class="fu">common_range_trim</span>(nsw_cps.ps)</span>
<span id="cb355-3"><a href="lalonde-nsw-data.html#cb355-3" tabindex="-1"></a>nsw_psid.common  <span class="ot">&lt;-</span> <span class="fu">common_range_trim</span>(nsw_psid.ps)</span>
<span id="cb355-4"><a href="lalonde-nsw-data.html#cb355-4" tabindex="-1"></a></span>
<span id="cb355-5"><a href="lalonde-nsw-data.html#cb355-5" tabindex="-1"></a><span class="co"># re-estimate propensity scores on trimmed data </span></span>
<span id="cb355-6"><a href="lalonde-nsw-data.html#cb355-6" tabindex="-1"></a>nsw_cps.common <span class="ot">&lt;-</span> <span class="fu">ps_estimate</span>(<span class="at">data =</span> nsw_cps.common, <span class="at">Y =</span> <span class="st">&quot;re78&quot;</span>, <span class="at">treat =</span> <span class="st">&quot;treat&quot;</span>, <span class="at">cov =</span> covar)</span>
<span id="cb355-7"><a href="lalonde-nsw-data.html#cb355-7" tabindex="-1"></a>nsw_psid.common <span class="ot">&lt;-</span> <span class="fu">ps_estimate</span>(<span class="at">data =</span> nsw_psid.common, <span class="at">Y =</span> <span class="st">&quot;re78&quot;</span>, <span class="at">treat =</span> <span class="st">&quot;treat&quot;</span>, <span class="at">cov =</span> covar)</span></code></pre></div>
</div>
<div id="crump-trimming-1" class="section level4 hasAnchor" number="3.4.2.3">
<h4><span class="header-section-number">3.4.2.3</span> Crump trimming<a href="lalonde-nsw-data.html#crump-trimming-1" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<div class="sourceCode" id="cb356"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb356-1"><a href="lalonde-nsw-data.html#cb356-1" tabindex="-1"></a><span class="co"># trim observations with propensity scores outside [0.1, 0.9] interval</span></span>
<span id="cb356-2"><a href="lalonde-nsw-data.html#cb356-2" tabindex="-1"></a>nsw_cps.crump  <span class="ot">&lt;-</span> <span class="fu">crump_trim</span>(nsw_cps.ps, <span class="at">lower =</span> <span class="fl">0.1</span>, <span class="at">upper =</span> <span class="fl">0.9</span>)</span>
<span id="cb356-3"><a href="lalonde-nsw-data.html#cb356-3" tabindex="-1"></a>nsw_psid.crump <span class="ot">&lt;-</span> <span class="fu">crump_trim</span>(nsw_psid.ps, <span class="at">lower =</span> <span class="fl">0.1</span>, <span class="at">upper =</span> <span class="fl">0.9</span>)</span>
<span id="cb356-4"><a href="lalonde-nsw-data.html#cb356-4" tabindex="-1"></a></span>
<span id="cb356-5"><a href="lalonde-nsw-data.html#cb356-5" tabindex="-1"></a><span class="co"># re-estimate propensity scores on trimmed data </span></span>
<span id="cb356-6"><a href="lalonde-nsw-data.html#cb356-6" tabindex="-1"></a>nsw_cps.crump <span class="ot">&lt;-</span> <span class="fu">ps_estimate</span>(<span class="at">data =</span> nsw_cps.crump, <span class="at">Y =</span> <span class="st">&quot;re78&quot;</span>, <span class="at">treat =</span> <span class="st">&quot;treat&quot;</span>, <span class="at">cov =</span> covar)</span>
<span id="cb356-7"><a href="lalonde-nsw-data.html#cb356-7" tabindex="-1"></a>nsw_psid.crump <span class="ot">&lt;-</span> <span class="fu">ps_estimate</span>(<span class="at">data =</span> nsw_psid.crump, <span class="at">Y =</span> <span class="st">&quot;re78&quot;</span>, <span class="at">treat =</span> <span class="st">&quot;treat&quot;</span>, <span class="at">cov =</span> covar)</span></code></pre></div>
</div>
<div id="stuermer-trimming-1" class="section level4 hasAnchor" number="3.4.2.4">
<h4><span class="header-section-number">3.4.2.4</span> Stuermer trimming<a href="lalonde-nsw-data.html#stuermer-trimming-1" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<div class="sourceCode" id="cb357"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb357-1"><a href="lalonde-nsw-data.html#cb357-1" tabindex="-1"></a><span class="co"># trim observations based on propensity score quantiles separately for treated and control</span></span>
<span id="cb357-2"><a href="lalonde-nsw-data.html#cb357-2" tabindex="-1"></a>nsw_cps.stuermer  <span class="ot">&lt;-</span> <span class="fu">stuermer_trim</span>(nsw_cps.ps)</span>
<span id="cb357-3"><a href="lalonde-nsw-data.html#cb357-3" tabindex="-1"></a>nsw_psid.stuermer <span class="ot">&lt;-</span> <span class="fu">stuermer_trim</span>(nsw_psid.ps)</span>
<span id="cb357-4"><a href="lalonde-nsw-data.html#cb357-4" tabindex="-1"></a></span>
<span id="cb357-5"><a href="lalonde-nsw-data.html#cb357-5" tabindex="-1"></a><span class="co"># re-estimate propensity scores on trimmed data </span></span>
<span id="cb357-6"><a href="lalonde-nsw-data.html#cb357-6" tabindex="-1"></a>nsw_cps.stuermer <span class="ot">&lt;-</span> <span class="fu">ps_estimate</span>(<span class="at">data =</span> nsw_cps.stuermer, <span class="at">Y =</span> <span class="st">&quot;re78&quot;</span>, <span class="at">treat =</span> <span class="st">&quot;treat&quot;</span>, <span class="at">cov =</span> covar)</span>
<span id="cb357-7"><a href="lalonde-nsw-data.html#cb357-7" tabindex="-1"></a>nsw_psid.stuermer <span class="ot">&lt;-</span> <span class="fu">ps_estimate</span>(<span class="at">data =</span> nsw_psid.stuermer, <span class="at">Y =</span> <span class="st">&quot;re78&quot;</span>, <span class="at">treat =</span> <span class="st">&quot;treat&quot;</span>, <span class="at">cov =</span> covar)</span></code></pre></div>
</div>
<div id="walker-trimming-1" class="section level4 hasAnchor" number="3.4.2.5">
<h4><span class="header-section-number">3.4.2.5</span> Walker trimming<a href="lalonde-nsw-data.html#walker-trimming-1" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<div class="sourceCode" id="cb358"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb358-1"><a href="lalonde-nsw-data.html#cb358-1" tabindex="-1"></a><span class="co"># trim observations based on preference scores that adjust for treatment prevalence using logit transformations</span></span>
<span id="cb358-2"><a href="lalonde-nsw-data.html#cb358-2" tabindex="-1"></a>nsw_cps.walker   <span class="ot">&lt;-</span> <span class="fu">walker_trim</span>(nsw_cps.ps)</span>
<span id="cb358-3"><a href="lalonde-nsw-data.html#cb358-3" tabindex="-1"></a>nsw_psid.walker  <span class="ot">&lt;-</span> <span class="fu">walker_trim</span>(nsw_psid.ps)</span>
<span id="cb358-4"><a href="lalonde-nsw-data.html#cb358-4" tabindex="-1"></a></span>
<span id="cb358-5"><a href="lalonde-nsw-data.html#cb358-5" tabindex="-1"></a><span class="co"># re-estimate propensity scores on trimmed data </span></span>
<span id="cb358-6"><a href="lalonde-nsw-data.html#cb358-6" tabindex="-1"></a>nsw_cps.walker <span class="ot">&lt;-</span> <span class="fu">ps_estimate</span>(<span class="at">data =</span> nsw_cps.walker, <span class="at">Y =</span> <span class="st">&quot;re78&quot;</span>, <span class="at">treat =</span> <span class="st">&quot;treat&quot;</span>, <span class="at">cov =</span> covar)</span>
<span id="cb358-7"><a href="lalonde-nsw-data.html#cb358-7" tabindex="-1"></a>nsw_psid.walker <span class="ot">&lt;-</span> <span class="fu">ps_estimate</span>(<span class="at">data =</span> nsw_psid.walker, <span class="at">Y =</span> <span class="st">&quot;re78&quot;</span>, <span class="at">treat =</span> <span class="st">&quot;treat&quot;</span>, <span class="at">cov =</span> covar)</span></code></pre></div>
</div>
</div>
<div id="integrated-methods-2" class="section level3 hasAnchor" number="3.4.3">
<h3><span class="header-section-number">3.4.3</span> Integrated methods<a href="lalonde-nsw-data.html#integrated-methods-2" class="anchor-section" aria-label="Anchor link to header"></a></h3>
</div>
<div id="trimming-and-matching-2" class="section level3 hasAnchor" number="3.4.4">
<h3><span class="header-section-number">3.4.4</span> Trimming and matching<a href="lalonde-nsw-data.html#trimming-and-matching-2" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div id="propensity-score-threshold-trimming-3" class="section level4 hasAnchor" number="3.4.4.1">
<h4><span class="header-section-number">3.4.4.1</span> Propensity score threshold trimming<a href="lalonde-nsw-data.html#propensity-score-threshold-trimming-3" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>(Similar to tutorial by <span class="citation">Imbens and Xu (<a href="#ref-imbens2024">2024</a>)</span>)</p>
<div class="sourceCode" id="cb359"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb359-1"><a href="lalonde-nsw-data.html#cb359-1" tabindex="-1"></a>nsw_cps_trim <span class="ot">&lt;-</span> <span class="fu">ps_trim</span>(nsw_cps_plus.ps, <span class="at">threshold =</span> <span class="fl">0.85</span>)   </span>
<span id="cb359-2"><a href="lalonde-nsw-data.html#cb359-2" tabindex="-1"></a>nsw_psid_trim <span class="ot">&lt;-</span> <span class="fu">ps_trim</span>(nsw_psid_plus.ps, <span class="at">threshold =</span> <span class="fl">0.85</span>)</span>
<span id="cb359-3"><a href="lalonde-nsw-data.html#cb359-3" tabindex="-1"></a></span>
<span id="cb359-4"><a href="lalonde-nsw-data.html#cb359-4" tabindex="-1"></a><span class="co"># excluding the experimental controls</span></span>
<span id="cb359-5"><a href="lalonde-nsw-data.html#cb359-5" tabindex="-1"></a>nsw_cps_trim_match <span class="ot">&lt;-</span> <span class="fu">subset</span>(nsw_cps_trim, sample <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">3</span>) <span class="sc">&amp;</span> ps_assoverlap)</span>
<span id="cb359-6"><a href="lalonde-nsw-data.html#cb359-6" tabindex="-1"></a>nsw_psid_trim_match <span class="ot">&lt;-</span> <span class="fu">subset</span>(nsw_psid_trim, sample <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">4</span>) <span class="sc">&amp;</span> ps_assoverlap)</span>
<span id="cb359-7"><a href="lalonde-nsw-data.html#cb359-7" tabindex="-1"></a></span>
<span id="cb359-8"><a href="lalonde-nsw-data.html#cb359-8" tabindex="-1"></a><span class="co"># re-estimate propensity scores and employ 1:1 matching</span></span>
<span id="cb359-9"><a href="lalonde-nsw-data.html#cb359-9" tabindex="-1"></a>nsw_cps_trim_match <span class="ot">&lt;-</span> <span class="fu">psmatch</span>(<span class="at">data =</span> nsw_cps_trim_match, <span class="at">Y =</span> <span class="st">&quot;re78&quot;</span>, <span class="at">treat =</span> <span class="st">&quot;treat&quot;</span>, <span class="at">cov =</span> covar)</span>
<span id="cb359-10"><a href="lalonde-nsw-data.html#cb359-10" tabindex="-1"></a>nsw_psid_trim_match <span class="ot">&lt;-</span> <span class="fu">psmatch</span>(<span class="at">data =</span> nsw_psid_trim_match, <span class="at">Y =</span> <span class="st">&quot;re78&quot;</span>, <span class="at">treat =</span> <span class="st">&quot;treat&quot;</span>, <span class="at">cov =</span> covar)</span>
<span id="cb359-11"><a href="lalonde-nsw-data.html#cb359-11" tabindex="-1"></a></span>
<span id="cb359-12"><a href="lalonde-nsw-data.html#cb359-12" tabindex="-1"></a><span class="co"># further subset data and re-assign treat variable </span></span>
<span id="cb359-13"><a href="lalonde-nsw-data.html#cb359-13" tabindex="-1"></a>nsw_trim_cps <span class="ot">&lt;-</span> <span class="fu">subset</span>(nsw_cps_trim, sample <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="fl">0.5</span>))</span>
<span id="cb359-14"><a href="lalonde-nsw-data.html#cb359-14" tabindex="-1"></a>nsw_trim_cps<span class="sc">$</span>treat[<span class="fu">which</span>(nsw_trim_cps<span class="sc">$</span>sample <span class="sc">==</span> <span class="fl">0.5</span>)] <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb359-15"><a href="lalonde-nsw-data.html#cb359-15" tabindex="-1"></a></span>
<span id="cb359-16"><a href="lalonde-nsw-data.html#cb359-16" tabindex="-1"></a>nsw_trim_psid <span class="ot">&lt;-</span> <span class="fu">subset</span>(nsw_psid_trim, sample <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="fl">0.5</span>))</span>
<span id="cb359-17"><a href="lalonde-nsw-data.html#cb359-17" tabindex="-1"></a>nsw_trim_psid<span class="sc">$</span>treat[<span class="fu">which</span>(nsw_trim_psid<span class="sc">$</span>sample <span class="sc">==</span> <span class="fl">0.5</span>)] <span class="ot">&lt;-</span> <span class="dv">0</span></span></code></pre></div>
</div>
</div>
<div id="trimming-and-weighting-2" class="section level3 hasAnchor" number="3.4.5">
<h3><span class="header-section-number">3.4.5</span> Trimming and weighting<a href="lalonde-nsw-data.html#trimming-and-weighting-2" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb360"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb360-1"><a href="lalonde-nsw-data.html#cb360-1" tabindex="-1"></a><span class="co"># list trimming methods</span></span>
<span id="cb360-2"><a href="lalonde-nsw-data.html#cb360-2" tabindex="-1"></a>all_trim.cps  <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="at">ps_threshold =</span> nsw_cps.trim, </span>
<span id="cb360-3"><a href="lalonde-nsw-data.html#cb360-3" tabindex="-1"></a>                     <span class="at">common_range =</span> nsw_cps.common, </span>
<span id="cb360-4"><a href="lalonde-nsw-data.html#cb360-4" tabindex="-1"></a>                     <span class="at">stuermer =</span> nsw_cps.stuermer, </span>
<span id="cb360-5"><a href="lalonde-nsw-data.html#cb360-5" tabindex="-1"></a>                     <span class="at">walker =</span> nsw_cps.walker, </span>
<span id="cb360-6"><a href="lalonde-nsw-data.html#cb360-6" tabindex="-1"></a>                     <span class="at">crump =</span> nsw_cps.crump)</span>
<span id="cb360-7"><a href="lalonde-nsw-data.html#cb360-7" tabindex="-1"></a>all_trim.psid  <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="at">ps_threshold =</span> nsw_psid.trim, </span>
<span id="cb360-8"><a href="lalonde-nsw-data.html#cb360-8" tabindex="-1"></a>                     <span class="at">common_range =</span> nsw_psid.common, </span>
<span id="cb360-9"><a href="lalonde-nsw-data.html#cb360-9" tabindex="-1"></a>                     <span class="at">stuermer =</span> nsw_psid.stuermer, </span>
<span id="cb360-10"><a href="lalonde-nsw-data.html#cb360-10" tabindex="-1"></a>                     <span class="at">walker =</span> nsw_psid.walker, </span>
<span id="cb360-11"><a href="lalonde-nsw-data.html#cb360-11" tabindex="-1"></a>                     <span class="at">crump =</span> nsw_psid.crump)</span></code></pre></div>
<div id="ipw-with-1-propensity-threshold-2-common-range-3-stuermer-4-walker-5-crump-1" class="section level4 hasAnchor" number="3.4.5.1">
<h4><span class="header-section-number">3.4.5.1</span> IPW with 1) propensity threshold 2) common range 3) stuermer 4) walker 5) crump<a href="lalonde-nsw-data.html#ipw-with-1-propensity-threshold-2-common-range-3-stuermer-4-walker-5-crump-1" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<div class="sourceCode" id="cb361"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb361-1"><a href="lalonde-nsw-data.html#cb361-1" tabindex="-1"></a><span class="co"># apply inverse probability weighting (IPW) with trimming and attach IPW weights</span></span>
<span id="cb361-2"><a href="lalonde-nsw-data.html#cb361-2" tabindex="-1"></a>ipw_comb.cps <span class="ot">&lt;-</span> <span class="fu">trim_attach_weights</span>(all_trim.cps, model, <span class="st">&quot;ipw_weight&quot;</span>)</span>
<span id="cb361-3"><a href="lalonde-nsw-data.html#cb361-3" tabindex="-1"></a>ipw_comb.psid <span class="ot">&lt;-</span> <span class="fu">trim_attach_weights</span>(all_trim.psid, model, <span class="st">&quot;ipw_weight&quot;</span>)</span></code></pre></div>
</div>
<div id="stable-balancing-weights-with-1-propensity-threshold-2-common-range-3-stuermer-4-walker-5-crump-1" class="section level4 hasAnchor" number="3.4.5.2">
<h4><span class="header-section-number">3.4.5.2</span> Stable balancing weights with 1) propensity threshold 2) common range 3) stuermer 4) walker 5) crump<a href="lalonde-nsw-data.html#stable-balancing-weights-with-1-propensity-threshold-2-common-range-3-stuermer-4-walker-5-crump-1" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<div class="sourceCode" id="cb362"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb362-1"><a href="lalonde-nsw-data.html#cb362-1" tabindex="-1"></a><span class="co"># apply stable balancing with trimming and attach stable balance weights</span></span>
<span id="cb362-2"><a href="lalonde-nsw-data.html#cb362-2" tabindex="-1"></a>opt_comb.cps <span class="ot">&lt;-</span> <span class="fu">trim_attach_weights</span>(all_trim.cps, model, <span class="st">&quot;opt_weight&quot;</span>)</span>
<span id="cb362-3"><a href="lalonde-nsw-data.html#cb362-3" tabindex="-1"></a>opt_comb.psid <span class="ot">&lt;-</span> <span class="fu">trim_attach_weights</span>(all_trim.psid, model, <span class="st">&quot;opt_weight&quot;</span>)</span></code></pre></div>
</div>
<div id="propensity-score-weights-with-1-propensity-threshold-2-common-range-3-stuermer-4-walker-5-crump-1" class="section level4 hasAnchor" number="3.4.5.3">
<h4><span class="header-section-number">3.4.5.3</span> Propensity score weights with 1) propensity threshold 2) common range 3) stuermer 4) walker 5) crump<a href="lalonde-nsw-data.html#propensity-score-weights-with-1-propensity-threshold-2-common-range-3-stuermer-4-walker-5-crump-1" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<div class="sourceCode" id="cb363"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb363-1"><a href="lalonde-nsw-data.html#cb363-1" tabindex="-1"></a><span class="co"># apply propensity score weighting with trimming and attach propensity score weights</span></span>
<span id="cb363-2"><a href="lalonde-nsw-data.html#cb363-2" tabindex="-1"></a>cbps_comb.cps <span class="ot">&lt;-</span> <span class="fu">trim_attach_weights</span>(all_trim.cps, model, <span class="st">&quot;cbps_weight&quot;</span>)</span>
<span id="cb363-3"><a href="lalonde-nsw-data.html#cb363-3" tabindex="-1"></a>cbps_comb.psid <span class="ot">&lt;-</span> <span class="fu">trim_attach_weights</span>(all_trim.psid, model, <span class="st">&quot;cbps_weight&quot;</span>)</span></code></pre></div>
</div>
<div id="entropy-balancing-weights-with-1-propensity-threshold-2-common-range-3-stuermer-4-walker-5-crump-1" class="section level4 hasAnchor" number="3.4.5.4">
<h4><span class="header-section-number">3.4.5.4</span> Entropy balancing weights with 1) propensity threshold 2) common range 3) stuermer 4) walker 5) crump<a href="lalonde-nsw-data.html#entropy-balancing-weights-with-1-propensity-threshold-2-common-range-3-stuermer-4-walker-5-crump-1" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<div class="sourceCode" id="cb364"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb364-1"><a href="lalonde-nsw-data.html#cb364-1" tabindex="-1"></a><span class="co"># apply entropy balancing weights with trimming and attach entropy weights</span></span>
<span id="cb364-2"><a href="lalonde-nsw-data.html#cb364-2" tabindex="-1"></a>ebal_comb.cps <span class="ot">&lt;-</span> <span class="fu">trim_attach_weights</span>(all_trim.cps, model, <span class="st">&quot;ebal_weight&quot;</span>)</span>
<span id="cb364-3"><a href="lalonde-nsw-data.html#cb364-3" tabindex="-1"></a>ebal_comb.psid <span class="ot">&lt;-</span> <span class="fu">trim_attach_weights</span>(all_trim.psid, model, <span class="st">&quot;ebal_weight&quot;</span>)</span></code></pre></div>
</div>
</div>
</div>
<div id="reassessing-methods-2" class="section level2 hasAnchor" number="3.5">
<h2><span class="header-section-number">3.5</span> Reassessing methods<a href="lalonde-nsw-data.html#reassessing-methods-2" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div id="matching-5" class="section level3 hasAnchor" number="3.5.1">
<h3><span class="header-section-number">3.5.1</span> Matching<a href="lalonde-nsw-data.html#matching-5" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb365"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb365-1"><a href="lalonde-nsw-data.html#cb365-1" tabindex="-1"></a><span class="co"># list all matching objects</span></span>
<span id="cb365-2"><a href="lalonde-nsw-data.html#cb365-2" tabindex="-1"></a>all_match.cps <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb365-3"><a href="lalonde-nsw-data.html#cb365-3" tabindex="-1"></a>  <span class="at">nn =</span> m.out.cps.nearest,</span>
<span id="cb365-4"><a href="lalonde-nsw-data.html#cb365-4" tabindex="-1"></a>  <span class="at">k2 =</span> m.out.cps.k2,</span>
<span id="cb365-5"><a href="lalonde-nsw-data.html#cb365-5" tabindex="-1"></a>  <span class="at">k3 =</span> m.out.cps.k3,</span>
<span id="cb365-6"><a href="lalonde-nsw-data.html#cb365-6" tabindex="-1"></a>  <span class="at">caliper =</span> m.out.cps.caliper,</span>
<span id="cb365-7"><a href="lalonde-nsw-data.html#cb365-7" tabindex="-1"></a>  <span class="at">cS =</span> m.out.cps.cs,</span>
<span id="cb365-8"><a href="lalonde-nsw-data.html#cb365-8" tabindex="-1"></a>  <span class="at">mahvars =</span> m.out.cps.mahvars,</span>
<span id="cb365-9"><a href="lalonde-nsw-data.html#cb365-9" tabindex="-1"></a>  <span class="at">optimal_pair =</span> m.out.cps.optimal_pair,</span>
<span id="cb365-10"><a href="lalonde-nsw-data.html#cb365-10" tabindex="-1"></a>  <span class="at">optimal_full =</span> m.out.cps.optimal_full,</span>
<span id="cb365-11"><a href="lalonde-nsw-data.html#cb365-11" tabindex="-1"></a>  <span class="at">gen_full =</span> m.out.cps.general_full,</span>
<span id="cb365-12"><a href="lalonde-nsw-data.html#cb365-12" tabindex="-1"></a>  <span class="at">genetic =</span> m.out.cps.genetic,</span>
<span id="cb365-13"><a href="lalonde-nsw-data.html#cb365-13" tabindex="-1"></a>  <span class="at">exact =</span> m.out.cps.exact,</span>
<span id="cb365-14"><a href="lalonde-nsw-data.html#cb365-14" tabindex="-1"></a>  <span class="at">cem =</span> m.out.cps.cem,</span>
<span id="cb365-15"><a href="lalonde-nsw-data.html#cb365-15" tabindex="-1"></a>  <span class="at">card =</span> m.out.cps.card,</span>
<span id="cb365-16"><a href="lalonde-nsw-data.html#cb365-16" tabindex="-1"></a>  <span class="at">profile =</span> m.out.cps.profile,</span>
<span id="cb365-17"><a href="lalonde-nsw-data.html#cb365-17" tabindex="-1"></a>  <span class="at">subcl =</span> m.out.cps.subcl</span>
<span id="cb365-18"><a href="lalonde-nsw-data.html#cb365-18" tabindex="-1"></a>)</span>
<span id="cb365-19"><a href="lalonde-nsw-data.html#cb365-19" tabindex="-1"></a></span>
<span id="cb365-20"><a href="lalonde-nsw-data.html#cb365-20" tabindex="-1"></a>all_match.psid <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb365-21"><a href="lalonde-nsw-data.html#cb365-21" tabindex="-1"></a>  <span class="at">nn =</span> m.out.psid.nearest,</span>
<span id="cb365-22"><a href="lalonde-nsw-data.html#cb365-22" tabindex="-1"></a>  <span class="at">k2 =</span> m.out.psid.k2,</span>
<span id="cb365-23"><a href="lalonde-nsw-data.html#cb365-23" tabindex="-1"></a>  <span class="at">k3 =</span> m.out.psid.k3,</span>
<span id="cb365-24"><a href="lalonde-nsw-data.html#cb365-24" tabindex="-1"></a>  <span class="at">caliper =</span> m.out.psid.caliper,</span>
<span id="cb365-25"><a href="lalonde-nsw-data.html#cb365-25" tabindex="-1"></a>  <span class="at">cs =</span> m.out.psid.cs,</span>
<span id="cb365-26"><a href="lalonde-nsw-data.html#cb365-26" tabindex="-1"></a>  <span class="at">mahvars =</span> m.out.psid.mahvars,</span>
<span id="cb365-27"><a href="lalonde-nsw-data.html#cb365-27" tabindex="-1"></a>  <span class="at">optimal_pair =</span> m.out.psid.optimal_pair,</span>
<span id="cb365-28"><a href="lalonde-nsw-data.html#cb365-28" tabindex="-1"></a>  <span class="at">optimal_full =</span> m.out.psid.optimal_full,</span>
<span id="cb365-29"><a href="lalonde-nsw-data.html#cb365-29" tabindex="-1"></a>  <span class="at">gen_full =</span> m.out.psid.general_full,</span>
<span id="cb365-30"><a href="lalonde-nsw-data.html#cb365-30" tabindex="-1"></a>  <span class="at">genetic =</span> m.out.psid.genetic,</span>
<span id="cb365-31"><a href="lalonde-nsw-data.html#cb365-31" tabindex="-1"></a>  <span class="at">exact =</span> m.out.psid.exact,</span>
<span id="cb365-32"><a href="lalonde-nsw-data.html#cb365-32" tabindex="-1"></a>  <span class="at">cem =</span> m.out.psid.cem,</span>
<span id="cb365-33"><a href="lalonde-nsw-data.html#cb365-33" tabindex="-1"></a>  <span class="at">card =</span> m.out.psid.card,</span>
<span id="cb365-34"><a href="lalonde-nsw-data.html#cb365-34" tabindex="-1"></a>  <span class="at">profile =</span> m.out.psid.profile,</span>
<span id="cb365-35"><a href="lalonde-nsw-data.html#cb365-35" tabindex="-1"></a>  <span class="at">subcl =</span> m.out.psid.subcl</span>
<span id="cb365-36"><a href="lalonde-nsw-data.html#cb365-36" tabindex="-1"></a>)</span></code></pre></div>
<div id="smd-6" class="section level4 hasAnchor" number="3.5.1.1">
<h4><span class="header-section-number">3.5.1.1</span> SMD<a href="lalonde-nsw-data.html#smd-6" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<div class="sourceCode" id="cb366"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb366-1"><a href="lalonde-nsw-data.html#cb366-1" tabindex="-1"></a><span class="co"># compute absolute SMD</span></span>
<span id="cb366-2"><a href="lalonde-nsw-data.html#cb366-2" tabindex="-1"></a>smd_matchit.cps <span class="ot">&lt;-</span> <span class="fu">compute_abs_smd_matchit</span>(all_match.cps)</span>
<span id="cb366-3"><a href="lalonde-nsw-data.html#cb366-3" tabindex="-1"></a>smd_matchit.psid <span class="ot">&lt;-</span> <span class="fu">compute_abs_smd_matchit</span>(all_match.psid)</span></code></pre></div>
</div>
<div id="ess-6" class="section level4 hasAnchor" number="3.5.1.2">
<h4><span class="header-section-number">3.5.1.2</span> ESS<a href="lalonde-nsw-data.html#ess-6" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<div class="sourceCode" id="cb367"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb367-1"><a href="lalonde-nsw-data.html#cb367-1" tabindex="-1"></a><span class="co"># calculate balance statistics </span></span>
<span id="cb367-2"><a href="lalonde-nsw-data.html#cb367-2" tabindex="-1"></a>bal.cps <span class="ot">&lt;-</span> cobalt<span class="sc">::</span><span class="fu">bal.tab</span>(model, <span class="at">data =</span> nsw_cps, <span class="at">un =</span> <span class="cn">TRUE</span>, <span class="at">weights =</span> all_match.cps, <span class="at">s.d.denom =</span> <span class="st">&quot;treated&quot;</span>)</span>
<span id="cb367-3"><a href="lalonde-nsw-data.html#cb367-3" tabindex="-1"></a>bal.psid <span class="ot">&lt;-</span> cobalt<span class="sc">::</span><span class="fu">bal.tab</span>(model, <span class="at">data =</span> nsw_psid, <span class="at">un =</span> <span class="cn">TRUE</span>, <span class="at">weights =</span> all_match.psid, <span class="at">s.d.denom =</span> <span class="st">&quot;treated&quot;</span>)</span></code></pre></div>
<div class="sourceCode" id="cb368"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb368-1"><a href="lalonde-nsw-data.html#cb368-1" tabindex="-1"></a><span class="co"># compute ESS</span></span>
<span id="cb368-2"><a href="lalonde-nsw-data.html#cb368-2" tabindex="-1"></a>ess_matchit.cps <span class="ot">&lt;-</span> <span class="fu">compute_ess_matchit</span>(bal.cps)</span>
<span id="cb368-3"><a href="lalonde-nsw-data.html#cb368-3" tabindex="-1"></a>ess_matchit.psid <span class="ot">&lt;-</span> <span class="fu">compute_ess_matchit</span>(bal.psid)</span></code></pre></div>
</div>
<div id="visuals-6" class="section level4 hasAnchor" number="3.5.1.3">
<h4><span class="header-section-number">3.5.1.3</span> Visuals<a href="lalonde-nsw-data.html#visuals-6" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<div class="sourceCode" id="cb369"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb369-1"><a href="lalonde-nsw-data.html#cb369-1" tabindex="-1"></a><span class="co"># visualize covariate balance </span></span>
<span id="cb369-2"><a href="lalonde-nsw-data.html#cb369-2" tabindex="-1"></a><span class="fu">plot_matching_balance</span>(all_match.cps, <span class="at">title =</span> <span class="st">&quot;NSW-CPS1&quot;</span>)</span></code></pre></div>
<pre><code>## $nn</code></pre>
<div class="figure"><span style="display:block;" id="fig:unnamed-chunk-231-1"></span>
<img src="Outcome-Weights_files/figure-html/unnamed-chunk-231-1.png" alt="FIGUREC3." width="672" />
<p class="caption">
Figure 3.10: FIGUREC3.
</p>
</div>
<pre><code>## 
## $k2</code></pre>
<div class="figure"><span style="display:block;" id="fig:unnamed-chunk-231-2"></span>
<img src="Outcome-Weights_files/figure-html/unnamed-chunk-231-2.png" alt="FIGUREC3." width="672" />
<p class="caption">
Figure 3.11: FIGUREC3.
</p>
</div>
<pre><code>## 
## $k3</code></pre>
<div class="figure"><span style="display:block;" id="fig:unnamed-chunk-231-3"></span>
<img src="Outcome-Weights_files/figure-html/unnamed-chunk-231-3.png" alt="FIGUREC3." width="672" />
<p class="caption">
Figure 3.12: FIGUREC3.
</p>
</div>
<pre><code>## 
## $caliper</code></pre>
<div class="figure"><span style="display:block;" id="fig:unnamed-chunk-231-4"></span>
<img src="Outcome-Weights_files/figure-html/unnamed-chunk-231-4.png" alt="FIGUREC3." width="672" />
<p class="caption">
Figure 3.13: FIGUREC3.
</p>
</div>
<pre><code>## 
## $cS</code></pre>
<div class="figure"><span style="display:block;" id="fig:unnamed-chunk-231-5"></span>
<img src="Outcome-Weights_files/figure-html/unnamed-chunk-231-5.png" alt="FIGUREC3." width="672" />
<p class="caption">
Figure 3.14: FIGUREC3.
</p>
</div>
<pre><code>## 
## $mahvars</code></pre>
<div class="figure"><span style="display:block;" id="fig:unnamed-chunk-231-6"></span>
<img src="Outcome-Weights_files/figure-html/unnamed-chunk-231-6.png" alt="FIGUREC3." width="672" />
<p class="caption">
Figure 3.15: FIGUREC3.
</p>
</div>
<pre><code>## 
## $optimal_pair</code></pre>
<div class="figure"><span style="display:block;" id="fig:unnamed-chunk-231-7"></span>
<img src="Outcome-Weights_files/figure-html/unnamed-chunk-231-7.png" alt="FIGUREC3." width="672" />
<p class="caption">
Figure 3.16: FIGUREC3.
</p>
</div>
<pre><code>## 
## $optimal_full</code></pre>
<div class="figure"><span style="display:block;" id="fig:unnamed-chunk-231-8"></span>
<img src="Outcome-Weights_files/figure-html/unnamed-chunk-231-8.png" alt="FIGUREC3." width="672" />
<p class="caption">
Figure 3.17: FIGUREC3.
</p>
</div>
<pre><code>## 
## $gen_full</code></pre>
<div class="figure"><span style="display:block;" id="fig:unnamed-chunk-231-9"></span>
<img src="Outcome-Weights_files/figure-html/unnamed-chunk-231-9.png" alt="FIGUREC3." width="672" />
<p class="caption">
Figure 3.18: FIGUREC3.
</p>
</div>
<pre><code>## 
## $genetic</code></pre>
<div class="figure"><span style="display:block;" id="fig:unnamed-chunk-231-10"></span>
<img src="Outcome-Weights_files/figure-html/unnamed-chunk-231-10.png" alt="FIGUREC3." width="672" />
<p class="caption">
Figure 3.19: FIGUREC3.
</p>
</div>
<pre><code>## 
## $exact</code></pre>
<div class="figure"><span style="display:block;" id="fig:unnamed-chunk-231-11"></span>
<img src="Outcome-Weights_files/figure-html/unnamed-chunk-231-11.png" alt="FIGUREC3." width="672" />
<p class="caption">
Figure 3.20: FIGUREC3.
</p>
</div>
<pre><code>## 
## $cem</code></pre>
<div class="figure"><span style="display:block;" id="fig:unnamed-chunk-231-12"></span>
<img src="Outcome-Weights_files/figure-html/unnamed-chunk-231-12.png" alt="FIGUREC3." width="672" />
<p class="caption">
Figure 3.21: FIGUREC3.
</p>
</div>
<pre><code>## 
## $card</code></pre>
<div class="figure"><span style="display:block;" id="fig:unnamed-chunk-231-13"></span>
<img src="Outcome-Weights_files/figure-html/unnamed-chunk-231-13.png" alt="FIGUREC3." width="672" />
<p class="caption">
Figure 3.22: FIGUREC3.
</p>
</div>
<pre><code>## 
## $profile</code></pre>
<div class="figure"><span style="display:block;" id="fig:unnamed-chunk-231-14"></span>
<img src="Outcome-Weights_files/figure-html/unnamed-chunk-231-14.png" alt="FIGUREC3." width="672" />
<p class="caption">
Figure 3.23: FIGUREC3.
</p>
</div>
<pre><code>## 
## $subcl</code></pre>
<div class="figure"><span style="display:block;" id="fig:unnamed-chunk-231-15"></span>
<img src="Outcome-Weights_files/figure-html/unnamed-chunk-231-15.png" alt="FIGUREC3." width="672" />
<p class="caption">
Figure 3.24: FIGUREC3.
</p>
</div>
<div class="sourceCode" id="cb385"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb385-1"><a href="lalonde-nsw-data.html#cb385-1" tabindex="-1"></a><span class="fu">plot_matching_balance</span>(all_match.psid, <span class="at">title =</span> <span class="st">&quot;NSW-PSID1&quot;</span>)</span></code></pre></div>
<pre><code>## $nn</code></pre>
<div class="figure"><span style="display:block;" id="fig:unnamed-chunk-231-16"></span>
<img src="Outcome-Weights_files/figure-html/unnamed-chunk-231-16.png" alt="FIGUREC3." width="672" />
<p class="caption">
Figure 3.25: FIGUREC3.
</p>
</div>
<pre><code>## 
## $k2</code></pre>
<div class="figure"><span style="display:block;" id="fig:unnamed-chunk-231-17"></span>
<img src="Outcome-Weights_files/figure-html/unnamed-chunk-231-17.png" alt="FIGUREC3." width="672" />
<p class="caption">
Figure 3.26: FIGUREC3.
</p>
</div>
<pre><code>## 
## $k3</code></pre>
<div class="figure"><span style="display:block;" id="fig:unnamed-chunk-231-18"></span>
<img src="Outcome-Weights_files/figure-html/unnamed-chunk-231-18.png" alt="FIGUREC3." width="672" />
<p class="caption">
Figure 3.27: FIGUREC3.
</p>
</div>
<pre><code>## 
## $caliper</code></pre>
<div class="figure"><span style="display:block;" id="fig:unnamed-chunk-231-19"></span>
<img src="Outcome-Weights_files/figure-html/unnamed-chunk-231-19.png" alt="FIGUREC3." width="672" />
<p class="caption">
Figure 3.28: FIGUREC3.
</p>
</div>
<pre><code>## 
## $cs</code></pre>
<div class="figure"><span style="display:block;" id="fig:unnamed-chunk-231-20"></span>
<img src="Outcome-Weights_files/figure-html/unnamed-chunk-231-20.png" alt="FIGUREC3." width="672" />
<p class="caption">
Figure 3.29: FIGUREC3.
</p>
</div>
<pre><code>## 
## $mahvars</code></pre>
<div class="figure"><span style="display:block;" id="fig:unnamed-chunk-231-21"></span>
<img src="Outcome-Weights_files/figure-html/unnamed-chunk-231-21.png" alt="FIGUREC3." width="672" />
<p class="caption">
Figure 3.30: FIGUREC3.
</p>
</div>
<pre><code>## 
## $optimal_pair</code></pre>
<div class="figure"><span style="display:block;" id="fig:unnamed-chunk-231-22"></span>
<img src="Outcome-Weights_files/figure-html/unnamed-chunk-231-22.png" alt="FIGUREC3." width="672" />
<p class="caption">
Figure 3.31: FIGUREC3.
</p>
</div>
<pre><code>## 
## $optimal_full</code></pre>
<div class="figure"><span style="display:block;" id="fig:unnamed-chunk-231-23"></span>
<img src="Outcome-Weights_files/figure-html/unnamed-chunk-231-23.png" alt="FIGUREC3." width="672" />
<p class="caption">
Figure 3.32: FIGUREC3.
</p>
</div>
<pre><code>## 
## $gen_full</code></pre>
<div class="figure"><span style="display:block;" id="fig:unnamed-chunk-231-24"></span>
<img src="Outcome-Weights_files/figure-html/unnamed-chunk-231-24.png" alt="FIGUREC3." width="672" />
<p class="caption">
Figure 3.33: FIGUREC3.
</p>
</div>
<pre><code>## 
## $genetic</code></pre>
<div class="figure"><span style="display:block;" id="fig:unnamed-chunk-231-25"></span>
<img src="Outcome-Weights_files/figure-html/unnamed-chunk-231-25.png" alt="FIGUREC3." width="672" />
<p class="caption">
Figure 3.34: FIGUREC3.
</p>
</div>
<pre><code>## 
## $exact</code></pre>
<div class="figure"><span style="display:block;" id="fig:unnamed-chunk-231-26"></span>
<img src="Outcome-Weights_files/figure-html/unnamed-chunk-231-26.png" alt="FIGUREC3." width="672" />
<p class="caption">
Figure 3.35: FIGUREC3.
</p>
</div>
<pre><code>## 
## $cem</code></pre>
<div class="figure"><span style="display:block;" id="fig:unnamed-chunk-231-27"></span>
<img src="Outcome-Weights_files/figure-html/unnamed-chunk-231-27.png" alt="FIGUREC3." width="672" />
<p class="caption">
Figure 3.36: FIGUREC3.
</p>
</div>
<pre><code>## 
## $card</code></pre>
<div class="figure"><span style="display:block;" id="fig:unnamed-chunk-231-28"></span>
<img src="Outcome-Weights_files/figure-html/unnamed-chunk-231-28.png" alt="FIGUREC3." width="672" />
<p class="caption">
Figure 3.37: FIGUREC3.
</p>
</div>
<pre><code>## 
## $profile</code></pre>
<div class="figure"><span style="display:block;" id="fig:unnamed-chunk-231-29"></span>
<img src="Outcome-Weights_files/figure-html/unnamed-chunk-231-29.png" alt="FIGUREC3." width="672" />
<p class="caption">
Figure 3.38: FIGUREC3.
</p>
</div>
<pre><code>## 
## $subcl</code></pre>
<div class="figure"><span style="display:block;" id="fig:unnamed-chunk-231-30"></span>
<img src="Outcome-Weights_files/figure-html/unnamed-chunk-231-30.png" alt="FIGUREC3." width="672" />
<p class="caption">
Figure 3.39: FIGUREC3.
</p>
</div>
</div>
</div>
<div id="weighting-5" class="section level3 hasAnchor" number="3.5.2">
<h3><span class="header-section-number">3.5.2</span> Weighting<a href="lalonde-nsw-data.html#weighting-5" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb401"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb401-1"><a href="lalonde-nsw-data.html#cb401-1" tabindex="-1"></a><span class="co"># list all weights</span></span>
<span id="cb401-2"><a href="lalonde-nsw-data.html#cb401-2" tabindex="-1"></a>all_weight.cps <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb401-3"><a href="lalonde-nsw-data.html#cb401-3" tabindex="-1"></a>  <span class="at">ipw_weight =</span> nsw_cps<span class="sc">$</span>ipw_weight,</span>
<span id="cb401-4"><a href="lalonde-nsw-data.html#cb401-4" tabindex="-1"></a>  <span class="at">opt_weight =</span> nsw_cps<span class="sc">$</span>opt_weight,</span>
<span id="cb401-5"><a href="lalonde-nsw-data.html#cb401-5" tabindex="-1"></a>  <span class="at">cbps_weight =</span> nsw_cps<span class="sc">$</span>cbps_weight,</span>
<span id="cb401-6"><a href="lalonde-nsw-data.html#cb401-6" tabindex="-1"></a>  <span class="at">ebal_weight =</span> nsw_cps<span class="sc">$</span>ebal_weight</span>
<span id="cb401-7"><a href="lalonde-nsw-data.html#cb401-7" tabindex="-1"></a>)</span>
<span id="cb401-8"><a href="lalonde-nsw-data.html#cb401-8" tabindex="-1"></a></span>
<span id="cb401-9"><a href="lalonde-nsw-data.html#cb401-9" tabindex="-1"></a>all_weight.psid <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb401-10"><a href="lalonde-nsw-data.html#cb401-10" tabindex="-1"></a>  <span class="at">ipw_weight =</span> nsw_psid<span class="sc">$</span>ipw_weight,</span>
<span id="cb401-11"><a href="lalonde-nsw-data.html#cb401-11" tabindex="-1"></a>  <span class="at">opt_weight =</span> nsw_psid<span class="sc">$</span>opt_weight,</span>
<span id="cb401-12"><a href="lalonde-nsw-data.html#cb401-12" tabindex="-1"></a>  <span class="at">cbps_weight =</span> nsw_psid<span class="sc">$</span>cbps_weight,</span>
<span id="cb401-13"><a href="lalonde-nsw-data.html#cb401-13" tabindex="-1"></a>  <span class="at">ebal_weight =</span> nsw_psid<span class="sc">$</span>ebal_weight</span>
<span id="cb401-14"><a href="lalonde-nsw-data.html#cb401-14" tabindex="-1"></a>)</span></code></pre></div>
<div id="smd-7" class="section level4 hasAnchor" number="3.5.2.1">
<h4><span class="header-section-number">3.5.2.1</span> SMD<a href="lalonde-nsw-data.html#smd-7" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<div class="sourceCode" id="cb402"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb402-1"><a href="lalonde-nsw-data.html#cb402-1" tabindex="-1"></a><span class="co"># compute absolute SMD</span></span>
<span id="cb402-2"><a href="lalonde-nsw-data.html#cb402-2" tabindex="-1"></a>smd_weight.cps <span class="ot">&lt;-</span> <span class="fu">compute_abs_smd_weight</span>(nsw_cps, treat, covar, all_weight.cps)</span>
<span id="cb402-3"><a href="lalonde-nsw-data.html#cb402-3" tabindex="-1"></a>smd_weight.psid <span class="ot">&lt;-</span> <span class="fu">compute_abs_smd_weight</span>(nsw_psid, treat, covar, all_weight.psid)</span></code></pre></div>
</div>
<div id="ess-7" class="section level4 hasAnchor" number="3.5.2.2">
<h4><span class="header-section-number">3.5.2.2</span> ESS<a href="lalonde-nsw-data.html#ess-7" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<div class="sourceCode" id="cb403"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb403-1"><a href="lalonde-nsw-data.html#cb403-1" tabindex="-1"></a><span class="co"># compute ESS</span></span>
<span id="cb403-2"><a href="lalonde-nsw-data.html#cb403-2" tabindex="-1"></a>ess_weight.cps <span class="ot">&lt;-</span> <span class="fu">compute_ess_weight</span>(nsw_cps, treat, covar, all_weight.cps)</span>
<span id="cb403-3"><a href="lalonde-nsw-data.html#cb403-3" tabindex="-1"></a>ess_weight.psid <span class="ot">&lt;-</span> <span class="fu">compute_ess_weight</span>(nsw_psid, treat, covar, all_weight.psid)</span></code></pre></div>
</div>
<div id="visuals-7" class="section level4 hasAnchor" number="3.5.2.3">
<h4><span class="header-section-number">3.5.2.3</span> Visuals<a href="lalonde-nsw-data.html#visuals-7" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<div class="sourceCode" id="cb404"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb404-1"><a href="lalonde-nsw-data.html#cb404-1" tabindex="-1"></a><span class="co"># visualize covariate balance</span></span>
<span id="cb404-2"><a href="lalonde-nsw-data.html#cb404-2" tabindex="-1"></a><span class="fu">plot_weighting_balance</span>(nsw_cps, treat, covar, all_weight.cps, <span class="st">&quot;NSW-CPS1&quot;</span>) </span></code></pre></div>
<pre><code>## $ipw_weight</code></pre>
<div class="figure"><span style="display:block;" id="fig:unnamed-chunk-235-1"></span>
<img src="Outcome-Weights_files/figure-html/unnamed-chunk-235-1.png" alt="FIGUREC4." width="672" />
<p class="caption">
Figure 3.40: FIGUREC4.
</p>
</div>
<pre><code>## 
## $opt_weight</code></pre>
<div class="figure"><span style="display:block;" id="fig:unnamed-chunk-235-2"></span>
<img src="Outcome-Weights_files/figure-html/unnamed-chunk-235-2.png" alt="FIGUREC4." width="672" />
<p class="caption">
Figure 3.41: FIGUREC4.
</p>
</div>
<pre><code>## 
## $cbps_weight</code></pre>
<div class="figure"><span style="display:block;" id="fig:unnamed-chunk-235-3"></span>
<img src="Outcome-Weights_files/figure-html/unnamed-chunk-235-3.png" alt="FIGUREC4." width="672" />
<p class="caption">
Figure 3.42: FIGUREC4.
</p>
</div>
<pre><code>## 
## $ebal_weight</code></pre>
<div class="figure"><span style="display:block;" id="fig:unnamed-chunk-235-4"></span>
<img src="Outcome-Weights_files/figure-html/unnamed-chunk-235-4.png" alt="FIGUREC4." width="672" />
<p class="caption">
Figure 3.43: FIGUREC4.
</p>
</div>
<div class="sourceCode" id="cb409"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb409-1"><a href="lalonde-nsw-data.html#cb409-1" tabindex="-1"></a><span class="fu">plot_weighting_balance</span>(nsw_psid, treat, covar, all_weight.psid, <span class="st">&quot;NSW-PSID1&quot;</span>)</span></code></pre></div>
<pre><code>## $ipw_weight</code></pre>
<div class="figure"><span style="display:block;" id="fig:unnamed-chunk-235-5"></span>
<img src="Outcome-Weights_files/figure-html/unnamed-chunk-235-5.png" alt="FIGUREC4." width="672" />
<p class="caption">
Figure 3.44: FIGUREC4.
</p>
</div>
<pre><code>## 
## $opt_weight</code></pre>
<div class="figure"><span style="display:block;" id="fig:unnamed-chunk-235-6"></span>
<img src="Outcome-Weights_files/figure-html/unnamed-chunk-235-6.png" alt="FIGUREC4." width="672" />
<p class="caption">
Figure 3.45: FIGUREC4.
</p>
</div>
<pre><code>## 
## $cbps_weight</code></pre>
<div class="figure"><span style="display:block;" id="fig:unnamed-chunk-235-7"></span>
<img src="Outcome-Weights_files/figure-html/unnamed-chunk-235-7.png" alt="FIGUREC4." width="672" />
<p class="caption">
Figure 3.46: FIGUREC4.
</p>
</div>
<pre><code>## 
## $ebal_weight</code></pre>
<div class="figure"><span style="display:block;" id="fig:unnamed-chunk-235-8"></span>
<img src="Outcome-Weights_files/figure-html/unnamed-chunk-235-8.png" alt="FIGUREC4." width="672" />
<p class="caption">
Figure 3.47: FIGUREC4.
</p>
</div>
</div>
</div>
<div id="truncation-5" class="section level3 hasAnchor" number="3.5.3">
<h3><span class="header-section-number">3.5.3</span> Truncation<a href="lalonde-nsw-data.html#truncation-5" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb414"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb414-1"><a href="lalonde-nsw-data.html#cb414-1" tabindex="-1"></a><span class="co"># list truncation methods</span></span>
<span id="cb414-2"><a href="lalonde-nsw-data.html#cb414-2" tabindex="-1"></a>all_trunc.cps <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb414-3"><a href="lalonde-nsw-data.html#cb414-3" tabindex="-1"></a>  <span class="at">fix_max_value =</span> nsw_cps.fixed,</span>
<span id="cb414-4"><a href="lalonde-nsw-data.html#cb414-4" tabindex="-1"></a>  <span class="at">at_perc =</span> nsw_cps.percent,</span>
<span id="cb414-5"><a href="lalonde-nsw-data.html#cb414-5" tabindex="-1"></a>  <span class="at">adap_weight =</span> nsw_cps.adapt</span>
<span id="cb414-6"><a href="lalonde-nsw-data.html#cb414-6" tabindex="-1"></a>)</span>
<span id="cb414-7"><a href="lalonde-nsw-data.html#cb414-7" tabindex="-1"></a></span>
<span id="cb414-8"><a href="lalonde-nsw-data.html#cb414-8" tabindex="-1"></a>all_trunc.psid <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb414-9"><a href="lalonde-nsw-data.html#cb414-9" tabindex="-1"></a>  <span class="at">fix_max_value =</span> nsw_psid.fixed,</span>
<span id="cb414-10"><a href="lalonde-nsw-data.html#cb414-10" tabindex="-1"></a>  <span class="at">at_perc =</span> nsw_psid.percent,</span>
<span id="cb414-11"><a href="lalonde-nsw-data.html#cb414-11" tabindex="-1"></a>  <span class="at">adap_weight =</span> nsw_psid.adapt</span>
<span id="cb414-12"><a href="lalonde-nsw-data.html#cb414-12" tabindex="-1"></a>)</span></code></pre></div>
<div id="smd-8" class="section level4 hasAnchor" number="3.5.3.1">
<h4><span class="header-section-number">3.5.3.1</span> SMD<a href="lalonde-nsw-data.html#smd-8" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<div class="sourceCode" id="cb415"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb415-1"><a href="lalonde-nsw-data.html#cb415-1" tabindex="-1"></a><span class="co"># compute absolute SMD</span></span>
<span id="cb415-2"><a href="lalonde-nsw-data.html#cb415-2" tabindex="-1"></a>smd_trunc.cps <span class="ot">&lt;-</span> <span class="fu">compute_abs_smd_trunc</span>(all_trunc.cps, <span class="st">&quot;treat&quot;</span>, covar, weight_columns)</span>
<span id="cb415-3"><a href="lalonde-nsw-data.html#cb415-3" tabindex="-1"></a>smd_trunc.psid <span class="ot">&lt;-</span> <span class="fu">compute_abs_smd_trunc</span>(all_trunc.psid, <span class="st">&quot;treat&quot;</span>, covar, weight_columns)</span></code></pre></div>
</div>
<div id="ess-8" class="section level4 hasAnchor" number="3.5.3.2">
<h4><span class="header-section-number">3.5.3.2</span> ESS<a href="lalonde-nsw-data.html#ess-8" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<div class="sourceCode" id="cb416"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb416-1"><a href="lalonde-nsw-data.html#cb416-1" tabindex="-1"></a><span class="co"># compute ESS</span></span>
<span id="cb416-2"><a href="lalonde-nsw-data.html#cb416-2" tabindex="-1"></a>ess_trunc.cps <span class="ot">&lt;-</span> <span class="fu">compute_ess_trunc</span>(all_trunc.cps, <span class="st">&quot;treat&quot;</span>, covar, weight_columns)</span>
<span id="cb416-3"><a href="lalonde-nsw-data.html#cb416-3" tabindex="-1"></a>ess_trunc.psid <span class="ot">&lt;-</span> <span class="fu">compute_ess_trunc</span>(all_trunc.psid, <span class="st">&quot;treat&quot;</span>, covar, weight_columns)</span></code></pre></div>
</div>
<div id="visuals-8" class="section level4 hasAnchor" number="3.5.3.3">
<h4><span class="header-section-number">3.5.3.3</span> Visuals<a href="lalonde-nsw-data.html#visuals-8" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<div class="sourceCode" id="cb417"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb417-1"><a href="lalonde-nsw-data.html#cb417-1" tabindex="-1"></a><span class="co"># visualize covariate balance</span></span>
<span id="cb417-2"><a href="lalonde-nsw-data.html#cb417-2" tabindex="-1"></a><span class="fu">plot_trunc_balance</span>(all_trunc.cps, <span class="st">&quot;treat&quot;</span>, covar, weight_columns, <span class="st">&quot;NSW-CPS1&quot;</span>)</span></code></pre></div>
<pre><code>## $fix_max_value_ipw_weight</code></pre>
<div class="figure"><span style="display:block;" id="fig:unnamed-chunk-239-1"></span>
<img src="Outcome-Weights_files/figure-html/unnamed-chunk-239-1.png" alt="FIGUREC5." width="672" />
<p class="caption">
Figure 3.48: FIGUREC5.
</p>
</div>
<pre><code>## 
## $fix_max_value_opt_weight</code></pre>
<div class="figure"><span style="display:block;" id="fig:unnamed-chunk-239-2"></span>
<img src="Outcome-Weights_files/figure-html/unnamed-chunk-239-2.png" alt="FIGUREC5." width="672" />
<p class="caption">
Figure 3.49: FIGUREC5.
</p>
</div>
<pre><code>## 
## $fix_max_value_cbps_weight</code></pre>
<div class="figure"><span style="display:block;" id="fig:unnamed-chunk-239-3"></span>
<img src="Outcome-Weights_files/figure-html/unnamed-chunk-239-3.png" alt="FIGUREC5." width="672" />
<p class="caption">
Figure 3.50: FIGUREC5.
</p>
</div>
<pre><code>## 
## $fix_max_value_ebal_weight</code></pre>
<div class="figure"><span style="display:block;" id="fig:unnamed-chunk-239-4"></span>
<img src="Outcome-Weights_files/figure-html/unnamed-chunk-239-4.png" alt="FIGUREC5." width="672" />
<p class="caption">
Figure 3.51: FIGUREC5.
</p>
</div>
<pre><code>## 
## $at_perc_ipw_weight</code></pre>
<div class="figure"><span style="display:block;" id="fig:unnamed-chunk-239-5"></span>
<img src="Outcome-Weights_files/figure-html/unnamed-chunk-239-5.png" alt="FIGUREC5." width="672" />
<p class="caption">
Figure 3.52: FIGUREC5.
</p>
</div>
<pre><code>## 
## $at_perc_opt_weight</code></pre>
<div class="figure"><span style="display:block;" id="fig:unnamed-chunk-239-6"></span>
<img src="Outcome-Weights_files/figure-html/unnamed-chunk-239-6.png" alt="FIGUREC5." width="672" />
<p class="caption">
Figure 3.53: FIGUREC5.
</p>
</div>
<pre><code>## 
## $at_perc_cbps_weight</code></pre>
<div class="figure"><span style="display:block;" id="fig:unnamed-chunk-239-7"></span>
<img src="Outcome-Weights_files/figure-html/unnamed-chunk-239-7.png" alt="FIGUREC5." width="672" />
<p class="caption">
Figure 3.54: FIGUREC5.
</p>
</div>
<pre><code>## 
## $at_perc_ebal_weight</code></pre>
<div class="figure"><span style="display:block;" id="fig:unnamed-chunk-239-8"></span>
<img src="Outcome-Weights_files/figure-html/unnamed-chunk-239-8.png" alt="FIGUREC5." width="672" />
<p class="caption">
Figure 3.55: FIGUREC5.
</p>
</div>
<pre><code>## 
## $adap_weight_ipw_weight</code></pre>
<div class="figure"><span style="display:block;" id="fig:unnamed-chunk-239-9"></span>
<img src="Outcome-Weights_files/figure-html/unnamed-chunk-239-9.png" alt="FIGUREC5." width="672" />
<p class="caption">
Figure 3.56: FIGUREC5.
</p>
</div>
<pre><code>## 
## $adap_weight_opt_weight</code></pre>
<div class="figure"><span style="display:block;" id="fig:unnamed-chunk-239-10"></span>
<img src="Outcome-Weights_files/figure-html/unnamed-chunk-239-10.png" alt="FIGUREC5." width="672" />
<p class="caption">
Figure 3.57: FIGUREC5.
</p>
</div>
<pre><code>## 
## $adap_weight_cbps_weight</code></pre>
<div class="figure"><span style="display:block;" id="fig:unnamed-chunk-239-11"></span>
<img src="Outcome-Weights_files/figure-html/unnamed-chunk-239-11.png" alt="FIGUREC5." width="672" />
<p class="caption">
Figure 3.58: FIGUREC5.
</p>
</div>
<pre><code>## 
## $adap_weight_ebal_weight</code></pre>
<div class="figure"><span style="display:block;" id="fig:unnamed-chunk-239-12"></span>
<img src="Outcome-Weights_files/figure-html/unnamed-chunk-239-12.png" alt="FIGUREC5." width="672" />
<p class="caption">
Figure 3.59: FIGUREC5.
</p>
</div>
<div class="sourceCode" id="cb430"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb430-1"><a href="lalonde-nsw-data.html#cb430-1" tabindex="-1"></a><span class="fu">plot_trunc_balance</span>(all_trunc.psid, <span class="st">&quot;treat&quot;</span>, covar, weight_columns, <span class="st">&quot;NSW-PSID1&quot;</span>)</span></code></pre></div>
<pre><code>## $fix_max_value_ipw_weight</code></pre>
<div class="figure"><span style="display:block;" id="fig:unnamed-chunk-239-13"></span>
<img src="Outcome-Weights_files/figure-html/unnamed-chunk-239-13.png" alt="FIGUREC5." width="672" />
<p class="caption">
Figure 3.60: FIGUREC5.
</p>
</div>
<pre><code>## 
## $fix_max_value_opt_weight</code></pre>
<div class="figure"><span style="display:block;" id="fig:unnamed-chunk-239-14"></span>
<img src="Outcome-Weights_files/figure-html/unnamed-chunk-239-14.png" alt="FIGUREC5." width="672" />
<p class="caption">
Figure 3.61: FIGUREC5.
</p>
</div>
<pre><code>## 
## $fix_max_value_cbps_weight</code></pre>
<div class="figure"><span style="display:block;" id="fig:unnamed-chunk-239-15"></span>
<img src="Outcome-Weights_files/figure-html/unnamed-chunk-239-15.png" alt="FIGUREC5." width="672" />
<p class="caption">
Figure 3.62: FIGUREC5.
</p>
</div>
<pre><code>## 
## $fix_max_value_ebal_weight</code></pre>
<div class="figure"><span style="display:block;" id="fig:unnamed-chunk-239-16"></span>
<img src="Outcome-Weights_files/figure-html/unnamed-chunk-239-16.png" alt="FIGUREC5." width="672" />
<p class="caption">
Figure 3.63: FIGUREC5.
</p>
</div>
<pre><code>## 
## $at_perc_ipw_weight</code></pre>
<div class="figure"><span style="display:block;" id="fig:unnamed-chunk-239-17"></span>
<img src="Outcome-Weights_files/figure-html/unnamed-chunk-239-17.png" alt="FIGUREC5." width="672" />
<p class="caption">
Figure 3.64: FIGUREC5.
</p>
</div>
<pre><code>## 
## $at_perc_opt_weight</code></pre>
<div class="figure"><span style="display:block;" id="fig:unnamed-chunk-239-18"></span>
<img src="Outcome-Weights_files/figure-html/unnamed-chunk-239-18.png" alt="FIGUREC5." width="672" />
<p class="caption">
Figure 3.65: FIGUREC5.
</p>
</div>
<pre><code>## 
## $at_perc_cbps_weight</code></pre>
<div class="figure"><span style="display:block;" id="fig:unnamed-chunk-239-19"></span>
<img src="Outcome-Weights_files/figure-html/unnamed-chunk-239-19.png" alt="FIGUREC5." width="672" />
<p class="caption">
Figure 3.66: FIGUREC5.
</p>
</div>
<pre><code>## 
## $at_perc_ebal_weight</code></pre>
<div class="figure"><span style="display:block;" id="fig:unnamed-chunk-239-20"></span>
<img src="Outcome-Weights_files/figure-html/unnamed-chunk-239-20.png" alt="FIGUREC5." width="672" />
<p class="caption">
Figure 3.67: FIGUREC5.
</p>
</div>
<pre><code>## 
## $adap_weight_ipw_weight</code></pre>
<div class="figure"><span style="display:block;" id="fig:unnamed-chunk-239-21"></span>
<img src="Outcome-Weights_files/figure-html/unnamed-chunk-239-21.png" alt="FIGUREC5." width="672" />
<p class="caption">
Figure 3.68: FIGUREC5.
</p>
</div>
<pre><code>## 
## $adap_weight_opt_weight</code></pre>
<div class="figure"><span style="display:block;" id="fig:unnamed-chunk-239-22"></span>
<img src="Outcome-Weights_files/figure-html/unnamed-chunk-239-22.png" alt="FIGUREC5." width="672" />
<p class="caption">
Figure 3.69: FIGUREC5.
</p>
</div>
<pre><code>## 
## $adap_weight_cbps_weight</code></pre>
<div class="figure"><span style="display:block;" id="fig:unnamed-chunk-239-23"></span>
<img src="Outcome-Weights_files/figure-html/unnamed-chunk-239-23.png" alt="FIGUREC5." width="672" />
<p class="caption">
Figure 3.70: FIGUREC5.
</p>
</div>
<pre><code>## 
## $adap_weight_ebal_weight</code></pre>
<div class="figure"><span style="display:block;" id="fig:unnamed-chunk-239-24"></span>
<img src="Outcome-Weights_files/figure-html/unnamed-chunk-239-24.png" alt="FIGUREC5." width="672" />
<p class="caption">
Figure 3.71: FIGUREC5.
</p>
</div>
</div>
</div>
<div id="trimming-5" class="section level3 hasAnchor" number="3.5.4">
<h3><span class="header-section-number">3.5.4</span> Trimming<a href="lalonde-nsw-data.html#trimming-5" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb443"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb443-1"><a href="lalonde-nsw-data.html#cb443-1" tabindex="-1"></a><span class="co"># list trimming objects plus original</span></span>
<span id="cb443-2"><a href="lalonde-nsw-data.html#cb443-2" tabindex="-1"></a>all_trim.cps <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb443-3"><a href="lalonde-nsw-data.html#cb443-3" tabindex="-1"></a>  <span class="at">original =</span> nsw_cps,</span>
<span id="cb443-4"><a href="lalonde-nsw-data.html#cb443-4" tabindex="-1"></a>  <span class="at">ps_threshold =</span> nsw_cps.trim,</span>
<span id="cb443-5"><a href="lalonde-nsw-data.html#cb443-5" tabindex="-1"></a>  <span class="at">common_range =</span> nsw_cps.common,</span>
<span id="cb443-6"><a href="lalonde-nsw-data.html#cb443-6" tabindex="-1"></a>  <span class="at">crump =</span> nsw_cps.crump,</span>
<span id="cb443-7"><a href="lalonde-nsw-data.html#cb443-7" tabindex="-1"></a>  <span class="at">stuermer =</span> nsw_cps.stuermer,</span>
<span id="cb443-8"><a href="lalonde-nsw-data.html#cb443-8" tabindex="-1"></a>  <span class="at">walker =</span> nsw_cps.walker</span>
<span id="cb443-9"><a href="lalonde-nsw-data.html#cb443-9" tabindex="-1"></a>)</span>
<span id="cb443-10"><a href="lalonde-nsw-data.html#cb443-10" tabindex="-1"></a></span>
<span id="cb443-11"><a href="lalonde-nsw-data.html#cb443-11" tabindex="-1"></a>all_trim.psid <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb443-12"><a href="lalonde-nsw-data.html#cb443-12" tabindex="-1"></a>  <span class="at">original =</span> nsw_psid,</span>
<span id="cb443-13"><a href="lalonde-nsw-data.html#cb443-13" tabindex="-1"></a>  <span class="at">ps_threshold =</span> nsw_psid.trim,</span>
<span id="cb443-14"><a href="lalonde-nsw-data.html#cb443-14" tabindex="-1"></a>  <span class="at">common_range =</span> nsw_psid.common,</span>
<span id="cb443-15"><a href="lalonde-nsw-data.html#cb443-15" tabindex="-1"></a>  <span class="at">crump =</span> nsw_psid.crump,</span>
<span id="cb443-16"><a href="lalonde-nsw-data.html#cb443-16" tabindex="-1"></a>  <span class="at">stuermer =</span> nsw_psid.stuermer,</span>
<span id="cb443-17"><a href="lalonde-nsw-data.html#cb443-17" tabindex="-1"></a>  <span class="at">walker =</span> nsw_psid.walker</span>
<span id="cb443-18"><a href="lalonde-nsw-data.html#cb443-18" tabindex="-1"></a>)</span></code></pre></div>
<div id="smd-9" class="section level4 hasAnchor" number="3.5.4.1">
<h4><span class="header-section-number">3.5.4.1</span> SMD<a href="lalonde-nsw-data.html#smd-9" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<div class="sourceCode" id="cb444"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb444-1"><a href="lalonde-nsw-data.html#cb444-1" tabindex="-1"></a><span class="co"># compute absolute SMD</span></span>
<span id="cb444-2"><a href="lalonde-nsw-data.html#cb444-2" tabindex="-1"></a>smd_trim.cps <span class="ot">&lt;-</span> <span class="fu">compute_abs_smd_trim</span>(all_trim.cps, <span class="st">&quot;treat&quot;</span>, covar)</span>
<span id="cb444-3"><a href="lalonde-nsw-data.html#cb444-3" tabindex="-1"></a>smd_trim.psid <span class="ot">&lt;-</span> <span class="fu">compute_abs_smd_trim</span>(all_trim.psid, <span class="st">&quot;treat&quot;</span>, covar)</span></code></pre></div>
</div>
<div id="ess-9" class="section level4 hasAnchor" number="3.5.4.2">
<h4><span class="header-section-number">3.5.4.2</span> ESS<a href="lalonde-nsw-data.html#ess-9" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<div class="sourceCode" id="cb445"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb445-1"><a href="lalonde-nsw-data.html#cb445-1" tabindex="-1"></a><span class="co"># compute ESS</span></span>
<span id="cb445-2"><a href="lalonde-nsw-data.html#cb445-2" tabindex="-1"></a>ess_trim.cps <span class="ot">&lt;-</span> <span class="fu">compute_ess_trim</span>(all_trim.cps, <span class="st">&quot;treat&quot;</span>, covar)</span>
<span id="cb445-3"><a href="lalonde-nsw-data.html#cb445-3" tabindex="-1"></a>ess_trim.psid <span class="ot">&lt;-</span> <span class="fu">compute_ess_trim</span>(all_trim.psid, <span class="st">&quot;treat&quot;</span>, covar)</span></code></pre></div>
</div>
<div id="visuals-9" class="section level4 hasAnchor" number="3.5.4.3">
<h4><span class="header-section-number">3.5.4.3</span> Visuals<a href="lalonde-nsw-data.html#visuals-9" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<div class="sourceCode" id="cb446"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb446-1"><a href="lalonde-nsw-data.html#cb446-1" tabindex="-1"></a><span class="co"># visualize overlap</span></span>
<span id="cb446-2"><a href="lalonde-nsw-data.html#cb446-2" tabindex="-1"></a><span class="fu">plot_trim_overlap</span>(all_trim.cps, treat, covar, <span class="at">prefix =</span> <span class="st">&quot;NSW-CPS1&quot;</span>)</span></code></pre></div>
<div class="figure"><span style="display:block;" id="fig:unnamed-chunk-243-1"></span>
<img src="Outcome-Weights_files/figure-html/unnamed-chunk-243-1.png" alt="FIGUREC6." width="672" />
<p class="caption">
Figure 3.72: FIGUREC6.
</p>
</div>
<div class="sourceCode" id="cb447"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb447-1"><a href="lalonde-nsw-data.html#cb447-1" tabindex="-1"></a><span class="fu">plot_trim_overlap</span>(all_trim.psid, treat, covar, <span class="at">prefix =</span> <span class="st">&quot;NSW-PSID1&quot;</span>)</span></code></pre></div>
<div class="figure"><span style="display:block;" id="fig:unnamed-chunk-243-2"></span>
<img src="Outcome-Weights_files/figure-html/unnamed-chunk-243-2.png" alt="FIGUREC6." width="672" />
<p class="caption">
Figure 3.73: FIGUREC6.
</p>
</div>
</div>
</div>
</div>
<div id="integrated-methods-3" class="section level2 hasAnchor" number="3.6">
<h2><span class="header-section-number">3.6</span> Integrated methods<a href="lalonde-nsw-data.html#integrated-methods-3" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div id="trimming-and-matching-3" class="section level3 hasAnchor" number="3.6.1">
<h3><span class="header-section-number">3.6.1</span> Trimming and matching<a href="lalonde-nsw-data.html#trimming-and-matching-3" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>(Similar to tutorial by <span class="citation">Imbens and Xu (<a href="#ref-imbens2024">2024</a>)</span>)</p>
<div class="sourceCode" id="cb448"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb448-1"><a href="lalonde-nsw-data.html#cb448-1" tabindex="-1"></a><span class="co"># list all trimmed and matched samples</span></span>
<span id="cb448-2"><a href="lalonde-nsw-data.html#cb448-2" tabindex="-1"></a>comb_cps <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb448-3"><a href="lalonde-nsw-data.html#cb448-3" tabindex="-1"></a>  <span class="at">ps_threshold_match =</span> nsw_cps_trim_match</span>
<span id="cb448-4"><a href="lalonde-nsw-data.html#cb448-4" tabindex="-1"></a>)</span>
<span id="cb448-5"><a href="lalonde-nsw-data.html#cb448-5" tabindex="-1"></a></span>
<span id="cb448-6"><a href="lalonde-nsw-data.html#cb448-6" tabindex="-1"></a>comb_psid <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb448-7"><a href="lalonde-nsw-data.html#cb448-7" tabindex="-1"></a>  <span class="at">ps_threshold_match =</span> nsw_psid_trim_match</span>
<span id="cb448-8"><a href="lalonde-nsw-data.html#cb448-8" tabindex="-1"></a>)</span></code></pre></div>
<div id="smd-10" class="section level4 hasAnchor" number="3.6.1.1">
<h4><span class="header-section-number">3.6.1.1</span> SMD<a href="lalonde-nsw-data.html#smd-10" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<div class="sourceCode" id="cb449"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb449-1"><a href="lalonde-nsw-data.html#cb449-1" tabindex="-1"></a><span class="co"># compute SMD</span></span>
<span id="cb449-2"><a href="lalonde-nsw-data.html#cb449-2" tabindex="-1"></a>smd_all_comb_meth.cps_plus <span class="ot">&lt;-</span> <span class="fu">compute_abs_smd_trim</span>(comb_cps, <span class="st">&quot;treat&quot;</span>, covar)</span>
<span id="cb449-3"><a href="lalonde-nsw-data.html#cb449-3" tabindex="-1"></a>smd_all_comb_meth.psid_plus <span class="ot">&lt;-</span> <span class="fu">compute_abs_smd_trim</span>(comb_psid, <span class="st">&quot;treat&quot;</span>, covar)</span></code></pre></div>
</div>
<div id="ess-10" class="section level4 hasAnchor" number="3.6.1.2">
<h4><span class="header-section-number">3.6.1.2</span> ESS<a href="lalonde-nsw-data.html#ess-10" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<div class="sourceCode" id="cb450"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb450-1"><a href="lalonde-nsw-data.html#cb450-1" tabindex="-1"></a><span class="co"># compute ESS</span></span>
<span id="cb450-2"><a href="lalonde-nsw-data.html#cb450-2" tabindex="-1"></a>ess_all_comb_meth.cps_plus <span class="ot">&lt;-</span> <span class="fu">compute_ess_trim</span>(comb_cps, <span class="st">&quot;treat&quot;</span>, covar)</span>
<span id="cb450-3"><a href="lalonde-nsw-data.html#cb450-3" tabindex="-1"></a>ess_all_comb_meth.psid_plus <span class="ot">&lt;-</span> <span class="fu">compute_ess_trim</span>(comb_psid, <span class="st">&quot;treat&quot;</span>, covar)</span></code></pre></div>
</div>
<div id="visuals-10" class="section level4 hasAnchor" number="3.6.1.3">
<h4><span class="header-section-number">3.6.1.3</span> Visuals<a href="lalonde-nsw-data.html#visuals-10" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<div class="sourceCode" id="cb451"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb451-1"><a href="lalonde-nsw-data.html#cb451-1" tabindex="-1"></a><span class="co"># visualize overlap</span></span>
<span id="cb451-2"><a href="lalonde-nsw-data.html#cb451-2" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">3</span>))</span>
<span id="cb451-3"><a href="lalonde-nsw-data.html#cb451-3" tabindex="-1"></a><span class="fu">plot_trim_overlap</span>(comb_cps, treat, covar, <span class="at">prefix =</span> <span class="st">&quot;NSW-CPS1-PLUS&quot;</span>)</span>
<span id="cb451-4"><a href="lalonde-nsw-data.html#cb451-4" tabindex="-1"></a><span class="fu">plot_trim_overlap</span>(comb_psid, treat, covar, <span class="at">prefix =</span> <span class="st">&quot;NSW-PSID1-PLUS&quot;</span>)</span></code></pre></div>
<div class="figure"><span style="display:block;" id="fig:unnamed-chunk-247-1"></span>
<img src="Outcome-Weights_files/figure-html/unnamed-chunk-247-1.png" alt="FIGUREC7." width="672" />
<p class="caption">
Figure 3.74: FIGUREC7.
</p>
</div>
<div class="figure"><span style="display:block;" id="fig:unnamed-chunk-247-2"></span>
<img src="Outcome-Weights_files/figure-html/unnamed-chunk-247-2.png" alt="FIGUREC7." width="672" />
<p class="caption">
Figure 3.75: FIGUREC7.
</p>
</div>
</div>
</div>
<div id="trimming-and-weighting-3" class="section level3 hasAnchor" number="3.6.2">
<h3><span class="header-section-number">3.6.2</span> Trimming and weighting<a href="lalonde-nsw-data.html#trimming-and-weighting-3" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb452"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb452-1"><a href="lalonde-nsw-data.html#cb452-1" tabindex="-1"></a><span class="co"># list all combined results</span></span>
<span id="cb452-2"><a href="lalonde-nsw-data.html#cb452-2" tabindex="-1"></a>comb.cps <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb452-3"><a href="lalonde-nsw-data.html#cb452-3" tabindex="-1"></a>  <span class="at">ipw =</span> ipw_comb.cps,</span>
<span id="cb452-4"><a href="lalonde-nsw-data.html#cb452-4" tabindex="-1"></a>  <span class="at">opt =</span> opt_comb.cps,</span>
<span id="cb452-5"><a href="lalonde-nsw-data.html#cb452-5" tabindex="-1"></a>  <span class="at">cbps =</span> cbps_comb.cps,</span>
<span id="cb452-6"><a href="lalonde-nsw-data.html#cb452-6" tabindex="-1"></a>  <span class="at">ebal =</span> ebal_comb.cps</span>
<span id="cb452-7"><a href="lalonde-nsw-data.html#cb452-7" tabindex="-1"></a>)</span>
<span id="cb452-8"><a href="lalonde-nsw-data.html#cb452-8" tabindex="-1"></a></span>
<span id="cb452-9"><a href="lalonde-nsw-data.html#cb452-9" tabindex="-1"></a>comb.psid <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb452-10"><a href="lalonde-nsw-data.html#cb452-10" tabindex="-1"></a>  <span class="at">ipw =</span> ipw_comb.psid,</span>
<span id="cb452-11"><a href="lalonde-nsw-data.html#cb452-11" tabindex="-1"></a>  <span class="at">opt =</span> opt_comb.psid,</span>
<span id="cb452-12"><a href="lalonde-nsw-data.html#cb452-12" tabindex="-1"></a>  <span class="at">cbps =</span> cbps_comb.psid,</span>
<span id="cb452-13"><a href="lalonde-nsw-data.html#cb452-13" tabindex="-1"></a>  <span class="at">ebal =</span> ebal_comb.psid</span>
<span id="cb452-14"><a href="lalonde-nsw-data.html#cb452-14" tabindex="-1"></a>)</span></code></pre></div>
<div id="smd-11" class="section level4 hasAnchor" number="3.6.2.1">
<h4><span class="header-section-number">3.6.2.1</span> SMD<a href="lalonde-nsw-data.html#smd-11" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<div class="sourceCode" id="cb453"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb453-1"><a href="lalonde-nsw-data.html#cb453-1" tabindex="-1"></a><span class="co"># compute absolute SMD</span></span>
<span id="cb453-2"><a href="lalonde-nsw-data.html#cb453-2" tabindex="-1"></a>smd_all_comb_meth.cps <span class="ot">&lt;-</span> <span class="fu">compute_abs_smd_comb</span>(comb.cps, <span class="st">&quot;treat&quot;</span>, covar)</span>
<span id="cb453-3"><a href="lalonde-nsw-data.html#cb453-3" tabindex="-1"></a>smd_all_comb_meth.psid <span class="ot">&lt;-</span> <span class="fu">compute_abs_smd_comb</span>(comb.psid, <span class="st">&quot;treat&quot;</span>, covar)</span></code></pre></div>
</div>
<div id="ess-11" class="section level4 hasAnchor" number="3.6.2.2">
<h4><span class="header-section-number">3.6.2.2</span> ESS<a href="lalonde-nsw-data.html#ess-11" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<div class="sourceCode" id="cb454"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb454-1"><a href="lalonde-nsw-data.html#cb454-1" tabindex="-1"></a><span class="co"># compute ESS</span></span>
<span id="cb454-2"><a href="lalonde-nsw-data.html#cb454-2" tabindex="-1"></a>ess_all_comb_meth.cps <span class="ot">&lt;-</span> <span class="fu">compute_ess_comb</span>(comb.cps, <span class="st">&quot;treat&quot;</span>, covar)</span>
<span id="cb454-3"><a href="lalonde-nsw-data.html#cb454-3" tabindex="-1"></a>ess_all_comb_meth.psid <span class="ot">&lt;-</span> <span class="fu">compute_ess_comb</span>(comb.psid, <span class="st">&quot;treat&quot;</span>, covar)</span></code></pre></div>
</div>
<div id="visuals-11" class="section level4 hasAnchor" number="3.6.2.3">
<h4><span class="header-section-number">3.6.2.3</span> Visuals<a href="lalonde-nsw-data.html#visuals-11" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<div class="sourceCode" id="cb455"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb455-1"><a href="lalonde-nsw-data.html#cb455-1" tabindex="-1"></a><span class="co"># visualize overlap</span></span>
<span id="cb455-2"><a href="lalonde-nsw-data.html#cb455-2" tabindex="-1"></a><span class="fu">plot_comb_overlap</span>(<span class="at">comb_meth_cps =</span> comb.cps, <span class="at">comb_meth_psid =</span> comb.psid, <span class="at">treat =</span> <span class="st">&quot;treat&quot;</span>, <span class="at">covar =</span> covar, <span class="at">prefix_cps =</span> <span class="st">&quot;NSW-CPS1&quot;</span>, <span class="at">prefix_psid =</span> <span class="st">&quot;NSW-PSID1&quot;</span>)</span></code></pre></div>
<div class="figure"><span style="display:block;" id="fig:unnamed-chunk-251-1"></span>
<img src="Outcome-Weights_files/figure-html/unnamed-chunk-251-1.png" alt="FIGUREC8." width="672" />
<p class="caption">
Figure 3.76: FIGUREC8.
</p>
</div>
<div class="figure"><span style="display:block;" id="fig:unnamed-chunk-251-2"></span>
<img src="Outcome-Weights_files/figure-html/unnamed-chunk-251-2.png" alt="FIGUREC8." width="672" />
<p class="caption">
Figure 3.77: FIGUREC8.
</p>
</div>
<div class="figure"><span style="display:block;" id="fig:unnamed-chunk-251-3"></span>
<img src="Outcome-Weights_files/figure-html/unnamed-chunk-251-3.png" alt="FIGUREC8." width="672" />
<p class="caption">
Figure 3.78: FIGUREC8.
</p>
</div>
<div class="figure"><span style="display:block;" id="fig:unnamed-chunk-251-4"></span>
<img src="Outcome-Weights_files/figure-html/unnamed-chunk-251-4.png" alt="FIGUREC8." width="672" />
<p class="caption">
Figure 3.79: FIGUREC8.
</p>
</div>
<div class="figure"><span style="display:block;" id="fig:unnamed-chunk-251-5"></span>
<img src="Outcome-Weights_files/figure-html/unnamed-chunk-251-5.png" alt="FIGUREC8." width="672" />
<p class="caption">
Figure 3.80: FIGUREC8.
</p>
</div>
<div class="figure"><span style="display:block;" id="fig:unnamed-chunk-251-6"></span>
<img src="Outcome-Weights_files/figure-html/unnamed-chunk-251-6.png" alt="FIGUREC8." width="672" />
<p class="caption">
Figure 3.81: FIGUREC8.
</p>
</div>
<div class="figure"><span style="display:block;" id="fig:unnamed-chunk-251-7"></span>
<img src="Outcome-Weights_files/figure-html/unnamed-chunk-251-7.png" alt="FIGUREC8." width="672" />
<p class="caption">
Figure 3.82: FIGUREC8.
</p>
</div>
<div class="figure"><span style="display:block;" id="fig:unnamed-chunk-251-8"></span>
<img src="Outcome-Weights_files/figure-html/unnamed-chunk-251-8.png" alt="FIGUREC8." width="672" />
<p class="caption">
Figure 3.83: FIGUREC8.
</p>
</div>
<div class="sourceCode" id="cb456"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb456-1"><a href="lalonde-nsw-data.html#cb456-1" tabindex="-1"></a><span class="co"># save results</span></span>
<span id="cb456-2"><a href="lalonde-nsw-data.html#cb456-2" tabindex="-1"></a><span class="fu">save_comb_hist</span>(<span class="at">comb_meth_cps =</span> comb.cps, <span class="at">comb_meth_psid =</span> comb.psid, <span class="at">treat =</span> <span class="st">&quot;treat&quot;</span>, <span class="at">covar =</span> covar, <span class="at">prefix =</span> <span class="st">&quot;nsw&quot;</span>, <span class="at">prefix_cps =</span> <span class="st">&quot;nsw_cps1&quot;</span>, <span class="at">prefix_psid =</span> <span class="st">&quot;nsw_psid1&quot;</span>)</span></code></pre></div>
<pre><code>## [1] &quot;C:/Users/lkreisel/workspace/uni-projects/Application-of-Outcome-Weights-Framework-for-DML-to-Lalonde-Study&quot;
## -12.49703 1.660349</code></pre>
<pre><code>## -12.35664 1.724553</code></pre>
<pre><code>## -16.1181 -2.253741</code></pre>
<pre><code>## -10.96064 -2.254369</code></pre>
<pre><code>## -2.283175 1.503162</code></pre>
<pre><code>## -12.49703 1.660349</code></pre>
<pre><code>## -12.35664 1.724553</code></pre>
<pre><code>## -16.1181 -2.253741</code></pre>
<pre><code>## -10.96064 -2.254369</code></pre>
<pre><code>## -2.283175 1.503162</code></pre>
<pre><code>## -12.49703 1.660349</code></pre>
<pre><code>## -12.35664 1.724553</code></pre>
<pre><code>## -16.1181 -2.253741</code></pre>
<pre><code>## -10.96064 -2.254369</code></pre>
<pre><code>## -2.283175 1.503162</code></pre>
<pre><code>## -12.49703 1.660349</code></pre>
<pre><code>## -12.35664 1.724553</code></pre>
<pre><code>## -16.1181 -2.253741</code></pre>
<pre><code>## -10.96064 -2.254369</code></pre>
<pre><code>## -2.283175 1.503162</code></pre>
<pre><code>## -9.836359 2.234878</code></pre>
<pre><code>## -6.531578 2.333365</code></pre>
<pre><code>## -3.214249 -1.209959</code></pre>
<pre><code>## -4.090612 -1.553181</code></pre>
<pre><code>## -2.058494 2.301793</code></pre>
<pre><code>## -9.836359 2.234878</code></pre>
<pre><code>## -6.531578 2.333365</code></pre>
<pre><code>## -3.214249 -1.209959</code></pre>
<pre><code>## -4.090612 -1.553181</code></pre>
<pre><code>## -2.058494 2.301793</code></pre>
<pre><code>## -9.836359 2.234878</code></pre>
<pre><code>## -6.531578 2.333365</code></pre>
<pre><code>## -3.214249 -1.209959</code></pre>
<pre><code>## -4.090612 -1.553181</code></pre>
<pre><code>## -2.058494 2.301793</code></pre>
<pre><code>## -9.836359 2.234878</code></pre>
<pre><code>## -6.531578 2.333365</code></pre>
<pre><code>## -3.214249 -1.209959</code></pre>
<pre><code>## -4.090612 -1.553181</code></pre>
<pre><code>## -2.058494 2.301793</code></pre>
</div>
</div>
</div>
<div id="identifying-best-methods-1" class="section level2 hasAnchor" number="3.7">
<h2><span class="header-section-number">3.7</span> Identifying best methods<a href="lalonde-nsw-data.html#identifying-best-methods-1" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div class="sourceCode" id="cb497"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb497-1"><a href="lalonde-nsw-data.html#cb497-1" tabindex="-1"></a><span class="co"># combine all results</span></span>
<span id="cb497-2"><a href="lalonde-nsw-data.html#cb497-2" tabindex="-1"></a>all_cps <span class="ot">&lt;-</span> <span class="fu">combine_results</span>(<span class="st">&quot;cps&quot;</span>)</span>
<span id="cb497-3"><a href="lalonde-nsw-data.html#cb497-3" tabindex="-1"></a>all_psid <span class="ot">&lt;-</span> <span class="fu">combine_results</span>(<span class="st">&quot;psid&quot;</span>) </span></code></pre></div>
<div class="sourceCode" id="cb498"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb498-1"><a href="lalonde-nsw-data.html#cb498-1" tabindex="-1"></a><span class="co"># save results </span></span>
<span id="cb498-2"><a href="lalonde-nsw-data.html#cb498-2" tabindex="-1"></a><span class="fu">save_csv</span>(all_cps, <span class="st">&quot;nsw_cps1_all_results&quot;</span>)</span>
<span id="cb498-3"><a href="lalonde-nsw-data.html#cb498-3" tabindex="-1"></a><span class="fu">save_csv</span>(all_psid, <span class="st">&quot;nsw_psid1_all_results&quot;</span>)</span></code></pre></div>
<div class="sourceCode" id="cb499"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb499-1"><a href="lalonde-nsw-data.html#cb499-1" tabindex="-1"></a><span class="co"># rank methods </span></span>
<span id="cb499-2"><a href="lalonde-nsw-data.html#cb499-2" tabindex="-1"></a>ranked_cps  <span class="ot">&lt;-</span> <span class="fu">assess_methods</span>(all_cps)</span>
<span id="cb499-3"><a href="lalonde-nsw-data.html#cb499-3" tabindex="-1"></a>ranked_psid <span class="ot">&lt;-</span> <span class="fu">assess_methods</span>(all_psid)</span></code></pre></div>
<div class="sourceCode" id="cb500"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb500-1"><a href="lalonde-nsw-data.html#cb500-1" tabindex="-1"></a><span class="co"># get top 5 methods </span></span>
<span id="cb500-2"><a href="lalonde-nsw-data.html#cb500-2" tabindex="-1"></a>top5_methods.cps <span class="ot">&lt;-</span> <span class="fu">get_top_methods</span>(ranked_cps, <span class="at">top_n =</span> <span class="dv">5</span>)</span>
<span id="cb500-3"><a href="lalonde-nsw-data.html#cb500-3" tabindex="-1"></a>top5_methods.psid <span class="ot">&lt;-</span> <span class="fu">get_top_methods</span>(ranked_psid, <span class="at">top_n =</span> <span class="dv">5</span>)</span>
<span id="cb500-4"><a href="lalonde-nsw-data.html#cb500-4" tabindex="-1"></a></span>
<span id="cb500-5"><a href="lalonde-nsw-data.html#cb500-5" tabindex="-1"></a><span class="co"># print results</span></span>
<span id="cb500-6"><a href="lalonde-nsw-data.html#cb500-6" tabindex="-1"></a>top5_methods_df.cps <span class="ot">&lt;-</span> ranked_cps <span class="sc">%&gt;%</span> <span class="fu">arrange</span>(<span class="fu">desc</span>(Score)) <span class="sc">%&gt;%</span> <span class="fu">head</span>(<span class="dv">5</span>)</span>
<span id="cb500-7"><a href="lalonde-nsw-data.html#cb500-7" tabindex="-1"></a>top5_methods_df.psid <span class="ot">&lt;-</span> ranked_psid <span class="sc">%&gt;%</span> <span class="fu">arrange</span>(<span class="fu">desc</span>(Score)) <span class="sc">%&gt;%</span> <span class="fu">head</span>(<span class="dv">5</span>)</span>
<span id="cb500-8"><a href="lalonde-nsw-data.html#cb500-8" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">kable</span>(top5_methods_df.cps, <span class="at">caption =</span> <span class="st">&quot;Top 5 Methods for CPS1&quot;</span>, <span class="at">booktabs =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
<table>
<caption><span id="tab:unnamed-chunk-256">Table 3.3: </span>Top 5 Methods for CPS1</caption>
<thead>
<tr class="header">
<th align="left">Method</th>
<th align="right">Score</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">mahvars</td>
<td align="right">0.7357153</td>
</tr>
<tr class="even">
<td align="left">k3</td>
<td align="right">0.7291071</td>
</tr>
<tr class="odd">
<td align="left">exact</td>
<td align="right">0.7290518</td>
</tr>
<tr class="even">
<td align="left">cem</td>
<td align="right">0.7265186</td>
</tr>
<tr class="odd">
<td align="left">card</td>
<td align="right">0.7233095</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb501"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb501-1"><a href="lalonde-nsw-data.html#cb501-1" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">kable</span>(top5_methods_df.psid, <span class="at">caption =</span> <span class="st">&quot;Top 5 Methods for PSID1&quot;</span>, <span class="at">booktabs =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
<table>
<caption><span id="tab:unnamed-chunk-256">Table 3.3: </span>Top 5 Methods for PSID1</caption>
<thead>
<tr class="header">
<th align="left">Method</th>
<th align="right">Score</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">card</td>
<td align="right">0.7547055</td>
</tr>
<tr class="even">
<td align="left">mahvars</td>
<td align="right">0.7478798</td>
</tr>
<tr class="odd">
<td align="left">optimal_pair</td>
<td align="right">0.6751910</td>
</tr>
<tr class="even">
<td align="left">fix_max_value_opt_weight</td>
<td align="right">0.6125277</td>
</tr>
<tr class="odd">
<td align="left">exact</td>
<td align="right">0.6029221</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb502"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb502-1"><a href="lalonde-nsw-data.html#cb502-1" tabindex="-1"></a><span class="co"># save results </span></span>
<span id="cb502-2"><a href="lalonde-nsw-data.html#cb502-2" tabindex="-1"></a><span class="fu">save_csv</span>(top5_methods.cps, <span class="st">&quot;nsw_cps1_top5_methods&quot;</span>)</span>
<span id="cb502-3"><a href="lalonde-nsw-data.html#cb502-3" tabindex="-1"></a><span class="fu">save_csv</span>(top5_methods.psid, <span class="st">&quot;nsw_psid1_top5_methods&quot;</span>)</span></code></pre></div>
<p>The table shows that CPS1 and PSID1 share the same top five methods, with the exception of one differing method and a variation in their ordering for PSID1.</p>
<div class="sourceCode" id="cb503"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb503-1"><a href="lalonde-nsw-data.html#cb503-1" tabindex="-1"></a>dataset_list_cps <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb503-2"><a href="lalonde-nsw-data.html#cb503-2" tabindex="-1"></a>  <span class="st">&quot;All&quot;</span> <span class="ot">=</span> nsw_cps,</span>
<span id="cb503-3"><a href="lalonde-nsw-data.html#cb503-3" tabindex="-1"></a>  <span class="st">&quot;original&quot;</span> <span class="ot">=</span> nsw_cps,</span>
<span id="cb503-4"><a href="lalonde-nsw-data.html#cb503-4" tabindex="-1"></a>  <span class="st">&quot;nn&quot;</span> <span class="ot">=</span> m.out.cps.nearest, </span>
<span id="cb503-5"><a href="lalonde-nsw-data.html#cb503-5" tabindex="-1"></a>  <span class="st">&quot;caliper&quot;</span> <span class="ot">=</span> m.out.cps.caliper,</span>
<span id="cb503-6"><a href="lalonde-nsw-data.html#cb503-6" tabindex="-1"></a>  <span class="st">&quot;card&quot;</span> <span class="ot">=</span> m.out.cps.card,</span>
<span id="cb503-7"><a href="lalonde-nsw-data.html#cb503-7" tabindex="-1"></a>  <span class="st">&quot;cem&quot;</span> <span class="ot">=</span> m.out.cps.cem,</span>
<span id="cb503-8"><a href="lalonde-nsw-data.html#cb503-8" tabindex="-1"></a>  <span class="st">&quot;cS&quot;</span> <span class="ot">=</span> m.out.cps.cs,</span>
<span id="cb503-9"><a href="lalonde-nsw-data.html#cb503-9" tabindex="-1"></a>  <span class="st">&quot;k2&quot;</span>  <span class="ot">=</span> m.out.cps.k2,</span>
<span id="cb503-10"><a href="lalonde-nsw-data.html#cb503-10" tabindex="-1"></a>  <span class="st">&quot;k3&quot;</span> <span class="ot">=</span> m.out.cps.k3,</span>
<span id="cb503-11"><a href="lalonde-nsw-data.html#cb503-11" tabindex="-1"></a>  <span class="st">&quot;mahvars&quot;</span> <span class="ot">=</span> m.out.cps.mahvars,</span>
<span id="cb503-12"><a href="lalonde-nsw-data.html#cb503-12" tabindex="-1"></a>  <span class="st">&quot;optimal_full&quot;</span> <span class="ot">=</span> m.out.cps.optimal_full,</span>
<span id="cb503-13"><a href="lalonde-nsw-data.html#cb503-13" tabindex="-1"></a>  <span class="st">&quot;optimal_pair&quot;</span> <span class="ot">=</span> m.out.cps.optimal_pair,</span>
<span id="cb503-14"><a href="lalonde-nsw-data.html#cb503-14" tabindex="-1"></a>  <span class="st">&quot;gen_full&quot;</span> <span class="ot">=</span> m.out.cps.general_full,</span>
<span id="cb503-15"><a href="lalonde-nsw-data.html#cb503-15" tabindex="-1"></a>  <span class="st">&quot;genetic&quot;</span> <span class="ot">=</span> m.out.cps.genetic,</span>
<span id="cb503-16"><a href="lalonde-nsw-data.html#cb503-16" tabindex="-1"></a>  <span class="st">&quot;exact&quot;</span> <span class="ot">=</span> m.out.cps.exact,</span>
<span id="cb503-17"><a href="lalonde-nsw-data.html#cb503-17" tabindex="-1"></a>  <span class="st">&quot;subcl&quot;</span> <span class="ot">=</span> m.out.cps.subcl,</span>
<span id="cb503-18"><a href="lalonde-nsw-data.html#cb503-18" tabindex="-1"></a>  <span class="st">&quot;profile&quot;</span>  <span class="ot">=</span> m.out.cps.profile,</span>
<span id="cb503-19"><a href="lalonde-nsw-data.html#cb503-19" tabindex="-1"></a>  <span class="st">&quot;ipw_weight&quot;</span> <span class="ot">=</span> nsw_cps<span class="sc">$</span>ipw_weight, </span>
<span id="cb503-20"><a href="lalonde-nsw-data.html#cb503-20" tabindex="-1"></a>  <span class="st">&quot;opt_weight&quot;</span> <span class="ot">=</span> nsw_cps<span class="sc">$</span>opt_weight,</span>
<span id="cb503-21"><a href="lalonde-nsw-data.html#cb503-21" tabindex="-1"></a>  <span class="st">&quot;cbps_weight&quot;</span> <span class="ot">=</span> nsw_cps<span class="sc">$</span>cbps_weight,</span>
<span id="cb503-22"><a href="lalonde-nsw-data.html#cb503-22" tabindex="-1"></a>  <span class="st">&quot;ebal_weight&quot;</span> <span class="ot">=</span> nsw_cps<span class="sc">$</span>ebal_weight,</span>
<span id="cb503-23"><a href="lalonde-nsw-data.html#cb503-23" tabindex="-1"></a>  <span class="st">&quot;fix_max_value_ipw_weight&quot;</span> <span class="ot">=</span> nsw_cps.fixed<span class="sc">$</span>ipw_weight,</span>
<span id="cb503-24"><a href="lalonde-nsw-data.html#cb503-24" tabindex="-1"></a>  <span class="st">&quot;fix_max_value_opt_weight&quot;</span> <span class="ot">=</span> nsw_cps.fixed<span class="sc">$</span>opt_weight,</span>
<span id="cb503-25"><a href="lalonde-nsw-data.html#cb503-25" tabindex="-1"></a>  <span class="st">&quot;fix_max_value_cbps_weight&quot;</span> <span class="ot">=</span> nsw_cps.fixed<span class="sc">$</span>cbps_weight,</span>
<span id="cb503-26"><a href="lalonde-nsw-data.html#cb503-26" tabindex="-1"></a>  <span class="st">&quot;fix_max_value_ebal_weight&quot;</span> <span class="ot">=</span> nsw_cps.fixed<span class="sc">$</span>ebal_weight,</span>
<span id="cb503-27"><a href="lalonde-nsw-data.html#cb503-27" tabindex="-1"></a>  <span class="st">&quot;at_perc_ipw_weight&quot;</span> <span class="ot">=</span> nsw_cps.percent<span class="sc">$</span>ipw_weight,</span>
<span id="cb503-28"><a href="lalonde-nsw-data.html#cb503-28" tabindex="-1"></a>  <span class="st">&quot;at_perc_opt_weight&quot;</span> <span class="ot">=</span> nsw_cps.percent<span class="sc">$</span>opt_weight,</span>
<span id="cb503-29"><a href="lalonde-nsw-data.html#cb503-29" tabindex="-1"></a>  <span class="st">&quot;at_perc_cbps_weight&quot;</span> <span class="ot">=</span> nsw_cps.percent<span class="sc">$</span>cbps_weight,</span>
<span id="cb503-30"><a href="lalonde-nsw-data.html#cb503-30" tabindex="-1"></a>  <span class="st">&quot;at_perc_ebal_weight&quot;</span> <span class="ot">=</span> nsw_cps.percent<span class="sc">$</span>ebal_weight,</span>
<span id="cb503-31"><a href="lalonde-nsw-data.html#cb503-31" tabindex="-1"></a>  <span class="st">&quot;adap_weight_ipw_weight&quot;</span> <span class="ot">=</span> nsw_cps.adapt<span class="sc">$</span>ipw_weight,</span>
<span id="cb503-32"><a href="lalonde-nsw-data.html#cb503-32" tabindex="-1"></a>  <span class="st">&quot;adap_weight_opt_weight&quot;</span> <span class="ot">=</span> nsw_cps.adapt<span class="sc">$</span>opt_weight,</span>
<span id="cb503-33"><a href="lalonde-nsw-data.html#cb503-33" tabindex="-1"></a>  <span class="st">&quot;adap_weight_cbps_weight&quot;</span> <span class="ot">=</span> nsw_cps.adapt<span class="sc">$</span>cbps_weight,</span>
<span id="cb503-34"><a href="lalonde-nsw-data.html#cb503-34" tabindex="-1"></a>  <span class="st">&quot;adap_weight_ebal_weight&quot;</span> <span class="ot">=</span> nsw_cps.adapt<span class="sc">$</span>ebal_weight,</span>
<span id="cb503-35"><a href="lalonde-nsw-data.html#cb503-35" tabindex="-1"></a>  <span class="st">&quot;ps_threshold&quot;</span> <span class="ot">=</span> nsw_cps.trim,</span>
<span id="cb503-36"><a href="lalonde-nsw-data.html#cb503-36" tabindex="-1"></a>  <span class="st">&quot;common_range&quot;</span> <span class="ot">=</span> nsw_cps.common,</span>
<span id="cb503-37"><a href="lalonde-nsw-data.html#cb503-37" tabindex="-1"></a>  <span class="st">&quot;stuermer&quot;</span> <span class="ot">=</span> nsw_cps.stuermer,</span>
<span id="cb503-38"><a href="lalonde-nsw-data.html#cb503-38" tabindex="-1"></a>  <span class="st">&quot;walker&quot;</span> <span class="ot">=</span> nsw_cps.walker,</span>
<span id="cb503-39"><a href="lalonde-nsw-data.html#cb503-39" tabindex="-1"></a>  <span class="st">&quot;crump&quot;</span> <span class="ot">=</span> nsw_cps.crump,</span>
<span id="cb503-40"><a href="lalonde-nsw-data.html#cb503-40" tabindex="-1"></a>  <span class="st">&quot;ipw_common_range&quot;</span> <span class="ot">=</span> ipw_comb.cps[[<span class="dv">1</span>]],</span>
<span id="cb503-41"><a href="lalonde-nsw-data.html#cb503-41" tabindex="-1"></a>  <span class="st">&quot;ipw_crump&quot;</span><span class="ot">=</span> ipw_comb.cps[[<span class="dv">2</span>]],</span>
<span id="cb503-42"><a href="lalonde-nsw-data.html#cb503-42" tabindex="-1"></a>  <span class="st">&quot;ipw_ps_threshold&quot;</span><span class="ot">=</span> ipw_comb.cps[[<span class="dv">3</span>]],</span>
<span id="cb503-43"><a href="lalonde-nsw-data.html#cb503-43" tabindex="-1"></a>  <span class="st">&quot;ipw_stuermer&quot;</span><span class="ot">=</span> ipw_comb.cps[[<span class="dv">4</span>]],</span>
<span id="cb503-44"><a href="lalonde-nsw-data.html#cb503-44" tabindex="-1"></a>  <span class="st">&quot;ipw_walker&quot;</span> <span class="ot">=</span> ipw_comb.cps[[<span class="dv">5</span>]],</span>
<span id="cb503-45"><a href="lalonde-nsw-data.html#cb503-45" tabindex="-1"></a>  <span class="st">&quot;opt_common_range&quot;</span> <span class="ot">=</span> opt_comb.cps[[<span class="dv">1</span>]],</span>
<span id="cb503-46"><a href="lalonde-nsw-data.html#cb503-46" tabindex="-1"></a>  <span class="st">&quot;opt_crump&quot;</span> <span class="ot">=</span> opt_comb.cps[[<span class="dv">2</span>]],</span>
<span id="cb503-47"><a href="lalonde-nsw-data.html#cb503-47" tabindex="-1"></a>  <span class="st">&quot;opt_ps_threshold&quot;</span> <span class="ot">=</span> opt_comb.cps[[<span class="dv">3</span>]],</span>
<span id="cb503-48"><a href="lalonde-nsw-data.html#cb503-48" tabindex="-1"></a>  <span class="st">&quot;opt_stuermer&quot;</span> <span class="ot">=</span> opt_comb.cps[[<span class="dv">4</span>]],</span>
<span id="cb503-49"><a href="lalonde-nsw-data.html#cb503-49" tabindex="-1"></a>  <span class="st">&quot;opt_walker&quot;</span> <span class="ot">=</span> opt_comb.cps[[<span class="dv">5</span>]],</span>
<span id="cb503-50"><a href="lalonde-nsw-data.html#cb503-50" tabindex="-1"></a>  <span class="st">&quot;cbps_common_range&quot;</span> <span class="ot">=</span> cbps_comb.cps[[<span class="dv">1</span>]],</span>
<span id="cb503-51"><a href="lalonde-nsw-data.html#cb503-51" tabindex="-1"></a>  <span class="st">&quot;cbps_crump&quot;</span> <span class="ot">=</span> cbps_comb.cps[[<span class="dv">2</span>]],</span>
<span id="cb503-52"><a href="lalonde-nsw-data.html#cb503-52" tabindex="-1"></a>  <span class="st">&quot;cbps_ps_threshold&quot;</span>  <span class="ot">=</span> cbps_comb.cps[[<span class="dv">3</span>]],</span>
<span id="cb503-53"><a href="lalonde-nsw-data.html#cb503-53" tabindex="-1"></a>  <span class="st">&quot;cbps_stuermer&quot;</span> <span class="ot">=</span> cbps_comb.cps[[<span class="dv">4</span>]],</span>
<span id="cb503-54"><a href="lalonde-nsw-data.html#cb503-54" tabindex="-1"></a>  <span class="st">&quot;cbps_walker&quot;</span><span class="ot">=</span> cbps_comb.cps[[<span class="dv">5</span>]],</span>
<span id="cb503-55"><a href="lalonde-nsw-data.html#cb503-55" tabindex="-1"></a>  <span class="st">&quot;ebal_common_range&quot;</span> <span class="ot">=</span> ebal_comb.cps[[<span class="dv">1</span>]],</span>
<span id="cb503-56"><a href="lalonde-nsw-data.html#cb503-56" tabindex="-1"></a>  <span class="st">&quot;ebal_crump&quot;</span> <span class="ot">=</span> ebal_comb.cps[[<span class="dv">2</span>]],</span>
<span id="cb503-57"><a href="lalonde-nsw-data.html#cb503-57" tabindex="-1"></a>  <span class="st">&quot;ebal_ps_threshold&quot;</span> <span class="ot">=</span> ebal_comb.cps[[<span class="dv">3</span>]],</span>
<span id="cb503-58"><a href="lalonde-nsw-data.html#cb503-58" tabindex="-1"></a>  <span class="st">&quot;ebal_stuermer&quot;</span> <span class="ot">=</span> ebal_comb.cps[[<span class="dv">4</span>]],</span>
<span id="cb503-59"><a href="lalonde-nsw-data.html#cb503-59" tabindex="-1"></a>  <span class="st">&quot;ebal_walker&quot;</span> <span class="ot">=</span> ebal_comb.cps[[<span class="dv">5</span>]])</span>
<span id="cb503-60"><a href="lalonde-nsw-data.html#cb503-60" tabindex="-1"></a></span>
<span id="cb503-61"><a href="lalonde-nsw-data.html#cb503-61" tabindex="-1"></a>dataset_list_psid <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb503-62"><a href="lalonde-nsw-data.html#cb503-62" tabindex="-1"></a>  <span class="st">&quot;All&quot;</span> <span class="ot">=</span> nsw_psid,</span>
<span id="cb503-63"><a href="lalonde-nsw-data.html#cb503-63" tabindex="-1"></a>  <span class="st">&quot;original&quot;</span> <span class="ot">=</span> nsw_psid,</span>
<span id="cb503-64"><a href="lalonde-nsw-data.html#cb503-64" tabindex="-1"></a>  <span class="st">&quot;nn&quot;</span> <span class="ot">=</span> m.out.psid.nearest, </span>
<span id="cb503-65"><a href="lalonde-nsw-data.html#cb503-65" tabindex="-1"></a>  <span class="st">&quot;caliper&quot;</span> <span class="ot">=</span> m.out.psid.caliper,</span>
<span id="cb503-66"><a href="lalonde-nsw-data.html#cb503-66" tabindex="-1"></a>  <span class="st">&quot;card&quot;</span> <span class="ot">=</span> m.out.psid.card,</span>
<span id="cb503-67"><a href="lalonde-nsw-data.html#cb503-67" tabindex="-1"></a>  <span class="st">&quot;cem&quot;</span> <span class="ot">=</span> m.out.psid.cem,</span>
<span id="cb503-68"><a href="lalonde-nsw-data.html#cb503-68" tabindex="-1"></a>  <span class="st">&quot;cS&quot;</span> <span class="ot">=</span> m.out.psid.cs,</span>
<span id="cb503-69"><a href="lalonde-nsw-data.html#cb503-69" tabindex="-1"></a>  <span class="st">&quot;k2&quot;</span>  <span class="ot">=</span> m.out.psid.k2,</span>
<span id="cb503-70"><a href="lalonde-nsw-data.html#cb503-70" tabindex="-1"></a>  <span class="st">&quot;k3&quot;</span> <span class="ot">=</span> m.out.psid.k3,</span>
<span id="cb503-71"><a href="lalonde-nsw-data.html#cb503-71" tabindex="-1"></a>  <span class="st">&quot;mahvars&quot;</span> <span class="ot">=</span> m.out.psid.mahvars,</span>
<span id="cb503-72"><a href="lalonde-nsw-data.html#cb503-72" tabindex="-1"></a>  <span class="st">&quot;optimal_full&quot;</span> <span class="ot">=</span> m.out.psid.optimal_full,</span>
<span id="cb503-73"><a href="lalonde-nsw-data.html#cb503-73" tabindex="-1"></a>  <span class="st">&quot;optimal_pair&quot;</span> <span class="ot">=</span> m.out.psid.optimal_pair,</span>
<span id="cb503-74"><a href="lalonde-nsw-data.html#cb503-74" tabindex="-1"></a>  <span class="st">&quot;gen_full&quot;</span> <span class="ot">=</span> m.out.psid.general_full,</span>
<span id="cb503-75"><a href="lalonde-nsw-data.html#cb503-75" tabindex="-1"></a>  <span class="st">&quot;genetic&quot;</span> <span class="ot">=</span> m.out.psid.genetic,</span>
<span id="cb503-76"><a href="lalonde-nsw-data.html#cb503-76" tabindex="-1"></a>  <span class="st">&quot;exact&quot;</span> <span class="ot">=</span> m.out.psid.exact,</span>
<span id="cb503-77"><a href="lalonde-nsw-data.html#cb503-77" tabindex="-1"></a>  <span class="st">&quot;subcl&quot;</span> <span class="ot">=</span> m.out.psid.subcl,</span>
<span id="cb503-78"><a href="lalonde-nsw-data.html#cb503-78" tabindex="-1"></a>  <span class="st">&quot;profile&quot;</span>  <span class="ot">=</span> m.out.psid.profile,</span>
<span id="cb503-79"><a href="lalonde-nsw-data.html#cb503-79" tabindex="-1"></a>  <span class="st">&quot;ipw_weight&quot;</span> <span class="ot">=</span> nsw_psid<span class="sc">$</span>ipw_weight, </span>
<span id="cb503-80"><a href="lalonde-nsw-data.html#cb503-80" tabindex="-1"></a>  <span class="st">&quot;opt_weight&quot;</span> <span class="ot">=</span> nsw_psid<span class="sc">$</span>opt_weight,</span>
<span id="cb503-81"><a href="lalonde-nsw-data.html#cb503-81" tabindex="-1"></a>  <span class="st">&quot;cbps_weight&quot;</span> <span class="ot">=</span> nsw_psid<span class="sc">$</span>cbps_weight,</span>
<span id="cb503-82"><a href="lalonde-nsw-data.html#cb503-82" tabindex="-1"></a>  <span class="st">&quot;ebal_weight&quot;</span> <span class="ot">=</span> nsw_psid<span class="sc">$</span>ebal_weight,</span>
<span id="cb503-83"><a href="lalonde-nsw-data.html#cb503-83" tabindex="-1"></a>  <span class="st">&quot;fix_max_value_ipw_weight&quot;</span> <span class="ot">=</span> nsw_psid.fixed<span class="sc">$</span>ipw_weight,</span>
<span id="cb503-84"><a href="lalonde-nsw-data.html#cb503-84" tabindex="-1"></a>  <span class="st">&quot;fix_max_value_opt_weight&quot;</span> <span class="ot">=</span> nsw_psid.fixed<span class="sc">$</span>opt_weight,</span>
<span id="cb503-85"><a href="lalonde-nsw-data.html#cb503-85" tabindex="-1"></a>  <span class="st">&quot;fix_max_value_cbps_weight&quot;</span> <span class="ot">=</span> nsw_psid.fixed<span class="sc">$</span>cbps_weight,</span>
<span id="cb503-86"><a href="lalonde-nsw-data.html#cb503-86" tabindex="-1"></a>  <span class="st">&quot;fix_max_value_ebal_weight&quot;</span> <span class="ot">=</span> nsw_psid.fixed<span class="sc">$</span>ebal_weight,</span>
<span id="cb503-87"><a href="lalonde-nsw-data.html#cb503-87" tabindex="-1"></a>  <span class="st">&quot;at_perc_ipw_weight&quot;</span> <span class="ot">=</span> nsw_psid.percent<span class="sc">$</span>ipw_weight,</span>
<span id="cb503-88"><a href="lalonde-nsw-data.html#cb503-88" tabindex="-1"></a>  <span class="st">&quot;at_perc_opt_weight&quot;</span> <span class="ot">=</span> nsw_psid.percent<span class="sc">$</span>opt_weight,</span>
<span id="cb503-89"><a href="lalonde-nsw-data.html#cb503-89" tabindex="-1"></a>  <span class="st">&quot;at_perc_cbps_weight&quot;</span> <span class="ot">=</span> nsw_psid.percent<span class="sc">$</span>cbps_weight,</span>
<span id="cb503-90"><a href="lalonde-nsw-data.html#cb503-90" tabindex="-1"></a>  <span class="st">&quot;at_perc_ebal_weight&quot;</span> <span class="ot">=</span> nsw_psid.percent<span class="sc">$</span>ebal_weight,</span>
<span id="cb503-91"><a href="lalonde-nsw-data.html#cb503-91" tabindex="-1"></a>  <span class="st">&quot;adap_weight_ipw_weight&quot;</span> <span class="ot">=</span> nsw_psid.adapt<span class="sc">$</span>ipw_weight,</span>
<span id="cb503-92"><a href="lalonde-nsw-data.html#cb503-92" tabindex="-1"></a>  <span class="st">&quot;adap_weight_opt_weight&quot;</span> <span class="ot">=</span> nsw_psid.adapt<span class="sc">$</span>opt_weight,</span>
<span id="cb503-93"><a href="lalonde-nsw-data.html#cb503-93" tabindex="-1"></a>  <span class="st">&quot;adap_weight_cbps_weight&quot;</span> <span class="ot">=</span> nsw_psid.adapt<span class="sc">$</span>cbps_weight,</span>
<span id="cb503-94"><a href="lalonde-nsw-data.html#cb503-94" tabindex="-1"></a>  <span class="st">&quot;adap_weight_ebal_weight&quot;</span> <span class="ot">=</span> nsw_psid.adapt<span class="sc">$</span>ebal_weight,</span>
<span id="cb503-95"><a href="lalonde-nsw-data.html#cb503-95" tabindex="-1"></a>  <span class="st">&quot;ps_threshold&quot;</span> <span class="ot">=</span> nsw_psid.trim,</span>
<span id="cb503-96"><a href="lalonde-nsw-data.html#cb503-96" tabindex="-1"></a>  <span class="st">&quot;common_range&quot;</span> <span class="ot">=</span> nsw_psid.common,</span>
<span id="cb503-97"><a href="lalonde-nsw-data.html#cb503-97" tabindex="-1"></a>  <span class="st">&quot;stuermer&quot;</span> <span class="ot">=</span> nsw_psid.stuermer,</span>
<span id="cb503-98"><a href="lalonde-nsw-data.html#cb503-98" tabindex="-1"></a>  <span class="st">&quot;walker&quot;</span> <span class="ot">=</span> nsw_psid.walker,</span>
<span id="cb503-99"><a href="lalonde-nsw-data.html#cb503-99" tabindex="-1"></a>  <span class="st">&quot;crump&quot;</span> <span class="ot">=</span> nsw_psid.crump,</span>
<span id="cb503-100"><a href="lalonde-nsw-data.html#cb503-100" tabindex="-1"></a>  <span class="st">&quot;ipw_common_range&quot;</span> <span class="ot">=</span> ipw_comb.psid[[<span class="dv">1</span>]],</span>
<span id="cb503-101"><a href="lalonde-nsw-data.html#cb503-101" tabindex="-1"></a>  <span class="st">&quot;ipw_crump&quot;</span><span class="ot">=</span> ipw_comb.psid[[<span class="dv">2</span>]],</span>
<span id="cb503-102"><a href="lalonde-nsw-data.html#cb503-102" tabindex="-1"></a>  <span class="st">&quot;ipw_ps_threshold&quot;</span><span class="ot">=</span> ipw_comb.psid[[<span class="dv">3</span>]],</span>
<span id="cb503-103"><a href="lalonde-nsw-data.html#cb503-103" tabindex="-1"></a>  <span class="st">&quot;ipw_stuermer&quot;</span><span class="ot">=</span> ipw_comb.psid[[<span class="dv">4</span>]],</span>
<span id="cb503-104"><a href="lalonde-nsw-data.html#cb503-104" tabindex="-1"></a>  <span class="st">&quot;ipw_walker&quot;</span> <span class="ot">=</span> ipw_comb.psid[[<span class="dv">5</span>]],</span>
<span id="cb503-105"><a href="lalonde-nsw-data.html#cb503-105" tabindex="-1"></a>  <span class="st">&quot;opt_common_range&quot;</span> <span class="ot">=</span> opt_comb.psid[[<span class="dv">1</span>]],</span>
<span id="cb503-106"><a href="lalonde-nsw-data.html#cb503-106" tabindex="-1"></a>  <span class="st">&quot;opt_crump&quot;</span> <span class="ot">=</span> opt_comb.psid[[<span class="dv">2</span>]],</span>
<span id="cb503-107"><a href="lalonde-nsw-data.html#cb503-107" tabindex="-1"></a>  <span class="st">&quot;opt_ps_threshold&quot;</span> <span class="ot">=</span> opt_comb.psid[[<span class="dv">3</span>]],</span>
<span id="cb503-108"><a href="lalonde-nsw-data.html#cb503-108" tabindex="-1"></a>  <span class="st">&quot;opt_stuermer&quot;</span> <span class="ot">=</span> opt_comb.psid[[<span class="dv">4</span>]],</span>
<span id="cb503-109"><a href="lalonde-nsw-data.html#cb503-109" tabindex="-1"></a>  <span class="st">&quot;opt_walker&quot;</span> <span class="ot">=</span> opt_comb.psid[[<span class="dv">5</span>]],</span>
<span id="cb503-110"><a href="lalonde-nsw-data.html#cb503-110" tabindex="-1"></a>  <span class="st">&quot;cbps_common_range&quot;</span> <span class="ot">=</span> cbps_comb.psid[[<span class="dv">1</span>]],</span>
<span id="cb503-111"><a href="lalonde-nsw-data.html#cb503-111" tabindex="-1"></a>  <span class="st">&quot;cbps_crump&quot;</span> <span class="ot">=</span> cbps_comb.psid[[<span class="dv">2</span>]],</span>
<span id="cb503-112"><a href="lalonde-nsw-data.html#cb503-112" tabindex="-1"></a>  <span class="st">&quot;cbps_ps_threshold&quot;</span>  <span class="ot">=</span> cbps_comb.psid[[<span class="dv">3</span>]],</span>
<span id="cb503-113"><a href="lalonde-nsw-data.html#cb503-113" tabindex="-1"></a>  <span class="st">&quot;cbps_stuermer&quot;</span> <span class="ot">=</span> cbps_comb.psid[[<span class="dv">4</span>]],</span>
<span id="cb503-114"><a href="lalonde-nsw-data.html#cb503-114" tabindex="-1"></a>  <span class="st">&quot;cbps_walker&quot;</span><span class="ot">=</span> cbps_comb.psid[[<span class="dv">5</span>]],</span>
<span id="cb503-115"><a href="lalonde-nsw-data.html#cb503-115" tabindex="-1"></a>  <span class="st">&quot;ebal_common_range&quot;</span> <span class="ot">=</span> ebal_comb.psid[[<span class="dv">1</span>]],</span>
<span id="cb503-116"><a href="lalonde-nsw-data.html#cb503-116" tabindex="-1"></a>  <span class="st">&quot;ebal_crump&quot;</span> <span class="ot">=</span> ebal_comb.psid[[<span class="dv">2</span>]],</span>
<span id="cb503-117"><a href="lalonde-nsw-data.html#cb503-117" tabindex="-1"></a>  <span class="st">&quot;ebal_ps_threshold&quot;</span> <span class="ot">=</span> ebal_comb.psid[[<span class="dv">3</span>]],</span>
<span id="cb503-118"><a href="lalonde-nsw-data.html#cb503-118" tabindex="-1"></a>  <span class="st">&quot;ebal_stuermer&quot;</span> <span class="ot">=</span> ebal_comb.psid[[<span class="dv">4</span>]],</span>
<span id="cb503-119"><a href="lalonde-nsw-data.html#cb503-119" tabindex="-1"></a>  <span class="st">&quot;ebal_walker&quot;</span> <span class="ot">=</span> ebal_comb.psid[[<span class="dv">5</span>]])</span></code></pre></div>
<div class="sourceCode" id="cb504"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb504-1"><a href="lalonde-nsw-data.html#cb504-1" tabindex="-1"></a><span class="co"># create datasets corresponding to the top 5 methods for each dataset</span></span>
<span id="cb504-2"><a href="lalonde-nsw-data.html#cb504-2" tabindex="-1"></a>top5_datasets.cps <span class="ot">&lt;-</span> <span class="fu">create_top5_datasets</span>(dataset_list_cps, top5_methods.cps)</span>
<span id="cb504-3"><a href="lalonde-nsw-data.html#cb504-3" tabindex="-1"></a>top5_datasets.psid <span class="ot">&lt;-</span> <span class="fu">create_top5_datasets</span>(dataset_list_psid, top5_methods.psid)</span></code></pre></div>
<div class="sourceCode" id="cb505"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb505-1"><a href="lalonde-nsw-data.html#cb505-1" tabindex="-1"></a><span class="co"># save datasets into .RData files</span></span>
<span id="cb505-2"><a href="lalonde-nsw-data.html#cb505-2" tabindex="-1"></a><span class="fu">save_top5_datasets</span>(dataset_list_cps, top5_methods.cps, <span class="at">prefix =</span> <span class="st">&quot;nsw_cps1&quot;</span>)</span>
<span id="cb505-3"><a href="lalonde-nsw-data.html#cb505-3" tabindex="-1"></a><span class="fu">save_top5_datasets</span>(dataset_list_psid, top5_methods.psid, <span class="at">prefix =</span> <span class="st">&quot;nsw_psid1&quot;</span>)</span></code></pre></div>
</div>
<div id="estimating-2" class="section level2 hasAnchor" number="3.8">
<h2><span class="header-section-number">3.8</span> Estimating<a href="lalonde-nsw-data.html#estimating-2" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div id="average-treatment-effect-on-the-treated-att-1" class="section level3 hasAnchor" number="3.8.1">
<h3><span class="header-section-number">3.8.1</span> Average treatment effect on the treated (ATT)<a href="lalonde-nsw-data.html#average-treatment-effect-on-the-treated-att-1" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb506"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb506-1"><a href="lalonde-nsw-data.html#cb506-1" tabindex="-1"></a><span class="co"># estimate ATT</span></span>
<span id="cb506-2"><a href="lalonde-nsw-data.html#cb506-2" tabindex="-1"></a>out1 <span class="ot">&lt;-</span> <span class="fu">estimate_all</span>(nsw, <span class="st">&quot;re78&quot;</span>, <span class="st">&quot;treat&quot;</span>, covar)</span>
<span id="cb506-3"><a href="lalonde-nsw-data.html#cb506-3" tabindex="-1"></a>out2 <span class="ot">&lt;-</span> <span class="fu">estimate_all</span>(nsw_cps, <span class="st">&quot;re78&quot;</span>, <span class="st">&quot;treat&quot;</span>, covar)</span>
<span id="cb506-4"><a href="lalonde-nsw-data.html#cb506-4" tabindex="-1"></a>out3 <span class="ot">&lt;-</span> <span class="fu">estimate_all</span>(nsw_psid, <span class="st">&quot;re78&quot;</span>, <span class="st">&quot;treat&quot;</span>, covar)</span>
<span id="cb506-5"><a href="lalonde-nsw-data.html#cb506-5" tabindex="-1"></a></span>
<span id="cb506-6"><a href="lalonde-nsw-data.html#cb506-6" tabindex="-1"></a>out.cps <span class="ot">&lt;-</span> <span class="fu">lapply</span>(top5_datasets.cps, <span class="cf">function</span>(d) <span class="fu">estimate_all</span>(d, <span class="st">&quot;re78&quot;</span>, <span class="st">&quot;treat&quot;</span>, covar))</span>
<span id="cb506-7"><a href="lalonde-nsw-data.html#cb506-7" tabindex="-1"></a>out.psid <span class="ot">&lt;-</span> <span class="fu">lapply</span>(top5_datasets.psid, <span class="cf">function</span>(d) <span class="fu">estimate_all</span>(d, <span class="st">&quot;re78&quot;</span>, <span class="st">&quot;treat&quot;</span>, covar))</span>
<span id="cb506-8"><a href="lalonde-nsw-data.html#cb506-8" tabindex="-1"></a></span>
<span id="cb506-9"><a href="lalonde-nsw-data.html#cb506-9" tabindex="-1"></a>out4 <span class="ot">&lt;-</span> out.cps[[<span class="dv">1</span>]]</span>
<span id="cb506-10"><a href="lalonde-nsw-data.html#cb506-10" tabindex="-1"></a>out5 <span class="ot">&lt;-</span> out.cps[[<span class="dv">2</span>]]</span>
<span id="cb506-11"><a href="lalonde-nsw-data.html#cb506-11" tabindex="-1"></a>out6 <span class="ot">&lt;-</span> out.cps[[<span class="dv">3</span>]]</span>
<span id="cb506-12"><a href="lalonde-nsw-data.html#cb506-12" tabindex="-1"></a>out7 <span class="ot">&lt;-</span> out.cps[[<span class="dv">4</span>]]</span>
<span id="cb506-13"><a href="lalonde-nsw-data.html#cb506-13" tabindex="-1"></a>out8 <span class="ot">&lt;-</span> out.cps[[<span class="dv">5</span>]]</span>
<span id="cb506-14"><a href="lalonde-nsw-data.html#cb506-14" tabindex="-1"></a></span>
<span id="cb506-15"><a href="lalonde-nsw-data.html#cb506-15" tabindex="-1"></a>out9 <span class="ot">&lt;-</span> out.psid[[<span class="dv">1</span>]]</span>
<span id="cb506-16"><a href="lalonde-nsw-data.html#cb506-16" tabindex="-1"></a>out10 <span class="ot">&lt;-</span> out.psid[[<span class="dv">2</span>]]</span>
<span id="cb506-17"><a href="lalonde-nsw-data.html#cb506-17" tabindex="-1"></a>out11 <span class="ot">&lt;-</span> out.psid[[<span class="dv">3</span>]]</span>
<span id="cb506-18"><a href="lalonde-nsw-data.html#cb506-18" tabindex="-1"></a>out12 <span class="ot">&lt;-</span> out.psid[[<span class="dv">4</span>]]</span>
<span id="cb506-19"><a href="lalonde-nsw-data.html#cb506-19" tabindex="-1"></a>out13 <span class="ot">&lt;-</span> out.psid[[<span class="dv">5</span>]]</span></code></pre></div>
<div class="sourceCode" id="cb507"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb507-1"><a href="lalonde-nsw-data.html#cb507-1" tabindex="-1"></a><span class="co"># estimate ATT</span></span>
<span id="cb507-2"><a href="lalonde-nsw-data.html#cb507-2" tabindex="-1"></a><span class="fu">load</span>(<span class="st">&quot;data/trimmed.RData&quot;</span>)</span>
<span id="cb507-3"><a href="lalonde-nsw-data.html#cb507-3" tabindex="-1"></a>out14 <span class="ot">&lt;-</span> <span class="fu">estimate_all</span>(nsw_trim_cps, <span class="st">&quot;re78&quot;</span>, <span class="st">&quot;treat&quot;</span>, covar)</span>
<span id="cb507-4"><a href="lalonde-nsw-data.html#cb507-4" tabindex="-1"></a>out15 <span class="ot">&lt;-</span> <span class="fu">estimate_all</span>(nsw_trim_psid, <span class="st">&quot;re78&quot;</span>, <span class="st">&quot;treat&quot;</span>, covar)</span>
<span id="cb507-5"><a href="lalonde-nsw-data.html#cb507-5" tabindex="-1"></a>out16 <span class="ot">&lt;-</span> <span class="fu">estimate_all</span>(nsw_cps_trim_match, <span class="st">&quot;re78&quot;</span>, <span class="st">&quot;treat&quot;</span>, covar)</span>
<span id="cb507-6"><a href="lalonde-nsw-data.html#cb507-6" tabindex="-1"></a>out17 <span class="ot">&lt;-</span> <span class="fu">estimate_all</span>(nsw_psid_trim_match, <span class="st">&quot;re78&quot;</span>, <span class="st">&quot;treat&quot;</span>, covar)</span></code></pre></div>
<div class="sourceCode" id="cb508"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb508-1"><a href="lalonde-nsw-data.html#cb508-1" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">4</span>, <span class="dv">1</span>), <span class="at">mar =</span> <span class="fu">c</span>(<span class="dv">4</span>, <span class="dv">4</span>, <span class="dv">2</span>, <span class="dv">1</span>))</span>
<span id="cb508-2"><a href="lalonde-nsw-data.html#cb508-2" tabindex="-1"></a></span>
<span id="cb508-3"><a href="lalonde-nsw-data.html#cb508-3" tabindex="-1"></a><span class="co"># experimental benchmarks</span></span>
<span id="cb508-4"><a href="lalonde-nsw-data.html#cb508-4" tabindex="-1"></a>band.exp <span class="ot">&lt;-</span> out1[<span class="dv">1</span>, <span class="dv">3</span><span class="sc">:</span><span class="dv">4</span>]</span>
<span id="cb508-5"><a href="lalonde-nsw-data.html#cb508-5" tabindex="-1"></a>est.exp  <span class="ot">&lt;-</span> out1[<span class="dv">1</span>, <span class="dv">1</span>]</span>
<span id="cb508-6"><a href="lalonde-nsw-data.html#cb508-6" tabindex="-1"></a></span>
<span id="cb508-7"><a href="lalonde-nsw-data.html#cb508-7" tabindex="-1"></a><span class="co"># plot results</span></span>
<span id="cb508-8"><a href="lalonde-nsw-data.html#cb508-8" tabindex="-1"></a><span class="fu">plot_coef</span>(out1,  <span class="at">band =</span> band.exp, <span class="at">line =</span> est.exp, </span>
<span id="cb508-9"><a href="lalonde-nsw-data.html#cb508-9" tabindex="-1"></a>          <span class="at">ylim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">15500</span>, <span class="dv">5500</span>), <span class="at">main =</span> <span class="st">&quot;(A) NSW-Experimental&quot;</span>)</span>
<span id="cb508-10"><a href="lalonde-nsw-data.html#cb508-10" tabindex="-1"></a></span>
<span id="cb508-11"><a href="lalonde-nsw-data.html#cb508-11" tabindex="-1"></a><span class="fu">plot_coef</span>(out2,  <span class="at">band =</span> band.exp, <span class="at">line =</span> est.exp, </span>
<span id="cb508-12"><a href="lalonde-nsw-data.html#cb508-12" tabindex="-1"></a>          <span class="at">ylim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">15500</span>, <span class="dv">5500</span>), <span class="at">main =</span> <span class="st">&quot;(B) NSW-CPS1&quot;</span>)</span>
<span id="cb508-13"><a href="lalonde-nsw-data.html#cb508-13" tabindex="-1"></a></span>
<span id="cb508-14"><a href="lalonde-nsw-data.html#cb508-14" tabindex="-1"></a><span class="fu">plot_coef</span>(out3,  <span class="at">band =</span> band.exp, <span class="at">line =</span> est.exp,</span>
<span id="cb508-15"><a href="lalonde-nsw-data.html#cb508-15" tabindex="-1"></a>          <span class="at">ylim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">15500</span>, <span class="dv">5500</span>), <span class="at">main =</span> <span class="st">&quot;(C) NSW-PSID1&quot;</span>)</span>
<span id="cb508-16"><a href="lalonde-nsw-data.html#cb508-16" tabindex="-1"></a></span>
<span id="cb508-17"><a href="lalonde-nsw-data.html#cb508-17" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="fu">seq_along</span>(out.cps)) {</span>
<span id="cb508-18"><a href="lalonde-nsw-data.html#cb508-18" tabindex="-1"></a>  this_title <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">&quot;(&quot;</span>, LETTERS[i<span class="sc">+</span><span class="dv">2</span>], <span class="st">&quot;) Top CPS1: &quot;</span>, top5_methods.cps[i])</span>
<span id="cb508-19"><a href="lalonde-nsw-data.html#cb508-19" tabindex="-1"></a>  <span class="fu">plot_coef</span>(out.cps[[i]], <span class="at">band =</span> band.exp, <span class="at">line =</span> est.exp,</span>
<span id="cb508-20"><a href="lalonde-nsw-data.html#cb508-20" tabindex="-1"></a>            <span class="at">ylim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">15500</span>, <span class="dv">5500</span>), <span class="at">main =</span> this_title)</span>
<span id="cb508-21"><a href="lalonde-nsw-data.html#cb508-21" tabindex="-1"></a>}</span></code></pre></div>
<div class="figure"><span style="display:block;" id="fig:unnamed-chunk-263-1"></span>
<img src="Outcome-Weights_files/figure-html/unnamed-chunk-263-1.png" alt="FIGUREA10. SubfigureA:NSW-Experimental. SubfigureB:NSW-CPS1. SubfigureC:NSW-PSID1. SubfigureD-H:Top-NSW-CPS1. SubfigureI-M:Top-NSW-PSID1. ATT Estimates Given Unconfoundedness using NSW Samples" width="100%" />
<p class="caption">
Figure 3.84: FIGUREA10. SubfigureA:NSW-Experimental. SubfigureB:NSW-CPS1. SubfigureC:NSW-PSID1. SubfigureD-H:Top-NSW-CPS1. SubfigureI-M:Top-NSW-PSID1. ATT Estimates Given Unconfoundedness using NSW Samples
</p>
</div>
<div class="figure"><span style="display:block;" id="fig:unnamed-chunk-263-2"></span>
<img src="Outcome-Weights_files/figure-html/unnamed-chunk-263-2.png" alt="FIGUREA10. SubfigureA:NSW-Experimental. SubfigureB:NSW-CPS1. SubfigureC:NSW-PSID1. SubfigureD-H:Top-NSW-CPS1. SubfigureI-M:Top-NSW-PSID1. ATT Estimates Given Unconfoundedness using NSW Samples" width="100%" />
<p class="caption">
Figure 3.85: FIGUREA10. SubfigureA:NSW-Experimental. SubfigureB:NSW-CPS1. SubfigureC:NSW-PSID1. SubfigureD-H:Top-NSW-CPS1. SubfigureI-M:Top-NSW-PSID1. ATT Estimates Given Unconfoundedness using NSW Samples
</p>
</div>
<div class="sourceCode" id="cb509"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb509-1"><a href="lalonde-nsw-data.html#cb509-1" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="fu">seq_along</span>(out.psid)) {</span>
<span id="cb509-2"><a href="lalonde-nsw-data.html#cb509-2" tabindex="-1"></a>  this_title <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">&quot;(&quot;</span>, LETTERS[i<span class="sc">+</span><span class="dv">7</span>], <span class="st">&quot;) Top PSID1: &quot;</span>, top5_methods.psid[i])</span>
<span id="cb509-3"><a href="lalonde-nsw-data.html#cb509-3" tabindex="-1"></a>  <span class="fu">plot_coef</span>(out.psid[[i]], <span class="at">band =</span> band.exp, <span class="at">line =</span> est.exp,</span>
<span id="cb509-4"><a href="lalonde-nsw-data.html#cb509-4" tabindex="-1"></a>            <span class="at">ylim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">15500</span>, <span class="dv">5500</span>), <span class="at">main =</span> this_title)</span>
<span id="cb509-5"><a href="lalonde-nsw-data.html#cb509-5" tabindex="-1"></a>}</span></code></pre></div>
<div class="figure"><span style="display:block;" id="fig:unnamed-chunk-263-3"></span>
<img src="Outcome-Weights_files/figure-html/unnamed-chunk-263-3.png" alt="FIGUREA10. SubfigureA:NSW-Experimental. SubfigureB:NSW-CPS1. SubfigureC:NSW-PSID1. SubfigureD-H:Top-NSW-CPS1. SubfigureI-M:Top-NSW-PSID1. ATT Estimates Given Unconfoundedness using NSW Samples" width="100%" />
<p class="caption">
Figure 3.86: FIGUREA10. SubfigureA:NSW-Experimental. SubfigureB:NSW-CPS1. SubfigureC:NSW-PSID1. SubfigureD-H:Top-NSW-CPS1. SubfigureI-M:Top-NSW-PSID1. ATT Estimates Given Unconfoundedness using NSW Samples
</p>
</div>
<div class="figure"><span style="display:block;" id="fig:unnamed-chunk-263-4"></span>
<img src="Outcome-Weights_files/figure-html/unnamed-chunk-263-4.png" alt="FIGUREA10. SubfigureA:NSW-Experimental. SubfigureB:NSW-CPS1. SubfigureC:NSW-PSID1. SubfigureD-H:Top-NSW-CPS1. SubfigureI-M:Top-NSW-PSID1. ATT Estimates Given Unconfoundedness using NSW Samples" width="100%" />
<p class="caption">
Figure 3.87: FIGUREA10. SubfigureA:NSW-Experimental. SubfigureB:NSW-CPS1. SubfigureC:NSW-PSID1. SubfigureD-H:Top-NSW-CPS1. SubfigureI-M:Top-NSW-PSID1. ATT Estimates Given Unconfoundedness using NSW Samples
</p>
</div>
<div class="sourceCode" id="cb510"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb510-1"><a href="lalonde-nsw-data.html#cb510-1" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">4</span>, <span class="dv">1</span>), <span class="at">mar =</span> <span class="fu">c</span>(<span class="dv">4</span>, <span class="dv">4</span>, <span class="dv">2</span>, <span class="dv">1</span>))</span>
<span id="cb510-2"><a href="lalonde-nsw-data.html#cb510-2" tabindex="-1"></a><span class="fu">par</span>(<span class="at">cex.main =</span> <span class="fl">0.9</span>)</span>
<span id="cb510-3"><a href="lalonde-nsw-data.html#cb510-3" tabindex="-1"></a></span>
<span id="cb510-4"><a href="lalonde-nsw-data.html#cb510-4" tabindex="-1"></a><span class="co"># nonexperimtenal benchmarks</span></span>
<span id="cb510-5"><a href="lalonde-nsw-data.html#cb510-5" tabindex="-1"></a>band.cps_plus <span class="ot">&lt;-</span> out14[<span class="dv">1</span>, <span class="dv">3</span><span class="sc">:</span><span class="dv">4</span>]</span>
<span id="cb510-6"><a href="lalonde-nsw-data.html#cb510-6" tabindex="-1"></a>est.cps_plus <span class="ot">&lt;-</span> out14[<span class="dv">1</span>, <span class="dv">1</span>]</span>
<span id="cb510-7"><a href="lalonde-nsw-data.html#cb510-7" tabindex="-1"></a>band.psid_plus <span class="ot">&lt;-</span> out15[<span class="dv">1</span>, <span class="dv">3</span><span class="sc">:</span><span class="dv">4</span>]</span>
<span id="cb510-8"><a href="lalonde-nsw-data.html#cb510-8" tabindex="-1"></a>est.psid_plus <span class="ot">&lt;-</span> out15[<span class="dv">1</span>, <span class="dv">1</span>]</span>
<span id="cb510-9"><a href="lalonde-nsw-data.html#cb510-9" tabindex="-1"></a></span>
<span id="cb510-10"><a href="lalonde-nsw-data.html#cb510-10" tabindex="-1"></a><span class="co"># plot results</span></span>
<span id="cb510-11"><a href="lalonde-nsw-data.html#cb510-11" tabindex="-1"></a><span class="fu">plot_coef</span>(out16, <span class="at">band =</span> band.cps_plus, <span class="at">line =</span> est.cps_plus, </span>
<span id="cb510-12"><a href="lalonde-nsw-data.html#cb510-12" tabindex="-1"></a>          <span class="at">ylim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">15500</span>, <span class="dv">5500</span>), <span class="at">main =</span> <span class="st">&quot;(N) Trimmed NSW-CPS1-PLUS&quot;</span>)</span>
<span id="cb510-13"><a href="lalonde-nsw-data.html#cb510-13" tabindex="-1"></a></span>
<span id="cb510-14"><a href="lalonde-nsw-data.html#cb510-14" tabindex="-1"></a></span>
<span id="cb510-15"><a href="lalonde-nsw-data.html#cb510-15" tabindex="-1"></a><span class="fu">plot_coef</span>(out17, <span class="at">band =</span> band.psid_plus, <span class="at">line =</span> est.psid_plus, </span>
<span id="cb510-16"><a href="lalonde-nsw-data.html#cb510-16" tabindex="-1"></a>          <span class="at">ylim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">15500</span>, <span class="dv">5500</span>), <span class="at">main =</span> <span class="st">&quot;(O) Trimmed NSW-PSID1-PLUS&quot;</span>)</span></code></pre></div>
<div class="figure"><span style="display:block;" id="fig:unnamed-chunk-264"></span>
<img src="Outcome-Weights_files/figure-html/unnamed-chunk-264-1.png" alt="FIGUREA10. SubfigureN:NSW-CPS1-PLUS. SubfigureO:NSW-PSID1-PLUS. ATT Estimates Given Unconfoundedness using NSW Samples" width="100%" />
<p class="caption">
Figure 3.88: FIGUREA10. SubfigureN:NSW-CPS1-PLUS. SubfigureO:NSW-PSID1-PLUS. ATT Estimates Given Unconfoundedness using NSW Samples
</p>
</div>
<div class="sourceCode" id="cb511"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb511-1"><a href="lalonde-nsw-data.html#cb511-1" tabindex="-1"></a><span class="co"># save results</span></span>
<span id="cb511-2"><a href="lalonde-nsw-data.html#cb511-2" tabindex="-1"></a><span class="fu">save_att_panels</span>(</span>
<span id="cb511-3"><a href="lalonde-nsw-data.html#cb511-3" tabindex="-1"></a>  <span class="at">out_list =</span> <span class="fu">list</span>(out1, out2, out3),</span>
<span id="cb511-4"><a href="lalonde-nsw-data.html#cb511-4" tabindex="-1"></a>  <span class="at">plot_titles =</span> <span class="fu">c</span>(<span class="st">&quot;(A) NSW-Experimental&quot;</span>, <span class="st">&quot;(B) NSW-CPS1&quot;</span>, <span class="st">&quot;(C) NSW-PSID1&quot;</span>),</span>
<span id="cb511-5"><a href="lalonde-nsw-data.html#cb511-5" tabindex="-1"></a>  <span class="at">band_list =</span> <span class="fu">list</span>(band.exp, band.exp, band.exp),</span>
<span id="cb511-6"><a href="lalonde-nsw-data.html#cb511-6" tabindex="-1"></a>  <span class="at">est_list  =</span> <span class="fu">list</span>(est.exp, est.exp, est.exp),</span>
<span id="cb511-7"><a href="lalonde-nsw-data.html#cb511-7" tabindex="-1"></a>  <span class="at">prefix =</span> <span class="st">&quot;nsw_est_exp&quot;</span></span>
<span id="cb511-8"><a href="lalonde-nsw-data.html#cb511-8" tabindex="-1"></a>)</span>
<span id="cb511-9"><a href="lalonde-nsw-data.html#cb511-9" tabindex="-1"></a></span>
<span id="cb511-10"><a href="lalonde-nsw-data.html#cb511-10" tabindex="-1"></a><span class="fu">save_att_panels</span>(</span>
<span id="cb511-11"><a href="lalonde-nsw-data.html#cb511-11" tabindex="-1"></a>  <span class="at">out_list =</span> out.cps,</span>
<span id="cb511-12"><a href="lalonde-nsw-data.html#cb511-12" tabindex="-1"></a>  <span class="at">plot_titles =</span> <span class="fu">paste0</span>(<span class="st">&quot;(&quot;</span>, LETTERS[<span class="dv">4</span><span class="sc">:</span><span class="dv">8</span>], <span class="st">&quot;) Top CPS1: &quot;</span>, top5_methods.cps),</span>
<span id="cb511-13"><a href="lalonde-nsw-data.html#cb511-13" tabindex="-1"></a>  <span class="at">band_list =</span> <span class="fu">replicate</span>(<span class="fu">length</span>(out.cps), band.exp, <span class="at">simplify =</span> <span class="cn">FALSE</span>),</span>
<span id="cb511-14"><a href="lalonde-nsw-data.html#cb511-14" tabindex="-1"></a>  <span class="at">est_list  =</span> <span class="fu">replicate</span>(<span class="fu">length</span>(out.cps), est.exp, <span class="at">simplify =</span> <span class="cn">FALSE</span>),</span>
<span id="cb511-15"><a href="lalonde-nsw-data.html#cb511-15" tabindex="-1"></a>  <span class="at">prefix =</span> <span class="st">&quot;nsw_est_top_cps&quot;</span></span>
<span id="cb511-16"><a href="lalonde-nsw-data.html#cb511-16" tabindex="-1"></a>)</span>
<span id="cb511-17"><a href="lalonde-nsw-data.html#cb511-17" tabindex="-1"></a></span>
<span id="cb511-18"><a href="lalonde-nsw-data.html#cb511-18" tabindex="-1"></a><span class="fu">save_att_panels</span>(</span>
<span id="cb511-19"><a href="lalonde-nsw-data.html#cb511-19" tabindex="-1"></a>  <span class="at">out_list =</span> out.psid,</span>
<span id="cb511-20"><a href="lalonde-nsw-data.html#cb511-20" tabindex="-1"></a>  <span class="at">plot_titles =</span> <span class="fu">paste0</span>(<span class="st">&quot;(&quot;</span>, LETTERS[<span class="dv">9</span><span class="sc">:</span><span class="dv">13</span>], <span class="st">&quot;) Top PSID1: &quot;</span>, top5_methods.psid),</span>
<span id="cb511-21"><a href="lalonde-nsw-data.html#cb511-21" tabindex="-1"></a>  <span class="at">band_list =</span> <span class="fu">replicate</span>(<span class="fu">length</span>(out.psid), band.exp, <span class="at">simplify =</span> <span class="cn">FALSE</span>),</span>
<span id="cb511-22"><a href="lalonde-nsw-data.html#cb511-22" tabindex="-1"></a>  <span class="at">est_list  =</span> <span class="fu">replicate</span>(<span class="fu">length</span>(out.psid), est.exp, <span class="at">simplify =</span> <span class="cn">FALSE</span>),</span>
<span id="cb511-23"><a href="lalonde-nsw-data.html#cb511-23" tabindex="-1"></a>  <span class="at">prefix =</span> <span class="st">&quot;nsw_est_top_psid&quot;</span></span>
<span id="cb511-24"><a href="lalonde-nsw-data.html#cb511-24" tabindex="-1"></a>)</span>
<span id="cb511-25"><a href="lalonde-nsw-data.html#cb511-25" tabindex="-1"></a></span>
<span id="cb511-26"><a href="lalonde-nsw-data.html#cb511-26" tabindex="-1"></a><span class="fu">save_att_panels</span>(</span>
<span id="cb511-27"><a href="lalonde-nsw-data.html#cb511-27" tabindex="-1"></a>  <span class="at">out_list =</span> <span class="fu">list</span>(out16, out17),</span>
<span id="cb511-28"><a href="lalonde-nsw-data.html#cb511-28" tabindex="-1"></a>  <span class="at">plot_titles =</span> <span class="fu">c</span>(<span class="st">&quot;(N) Trimmed NSW-CPS1-PLUS&quot;</span>, <span class="st">&quot;(O) Trimmed NSW-PSID1-PLUS&quot;</span>),</span>
<span id="cb511-29"><a href="lalonde-nsw-data.html#cb511-29" tabindex="-1"></a>  <span class="at">band_list =</span> <span class="fu">list</span>(band.cps_plus, band.psid_plus),</span>
<span id="cb511-30"><a href="lalonde-nsw-data.html#cb511-30" tabindex="-1"></a>  <span class="at">est_list  =</span> <span class="fu">list</span>(est.cps_plus, est.psid_plus),</span>
<span id="cb511-31"><a href="lalonde-nsw-data.html#cb511-31" tabindex="-1"></a>  <span class="at">prefix =</span> <span class="st">&quot;nsw_est_plus&quot;</span></span>
<span id="cb511-32"><a href="lalonde-nsw-data.html#cb511-32" tabindex="-1"></a>)</span></code></pre></div>
<p>The above figures show the ATT estimates and their 95% confidence intervals for fifteen samples: NSW-Experimental, NSW-CPS1, NSW-PSID1, trimmed versions of the NSW-CPS1 and NSW-PSID1 samples (analogous to Imbens &amp; Xu (2024)) and a series of top-ranked subsamples of both NSW-CPS1 and NSW-PSID1 based on various matching, weighting, truncation and trimming criteria.</p>
<p>Figure (A) presents the benchmark from the experimental sample (NSW-Experimental), serving as a reference for bias and variance assessment of observational samples. Figures (B) and (C) show results for the observational samples, NSW-CPS1 and NSW-PSID1, while figures (D) and (E) present those for the trimmed versions, replicating the tutorial results of Imbens &amp; Xu (2024). Figures (F) through (J) display results for CPS1-based subsamples constructed with the top-ranked methods. Analogously, figures (K) through (O) summarize results for the corresponding PSID1-based subsamples under parallel rules.</p>
<p>Across the NSW-CPS1 and its top-ranked subsamples, all estimators produce ATT estimates that closely align with the experimental benchmark, though all estimates are negative. Some larger deviations occur for the <code>Diff-in-Means</code> estimator within the <code>overlap_crump</code> and <code>adapt_weight_trunc_ipw_weight</code> subsamples. Nevertheless, these ATT estimates deviate more from the benchmark than those obtained under models A and B in previous sections using LDW data.</p>
<p>In comparison, PSID1-based subsamples frequently exhibit greater dispersion and substantially higher standard errors than NSW-CPS1 samples, consistent with previous observations from LDW data. All ATT estimates remain negatively aligned, reflecting heightened methodological uncertainty within these samples.</p>
<div class="sourceCode" id="cb512"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb512-1"><a href="lalonde-nsw-data.html#cb512-1" tabindex="-1"></a><span class="co"># get all outputs</span></span>
<span id="cb512-2"><a href="lalonde-nsw-data.html#cb512-2" tabindex="-1"></a>all_outs <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fu">list</span>(out1, out2, out3), </span>
<span id="cb512-3"><a href="lalonde-nsw-data.html#cb512-3" tabindex="-1"></a>              out.cps, out.psid, </span>
<span id="cb512-4"><a href="lalonde-nsw-data.html#cb512-4" tabindex="-1"></a>              <span class="fu">list</span>(out16, out17))</span>
<span id="cb512-5"><a href="lalonde-nsw-data.html#cb512-5" tabindex="-1"></a></span>
<span id="cb512-6"><a href="lalonde-nsw-data.html#cb512-6" tabindex="-1"></a><span class="co"># get plot titles</span></span>
<span id="cb512-7"><a href="lalonde-nsw-data.html#cb512-7" tabindex="-1"></a>all_plot_titles <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;(A) NSW-Experimental&quot;</span>, <span class="st">&quot;(B) NSW-CPS1&quot;</span>, <span class="st">&quot;(C) NSW-PSID1&quot;</span>,</span>
<span id="cb512-8"><a href="lalonde-nsw-data.html#cb512-8" tabindex="-1"></a>                      <span class="fu">paste0</span>(<span class="st">&quot;(&quot;</span>, LETTERS[<span class="dv">6</span><span class="sc">:</span><span class="dv">10</span>], <span class="st">&quot;) Top CPS1: &quot;</span>, top5_methods.cps),</span>
<span id="cb512-9"><a href="lalonde-nsw-data.html#cb512-9" tabindex="-1"></a>                      <span class="fu">paste0</span>(<span class="st">&quot;(&quot;</span>, LETTERS[<span class="dv">11</span><span class="sc">:</span><span class="dv">15</span>], <span class="st">&quot;) Top PSID1: &quot;</span>, top5_methods.psid),</span>
<span id="cb512-10"><a href="lalonde-nsw-data.html#cb512-10" tabindex="-1"></a>                      <span class="st">&quot;(N) Trimmed NSW-CPS1-PLUS&quot;</span>, <span class="st">&quot;(O) Trimmed NSW-PSID1-PLUS&quot;</span>)</span>
<span id="cb512-11"><a href="lalonde-nsw-data.html#cb512-11" tabindex="-1"></a></span>
<span id="cb512-12"><a href="lalonde-nsw-data.html#cb512-12" tabindex="-1"></a><span class="co"># evaluate results</span></span>
<span id="cb512-13"><a href="lalonde-nsw-data.html#cb512-13" tabindex="-1"></a>all_summaries <span class="ot">&lt;-</span> <span class="fu">lapply</span>(all_outs, eval_att)</span>
<span id="cb512-14"><a href="lalonde-nsw-data.html#cb512-14" tabindex="-1"></a>att_summary <span class="ot">&lt;-</span> <span class="fu">do.call</span>(rbind, all_summaries)</span>
<span id="cb512-15"><a href="lalonde-nsw-data.html#cb512-15" tabindex="-1"></a><span class="fu">rownames</span>(att_summary) <span class="ot">&lt;-</span> all_plot_titles</span>
<span id="cb512-16"><a href="lalonde-nsw-data.html#cb512-16" tabindex="-1"></a></span>
<span id="cb512-17"><a href="lalonde-nsw-data.html#cb512-17" tabindex="-1"></a><span class="co"># print results</span></span>
<span id="cb512-18"><a href="lalonde-nsw-data.html#cb512-18" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">kable</span>(att_summary, <span class="at">caption =</span> <span class="st">&quot;ATT Summary Statistics&quot;</span>, <span class="at">booktabs =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb512-19"><a href="lalonde-nsw-data.html#cb512-19" tabindex="-1"></a>  <span class="fu">kable_styling</span>(<span class="at">full_width =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb512-20"><a href="lalonde-nsw-data.html#cb512-20" tabindex="-1"></a>  <span class="fu">scroll_box</span>(<span class="at">height =</span> <span class="st">&quot;800px&quot;</span>, <span class="at">width =</span> <span class="st">&quot;100%&quot;</span>)</span></code></pre></div>
<div style="border: 1px solid #ddd; padding: 0px; overflow-y: scroll; height:800px; overflow-x: scroll; width:100%; ">
<table class="table" style="margin-left: auto; margin-right: auto;">
<caption>
<span id="tab:unnamed-chunk-266">Table 3.4: </span><span id="tab:unnamed-chunk-266">Table 3.5: </span>ATT Summary Statistics
</caption>
<thead>
<tr>
<th style="text-align:left;position: sticky; top:0; background-color: #FFFFFF;">
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
Mean_SE
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
Min_Estimate
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
Max_Estimate
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
Diff_Estimate
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
<ol style="list-style-type: upper-alpha">
<li>NSW-Experimental
</td>
<td style="text-align:right;">
488.0545
</td>
<td style="text-align:right;">
527.5476
</td>
<td style="text-align:right;">
886.3037
</td>
<td style="text-align:right;">
358.7561
</td>
</tr>
<tr>
<td style="text-align:left;">
<ol start="2" style="list-style-type: upper-alpha">
<li>NSW-CPS1
</td>
<td style="text-align:right;">
488.8617
</td>
<td style="text-align:right;">
-8870.3076
</td>
<td style="text-align:right;">
-266.3443
</td>
<td style="text-align:right;">
8603.9633
</td>
</tr>
<tr>
<td style="text-align:left;">
<ol start="3" style="list-style-type: upper-alpha">
<li>NSW-PSID1
</td>
<td style="text-align:right;">
768.9609
</td>
<td style="text-align:right;">
-15577.5689
</td>
<td style="text-align:right;">
-691.8459
</td>
<td style="text-align:right;">
14885.7230
</td>
</tr>
<tr>
<td style="text-align:left;">
<ol start="6" style="list-style-type: upper-alpha">
<li>Top CPS1: mahvars
</td>
<td style="text-align:right;">
568.1849
</td>
<td style="text-align:right;">
-582.0667
</td>
<td style="text-align:right;">
-178.5012
</td>
<td style="text-align:right;">
403.5655
</td>
</tr>
<tr>
<td style="text-align:left;">
<ol start="7" style="list-style-type: upper-alpha">
<li>Top CPS1: k3
</td>
<td style="text-align:right;">
530.8020
</td>
<td style="text-align:right;">
-1603.2376
</td>
<td style="text-align:right;">
-406.2001
</td>
<td style="text-align:right;">
1197.0375
</td>
</tr>
<tr>
<td style="text-align:left;">
<ol start="8" style="list-style-type: upper-alpha">
<li>Top CPS1: exact
</td>
<td style="text-align:right;">
1301.1756
</td>
<td style="text-align:right;">
2485.4287
</td>
<td style="text-align:right;">
3478.2148
</td>
<td style="text-align:right;">
992.7862
</td>
</tr>
<tr>
<td style="text-align:left;">
<ol style="list-style-type: upper-roman">
<li>Top CPS1: cem
</td>
<td style="text-align:right;">
636.0979
</td>
<td style="text-align:right;">
-1021.7289
</td>
<td style="text-align:right;">
1122.7161
</td>
<td style="text-align:right;">
2144.4450
</td>
</tr>
<tr>
<td style="text-align:left;">
<ol start="10" style="list-style-type: upper-alpha">
<li>Top CPS1: card
</td>
<td style="text-align:right;">
571.4871
</td>
<td style="text-align:right;">
-936.6956
</td>
<td style="text-align:right;">
-436.0583
</td>
<td style="text-align:right;">
500.6374
</td>
</tr>
<tr>
<td style="text-align:left;">
<ol start="11" style="list-style-type: upper-alpha">
<li>Top PSID1: card
</td>
<td style="text-align:right;">
942.2279
</td>
<td style="text-align:right;">
-3024.0022
</td>
<td style="text-align:right;">
-1850.5626
</td>
<td style="text-align:right;">
1173.4396
</td>
</tr>
<tr>
<td style="text-align:left;">
<ol start="12" style="list-style-type: upper-alpha">
<li>Top PSID1: mahvars
</td>
<td style="text-align:right;">
1241.4677
</td>
<td style="text-align:right;">
-3218.4670
</td>
<td style="text-align:right;">
-2303.7144
</td>
<td style="text-align:right;">
914.7526
</td>
</tr>
<tr>
<td style="text-align:left;">
<ol start="13" style="list-style-type: upper-alpha">
<li>Top PSID1: optimal_pair
</td>
<td style="text-align:right;">
764.6943
</td>
<td style="text-align:right;">
-3813.6263
</td>
<td style="text-align:right;">
-737.9041
</td>
<td style="text-align:right;">
3075.7222
</td>
</tr>
<tr>
<td style="text-align:left;">
<ol start="14" style="list-style-type: upper-alpha">
<li>Top PSID1: fix_max_value_opt_weight
</td>
<td style="text-align:right;">
752.4069
</td>
<td style="text-align:right;">
-15577.5689
</td>
<td style="text-align:right;">
-691.8459
</td>
<td style="text-align:right;">
14885.7230
</td>
</tr>
<tr>
<td style="text-align:left;">
<ol start="15" style="list-style-type: upper-alpha">
<li>Top PSID1: exact
</td>
<td style="text-align:right;">
2076.6338
</td>
<td style="text-align:right;">
-1302.5949
</td>
<td style="text-align:right;">
3409.0870
</td>
<td style="text-align:right;">
4711.6819
</td>
</tr>
<tr>
<td style="text-align:left;">
<ol start="14" style="list-style-type: upper-alpha">
<li>Trimmed NSW-CPS1-PLUS
</td>
<td style="text-align:right;">
556.2786
</td>
<td style="text-align:right;">
-868.5038
</td>
<td style="text-align:right;">
-115.3250
</td>
<td style="text-align:right;">
753.1788
</td>
</tr>
<tr>
<td style="text-align:left;">
<ol start="15" style="list-style-type: upper-alpha">
<li>Trimmed NSW-PSID1-PLUS
</td>
<td style="text-align:right;">
1193.4999
</td>
<td style="text-align:right;">
-4531.0696
</td>
<td style="text-align:right;">
-3390.0776
</td>
<td style="text-align:right;">
1140.9919
</td>
</tr>
</tbody>
</table>
</div></li>
</ol></li>
</ol></li>
</ol></li>
</ol></li>
</ol></li>
</ol></li>
</ol></li>
</ol></li>
</ol></li>
</ol></li>
</ol></li>
</ol></li>
</ol></li>
</ol></li>
</ol>
<div class="sourceCode" id="cb513"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb513-1"><a href="lalonde-nsw-data.html#cb513-1" tabindex="-1"></a><span class="co"># create result matrix</span></span>
<span id="cb513-2"><a href="lalonde-nsw-data.html#cb513-2" tabindex="-1"></a>result_mat <span class="ot">&lt;-</span> <span class="fu">create_matrix_results</span>(all_outs, all_plot_titles)</span>
<span id="cb513-3"><a href="lalonde-nsw-data.html#cb513-3" tabindex="-1"></a></span>
<span id="cb513-4"><a href="lalonde-nsw-data.html#cb513-4" tabindex="-1"></a><span class="co"># render formatted table output</span></span>
<span id="cb513-5"><a href="lalonde-nsw-data.html#cb513-5" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">kable</span>(result_mat, <span class="at">booktabs =</span> <span class="cn">TRUE</span>, <span class="at">caption =</span> <span class="st">&quot;ATT Estimates and SEs&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb513-6"><a href="lalonde-nsw-data.html#cb513-6" tabindex="-1"></a>  <span class="fu">kable_styling</span>(<span class="at">full_width =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb513-7"><a href="lalonde-nsw-data.html#cb513-7" tabindex="-1"></a>  <span class="fu">scroll_box</span>(<span class="at">height =</span> <span class="st">&quot;800px&quot;</span>, <span class="at">width =</span> <span class="st">&quot;100%&quot;</span>)</span></code></pre></div>
<div style="border: 1px solid #ddd; padding: 0px; overflow-y: scroll; height:800px; overflow-x: scroll; width:100%; ">
<table class="table" style="margin-left: auto; margin-right: auto;">
<caption>
<span id="tab:unnamed-chunk-267">Table 3.6: </span><span id="tab:unnamed-chunk-267">Table 3.7: </span>ATT Estimates and SEs
</caption>
<thead>
<tr>
<th style="text-align:left;position: sticky; top:0; background-color: #FFFFFF;">
</th>
<th style="text-align:left;position: sticky; top:0; background-color: #FFFFFF;">
<ol style="list-style-type: upper-alpha">
<li>NSW-Experimental
</th>
<th style="text-align:left;position: sticky; top:0; background-color: #FFFFFF;">
</th>
<th style="text-align:left;position: sticky; top:0; background-color: #FFFFFF;">
<ol start="2" style="list-style-type: upper-alpha">
<li>NSW-CPS1
</th>
<th style="text-align:left;position: sticky; top:0; background-color: #FFFFFF;">
</th>
<th style="text-align:left;position: sticky; top:0; background-color: #FFFFFF;">
<ol start="3" style="list-style-type: upper-alpha">
<li>NSW-PSID1
</th>
<th style="text-align:left;position: sticky; top:0; background-color: #FFFFFF;">
</th>
<th style="text-align:left;position: sticky; top:0; background-color: #FFFFFF;">
<ol start="6" style="list-style-type: upper-alpha">
<li>Top CPS1: mahvars
</th>
<th style="text-align:left;position: sticky; top:0; background-color: #FFFFFF;">
</th>
<th style="text-align:left;position: sticky; top:0; background-color: #FFFFFF;">
<ol start="7" style="list-style-type: upper-alpha">
<li>Top CPS1: k3
</th>
<th style="text-align:left;position: sticky; top:0; background-color: #FFFFFF;">
</th>
<th style="text-align:left;position: sticky; top:0; background-color: #FFFFFF;">
<ol start="8" style="list-style-type: upper-alpha">
<li>Top CPS1: exact
</th>
<th style="text-align:left;position: sticky; top:0; background-color: #FFFFFF;">
</th>
<th style="text-align:left;position: sticky; top:0; background-color: #FFFFFF;">
<ol style="list-style-type: upper-roman">
<li>Top CPS1: cem
</th>
<th style="text-align:left;position: sticky; top:0; background-color: #FFFFFF;">
</th>
<th style="text-align:left;position: sticky; top:0; background-color: #FFFFFF;">
<ol start="10" style="list-style-type: upper-alpha">
<li>Top CPS1: card
</th>
<th style="text-align:left;position: sticky; top:0; background-color: #FFFFFF;">
</th>
<th style="text-align:left;position: sticky; top:0; background-color: #FFFFFF;">
<ol start="11" style="list-style-type: upper-alpha">
<li>Top PSID1: card
</th>
<th style="text-align:left;position: sticky; top:0; background-color: #FFFFFF;">
</th>
<th style="text-align:left;position: sticky; top:0; background-color: #FFFFFF;">
<ol start="12" style="list-style-type: upper-alpha">
<li>Top PSID1: mahvars
</th>
<th style="text-align:left;position: sticky; top:0; background-color: #FFFFFF;">
</th>
<th style="text-align:left;position: sticky; top:0; background-color: #FFFFFF;">
<ol start="13" style="list-style-type: upper-alpha">
<li>Top PSID1: optimal_pair
</th>
<th style="text-align:left;position: sticky; top:0; background-color: #FFFFFF;">
</th>
<th style="text-align:left;position: sticky; top:0; background-color: #FFFFFF;">
<ol start="14" style="list-style-type: upper-alpha">
<li>Top PSID1: fix_max_value_opt_weight
</th>
<th style="text-align:left;position: sticky; top:0; background-color: #FFFFFF;">
</th>
<th style="text-align:left;position: sticky; top:0; background-color: #FFFFFF;">
<ol start="15" style="list-style-type: upper-alpha">
<li>Top PSID1: exact
</th>
<th style="text-align:left;position: sticky; top:0; background-color: #FFFFFF;">
</th>
<th style="text-align:left;position: sticky; top:0; background-color: #FFFFFF;">
<ol start="14" style="list-style-type: upper-alpha">
<li>Trimmed NSW-CPS1-PLUS
</th>
<th style="text-align:left;position: sticky; top:0; background-color: #FFFFFF;">
</th>
<th style="text-align:left;position: sticky; top:0; background-color: #FFFFFF;">
<ol start="15" style="list-style-type: upper-alpha">
<li>Trimmed NSW-PSID1-PLUS
</th>
<th style="text-align:left;position: sticky; top:0; background-color: #FFFFFF;">
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
Experimental Benchmark
</td>
<td style="text-align:left;">
886.30
</td>
<td style="text-align:left;">
(488.14)
</td>
<td style="text-align:left;">
886.30
</td>
<td style="text-align:left;">
(488.14)
</td>
<td style="text-align:left;">
886.30
</td>
<td style="text-align:left;">
(488.14)
</td>
<td style="text-align:left;">
-8870.31
</td>
<td style="text-align:left;">
(408.30)
</td>
<td style="text-align:left;">
-8870.31
</td>
<td style="text-align:left;">
(408.30)
</td>
<td style="text-align:left;">
-8870.31
</td>
<td style="text-align:left;">
(408.30)
</td>
<td style="text-align:left;">
-8870.31
</td>
<td style="text-align:left;">
(408.30)
</td>
<td style="text-align:left;">
-8870.31
</td>
<td style="text-align:left;">
(408.30)
</td>
<td style="text-align:left;">
-15577.57
</td>
<td style="text-align:left;">
(508.12)
</td>
<td style="text-align:left;">
-15577.57
</td>
<td style="text-align:left;">
(508.12)
</td>
<td style="text-align:left;">
-15577.57
</td>
<td style="text-align:left;">
(508.12)
</td>
<td style="text-align:left;">
-15577.57
</td>
<td style="text-align:left;">
(508.12)
</td>
<td style="text-align:left;">
-15577.57
</td>
<td style="text-align:left;">
(508.12)
</td>
<td style="text-align:left;">
-8870.31
</td>
<td style="text-align:left;">
(408.30)
</td>
<td style="text-align:left;">
-15577.57
</td>
<td style="text-align:left;">
(508.12)
</td>
</tr>
<tr>
<td style="text-align:left;">
diff
</td>
<td style="text-align:left;">
886.30
</td>
<td style="text-align:left;">
(488.14)
</td>
<td style="text-align:left;">
-8870.31
</td>
<td style="text-align:left;">
(408.30)
</td>
<td style="text-align:left;">
-15577.57
</td>
<td style="text-align:left;">
(508.12)
</td>
<td style="text-align:left;">
-568.04
</td>
<td style="text-align:left;">
(584.68)
</td>
<td style="text-align:left;">
-1603.24
</td>
<td style="text-align:left;">
(528.91)
</td>
<td style="text-align:left;">
2623.42
</td>
<td style="text-align:left;">
(1303.73)
</td>
<td style="text-align:left;">
-1021.73
</td>
<td style="text-align:left;">
(549.96)
</td>
<td style="text-align:left;">
-916.37
</td>
<td style="text-align:left;">
(579.97)
</td>
<td style="text-align:left;">
-2401.30
</td>
<td style="text-align:left;">
(968.20)
</td>
<td style="text-align:left;">
-2642.24
</td>
<td style="text-align:left;">
(1245.17)
</td>
<td style="text-align:left;">
-3813.63
</td>
<td style="text-align:left;">
(728.73)
</td>
<td style="text-align:left;">
-15577.57
</td>
<td style="text-align:left;">
(508.12)
</td>
<td style="text-align:left;">
786.34
</td>
<td style="text-align:left;">
(2224.74)
</td>
<td style="text-align:left;">
-519.65
</td>
<td style="text-align:left;">
(578.61)
</td>
<td style="text-align:left;">
-3569.56
</td>
<td style="text-align:left;">
(1138.75)
</td>
</tr>
<tr>
<td style="text-align:left;">
reg
</td>
<td style="text-align:left;">
812.52
</td>
<td style="text-align:left;">
(485.60)
</td>
<td style="text-align:left;">
-792.15
</td>
<td style="text-align:left;">
(479.67)
</td>
<td style="text-align:left;">
-1581.11
</td>
<td style="text-align:left;">
(718.80)
</td>
<td style="text-align:left;">
-523.41
</td>
<td style="text-align:left;">
(565.88)
</td>
<td style="text-align:left;">
-731.67
</td>
<td style="text-align:left;">
(521.04)
</td>
<td style="text-align:left;">
2981.41
</td>
<td style="text-align:left;">
(1297.81)
</td>
<td style="text-align:left;">
545.00
</td>
<td style="text-align:left;">
(609.84)
</td>
<td style="text-align:left;">
-604.75
</td>
<td style="text-align:left;">
(547.13)
</td>
<td style="text-align:left;">
-2202.91
</td>
<td style="text-align:left;">
(978.79)
</td>
<td style="text-align:left;">
-2553.39
</td>
<td style="text-align:left;">
(1276.61)
</td>
<td style="text-align:left;">
-2447.03
</td>
<td style="text-align:left;">
(843.28)
</td>
<td style="text-align:left;">
-1581.11
</td>
<td style="text-align:left;">
(718.80)
</td>
<td style="text-align:left;">
1724.03
</td>
<td style="text-align:left;">
(1835.50)
</td>
<td style="text-align:left;">
-336.84
</td>
<td style="text-align:left;">
(552.46)
</td>
<td style="text-align:left;">
-3579.07
</td>
<td style="text-align:left;">
(1270.85)
</td>
</tr>
<tr>
<td style="text-align:left;">
om.reg
</td>
<td style="text-align:left;">
854.16
</td>
<td style="text-align:left;">
(413.47)
</td>
<td style="text-align:left;">
-726.42
</td>
<td style="text-align:left;">
(462.50)
</td>
<td style="text-align:left;">
-1215.01
</td>
<td style="text-align:left;">
(481.08)
</td>
<td style="text-align:left;">
-467.22
</td>
<td style="text-align:left;">
(468.17)
</td>
<td style="text-align:left;">
-475.38
</td>
<td style="text-align:left;">
(475.20)
</td>
<td style="text-align:left;">
2789.82
</td>
<td style="text-align:left;">
(1132.46)
</td>
<td style="text-align:left;">
727.76
</td>
<td style="text-align:left;">
(548.31)
</td>
<td style="text-align:left;">
-436.06
</td>
<td style="text-align:left;">
(471.60)
</td>
<td style="text-align:left;">
-1891.67
</td>
<td style="text-align:left;">
(602.27)
</td>
<td style="text-align:left;">
-2336.30
</td>
<td style="text-align:left;">
(754.13)
</td>
<td style="text-align:left;">
-1605.93
</td>
<td style="text-align:left;">
(446.01)
</td>
<td style="text-align:left;">
-1215.01
</td>
<td style="text-align:left;">
(481.08)
</td>
<td style="text-align:left;">
1795.84
</td>
<td style="text-align:left;">
(1697.40)
</td>
<td style="text-align:left;">
-323.38
</td>
<td style="text-align:left;">
(461.86)
</td>
<td style="text-align:left;">
-3476.55
</td>
<td style="text-align:left;">
(644.84)
</td>
</tr>
<tr>
<td style="text-align:left;">
om.grf
</td>
<td style="text-align:left;">
836.42
</td>
<td style="text-align:left;">
(408.14)
</td>
<td style="text-align:left;">
-969.43
</td>
<td style="text-align:left;">
(451.72)
</td>
<td style="text-align:left;">
-2823.28
</td>
<td style="text-align:left;">
(454.43)
</td>
<td style="text-align:left;">
-460.01
</td>
<td style="text-align:left;">
(452.02)
</td>
<td style="text-align:left;">
-582.58
</td>
<td style="text-align:left;">
(453.50)
</td>
<td style="text-align:left;">
2659.52
</td>
<td style="text-align:left;">
(1115.82)
</td>
<td style="text-align:left;">
154.55
</td>
<td style="text-align:left;">
(535.11)
</td>
<td style="text-align:left;">
-560.11
</td>
<td style="text-align:left;">
(446.60)
</td>
<td style="text-align:left;">
-2278.12
</td>
<td style="text-align:left;">
(557.19)
</td>
<td style="text-align:left;">
-2604.73
</td>
<td style="text-align:left;">
(687.72)
</td>
<td style="text-align:left;">
-2405.30
</td>
<td style="text-align:left;">
(426.25)
</td>
<td style="text-align:left;">
-2837.70
</td>
<td style="text-align:left;">
(455.59)
</td>
<td style="text-align:left;">
775.55
</td>
<td style="text-align:left;">
(1123.43)
</td>
<td style="text-align:left;">
-228.36
</td>
<td style="text-align:left;">
(438.33)
</td>
<td style="text-align:left;">
-3810.59
</td>
<td style="text-align:left;">
(548.81)
</td>
</tr>
<tr>
<td style="text-align:left;">
matching
</td>
<td style="text-align:left;">
776.30
</td>
<td style="text-align:left;">
(553.82)
</td>
<td style="text-align:left;">
-290.38
</td>
<td style="text-align:left;">
(585.14)
</td>
<td style="text-align:left;">
-1122.98
</td>
<td style="text-align:left;">
(1210.25)
</td>
<td style="text-align:left;">
-178.50
</td>
<td style="text-align:left;">
(633.02)
</td>
<td style="text-align:left;">
-443.32
</td>
<td style="text-align:left;">
(629.06)
</td>
<td style="text-align:left;">
3028.28
</td>
<td style="text-align:left;">
(1470.66)
</td>
<td style="text-align:left;">
961.13
</td>
<td style="text-align:left;">
(684.62)
</td>
<td style="text-align:left;">
-596.16
</td>
<td style="text-align:left;">
(710.71)
</td>
<td style="text-align:left;">
-3024.00
</td>
<td style="text-align:left;">
(1215.38)
</td>
<td style="text-align:left;">
-2753.52
</td>
<td style="text-align:left;">
(1413.36)
</td>
<td style="text-align:left;">
-1346.35
</td>
<td style="text-align:left;">
(1196.22)
</td>
<td style="text-align:left;">
-1122.98
</td>
<td style="text-align:left;">
(1210.25)
</td>
<td style="text-align:left;">
1217.47
</td>
<td style="text-align:left;">
(2246.68)
</td>
<td style="text-align:left;">
-115.33
</td>
<td style="text-align:left;">
(637.40)
</td>
<td style="text-align:left;">
-4531.07
</td>
<td style="text-align:left;">
(1382.58)
</td>
</tr>
<tr>
<td style="text-align:left;">
psm
</td>
<td style="text-align:left;">
527.55
</td>
<td style="text-align:left;">
(532.21)
</td>
<td style="text-align:left;">
-374.13
</td>
<td style="text-align:left;">
(545.22)
</td>
<td style="text-align:left;">
-1832.89
</td>
<td style="text-align:left;">
(734.81)
</td>
<td style="text-align:left;">
-576.52
</td>
<td style="text-align:left;">
(586.01)
</td>
<td style="text-align:left;">
-812.40
</td>
<td style="text-align:left;">
(554.27)
</td>
<td style="text-align:left;">
3140.12
</td>
<td style="text-align:left;">
(1380.51)
</td>
<td style="text-align:left;">
1122.72
</td>
<td style="text-align:left;">
(704.84)
</td>
<td style="text-align:left;">
-936.70
</td>
<td style="text-align:left;">
(572.79)
</td>
<td style="text-align:left;">
-2549.87
</td>
<td style="text-align:left;">
(940.33)
</td>
<td style="text-align:left;">
-2616.73
</td>
<td style="text-align:left;">
(1361.63)
</td>
<td style="text-align:left;">
-737.90
</td>
<td style="text-align:left;">
(688.90)
</td>
<td style="text-align:left;">
-1832.34
</td>
<td style="text-align:left;">
(738.73)
</td>
<td style="text-align:left;">
-1302.59
</td>
<td style="text-align:left;">
(2453.53)
</td>
<td style="text-align:left;">
-868.50
</td>
<td style="text-align:left;">
(607.31)
</td>
<td style="text-align:left;">
-4498.77
</td>
<td style="text-align:left;">
(1142.52)
</td>
</tr>
<tr>
<td style="text-align:left;">
ipw
</td>
<td style="text-align:left;">
816.41
</td>
<td style="text-align:left;">
(500.17)
</td>
<td style="text-align:left;">
-552.85
</td>
<td style="text-align:left;">
(485.11)
</td>
<td style="text-align:left;">
-2027.40
</td>
<td style="text-align:left;">
(973.28)
</td>
<td style="text-align:left;">
-568.04
</td>
<td style="text-align:left;">
(584.68)
</td>
<td style="text-align:left;">
-487.52
</td>
<td style="text-align:left;">
(546.78)
</td>
<td style="text-align:left;">
3076.24
</td>
<td style="text-align:left;">
(1303.65)
</td>
<td style="text-align:left;">
492.19
</td>
<td style="text-align:left;">
(712.89)
</td>
<td style="text-align:left;">
-916.37
</td>
<td style="text-align:left;">
(579.97)
</td>
<td style="text-align:left;">
-2401.30
</td>
<td style="text-align:left;">
(968.20)
</td>
<td style="text-align:left;">
-2642.24
</td>
<td style="text-align:left;">
(1245.17)
</td>
<td style="text-align:left;">
-3813.63
</td>
<td style="text-align:left;">
(728.73)
</td>
<td style="text-align:left;">
-6347.85
</td>
<td style="text-align:left;">
(828.84)
</td>
<td style="text-align:left;">
1165.25
</td>
<td style="text-align:left;">
(2039.41)
</td>
<td style="text-align:left;">
-399.70
</td>
<td style="text-align:left;">
(571.92)
</td>
<td style="text-align:left;">
-4280.99
</td>
<td style="text-align:left;">
(1427.67)
</td>
</tr>
<tr>
<td style="text-align:left;">
cbps
</td>
<td style="text-align:left;">
852.06
</td>
<td style="text-align:left;">
(495.44)
</td>
<td style="text-align:left;">
-566.41
</td>
<td style="text-align:left;">
(476.37)
</td>
<td style="text-align:left;">
-718.81
</td>
<td style="text-align:left;">
(888.13)
</td>
<td style="text-align:left;">
-568.04
</td>
<td style="text-align:left;">
(584.68)
</td>
<td style="text-align:left;">
-487.52
</td>
<td style="text-align:left;">
(546.78)
</td>
<td style="text-align:left;">
3076.24
</td>
<td style="text-align:left;">
(1303.65)
</td>
<td style="text-align:left;">
492.19
</td>
<td style="text-align:left;">
(712.89)
</td>
<td style="text-align:left;">
-916.37
</td>
<td style="text-align:left;">
(579.97)
</td>
<td style="text-align:left;">
-2401.30
</td>
<td style="text-align:left;">
(968.20)
</td>
<td style="text-align:left;">
-2642.24
</td>
<td style="text-align:left;">
(1245.17)
</td>
<td style="text-align:left;">
-3813.63
</td>
<td style="text-align:left;">
(728.73)
</td>
<td style="text-align:left;">
-6347.85
</td>
<td style="text-align:left;">
(828.84)
</td>
<td style="text-align:left;">
1165.25
</td>
<td style="text-align:left;">
(2039.41)
</td>
<td style="text-align:left;">
-310.73
</td>
<td style="text-align:left;">
(578.63)
</td>
<td style="text-align:left;">
-3403.78
</td>
<td style="text-align:left;">
(1336.51)
</td>
</tr>
<tr>
<td style="text-align:left;">
ebal
</td>
<td style="text-align:left;">
850.96
</td>
<td style="text-align:left;">
(495.52)
</td>
<td style="text-align:left;">
-566.82
</td>
<td style="text-align:left;">
(476.39)
</td>
<td style="text-align:left;">
-691.85
</td>
<td style="text-align:left;">
(889.21)
</td>
<td style="text-align:left;">
-464.34
</td>
<td style="text-align:left;">
(595.88)
</td>
<td style="text-align:left;">
-506.31
</td>
<td style="text-align:left;">
(515.49)
</td>
<td style="text-align:left;">
2800.18
</td>
<td style="text-align:left;">
(1291.86)
</td>
<td style="text-align:left;">
630.59
</td>
<td style="text-align:left;">
(670.08)
</td>
<td style="text-align:left;">
-461.96
</td>
<td style="text-align:left;">
(571.99)
</td>
<td style="text-align:left;">
-1850.56
</td>
<td style="text-align:left;">
(991.98)
</td>
<td style="text-align:left;">
-2355.32
</td>
<td style="text-align:left;">
(1434.58)
</td>
<td style="text-align:left;">
-826.46
</td>
<td style="text-align:left;">
(895.86)
</td>
<td style="text-align:left;">
-691.85
</td>
<td style="text-align:left;">
(889.21)
</td>
<td style="text-align:left;">
1703.25
</td>
<td style="text-align:left;">
(1790.73)
</td>
<td style="text-align:left;">
-310.83
</td>
<td style="text-align:left;">
(578.64)
</td>
<td style="text-align:left;">
-3390.08
</td>
<td style="text-align:left;">
(1355.57)
</td>
</tr>
<tr>
<td style="text-align:left;">
dml
</td>
<td style="text-align:left;">
748.59
</td>
<td style="text-align:left;">
(482.57)
</td>
<td style="text-align:left;">
-787.03
</td>
<td style="text-align:left;">
(479.32)
</td>
<td style="text-align:left;">
-1673.83
</td>
<td style="text-align:left;">
(722.32)
</td>
<td style="text-align:left;">
-582.07
</td>
<td style="text-align:left;">
(564.07)
</td>
<td style="text-align:left;">
-641.55
</td>
<td style="text-align:left;">
(520.45)
</td>
<td style="text-align:left;">
3478.21
</td>
<td style="text-align:left;">
(1353.79)
</td>
<td style="text-align:left;">
549.58
</td>
<td style="text-align:left;">
(605.42)
</td>
<td style="text-align:left;">
-522.49
</td>
<td style="text-align:left;">
(544.46)
</td>
<td style="text-align:left;">
-2276.35
</td>
<td style="text-align:left;">
(962.93)
</td>
<td style="text-align:left;">
-2303.71
</td>
<td style="text-align:left;">
(1242.69)
</td>
<td style="text-align:left;">
-2482.89
</td>
<td style="text-align:left;">
(824.44)
</td>
<td style="text-align:left;">
-1673.83
</td>
<td style="text-align:left;">
(722.32)
</td>
<td style="text-align:left;">
3409.09
</td>
<td style="text-align:left;">
(2507.84)
</td>
<td style="text-align:left;">
-482.94
</td>
<td style="text-align:left;">
(556.06)
</td>
<td style="text-align:left;">
-3922.47
</td>
<td style="text-align:left;">
(1247.20)
</td>
</tr>
<tr>
<td style="text-align:left;">
aipw_grf
</td>
<td style="text-align:left;">
855.58
</td>
<td style="text-align:left;">
(499.08)
</td>
<td style="text-align:left;">
-266.34
</td>
<td style="text-align:left;">
(512.48)
</td>
<td style="text-align:left;">
-1799.75
</td>
<td style="text-align:left;">
(873.71)
</td>
<td style="text-align:left;">
-375.44
</td>
<td style="text-align:left;">
(591.58)
</td>
<td style="text-align:left;">
-406.20
</td>
<td style="text-align:left;">
(541.80)
</td>
<td style="text-align:left;">
2765.38
</td>
<td style="text-align:left;">
(1309.56)
</td>
<td style="text-align:left;">
714.08
</td>
<td style="text-align:left;">
(645.94)
</td>
<td style="text-align:left;">
-712.32
</td>
<td style="text-align:left;">
(646.37)
</td>
<td style="text-align:left;">
-2860.00
</td>
<td style="text-align:left;">
(1124.56)
</td>
<td style="text-align:left;">
-3218.47
</td>
<td style="text-align:left;">
(1516.64)
</td>
<td style="text-align:left;">
-1729.74
</td>
<td style="text-align:left;">
(862.36)
</td>
<td style="text-align:left;">
-1799.75
</td>
<td style="text-align:left;">
(873.71)
</td>
<td style="text-align:left;">
944.63
</td>
<td style="text-align:left;">
(2288.86)
</td>
<td style="text-align:left;">
-265.19
</td>
<td style="text-align:left;">
(553.21)
</td>
<td style="text-align:left;">
-4328.45
</td>
<td style="text-align:left;">
(1576.70)
</td>
</tr>
<tr>
<td style="text-align:left;">
aipw_ow
</td>
<td style="text-align:left;">
877.36
</td>
<td style="text-align:left;">
(502.50)
</td>
<td style="text-align:left;">
-374.41
</td>
<td style="text-align:left;">
(504.11)
</td>
<td style="text-align:left;">
-1691.75
</td>
<td style="text-align:left;">
(773.39)
</td>
<td style="text-align:left;">
-390.09
</td>
<td style="text-align:left;">
(607.56)
</td>
<td style="text-align:left;">
-452.44
</td>
<td style="text-align:left;">
(536.33)
</td>
<td style="text-align:left;">
2485.43
</td>
<td style="text-align:left;">
(1350.61)
</td>
<td style="text-align:left;">
829.36
</td>
<td style="text-align:left;">
(653.28)
</td>
<td style="text-align:left;">
-597.06
</td>
<td style="text-align:left;">
(606.26)
</td>
<td style="text-align:left;">
-2318.34
</td>
<td style="text-align:left;">
(1028.71)
</td>
<td style="text-align:left;">
-2685.77
</td>
<td style="text-align:left;">
(1474.72)
</td>
<td style="text-align:left;">
-1526.82
</td>
<td style="text-align:left;">
(806.84)
</td>
<td style="text-align:left;">
-1691.75
</td>
<td style="text-align:left;">
(773.39)
</td>
<td style="text-align:left;">
737.81
</td>
<td style="text-align:left;">
(2672.08)
</td>
<td style="text-align:left;">
-247.39
</td>
<td style="text-align:left;">
(560.93)
</td>
<td style="text-align:left;">
-3903.01
</td>
<td style="text-align:left;">
(1249.99)
</td>
</tr>
</tbody>
</table>
</div></li>
</ol></li>
</ol></li>
</ol></li>
</ol></li>
</ol></li>
</ol></li>
</ol></li>
</ol></li>
</ol></li>
</ol></li>
</ol></li>
</ol></li>
</ol></li>
</ol></li>
</ol>
<p>The tabulated results confirm visual patterns: Column (A) reports the estimates for the NSW-Experimental sample, column (B) for the NSW-CPS1 sample, and column (C) for the NSW-PSID1 sample. Columns (D)-(O) summarize results for the trimmed and top-ranked samples for both NSW-CPS1 and NSW-PSID1.</p>
<p>For all CPS1-based samples, ATT estimates remain negative, but are relatively close to the experimental benchmark. In contrast, the PSID1-based estimates exhibit larger negative magnitudes, and increased standard errors, underscoring the heightened difficulty of achieving covariate balance and overlap in this observational dataset.</p>
<p>Overall, consistent with findings from models A and B, figures and table jointly demonstrate that ATT estimates from observational samples tend to have larger standard errors compared to the experimental sample, reflecting greater statistical uncertainty in non-experimental causal effect estimation, and that certain methods can bring observational estimates closer to the experimental benchmark. Nevertheless, significant estimator-dependent variability and sensitivity to sample construction persist.</p>
<div class="sourceCode" id="cb514"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb514-1"><a href="lalonde-nsw-data.html#cb514-1" tabindex="-1"></a><span class="co"># save results </span></span>
<span id="cb514-2"><a href="lalonde-nsw-data.html#cb514-2" tabindex="-1"></a><span class="fu">save_csv</span>(result_mat, <span class="st">&quot;nsw_att_estimates&quot;</span>)</span></code></pre></div>
<div id="conditional-average-treatment-effect-on-the-treated-catt-2" class="section level3 hasAnchor" number="3.8.2">
<h3><span class="header-section-number">3.8.2</span> Conditional average treatment effect on the treated (CATT)<a href="lalonde-nsw-data.html#conditional-average-treatment-effect-on-the-treated-catt-2" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb515"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb515-1"><a href="lalonde-nsw-data.html#cb515-1" tabindex="-1"></a><span class="co"># estimate CATT</span></span>
<span id="cb515-2"><a href="lalonde-nsw-data.html#cb515-2" tabindex="-1"></a>catt.nsw <span class="ot">&lt;-</span> <span class="fu">catt</span>(nsw, Y, treat, covar)</span>
<span id="cb515-3"><a href="lalonde-nsw-data.html#cb515-3" tabindex="-1"></a>catt.cps <span class="ot">&lt;-</span> <span class="fu">catt</span>(nsw_cps, Y, treat, covar)</span>
<span id="cb515-4"><a href="lalonde-nsw-data.html#cb515-4" tabindex="-1"></a>catt.psid <span class="ot">&lt;-</span> <span class="fu">catt</span>(nsw_psid, Y, treat, covar)</span>
<span id="cb515-5"><a href="lalonde-nsw-data.html#cb515-5" tabindex="-1"></a>catt.top5_cps <span class="ot">&lt;-</span> <span class="fu">lapply</span>(top5_datasets.cps, <span class="cf">function</span>(d) <span class="fu">catt</span>(d, Y, treat, covar))</span>
<span id="cb515-6"><a href="lalonde-nsw-data.html#cb515-6" tabindex="-1"></a>catt.top5_psid <span class="ot">&lt;-</span> <span class="fu">lapply</span>(top5_datasets.psid, <span class="cf">function</span>(d) <span class="fu">catt</span>(d, Y, treat, covar))</span></code></pre></div>
<div class="sourceCode" id="cb516"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb516-1"><a href="lalonde-nsw-data.html#cb516-1" tabindex="-1"></a><span class="co"># similar to Imbens &amp; Xu (2024) </span></span>
<span id="cb516-2"><a href="lalonde-nsw-data.html#cb516-2" tabindex="-1"></a><span class="fu">load</span>(<span class="st">&quot;data/trimmed.RData&quot;</span>)</span>
<span id="cb516-3"><a href="lalonde-nsw-data.html#cb516-3" tabindex="-1"></a>catt.cps.trim <span class="ot">&lt;-</span> <span class="fu">catt</span>(nsw_cps_trim_match, Y, treat, covar)</span>
<span id="cb516-4"><a href="lalonde-nsw-data.html#cb516-4" tabindex="-1"></a>catt.psid.trim <span class="ot">&lt;-</span> <span class="fu">catt</span>(nsw_psid_trim_match, Y, treat, covar)</span>
<span id="cb516-5"><a href="lalonde-nsw-data.html#cb516-5" tabindex="-1"></a>catt.nsw.cps <span class="ot">&lt;-</span> <span class="fu">catt</span>(nsw_trim_cps, Y, treat, covar)</span>
<span id="cb516-6"><a href="lalonde-nsw-data.html#cb516-6" tabindex="-1"></a>catt.nsw.psid <span class="ot">&lt;-</span> <span class="fu">catt</span>(nsw_trim_psid, Y, treat, covar)</span></code></pre></div>
<div class="sourceCode" id="cb517"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb517-1"><a href="lalonde-nsw-data.html#cb517-1" tabindex="-1"></a><span class="co"># plot results</span></span>
<span id="cb517-2"><a href="lalonde-nsw-data.html#cb517-2" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">2</span>)) </span>
<span id="cb517-3"><a href="lalonde-nsw-data.html#cb517-3" tabindex="-1"></a><span class="fu">par</span>(<span class="at">cex.main =</span> <span class="fl">0.9</span>)</span>
<span id="cb517-4"><a href="lalonde-nsw-data.html#cb517-4" tabindex="-1"></a><span class="fu">plot_catt</span>(</span>
<span id="cb517-5"><a href="lalonde-nsw-data.html#cb517-5" tabindex="-1"></a>  <span class="at">catt1 =</span> catt.nsw<span class="sc">$</span>catt,</span>
<span id="cb517-6"><a href="lalonde-nsw-data.html#cb517-6" tabindex="-1"></a>  <span class="at">catt2 =</span> catt.cps<span class="sc">$</span>catt,</span>
<span id="cb517-7"><a href="lalonde-nsw-data.html#cb517-7" tabindex="-1"></a>  <span class="at">att1  =</span> catt.nsw<span class="sc">$</span>att[<span class="dv">1</span>],</span>
<span id="cb517-8"><a href="lalonde-nsw-data.html#cb517-8" tabindex="-1"></a>  <span class="at">att2  =</span> catt.cps<span class="sc">$</span>att[<span class="dv">1</span>],</span>
<span id="cb517-9"><a href="lalonde-nsw-data.html#cb517-9" tabindex="-1"></a>  <span class="at">xlab  =</span> <span class="st">&quot;CATT (Experimental)&quot;</span>,</span>
<span id="cb517-10"><a href="lalonde-nsw-data.html#cb517-10" tabindex="-1"></a>  <span class="at">ylab  =</span> <span class="st">&quot;CATT (CPS1)&quot;</span>,</span>
<span id="cb517-11"><a href="lalonde-nsw-data.html#cb517-11" tabindex="-1"></a>  <span class="at">main  =</span> <span class="st">&quot;(B) NSW-CPS1&quot;</span>, </span>
<span id="cb517-12"><a href="lalonde-nsw-data.html#cb517-12" tabindex="-1"></a>  <span class="at">axes.range =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">8000</span>, <span class="dv">8000</span>)</span>
<span id="cb517-13"><a href="lalonde-nsw-data.html#cb517-13" tabindex="-1"></a>)</span>
<span id="cb517-14"><a href="lalonde-nsw-data.html#cb517-14" tabindex="-1"></a></span>
<span id="cb517-15"><a href="lalonde-nsw-data.html#cb517-15" tabindex="-1"></a><span class="fu">plot_catt</span>(</span>
<span id="cb517-16"><a href="lalonde-nsw-data.html#cb517-16" tabindex="-1"></a>  <span class="at">catt1 =</span> catt.nsw<span class="sc">$</span>catt,</span>
<span id="cb517-17"><a href="lalonde-nsw-data.html#cb517-17" tabindex="-1"></a>  <span class="at">catt2 =</span> catt.psid<span class="sc">$</span>catt,</span>
<span id="cb517-18"><a href="lalonde-nsw-data.html#cb517-18" tabindex="-1"></a>  <span class="at">att1  =</span> catt.nsw<span class="sc">$</span>att[<span class="dv">1</span>],</span>
<span id="cb517-19"><a href="lalonde-nsw-data.html#cb517-19" tabindex="-1"></a>  <span class="at">att2  =</span> catt.psid<span class="sc">$</span>att[<span class="dv">1</span>],</span>
<span id="cb517-20"><a href="lalonde-nsw-data.html#cb517-20" tabindex="-1"></a>  <span class="at">xlab  =</span> <span class="st">&quot;CATT (Experimental)&quot;</span>,</span>
<span id="cb517-21"><a href="lalonde-nsw-data.html#cb517-21" tabindex="-1"></a>  <span class="at">ylab  =</span> <span class="st">&quot;CATT (PSID1)&quot;</span>,</span>
<span id="cb517-22"><a href="lalonde-nsw-data.html#cb517-22" tabindex="-1"></a>  <span class="at">main  =</span> <span class="st">&quot;(C) NSW-PSID1&quot;</span>,</span>
<span id="cb517-23"><a href="lalonde-nsw-data.html#cb517-23" tabindex="-1"></a>  <span class="at">axes.range =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">8000</span>, <span class="dv">8000</span>)</span>
<span id="cb517-24"><a href="lalonde-nsw-data.html#cb517-24" tabindex="-1"></a>)</span>
<span id="cb517-25"><a href="lalonde-nsw-data.html#cb517-25" tabindex="-1"></a></span>
<span id="cb517-26"><a href="lalonde-nsw-data.html#cb517-26" tabindex="-1"></a><span class="fu">plot_catt_panels</span>(</span>
<span id="cb517-27"><a href="lalonde-nsw-data.html#cb517-27" tabindex="-1"></a>  <span class="at">exp_catt =</span> catt.nsw,</span>
<span id="cb517-28"><a href="lalonde-nsw-data.html#cb517-28" tabindex="-1"></a>  <span class="at">catt_list  =</span> catt.top5_cps,</span>
<span id="cb517-29"><a href="lalonde-nsw-data.html#cb517-29" tabindex="-1"></a>  <span class="at">plot_titles =</span> <span class="fu">paste0</span>(<span class="st">&quot;(&quot;</span>, LETTERS[<span class="dv">4</span><span class="sc">:</span><span class="dv">8</span>], <span class="st">&quot;) Top CPS1: &quot;</span>, top5_methods.cps)</span>
<span id="cb517-30"><a href="lalonde-nsw-data.html#cb517-30" tabindex="-1"></a>)</span></code></pre></div>
<div class="figure"><span style="display:block;" id="fig:unnamed-chunk-271-1"></span>
<img src="Outcome-Weights_files/figure-html/unnamed-chunk-271-1.png" alt="FIGUREC11. SubfigureB:NSW-CPS1. SubfigureC:NSW-PSID1. SubfigureD-H:Top-NSW-CPS1. SubfigureN:NSW-CPS1-PLUS. SubfigureO:NSW-PSID1-PLUS. CATT Estimates using NSW Data: Experimental vs. Nonexperimental" width="100%" />
<p class="caption">
Figure 3.89: FIGUREC11. SubfigureB:NSW-CPS1. SubfigureC:NSW-PSID1. SubfigureD-H:Top-NSW-CPS1. SubfigureN:NSW-CPS1-PLUS. SubfigureO:NSW-PSID1-PLUS. CATT Estimates using NSW Data: Experimental vs. Nonexperimental
</p>
</div>
<div class="figure"><span style="display:block;" id="fig:unnamed-chunk-271-2"></span>
<img src="Outcome-Weights_files/figure-html/unnamed-chunk-271-2.png" alt="FIGUREC11. SubfigureB:NSW-CPS1. SubfigureC:NSW-PSID1. SubfigureD-H:Top-NSW-CPS1. SubfigureN:NSW-CPS1-PLUS. SubfigureO:NSW-PSID1-PLUS. CATT Estimates using NSW Data: Experimental vs. Nonexperimental" width="100%" />
<p class="caption">
Figure 3.90: FIGUREC11. SubfigureB:NSW-CPS1. SubfigureC:NSW-PSID1. SubfigureD-H:Top-NSW-CPS1. SubfigureN:NSW-CPS1-PLUS. SubfigureO:NSW-PSID1-PLUS. CATT Estimates using NSW Data: Experimental vs. Nonexperimental
</p>
</div>
<div class="sourceCode" id="cb518"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb518-1"><a href="lalonde-nsw-data.html#cb518-1" tabindex="-1"></a><span class="fu">plot_catt_panels</span>(</span>
<span id="cb518-2"><a href="lalonde-nsw-data.html#cb518-2" tabindex="-1"></a>  <span class="at">exp_catt =</span> catt.nsw,</span>
<span id="cb518-3"><a href="lalonde-nsw-data.html#cb518-3" tabindex="-1"></a>  <span class="at">catt_list  =</span> catt.top5_psid,</span>
<span id="cb518-4"><a href="lalonde-nsw-data.html#cb518-4" tabindex="-1"></a>  <span class="at">plot_titles =</span> <span class="fu">paste0</span>(<span class="st">&quot;(&quot;</span>, LETTERS[<span class="dv">9</span><span class="sc">:</span><span class="dv">13</span>], <span class="st">&quot;) Top PSID1: &quot;</span>, top5_methods.psid)</span>
<span id="cb518-5"><a href="lalonde-nsw-data.html#cb518-5" tabindex="-1"></a>)</span></code></pre></div>
<div class="figure"><span style="display:block;" id="fig:unnamed-chunk-271-3"></span>
<img src="Outcome-Weights_files/figure-html/unnamed-chunk-271-3.png" alt="FIGUREC11. SubfigureB:NSW-CPS1. SubfigureC:NSW-PSID1. SubfigureD-H:Top-NSW-CPS1. SubfigureN:NSW-CPS1-PLUS. SubfigureO:NSW-PSID1-PLUS. CATT Estimates using NSW Data: Experimental vs. Nonexperimental" width="100%" />
<p class="caption">
Figure 3.91: FIGUREC11. SubfigureB:NSW-CPS1. SubfigureC:NSW-PSID1. SubfigureD-H:Top-NSW-CPS1. SubfigureN:NSW-CPS1-PLUS. SubfigureO:NSW-PSID1-PLUS. CATT Estimates using NSW Data: Experimental vs. Nonexperimental
</p>
</div>
<div class="figure"><span style="display:block;" id="fig:unnamed-chunk-271-4"></span>
<img src="Outcome-Weights_files/figure-html/unnamed-chunk-271-4.png" alt="FIGUREC11. SubfigureB:NSW-CPS1. SubfigureC:NSW-PSID1. SubfigureD-H:Top-NSW-CPS1. SubfigureN:NSW-CPS1-PLUS. SubfigureO:NSW-PSID1-PLUS. CATT Estimates using NSW Data: Experimental vs. Nonexperimental" width="100%" />
<p class="caption">
Figure 3.92: FIGUREC11. SubfigureB:NSW-CPS1. SubfigureC:NSW-PSID1. SubfigureD-H:Top-NSW-CPS1. SubfigureN:NSW-CPS1-PLUS. SubfigureO:NSW-PSID1-PLUS. CATT Estimates using NSW Data: Experimental vs. Nonexperimental
</p>
</div>
<div class="sourceCode" id="cb519"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb519-1"><a href="lalonde-nsw-data.html#cb519-1" tabindex="-1"></a><span class="co">#plot_catt(</span></span>
<span id="cb519-2"><a href="lalonde-nsw-data.html#cb519-2" tabindex="-1"></a><span class="co">#  catt1 &lt;- catt.nsw.cps$catt,</span></span>
<span id="cb519-3"><a href="lalonde-nsw-data.html#cb519-3" tabindex="-1"></a><span class="co">#  catt2 &lt;- catt.cps.trim$catt,</span></span>
<span id="cb519-4"><a href="lalonde-nsw-data.html#cb519-4" tabindex="-1"></a><span class="co">#  att1 &lt;- catt.nsw.cps$att[1],</span></span>
<span id="cb519-5"><a href="lalonde-nsw-data.html#cb519-5" tabindex="-1"></a><span class="co">#  att2 &lt;- catt.cps.trim$att[1],</span></span>
<span id="cb519-6"><a href="lalonde-nsw-data.html#cb519-6" tabindex="-1"></a><span class="co">#  xlab  = &quot;CATT (Experimental)&quot;,</span></span>
<span id="cb519-7"><a href="lalonde-nsw-data.html#cb519-7" tabindex="-1"></a><span class="co">#  ylab  = &quot;CATT (CPS1-PLUS-Trimmed)&quot;,</span></span>
<span id="cb519-8"><a href="lalonde-nsw-data.html#cb519-8" tabindex="-1"></a><span class="co">#  main  = &quot;(N) Trimmed NSW-CPS1-PLUS&quot;, </span></span>
<span id="cb519-9"><a href="lalonde-nsw-data.html#cb519-9" tabindex="-1"></a><span class="co">#  axes.range = c(-8000, 8000)</span></span>
<span id="cb519-10"><a href="lalonde-nsw-data.html#cb519-10" tabindex="-1"></a><span class="co">#)</span></span>
<span id="cb519-11"><a href="lalonde-nsw-data.html#cb519-11" tabindex="-1"></a></span>
<span id="cb519-12"><a href="lalonde-nsw-data.html#cb519-12" tabindex="-1"></a><span class="co">#plot_catt(</span></span>
<span id="cb519-13"><a href="lalonde-nsw-data.html#cb519-13" tabindex="-1"></a><span class="co">#  catt1 &lt;- catt.nsw.psid$catt,</span></span>
<span id="cb519-14"><a href="lalonde-nsw-data.html#cb519-14" tabindex="-1"></a><span class="co">#  catt2 &lt;- catt.psid.trim$catt,</span></span>
<span id="cb519-15"><a href="lalonde-nsw-data.html#cb519-15" tabindex="-1"></a><span class="co">#  att1 &lt;- catt.nsw.psid$att[1],</span></span>
<span id="cb519-16"><a href="lalonde-nsw-data.html#cb519-16" tabindex="-1"></a><span class="co">#  att2 &lt;- catt.psid.trim$att[1],</span></span>
<span id="cb519-17"><a href="lalonde-nsw-data.html#cb519-17" tabindex="-1"></a><span class="co">#  xlab  = &quot;CATT (Experimental)&quot;,</span></span>
<span id="cb519-18"><a href="lalonde-nsw-data.html#cb519-18" tabindex="-1"></a><span class="co">#  ylab  = &quot;CATT (PSID1-PLUS-Trimmed)&quot;,</span></span>
<span id="cb519-19"><a href="lalonde-nsw-data.html#cb519-19" tabindex="-1"></a><span class="co">#  main  = &quot;(O) Trimmed NSW-PSID1-PLUS&quot;,</span></span>
<span id="cb519-20"><a href="lalonde-nsw-data.html#cb519-20" tabindex="-1"></a><span class="co">#  axes.range = c(-8000, 8000)</span></span>
<span id="cb519-21"><a href="lalonde-nsw-data.html#cb519-21" tabindex="-1"></a><span class="co">#)</span></span></code></pre></div>
<div class="figure"><span style="display:block;" id="fig:unnamed-chunk-271-5"></span>
<img src="Outcome-Weights_files/figure-html/unnamed-chunk-271-5.png" alt="FIGUREC11. SubfigureB:NSW-CPS1. SubfigureC:NSW-PSID1. SubfigureD-H:Top-NSW-CPS1. SubfigureN:NSW-CPS1-PLUS. SubfigureO:NSW-PSID1-PLUS. CATT Estimates using NSW Data: Experimental vs. Nonexperimental" width="100%" />
<p class="caption">
Figure 3.93: FIGUREC11. SubfigureB:NSW-CPS1. SubfigureC:NSW-PSID1. SubfigureD-H:Top-NSW-CPS1. SubfigureN:NSW-CPS1-PLUS. SubfigureO:NSW-PSID1-PLUS. CATT Estimates using NSW Data: Experimental vs. Nonexperimental
</p>
</div>
<div class="sourceCode" id="cb520"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb520-1"><a href="lalonde-nsw-data.html#cb520-1" tabindex="-1"></a><span class="co"># combine all catt objects </span></span>
<span id="cb520-2"><a href="lalonde-nsw-data.html#cb520-2" tabindex="-1"></a>all_catt <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fu">list</span>(catt.nsw, catt.cps, catt.psid), </span>
<span id="cb520-3"><a href="lalonde-nsw-data.html#cb520-3" tabindex="-1"></a>                   catt.top5_cps, catt.top5_psid, </span>
<span id="cb520-4"><a href="lalonde-nsw-data.html#cb520-4" tabindex="-1"></a>              <span class="fu">list</span>(catt.cps.trim, catt.psid.trim))</span>
<span id="cb520-5"><a href="lalonde-nsw-data.html#cb520-5" tabindex="-1"></a></span>
<span id="cb520-6"><a href="lalonde-nsw-data.html#cb520-6" tabindex="-1"></a>all_catt_eval <span class="ot">&lt;-</span> <span class="fu">eval_catt</span>(all_catt, all_plot_titles)</span>
<span id="cb520-7"><a href="lalonde-nsw-data.html#cb520-7" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">kable</span>(all_catt_eval, <span class="at">caption =</span> <span class="st">&quot;CATT Summary Statistics&quot;</span>, <span class="at">booktabs =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
<pre><code>## Warning in attr(x, &quot;align&quot;): &#39;xfun::attr()&#39; ist veraltet.
## Benutzen Sie stattdessen &#39;xfun::attr2()&#39;
## Siehe help(&quot;Deprecated&quot;)</code></pre>
<pre><code>## Warning in attr(x, &quot;format&quot;): &#39;xfun::attr()&#39; ist veraltet.
## Benutzen Sie stattdessen &#39;xfun::attr2()&#39;
## Siehe help(&quot;Deprecated&quot;)</code></pre>
<table style="width:100%;">
<caption><span id="tab:unnamed-chunk-272">Table 3.8: </span>CATT Summary Statistics</caption>
<colgroup>
<col width="47%" />
<col width="13%" />
<col width="13%" />
<col width="13%" />
<col width="13%" />
</colgroup>
<thead>
<tr class="header">
<th align="left">Method</th>
<th align="right">Min_Catt</th>
<th align="right">Max_Catt</th>
<th align="right">Mean_Catt</th>
<th align="right">Diff_Catt</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">(A) NSW-Experimental</td>
<td align="right">-1146.7594</td>
<td align="right">3347.5696</td>
<td align="right">814.5285</td>
<td align="right">4494.3290</td>
</tr>
<tr class="even">
<td align="left">(B) NSW-CPS1</td>
<td align="right">-8994.5105</td>
<td align="right">6328.3524</td>
<td align="right">-126.8339</td>
<td align="right">15322.8629</td>
</tr>
<tr class="odd">
<td align="left">(C) NSW-PSID1</td>
<td align="right">-8179.5375</td>
<td align="right">867.5126</td>
<td align="right">-2364.1429</td>
<td align="right">9047.0501</td>
</tr>
<tr class="even">
<td align="left">(F) Top CPS1: mahvars</td>
<td align="right">-5616.2358</td>
<td align="right">4597.4333</td>
<td align="right">-425.1064</td>
<td align="right">10213.6691</td>
</tr>
<tr class="odd">
<td align="left">(G) Top CPS1: k3</td>
<td align="right">-6229.5784</td>
<td align="right">5605.5798</td>
<td align="right">-292.7951</td>
<td align="right">11835.1582</td>
</tr>
<tr class="even">
<td align="left">(H) Top CPS1: exact</td>
<td align="right">1939.4642</td>
<td align="right">3835.4204</td>
<td align="right">2895.0963</td>
<td align="right">1895.9561</td>
</tr>
<tr class="odd">
<td align="left">(I) Top CPS1: cem</td>
<td align="right">-2044.9988</td>
<td align="right">4787.6348</td>
<td align="right">747.4324</td>
<td align="right">6832.6335</td>
</tr>
<tr class="even">
<td align="left">(J) Top CPS1: card</td>
<td align="right">-6489.7658</td>
<td align="right">3300.5239</td>
<td align="right">-626.8357</td>
<td align="right">9790.2897</td>
</tr>
<tr class="odd">
<td align="left">(K) Top PSID1: card</td>
<td align="right">-4893.2691</td>
<td align="right">-427.3857</td>
<td align="right">-2579.7057</td>
<td align="right">4465.8834</td>
</tr>
<tr class="even">
<td align="left">(L) Top PSID1: mahvars</td>
<td align="right">-5569.5801</td>
<td align="right">-560.0827</td>
<td align="right">-2995.3554</td>
<td align="right">5009.4975</td>
</tr>
<tr class="odd">
<td align="left">(M) Top PSID1: optimal_pair</td>
<td align="right">-6468.7080</td>
<td align="right">475.9027</td>
<td align="right">-2308.3071</td>
<td align="right">6944.6107</td>
</tr>
<tr class="even">
<td align="left">(N) Top PSID1: fix_max_value_opt_weight</td>
<td align="right">-7714.6362</td>
<td align="right">963.1192</td>
<td align="right">-2324.9340</td>
<td align="right">8677.7554</td>
</tr>
<tr class="odd">
<td align="left">(O) Top PSID1: exact</td>
<td align="right">772.8797</td>
<td align="right">1563.8649</td>
<td align="right">1121.4160</td>
<td align="right">790.9852</td>
</tr>
<tr class="even">
<td align="left">(N) Trimmed NSW-CPS1-PLUS</td>
<td align="right">-6719.7627</td>
<td align="right">5835.1918</td>
<td align="right">-243.0829</td>
<td align="right">12554.9544</td>
</tr>
<tr class="odd">
<td align="left">(O) Trimmed NSW-PSID1-PLUS</td>
<td align="right">-7823.4322</td>
<td align="right">-1903.4219</td>
<td align="right">-4175.0157</td>
<td align="right">5920.0103</td>
</tr>
</tbody>
</table>
<p>With NSW-CPS1, the CATT estimates range from $-8,652.64 to $6,452.97, contrasting with the benchmark where CATT estimates span from $-1,179.03 to $3,339.96, with a mean CATT estimate of $812.17. Alike in the previous sections, the NSW-PSID1 data exhibits a narrower CATT estimates range compared to NSW-CPS1, spanning from $-8,591.86 to $1,170.55. Yet its mean CATT estimate remains substantially negative, at approximately $-2,321.86, contrary to the positive mean CATT estimates observed in models A and B.</p>
<p>Among the trimmed and top-ranked NSW-CPS1 subsamples, CATT estimates exhibit substantial variability. Subsamples such as <code>overlap_crump</code> or <code>adap_weight_trunc_ipw_weight</code> yield notably negative minimum CATT values alongside moderately negative mean CATT estimates. Similarly, <code>card</code> and <code>mahvars</code> subsamples produce consistently negative mean CATT estimates, although weaker alignment with the experimental benchmark. The <code>ps_threshold</code> subsample yields improved estimates with highest min CATT and mean CATTs estimates closest to the experimental benchmark, while still negative.</p>
<p>The NSW-PSID1 trimmed and top-ranked subsamples deliver substantially decreased mean CATT estimates and wider extremes compared to their NSW-CPS1 counterparts, reflecting greater difficulties in producing reliable effect estimates.</p>
<p>This variation in range and means across samples, as observed in previous sections, reflects substantial heterogeneity in treatment effect estimation but also indicates that while certain criteria improve alignment with the experimental benchmark, others introduce considerable discrepancies and spread in estimated heterogeneous effects.</p>
<div class="sourceCode" id="cb523"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb523-1"><a href="lalonde-nsw-data.html#cb523-1" tabindex="-1"></a><span class="co"># save results</span></span>
<span id="cb523-2"><a href="lalonde-nsw-data.html#cb523-2" tabindex="-1"></a><span class="fu">save_main_catt_panels</span>(</span>
<span id="cb523-3"><a href="lalonde-nsw-data.html#cb523-3" tabindex="-1"></a>  <span class="at">catt_refs =</span> <span class="fu">list</span>(catt.nsw),</span>
<span id="cb523-4"><a href="lalonde-nsw-data.html#cb523-4" tabindex="-1"></a>  <span class="at">catt_comps =</span> <span class="fu">list</span>(catt.cps, catt.psid),</span>
<span id="cb523-5"><a href="lalonde-nsw-data.html#cb523-5" tabindex="-1"></a>  <span class="at">ylabels =</span> <span class="fu">c</span>(<span class="st">&quot;CATT (CPS1)&quot;</span>, <span class="st">&quot;CATT (PSID1)&quot;</span>),</span>
<span id="cb523-6"><a href="lalonde-nsw-data.html#cb523-6" tabindex="-1"></a>  <span class="at">prefix =</span> <span class="st">&quot;nsw_catt_main_panels&quot;</span>,</span>
<span id="cb523-7"><a href="lalonde-nsw-data.html#cb523-7" tabindex="-1"></a>  <span class="at">main_titles =</span> <span class="fu">c</span>(<span class="st">&quot;(B) NSW-CPS1&quot;</span>, <span class="st">&quot;(C) NSW-PSID1&quot;</span>)</span>
<span id="cb523-8"><a href="lalonde-nsw-data.html#cb523-8" tabindex="-1"></a>)</span>
<span id="cb523-9"><a href="lalonde-nsw-data.html#cb523-9" tabindex="-1"></a></span>
<span id="cb523-10"><a href="lalonde-nsw-data.html#cb523-10" tabindex="-1"></a><span class="fu">save_catt_panels</span>(</span>
<span id="cb523-11"><a href="lalonde-nsw-data.html#cb523-11" tabindex="-1"></a>  <span class="at">exp_catt =</span> catt.nsw,</span>
<span id="cb523-12"><a href="lalonde-nsw-data.html#cb523-12" tabindex="-1"></a>  <span class="at">catt_list  =</span> catt.top5_cps,</span>
<span id="cb523-13"><a href="lalonde-nsw-data.html#cb523-13" tabindex="-1"></a>  <span class="at">plot_titles =</span> <span class="fu">paste0</span>(<span class="st">&quot;(&quot;</span>, LETTERS[<span class="dv">4</span><span class="sc">:</span><span class="dv">8</span>], <span class="st">&quot;) Top CPS1: &quot;</span>, top5_methods.cps),</span>
<span id="cb523-14"><a href="lalonde-nsw-data.html#cb523-14" tabindex="-1"></a>  <span class="at">prefix =</span> <span class="st">&quot;nsw_catt_top5_cps&quot;</span></span>
<span id="cb523-15"><a href="lalonde-nsw-data.html#cb523-15" tabindex="-1"></a>)</span>
<span id="cb523-16"><a href="lalonde-nsw-data.html#cb523-16" tabindex="-1"></a></span>
<span id="cb523-17"><a href="lalonde-nsw-data.html#cb523-17" tabindex="-1"></a><span class="fu">save_catt_panels</span>(</span>
<span id="cb523-18"><a href="lalonde-nsw-data.html#cb523-18" tabindex="-1"></a>  <span class="at">exp_catt =</span> catt.nsw,</span>
<span id="cb523-19"><a href="lalonde-nsw-data.html#cb523-19" tabindex="-1"></a>  <span class="at">catt_list  =</span> catt.top5_psid,</span>
<span id="cb523-20"><a href="lalonde-nsw-data.html#cb523-20" tabindex="-1"></a>  <span class="at">plot_titles =</span> <span class="fu">paste0</span>(<span class="st">&quot;(&quot;</span>, LETTERS[<span class="dv">9</span><span class="sc">:</span><span class="dv">13</span>], <span class="st">&quot;) Top PSID1: &quot;</span>, top5_methods.psid),</span>
<span id="cb523-21"><a href="lalonde-nsw-data.html#cb523-21" tabindex="-1"></a>  <span class="at">prefix =</span> <span class="st">&quot;nsw_catt_top5_psid&quot;</span></span>
<span id="cb523-22"><a href="lalonde-nsw-data.html#cb523-22" tabindex="-1"></a>)</span>
<span id="cb523-23"><a href="lalonde-nsw-data.html#cb523-23" tabindex="-1"></a></span>
<span id="cb523-24"><a href="lalonde-nsw-data.html#cb523-24" tabindex="-1"></a><span class="co">#save_plus_catt_panels(</span></span>
<span id="cb523-25"><a href="lalonde-nsw-data.html#cb523-25" tabindex="-1"></a><span class="co">#  catt1_list = list(catt.nsw.cps, catt.nsw.psid),</span></span>
<span id="cb523-26"><a href="lalonde-nsw-data.html#cb523-26" tabindex="-1"></a><span class="co">#  catt2_list = list(catt.cps.trim, catt.psid.trim),</span></span>
<span id="cb523-27"><a href="lalonde-nsw-data.html#cb523-27" tabindex="-1"></a><span class="co">#  ylabels = c(&quot;CATT (CPS1-PLUS-Trimmed)&quot;, &quot;CATT (PSID1-PLUS-Trimmed)&quot;),</span></span>
<span id="cb523-28"><a href="lalonde-nsw-data.html#cb523-28" tabindex="-1"></a><span class="co">#  prefix = &quot;nsw_catt_plus_panels&quot;,</span></span>
<span id="cb523-29"><a href="lalonde-nsw-data.html#cb523-29" tabindex="-1"></a><span class="co">#  main_titles = c(&quot;(N) Trimmed NSW-CPS1-PLUS&quot;, &quot;(O) Trimmed NSW-PSID1-PLUS&quot;),</span></span>
<span id="cb523-30"><a href="lalonde-nsw-data.html#cb523-30" tabindex="-1"></a><span class="co">#  folder = &quot;graphs/lalonde&quot;</span></span>
<span id="cb523-31"><a href="lalonde-nsw-data.html#cb523-31" tabindex="-1"></a><span class="co">#)</span></span></code></pre></div>
</div>
<div id="quantile-treatment-effect-on-the-treated-qtet-1" class="section level3 hasAnchor" number="3.8.3">
<h3><span class="header-section-number">3.8.3</span> Quantile treatment effect on the treated (QTET)<a href="lalonde-nsw-data.html#quantile-treatment-effect-on-the-treated-qtet-1" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb524"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb524-1"><a href="lalonde-nsw-data.html#cb524-1" tabindex="-1"></a>qte.nsw <span class="ot">&lt;-</span> <span class="fu">est_qte</span>(Y, treat, covar, <span class="at">data =</span> nsw, <span class="at">cores =</span> <span class="dv">4</span>)</span>
<span id="cb524-2"><a href="lalonde-nsw-data.html#cb524-2" tabindex="-1"></a>qte.nsw_cps <span class="ot">&lt;-</span> <span class="fu">est_qte</span>(Y, treat, covar, <span class="at">data =</span> nsw_cps)</span>
<span id="cb524-3"><a href="lalonde-nsw-data.html#cb524-3" tabindex="-1"></a>qte.nsw_psid <span class="ot">&lt;-</span> <span class="fu">est_qte</span>(Y, treat, covar, <span class="at">data =</span> nsw_psid)</span>
<span id="cb524-4"><a href="lalonde-nsw-data.html#cb524-4" tabindex="-1"></a>qte.top5_cps  <span class="ot">&lt;-</span> <span class="fu">lapply</span>(top5_datasets.cps,  <span class="cf">function</span>(d) <span class="fu">est_qte</span>(Y, treat, covar, <span class="at">data =</span> d))</span>
<span id="cb524-5"><a href="lalonde-nsw-data.html#cb524-5" tabindex="-1"></a>qte.top5_psid <span class="ot">&lt;-</span> <span class="fu">lapply</span>(top5_datasets.psid, <span class="cf">function</span>(d) <span class="fu">est_qte</span>(Y, treat, covar, <span class="at">data =</span> d))</span></code></pre></div>
<div class="sourceCode" id="cb525"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb525-1"><a href="lalonde-nsw-data.html#cb525-1" tabindex="-1"></a>qte.nsw.cps <span class="ot">&lt;-</span> <span class="fu">est_qte</span>(Y, treat, <span class="cn">NULL</span>, <span class="at">data =</span> nsw_trim_cps)</span>
<span id="cb525-2"><a href="lalonde-nsw-data.html#cb525-2" tabindex="-1"></a>qte.nsw.psid <span class="ot">&lt;-</span> <span class="fu">est_qte</span>(Y, treat, <span class="cn">NULL</span>, <span class="at">data =</span> nsw_trim_psid)</span>
<span id="cb525-3"><a href="lalonde-nsw-data.html#cb525-3" tabindex="-1"></a>qte.nsw_cps.trim <span class="ot">&lt;-</span> <span class="fu">est_qte</span>(Y, treat, covar, <span class="at">data =</span> nsw_cps_trim_match) </span>
<span id="cb525-4"><a href="lalonde-nsw-data.html#cb525-4" tabindex="-1"></a>qte.nsw_psid.trim <span class="ot">&lt;-</span> <span class="fu">est_qte</span>(Y, treat, covar, <span class="at">data =</span> nsw_psid_trim_match) </span></code></pre></div>
<div class="sourceCode" id="cb526"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb526-1"><a href="lalonde-nsw-data.html#cb526-1" tabindex="-1"></a>qte.nsw0 <span class="ot">&lt;-</span> <span class="fu">est_qte</span>(Y, treat, <span class="cn">NULL</span>, <span class="at">data =</span> nsw)</span>
<span id="cb526-2"><a href="lalonde-nsw-data.html#cb526-2" tabindex="-1"></a>qte.nsw_cps0 <span class="ot">&lt;-</span> <span class="fu">est_qte</span>(Y, treat, <span class="cn">NULL</span>, <span class="at">data =</span> nsw_cps)</span>
<span id="cb526-3"><a href="lalonde-nsw-data.html#cb526-3" tabindex="-1"></a>qte.nsw_psid0 <span class="ot">&lt;-</span> <span class="fu">est_qte</span>(Y, treat, <span class="cn">NULL</span>, <span class="at">data =</span> nsw_psid)</span>
<span id="cb526-4"><a href="lalonde-nsw-data.html#cb526-4" tabindex="-1"></a>qte.top5_cps0  <span class="ot">&lt;-</span> <span class="fu">lapply</span>(top5_datasets.cps,  <span class="cf">function</span>(d) <span class="fu">est_qte</span>(Y, treat, <span class="cn">NULL</span>, <span class="at">data =</span> d))</span>
<span id="cb526-5"><a href="lalonde-nsw-data.html#cb526-5" tabindex="-1"></a>qte.top5_psid0 <span class="ot">&lt;-</span> <span class="fu">lapply</span>(top5_datasets.psid, <span class="cf">function</span>(d) <span class="fu">est_qte</span>(Y, treat, <span class="cn">NULL</span>, <span class="at">data =</span> d))</span></code></pre></div>
<div class="sourceCode" id="cb527"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb527-1"><a href="lalonde-nsw-data.html#cb527-1" tabindex="-1"></a>qte.nsw_cps.trim0 <span class="ot">&lt;-</span> <span class="fu">est_qte</span>(Y, treat, <span class="cn">NULL</span>, <span class="at">data =</span> nsw_cps_trim_match) </span>
<span id="cb527-2"><a href="lalonde-nsw-data.html#cb527-2" tabindex="-1"></a>qte.nsw_psid.trim0 <span class="ot">&lt;-</span> <span class="fu">est_qte</span>(Y, treat, <span class="cn">NULL</span>, <span class="at">data =</span> nsw_psid_trim_match) </span></code></pre></div>
<div class="sourceCode" id="cb528"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb528-1"><a href="lalonde-nsw-data.html#cb528-1" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">2</span>))</span>
<span id="cb528-2"><a href="lalonde-nsw-data.html#cb528-2" tabindex="-1"></a><span class="fu">par</span>(<span class="at">cex.main =</span> <span class="fl">0.9</span>)</span>
<span id="cb528-3"><a href="lalonde-nsw-data.html#cb528-3" tabindex="-1"></a>ylim <span class="ot">=</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">25000</span>, <span class="dv">15000</span>)</span>
<span id="cb528-4"><a href="lalonde-nsw-data.html#cb528-4" tabindex="-1"></a><span class="co"># CPS1</span></span>
<span id="cb528-5"><a href="lalonde-nsw-data.html#cb528-5" tabindex="-1"></a><span class="fu">plot_qte</span>(qte.nsw_cps, qte.nsw_cps0, qte.nsw, <span class="at">main =</span> <span class="st">&quot;(B) NSW-CPS1&quot;</span>, ylim)</span>
<span id="cb528-6"><a href="lalonde-nsw-data.html#cb528-6" tabindex="-1"></a><span class="fu">legend</span>(<span class="st">&quot;bottomleft&quot;</span>, <span class="at">legend =</span> <span class="fu">c</span>(<span class="st">&quot;Experimental&quot;</span>, <span class="st">&quot;Unadjusted&quot;</span>, <span class="st">&quot;Adjusted&quot;</span>), </span>
<span id="cb528-7"><a href="lalonde-nsw-data.html#cb528-7" tabindex="-1"></a>       <span class="at">lty =</span> <span class="dv">1</span>, <span class="at">pch =</span> <span class="fu">c</span>(<span class="dv">16</span>, <span class="dv">17</span>, <span class="dv">16</span>), <span class="at">col =</span> <span class="fu">c</span>(<span class="dv">4</span>, <span class="dv">2</span>, <span class="dv">1</span>), <span class="at">bty =</span> <span class="st">&quot;n&quot;</span>)</span>
<span id="cb528-8"><a href="lalonde-nsw-data.html#cb528-8" tabindex="-1"></a></span>
<span id="cb528-9"><a href="lalonde-nsw-data.html#cb528-9" tabindex="-1"></a><span class="co"># PSID1</span></span>
<span id="cb528-10"><a href="lalonde-nsw-data.html#cb528-10" tabindex="-1"></a><span class="fu">plot_qte</span>(qte.nsw_psid, qte.nsw_psid0, qte.nsw, <span class="at">main =</span> <span class="st">&quot;(C) NSW-PSID1&quot;</span>, ylim)</span>
<span id="cb528-11"><a href="lalonde-nsw-data.html#cb528-11" tabindex="-1"></a><span class="fu">legend</span>(<span class="st">&quot;bottomleft&quot;</span>, <span class="at">legend =</span> <span class="fu">c</span>(<span class="st">&quot;Experimental&quot;</span>, <span class="st">&quot;Unadjusted&quot;</span>, <span class="st">&quot;Adjusted&quot;</span>), </span>
<span id="cb528-12"><a href="lalonde-nsw-data.html#cb528-12" tabindex="-1"></a>       <span class="at">lty =</span> <span class="dv">1</span>, <span class="at">pch =</span> <span class="fu">c</span>(<span class="dv">16</span>, <span class="dv">17</span>, <span class="dv">16</span>), <span class="at">col =</span> <span class="fu">c</span>(<span class="dv">4</span>, <span class="dv">2</span>, <span class="dv">1</span>), <span class="at">bty =</span> <span class="st">&quot;n&quot;</span>)</span>
<span id="cb528-13"><a href="lalonde-nsw-data.html#cb528-13" tabindex="-1"></a></span>
<span id="cb528-14"><a href="lalonde-nsw-data.html#cb528-14" tabindex="-1"></a><span class="co"># CPS1 top methods</span></span>
<span id="cb528-15"><a href="lalonde-nsw-data.html#cb528-15" tabindex="-1"></a><span class="fu">plot_qte_top</span>(qte.top5_cps, qte.top5_cps0, qte.nsw, all_plot_titles, <span class="at">main_start =</span> <span class="dv">4</span>)</span></code></pre></div>
<div class="figure"><span style="display:block;" id="fig:unnamed-chunk-278-1"></span>
<img src="Outcome-Weights_files/figure-html/unnamed-chunk-278-1.png" alt="FIGUREC13. SubfigureB:NSW-CPS1. SubfigureC:NSW-PSID1. SubfigureD-H:Top-NSW-CPS1. SubfigureI-M:Top-NSW-PSID1. SubfigureN:NSW-CPS1-PLUS. SubfigureO:NSW-PSID1-PLUS. QTET Estimates using NSW Data: Experimental vs. Nonexperimental" width="100%" />
<p class="caption">
Figure 3.94: FIGUREC13. SubfigureB:NSW-CPS1. SubfigureC:NSW-PSID1. SubfigureD-H:Top-NSW-CPS1. SubfigureI-M:Top-NSW-PSID1. SubfigureN:NSW-CPS1-PLUS. SubfigureO:NSW-PSID1-PLUS. QTET Estimates using NSW Data: Experimental vs. Nonexperimental
</p>
</div>
<div class="sourceCode" id="cb529"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb529-1"><a href="lalonde-nsw-data.html#cb529-1" tabindex="-1"></a><span class="co"># PSID1 top methods</span></span>
<span id="cb529-2"><a href="lalonde-nsw-data.html#cb529-2" tabindex="-1"></a><span class="fu">plot_qte_top</span>(qte.top5_psid, qte.top5_psid0, qte.nsw, all_plot_titles, <span class="at">main_start =</span> <span class="dv">9</span>)</span></code></pre></div>
<div class="figure"><span style="display:block;" id="fig:unnamed-chunk-278-2"></span>
<img src="Outcome-Weights_files/figure-html/unnamed-chunk-278-2.png" alt="FIGUREC13. SubfigureB:NSW-CPS1. SubfigureC:NSW-PSID1. SubfigureD-H:Top-NSW-CPS1. SubfigureI-M:Top-NSW-PSID1. SubfigureN:NSW-CPS1-PLUS. SubfigureO:NSW-PSID1-PLUS. QTET Estimates using NSW Data: Experimental vs. Nonexperimental" width="100%" />
<p class="caption">
Figure 3.95: FIGUREC13. SubfigureB:NSW-CPS1. SubfigureC:NSW-PSID1. SubfigureD-H:Top-NSW-CPS1. SubfigureI-M:Top-NSW-PSID1. SubfigureN:NSW-CPS1-PLUS. SubfigureO:NSW-PSID1-PLUS. QTET Estimates using NSW Data: Experimental vs. Nonexperimental
</p>
</div>
<div class="figure"><span style="display:block;" id="fig:unnamed-chunk-278-3"></span>
<img src="Outcome-Weights_files/figure-html/unnamed-chunk-278-3.png" alt="FIGUREC13. SubfigureB:NSW-CPS1. SubfigureC:NSW-PSID1. SubfigureD-H:Top-NSW-CPS1. SubfigureI-M:Top-NSW-PSID1. SubfigureN:NSW-CPS1-PLUS. SubfigureO:NSW-PSID1-PLUS. QTET Estimates using NSW Data: Experimental vs. Nonexperimental" width="100%" />
<p class="caption">
Figure 3.96: FIGUREC13. SubfigureB:NSW-CPS1. SubfigureC:NSW-PSID1. SubfigureD-H:Top-NSW-CPS1. SubfigureI-M:Top-NSW-PSID1. SubfigureN:NSW-CPS1-PLUS. SubfigureO:NSW-PSID1-PLUS. QTET Estimates using NSW Data: Experimental vs. Nonexperimental
</p>
</div>
<div class="sourceCode" id="cb530"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb530-1"><a href="lalonde-nsw-data.html#cb530-1" tabindex="-1"></a><span class="co"># CPS1-PLUS trimmed</span></span>
<span id="cb530-2"><a href="lalonde-nsw-data.html#cb530-2" tabindex="-1"></a><span class="fu">plot_qte</span>(qte.nsw_cps.trim, qte.nsw_cps.trim0, qte.nsw.cps, <span class="at">main =</span> <span class="st">&quot;(N) NSW-CPS1-PLUS (Trimmed)&quot;</span>, ylim)</span>
<span id="cb530-3"><a href="lalonde-nsw-data.html#cb530-3" tabindex="-1"></a><span class="fu">legend</span>(<span class="st">&quot;bottomleft&quot;</span>, <span class="at">legend =</span> <span class="fu">c</span>(<span class="st">&quot;Experimental&quot;</span>, <span class="st">&quot;Unadjusted&quot;</span>, <span class="st">&quot;Adjusted&quot;</span>), </span>
<span id="cb530-4"><a href="lalonde-nsw-data.html#cb530-4" tabindex="-1"></a>       <span class="at">lty =</span> <span class="dv">1</span>, <span class="at">pch =</span> <span class="fu">c</span>(<span class="dv">16</span>, <span class="dv">17</span>, <span class="dv">16</span>), <span class="at">col =</span> <span class="fu">c</span>(<span class="dv">4</span>, <span class="dv">2</span>, <span class="dv">1</span>), <span class="at">bty =</span> <span class="st">&quot;n&quot;</span>)</span>
<span id="cb530-5"><a href="lalonde-nsw-data.html#cb530-5" tabindex="-1"></a></span>
<span id="cb530-6"><a href="lalonde-nsw-data.html#cb530-6" tabindex="-1"></a><span class="co"># PSID1-PLUS trimmed</span></span>
<span id="cb530-7"><a href="lalonde-nsw-data.html#cb530-7" tabindex="-1"></a><span class="fu">plot_qte</span>(qte.nsw_psid.trim, qte.nsw_psid.trim0, qte.nsw.psid, <span class="at">main =</span> <span class="st">&quot;(O) NSW-PSID1-PLUS (Trimmed)&quot;</span>, ylim)</span>
<span id="cb530-8"><a href="lalonde-nsw-data.html#cb530-8" tabindex="-1"></a><span class="fu">legend</span>(<span class="st">&quot;bottomleft&quot;</span>, <span class="at">legend =</span> <span class="fu">c</span>(<span class="st">&quot;Experimental&quot;</span>, <span class="st">&quot;Unadjusted&quot;</span>, <span class="st">&quot;Adjusted&quot;</span>), </span>
<span id="cb530-9"><a href="lalonde-nsw-data.html#cb530-9" tabindex="-1"></a>    <span class="at">lty =</span> <span class="dv">1</span>, <span class="at">pch =</span> <span class="fu">c</span>(<span class="dv">16</span>, <span class="dv">17</span>, <span class="dv">16</span>), <span class="at">col =</span> <span class="fu">c</span>(<span class="dv">4</span>, <span class="dv">2</span>, <span class="dv">1</span>), <span class="at">bty =</span> <span class="st">&quot;n&quot;</span>)</span></code></pre></div>
<div class="figure"><span style="display:block;" id="fig:unnamed-chunk-278-4"></span>
<img src="Outcome-Weights_files/figure-html/unnamed-chunk-278-4.png" alt="FIGUREC13. SubfigureB:NSW-CPS1. SubfigureC:NSW-PSID1. SubfigureD-H:Top-NSW-CPS1. SubfigureI-M:Top-NSW-PSID1. SubfigureN:NSW-CPS1-PLUS. SubfigureO:NSW-PSID1-PLUS. QTET Estimates using NSW Data: Experimental vs. Nonexperimental" width="100%" />
<p class="caption">
Figure 3.97: FIGUREC13. SubfigureB:NSW-CPS1. SubfigureC:NSW-PSID1. SubfigureD-H:Top-NSW-CPS1. SubfigureI-M:Top-NSW-PSID1. SubfigureN:NSW-CPS1-PLUS. SubfigureO:NSW-PSID1-PLUS. QTET Estimates using NSW Data: Experimental vs. Nonexperimental
</p>
</div>
<p>These figures display QTET estimates derived from both the NSW experimental and various observational samples. The QTETs estimated from trimmed NSW-CPS1 sample (D) corresponds well with the true QTET, although the estimates are often underpowered. The QTET estimates from the original NSW-CPS1, the original NSW-PSID1 and its trimmed subsample (B, C and E) show clear biases when compared to the experimental benchmark, which clusters near zero. Among the top-ranked subsamples, CPS1-based QTETs (F–J) consistently track the true QTET closely. In contrast, PSID1-based QTETs (K–O) generally perform well, aligning closely with the true QTET, except for subsamples <code>mahvars</code> and <code>card</code>, which exhibit increased bias and noticeably wider confidence intervals, reflecting greater estimation uncertainty.</p>
<div class="sourceCode" id="cb531"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb531-1"><a href="lalonde-nsw-data.html#cb531-1" tabindex="-1"></a><span class="co"># list results</span></span>
<span id="cb531-2"><a href="lalonde-nsw-data.html#cb531-2" tabindex="-1"></a>plots_nsw <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb531-3"><a href="lalonde-nsw-data.html#cb531-3" tabindex="-1"></a>  <span class="fu">list</span>(<span class="at">mod =</span> qte.nsw_cps, <span class="at">mod0 =</span> qte.nsw_cps0, <span class="at">bm =</span> qte.nsw, </span>
<span id="cb531-4"><a href="lalonde-nsw-data.html#cb531-4" tabindex="-1"></a>       <span class="at">main =</span> <span class="st">&quot;(B) NSW CPS1&quot;</span>),</span>
<span id="cb531-5"><a href="lalonde-nsw-data.html#cb531-5" tabindex="-1"></a>  <span class="fu">list</span>(<span class="at">mod =</span> qte.nsw_psid, <span class="at">mod0 =</span> qte.nsw_psid0, <span class="at">bm =</span> qte.nsw, </span>
<span id="cb531-6"><a href="lalonde-nsw-data.html#cb531-6" tabindex="-1"></a>       <span class="at">main =</span> <span class="st">&quot;(C) NSW PSID1&quot;</span>),</span>
<span id="cb531-7"><a href="lalonde-nsw-data.html#cb531-7" tabindex="-1"></a>  <span class="fu">list</span>(<span class="at">mod =</span> qte.nsw_cps.trim, <span class="at">mod0 =</span> qte.nsw_cps.trim0, <span class="at">bm =</span> qte.nsw.cps, </span>
<span id="cb531-8"><a href="lalonde-nsw-data.html#cb531-8" tabindex="-1"></a>       <span class="at">main =</span> <span class="st">&quot;(N) NSW CPS1-PLUS (Trimmed)&quot;</span>),</span>
<span id="cb531-9"><a href="lalonde-nsw-data.html#cb531-9" tabindex="-1"></a>  <span class="fu">list</span>(<span class="at">mod =</span> qte.nsw_psid.trim, <span class="at">mod0 =</span> qte.nsw_psid.trim0, <span class="at">bm =</span> qte.nsw.psid, </span>
<span id="cb531-10"><a href="lalonde-nsw-data.html#cb531-10" tabindex="-1"></a>       <span class="at">main =</span> <span class="st">&quot;(O) NSW PSID1-PLUS (Trimmed)&quot;</span>)</span>
<span id="cb531-11"><a href="lalonde-nsw-data.html#cb531-11" tabindex="-1"></a>)</span>
<span id="cb531-12"><a href="lalonde-nsw-data.html#cb531-12" tabindex="-1"></a></span>
<span id="cb531-13"><a href="lalonde-nsw-data.html#cb531-13" tabindex="-1"></a><span class="co"># save results</span></span>
<span id="cb531-14"><a href="lalonde-nsw-data.html#cb531-14" tabindex="-1"></a><span class="fu">save_qtet</span>(plots_nsw, <span class="at">prefix =</span> <span class="st">&quot;nsw&quot;</span>)</span>
<span id="cb531-15"><a href="lalonde-nsw-data.html#cb531-15" tabindex="-1"></a><span class="fu">save_qte_top</span>(qte.top5_cps, qte.top5_cps0, qte.nsw, all_plot_titles, </span>
<span id="cb531-16"><a href="lalonde-nsw-data.html#cb531-16" tabindex="-1"></a>             <span class="at">main_start =</span> <span class="dv">8</span>, <span class="at">prefix =</span> <span class="st">&quot;nsw_top&quot;</span>)</span>
<span id="cb531-17"><a href="lalonde-nsw-data.html#cb531-17" tabindex="-1"></a><span class="fu">save_qte_top</span>(qte.top5_psid, qte.top5_psid0, qte.nsw, all_plot_titles, </span>
<span id="cb531-18"><a href="lalonde-nsw-data.html#cb531-18" tabindex="-1"></a>             <span class="at">main_start =</span> <span class="dv">13</span>, <span class="at">prefix =</span> <span class="st">&quot;nsw_top&quot;</span>)</span></code></pre></div>
</div>
<div id="assessing-outcome-weights-ow-1" class="section level3 hasAnchor" number="3.8.4">
<h3><span class="header-section-number">3.8.4</span> Assessing outcome weights (OW)<a href="lalonde-nsw-data.html#assessing-outcome-weights-ow-1" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb532"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb532-1"><a href="lalonde-nsw-data.html#cb532-1" tabindex="-1"></a><span class="co"># list all datasets</span></span>
<span id="cb532-2"><a href="lalonde-nsw-data.html#cb532-2" tabindex="-1"></a>all_datasets <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fu">list</span>(nsw, nsw_cps, nsw_psid), </span>
<span id="cb532-3"><a href="lalonde-nsw-data.html#cb532-3" tabindex="-1"></a>                  top5_datasets.cps, top5_datasets.psid, </span>
<span id="cb532-4"><a href="lalonde-nsw-data.html#cb532-4" tabindex="-1"></a>                  <span class="fu">list</span>(nsw_cps_trim_match, nsw_psid_trim_match))</span></code></pre></div>
<div class="sourceCode" id="cb533"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb533-1"><a href="lalonde-nsw-data.html#cb533-1" tabindex="-1"></a><span class="co"># estimate ATT </span></span>
<span id="cb533-2"><a href="lalonde-nsw-data.html#cb533-2" tabindex="-1"></a>res_att <span class="ot">&lt;-</span> <span class="fu">get_res_att</span>(all_datasets, Y, treat, covar)</span>
<span id="cb533-3"><a href="lalonde-nsw-data.html#cb533-3" tabindex="-1"></a><span class="co"># extract outcome weights</span></span>
<span id="cb533-4"><a href="lalonde-nsw-data.html#cb533-4" tabindex="-1"></a>ow_att <span class="ot">&lt;-</span> <span class="fu">derive_ow</span>(res_att)</span></code></pre></div>
<div class="sourceCode" id="cb534"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb534-1"><a href="lalonde-nsw-data.html#cb534-1" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">2</span>))</span>
<span id="cb534-2"><a href="lalonde-nsw-data.html#cb534-2" tabindex="-1"></a><span class="fu">par</span>(<span class="at">cex.main =</span> <span class="fl">0.8</span>)</span>
<span id="cb534-3"><a href="lalonde-nsw-data.html#cb534-3" tabindex="-1"></a><span class="co"># plot outcome weights distribution</span></span>
<span id="cb534-4"><a href="lalonde-nsw-data.html#cb534-4" tabindex="-1"></a><span class="fu">plot_ow</span>(ow_att, all_plot_titles) </span></code></pre></div>
<div class="figure"><span style="display:block;" id="fig:unnamed-chunk-282-1"></span>
<img src="Outcome-Weights_files/figure-html/unnamed-chunk-282-1.png" alt="FIGUREC14. Outcome Weights using NSW Data" width="100%" />
<p class="caption">
Figure 3.98: FIGUREC14. Outcome Weights using NSW Data
</p>
</div>
<div class="figure"><span style="display:block;" id="fig:unnamed-chunk-282-2"></span>
<img src="Outcome-Weights_files/figure-html/unnamed-chunk-282-2.png" alt="FIGUREC14. Outcome Weights using NSW Data" width="100%" />
<p class="caption">
Figure 3.99: FIGUREC14. Outcome Weights using NSW Data
</p>
</div>
<div class="figure"><span style="display:block;" id="fig:unnamed-chunk-282-3"></span>
<img src="Outcome-Weights_files/figure-html/unnamed-chunk-282-3.png" alt="FIGUREC14. Outcome Weights using NSW Data" width="100%" />
<p class="caption">
Figure 3.100: FIGUREC14. Outcome Weights using NSW Data
</p>
</div>
<div class="figure"><span style="display:block;" id="fig:unnamed-chunk-282-4"></span>
<img src="Outcome-Weights_files/figure-html/unnamed-chunk-282-4.png" alt="FIGUREC14. Outcome Weights using NSW Data" width="100%" />
<p class="caption">
Figure 3.101: FIGUREC14. Outcome Weights using NSW Data
</p>
</div>
<div class="sourceCode" id="cb535"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb535-1"><a href="lalonde-nsw-data.html#cb535-1" tabindex="-1"></a><span class="co"># evaluate results</span></span>
<span id="cb535-2"><a href="lalonde-nsw-data.html#cb535-2" tabindex="-1"></a>res_ow <span class="ot">&lt;-</span> <span class="fu">eval_ow</span>(ow_att, all_datasets, all_plot_titles, treat, <span class="st">&quot;AIPW-ATT&quot;</span>)</span>
<span id="cb535-3"><a href="lalonde-nsw-data.html#cb535-3" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">kable</span>(res_ow, <span class="at">caption =</span> <span class="st">&quot;Outcome Weights for Treated and Untreated&quot;</span>, <span class="at">booktabs =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb535-4"><a href="lalonde-nsw-data.html#cb535-4" tabindex="-1"></a>  <span class="fu">kable_styling</span>(<span class="at">full_width =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb535-5"><a href="lalonde-nsw-data.html#cb535-5" tabindex="-1"></a>  <span class="fu">scroll_box</span>(<span class="at">height =</span> <span class="st">&quot;800px&quot;</span>, <span class="at">width =</span> <span class="st">&quot;100%&quot;</span>)</span></code></pre></div>
<div style="border: 1px solid #ddd; padding: 0px; overflow-y: scroll; height:800px; overflow-x: scroll; width:100%; ">
<table class="table" style="margin-left: auto; margin-right: auto;">
<caption>
<span id="tab:unnamed-chunk-283">Table 3.9: </span><span id="tab:unnamed-chunk-283">Table 3.10: </span>Outcome Weights for Treated and Untreated
</caption>
<thead>
<tr>
<th style="text-align:left;position: sticky; top:0; background-color: #FFFFFF;">
Method
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
Sum_Treated
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
Sum_Untreated
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
<ol style="list-style-type: upper-alpha">
<li>NSW-Experimental
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
-1
</td>
</tr>
<tr>
<td style="text-align:left;">
<ol start="2" style="list-style-type: upper-alpha">
<li>NSW-CPS1
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
-1
</td>
</tr>
<tr>
<td style="text-align:left;">
<ol start="3" style="list-style-type: upper-alpha">
<li>NSW-PSID1
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
-1
</td>
</tr>
<tr>
<td style="text-align:left;">
<ol start="6" style="list-style-type: upper-alpha">
<li>Top CPS1: mahvars
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
-1
</td>
</tr>
<tr>
<td style="text-align:left;">
<ol start="7" style="list-style-type: upper-alpha">
<li>Top CPS1: k3
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
-1
</td>
</tr>
<tr>
<td style="text-align:left;">
<ol start="8" style="list-style-type: upper-alpha">
<li>Top CPS1: exact
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
-1
</td>
</tr>
<tr>
<td style="text-align:left;">
<ol style="list-style-type: upper-roman">
<li>Top CPS1: cem
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
-1
</td>
</tr>
<tr>
<td style="text-align:left;">
<ol start="10" style="list-style-type: upper-alpha">
<li>Top CPS1: card
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
-1
</td>
</tr>
<tr>
<td style="text-align:left;">
<ol start="11" style="list-style-type: upper-alpha">
<li>Top PSID1: card
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
-1
</td>
</tr>
<tr>
<td style="text-align:left;">
<ol start="12" style="list-style-type: upper-alpha">
<li>Top PSID1: mahvars
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
-1
</td>
</tr>
<tr>
<td style="text-align:left;">
<ol start="13" style="list-style-type: upper-alpha">
<li>Top PSID1: optimal_pair
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
-1
</td>
</tr>
<tr>
<td style="text-align:left;">
<ol start="14" style="list-style-type: upper-alpha">
<li>Top PSID1: fix_max_value_opt_weight
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
-1
</td>
</tr>
<tr>
<td style="text-align:left;">
<ol start="15" style="list-style-type: upper-alpha">
<li>Top PSID1: exact
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
-1
</td>
</tr>
<tr>
<td style="text-align:left;">
<ol start="14" style="list-style-type: upper-alpha">
<li>Trimmed NSW-CPS1-PLUS
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
-1
</td>
</tr>
<tr>
<td style="text-align:left;">
<ol start="15" style="list-style-type: upper-alpha">
<li>Trimmed NSW-PSID1-PLUS
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
-1
</td>
</tr>
</tbody>
</table>
</div></li>
</ol></li>
</ol></li>
</ol></li>
</ol></li>
</ol></li>
</ol></li>
</ol></li>
</ol></li>
</ol></li>
</ol></li>
</ol></li>
</ol></li>
</ol></li>
</ol></li>
</ol>
<div class="sourceCode" id="cb536"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb536-1"><a href="lalonde-nsw-data.html#cb536-1" tabindex="-1"></a><span class="co">#save results</span></span>
<span id="cb536-2"><a href="lalonde-nsw-data.html#cb536-2" tabindex="-1"></a><span class="fu">save_ow</span>(ow_att, all_plot_titles, <span class="at">prefix =</span> <span class="st">&quot;nsw&quot;</span>)</span></code></pre></div>
<p>Consistent with the preceding sections, the evaluation shows that, across each sample, the estimated outcome weights sum to one within the treated group and to minus one within the untreated group, yielding an overall total of zero.</p>
<div class="callout-tip">
<p>A placebo test is not performed as the NSW data comes from a randomized controlled trial (RCT), which ensures internal validity and unbiased treatment effect estimates, without confounding.</p>
</div>
<div id="validation-through-sensitivity-analyses-1" class="section level2 hasAnchor" number="3.9">
<h2><span class="header-section-number">3.9</span> Validation through sensitivity analyses<a href="lalonde-nsw-data.html#validation-through-sensitivity-analyses-1" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div class="sourceCode" id="cb537"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb537-1"><a href="lalonde-nsw-data.html#cb537-1" tabindex="-1"></a><span class="co"># define variables</span></span>
<span id="cb537-2"><a href="lalonde-nsw-data.html#cb537-2" tabindex="-1"></a>Y <span class="ot">&lt;-</span> <span class="st">&quot;re78&quot;</span></span>
<span id="cb537-3"><a href="lalonde-nsw-data.html#cb537-3" tabindex="-1"></a>treat <span class="ot">&lt;-</span> <span class="st">&quot;treat&quot;</span></span>
<span id="cb537-4"><a href="lalonde-nsw-data.html#cb537-4" tabindex="-1"></a>covar <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;age&quot;</span>, <span class="st">&quot;education&quot;</span>, <span class="st">&quot;black&quot;</span>, <span class="st">&quot;hispanic&quot;</span>, <span class="st">&quot;married&quot;</span>, <span class="st">&quot;nodegree&quot;</span>, <span class="st">&quot;re75&quot;</span>, <span class="st">&quot;u75&quot;</span>)</span>
<span id="cb537-5"><a href="lalonde-nsw-data.html#cb537-5" tabindex="-1"></a>bm <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;re75&quot;</span>)</span></code></pre></div>
<div class="sourceCode" id="cb538"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb538-1"><a href="lalonde-nsw-data.html#cb538-1" tabindex="-1"></a><span class="co"># check for valid datasets </span></span>
<span id="cb538-2"><a href="lalonde-nsw-data.html#cb538-2" tabindex="-1"></a>filtered_datasets_sens <span class="ot">&lt;-</span> <span class="fu">check_filter_datasets</span>(all_datasets, Y, treat, covar, bm)</span></code></pre></div>
<div class="sourceCode" id="cb539"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb539-1"><a href="lalonde-nsw-data.html#cb539-1" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">2</span>))</span>
<span id="cb539-2"><a href="lalonde-nsw-data.html#cb539-2" tabindex="-1"></a><span class="fu">par</span>(<span class="at">cex.main =</span> <span class="fl">0.8</span>)</span>
<span id="cb539-3"><a href="lalonde-nsw-data.html#cb539-3" tabindex="-1"></a><span class="co"># loop over valid datasets and assign index</span></span>
<span id="cb539-4"><a href="lalonde-nsw-data.html#cb539-4" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="fu">seq_along</span>(filtered_datasets_sens)) {</span>
<span id="cb539-5"><a href="lalonde-nsw-data.html#cb539-5" tabindex="-1"></a>    idx <span class="ot">&lt;-</span> <span class="fu">which</span>(<span class="fu">sapply</span>(all_datasets, identical, filtered_datasets_sens[[i]]))</span>
<span id="cb539-6"><a href="lalonde-nsw-data.html#cb539-6" tabindex="-1"></a>    <span class="fu">sens_ana</span>(filtered_datasets_sens[[i]], Y, treat, covar, bm, <span class="at">kd =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>)</span>
<span id="cb539-7"><a href="lalonde-nsw-data.html#cb539-7" tabindex="-1"></a>    <span class="fu">title</span>(<span class="at">main =</span> all_plot_titles[idx])</span>
<span id="cb539-8"><a href="lalonde-nsw-data.html#cb539-8" tabindex="-1"></a>}</span></code></pre></div>
<div class="figure"><span style="display:block;" id="fig:unnamed-chunk-287-1"></span>
<img src="Outcome-Weights_files/figure-html/unnamed-chunk-287-1.png" alt="FIGUREC15. Sensitivity Analyses NSW" width="100%" />
<p class="caption">
Figure 3.102: FIGUREC15. Sensitivity Analyses NSW
</p>
</div>
<div class="figure"><span style="display:block;" id="fig:unnamed-chunk-287-2"></span>
<img src="Outcome-Weights_files/figure-html/unnamed-chunk-287-2.png" alt="FIGUREC15. Sensitivity Analyses NSW" width="100%" />
<p class="caption">
Figure 3.103: FIGUREC15. Sensitivity Analyses NSW
</p>
</div>
<div class="figure"><span style="display:block;" id="fig:unnamed-chunk-287-3"></span>
<img src="Outcome-Weights_files/figure-html/unnamed-chunk-287-3.png" alt="FIGUREC15. Sensitivity Analyses NSW" width="100%" />
<p class="caption">
Figure 3.104: FIGUREC15. Sensitivity Analyses NSW
</p>
</div>
<div class="figure"><span style="display:block;" id="fig:unnamed-chunk-287-4"></span>
<img src="Outcome-Weights_files/figure-html/unnamed-chunk-287-4.png" alt="FIGUREC15. Sensitivity Analyses NSW" width="100%" />
<p class="caption">
Figure 3.105: FIGUREC15. Sensitivity Analyses NSW
</p>
</div>
<div class="sourceCode" id="cb540"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb540-1"><a href="lalonde-nsw-data.html#cb540-1" tabindex="-1"></a><span class="co"># save results</span></span>
<span id="cb540-2"><a href="lalonde-nsw-data.html#cb540-2" tabindex="-1"></a><span class="fu">save_sensitivity_plots</span>(filtered_datasets_sens, Y, treat, covar, bm, all_plot_titles, <span class="st">&quot;nsw&quot;</span>)</span></code></pre></div>
<p>The sensitivity analysis shows that for most samples, the estimated treatment effects are fairly robust to increasing confounder strength, as indicated by relatively stable values despite up to triple the correlation levels of <code>re78</code>.</p>
</div>
<div id="summary-1" class="section level2 hasAnchor" number="3.10">
<h2><span class="header-section-number">3.10</span> Summary<a href="lalonde-nsw-data.html#summary-1" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>After reexamining the original LaLonde (NSW) dataset, the results confirm that the NSW-Experimental data shows nearly perfect overlap between treated and control groups, while the observational datasets (NSW-CPS1 and NSW-PSID1) display weak overlap, with many treated units outside the control range. Expanding these datasets with experimental controls improves overlap but does not consistently enhance covariate balance.</p>
<p>These findings reinforce the lessons from previous LDW analyses: even with improved overlap and some gains in covariate balance, achieving consistent and reliable effect estimation remains difficult, especially with non-experimental data. The results highlight the persistent limitations of observational samples in replicating experimental benchmarks.</p>

</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div id="refs" class="references csl-bib-body hanging-indent" entry-spacing="0">
<div class="csl-entry">
Greifer, Noah. 2025a. <span>“Matching Methods.”</span>
</div>
<div class="csl-entry">
———. 2025b. <span>“Using WeightIt to Estimate Balancing Weights.”</span>
</div>
<div class="csl-entry">
Imbens, Guido W., and Yiqing Xu. 2024. <span>“LaLonde (1986) After Nearly Four Decades: Lessons Learned.”</span>
</div>
<div class="csl-entry">
Ju, Cheng, Joshua Schwab, and Mark J. van der Laan. 2013. <span>“On Adaptive Propensity Score Truncation in Causal Inference.”</span>
</div>
<div class="csl-entry">
Knaus, Michael C., and Henri Pfleiderer. 2024. <span>“Outcome Weights.”</span>
</div>
<div class="csl-entry">
Matsouaka, Roland A., and Yunji Zhou. 2023. <span>“Causal Inference in the Absence of Positivity: The Role of Overlap Weights.”</span> <em>Biometrical Journal</em>.
</div>
<div class="csl-entry">
Stürmer, Til, Michael Webster-Clark, Jennifer L. Lund, Richard Wyss, Alan R. Ellis, Mark Lunt, Kenneth J. Rothman, and Robert J. Glynn. 2021. <span>“Propensity Score Weighting and Trimming Strategies for Reducing Variance and Bias of Treatment Effect Estimates: A Simulation Study.”</span> <em>American Journal of Epidemiology</em>.
</div>
</div>
</div>
</div>
</div>
<h3>References</h3>
<div id="refs" class="references csl-bib-body hanging-indent" entry-spacing="0">
<div id="ref-imbens2024" class="csl-entry">
Imbens, Guido W., and Yiqing Xu. 2024. <span>“LaLonde (1986) After Nearly Four Decades: Lessons Learned.”</span>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="lalonde-dehejia-wahba-ldw-data.html" class="navigation navigation-prev navigation-unique" aria-label="Previous page"><i class="fa fa-angle-left"></i></a>

    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
  "sharing": {
    "github": false,
    "facebook": true,
    "twitter": true,
    "linkedin": false,
    "weibo": false,
    "instapaper": false,
    "vk": false,
    "whatsapp": false,
    "all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
  },
  "fontsettings": {
    "theme": "white",
    "family": "sans",
    "size": 2
  },
  "edit": {
    "link": "https://github.com/lkrsl/Application-of-Outcome-Weights-Framework-for-DML-to-Lalonde-Study/edit/main/tutorial/04-NSW.Rmd",
    "text": "Edit"
  },
  "history": {
    "link": null,
    "text": null
  },
  "view": {
    "link": null,
    "text": null
  },
  "download": ["Outcome-Weights.pdf", "Outcome-Weights.epub"],
  "search": {
    "engine": "fuse",
    "options": null
  },
  "toc": {
    "collapse": "subsection"
  }
});
});
</script>

</body>

</html>

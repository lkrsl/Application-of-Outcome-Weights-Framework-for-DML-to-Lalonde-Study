<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 4 LaLonde (NSW) Data | Application of the Outcome Weights Framework for Double Machine Learning to the Lalonde Study</title>
  <meta name="description" content="<p>This book replicates the LaLonde study by Imbens &amp; Xu (2024) and extends it by comparing a
full with a reduced covariate model to assess potential confounding.
It evaluates various methods to improve overlap and covariate balance for robust
treatment effect estimation and applies the outcome weights framework by Knaus &amp; Pfleiderer (2024)
to assess another estimator, while analysing the distributional properties of resulting outcome weights.
It further applies placebo tests and sensitivity analysis to assess the robustness of the treatment effect estimates.
The analysis draws on the original LaLonde data (NSW) as well as the LaLonde–Dehejia–Wahba (LDW) and
LaLonde–Calónico–Smith (LCS) data.</p>" />
  <meta name="generator" content="bookdown 0.45 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 4 LaLonde (NSW) Data | Application of the Outcome Weights Framework for Double Machine Learning to the Lalonde Study" />
  <meta property="og:type" content="book" />
  
  <meta property="og:description" content="<p>This book replicates the LaLonde study by Imbens &amp; Xu (2024) and extends it by comparing a
full with a reduced covariate model to assess potential confounding.
It evaluates various methods to improve overlap and covariate balance for robust
treatment effect estimation and applies the outcome weights framework by Knaus &amp; Pfleiderer (2024)
to assess another estimator, while analysing the distributional properties of resulting outcome weights.
It further applies placebo tests and sensitivity analysis to assess the robustness of the treatment effect estimates.
The analysis draws on the original LaLonde data (NSW) as well as the LaLonde–Dehejia–Wahba (LDW) and
LaLonde–Calónico–Smith (LCS) data.</p>" />
  <meta name="github-repo" content="lkrsl/Application-of-Outcome-Weights-Framework-for-DML-to-Lalonde-Study" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 4 LaLonde (NSW) Data | Application of the Outcome Weights Framework for Double Machine Learning to the Lalonde Study" />
  
  <meta name="twitter:description" content="<p>This book replicates the LaLonde study by Imbens &amp; Xu (2024) and extends it by comparing a
full with a reduced covariate model to assess potential confounding.
It evaluates various methods to improve overlap and covariate balance for robust
treatment effect estimation and applies the outcome weights framework by Knaus &amp; Pfleiderer (2024)
to assess another estimator, while analysing the distributional properties of resulting outcome weights.
It further applies placebo tests and sensitivity analysis to assess the robustness of the treatment effect estimates.
The analysis draws on the original LaLonde data (NSW) as well as the LaLonde–Dehejia–Wahba (LDW) and
LaLonde–Calónico–Smith (LCS) data.</p>" />
  

<meta name="author" content="Laura Kreisel" />


<meta name="date" content="2025-12-04" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="lalonde-dehejia-wahba-ldw-data-1.html"/>
<link rel="next" href="lalonde-calónico-smith-lcs-data.html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>
<link href="libs/htmltools-fill-0.5.8.1/fill.css" rel="stylesheet" />
<script src="libs/htmlwidgets-1.6.4/htmlwidgets.js"></script>
<link href="libs/datatables-css-0.0.0/datatables-crosstalk.css" rel="stylesheet" />
<script src="libs/datatables-binding-0.34.0/datatables.js"></script>
<link href="libs/dt-core-1.13.6/css/jquery.dataTables.min.css" rel="stylesheet" />
<link href="libs/dt-core-1.13.6/css/jquery.dataTables.extra.css" rel="stylesheet" />
<script src="libs/dt-core-1.13.6/js/jquery.dataTables.min.js"></script>
<link href="libs/crosstalk-1.2.2/css/crosstalk.min.css" rel="stylesheet" />
<script src="libs/crosstalk-1.2.2/js/crosstalk.min.js"></script>


<style type="text/css">
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
  
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
</style>
<style type="text/css">
/* Used with Pandoc 2.11+ new --citeproc when CSL is used */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
  margin-bottom: 0em;
}
.hanging div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}
</style>

<link rel="stylesheet" href="tutorial/style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Application of Outcome Weights Framework for DML to Lalonde Study</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Preface</a></li>
<li class="chapter" data-level="1" data-path="getting-started.html"><a href="getting-started.html"><i class="fa fa-check"></i><b>1</b> Getting started</a>
<ul>
<li class="chapter" data-level="1.1" data-path="getting-started.html"><a href="getting-started.html#installation"><i class="fa fa-check"></i><b>1.1</b> Installation</a></li>
<li class="chapter" data-level="1.2" data-path="getting-started.html"><a href="getting-started.html#wrapper-functions"><i class="fa fa-check"></i><b>1.2</b> Wrapper functions</a>
<ul>
<li class="chapter" data-level="1.2.1" data-path="getting-started.html"><a href="getting-started.html#overview"><i class="fa fa-check"></i><b>1.2.1</b> Overview</a></li>
<li class="chapter" data-level="1.2.2" data-path="getting-started.html"><a href="getting-started.html#inspection"><i class="fa fa-check"></i><b>1.2.2</b> Inspection</a></li>
<li class="chapter" data-level="1.2.3" data-path="getting-started.html"><a href="getting-started.html#improving-covariate-balance-and-overlap"><i class="fa fa-check"></i><b>1.2.3</b> Improving covariate balance and overlap</a></li>
<li class="chapter" data-level="1.2.4" data-path="getting-started.html"><a href="getting-started.html#assessing-methods"><i class="fa fa-check"></i><b>1.2.4</b> Assessing methods</a></li>
<li class="chapter" data-level="1.2.5" data-path="getting-started.html"><a href="getting-started.html#identifying-best-methods"><i class="fa fa-check"></i><b>1.2.5</b> Identifying best methods</a></li>
<li class="chapter" data-level="1.2.6" data-path="getting-started.html"><a href="getting-started.html#estimating"><i class="fa fa-check"></i><b>1.2.6</b> Estimating</a></li>
<li class="chapter" data-level="1.2.7" data-path="getting-started.html"><a href="getting-started.html#outcome-weights-analysis"><i class="fa fa-check"></i><b>1.2.7</b> Outcome weights analysis</a></li>
<li class="chapter" data-level="1.2.8" data-path="getting-started.html"><a href="getting-started.html#sensitivity-analysis"><i class="fa fa-check"></i><b>1.2.8</b> Sensitivity analysis</a></li>
<li class="chapter" data-level="1.2.9" data-path="getting-started.html"><a href="getting-started.html#balance-analysis"><i class="fa fa-check"></i><b>1.2.9</b> Balance analysis</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="2" data-path="lalonde-dehejia-wahba-ldw-data.html"><a href="lalonde-dehejia-wahba-ldw-data.html"><i class="fa fa-check"></i><b>2</b> LaLonde-Dehejia-Wahba (LDW) Data</a>
<ul>
<li class="chapter" data-level="2.1" data-path="lalonde-dehejia-wahba-ldw-data.html"><a href="lalonde-dehejia-wahba-ldw-data.html#set-up"><i class="fa fa-check"></i><b>2.1</b> Set up</a>
<ul>
<li class="chapter" data-level="2.1.1" data-path="lalonde-dehejia-wahba-ldw-data.html"><a href="lalonde-dehejia-wahba-ldw-data.html#source-functions-and-load-data"><i class="fa fa-check"></i><b>2.1.1</b> Source functions and load data</a></li>
<li class="chapter" data-level="2.1.2" data-path="lalonde-dehejia-wahba-ldw-data.html"><a href="lalonde-dehejia-wahba-ldw-data.html#inspect-data"><i class="fa fa-check"></i><b>2.1.2</b> Inspect data</a></li>
<li class="chapter" data-level="2.1.3" data-path="lalonde-dehejia-wahba-ldw-data.html"><a href="lalonde-dehejia-wahba-ldw-data.html#load-and-preprocess-data"><i class="fa fa-check"></i><b>2.1.3</b> Load and preprocess data</a></li>
</ul></li>
<li class="chapter" data-level="2.2" data-path="lalonde-dehejia-wahba-ldw-data.html"><a href="lalonde-dehejia-wahba-ldw-data.html#ldw-model-a"><i class="fa fa-check"></i><b>2.2</b> LDW-Model A</a></li>
<li class="chapter" data-level="2.3" data-path="lalonde-dehejia-wahba-ldw-data.html"><a href="lalonde-dehejia-wahba-ldw-data.html#pre-assessing-methods"><i class="fa fa-check"></i><b>2.3</b> Pre-assessing methods</a>
<ul>
<li class="chapter" data-level="2.3.1" data-path="lalonde-dehejia-wahba-ldw-data.html"><a href="lalonde-dehejia-wahba-ldw-data.html#overlap"><i class="fa fa-check"></i><b>2.3.1</b> Overlap</a></li>
</ul></li>
<li class="chapter" data-level="2.4" data-path="lalonde-dehejia-wahba-ldw-data.html"><a href="lalonde-dehejia-wahba-ldw-data.html#improving-overlap"><i class="fa fa-check"></i><b>2.4</b> Improving overlap</a>
<ul>
<li class="chapter" data-level="2.4.1" data-path="lalonde-dehejia-wahba-ldw-data.html"><a href="lalonde-dehejia-wahba-ldw-data.html#single-methods"><i class="fa fa-check"></i><b>2.4.1</b> Single methods</a></li>
<li class="chapter" data-level="2.4.2" data-path="lalonde-dehejia-wahba-ldw-data.html"><a href="lalonde-dehejia-wahba-ldw-data.html#integrated-methods-2"><i class="fa fa-check"></i><b>2.4.2</b> Integrated methods</a></li>
</ul></li>
<li class="chapter" data-level="2.5" data-path="lalonde-dehejia-wahba-ldw-data.html"><a href="lalonde-dehejia-wahba-ldw-data.html#post-assessing-methods"><i class="fa fa-check"></i><b>2.5</b> Post-assessing methods</a>
<ul>
<li class="chapter" data-level="2.5.1" data-path="lalonde-dehejia-wahba-ldw-data.html"><a href="lalonde-dehejia-wahba-ldw-data.html#single-methods-1"><i class="fa fa-check"></i><b>2.5.1</b> Single methods</a></li>
<li class="chapter" data-level="2.5.2" data-path="lalonde-dehejia-wahba-ldw-data.html"><a href="lalonde-dehejia-wahba-ldw-data.html#integrated-methods-3"><i class="fa fa-check"></i><b>2.5.2</b> Integrated methods</a></li>
</ul></li>
<li class="chapter" data-level="2.6" data-path="lalonde-dehejia-wahba-ldw-data.html"><a href="lalonde-dehejia-wahba-ldw-data.html#identifying-most-efficient-methods"><i class="fa fa-check"></i><b>2.6</b> Identifying most efficient methods</a>
<ul>
<li class="chapter" data-level="2.6.1" data-path="lalonde-dehejia-wahba-ldw-data.html"><a href="lalonde-dehejia-wahba-ldw-data.html#ranking"><i class="fa fa-check"></i><b>2.6.1</b> Ranking</a></li>
<li class="chapter" data-level="2.6.2" data-path="lalonde-dehejia-wahba-ldw-data.html"><a href="lalonde-dehejia-wahba-ldw-data.html#sample-construction"><i class="fa fa-check"></i><b>2.6.2</b> Sample construction</a></li>
</ul></li>
<li class="chapter" data-level="2.7" data-path="lalonde-dehejia-wahba-ldw-data.html"><a href="lalonde-dehejia-wahba-ldw-data.html#estimating-1"><i class="fa fa-check"></i><b>2.7</b> Estimating</a>
<ul>
<li class="chapter" data-level="2.7.1" data-path="lalonde-dehejia-wahba-ldw-data.html"><a href="lalonde-dehejia-wahba-ldw-data.html#average-treatment-effect-on-the-treated-att"><i class="fa fa-check"></i><b>2.7.1</b> Average treatment effect on the treated (ATT)</a></li>
<li class="chapter" data-level="2.7.2" data-path="lalonde-dehejia-wahba-ldw-data.html"><a href="lalonde-dehejia-wahba-ldw-data.html#conditional-average-treatment-effect-on-the-treated-catt-1"><i class="fa fa-check"></i><b>2.7.2</b> Conditional average treatment effect on the treated (CATT)</a></li>
<li class="chapter" data-level="2.7.3" data-path="lalonde-dehejia-wahba-ldw-data.html"><a href="lalonde-dehejia-wahba-ldw-data.html#quantile-treatment-effect-on-the-treated-qtet"><i class="fa fa-check"></i><b>2.7.3</b> Quantile treatment effect on the treated (QTET)</a></li>
<li class="chapter" data-level="2.7.4" data-path="lalonde-dehejia-wahba-ldw-data.html"><a href="lalonde-dehejia-wahba-ldw-data.html#assessing-outcome-weights-ow"><i class="fa fa-check"></i><b>2.7.4</b> Assessing outcome weights (OW)</a></li>
</ul></li>
<li class="chapter" data-level="2.8" data-path="lalonde-dehejia-wahba-ldw-data.html"><a href="lalonde-dehejia-wahba-ldw-data.html#validation-through-placebo-analyses"><i class="fa fa-check"></i><b>2.8</b> Validation through placebo analyses</a></li>
<li class="chapter" data-level="2.9" data-path="lalonde-dehejia-wahba-ldw-data.html"><a href="lalonde-dehejia-wahba-ldw-data.html#validation-through-sensitivity-analyses"><i class="fa fa-check"></i><b>2.9</b> Validation through sensitivity analyses</a></li>
<li class="chapter" data-level="2.10" data-path="lalonde-dehejia-wahba-ldw-data.html"><a href="lalonde-dehejia-wahba-ldw-data.html#inspection-of-re74-and-re75"><i class="fa fa-check"></i><b>2.10</b> Inspection of re74 and re75</a>
<ul>
<li class="chapter" data-level="2.10.1" data-path="lalonde-dehejia-wahba-ldw-data.html"><a href="lalonde-dehejia-wahba-ldw-data.html#correlation"><i class="fa fa-check"></i><b>2.10.1</b> Correlation</a></li>
<li class="chapter" data-level="2.10.2" data-path="lalonde-dehejia-wahba-ldw-data.html"><a href="lalonde-dehejia-wahba-ldw-data.html#distributional-balance"><i class="fa fa-check"></i><b>2.10.2</b> Distributional balance</a></li>
</ul></li>
<li class="chapter" data-level="2.11" data-path="lalonde-dehejia-wahba-ldw-data.html"><a href="lalonde-dehejia-wahba-ldw-data.html#summary"><i class="fa fa-check"></i><b>2.11</b> Summary</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="lalonde-dehejia-wahba-ldw-data-1.html"><a href="lalonde-dehejia-wahba-ldw-data-1.html"><i class="fa fa-check"></i><b>3</b> LaLonde-Dehejia-Wahba (LDW) Data</a>
<ul>
<li class="chapter" data-level="3.1" data-path="lalonde-dehejia-wahba-ldw-data-1.html"><a href="lalonde-dehejia-wahba-ldw-data-1.html#set-up-1"><i class="fa fa-check"></i><b>3.1</b> Set up</a>
<ul>
<li class="chapter" data-level="3.1.1" data-path="lalonde-dehejia-wahba-ldw-data-1.html"><a href="lalonde-dehejia-wahba-ldw-data-1.html#source-functions-and-load-data-1"><i class="fa fa-check"></i><b>3.1.1</b> Source functions and load data</a></li>
<li class="chapter" data-level="3.1.2" data-path="lalonde-dehejia-wahba-ldw-data-1.html"><a href="lalonde-dehejia-wahba-ldw-data-1.html#inspect-data-1"><i class="fa fa-check"></i><b>3.1.2</b> Inspect data</a></li>
<li class="chapter" data-level="3.1.3" data-path="lalonde-dehejia-wahba-ldw-data-1.html"><a href="lalonde-dehejia-wahba-ldw-data-1.html#load-and-preprocess-data-1"><i class="fa fa-check"></i><b>3.1.3</b> Load and preprocess data</a></li>
</ul></li>
<li class="chapter" data-level="3.2" data-path="lalonde-dehejia-wahba-ldw-data-1.html"><a href="lalonde-dehejia-wahba-ldw-data-1.html#ldw-model-b"><i class="fa fa-check"></i><b>3.2</b> LDW-Model B</a></li>
<li class="chapter" data-level="3.3" data-path="lalonde-dehejia-wahba-ldw-data-1.html"><a href="lalonde-dehejia-wahba-ldw-data-1.html#pre-assessing-methods-1"><i class="fa fa-check"></i><b>3.3</b> Pre-assessing methods</a>
<ul>
<li class="chapter" data-level="3.3.1" data-path="lalonde-dehejia-wahba-ldw-data-1.html"><a href="lalonde-dehejia-wahba-ldw-data-1.html#overlap-1"><i class="fa fa-check"></i><b>3.3.1</b> Overlap</a></li>
</ul></li>
<li class="chapter" data-level="3.4" data-path="lalonde-dehejia-wahba-ldw-data-1.html"><a href="lalonde-dehejia-wahba-ldw-data-1.html#improving-overlap-1"><i class="fa fa-check"></i><b>3.4</b> Improving overlap</a>
<ul>
<li class="chapter" data-level="3.4.1" data-path="lalonde-dehejia-wahba-ldw-data-1.html"><a href="lalonde-dehejia-wahba-ldw-data-1.html#single-methods-2"><i class="fa fa-check"></i><b>3.4.1</b> Single methods</a></li>
<li class="chapter" data-level="3.4.2" data-path="lalonde-dehejia-wahba-ldw-data-1.html"><a href="lalonde-dehejia-wahba-ldw-data-1.html#integrated-methods-4"><i class="fa fa-check"></i><b>3.4.2</b> Integrated methods</a></li>
</ul></li>
<li class="chapter" data-level="3.5" data-path="lalonde-dehejia-wahba-ldw-data-1.html"><a href="lalonde-dehejia-wahba-ldw-data-1.html#post-assessing-methods-1"><i class="fa fa-check"></i><b>3.5</b> Post-assessing methods</a>
<ul>
<li class="chapter" data-level="3.5.1" data-path="lalonde-dehejia-wahba-ldw-data-1.html"><a href="lalonde-dehejia-wahba-ldw-data-1.html#single-methods-3"><i class="fa fa-check"></i><b>3.5.1</b> Single methods</a></li>
<li class="chapter" data-level="3.5.2" data-path="lalonde-dehejia-wahba-ldw-data-1.html"><a href="lalonde-dehejia-wahba-ldw-data-1.html#integrated-methods-5"><i class="fa fa-check"></i><b>3.5.2</b> Integrated methods</a></li>
</ul></li>
<li class="chapter" data-level="3.6" data-path="lalonde-dehejia-wahba-ldw-data-1.html"><a href="lalonde-dehejia-wahba-ldw-data-1.html#identifying-most-efficient-methods-1"><i class="fa fa-check"></i><b>3.6</b> Identifying most efficient methods</a>
<ul>
<li class="chapter" data-level="3.6.1" data-path="lalonde-dehejia-wahba-ldw-data-1.html"><a href="lalonde-dehejia-wahba-ldw-data-1.html#ranking-1"><i class="fa fa-check"></i><b>3.6.1</b> Ranking</a></li>
<li class="chapter" data-level="3.6.2" data-path="lalonde-dehejia-wahba-ldw-data-1.html"><a href="lalonde-dehejia-wahba-ldw-data-1.html#sample-construction-1"><i class="fa fa-check"></i><b>3.6.2</b> Sample construction</a></li>
</ul></li>
<li class="chapter" data-level="3.7" data-path="lalonde-dehejia-wahba-ldw-data-1.html"><a href="lalonde-dehejia-wahba-ldw-data-1.html#estimating-2"><i class="fa fa-check"></i><b>3.7</b> Estimating</a>
<ul>
<li class="chapter" data-level="3.7.1" data-path="lalonde-dehejia-wahba-ldw-data-1.html"><a href="lalonde-dehejia-wahba-ldw-data-1.html#average-treatment-effect-on-the-treated-att-1"><i class="fa fa-check"></i><b>3.7.1</b> Average treatment effect on the treated (ATT)</a></li>
<li class="chapter" data-level="3.7.2" data-path="lalonde-dehejia-wahba-ldw-data-1.html"><a href="lalonde-dehejia-wahba-ldw-data-1.html#conditional-average-treatment-effect-on-the-treated-catt-2"><i class="fa fa-check"></i><b>3.7.2</b> Conditional average treatment effect on the treated (CATT)</a></li>
<li class="chapter" data-level="3.7.3" data-path="lalonde-dehejia-wahba-ldw-data-1.html"><a href="lalonde-dehejia-wahba-ldw-data-1.html#quantile-treatment-effect-on-the-treated-qtet-1"><i class="fa fa-check"></i><b>3.7.3</b> Quantile treatment effect on the treated (QTET)</a></li>
<li class="chapter" data-level="3.7.4" data-path="lalonde-dehejia-wahba-ldw-data-1.html"><a href="lalonde-dehejia-wahba-ldw-data-1.html#assessing-outcome-weights-ow-1"><i class="fa fa-check"></i><b>3.7.4</b> Assessing outcome weights (OW)</a></li>
</ul></li>
<li class="chapter" data-level="3.8" data-path="lalonde-dehejia-wahba-ldw-data-1.html"><a href="lalonde-dehejia-wahba-ldw-data-1.html#validation-through-placebo-analyses-1"><i class="fa fa-check"></i><b>3.8</b> Validation through placebo analyses</a></li>
<li class="chapter" data-level="3.9" data-path="lalonde-dehejia-wahba-ldw-data-1.html"><a href="lalonde-dehejia-wahba-ldw-data-1.html#validation-through-sensitivity-analyses-1"><i class="fa fa-check"></i><b>3.9</b> Validation through sensitivity analyses</a></li>
<li class="chapter" data-level="3.10" data-path="lalonde-dehejia-wahba-ldw-data-1.html"><a href="lalonde-dehejia-wahba-ldw-data-1.html#inspection-of-re74-and-re75-1"><i class="fa fa-check"></i><b>3.10</b> Inspection of re74 and re75</a>
<ul>
<li class="chapter" data-level="3.10.1" data-path="lalonde-dehejia-wahba-ldw-data-1.html"><a href="lalonde-dehejia-wahba-ldw-data-1.html#correlation-1"><i class="fa fa-check"></i><b>3.10.1</b> Correlation</a></li>
<li class="chapter" data-level="3.10.2" data-path="lalonde-dehejia-wahba-ldw-data-1.html"><a href="lalonde-dehejia-wahba-ldw-data-1.html#distributional-balance-1"><i class="fa fa-check"></i><b>3.10.2</b> Distributional balance</a></li>
</ul></li>
<li class="chapter" data-level="3.11" data-path="lalonde-dehejia-wahba-ldw-data-1.html"><a href="lalonde-dehejia-wahba-ldw-data-1.html#summary-1"><i class="fa fa-check"></i><b>3.11</b> Summary</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="lalonde-nsw-data.html"><a href="lalonde-nsw-data.html"><i class="fa fa-check"></i><b>4</b> LaLonde (NSW) Data</a>
<ul>
<li class="chapter" data-level="4.1" data-path="lalonde-nsw-data.html"><a href="lalonde-nsw-data.html#set-up-2"><i class="fa fa-check"></i><b>4.1</b> Set up</a>
<ul>
<li class="chapter" data-level="4.1.1" data-path="lalonde-nsw-data.html"><a href="lalonde-nsw-data.html#source-functions-and-load-data-2"><i class="fa fa-check"></i><b>4.1.1</b> Source functions and load data</a></li>
<li class="chapter" data-level="4.1.2" data-path="lalonde-nsw-data.html"><a href="lalonde-nsw-data.html#load-and-preprocess-data-2"><i class="fa fa-check"></i><b>4.1.2</b> Load and preprocess data</a></li>
<li class="chapter" data-level="4.1.3" data-path="lalonde-nsw-data.html"><a href="lalonde-nsw-data.html#inspect-data-2"><i class="fa fa-check"></i><b>4.1.3</b> Inspect data</a></li>
</ul></li>
<li class="chapter" data-level="4.2" data-path="lalonde-nsw-data.html"><a href="lalonde-nsw-data.html#nsw"><i class="fa fa-check"></i><b>4.2</b> NSW</a></li>
<li class="chapter" data-level="4.3" data-path="lalonde-nsw-data.html"><a href="lalonde-nsw-data.html#pre-assessing-methods-2"><i class="fa fa-check"></i><b>4.3</b> Pre-assessing methods</a>
<ul>
<li class="chapter" data-level="4.3.1" data-path="lalonde-nsw-data.html"><a href="lalonde-nsw-data.html#overlap-2"><i class="fa fa-check"></i><b>4.3.1</b> Overlap</a></li>
</ul></li>
<li class="chapter" data-level="4.4" data-path="lalonde-nsw-data.html"><a href="lalonde-nsw-data.html#improving-overlap-2"><i class="fa fa-check"></i><b>4.4</b> Improving overlap</a>
<ul>
<li class="chapter" data-level="4.4.1" data-path="lalonde-nsw-data.html"><a href="lalonde-nsw-data.html#single-methods-4"><i class="fa fa-check"></i><b>4.4.1</b> Single methods</a></li>
<li class="chapter" data-level="4.4.2" data-path="lalonde-nsw-data.html"><a href="lalonde-nsw-data.html#integrated-methods-6"><i class="fa fa-check"></i><b>4.4.2</b> Integrated methods</a></li>
</ul></li>
<li class="chapter" data-level="4.5" data-path="lalonde-nsw-data.html"><a href="lalonde-nsw-data.html#post-assessing-methods-2"><i class="fa fa-check"></i><b>4.5</b> Post-assessing methods</a>
<ul>
<li class="chapter" data-level="4.5.1" data-path="lalonde-nsw-data.html"><a href="lalonde-nsw-data.html#single-methods-5"><i class="fa fa-check"></i><b>4.5.1</b> Single methods</a></li>
<li class="chapter" data-level="4.5.2" data-path="lalonde-nsw-data.html"><a href="lalonde-nsw-data.html#integrated-methods-7"><i class="fa fa-check"></i><b>4.5.2</b> Integrated methods</a></li>
</ul></li>
<li class="chapter" data-level="4.6" data-path="lalonde-nsw-data.html"><a href="lalonde-nsw-data.html#identifying-most-efficient-methods-2"><i class="fa fa-check"></i><b>4.6</b> Identifying most efficient methods</a>
<ul>
<li class="chapter" data-level="4.6.1" data-path="lalonde-nsw-data.html"><a href="lalonde-nsw-data.html#ranking-2"><i class="fa fa-check"></i><b>4.6.1</b> Ranking</a></li>
<li class="chapter" data-level="4.6.2" data-path="lalonde-nsw-data.html"><a href="lalonde-nsw-data.html#sample-construction-2"><i class="fa fa-check"></i><b>4.6.2</b> Sample construction</a></li>
</ul></li>
<li class="chapter" data-level="4.7" data-path="lalonde-nsw-data.html"><a href="lalonde-nsw-data.html#estimating-3"><i class="fa fa-check"></i><b>4.7</b> Estimating</a>
<ul>
<li class="chapter" data-level="4.7.1" data-path="lalonde-nsw-data.html"><a href="lalonde-nsw-data.html#average-treatment-effect-on-the-treated-att-2"><i class="fa fa-check"></i><b>4.7.1</b> Average treatment effect on the treated (ATT)</a></li>
<li class="chapter" data-level="4.7.2" data-path="lalonde-nsw-data.html"><a href="lalonde-nsw-data.html#conditional-average-treatment-effect-on-the-treated-catt-3"><i class="fa fa-check"></i><b>4.7.2</b> Conditional average treatment effect on the treated (CATT)</a></li>
<li class="chapter" data-level="4.7.3" data-path="lalonde-nsw-data.html"><a href="lalonde-nsw-data.html#quantile-treatment-effect-on-the-treated-qtet-2"><i class="fa fa-check"></i><b>4.7.3</b> Quantile treatment effect on the treated (QTET)</a></li>
<li class="chapter" data-level="4.7.4" data-path="lalonde-nsw-data.html"><a href="lalonde-nsw-data.html#assessing-outcome-weights-ow-2"><i class="fa fa-check"></i><b>4.7.4</b> Assessing outcome weights (OW)</a></li>
</ul></li>
<li class="chapter" data-level="4.8" data-path="lalonde-nsw-data.html"><a href="lalonde-nsw-data.html#validation-through-sensitivity-analyses-2"><i class="fa fa-check"></i><b>4.8</b> Validation through sensitivity analyses</a></li>
<li class="chapter" data-level="4.9" data-path="lalonde-nsw-data.html"><a href="lalonde-nsw-data.html#summary-2"><i class="fa fa-check"></i><b>4.9</b> Summary</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="lalonde-calónico-smith-lcs-data.html"><a href="lalonde-calónico-smith-lcs-data.html"><i class="fa fa-check"></i><b>5</b> LaLonde-Calónico-Smith (LCS) Data</a>
<ul>
<li class="chapter" data-level="5.1" data-path="lalonde-calónico-smith-lcs-data.html"><a href="lalonde-calónico-smith-lcs-data.html#set-up-3"><i class="fa fa-check"></i><b>5.1</b> Set up</a>
<ul>
<li class="chapter" data-level="5.1.1" data-path="lalonde-calónico-smith-lcs-data.html"><a href="lalonde-calónico-smith-lcs-data.html#source-functions-and-load-data-3"><i class="fa fa-check"></i><b>5.1.1</b> Source functions and load data</a></li>
<li class="chapter" data-level="5.1.2" data-path="lalonde-calónico-smith-lcs-data.html"><a href="lalonde-calónico-smith-lcs-data.html#load-and-preprocess-data-3"><i class="fa fa-check"></i><b>5.1.2</b> Load and preprocess data</a></li>
<li class="chapter" data-level="5.1.3" data-path="lalonde-calónico-smith-lcs-data.html"><a href="lalonde-calónico-smith-lcs-data.html#inspect-data-3"><i class="fa fa-check"></i><b>5.1.3</b> Inspect data</a></li>
</ul></li>
<li class="chapter" data-level="5.2" data-path="lalonde-calónico-smith-lcs-data.html"><a href="lalonde-calónico-smith-lcs-data.html#lcs"><i class="fa fa-check"></i><b>5.2</b> LCS</a></li>
<li class="chapter" data-level="5.3" data-path="lalonde-calónico-smith-lcs-data.html"><a href="lalonde-calónico-smith-lcs-data.html#pre-assessing-methods-3"><i class="fa fa-check"></i><b>5.3</b> Pre-assessing methods</a>
<ul>
<li class="chapter" data-level="5.3.1" data-path="lalonde-calónico-smith-lcs-data.html"><a href="lalonde-calónico-smith-lcs-data.html#overlap-3"><i class="fa fa-check"></i><b>5.3.1</b> Overlap</a></li>
</ul></li>
<li class="chapter" data-level="5.4" data-path="lalonde-calónico-smith-lcs-data.html"><a href="lalonde-calónico-smith-lcs-data.html#improving-overlap-3"><i class="fa fa-check"></i><b>5.4</b> Improving overlap</a>
<ul>
<li class="chapter" data-level="5.4.1" data-path="lalonde-calónico-smith-lcs-data.html"><a href="lalonde-calónico-smith-lcs-data.html#single-methods-6"><i class="fa fa-check"></i><b>5.4.1</b> Single methods</a></li>
<li class="chapter" data-level="5.4.2" data-path="lalonde-calónico-smith-lcs-data.html"><a href="lalonde-calónico-smith-lcs-data.html#integrated-methods-8"><i class="fa fa-check"></i><b>5.4.2</b> Integrated methods</a></li>
</ul></li>
<li class="chapter" data-level="5.5" data-path="lalonde-calónico-smith-lcs-data.html"><a href="lalonde-calónico-smith-lcs-data.html#post-assessing-methods-3"><i class="fa fa-check"></i><b>5.5</b> Post-assessing methods</a>
<ul>
<li class="chapter" data-level="5.5.1" data-path="lalonde-calónico-smith-lcs-data.html"><a href="lalonde-calónico-smith-lcs-data.html#single-methods-7"><i class="fa fa-check"></i><b>5.5.1</b> Single methods</a></li>
<li class="chapter" data-level="5.5.2" data-path="lalonde-calónico-smith-lcs-data.html"><a href="lalonde-calónico-smith-lcs-data.html#integrated-methods-9"><i class="fa fa-check"></i><b>5.5.2</b> Integrated methods</a></li>
</ul></li>
<li class="chapter" data-level="5.6" data-path="lalonde-calónico-smith-lcs-data.html"><a href="lalonde-calónico-smith-lcs-data.html#identifying-most-efficient-methods-3"><i class="fa fa-check"></i><b>5.6</b> Identifying most efficient methods</a>
<ul>
<li class="chapter" data-level="5.6.1" data-path="lalonde-calónico-smith-lcs-data.html"><a href="lalonde-calónico-smith-lcs-data.html#ranking-3"><i class="fa fa-check"></i><b>5.6.1</b> Ranking</a></li>
<li class="chapter" data-level="5.6.2" data-path="lalonde-calónico-smith-lcs-data.html"><a href="lalonde-calónico-smith-lcs-data.html#sample-construction-3"><i class="fa fa-check"></i><b>5.6.2</b> Sample construction</a></li>
</ul></li>
<li class="chapter" data-level="5.7" data-path="lalonde-calónico-smith-lcs-data.html"><a href="lalonde-calónico-smith-lcs-data.html#estimating-4"><i class="fa fa-check"></i><b>5.7</b> Estimating</a>
<ul>
<li class="chapter" data-level="5.7.1" data-path="lalonde-calónico-smith-lcs-data.html"><a href="lalonde-calónico-smith-lcs-data.html#average-treatment-effect-on-the-treated-att-3"><i class="fa fa-check"></i><b>5.7.1</b> Average treatment effect on the treated (ATT)</a></li>
<li class="chapter" data-level="5.7.2" data-path="lalonde-calónico-smith-lcs-data.html"><a href="lalonde-calónico-smith-lcs-data.html#conditional-average-treatment-effect-on-the-treated-catt-4"><i class="fa fa-check"></i><b>5.7.2</b> Conditional average treatment effect on the treated (CATT)</a></li>
<li class="chapter" data-level="5.7.3" data-path="lalonde-calónico-smith-lcs-data.html"><a href="lalonde-calónico-smith-lcs-data.html#quantile-treatment-effect-on-the-treated-qtet-3"><i class="fa fa-check"></i><b>5.7.3</b> Quantile treatment effect on the treated (QTET)</a></li>
<li class="chapter" data-level="5.7.4" data-path="lalonde-calónico-smith-lcs-data.html"><a href="lalonde-calónico-smith-lcs-data.html#assessing-outcome-weights-ow-3"><i class="fa fa-check"></i><b>5.7.4</b> Assessing outcome weights (OW)</a></li>
</ul></li>
<li class="chapter" data-level="5.8" data-path="lalonde-calónico-smith-lcs-data.html"><a href="lalonde-calónico-smith-lcs-data.html#validation-through-placebo-analyses-2"><i class="fa fa-check"></i><b>5.8</b> Validation through placebo analyses</a></li>
<li class="chapter" data-level="5.9" data-path="lalonde-calónico-smith-lcs-data.html"><a href="lalonde-calónico-smith-lcs-data.html#validation-through-sensitivity-analyses-3"><i class="fa fa-check"></i><b>5.9</b> Validation through sensitivity analyses</a></li>
<li class="chapter" data-level="5.10" data-path="lalonde-calónico-smith-lcs-data.html"><a href="lalonde-calónico-smith-lcs-data.html#summary-3"><i class="fa fa-check"></i><b>5.10</b> Summary</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i>References</a></li>
<li class="divider"></li>
<li><a href="https://github.com/lkrsl/Application-of-Outcome-Weights-Framework-for-DML-to-Lalonde-Study" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Application of the Outcome Weights Framework for Double Machine Learning to the Lalonde Study</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="lalonde-nsw-data" class="section level1 hasAnchor" number="4">
<h1><span class="header-section-number">Chapter 4</span> LaLonde (NSW) Data<a href="lalonde-nsw-data.html#lalonde-nsw-data" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<p>This section (4) examines the effect of the treatment (participation in the job training program) on the participants’ earnings in 1978 (<code>re78</code>) in the original LaLonde data (loaded as <code>nsw</code>, similar to <span class="citation">Imbens and Xu (<a href="#ref-imbens2024">2024</a>)</span>).</p>
<p>For detailed explanations of the analysis steps and notes, please refer to section 2. Here, we only explain the NSW–specific results.</p>
<div id="set-up-2" class="section level2 hasAnchor" number="4.1">
<h2><span class="header-section-number">4.1</span> Set up<a href="lalonde-nsw-data.html#set-up-2" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div id="source-functions-and-load-data-2" class="section level3 hasAnchor" number="4.1.1">
<h3><span class="header-section-number">4.1.1</span> Source functions and load data<a href="lalonde-nsw-data.html#source-functions-and-load-data-2" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb272"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb272-1"><a href="lalonde-nsw-data.html#cb272-1" tabindex="-1"></a><span class="co"># source functions</span></span>
<span id="cb272-2"><a href="lalonde-nsw-data.html#cb272-2" tabindex="-1"></a><span class="fu">source</span>(<span class="st">&quot;https://github.com/xuyiqing/lalonde/blob/main/tutorial/functions.R?raw=TRUE&quot;</span>)</span>
<span id="cb272-3"><a href="lalonde-nsw-data.html#cb272-3" tabindex="-1"></a><span class="fu">source</span>(<span class="st">&quot;tutorial/functions.R&quot;</span>)</span></code></pre></div>
<div class="sourceCode" id="cb273"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb273-1"><a href="lalonde-nsw-data.html#cb273-1" tabindex="-1"></a><span class="co"># load data</span></span>
<span id="cb273-2"><a href="lalonde-nsw-data.html#cb273-2" tabindex="-1"></a><span class="fu">load</span>(<span class="st">&quot;data/lalonde.RData&quot;</span>)</span>
<span id="cb273-3"><a href="lalonde-nsw-data.html#cb273-3" tabindex="-1"></a><span class="fu">load</span>(<span class="st">&quot;data/trimmed.RData&quot;</span>)</span></code></pre></div>
<div class="sourceCode" id="cb274"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb274-1"><a href="lalonde-nsw-data.html#cb274-1" tabindex="-1"></a><span class="co"># set seed</span></span>
<span id="cb274-2"><a href="lalonde-nsw-data.html#cb274-2" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">42</span>)</span></code></pre></div>
</div>
<div id="load-and-preprocess-data-2" class="section level3 hasAnchor" number="4.1.2">
<h3><span class="header-section-number">4.1.2</span> Load and preprocess data<a href="lalonde-nsw-data.html#load-and-preprocess-data-2" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb275"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb275-1"><a href="lalonde-nsw-data.html#cb275-1" tabindex="-1"></a>treat <span class="ot">&lt;-</span> <span class="st">&quot;treat&quot;</span></span>
<span id="cb275-2"><a href="lalonde-nsw-data.html#cb275-2" tabindex="-1"></a>nsw_co<span class="sc">$</span>treat <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb275-3"><a href="lalonde-nsw-data.html#cb275-3" tabindex="-1"></a></span>
<span id="cb275-4"><a href="lalonde-nsw-data.html#cb275-4" tabindex="-1"></a><span class="co"># drop re74, u74, tau from CPS-1 and PSID-1 and merge data</span></span>
<span id="cb275-5"><a href="lalonde-nsw-data.html#cb275-5" tabindex="-1"></a>cps1a <span class="ot">&lt;-</span> <span class="fu">subset</span>(cps1, <span class="at">select =</span>  <span class="sc">-</span><span class="fu">c</span>(re74, u74))</span>
<span id="cb275-6"><a href="lalonde-nsw-data.html#cb275-6" tabindex="-1"></a>nsw_cps <span class="ot">&lt;-</span> <span class="fu">rbind.data.frame</span>(nsw_tr, cps1a)</span>
<span id="cb275-7"><a href="lalonde-nsw-data.html#cb275-7" tabindex="-1"></a></span>
<span id="cb275-8"><a href="lalonde-nsw-data.html#cb275-8" tabindex="-1"></a>psid1a <span class="ot">&lt;-</span> <span class="fu">subset</span>(psid1, <span class="at">select =</span>  <span class="sc">-</span><span class="fu">c</span>(re74, u74))</span>
<span id="cb275-9"><a href="lalonde-nsw-data.html#cb275-9" tabindex="-1"></a>nsw_psid <span class="ot">&lt;-</span> <span class="fu">rbind.data.frame</span>(nsw_tr, psid1a)</span>
<span id="cb275-10"><a href="lalonde-nsw-data.html#cb275-10" tabindex="-1"></a></span>
<span id="cb275-11"><a href="lalonde-nsw-data.html#cb275-11" tabindex="-1"></a>nsw_cps.plus <span class="ot">&lt;-</span> <span class="fu">rbind.data.frame</span>(nsw_cps, nsw_co)</span>
<span id="cb275-12"><a href="lalonde-nsw-data.html#cb275-12" tabindex="-1"></a>nsw_psid.plus <span class="ot">&lt;-</span> <span class="fu">rbind.data.frame</span>(nsw_psid, nsw_co)</span></code></pre></div>
</div>
<div id="inspect-data-2" class="section level3 hasAnchor" number="4.1.3">
<h3><span class="header-section-number">4.1.3</span> Inspect data<a href="lalonde-nsw-data.html#inspect-data-2" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb276"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb276-1"><a href="lalonde-nsw-data.html#cb276-1" tabindex="-1"></a><span class="co"># collect samples in a list</span></span>
<span id="cb276-2"><a href="lalonde-nsw-data.html#cb276-2" tabindex="-1"></a>data <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="at">nsw =</span> nsw, <span class="at">nsw_cps =</span> nsw_cps, <span class="at">nsw_psid =</span> nsw_psid, <span class="at">nsw_cps.plus =</span> nsw_cps.plus, <span class="at">nsw_psid.plus =</span> nsw_psid.plus)</span>
<span id="cb276-3"><a href="lalonde-nsw-data.html#cb276-3" tabindex="-1"></a></span>
<span id="cb276-4"><a href="lalonde-nsw-data.html#cb276-4" tabindex="-1"></a><span class="co"># print and inspect key metrics of each sample</span></span>
<span id="cb276-5"><a href="lalonde-nsw-data.html#cb276-5" tabindex="-1"></a>summary_stats <span class="ot">&lt;-</span> <span class="fu">inspect_data</span>(data)</span>
<span id="cb276-6"><a href="lalonde-nsw-data.html#cb276-6" tabindex="-1"></a><span class="fu">datatable</span>(summary_stats, <span class="at">caption =</span> <span class="st">&quot;Summary Statistics&quot;</span>,</span>
<span id="cb276-7"><a href="lalonde-nsw-data.html#cb276-7" tabindex="-1"></a>          <span class="at">options =</span> <span class="fu">list</span>(<span class="at">scrollX =</span> <span class="cn">TRUE</span>, <span class="at">paging =</span> <span class="cn">FALSE</span>, <span class="at">pageLength =</span> <span class="sc">-</span><span class="dv">1</span>, <span class="at">searching =</span> <span class="cn">FALSE</span>))</span></code></pre></div>
<div class="datatables html-widget html-fill-item" id="htmlwidget-9761185b6a3cbd0da17b" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-9761185b6a3cbd0da17b">{"x":{"filter":"none","vertical":false,"caption":"<caption>Summary Statistics<\/caption>","data":[["1","2","3","4","5"],["nsw","nsw_cps","nsw_psid","nsw_cps.plus","nsw_psid.plus"],[722,16289,2787,16714,3212],[297,297,297,722,722],[425,15992,2490,15992,2490],[12,12,12,12,12],["data_id, treat, age, education, black, hispanic, married, nodegree, re75, re78, u75, sample","data_id, treat, age, education, black, hispanic, married, nodegree, re75, re78, u75, sample","data_id, treat, age, education, black, hispanic, married, nodegree, re75, re78, u75, sample","data_id, treat, age, education, black, hispanic, married, nodegree, re75, re78, u75, sample","data_id, treat, age, education, black, hispanic, married, nodegree, re75, re78, u75, sample"]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>sample<\/th>\n      <th>num_obs<\/th>\n      <th>num_treated<\/th>\n      <th>num_controls<\/th>\n      <th>num_vars<\/th>\n      <th>name_vars<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"scrollX":true,"paging":false,"pageLength":-1,"searching":false,"columnDefs":[{"className":"dt-right","targets":[2,3,4,5]},{"orderable":false,"targets":0},{"name":" ","targets":0},{"name":"sample","targets":1},{"name":"num_obs","targets":2},{"name":"num_treated","targets":3},{"name":"num_controls","targets":4},{"name":"num_vars","targets":5},{"name":"name_vars","targets":6}],"order":[],"autoWidth":false,"orderClasses":false,"lengthMenu":[-1,10,25,50,100]}},"evals":[],"jsHooks":[]}</script>
</div>
</div>
<div id="nsw" class="section level2 hasAnchor" number="4.2">
<h2><span class="header-section-number">4.2</span> NSW<a href="lalonde-nsw-data.html#nsw" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div class="sourceCode" id="cb277"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb277-1"><a href="lalonde-nsw-data.html#cb277-1" tabindex="-1"></a><span class="co"># define variables</span></span>
<span id="cb277-2"><a href="lalonde-nsw-data.html#cb277-2" tabindex="-1"></a>Y <span class="ot">&lt;-</span> <span class="st">&quot;re78&quot;</span> </span>
<span id="cb277-3"><a href="lalonde-nsw-data.html#cb277-3" tabindex="-1"></a>treat <span class="ot">&lt;-</span> <span class="st">&quot;treat&quot;</span> </span>
<span id="cb277-4"><a href="lalonde-nsw-data.html#cb277-4" tabindex="-1"></a>covar <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;age&quot;</span>, <span class="st">&quot;education&quot;</span>, <span class="st">&quot;black&quot;</span>, <span class="st">&quot;hispanic&quot;</span>, <span class="st">&quot;married&quot;</span>, </span>
<span id="cb277-5"><a href="lalonde-nsw-data.html#cb277-5" tabindex="-1"></a>           <span class="st">&quot;nodegree&quot;</span>, <span class="st">&quot;re75&quot;</span>, <span class="st">&quot;u75&quot;</span>)</span></code></pre></div>
<div class="sourceCode" id="cb278"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb278-1"><a href="lalonde-nsw-data.html#cb278-1" tabindex="-1"></a><span class="co"># set model formula</span></span>
<span id="cb278-2"><a href="lalonde-nsw-data.html#cb278-2" tabindex="-1"></a>model <span class="ot">&lt;-</span> <span class="fu">as.formula</span>(<span class="fu">paste</span>(treat, <span class="st">&quot;~&quot;</span>, <span class="fu">paste</span>(covar, <span class="at">collapse =</span> <span class="st">&quot; + &quot;</span>)))</span></code></pre></div>
</div>
<div id="pre-assessing-methods-2" class="section level2 hasAnchor" number="4.3">
<h2><span class="header-section-number">4.3</span> Pre-assessing methods<a href="lalonde-nsw-data.html#pre-assessing-methods-2" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div id="overlap-2" class="section level3 hasAnchor" number="4.3.1">
<h3><span class="header-section-number">4.3.1</span> Overlap<a href="lalonde-nsw-data.html#overlap-2" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb279"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb279-1"><a href="lalonde-nsw-data.html#cb279-1" tabindex="-1"></a>nsw_ps <span class="ot">&lt;-</span> <span class="fu">assess_overlap</span>(<span class="at">data =</span> nsw, <span class="at">treat =</span> treat, <span class="at">cov =</span> covar, <span class="at">xlim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">2</span>, <span class="fl">1.5</span>))</span></code></pre></div>
<div class="figure"><span style="display:block;" id="fig:unnamed-chunk-227-1"></span>
<img src="Outcome-Weights_files/figure-html/unnamed-chunk-227-1.png" alt="FIGUREC1. SubfigureA:NSW-Experimental. SubfigureB:NSW-CPS1. SubfigureC:NSW-PSID1." width="100%" />
<p class="caption">
Figure 4.1: FIGUREC1. SubfigureA:NSW-Experimental. SubfigureB:NSW-CPS1. SubfigureC:NSW-PSID1.
</p>
</div>
<div class="sourceCode" id="cb280"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb280-1"><a href="lalonde-nsw-data.html#cb280-1" tabindex="-1"></a>nsw_cps_ps <span class="ot">&lt;-</span> <span class="fu">assess_overlap</span>(<span class="at">data =</span> nsw_cps, <span class="at">treat =</span> treat, <span class="at">cov =</span> covar, <span class="at">xlim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">15</span>, <span class="dv">5</span>))</span></code></pre></div>
<div class="figure"><span style="display:block;" id="fig:unnamed-chunk-227-2"></span>
<img src="Outcome-Weights_files/figure-html/unnamed-chunk-227-2.png" alt="FIGUREC1. SubfigureA:NSW-Experimental. SubfigureB:NSW-CPS1. SubfigureC:NSW-PSID1." width="100%" />
<p class="caption">
Figure 4.2: FIGUREC1. SubfigureA:NSW-Experimental. SubfigureB:NSW-CPS1. SubfigureC:NSW-PSID1.
</p>
</div>
<div class="sourceCode" id="cb281"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb281-1"><a href="lalonde-nsw-data.html#cb281-1" tabindex="-1"></a>nsw_psid_ps <span class="ot">&lt;-</span> <span class="fu">assess_overlap</span>(<span class="at">data =</span> nsw_psid, <span class="at">treat =</span> treat, <span class="at">cov =</span> covar, <span class="at">xlim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">15</span>, <span class="dv">5</span>))</span></code></pre></div>
<div class="figure"><span style="display:block;" id="fig:unnamed-chunk-227-3"></span>
<img src="Outcome-Weights_files/figure-html/unnamed-chunk-227-3.png" alt="FIGUREC1. SubfigureA:NSW-Experimental. SubfigureB:NSW-CPS1. SubfigureC:NSW-PSID1." width="100%" />
<p class="caption">
Figure 4.3: FIGUREC1. SubfigureA:NSW-Experimental. SubfigureB:NSW-CPS1. SubfigureC:NSW-PSID1.
</p>
</div>
<p>As anticipated, the NSW-Experimental data exhibits an almost perfect overlap. In contrast, the observational samples NSW-CPS1 and NSW-PSID1 show poor overlap.</p>
<div class="sourceCode" id="cb282"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb282-1"><a href="lalonde-nsw-data.html#cb282-1" tabindex="-1"></a>nsw_cps.plus_ps <span class="ot">&lt;-</span> <span class="fu">assess_overlap</span>(<span class="at">data =</span> nsw_cps.plus, <span class="at">treat =</span> treat, <span class="at">cov =</span> covar, <span class="at">xlim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">15</span>, <span class="dv">5</span>))</span></code></pre></div>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:unnamed-chunk-228-1"></span>
<img src="Outcome-Weights_files/figure-html/unnamed-chunk-228-1.png" alt="FIGUREC1. SubfigureD:NSW-CPS1-PLUS. SubfigureE:NSW-PSID1-PLUS." width="80%" />
<p class="caption">
Figure 4.4: FIGUREC1. SubfigureD:NSW-CPS1-PLUS. SubfigureE:NSW-PSID1-PLUS.
</p>
</div>
<div class="sourceCode" id="cb283"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb283-1"><a href="lalonde-nsw-data.html#cb283-1" tabindex="-1"></a>nsw_psid.plus_ps <span class="ot">&lt;-</span> <span class="fu">assess_overlap</span>(<span class="at">data =</span> nsw_psid.plus, <span class="at">treat =</span> treat, <span class="at">cov =</span> covar, <span class="at">xlim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">15</span>, <span class="dv">5</span>))</span></code></pre></div>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:unnamed-chunk-228-2"></span>
<img src="Outcome-Weights_files/figure-html/unnamed-chunk-228-2.png" alt="FIGUREC1. SubfigureD:NSW-CPS1-PLUS. SubfigureE:NSW-PSID1-PLUS." width="80%" />
<p class="caption">
Figure 4.5: FIGUREC1. SubfigureD:NSW-CPS1-PLUS. SubfigureE:NSW-PSID1-PLUS.
</p>
</div>
<p>With the expanded samples NSW-CPS1-PLUS and NSW-PSID1-PLUS, it is evident that the degree of overlap between treated and control groups has improved, as seen by a greater coverage of log-odds densities across both samples.</p>
<div class="sourceCode" id="cb284"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb284-1"><a href="lalonde-nsw-data.html#cb284-1" tabindex="-1"></a><span class="co"># combine results</span></span>
<span id="cb284-2"><a href="lalonde-nsw-data.html#cb284-2" tabindex="-1"></a>data_list <span class="ot">&lt;-</span> <span class="fu">list</span>(nsw, nsw_cps, nsw_psid, nsw_cps.plus, nsw_psid.plus)</span>
<span id="cb284-3"><a href="lalonde-nsw-data.html#cb284-3" tabindex="-1"></a>plot_titles <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;(A) NSW-Experimental&quot;</span>,<span class="st">&quot;(B) NSW-CPS-1&quot;</span>, <span class="st">&quot;(C) NSW-PSID-1&quot;</span>, <span class="st">&quot;(D) NSW-CPS-1-PLUS&quot;</span>, <span class="st">&quot;(E) NSW-PSID-1-PLUS&quot;</span>)</span>
<span id="cb284-4"><a href="lalonde-nsw-data.html#cb284-4" tabindex="-1"></a></span>
<span id="cb284-5"><a href="lalonde-nsw-data.html#cb284-5" tabindex="-1"></a><span class="co"># save results</span></span>
<span id="cb284-6"><a href="lalonde-nsw-data.html#cb284-6" tabindex="-1"></a><span class="fu">save_overlap_panels</span>(</span>
<span id="cb284-7"><a href="lalonde-nsw-data.html#cb284-7" tabindex="-1"></a>  <span class="at">data_list =</span> data_list,</span>
<span id="cb284-8"><a href="lalonde-nsw-data.html#cb284-8" tabindex="-1"></a>  <span class="at">treat     =</span> treat,</span>
<span id="cb284-9"><a href="lalonde-nsw-data.html#cb284-9" tabindex="-1"></a>  <span class="at">covar     =</span> covar,</span>
<span id="cb284-10"><a href="lalonde-nsw-data.html#cb284-10" tabindex="-1"></a>  <span class="at">plot_titles =</span> plot_titles,</span>
<span id="cb284-11"><a href="lalonde-nsw-data.html#cb284-11" tabindex="-1"></a>  <span class="at">prefix =</span> <span class="st">&quot;nsw_overlap_panels&quot;</span></span>
<span id="cb284-12"><a href="lalonde-nsw-data.html#cb284-12" tabindex="-1"></a>)</span></code></pre></div>
<pre><code>## -1.375215 0.6394217</code></pre>
<pre><code>## -12.49703 1.660349</code></pre>
<pre><code>## -10.70941 3.573044</code></pre>
<pre><code>## -11.56837 2.929738</code></pre>
<pre><code>## -9.367327 6.41566</code></pre>
<div class="callout-note">
<p>In the subsequent analysis, the primary focus is on improving overlap between treated and control groups. However, covariate imbalance is also addressed, as it may induce bias in estimated treatment effects. Only the original observational samples NSW-CPS-1 and NSW-PSID-1 are considered. The NSW-CPS-1-PLUS and NSW-PSID1-PLUS samples are included exclusively for comparison and replication purposes. The NSW-Experimental data is only consulted as benchmark, as randomization already ensures adequate overlap.</p>
</div>
</div>
</div>
<div id="improving-overlap-2" class="section level2 hasAnchor" number="4.4">
<h2><span class="header-section-number">4.4</span> Improving overlap<a href="lalonde-nsw-data.html#improving-overlap-2" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div id="single-methods-4" class="section level3 hasAnchor" number="4.4.1">
<h3><span class="header-section-number">4.4.1</span> Single methods<a href="lalonde-nsw-data.html#single-methods-4" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div id="trimming-6" class="section level4 hasAnchor" number="4.4.1.1">
<h4><span class="header-section-number">4.4.1.1</span> Trimming<a href="lalonde-nsw-data.html#trimming-6" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<ol style="list-style-type: decimal">
<li>Propensity score threshold trimming</li>
</ol>
<div class="sourceCode" id="cb290"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb290-1"><a href="lalonde-nsw-data.html#cb290-1" tabindex="-1"></a><span class="co"># apply trimming with a (maximum) threshold </span></span>
<span id="cb290-2"><a href="lalonde-nsw-data.html#cb290-2" tabindex="-1"></a>nsw_cps.ps_trim <span class="ot">&lt;-</span> <span class="fu">ps_trim</span>(nsw_cps_ps, <span class="at">threshold =</span> <span class="fl">0.9</span>)</span>
<span id="cb290-3"><a href="lalonde-nsw-data.html#cb290-3" tabindex="-1"></a>nsw_psid.ps_trim <span class="ot">&lt;-</span> <span class="fu">ps_trim</span>(nsw_psid_ps, <span class="at">threshold =</span> <span class="fl">0.9</span>)</span>
<span id="cb290-4"><a href="lalonde-nsw-data.html#cb290-4" tabindex="-1"></a></span>
<span id="cb290-5"><a href="lalonde-nsw-data.html#cb290-5" tabindex="-1"></a><span class="co"># re-estimate propensity scores on trimmed data </span></span>
<span id="cb290-6"><a href="lalonde-nsw-data.html#cb290-6" tabindex="-1"></a>nsw_cps.ps_trim <span class="ot">&lt;-</span> <span class="fu">ps_estimate</span>(<span class="at">data =</span> nsw_cps.ps_trim, <span class="at">treat =</span> <span class="st">&quot;treat&quot;</span>, <span class="at">cov =</span> covar)</span>
<span id="cb290-7"><a href="lalonde-nsw-data.html#cb290-7" tabindex="-1"></a>nsw_psid.ps_trim <span class="ot">&lt;-</span> <span class="fu">ps_estimate</span>(<span class="at">data =</span> nsw_psid.ps_trim, <span class="at">treat =</span> <span class="st">&quot;treat&quot;</span>, <span class="at">cov =</span> covar)</span></code></pre></div>
<ol start="2" style="list-style-type: decimal">
<li>Common range trimming</li>
</ol>
<div class="sourceCode" id="cb291"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb291-1"><a href="lalonde-nsw-data.html#cb291-1" tabindex="-1"></a><span class="co"># trim observations outside the common support region of propensity scores</span></span>
<span id="cb291-2"><a href="lalonde-nsw-data.html#cb291-2" tabindex="-1"></a>nsw_cps.ps_common   <span class="ot">&lt;-</span> <span class="fu">common_range_trim</span>(nsw_cps_ps)</span>
<span id="cb291-3"><a href="lalonde-nsw-data.html#cb291-3" tabindex="-1"></a>nsw_psid.ps_common  <span class="ot">&lt;-</span> <span class="fu">common_range_trim</span>(nsw_psid_ps)</span>
<span id="cb291-4"><a href="lalonde-nsw-data.html#cb291-4" tabindex="-1"></a></span>
<span id="cb291-5"><a href="lalonde-nsw-data.html#cb291-5" tabindex="-1"></a><span class="co"># re-estimate propensity scores on trimmed data </span></span>
<span id="cb291-6"><a href="lalonde-nsw-data.html#cb291-6" tabindex="-1"></a>nsw_cps.ps_common <span class="ot">&lt;-</span> <span class="fu">ps_estimate</span>(<span class="at">data =</span> nsw_cps.ps_common, <span class="at">treat =</span> <span class="st">&quot;treat&quot;</span>, <span class="at">cov =</span> covar)</span>
<span id="cb291-7"><a href="lalonde-nsw-data.html#cb291-7" tabindex="-1"></a>nsw_psid.ps_common <span class="ot">&lt;-</span> <span class="fu">ps_estimate</span>(<span class="at">data =</span> nsw_psid.ps_common, <span class="at">treat =</span> <span class="st">&quot;treat&quot;</span>, <span class="at">cov =</span> covar)</span></code></pre></div>
<ol start="3" style="list-style-type: decimal">
<li>Crump trimming</li>
</ol>
<div class="sourceCode" id="cb292"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb292-1"><a href="lalonde-nsw-data.html#cb292-1" tabindex="-1"></a><span class="co"># trim observations with propensity scores outside an interval</span></span>
<span id="cb292-2"><a href="lalonde-nsw-data.html#cb292-2" tabindex="-1"></a>nsw_cps.ps_crump  <span class="ot">&lt;-</span> <span class="fu">crump_trim</span>(nsw_cps_ps, <span class="at">lower =</span> <span class="fl">0.1</span>, <span class="at">upper =</span> <span class="fl">0.9</span>)</span>
<span id="cb292-3"><a href="lalonde-nsw-data.html#cb292-3" tabindex="-1"></a>nsw_psid.ps_crump <span class="ot">&lt;-</span> <span class="fu">crump_trim</span>(nsw_psid_ps, <span class="at">lower =</span> <span class="fl">0.1</span>, <span class="at">upper =</span> <span class="fl">0.9</span>)</span>
<span id="cb292-4"><a href="lalonde-nsw-data.html#cb292-4" tabindex="-1"></a></span>
<span id="cb292-5"><a href="lalonde-nsw-data.html#cb292-5" tabindex="-1"></a><span class="co"># re-estimate propensity scores on trimmed data </span></span>
<span id="cb292-6"><a href="lalonde-nsw-data.html#cb292-6" tabindex="-1"></a>nsw_cps.ps_crump <span class="ot">&lt;-</span> <span class="fu">ps_estimate</span>(<span class="at">data =</span> nsw_cps.ps_crump, <span class="at">treat =</span> <span class="st">&quot;treat&quot;</span>, <span class="at">cov =</span> covar)</span>
<span id="cb292-7"><a href="lalonde-nsw-data.html#cb292-7" tabindex="-1"></a>nsw_psid.ps_crump <span class="ot">&lt;-</span> <span class="fu">ps_estimate</span>(<span class="at">data =</span> nsw_psid.ps_crump, <span class="at">treat =</span> <span class="st">&quot;treat&quot;</span>, <span class="at">cov =</span> covar)</span></code></pre></div>
<ol start="4" style="list-style-type: decimal">
<li>Stuermer trimming</li>
</ol>
<div class="sourceCode" id="cb293"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb293-1"><a href="lalonde-nsw-data.html#cb293-1" tabindex="-1"></a><span class="co"># trim observations based on propensity score quantiles separately for treated and control</span></span>
<span id="cb293-2"><a href="lalonde-nsw-data.html#cb293-2" tabindex="-1"></a>nsw_cps.ps_stuermer  <span class="ot">&lt;-</span> <span class="fu">stuermer_trim</span>(nsw_cps_ps, <span class="at">lower_percentile =</span> <span class="fl">0.05</span>, <span class="at">upper_percentile =</span> <span class="fl">0.95</span>)</span>
<span id="cb293-3"><a href="lalonde-nsw-data.html#cb293-3" tabindex="-1"></a>nsw_psid.ps_stuermer <span class="ot">&lt;-</span> <span class="fu">stuermer_trim</span>(nsw_psid_ps, <span class="at">lower_percentile =</span> <span class="fl">0.05</span>, <span class="at">upper_percentile =</span> <span class="fl">0.95</span>)</span>
<span id="cb293-4"><a href="lalonde-nsw-data.html#cb293-4" tabindex="-1"></a></span>
<span id="cb293-5"><a href="lalonde-nsw-data.html#cb293-5" tabindex="-1"></a><span class="co"># re-estimate propensity scores on trimmed data </span></span>
<span id="cb293-6"><a href="lalonde-nsw-data.html#cb293-6" tabindex="-1"></a>nsw_cps.ps_stuermer <span class="ot">&lt;-</span> <span class="fu">ps_estimate</span>(<span class="at">data =</span> nsw_cps.ps_stuermer, <span class="at">treat =</span> <span class="st">&quot;treat&quot;</span>, <span class="at">cov =</span> covar)</span>
<span id="cb293-7"><a href="lalonde-nsw-data.html#cb293-7" tabindex="-1"></a>nsw_psid.ps_stuermer <span class="ot">&lt;-</span> <span class="fu">ps_estimate</span>(<span class="at">data =</span> nsw_psid.ps_stuermer, <span class="at">treat =</span> <span class="st">&quot;treat&quot;</span>, <span class="at">cov =</span> covar)</span></code></pre></div>
<ol start="5" style="list-style-type: decimal">
<li>Walker trimming</li>
</ol>
<div class="sourceCode" id="cb294"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb294-1"><a href="lalonde-nsw-data.html#cb294-1" tabindex="-1"></a><span class="co"># trim observations based on preference scores that adjust for treatment prevalence using logit transformations</span></span>
<span id="cb294-2"><a href="lalonde-nsw-data.html#cb294-2" tabindex="-1"></a>nsw_cps.ps_walker   <span class="ot">&lt;-</span> <span class="fu">walker_trim</span>(nsw_cps_ps)</span>
<span id="cb294-3"><a href="lalonde-nsw-data.html#cb294-3" tabindex="-1"></a>nsw_psid.ps_walker  <span class="ot">&lt;-</span> <span class="fu">walker_trim</span>(nsw_psid_ps)</span>
<span id="cb294-4"><a href="lalonde-nsw-data.html#cb294-4" tabindex="-1"></a></span>
<span id="cb294-5"><a href="lalonde-nsw-data.html#cb294-5" tabindex="-1"></a><span class="co"># re-estimate propensity scores on trimmed data </span></span>
<span id="cb294-6"><a href="lalonde-nsw-data.html#cb294-6" tabindex="-1"></a>nsw_cps.ps_walker <span class="ot">&lt;-</span> <span class="fu">ps_estimate</span>(<span class="at">data =</span> nsw_cps.ps_walker, <span class="at">treat =</span> <span class="st">&quot;treat&quot;</span>, <span class="at">cov =</span> covar)</span>
<span id="cb294-7"><a href="lalonde-nsw-data.html#cb294-7" tabindex="-1"></a>nsw_psid.ps_walker <span class="ot">&lt;-</span> <span class="fu">ps_estimate</span>(<span class="at">data =</span> nsw_psid.ps_walker, <span class="at">treat =</span> <span class="st">&quot;treat&quot;</span>, <span class="at">cov =</span> covar)</span></code></pre></div>
</div>
</div>
<div id="integrated-methods-6" class="section level3 hasAnchor" number="4.4.2">
<h3><span class="header-section-number">4.4.2</span> Integrated methods<a href="lalonde-nsw-data.html#integrated-methods-6" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div id="trimming-and-matching-4" class="section level4 hasAnchor" number="4.4.2.1">
<h4><span class="header-section-number">4.4.2.1</span> Trimming and matching<a href="lalonde-nsw-data.html#trimming-and-matching-4" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<div id="extended-samples-4" class="section level5 hasAnchor" number="4.4.2.1.1">
<h5><span class="header-section-number">4.4.2.1.1</span> Extended samples<a href="lalonde-nsw-data.html#extended-samples-4" class="anchor-section" aria-label="Anchor link to header"></a></h5>
<p>(Similar to tutorial by <span class="citation">Imbens and Xu (<a href="#ref-imbens2024">2024</a>)</span>)</p>
<div class="sourceCode" id="cb295"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb295-1"><a href="lalonde-nsw-data.html#cb295-1" tabindex="-1"></a><span class="co"># apply trimming with a (maximum) threshold </span></span>
<span id="cb295-2"><a href="lalonde-nsw-data.html#cb295-2" tabindex="-1"></a>nsw_cps_trim <span class="ot">&lt;-</span> <span class="fu">ps_trim</span>(nsw_cps.plus_ps, <span class="at">threshold =</span> <span class="fl">0.85</span>)</span>
<span id="cb295-3"><a href="lalonde-nsw-data.html#cb295-3" tabindex="-1"></a>nsw_psid_trim <span class="ot">&lt;-</span> <span class="fu">ps_trim</span>(nsw_psid.plus_ps, <span class="at">threshold =</span> <span class="fl">0.85</span>)</span>
<span id="cb295-4"><a href="lalonde-nsw-data.html#cb295-4" tabindex="-1"></a></span>
<span id="cb295-5"><a href="lalonde-nsw-data.html#cb295-5" tabindex="-1"></a><span class="co"># excluding the experimental controls</span></span>
<span id="cb295-6"><a href="lalonde-nsw-data.html#cb295-6" tabindex="-1"></a>nsw_cps_trim_match <span class="ot">&lt;-</span> <span class="fu">subset</span>(nsw_cps_trim, sample <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">3</span>) <span class="sc">&amp;</span> ps_assoverlap)</span>
<span id="cb295-7"><a href="lalonde-nsw-data.html#cb295-7" tabindex="-1"></a>nsw_psid_trim_match <span class="ot">&lt;-</span> <span class="fu">subset</span>(nsw_psid_trim, sample <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">4</span>) <span class="sc">&amp;</span> ps_assoverlap)</span>
<span id="cb295-8"><a href="lalonde-nsw-data.html#cb295-8" tabindex="-1"></a></span>
<span id="cb295-9"><a href="lalonde-nsw-data.html#cb295-9" tabindex="-1"></a><span class="co"># re-estimate propensity scores on trimmed data </span></span>
<span id="cb295-10"><a href="lalonde-nsw-data.html#cb295-10" tabindex="-1"></a>nsw_cps_trim_match <span class="ot">&lt;-</span> <span class="fu">psmatch</span>(<span class="at">data =</span> nsw_cps_trim_match, <span class="at">Y =</span> <span class="st">&quot;re78&quot;</span>, <span class="at">treat =</span> <span class="st">&quot;treat&quot;</span>, <span class="at">cov =</span> covar)</span>
<span id="cb295-11"><a href="lalonde-nsw-data.html#cb295-11" tabindex="-1"></a>nsw_psid_trim_match <span class="ot">&lt;-</span> <span class="fu">psmatch</span>(<span class="at">data =</span> nsw_psid_trim_match, <span class="at">Y =</span> <span class="st">&quot;re78&quot;</span>, <span class="at">treat =</span> <span class="st">&quot;treat&quot;</span>, <span class="at">cov =</span> covar)</span>
<span id="cb295-12"><a href="lalonde-nsw-data.html#cb295-12" tabindex="-1"></a></span>
<span id="cb295-13"><a href="lalonde-nsw-data.html#cb295-13" tabindex="-1"></a><span class="co"># further subset data and re-assign treat variable </span></span>
<span id="cb295-14"><a href="lalonde-nsw-data.html#cb295-14" tabindex="-1"></a>nsw_trim_cps <span class="ot">&lt;-</span> <span class="fu">subset</span>(nsw_cps_trim, sample <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="fl">0.5</span>))</span>
<span id="cb295-15"><a href="lalonde-nsw-data.html#cb295-15" tabindex="-1"></a>nsw_trim_cps<span class="sc">$</span>treat[<span class="fu">which</span>(nsw_trim_cps<span class="sc">$</span>sample <span class="sc">==</span> <span class="fl">0.5</span>)] <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb295-16"><a href="lalonde-nsw-data.html#cb295-16" tabindex="-1"></a></span>
<span id="cb295-17"><a href="lalonde-nsw-data.html#cb295-17" tabindex="-1"></a>nsw_trim_psid <span class="ot">&lt;-</span> <span class="fu">subset</span>(nsw_psid_trim, sample <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="fl">0.5</span>))</span>
<span id="cb295-18"><a href="lalonde-nsw-data.html#cb295-18" tabindex="-1"></a>nsw_trim_psid<span class="sc">$</span>treat[<span class="fu">which</span>(nsw_trim_psid<span class="sc">$</span>sample <span class="sc">==</span> <span class="fl">0.5</span>)] <span class="ot">&lt;-</span> <span class="dv">0</span></span></code></pre></div>
</div>
<div id="initial-samples-4" class="section level5 hasAnchor" number="4.4.2.1.2">
<h5><span class="header-section-number">4.4.2.1.2</span> Initial samples<a href="lalonde-nsw-data.html#initial-samples-4" class="anchor-section" aria-label="Anchor link to header"></a></h5>
<div class="sourceCode" id="cb296"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb296-1"><a href="lalonde-nsw-data.html#cb296-1" tabindex="-1"></a><span class="co"># combine trimmed samples</span></span>
<span id="cb296-2"><a href="lalonde-nsw-data.html#cb296-2" tabindex="-1"></a>all_trim.cps  <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb296-3"><a href="lalonde-nsw-data.html#cb296-3" tabindex="-1"></a>  <span class="at">ps_threshold =</span> nsw_cps.ps_trim, </span>
<span id="cb296-4"><a href="lalonde-nsw-data.html#cb296-4" tabindex="-1"></a>  <span class="at">common_range =</span> nsw_cps.ps_common, </span>
<span id="cb296-5"><a href="lalonde-nsw-data.html#cb296-5" tabindex="-1"></a>  <span class="at">stuermer =</span> nsw_cps.ps_stuermer, </span>
<span id="cb296-6"><a href="lalonde-nsw-data.html#cb296-6" tabindex="-1"></a>  <span class="at">walker =</span> nsw_cps.ps_walker, </span>
<span id="cb296-7"><a href="lalonde-nsw-data.html#cb296-7" tabindex="-1"></a>  <span class="at">crump =</span> nsw_cps.ps_crump)</span>
<span id="cb296-8"><a href="lalonde-nsw-data.html#cb296-8" tabindex="-1"></a></span>
<span id="cb296-9"><a href="lalonde-nsw-data.html#cb296-9" tabindex="-1"></a>all_trim.psid  <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb296-10"><a href="lalonde-nsw-data.html#cb296-10" tabindex="-1"></a>  <span class="at">ps_threshold =</span> nsw_psid.ps_trim, </span>
<span id="cb296-11"><a href="lalonde-nsw-data.html#cb296-11" tabindex="-1"></a>  <span class="at">common_range =</span> nsw_psid.ps_common, </span>
<span id="cb296-12"><a href="lalonde-nsw-data.html#cb296-12" tabindex="-1"></a>  <span class="at">stuermer =</span> nsw_psid.ps_stuermer, </span>
<span id="cb296-13"><a href="lalonde-nsw-data.html#cb296-13" tabindex="-1"></a>  <span class="at">walker =</span> nsw_psid.ps_walker, </span>
<span id="cb296-14"><a href="lalonde-nsw-data.html#cb296-14" tabindex="-1"></a>  <span class="at">crump =</span> nsw_psid.ps_crump)</span></code></pre></div>
<div id="distance-matching-2" class="section level6 hasAnchor" number="4.4.2.1.2.1">
<h6><span class="header-section-number">4.4.2.1.2.1</span> Distance matching<a href="lalonde-nsw-data.html#distance-matching-2" class="anchor-section" aria-label="Anchor link to header"></a></h6>
<ol style="list-style-type: decimal">
<li>1:1 Nearest neighbor matching with 1) propensity threshold 2) common range 3) stuermer 4) walker 5) crump trimming</li>
</ol>
<div class="sourceCode" id="cb297"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb297-1"><a href="lalonde-nsw-data.html#cb297-1" tabindex="-1"></a><span class="co"># perform nearest neighbor matching with k=1, logistic propensity score and replacement</span></span>
<span id="cb297-2"><a href="lalonde-nsw-data.html#cb297-2" tabindex="-1"></a>nn_trim_comb.cps <span class="ot">&lt;-</span> <span class="fu">attach_matchit</span>(model, <span class="at">data_list =</span> all_trim.cps, <span class="at">method =</span> <span class="st">&quot;nearest&quot;</span>, <span class="at">distance =</span> <span class="st">&quot;glm&quot;</span>, <span class="at">link =</span> <span class="st">&quot;logit&quot;</span>, <span class="at">replace =</span> <span class="cn">TRUE</span>)</span>
<span id="cb297-3"><a href="lalonde-nsw-data.html#cb297-3" tabindex="-1"></a>nn_trim_comb.psid <span class="ot">&lt;-</span> <span class="fu">attach_matchit</span>(model, <span class="at">data_list =</span> all_trim.psid, <span class="at">method =</span> <span class="st">&quot;nearest&quot;</span>, <span class="at">distance =</span> <span class="st">&quot;glm&quot;</span>, <span class="at">link =</span> <span class="st">&quot;logit&quot;</span>, <span class="at">replace =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
<ol start="2" style="list-style-type: decimal">
<li>k:1 matching (k=2) with 1) propensity threshold 2) common range 3) stuermer 4) walker 5) crump trimming</li>
</ol>
<div class="sourceCode" id="cb298"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb298-1"><a href="lalonde-nsw-data.html#cb298-1" tabindex="-1"></a><span class="co"># perform nearest neighbor matching with k=2, logistic propensity score and replacement</span></span>
<span id="cb298-2"><a href="lalonde-nsw-data.html#cb298-2" tabindex="-1"></a>k<span class="ot">&lt;-</span><span class="dv">2</span></span>
<span id="cb298-3"><a href="lalonde-nsw-data.html#cb298-3" tabindex="-1"></a>k2_trim_comb.cps <span class="ot">&lt;-</span> <span class="fu">attach_matchit</span>(model, <span class="at">data_list =</span> all_trim.cps, <span class="at">method =</span> <span class="st">&quot;nearest&quot;</span>, <span class="at">distance =</span> <span class="st">&quot;glm&quot;</span>, <span class="at">link =</span> <span class="st">&quot;logit&quot;</span>, <span class="at">ratio =</span> k, <span class="at">replace =</span> <span class="cn">TRUE</span>)</span>
<span id="cb298-4"><a href="lalonde-nsw-data.html#cb298-4" tabindex="-1"></a>k2_trim_comb.psid <span class="ot">&lt;-</span> <span class="fu">attach_matchit</span>(model, <span class="at">data_list =</span> all_trim.psid, <span class="at">method =</span> <span class="st">&quot;nearest&quot;</span>, <span class="at">distance =</span> <span class="st">&quot;glm&quot;</span>, <span class="at">link =</span> <span class="st">&quot;logit&quot;</span>, <span class="at">ratio =</span> k, <span class="at">replace =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
<ol start="3" style="list-style-type: decimal">
<li>k:1 matching (k=3) with 1) propensity threshold 2) common range 3) stuermer 4) walker 5) crump trimming</li>
</ol>
<div class="sourceCode" id="cb299"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb299-1"><a href="lalonde-nsw-data.html#cb299-1" tabindex="-1"></a><span class="co"># perform nearest neighbor matching with k=3, logistic propensity score and replacement</span></span>
<span id="cb299-2"><a href="lalonde-nsw-data.html#cb299-2" tabindex="-1"></a>k<span class="ot">&lt;-</span><span class="dv">3</span></span>
<span id="cb299-3"><a href="lalonde-nsw-data.html#cb299-3" tabindex="-1"></a>k3_trim_comb.cps <span class="ot">&lt;-</span> <span class="fu">attach_matchit</span>(model, <span class="at">data_list =</span> all_trim.cps, <span class="at">method =</span> <span class="st">&quot;nearest&quot;</span>, <span class="at">distance =</span> <span class="st">&quot;glm&quot;</span>, <span class="at">link =</span> <span class="st">&quot;logit&quot;</span>, <span class="at">ratio =</span> k, <span class="at">replace =</span> <span class="cn">TRUE</span>)</span>
<span id="cb299-4"><a href="lalonde-nsw-data.html#cb299-4" tabindex="-1"></a>k3_trim_comb.psid <span class="ot">&lt;-</span> <span class="fu">attach_matchit</span>(model, <span class="at">data_list =</span> all_trim.psid, <span class="at">method =</span> <span class="st">&quot;nearest&quot;</span>, <span class="at">distance =</span> <span class="st">&quot;glm&quot;</span>, <span class="at">link =</span> <span class="st">&quot;logit&quot;</span>, <span class="at">ratio =</span> k, <span class="at">replace =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
<ol start="4" style="list-style-type: decimal">
<li>Caliper matching with 1) propensity threshold 2) common range 3) stuermer 4) walker 5) crump trimming</li>
</ol>
<div class="sourceCode" id="cb300"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb300-1"><a href="lalonde-nsw-data.html#cb300-1" tabindex="-1"></a><span class="co"># perform nearest neighbor matching with a caliper of 0.1 on the logistic propensity score and replacement </span></span>
<span id="cb300-2"><a href="lalonde-nsw-data.html#cb300-2" tabindex="-1"></a>caliper_trim_comb.cps <span class="ot">&lt;-</span> <span class="fu">attach_matchit</span>(model, <span class="at">data_list =</span> all_trim.cps, <span class="at">method =</span> <span class="st">&quot;nearest&quot;</span>, <span class="at">distance =</span> <span class="st">&quot;glm&quot;</span>, <span class="at">link =</span> <span class="st">&quot;logit&quot;</span>, <span class="at">caliper =</span> <span class="fl">0.1</span>, <span class="at">replace =</span> <span class="cn">TRUE</span>)</span>
<span id="cb300-3"><a href="lalonde-nsw-data.html#cb300-3" tabindex="-1"></a>caliper_trim_comb.psid <span class="ot">&lt;-</span> <span class="fu">attach_matchit</span>(model,<span class="at">data_list =</span> all_trim.psid, <span class="at">method =</span> <span class="st">&quot;nearest&quot;</span>, <span class="at">distance =</span> <span class="st">&quot;glm&quot;</span>, <span class="at">link =</span> <span class="st">&quot;logit&quot;</span>, <span class="at">caliper =</span> <span class="fl">0.1</span>, <span class="at">replace =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
<ol start="5" style="list-style-type: decimal">
<li>Common support restriction matching with 1) propensity threshold 2) common range 3) stuermer 4) walker 5) crump trimming</li>
</ol>
<div class="sourceCode" id="cb301"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb301-1"><a href="lalonde-nsw-data.html#cb301-1" tabindex="-1"></a><span class="co"># perform nearest neighbor matching with exclusion of units outside common support and replacement</span></span>
<span id="cb301-2"><a href="lalonde-nsw-data.html#cb301-2" tabindex="-1"></a>cs_trim_comb.cps <span class="ot">&lt;-</span> <span class="fu">attach_matchit</span>(model, <span class="at">data_list =</span> all_trim.cps, <span class="at">method =</span> <span class="st">&quot;nearest&quot;</span>, <span class="at">distance =</span> <span class="st">&quot;glm&quot;</span>, <span class="at">link =</span> <span class="st">&quot;logit&quot;</span>, <span class="at">discard =</span> <span class="st">&quot;both&quot;</span>, <span class="at">reestimate =</span> <span class="cn">TRUE</span>, <span class="at">replace =</span> <span class="cn">TRUE</span>)</span>
<span id="cb301-3"><a href="lalonde-nsw-data.html#cb301-3" tabindex="-1"></a>cs_trim_comb.psid <span class="ot">&lt;-</span> <span class="fu">attach_matchit</span>(model,<span class="at">data_list =</span> all_trim.psid, <span class="at">method =</span> <span class="st">&quot;nearest&quot;</span>, <span class="at">distance =</span> <span class="st">&quot;glm&quot;</span>, <span class="at">link =</span> <span class="st">&quot;logit&quot;</span>, <span class="at">discard =</span> <span class="st">&quot;both&quot;</span>, <span class="at">reestimate =</span> <span class="cn">TRUE</span>, <span class="at">replace =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
<ol start="6" style="list-style-type: decimal">
<li>Mahalanobis distance matching (mahvars) with 1) propensity threshold 2) common range 3) stuermer 4) walker 5) crump trimming</li>
</ol>
<div class="sourceCode" id="cb302"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb302-1"><a href="lalonde-nsw-data.html#cb302-1" tabindex="-1"></a><span class="co"># perform nearest neighbor matching using mahalanobis distance without replacement</span></span>
<span id="cb302-2"><a href="lalonde-nsw-data.html#cb302-2" tabindex="-1"></a>mahvars_trim_comb.cps <span class="ot">&lt;-</span> <span class="fu">attach_matchit</span>(model, <span class="at">data_list =</span> all_trim.cps, <span class="at">method =</span> <span class="st">&quot;nearest&quot;</span>, <span class="at">distance =</span> <span class="st">&quot;mahalanobis&quot;</span>, <span class="at">replace =</span> <span class="cn">FALSE</span>)</span>
<span id="cb302-3"><a href="lalonde-nsw-data.html#cb302-3" tabindex="-1"></a>mahvars_trim_comb.psid <span class="ot">&lt;-</span> <span class="fu">attach_matchit</span>(model,<span class="at">data_list =</span> all_trim.psid, <span class="at">method =</span> <span class="st">&quot;nearest&quot;</span>, <span class="at">distance =</span> <span class="st">&quot;mahalanobis&quot;</span>, <span class="at">replace =</span> <span class="cn">FALSE</span>)</span></code></pre></div>
<ol start="7" style="list-style-type: decimal">
<li>Optimal pair matching with 1) propensity threshold 2) common range 3) stuermer 4) walker 5) crump trimming</li>
</ol>
<div class="sourceCode" id="cb303"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb303-1"><a href="lalonde-nsw-data.html#cb303-1" tabindex="-1"></a><span class="co"># perform optimal pair matching that minimizes total within-pair distance on propensity scores</span></span>
<span id="cb303-2"><a href="lalonde-nsw-data.html#cb303-2" tabindex="-1"></a>optimal_pair_trim_comb.cps <span class="ot">&lt;-</span> <span class="fu">attach_matchit</span>(model, <span class="at">data_list =</span> all_trim.cps, <span class="at">method =</span> <span class="st">&quot;optimal&quot;</span>, <span class="at">distance =</span> <span class="st">&quot;glm&quot;</span>, <span class="at">link =</span> <span class="st">&quot;logit&quot;</span>)</span>
<span id="cb303-3"><a href="lalonde-nsw-data.html#cb303-3" tabindex="-1"></a>optimal_pair_trim_comb.psid <span class="ot">&lt;-</span> <span class="fu">attach_matchit</span>(model,<span class="at">data_list =</span> all_trim.psid, <span class="at">method =</span> <span class="st">&quot;optimal&quot;</span>, <span class="at">distance =</span> <span class="st">&quot;glm&quot;</span>, <span class="at">link =</span> <span class="st">&quot;logit&quot;</span>)</span></code></pre></div>
<ol start="8" style="list-style-type: decimal">
<li>Optimal full matching with 1) propensity threshold 2) common range 3) stuermer 4) walker 5) crump trimming</li>
</ol>
<div class="sourceCode" id="cb304"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb304-1"><a href="lalonde-nsw-data.html#cb304-1" tabindex="-1"></a><span class="co"># perform optimal full matching allowing sets with varying ratios of treated to controls and minimizing a global distance criterion</span></span>
<span id="cb304-2"><a href="lalonde-nsw-data.html#cb304-2" tabindex="-1"></a>optimal_full_trim_comb.cps <span class="ot">&lt;-</span> <span class="fu">attach_matchit</span>(model, <span class="at">data_list =</span> all_trim.cps, <span class="at">method =</span> <span class="st">&quot;full&quot;</span>, <span class="at">distance =</span> <span class="st">&quot;glm&quot;</span>, <span class="at">link =</span> <span class="st">&quot;logit&quot;</span>)</span>
<span id="cb304-3"><a href="lalonde-nsw-data.html#cb304-3" tabindex="-1"></a>optimal_full_trim_comb.psid <span class="ot">&lt;-</span> <span class="fu">attach_matchit</span>(model,<span class="at">data_list =</span> all_trim.psid, <span class="at">method =</span> <span class="st">&quot;full&quot;</span>, <span class="at">distance =</span> <span class="st">&quot;glm&quot;</span>, <span class="at">link =</span> <span class="st">&quot;logit&quot;</span>)</span></code></pre></div>
<ol start="9" style="list-style-type: decimal">
<li>Generalized full matching with 1) propensity threshold 2) common range 3) stuermer 4) walker 5) crump trimming</li>
</ol>
<div class="sourceCode" id="cb305"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb305-1"><a href="lalonde-nsw-data.html#cb305-1" tabindex="-1"></a><span class="co"># perform generalized full matching using fast approximation and producing matched sets with flexible treated/control ratios </span></span>
<span id="cb305-2"><a href="lalonde-nsw-data.html#cb305-2" tabindex="-1"></a>general_full_trim_comb.cps <span class="ot">&lt;-</span> <span class="fu">attach_matchit</span>(model, <span class="at">data_list =</span> all_trim.cps, <span class="at">method =</span> <span class="st">&quot;quick&quot;</span>, <span class="at">distance =</span> <span class="st">&quot;glm&quot;</span>, <span class="at">link =</span> <span class="st">&quot;logit&quot;</span>)</span>
<span id="cb305-3"><a href="lalonde-nsw-data.html#cb305-3" tabindex="-1"></a>general_full_trim_comb.psid <span class="ot">&lt;-</span> <span class="fu">attach_matchit</span>(model,<span class="at">data_list =</span> all_trim.psid, <span class="at">method =</span> <span class="st">&quot;quick&quot;</span>, <span class="at">distance =</span> <span class="st">&quot;glm&quot;</span>, <span class="at">link =</span> <span class="st">&quot;logit&quot;</span>)</span></code></pre></div>
<ol start="10" style="list-style-type: decimal">
<li>Genetic matching with 1) propensity threshold 2) common range 3) stuermer 4) walker 5) crump trimming</li>
</ol>
<div class="sourceCode" id="cb306"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb306-1"><a href="lalonde-nsw-data.html#cb306-1" tabindex="-1"></a><span class="co"># perform genetic matching </span></span>
<span id="cb306-2"><a href="lalonde-nsw-data.html#cb306-2" tabindex="-1"></a>genetic_trim_comb.cps <span class="ot">&lt;-</span> <span class="fu">attach_matchit</span>(model, <span class="at">data_list =</span> all_trim.cps, <span class="at">method =</span> <span class="st">&quot;genetic&quot;</span>, <span class="at">distance =</span> <span class="st">&quot;glm&quot;</span>, <span class="at">link =</span> <span class="st">&quot;logit&quot;</span>, <span class="at">replace =</span> <span class="cn">TRUE</span>, <span class="at">pop.size =</span> <span class="dv">100</span>)</span>
<span id="cb306-3"><a href="lalonde-nsw-data.html#cb306-3" tabindex="-1"></a>genetic_trim_comb.psid <span class="ot">&lt;-</span> <span class="fu">attach_matchit</span>(model,<span class="at">data_list =</span> all_trim.psid, <span class="at">method =</span> <span class="st">&quot;genetic&quot;</span>, <span class="at">distance =</span> <span class="st">&quot;glm&quot;</span>, <span class="at">link =</span> <span class="st">&quot;logit&quot;</span>, <span class="at">replace =</span> <span class="cn">TRUE</span>, <span class="at">pop.size =</span> <span class="dv">100</span>)</span></code></pre></div>
</div>
<div id="stratum-matching-2" class="section level6 hasAnchor" number="4.4.2.1.2.2">
<h6><span class="header-section-number">4.4.2.1.2.2</span> Stratum matching<a href="lalonde-nsw-data.html#stratum-matching-2" class="anchor-section" aria-label="Anchor link to header"></a></h6>
<ol start="11" style="list-style-type: decimal">
<li>Exact matching (exact)</li>
</ol>
<div class="sourceCode" id="cb307"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb307-1"><a href="lalonde-nsw-data.html#cb307-1" tabindex="-1"></a><span class="co"># match units exactly by raw covariate profiles </span></span>
<span id="cb307-2"><a href="lalonde-nsw-data.html#cb307-2" tabindex="-1"></a>exact_trim_comb.cps <span class="ot">&lt;-</span> <span class="fu">attach_matchit</span>(model, <span class="at">data_list =</span> all_trim.cps, <span class="at">method =</span> <span class="st">&quot;exact&quot;</span>)</span></code></pre></div>
<pre><code>## MATCHING SUMMARY: 4 succeeded, 1 failed. Failed: walker</code></pre>
<div class="sourceCode" id="cb309"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb309-1"><a href="lalonde-nsw-data.html#cb309-1" tabindex="-1"></a>exact_trim_comb.psid <span class="ot">&lt;-</span> <span class="fu">attach_matchit</span>(model,<span class="at">data_list =</span> all_trim.psid, <span class="at">method =</span> <span class="st">&quot;exact&quot;</span>)</span></code></pre></div>
<pre><code>## MATCHING SUMMARY: 4 succeeded, 1 failed. Failed: walker</code></pre>
<ol start="12" style="list-style-type: decimal">
<li>Coarsened matching (cem)</li>
</ol>
<div class="sourceCode" id="cb311"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb311-1"><a href="lalonde-nsw-data.html#cb311-1" tabindex="-1"></a><span class="co"># match units exactly within coarse strata </span></span>
<span id="cb311-2"><a href="lalonde-nsw-data.html#cb311-2" tabindex="-1"></a>cem_trim_comb.cps <span class="ot">&lt;-</span> <span class="fu">attach_matchit</span>(model, <span class="at">data_list =</span> all_trim.cps, <span class="at">method =</span> <span class="st">&quot;cem&quot;</span>)</span>
<span id="cb311-3"><a href="lalonde-nsw-data.html#cb311-3" tabindex="-1"></a>cem_trim_comb.psid <span class="ot">&lt;-</span> <span class="fu">attach_matchit</span>(model,<span class="at">data_list =</span> all_trim.psid, <span class="at">method =</span> <span class="st">&quot;cem&quot;</span>)</span></code></pre></div>
<ol start="13" style="list-style-type: decimal">
<li>Subclassification</li>
</ol>
<div class="sourceCode" id="cb312"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb312-1"><a href="lalonde-nsw-data.html#cb312-1" tabindex="-1"></a><span class="co"># partition sample into fixed number of bins based on propensity score </span></span>
<span id="cb312-2"><a href="lalonde-nsw-data.html#cb312-2" tabindex="-1"></a>subcl_trim_comb.cps <span class="ot">&lt;-</span> <span class="fu">attach_matchit</span>(model, <span class="at">data_list =</span> all_trim.cps, <span class="at">method =</span> <span class="st">&quot;subclass&quot;</span>, <span class="at">subclass =</span> <span class="dv">3</span>)</span>
<span id="cb312-3"><a href="lalonde-nsw-data.html#cb312-3" tabindex="-1"></a>subcl_trim_comb.psid <span class="ot">&lt;-</span> <span class="fu">attach_matchit</span>(model,<span class="at">data_list =</span> all_trim.psid, <span class="at">method =</span> <span class="st">&quot;subclass&quot;</span>, <span class="at">subclass =</span> <span class="dv">3</span>)</span></code></pre></div>
</div>
<div id="pure-subset-selection-2" class="section level6 hasAnchor" number="4.4.2.1.2.3">
<h6><span class="header-section-number">4.4.2.1.2.3</span> Pure subset selection<a href="lalonde-nsw-data.html#pure-subset-selection-2" class="anchor-section" aria-label="Anchor link to header"></a></h6>
<ol start="14" style="list-style-type: decimal">
<li>Cardinality profile matching</li>
</ol>
<div class="sourceCode" id="cb313"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb313-1"><a href="lalonde-nsw-data.html#cb313-1" tabindex="-1"></a><span class="co"># select largest balanced subsample meeting covariate balance tolerances and a fixed ratio of controls to treated units</span></span>
<span id="cb313-2"><a href="lalonde-nsw-data.html#cb313-2" tabindex="-1"></a>card_trim_comb.cps <span class="ot">&lt;-</span> <span class="fu">attach_matchit</span>(model, <span class="at">data_list =</span> all_trim.cps, <span class="at">method =</span> <span class="st">&quot;cardinality&quot;</span>, <span class="at">tols =</span> <span class="fl">0.1</span>, <span class="at">ratio =</span> <span class="dv">1</span>, <span class="at">time =</span> <span class="dv">1200</span>)</span>
<span id="cb313-3"><a href="lalonde-nsw-data.html#cb313-3" tabindex="-1"></a>card_trim_comb.psid <span class="ot">&lt;-</span> <span class="fu">attach_matchit</span>(model,<span class="at">data_list =</span> all_trim.psid, <span class="at">method =</span> <span class="st">&quot;cardinality&quot;</span>, <span class="at">tols =</span> <span class="fl">0.1</span>, <span class="at">ratio =</span> <span class="dv">1</span>, <span class="at">time =</span> <span class="dv">1200</span>)</span></code></pre></div>
<ol start="15" style="list-style-type: decimal">
<li>Profile matching</li>
</ol>
<div class="sourceCode" id="cb314"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb314-1"><a href="lalonde-nsw-data.html#cb314-1" tabindex="-1"></a><span class="co"># select the largest control group subset balanced to the treated group (for ATT), leaving the treated group intact</span></span>
<span id="cb314-2"><a href="lalonde-nsw-data.html#cb314-2" tabindex="-1"></a>profile_trim_comb.cps <span class="ot">&lt;-</span> <span class="fu">attach_matchit</span>(model, <span class="at">data_list =</span> all_trim.cps, <span class="at">method =</span> <span class="st">&quot;cardinality&quot;</span>, <span class="at">estimand =</span> <span class="st">&quot;ATT&quot;</span>, <span class="at">tols =</span> <span class="fl">0.1</span>, <span class="at">ratio =</span> <span class="cn">NA</span>, <span class="at">time =</span> <span class="dv">1200</span>)</span>
<span id="cb314-3"><a href="lalonde-nsw-data.html#cb314-3" tabindex="-1"></a>profile_trim_comb.psid <span class="ot">&lt;-</span> <span class="fu">attach_matchit</span>(model,<span class="at">data_list =</span> all_trim.psid, <span class="at">method =</span> <span class="st">&quot;cardinality&quot;</span>, <span class="at">estimand =</span> <span class="st">&quot;ATT&quot;</span>, <span class="at">tols =</span> <span class="fl">0.1</span>, <span class="at">ratio =</span> <span class="cn">NA</span>, <span class="at">time =</span> <span class="dv">1200</span>)</span></code></pre></div>
</div>
</div>
</div>
</div>
</div>
<div id="post-assessing-methods-2" class="section level2 hasAnchor" number="4.5">
<h2><span class="header-section-number">4.5</span> Post-assessing methods<a href="lalonde-nsw-data.html#post-assessing-methods-2" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div id="single-methods-5" class="section level3 hasAnchor" number="4.5.1">
<h3><span class="header-section-number">4.5.1</span> Single methods<a href="lalonde-nsw-data.html#single-methods-5" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div id="trimming-7" class="section level4 hasAnchor" number="4.5.1.1">
<h4><span class="header-section-number">4.5.1.1</span> Trimming<a href="lalonde-nsw-data.html#trimming-7" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<div id="smd-6" class="section level5 hasAnchor" number="4.5.1.1.1">
<h5><span class="header-section-number">4.5.1.1.1</span> SMD<a href="lalonde-nsw-data.html#smd-6" class="anchor-section" aria-label="Anchor link to header"></a></h5>
<div class="sourceCode" id="cb315"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb315-1"><a href="lalonde-nsw-data.html#cb315-1" tabindex="-1"></a><span class="co"># compute absolute standardized mean differences</span></span>
<span id="cb315-2"><a href="lalonde-nsw-data.html#cb315-2" tabindex="-1"></a>smd_trim.cps <span class="ot">&lt;-</span> <span class="fu">compute_abs_smd_trim</span>(all_trim.cps, <span class="st">&quot;treat&quot;</span>, covar)</span>
<span id="cb315-3"><a href="lalonde-nsw-data.html#cb315-3" tabindex="-1"></a>smd_trim.psid <span class="ot">&lt;-</span> <span class="fu">compute_abs_smd_trim</span>(all_trim.psid, <span class="st">&quot;treat&quot;</span>, covar)</span></code></pre></div>
</div>
<div id="ovl-6" class="section level5 hasAnchor" number="4.5.1.1.2">
<h5><span class="header-section-number">4.5.1.1.2</span> OVL<a href="lalonde-nsw-data.html#ovl-6" class="anchor-section" aria-label="Anchor link to header"></a></h5>
<div class="sourceCode" id="cb316"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb316-1"><a href="lalonde-nsw-data.html#cb316-1" tabindex="-1"></a><span class="co"># compute overlap coefficients</span></span>
<span id="cb316-2"><a href="lalonde-nsw-data.html#cb316-2" tabindex="-1"></a>ovl_trim.cps <span class="ot">&lt;-</span> <span class="fu">compute_ovl_trim</span>(all_trim.cps, <span class="st">&quot;ps_assoverlap&quot;</span>, <span class="st">&quot;treat&quot;</span>)</span>
<span id="cb316-3"><a href="lalonde-nsw-data.html#cb316-3" tabindex="-1"></a>ovl_trim.psid <span class="ot">&lt;-</span> <span class="fu">compute_ovl_trim</span>(all_trim.psid, <span class="st">&quot;ps_assoverlap&quot;</span>, <span class="st">&quot;treat&quot;</span>)</span></code></pre></div>
</div>
</div>
</div>
<div id="integrated-methods-7" class="section level3 hasAnchor" number="4.5.2">
<h3><span class="header-section-number">4.5.2</span> Integrated methods<a href="lalonde-nsw-data.html#integrated-methods-7" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div id="trimming-and-matching-5" class="section level4 hasAnchor" number="4.5.2.1">
<h4><span class="header-section-number">4.5.2.1</span> Trimming and matching<a href="lalonde-nsw-data.html#trimming-and-matching-5" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<div id="extended-samples-5" class="section level5 hasAnchor" number="4.5.2.1.1">
<h5><span class="header-section-number">4.5.2.1.1</span> Extended samples<a href="lalonde-nsw-data.html#extended-samples-5" class="anchor-section" aria-label="Anchor link to header"></a></h5>
<p>(Similar to tutorial by <span class="citation">Imbens and Xu (<a href="#ref-imbens2024">2024</a>)</span>)</p>
<div class="sourceCode" id="cb317"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb317-1"><a href="lalonde-nsw-data.html#cb317-1" tabindex="-1"></a><span class="co"># list all trimmed and matched samples</span></span>
<span id="cb317-2"><a href="lalonde-nsw-data.html#cb317-2" tabindex="-1"></a>trim_match_comb.cps_plus <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="at">ps_threshold_match =</span> nsw_cps_trim_match)</span>
<span id="cb317-3"><a href="lalonde-nsw-data.html#cb317-3" tabindex="-1"></a>trim_match_comb.psid_plus <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="at">ps_threshold_match =</span> nsw_psid_trim_match)</span></code></pre></div>
<div id="smd-7" class="section level6 hasAnchor" number="4.5.2.1.1.1">
<h6><span class="header-section-number">4.5.2.1.1.1</span> SMD<a href="lalonde-nsw-data.html#smd-7" class="anchor-section" aria-label="Anchor link to header"></a></h6>
<div class="sourceCode" id="cb318"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb318-1"><a href="lalonde-nsw-data.html#cb318-1" tabindex="-1"></a><span class="co"># compute absolute standardized mean differences</span></span>
<span id="cb318-2"><a href="lalonde-nsw-data.html#cb318-2" tabindex="-1"></a>smd_trim_match_comb.cps_plus <span class="ot">&lt;-</span> <span class="fu">compute_abs_smd_trim</span>(trim_match_comb.cps_plus, <span class="st">&quot;treat&quot;</span>, covar)</span>
<span id="cb318-3"><a href="lalonde-nsw-data.html#cb318-3" tabindex="-1"></a>smd_trim_match_comb.psid_plus <span class="ot">&lt;-</span> <span class="fu">compute_abs_smd_trim</span>(trim_match_comb.psid_plus, <span class="st">&quot;treat&quot;</span>, covar)</span></code></pre></div>
</div>
<div id="ovl-7" class="section level6 hasAnchor" number="4.5.2.1.1.2">
<h6><span class="header-section-number">4.5.2.1.1.2</span> OVL<a href="lalonde-nsw-data.html#ovl-7" class="anchor-section" aria-label="Anchor link to header"></a></h6>
<div class="sourceCode" id="cb319"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb319-1"><a href="lalonde-nsw-data.html#cb319-1" tabindex="-1"></a><span class="co"># compute overlap coefficients</span></span>
<span id="cb319-2"><a href="lalonde-nsw-data.html#cb319-2" tabindex="-1"></a>ovl_trim_match_comb.cps_plus <span class="ot">&lt;-</span> <span class="fu">compute_ovl_trim</span>(trim_match_comb.cps_plus, <span class="st">&quot;ps_assoverlap&quot;</span>, <span class="st">&quot;treat&quot;</span>)</span>
<span id="cb319-3"><a href="lalonde-nsw-data.html#cb319-3" tabindex="-1"></a>ovl_trim_match_comb.psid_plus <span class="ot">&lt;-</span> <span class="fu">compute_ovl_trim</span>(trim_match_comb.psid_plus, <span class="st">&quot;ps_assoverlap&quot;</span>, <span class="st">&quot;treat&quot;</span>)</span></code></pre></div>
</div>
</div>
<div id="initial-samples-5" class="section level5 hasAnchor" number="4.5.2.1.2">
<h5><span class="header-section-number">4.5.2.1.2</span> Initial samples<a href="lalonde-nsw-data.html#initial-samples-5" class="anchor-section" aria-label="Anchor link to header"></a></h5>
<div class="sourceCode" id="cb320"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb320-1"><a href="lalonde-nsw-data.html#cb320-1" tabindex="-1"></a><span class="co"># list all trimmed and matched samples</span></span>
<span id="cb320-2"><a href="lalonde-nsw-data.html#cb320-2" tabindex="-1"></a>trim_match_comb.cps <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb320-3"><a href="lalonde-nsw-data.html#cb320-3" tabindex="-1"></a>  <span class="at">nn =</span> nn_trim_comb.cps, </span>
<span id="cb320-4"><a href="lalonde-nsw-data.html#cb320-4" tabindex="-1"></a>  <span class="at">k2 =</span> k2_trim_comb.cps,</span>
<span id="cb320-5"><a href="lalonde-nsw-data.html#cb320-5" tabindex="-1"></a>  <span class="at">k3 =</span> k3_trim_comb.cps, </span>
<span id="cb320-6"><a href="lalonde-nsw-data.html#cb320-6" tabindex="-1"></a>  <span class="at">caliper =</span> caliper_trim_comb.cps,</span>
<span id="cb320-7"><a href="lalonde-nsw-data.html#cb320-7" tabindex="-1"></a>  <span class="at">cs =</span> cs_trim_comb.cps, </span>
<span id="cb320-8"><a href="lalonde-nsw-data.html#cb320-8" tabindex="-1"></a>  <span class="at">mahvars =</span> mahvars_trim_comb.cps,</span>
<span id="cb320-9"><a href="lalonde-nsw-data.html#cb320-9" tabindex="-1"></a>  <span class="at">optimal_pair =</span> optimal_pair_trim_comb.cps,</span>
<span id="cb320-10"><a href="lalonde-nsw-data.html#cb320-10" tabindex="-1"></a>  <span class="at">optimal_full =</span> optimal_full_trim_comb.cps, </span>
<span id="cb320-11"><a href="lalonde-nsw-data.html#cb320-11" tabindex="-1"></a>  <span class="at">genetic =</span> genetic_trim_comb.cps, </span>
<span id="cb320-12"><a href="lalonde-nsw-data.html#cb320-12" tabindex="-1"></a>  <span class="at">exact =</span> exact_trim_comb.cps,</span>
<span id="cb320-13"><a href="lalonde-nsw-data.html#cb320-13" tabindex="-1"></a>  <span class="at">cem =</span> cem_trim_comb.cps,</span>
<span id="cb320-14"><a href="lalonde-nsw-data.html#cb320-14" tabindex="-1"></a>  <span class="at">subcl =</span> subcl_trim_comb.cps </span>
<span id="cb320-15"><a href="lalonde-nsw-data.html#cb320-15" tabindex="-1"></a>)</span>
<span id="cb320-16"><a href="lalonde-nsw-data.html#cb320-16" tabindex="-1"></a></span>
<span id="cb320-17"><a href="lalonde-nsw-data.html#cb320-17" tabindex="-1"></a>trim_match_comb.psid <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb320-18"><a href="lalonde-nsw-data.html#cb320-18" tabindex="-1"></a>  <span class="at">nn =</span> nn_trim_comb.psid,</span>
<span id="cb320-19"><a href="lalonde-nsw-data.html#cb320-19" tabindex="-1"></a>  <span class="at">k2 =</span> k2_trim_comb.psid, </span>
<span id="cb320-20"><a href="lalonde-nsw-data.html#cb320-20" tabindex="-1"></a>  <span class="at">k3 =</span> k3_trim_comb.psid, </span>
<span id="cb320-21"><a href="lalonde-nsw-data.html#cb320-21" tabindex="-1"></a>  <span class="at">caliper =</span> caliper_trim_comb.psid, </span>
<span id="cb320-22"><a href="lalonde-nsw-data.html#cb320-22" tabindex="-1"></a>  <span class="at">cs =</span> cs_trim_comb.psid,</span>
<span id="cb320-23"><a href="lalonde-nsw-data.html#cb320-23" tabindex="-1"></a>  <span class="at">mahvars =</span> mahvars_trim_comb.psid,</span>
<span id="cb320-24"><a href="lalonde-nsw-data.html#cb320-24" tabindex="-1"></a>  <span class="at">optimal_pair =</span> optimal_pair_trim_comb.psid, </span>
<span id="cb320-25"><a href="lalonde-nsw-data.html#cb320-25" tabindex="-1"></a>  <span class="at">optimal_full =</span> optimal_full_trim_comb.psid, </span>
<span id="cb320-26"><a href="lalonde-nsw-data.html#cb320-26" tabindex="-1"></a>  <span class="at">genetic =</span> genetic_trim_comb.psid,</span>
<span id="cb320-27"><a href="lalonde-nsw-data.html#cb320-27" tabindex="-1"></a>  <span class="at">exact =</span> exact_trim_comb.psid,</span>
<span id="cb320-28"><a href="lalonde-nsw-data.html#cb320-28" tabindex="-1"></a>  <span class="at">cem =</span> cem_trim_comb.psid,</span>
<span id="cb320-29"><a href="lalonde-nsw-data.html#cb320-29" tabindex="-1"></a>  <span class="at">subcl =</span> subcl_trim_comb.psid </span>
<span id="cb320-30"><a href="lalonde-nsw-data.html#cb320-30" tabindex="-1"></a>)</span></code></pre></div>
<div id="smd-8" class="section level6 hasAnchor" number="4.5.2.1.2.1">
<h6><span class="header-section-number">4.5.2.1.2.1</span> SMD<a href="lalonde-nsw-data.html#smd-8" class="anchor-section" aria-label="Anchor link to header"></a></h6>
<div class="sourceCode" id="cb321"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb321-1"><a href="lalonde-nsw-data.html#cb321-1" tabindex="-1"></a><span class="co"># compute absolute standardized mean differences</span></span>
<span id="cb321-2"><a href="lalonde-nsw-data.html#cb321-2" tabindex="-1"></a>smd_trim_match_comb.cps <span class="ot">&lt;-</span> <span class="fu">compute_abs_smd_matchit</span>(trim_match_comb.cps, all_trim.cps) </span>
<span id="cb321-3"><a href="lalonde-nsw-data.html#cb321-3" tabindex="-1"></a>smd_trim_match_comb.psid <span class="ot">&lt;-</span> <span class="fu">compute_abs_smd_matchit</span>(trim_match_comb.psid, all_trim.psid)</span></code></pre></div>
</div>
<div id="ovl-8" class="section level6 hasAnchor" number="4.5.2.1.2.2">
<h6><span class="header-section-number">4.5.2.1.2.2</span> OVL<a href="lalonde-nsw-data.html#ovl-8" class="anchor-section" aria-label="Anchor link to header"></a></h6>
<div class="sourceCode" id="cb322"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb322-1"><a href="lalonde-nsw-data.html#cb322-1" tabindex="-1"></a><span class="co"># compute overlap coefficients</span></span>
<span id="cb322-2"><a href="lalonde-nsw-data.html#cb322-2" tabindex="-1"></a>ovl_trim_match_comb.cps <span class="ot">&lt;-</span> <span class="fu">compute_ovl_matchit</span>(trim_match_comb.cps, all_trim.cps, <span class="at">ps =</span> <span class="st">&quot;ps_assoverlap&quot;</span>, <span class="at">treat =</span> <span class="st">&quot;treat&quot;</span>, <span class="at">covar =</span> covar)</span>
<span id="cb322-3"><a href="lalonde-nsw-data.html#cb322-3" tabindex="-1"></a>ovl_trim_match_comb.psid <span class="ot">&lt;-</span> <span class="fu">compute_ovl_matchit</span>(trim_match_comb.psid, all_trim.psid, <span class="at">ps =</span> <span class="st">&quot;ps_assoverlap&quot;</span>, <span class="at">treat =</span> <span class="st">&quot;treat&quot;</span>, <span class="at">covar =</span> covar)</span></code></pre></div>
</div>
</div>
</div>
</div>
</div>
<div id="identifying-most-efficient-methods-2" class="section level2 hasAnchor" number="4.6">
<h2><span class="header-section-number">4.6</span> Identifying most efficient methods<a href="lalonde-nsw-data.html#identifying-most-efficient-methods-2" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div id="ranking-2" class="section level3 hasAnchor" number="4.6.1">
<h3><span class="header-section-number">4.6.1</span> Ranking<a href="lalonde-nsw-data.html#ranking-2" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb323"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb323-1"><a href="lalonde-nsw-data.html#cb323-1" tabindex="-1"></a><span class="co"># combine all results</span></span>
<span id="cb323-2"><a href="lalonde-nsw-data.html#cb323-2" tabindex="-1"></a>all_cps <span class="ot">&lt;-</span> <span class="fu">combine_results</span>(<span class="st">&quot;cps&quot;</span>)</span>
<span id="cb323-3"><a href="lalonde-nsw-data.html#cb323-3" tabindex="-1"></a>all_psid <span class="ot">&lt;-</span> <span class="fu">combine_results</span>(<span class="st">&quot;psid&quot;</span>) </span></code></pre></div>
<div class="sourceCode" id="cb324"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb324-1"><a href="lalonde-nsw-data.html#cb324-1" tabindex="-1"></a><span class="co"># save results </span></span>
<span id="cb324-2"><a href="lalonde-nsw-data.html#cb324-2" tabindex="-1"></a><span class="fu">save_csv</span>(all_cps, <span class="st">&quot;nsw_cps1_all_results&quot;</span>)</span>
<span id="cb324-3"><a href="lalonde-nsw-data.html#cb324-3" tabindex="-1"></a><span class="fu">save_csv</span>(all_psid, <span class="st">&quot;nsw_psid1_all_results&quot;</span>)</span></code></pre></div>
<div class="sourceCode" id="cb325"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb325-1"><a href="lalonde-nsw-data.html#cb325-1" tabindex="-1"></a><span class="co"># rank comparatively</span></span>
<span id="cb325-2"><a href="lalonde-nsw-data.html#cb325-2" tabindex="-1"></a>ranked_cps  <span class="ot">&lt;-</span> <span class="fu">assess_methods</span>(all_cps)</span>
<span id="cb325-3"><a href="lalonde-nsw-data.html#cb325-3" tabindex="-1"></a>ranked_psid <span class="ot">&lt;-</span> <span class="fu">assess_methods</span>(all_psid)</span>
<span id="cb325-4"><a href="lalonde-nsw-data.html#cb325-4" tabindex="-1"></a></span>
<span id="cb325-5"><a href="lalonde-nsw-data.html#cb325-5" tabindex="-1"></a><span class="co"># get top 5 methods</span></span>
<span id="cb325-6"><a href="lalonde-nsw-data.html#cb325-6" tabindex="-1"></a>top5_methods.cps <span class="ot">&lt;-</span> <span class="fu">get_top_methods</span>(ranked_cps, <span class="at">top_n =</span> <span class="dv">5</span>)</span>
<span id="cb325-7"><a href="lalonde-nsw-data.html#cb325-7" tabindex="-1"></a>top5_methods.psid <span class="ot">&lt;-</span> <span class="fu">get_top_methods</span>(ranked_psid, <span class="at">top_n =</span> <span class="dv">5</span>)</span>
<span id="cb325-8"><a href="lalonde-nsw-data.html#cb325-8" tabindex="-1"></a></span>
<span id="cb325-9"><a href="lalonde-nsw-data.html#cb325-9" tabindex="-1"></a><span class="co"># rerank top 5 methods</span></span>
<span id="cb325-10"><a href="lalonde-nsw-data.html#cb325-10" tabindex="-1"></a>top5_methods_df.cps <span class="ot">&lt;-</span> ranked_cps <span class="sc">%&gt;%</span> <span class="fu">arrange</span>(<span class="fu">desc</span>(OVL)) <span class="sc">%&gt;%</span> <span class="fu">head</span>(<span class="dv">5</span>) <span class="sc">%&gt;%</span> <span class="fu">arrange</span>(Mean_Abs_SMD)</span>
<span id="cb325-11"><a href="lalonde-nsw-data.html#cb325-11" tabindex="-1"></a>top5_methods_df.psid <span class="ot">&lt;-</span> ranked_psid <span class="sc">%&gt;%</span> <span class="fu">arrange</span>(<span class="fu">desc</span>(OVL)) <span class="sc">%&gt;%</span> <span class="fu">head</span>(<span class="dv">5</span>) <span class="sc">%&gt;%</span> <span class="fu">arrange</span>(Mean_Abs_SMD)</span>
<span id="cb325-12"><a href="lalonde-nsw-data.html#cb325-12" tabindex="-1"></a></span>
<span id="cb325-13"><a href="lalonde-nsw-data.html#cb325-13" tabindex="-1"></a><span class="co"># get results </span></span>
<span id="cb325-14"><a href="lalonde-nsw-data.html#cb325-14" tabindex="-1"></a>top5_methods.cps <span class="ot">&lt;-</span> top5_methods_df.cps<span class="sc">$</span>Method</span>
<span id="cb325-15"><a href="lalonde-nsw-data.html#cb325-15" tabindex="-1"></a>top5_methods.psid <span class="ot">&lt;-</span> top5_methods_df.psid<span class="sc">$</span>Method</span>
<span id="cb325-16"><a href="lalonde-nsw-data.html#cb325-16" tabindex="-1"></a></span>
<span id="cb325-17"><a href="lalonde-nsw-data.html#cb325-17" tabindex="-1"></a><span class="co"># print table output</span></span>
<span id="cb325-18"><a href="lalonde-nsw-data.html#cb325-18" tabindex="-1"></a><span class="fu">datatable</span>(top5_methods_df.cps, <span class="at">caption =</span> <span class="st">&quot;Top 5 Methods for CPS-1&quot;</span>, <span class="at">options =</span> <span class="fu">list</span>(<span class="at">scrollX =</span> <span class="cn">TRUE</span>, <span class="at">paging =</span> <span class="cn">FALSE</span>, <span class="at">pageLength =</span> <span class="sc">-</span><span class="dv">1</span>, <span class="at">searching =</span> <span class="cn">FALSE</span>))</span></code></pre></div>
<div class="datatables html-widget html-fill-item" id="htmlwidget-c15e1f9a89b81b752489" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-c15e1f9a89b81b752489">{"x":{"filter":"none","vertical":false,"caption":"<caption>Top 5 Methods for CPS-1<\/caption>","data":[["1","2","3","4","5"],["cem_crump","genetic_crump","k3_walker","nn_walker","optimal_pair_walker"],[0.8736476392584764,0.9005139774837411,0.8368125422636087,0.8285457691296112,0.8328175377766401],[0.0064540830919908,0.00654239043392531,0.03330574035133536,0.05213605968391383,0.06046159426966049]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>Method<\/th>\n      <th>OVL<\/th>\n      <th>Mean_Abs_SMD<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"scrollX":true,"paging":false,"pageLength":-1,"searching":false,"columnDefs":[{"className":"dt-right","targets":[2,3]},{"orderable":false,"targets":0},{"name":" ","targets":0},{"name":"Method","targets":1},{"name":"OVL","targets":2},{"name":"Mean_Abs_SMD","targets":3}],"order":[],"autoWidth":false,"orderClasses":false,"lengthMenu":[-1,10,25,50,100]}},"evals":[],"jsHooks":[]}</script>
<div class="sourceCode" id="cb326"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb326-1"><a href="lalonde-nsw-data.html#cb326-1" tabindex="-1"></a><span class="fu">datatable</span>(top5_methods_df.psid, <span class="at">caption =</span> <span class="st">&quot;Top 5 Methods for PSID-1&quot;</span>, <span class="at">options =</span> <span class="fu">list</span>(<span class="at">scrollX =</span> <span class="cn">TRUE</span>, <span class="at">paging =</span> <span class="cn">FALSE</span>, <span class="at">pageLength =</span> <span class="sc">-</span><span class="dv">1</span>, <span class="at">searching =</span> <span class="cn">FALSE</span>))</span></code></pre></div>
<div class="datatables html-widget html-fill-item" id="htmlwidget-70f004224d0d9b7960e4" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-70f004224d0d9b7960e4">{"x":{"filter":"none","vertical":false,"caption":"<caption>Top 5 Methods for PSID-1<\/caption>","data":[["1","2","3","4","5"],["cem_walker","optimal_pair_walker","subcl_stuermer","optimal_full_stuermer","stuermer"],[0.8964820648688596,0.8931920523368786,0.8908480274318245,0.8908480274318245,0.8908480274318245],[0.009038633195704528,0.05776526505128965,0.05790726109813686,0.05955562267282273,0.08127448875547875]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>Method<\/th>\n      <th>OVL<\/th>\n      <th>Mean_Abs_SMD<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"scrollX":true,"paging":false,"pageLength":-1,"searching":false,"columnDefs":[{"className":"dt-right","targets":[2,3]},{"orderable":false,"targets":0},{"name":" ","targets":0},{"name":"Method","targets":1},{"name":"OVL","targets":2},{"name":"Mean_Abs_SMD","targets":3}],"order":[],"autoWidth":false,"orderClasses":false,"lengthMenu":[-1,10,25,50,100]}},"evals":[],"jsHooks":[]}</script>
<div class="sourceCode" id="cb327"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb327-1"><a href="lalonde-nsw-data.html#cb327-1" tabindex="-1"></a><span class="co"># save results </span></span>
<span id="cb327-2"><a href="lalonde-nsw-data.html#cb327-2" tabindex="-1"></a><span class="fu">save_csv</span>(top5_methods.cps, <span class="st">&quot;nsw_cps1_top5_methods&quot;</span>)</span>
<span id="cb327-3"><a href="lalonde-nsw-data.html#cb327-3" tabindex="-1"></a><span class="fu">save_csv</span>(top5_methods.psid, <span class="st">&quot;nsw_psid1_top5_methods&quot;</span>)</span></code></pre></div>
<p>The table shows that NSW-CPS-1 and NSW-PSID-1 share only one top method, all others are based on various trimming and matching methods.</p>
</div>
<div id="sample-construction-2" class="section level3 hasAnchor" number="4.6.2">
<h3><span class="header-section-number">4.6.2</span> Sample construction<a href="lalonde-nsw-data.html#sample-construction-2" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb328"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb328-1"><a href="lalonde-nsw-data.html#cb328-1" tabindex="-1"></a><span class="co"># create lookup lists</span></span>
<span id="cb328-2"><a href="lalonde-nsw-data.html#cb328-2" tabindex="-1"></a>trim_only_cps <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb328-3"><a href="lalonde-nsw-data.html#cb328-3" tabindex="-1"></a>        <span class="at">ps_threshold =</span> nsw_cps.ps_trim,</span>
<span id="cb328-4"><a href="lalonde-nsw-data.html#cb328-4" tabindex="-1"></a>        <span class="at">common_range =</span> nsw_cps.ps_common,</span>
<span id="cb328-5"><a href="lalonde-nsw-data.html#cb328-5" tabindex="-1"></a>        <span class="at">stuermer =</span> nsw_cps.ps_stuermer,</span>
<span id="cb328-6"><a href="lalonde-nsw-data.html#cb328-6" tabindex="-1"></a>        <span class="at">walker =</span> nsw_cps.ps_walker,</span>
<span id="cb328-7"><a href="lalonde-nsw-data.html#cb328-7" tabindex="-1"></a>        <span class="at">crump =</span> nsw_cps.ps_crump</span>
<span id="cb328-8"><a href="lalonde-nsw-data.html#cb328-8" tabindex="-1"></a>)</span>
<span id="cb328-9"><a href="lalonde-nsw-data.html#cb328-9" tabindex="-1"></a></span>
<span id="cb328-10"><a href="lalonde-nsw-data.html#cb328-10" tabindex="-1"></a>match_lookup_cps <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb328-11"><a href="lalonde-nsw-data.html#cb328-11" tabindex="-1"></a>        <span class="fu">wrap_match_entries</span>(nn_trim_comb.cps, all_trim.cps, <span class="st">&quot;nn&quot;</span>),</span>
<span id="cb328-12"><a href="lalonde-nsw-data.html#cb328-12" tabindex="-1"></a>        <span class="fu">wrap_match_entries</span>(k2_trim_comb.cps, all_trim.cps, <span class="st">&quot;k2&quot;</span>),</span>
<span id="cb328-13"><a href="lalonde-nsw-data.html#cb328-13" tabindex="-1"></a>        <span class="fu">wrap_match_entries</span>(k3_trim_comb.cps, all_trim.cps, <span class="st">&quot;k3&quot;</span>),</span>
<span id="cb328-14"><a href="lalonde-nsw-data.html#cb328-14" tabindex="-1"></a>        <span class="fu">wrap_match_entries</span>(caliper_trim_comb.cps, all_trim.cps, <span class="st">&quot;caliper&quot;</span>),</span>
<span id="cb328-15"><a href="lalonde-nsw-data.html#cb328-15" tabindex="-1"></a>        <span class="fu">wrap_match_entries</span>(cs_trim_comb.cps, all_trim.cps, <span class="st">&quot;cs&quot;</span>),</span>
<span id="cb328-16"><a href="lalonde-nsw-data.html#cb328-16" tabindex="-1"></a>        <span class="fu">wrap_match_entries</span>(mahvars_trim_comb.cps, all_trim.cps, <span class="st">&quot;mahvars&quot;</span>),</span>
<span id="cb328-17"><a href="lalonde-nsw-data.html#cb328-17" tabindex="-1"></a>        <span class="fu">wrap_match_entries</span>(optimal_pair_trim_comb.cps, all_trim.cps, <span class="st">&quot;optimal_pair&quot;</span>),</span>
<span id="cb328-18"><a href="lalonde-nsw-data.html#cb328-18" tabindex="-1"></a>        <span class="fu">wrap_match_entries</span>(optimal_full_trim_comb.cps, all_trim.cps, <span class="st">&quot;optimal_full&quot;</span>),</span>
<span id="cb328-19"><a href="lalonde-nsw-data.html#cb328-19" tabindex="-1"></a>        <span class="fu">wrap_match_entries</span>(genetic_trim_comb.cps, all_trim.cps, <span class="st">&quot;genetic&quot;</span>),</span>
<span id="cb328-20"><a href="lalonde-nsw-data.html#cb328-20" tabindex="-1"></a>        <span class="fu">wrap_match_entries</span>(exact_trim_comb.cps, all_trim.cps, <span class="st">&quot;exact&quot;</span>),</span>
<span id="cb328-21"><a href="lalonde-nsw-data.html#cb328-21" tabindex="-1"></a>        <span class="fu">wrap_match_entries</span>(cem_trim_comb.cps, all_trim.cps, <span class="st">&quot;cem&quot;</span>),</span>
<span id="cb328-22"><a href="lalonde-nsw-data.html#cb328-22" tabindex="-1"></a>        <span class="fu">wrap_match_entries</span>(subcl_trim_comb.cps, all_trim.cps, <span class="st">&quot;subcl&quot;</span>)</span>
<span id="cb328-23"><a href="lalonde-nsw-data.html#cb328-23" tabindex="-1"></a>)</span>
<span id="cb328-24"><a href="lalonde-nsw-data.html#cb328-24" tabindex="-1"></a></span>
<span id="cb328-25"><a href="lalonde-nsw-data.html#cb328-25" tabindex="-1"></a>trim_only_psid <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb328-26"><a href="lalonde-nsw-data.html#cb328-26" tabindex="-1"></a>        <span class="at">ps_threshold =</span> nsw_psid.ps_trim,</span>
<span id="cb328-27"><a href="lalonde-nsw-data.html#cb328-27" tabindex="-1"></a>        <span class="at">common_range =</span> nsw_psid.ps_common,</span>
<span id="cb328-28"><a href="lalonde-nsw-data.html#cb328-28" tabindex="-1"></a>        <span class="at">stuermer =</span> nsw_psid.ps_stuermer,</span>
<span id="cb328-29"><a href="lalonde-nsw-data.html#cb328-29" tabindex="-1"></a>        <span class="at">walker =</span> nsw_psid.ps_walker,</span>
<span id="cb328-30"><a href="lalonde-nsw-data.html#cb328-30" tabindex="-1"></a>        <span class="at">crump =</span> nsw_psid.ps_crump</span>
<span id="cb328-31"><a href="lalonde-nsw-data.html#cb328-31" tabindex="-1"></a>)</span>
<span id="cb328-32"><a href="lalonde-nsw-data.html#cb328-32" tabindex="-1"></a></span>
<span id="cb328-33"><a href="lalonde-nsw-data.html#cb328-33" tabindex="-1"></a>match_lookup_psid <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb328-34"><a href="lalonde-nsw-data.html#cb328-34" tabindex="-1"></a>        <span class="fu">wrap_match_entries</span>(nn_trim_comb.psid, all_trim.psid, <span class="st">&quot;nn&quot;</span>),</span>
<span id="cb328-35"><a href="lalonde-nsw-data.html#cb328-35" tabindex="-1"></a>        <span class="fu">wrap_match_entries</span>(k2_trim_comb.psid, all_trim.psid, <span class="st">&quot;k2&quot;</span>),</span>
<span id="cb328-36"><a href="lalonde-nsw-data.html#cb328-36" tabindex="-1"></a>        <span class="fu">wrap_match_entries</span>(k3_trim_comb.psid, all_trim.psid, <span class="st">&quot;k3&quot;</span>),</span>
<span id="cb328-37"><a href="lalonde-nsw-data.html#cb328-37" tabindex="-1"></a>        <span class="fu">wrap_match_entries</span>(caliper_trim_comb.psid, all_trim.psid, <span class="st">&quot;caliper&quot;</span>),</span>
<span id="cb328-38"><a href="lalonde-nsw-data.html#cb328-38" tabindex="-1"></a>        <span class="fu">wrap_match_entries</span>(cs_trim_comb.psid, all_trim.psid, <span class="st">&quot;cs&quot;</span>),</span>
<span id="cb328-39"><a href="lalonde-nsw-data.html#cb328-39" tabindex="-1"></a>        <span class="fu">wrap_match_entries</span>(mahvars_trim_comb.psid, all_trim.psid, <span class="st">&quot;mahvars&quot;</span>),</span>
<span id="cb328-40"><a href="lalonde-nsw-data.html#cb328-40" tabindex="-1"></a>        <span class="fu">wrap_match_entries</span>(optimal_pair_trim_comb.psid, all_trim.psid, <span class="st">&quot;optimal_pair&quot;</span>),</span>
<span id="cb328-41"><a href="lalonde-nsw-data.html#cb328-41" tabindex="-1"></a>        <span class="fu">wrap_match_entries</span>(optimal_full_trim_comb.psid, all_trim.psid, <span class="st">&quot;optimal_full&quot;</span>),</span>
<span id="cb328-42"><a href="lalonde-nsw-data.html#cb328-42" tabindex="-1"></a>        <span class="fu">wrap_match_entries</span>(genetic_trim_comb.psid, all_trim.psid, <span class="st">&quot;genetic&quot;</span>),</span>
<span id="cb328-43"><a href="lalonde-nsw-data.html#cb328-43" tabindex="-1"></a>        <span class="fu">wrap_match_entries</span>(exact_trim_comb.psid, all_trim.psid, <span class="st">&quot;exact&quot;</span>),</span>
<span id="cb328-44"><a href="lalonde-nsw-data.html#cb328-44" tabindex="-1"></a>        <span class="fu">wrap_match_entries</span>(cem_trim_comb.psid, all_trim.psid, <span class="st">&quot;cem&quot;</span>),</span>
<span id="cb328-45"><a href="lalonde-nsw-data.html#cb328-45" tabindex="-1"></a>        <span class="fu">wrap_match_entries</span>(subcl_trim_comb.psid, all_trim.psid, <span class="st">&quot;subcl&quot;</span>)</span>
<span id="cb328-46"><a href="lalonde-nsw-data.html#cb328-46" tabindex="-1"></a>)</span>
<span id="cb328-47"><a href="lalonde-nsw-data.html#cb328-47" tabindex="-1"></a></span>
<span id="cb328-48"><a href="lalonde-nsw-data.html#cb328-48" tabindex="-1"></a>list_cps <span class="ot">&lt;-</span> <span class="fu">c</span>(trim_only_cps, match_lookup_cps)</span>
<span id="cb328-49"><a href="lalonde-nsw-data.html#cb328-49" tabindex="-1"></a>list_psid <span class="ot">&lt;-</span> <span class="fu">c</span>(trim_only_psid, match_lookup_psid)</span></code></pre></div>
<div class="sourceCode" id="cb329"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb329-1"><a href="lalonde-nsw-data.html#cb329-1" tabindex="-1"></a><span class="co"># create samples corresponding to the top 5 methods for each sample</span></span>
<span id="cb329-2"><a href="lalonde-nsw-data.html#cb329-2" tabindex="-1"></a>top5_samples.cps <span class="ot">&lt;-</span> <span class="fu">create_top5_samples</span>(list_cps, top5_methods.cps)</span>
<span id="cb329-3"><a href="lalonde-nsw-data.html#cb329-3" tabindex="-1"></a>top5_samples.psid <span class="ot">&lt;-</span> <span class="fu">create_top5_samples</span>(list_psid, top5_methods.psid)</span>
<span id="cb329-4"><a href="lalonde-nsw-data.html#cb329-4" tabindex="-1"></a></span>
<span id="cb329-5"><a href="lalonde-nsw-data.html#cb329-5" tabindex="-1"></a><span class="co"># extract top5 objects</span></span>
<span id="cb329-6"><a href="lalonde-nsw-data.html#cb329-6" tabindex="-1"></a>top5_objects.cps <span class="ot">&lt;-</span> <span class="fu">lapply</span>(top5_methods.cps, <span class="cf">function</span>(m) list_cps[[m]])</span>
<span id="cb329-7"><a href="lalonde-nsw-data.html#cb329-7" tabindex="-1"></a>top5_objects.psid <span class="ot">&lt;-</span> <span class="fu">lapply</span>(top5_methods.psid, <span class="cf">function</span>(m) list_psid[[m]])</span></code></pre></div>
<div class="sourceCode" id="cb330"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb330-1"><a href="lalonde-nsw-data.html#cb330-1" tabindex="-1"></a><span class="co"># save samples into .RData files</span></span>
<span id="cb330-2"><a href="lalonde-nsw-data.html#cb330-2" tabindex="-1"></a><span class="fu">save_top5_samples</span>(list_cps, top5_methods.cps, <span class="at">prefix =</span> <span class="st">&quot;nsw_cps1&quot;</span>)</span>
<span id="cb330-3"><a href="lalonde-nsw-data.html#cb330-3" tabindex="-1"></a><span class="fu">save_top5_samples</span>(list_psid, top5_methods.psid, <span class="at">prefix =</span> <span class="st">&quot;nsw_psid1&quot;</span>)</span></code></pre></div>
</div>
</div>
<div id="estimating-3" class="section level2 hasAnchor" number="4.7">
<h2><span class="header-section-number">4.7</span> Estimating<a href="lalonde-nsw-data.html#estimating-3" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div id="average-treatment-effect-on-the-treated-att-2" class="section level3 hasAnchor" number="4.7.1">
<h3><span class="header-section-number">4.7.1</span> Average treatment effect on the treated (ATT)<a href="lalonde-nsw-data.html#average-treatment-effect-on-the-treated-att-2" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb331"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb331-1"><a href="lalonde-nsw-data.html#cb331-1" tabindex="-1"></a><span class="co"># estimate ATT</span></span>
<span id="cb331-2"><a href="lalonde-nsw-data.html#cb331-2" tabindex="-1"></a>out1 <span class="ot">&lt;-</span> <span class="fu">estimate_all</span>(nsw, <span class="st">&quot;re78&quot;</span>, <span class="st">&quot;treat&quot;</span>, covar)</span>
<span id="cb331-3"><a href="lalonde-nsw-data.html#cb331-3" tabindex="-1"></a>out2 <span class="ot">&lt;-</span> <span class="fu">estimate_all</span>(nsw_cps, <span class="st">&quot;re78&quot;</span>, <span class="st">&quot;treat&quot;</span>, covar)</span>
<span id="cb331-4"><a href="lalonde-nsw-data.html#cb331-4" tabindex="-1"></a>out3 <span class="ot">&lt;-</span> <span class="fu">estimate_all</span>(nsw_psid, <span class="st">&quot;re78&quot;</span>, <span class="st">&quot;treat&quot;</span>, covar)</span></code></pre></div>
<div class="sourceCode" id="cb332"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb332-1"><a href="lalonde-nsw-data.html#cb332-1" tabindex="-1"></a>out.cps <span class="ot">&lt;-</span> <span class="fu">lapply</span>(top5_samples.cps, <span class="cf">function</span>(d) <span class="fu">estimate_all</span>(d, <span class="st">&quot;re78&quot;</span>, <span class="st">&quot;treat&quot;</span>, covar))</span>
<span id="cb332-2"><a href="lalonde-nsw-data.html#cb332-2" tabindex="-1"></a>out.psid <span class="ot">&lt;-</span> <span class="fu">lapply</span>(top5_samples.psid, <span class="cf">function</span>(d) <span class="fu">estimate_all</span>(d, <span class="st">&quot;re78&quot;</span>, <span class="st">&quot;treat&quot;</span>, covar))</span>
<span id="cb332-3"><a href="lalonde-nsw-data.html#cb332-3" tabindex="-1"></a>out.cps_trim <span class="ot">&lt;-</span> <span class="fu">lapply</span>(all_trim.cps, <span class="cf">function</span>(d) <span class="fu">estimate_all</span>(d, <span class="st">&quot;re78&quot;</span>, <span class="st">&quot;treat&quot;</span>, covar))</span>
<span id="cb332-4"><a href="lalonde-nsw-data.html#cb332-4" tabindex="-1"></a>out.psid_trim <span class="ot">&lt;-</span> <span class="fu">lapply</span>(all_trim.psid, <span class="cf">function</span>(d) <span class="fu">estimate_all</span>(d, <span class="st">&quot;re78&quot;</span>, <span class="st">&quot;treat&quot;</span>, covar))</span></code></pre></div>
<div class="sourceCode" id="cb333"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb333-1"><a href="lalonde-nsw-data.html#cb333-1" tabindex="-1"></a>out4 <span class="ot">&lt;-</span> <span class="fu">estimate_all</span>(nsw_trim_cps, <span class="st">&quot;re78&quot;</span>, <span class="st">&quot;treat&quot;</span>, covar)</span>
<span id="cb333-2"><a href="lalonde-nsw-data.html#cb333-2" tabindex="-1"></a>out5 <span class="ot">&lt;-</span> <span class="fu">estimate_all</span>(nsw_trim_psid, <span class="st">&quot;re78&quot;</span>, <span class="st">&quot;treat&quot;</span>, covar)</span>
<span id="cb333-3"><a href="lalonde-nsw-data.html#cb333-3" tabindex="-1"></a>out6 <span class="ot">&lt;-</span> <span class="fu">estimate_all</span>(nsw_cps_trim_match, <span class="st">&quot;re78&quot;</span>, <span class="st">&quot;treat&quot;</span>, covar)</span>
<span id="cb333-4"><a href="lalonde-nsw-data.html#cb333-4" tabindex="-1"></a>out7 <span class="ot">&lt;-</span> <span class="fu">estimate_all</span>(nsw_psid_trim_match, <span class="st">&quot;re78&quot;</span>, <span class="st">&quot;treat&quot;</span>, covar)</span></code></pre></div>
<div class="sourceCode" id="cb334"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb334-1"><a href="lalonde-nsw-data.html#cb334-1" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">4</span>, <span class="dv">1</span>), <span class="at">mar =</span> <span class="fu">c</span>(<span class="dv">4</span>, <span class="dv">4</span>, <span class="dv">2</span>, <span class="dv">1</span>))</span>
<span id="cb334-2"><a href="lalonde-nsw-data.html#cb334-2" tabindex="-1"></a></span>
<span id="cb334-3"><a href="lalonde-nsw-data.html#cb334-3" tabindex="-1"></a><span class="co"># get experimental benchmark</span></span>
<span id="cb334-4"><a href="lalonde-nsw-data.html#cb334-4" tabindex="-1"></a>band.exp <span class="ot">&lt;-</span> out1[<span class="dv">1</span>, <span class="dv">3</span><span class="sc">:</span><span class="dv">4</span>]</span>
<span id="cb334-5"><a href="lalonde-nsw-data.html#cb334-5" tabindex="-1"></a>est.exp  <span class="ot">&lt;-</span> out1[<span class="dv">1</span>, <span class="dv">1</span>]</span>
<span id="cb334-6"><a href="lalonde-nsw-data.html#cb334-6" tabindex="-1"></a></span>
<span id="cb334-7"><a href="lalonde-nsw-data.html#cb334-7" tabindex="-1"></a><span class="co"># plot results</span></span>
<span id="cb334-8"><a href="lalonde-nsw-data.html#cb334-8" tabindex="-1"></a><span class="fu">plot_coef</span>(out1,  <span class="at">band =</span> band.exp, <span class="at">line =</span> est.exp, </span>
<span id="cb334-9"><a href="lalonde-nsw-data.html#cb334-9" tabindex="-1"></a>          <span class="at">ylim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">15500</span>, <span class="dv">5500</span>), <span class="at">main =</span> <span class="st">&quot;(A) NSW-Experimental&quot;</span>)</span>
<span id="cb334-10"><a href="lalonde-nsw-data.html#cb334-10" tabindex="-1"></a></span>
<span id="cb334-11"><a href="lalonde-nsw-data.html#cb334-11" tabindex="-1"></a><span class="fu">plot_coef</span>(out2,  <span class="at">band =</span> band.exp, <span class="at">line =</span> est.exp, </span>
<span id="cb334-12"><a href="lalonde-nsw-data.html#cb334-12" tabindex="-1"></a>          <span class="at">ylim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">15500</span>, <span class="dv">5500</span>), <span class="at">main =</span> <span class="st">&quot;(B) NSW-CPS-1&quot;</span>)</span>
<span id="cb334-13"><a href="lalonde-nsw-data.html#cb334-13" tabindex="-1"></a></span>
<span id="cb334-14"><a href="lalonde-nsw-data.html#cb334-14" tabindex="-1"></a><span class="fu">plot_coef</span>(out3,  <span class="at">band =</span> band.exp, <span class="at">line =</span> est.exp,</span>
<span id="cb334-15"><a href="lalonde-nsw-data.html#cb334-15" tabindex="-1"></a>          <span class="at">ylim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">15500</span>, <span class="dv">5500</span>), <span class="at">main =</span> <span class="st">&quot;(C) NSW-PSID-1&quot;</span>)</span>
<span id="cb334-16"><a href="lalonde-nsw-data.html#cb334-16" tabindex="-1"></a></span>
<span id="cb334-17"><a href="lalonde-nsw-data.html#cb334-17" tabindex="-1"></a><span class="co"># get benchmarks</span></span>
<span id="cb334-18"><a href="lalonde-nsw-data.html#cb334-18" tabindex="-1"></a>method_names_cps <span class="ot">&lt;-</span> <span class="fu">sapply</span>(top5_methods.cps, <span class="cf">function</span>(m) {</span>
<span id="cb334-19"><a href="lalonde-nsw-data.html#cb334-19" tabindex="-1"></a>    matches <span class="ot">&lt;-</span> <span class="fu">names</span>(out.cps_trim)[<span class="fu">sapply</span>(<span class="fu">names</span>(out.cps_trim), <span class="cf">function</span>(n) <span class="fu">grepl</span>(n, m, <span class="at">fixed=</span><span class="cn">TRUE</span>))]</span>
<span id="cb334-20"><a href="lalonde-nsw-data.html#cb334-20" tabindex="-1"></a>    <span class="cf">if</span> (<span class="fu">length</span>(matches) <span class="sc">&gt;</span> <span class="dv">0</span>) matches[<span class="fu">which.max</span>(<span class="fu">nchar</span>(matches))] <span class="cf">else</span> <span class="cn">NA</span> </span>
<span id="cb334-21"><a href="lalonde-nsw-data.html#cb334-21" tabindex="-1"></a>})</span>
<span id="cb334-22"><a href="lalonde-nsw-data.html#cb334-22" tabindex="-1"></a>method_names_psid <span class="ot">&lt;-</span> <span class="fu">sapply</span>(top5_methods.psid, <span class="cf">function</span>(m) {</span>
<span id="cb334-23"><a href="lalonde-nsw-data.html#cb334-23" tabindex="-1"></a>    matches <span class="ot">&lt;-</span> <span class="fu">names</span>(out.cps_trim)[<span class="fu">sapply</span>(<span class="fu">names</span>(out.cps_trim), <span class="cf">function</span>(n) <span class="fu">grepl</span>(n, m, <span class="at">fixed=</span><span class="cn">TRUE</span>))]</span>
<span id="cb334-24"><a href="lalonde-nsw-data.html#cb334-24" tabindex="-1"></a>    <span class="cf">if</span> (<span class="fu">length</span>(matches) <span class="sc">&gt;</span> <span class="dv">0</span>) matches[<span class="fu">which.max</span>(<span class="fu">nchar</span>(matches))] <span class="cf">else</span> <span class="cn">NA</span> </span>
<span id="cb334-25"><a href="lalonde-nsw-data.html#cb334-25" tabindex="-1"></a>})</span>
<span id="cb334-26"><a href="lalonde-nsw-data.html#cb334-26" tabindex="-1"></a></span>
<span id="cb334-27"><a href="lalonde-nsw-data.html#cb334-27" tabindex="-1"></a>band.cps <span class="ot">&lt;-</span> <span class="fu">lapply</span>(method_names_cps, <span class="cf">function</span>(j) out.cps_trim[[j]][<span class="dv">1</span>, <span class="dv">3</span><span class="sc">:</span><span class="dv">4</span>])</span>
<span id="cb334-28"><a href="lalonde-nsw-data.html#cb334-28" tabindex="-1"></a>est.cps  <span class="ot">&lt;-</span> <span class="fu">lapply</span>(method_names_cps, <span class="cf">function</span>(j) out.cps_trim[[j]][<span class="dv">1</span>, <span class="dv">1</span>])</span>
<span id="cb334-29"><a href="lalonde-nsw-data.html#cb334-29" tabindex="-1"></a>band.psid <span class="ot">&lt;-</span> <span class="fu">lapply</span>(method_names_psid, <span class="cf">function</span>(j) out.psid_trim[[j]][<span class="dv">1</span>, <span class="dv">3</span><span class="sc">:</span><span class="dv">4</span>])</span>
<span id="cb334-30"><a href="lalonde-nsw-data.html#cb334-30" tabindex="-1"></a>est.psid  <span class="ot">&lt;-</span> <span class="fu">lapply</span>(method_names_psid, <span class="cf">function</span>(j) out.psid_trim[[j]][<span class="dv">1</span>, <span class="dv">1</span>])</span>
<span id="cb334-31"><a href="lalonde-nsw-data.html#cb334-31" tabindex="-1"></a></span>
<span id="cb334-32"><a href="lalonde-nsw-data.html#cb334-32" tabindex="-1"></a><span class="co"># plot results</span></span>
<span id="cb334-33"><a href="lalonde-nsw-data.html#cb334-33" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="fu">seq_along</span>(out.cps)) {</span>
<span id="cb334-34"><a href="lalonde-nsw-data.html#cb334-34" tabindex="-1"></a>  this_title <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">&quot;(&quot;</span>, LETTERS[i<span class="sc">+</span><span class="dv">3</span>], <span class="st">&quot;) Top CPS-1: &quot;</span>, top5_methods.cps[i])</span>
<span id="cb334-35"><a href="lalonde-nsw-data.html#cb334-35" tabindex="-1"></a>  <span class="fu">plot_coef</span>(out.cps[[i]], <span class="at">band =</span> band.cps[[i]], <span class="at">line =</span> est.cps[[i]],</span>
<span id="cb334-36"><a href="lalonde-nsw-data.html#cb334-36" tabindex="-1"></a>            <span class="at">ylim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">15500</span>, <span class="dv">5500</span>), <span class="at">main =</span> this_title)</span>
<span id="cb334-37"><a href="lalonde-nsw-data.html#cb334-37" tabindex="-1"></a>}</span></code></pre></div>
<div class="figure"><span style="display:block;" id="fig:unnamed-chunk-270-1"></span>
<img src="Outcome-Weights_files/figure-html/unnamed-chunk-270-1.png" alt="FIGUREC2. SubfigureA:NSW-Experimental. SubfigureB:NSW-CPS1. SubfigureC:NSW-PSID1. SubfigureD-H:Top-NSW-CPS1. SubfigureI-M:Top-NSW-PSID1. SubfigureN:NSW-CPS1-PLUS. SubfigureO:NSW-PSID1-PLUS. ATT Estimates Given Unconfoundedness using NSW Samples" width="100%" />
<p class="caption">
Figure 4.6: FIGUREC2. SubfigureA:NSW-Experimental. SubfigureB:NSW-CPS1. SubfigureC:NSW-PSID1. SubfigureD-H:Top-NSW-CPS1. SubfigureI-M:Top-NSW-PSID1. SubfigureN:NSW-CPS1-PLUS. SubfigureO:NSW-PSID1-PLUS. ATT Estimates Given Unconfoundedness using NSW Samples
</p>
</div>
<div class="figure"><span style="display:block;" id="fig:unnamed-chunk-270-2"></span>
<img src="Outcome-Weights_files/figure-html/unnamed-chunk-270-2.png" alt="FIGUREC2. SubfigureA:NSW-Experimental. SubfigureB:NSW-CPS1. SubfigureC:NSW-PSID1. SubfigureD-H:Top-NSW-CPS1. SubfigureI-M:Top-NSW-PSID1. SubfigureN:NSW-CPS1-PLUS. SubfigureO:NSW-PSID1-PLUS. ATT Estimates Given Unconfoundedness using NSW Samples" width="100%" />
<p class="caption">
Figure 4.7: FIGUREC2. SubfigureA:NSW-Experimental. SubfigureB:NSW-CPS1. SubfigureC:NSW-PSID1. SubfigureD-H:Top-NSW-CPS1. SubfigureI-M:Top-NSW-PSID1. SubfigureN:NSW-CPS1-PLUS. SubfigureO:NSW-PSID1-PLUS. ATT Estimates Given Unconfoundedness using NSW Samples
</p>
</div>
<div class="sourceCode" id="cb335"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb335-1"><a href="lalonde-nsw-data.html#cb335-1" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="fu">seq_along</span>(out.psid)) {</span>
<span id="cb335-2"><a href="lalonde-nsw-data.html#cb335-2" tabindex="-1"></a>  this_title <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">&quot;(&quot;</span>, LETTERS[i<span class="sc">+</span><span class="dv">8</span>], <span class="st">&quot;) Top PSID-1: &quot;</span>, top5_methods.psid[i])</span>
<span id="cb335-3"><a href="lalonde-nsw-data.html#cb335-3" tabindex="-1"></a>  <span class="fu">plot_coef</span>(out.psid[[i]], <span class="at">band =</span> band.psid[[i]], <span class="at">line =</span> est.psid[[i]],</span>
<span id="cb335-4"><a href="lalonde-nsw-data.html#cb335-4" tabindex="-1"></a>            <span class="at">ylim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">15500</span>, <span class="dv">5500</span>), <span class="at">main =</span> this_title)</span>
<span id="cb335-5"><a href="lalonde-nsw-data.html#cb335-5" tabindex="-1"></a>}</span></code></pre></div>
<div class="figure"><span style="display:block;" id="fig:unnamed-chunk-270-3"></span>
<img src="Outcome-Weights_files/figure-html/unnamed-chunk-270-3.png" alt="FIGUREC2. SubfigureA:NSW-Experimental. SubfigureB:NSW-CPS1. SubfigureC:NSW-PSID1. SubfigureD-H:Top-NSW-CPS1. SubfigureI-M:Top-NSW-PSID1. SubfigureN:NSW-CPS1-PLUS. SubfigureO:NSW-PSID1-PLUS. ATT Estimates Given Unconfoundedness using NSW Samples" width="100%" />
<p class="caption">
Figure 4.8: FIGUREC2. SubfigureA:NSW-Experimental. SubfigureB:NSW-CPS1. SubfigureC:NSW-PSID1. SubfigureD-H:Top-NSW-CPS1. SubfigureI-M:Top-NSW-PSID1. SubfigureN:NSW-CPS1-PLUS. SubfigureO:NSW-PSID1-PLUS. ATT Estimates Given Unconfoundedness using NSW Samples
</p>
</div>
<div class="sourceCode" id="cb336"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb336-1"><a href="lalonde-nsw-data.html#cb336-1" tabindex="-1"></a><span class="co"># get benchmarks</span></span>
<span id="cb336-2"><a href="lalonde-nsw-data.html#cb336-2" tabindex="-1"></a>band.cps_plus <span class="ot">&lt;-</span> out4[<span class="dv">1</span>, <span class="dv">3</span><span class="sc">:</span><span class="dv">4</span>]</span>
<span id="cb336-3"><a href="lalonde-nsw-data.html#cb336-3" tabindex="-1"></a>est.cps_plus <span class="ot">&lt;-</span> out4[<span class="dv">1</span>, <span class="dv">1</span>]</span>
<span id="cb336-4"><a href="lalonde-nsw-data.html#cb336-4" tabindex="-1"></a>band.psid_plus <span class="ot">&lt;-</span> out5[<span class="dv">1</span>, <span class="dv">3</span><span class="sc">:</span><span class="dv">4</span>]</span>
<span id="cb336-5"><a href="lalonde-nsw-data.html#cb336-5" tabindex="-1"></a>est.psid_plus <span class="ot">&lt;-</span> out5[<span class="dv">1</span>, <span class="dv">1</span>]</span>
<span id="cb336-6"><a href="lalonde-nsw-data.html#cb336-6" tabindex="-1"></a></span>
<span id="cb336-7"><a href="lalonde-nsw-data.html#cb336-7" tabindex="-1"></a><span class="co"># plot results</span></span>
<span id="cb336-8"><a href="lalonde-nsw-data.html#cb336-8" tabindex="-1"></a><span class="fu">plot_coef</span>(out6, <span class="at">band =</span> band.cps_plus, <span class="at">line =</span> est.cps_plus, </span>
<span id="cb336-9"><a href="lalonde-nsw-data.html#cb336-9" tabindex="-1"></a>          <span class="at">ylim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">15500</span>, <span class="dv">5500</span>), <span class="at">main =</span> <span class="st">&quot;(N) Trimmed NSW-CPS-1-PLUS&quot;</span>)</span>
<span id="cb336-10"><a href="lalonde-nsw-data.html#cb336-10" tabindex="-1"></a></span>
<span id="cb336-11"><a href="lalonde-nsw-data.html#cb336-11" tabindex="-1"></a></span>
<span id="cb336-12"><a href="lalonde-nsw-data.html#cb336-12" tabindex="-1"></a><span class="fu">plot_coef</span>(out7, <span class="at">band =</span> band.psid_plus, <span class="at">line =</span> est.psid_plus, </span>
<span id="cb336-13"><a href="lalonde-nsw-data.html#cb336-13" tabindex="-1"></a>          <span class="at">ylim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">15500</span>, <span class="dv">5500</span>), <span class="at">main =</span> <span class="st">&quot;(O) Trimmed NSW-PSID-1-PLUS&quot;</span>)</span></code></pre></div>
<div class="figure"><span style="display:block;" id="fig:unnamed-chunk-270-4"></span>
<img src="Outcome-Weights_files/figure-html/unnamed-chunk-270-4.png" alt="FIGUREC2. SubfigureA:NSW-Experimental. SubfigureB:NSW-CPS1. SubfigureC:NSW-PSID1. SubfigureD-H:Top-NSW-CPS1. SubfigureI-M:Top-NSW-PSID1. SubfigureN:NSW-CPS1-PLUS. SubfigureO:NSW-PSID1-PLUS. ATT Estimates Given Unconfoundedness using NSW Samples" width="100%" />
<p class="caption">
Figure 4.9: FIGUREC2. SubfigureA:NSW-Experimental. SubfigureB:NSW-CPS1. SubfigureC:NSW-PSID1. SubfigureD-H:Top-NSW-CPS1. SubfigureI-M:Top-NSW-PSID1. SubfigureN:NSW-CPS1-PLUS. SubfigureO:NSW-PSID1-PLUS. ATT Estimates Given Unconfoundedness using NSW Samples
</p>
</div>
<div class="sourceCode" id="cb337"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb337-1"><a href="lalonde-nsw-data.html#cb337-1" tabindex="-1"></a><span class="co"># get all outputs</span></span>
<span id="cb337-2"><a href="lalonde-nsw-data.html#cb337-2" tabindex="-1"></a>all_outs <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fu">list</span>(out1, out2, out3), out.cps, out.psid, <span class="fu">list</span>(out6, out7))</span>
<span id="cb337-3"><a href="lalonde-nsw-data.html#cb337-3" tabindex="-1"></a></span>
<span id="cb337-4"><a href="lalonde-nsw-data.html#cb337-4" tabindex="-1"></a><span class="co"># get all plot titles</span></span>
<span id="cb337-5"><a href="lalonde-nsw-data.html#cb337-5" tabindex="-1"></a>all_plot_titles <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;(A) NSW-Experimental&quot;</span>, <span class="st">&quot;(B) NSW-CPS1&quot;</span>, <span class="st">&quot;(C) NSW-PSID1&quot;</span>,</span>
<span id="cb337-6"><a href="lalonde-nsw-data.html#cb337-6" tabindex="-1"></a>                      <span class="fu">paste0</span>(<span class="st">&quot;(&quot;</span>, LETTERS[<span class="dv">4</span><span class="sc">:</span><span class="dv">8</span>], <span class="st">&quot;) Top CPS1: &quot;</span>, top5_methods.cps),</span>
<span id="cb337-7"><a href="lalonde-nsw-data.html#cb337-7" tabindex="-1"></a>                      <span class="fu">paste0</span>(<span class="st">&quot;(&quot;</span>, LETTERS[<span class="dv">9</span><span class="sc">:</span><span class="dv">13</span>], <span class="st">&quot;) Top PSID1: &quot;</span>, top5_methods.psid),</span>
<span id="cb337-8"><a href="lalonde-nsw-data.html#cb337-8" tabindex="-1"></a>                      <span class="st">&quot;(N) Trimmed NSW-CPS1-PLUS&quot;</span>, <span class="st">&quot;(O) Trimmed NSW-PSID1-PLUS&quot;</span>)</span>
<span id="cb337-9"><a href="lalonde-nsw-data.html#cb337-9" tabindex="-1"></a></span>
<span id="cb337-10"><a href="lalonde-nsw-data.html#cb337-10" tabindex="-1"></a><span class="co"># get all confidence interval bounds</span></span>
<span id="cb337-11"><a href="lalonde-nsw-data.html#cb337-11" tabindex="-1"></a>all_bands <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fu">list</span>(band.exp, band.exp, band.exp), band.cps, band.psid, <span class="fu">list</span>(band.cps_plus, band.psid_plus))</span>
<span id="cb337-12"><a href="lalonde-nsw-data.html#cb337-12" tabindex="-1"></a>all_ests <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fu">list</span>(est.exp, est.exp, est.exp), est.cps, est.psid, <span class="fu">list</span>(est.cps_plus, est.psid_plus))</span>
<span id="cb337-13"><a href="lalonde-nsw-data.html#cb337-13" tabindex="-1"></a></span>
<span id="cb337-14"><a href="lalonde-nsw-data.html#cb337-14" tabindex="-1"></a><span class="co"># save results</span></span>
<span id="cb337-15"><a href="lalonde-nsw-data.html#cb337-15" tabindex="-1"></a><span class="fu">save_att_panels</span>(</span>
<span id="cb337-16"><a href="lalonde-nsw-data.html#cb337-16" tabindex="-1"></a>    <span class="at">out_list    =</span> all_outs,</span>
<span id="cb337-17"><a href="lalonde-nsw-data.html#cb337-17" tabindex="-1"></a>    <span class="at">plot_titles =</span> all_plot_titles,</span>
<span id="cb337-18"><a href="lalonde-nsw-data.html#cb337-18" tabindex="-1"></a>    <span class="at">band_list   =</span> all_bands,</span>
<span id="cb337-19"><a href="lalonde-nsw-data.html#cb337-19" tabindex="-1"></a>    <span class="at">est_list    =</span> all_ests,</span>
<span id="cb337-20"><a href="lalonde-nsw-data.html#cb337-20" tabindex="-1"></a>    <span class="at">prefix      =</span> <span class="st">&quot;nsw_est_comb&quot;</span></span>
<span id="cb337-21"><a href="lalonde-nsw-data.html#cb337-21" tabindex="-1"></a>)</span></code></pre></div>
<p>The above figures show the ATT estimates and their 95% confidence intervals for fifteen samples: NSW-Experimental, NSW-CPS-1, NSW-PSID-1, trimmed and matched versions of the NSW-CPS-1-PLUS and NSW-PSID1-PLUS samples (analogous to Imbens &amp; Xu (2024)) and a series of top-ranked samples of both NSW-CPS-1 and NSW-PSID-1 based on various trimming and integrated trimming and matching criteria.</p>
<p>Figure (A) presents the benchmark from the experimental sample (NSW-Experimental), serving as a reference for bias and variance assessment of observational samples. Figures (B) and (C) show results for the observational samples, NSW-CPS-1 and NSW-PSID-1, while figures (N) and (O) present those for the trimmed and matched versions of NSW-CPS-1-PLUS and NSW-PSID-1-PLUS, respectively, replicating the tutorial results of Imbens &amp; Xu (2024). Figures (D) through (H) display results for NSW-CPS1-based samples constructed with the top-ranked methods. Analogously, figures (I) through (M) summarize results for the corresponding NSW-PSID-1-based samples under parallel rules.</p>
<p>The NSW-CPS-1 sample and NSW-PSID-1 sample produce ATT estimates that closely align with the experimental benchmark with an exception for one estimator.</p>
<p>Across the top-ranked samples of NSW-CPS-1, specifically the <code>genetic_crump</code> (E) and <code>cem_crump</code> (D) samples, all estimators produce ATT estimates that closely align with the benchmark, though some estimates are negative. Some larger deviations from the benchmark occur for the <code>optimal_pair_walker</code> (H), <code>nn_walker</code> (G) and <code>k3_walker</code> (F) samples. Nevertheless, these ATT estimates deviate considerably stronger from the benchmark than those obtained under parallel rules within models A and B given LDW data.</p>
<p>In comparison, NSW-PSID-1-based samples exhibit significantly greater deviation and substantially larger standard errors than the NSW-CPS-1-based samples, consistent with previous observations from LDW data. All their ATT estimates remain negatively aligned, reflecting persistent difficulties in improving ATT estimates for the NSW-PSID-1 sample.</p>
<p>Overall, the ATT estimates across all NSW samples follow similar patterns as observed in model A and B given LDW data, yet show a noticeable negative shift.</p>
<div class="sourceCode" id="cb338"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb338-1"><a href="lalonde-nsw-data.html#cb338-1" tabindex="-1"></a><span class="co"># evaluate results</span></span>
<span id="cb338-2"><a href="lalonde-nsw-data.html#cb338-2" tabindex="-1"></a>all_summaries <span class="ot">&lt;-</span> <span class="fu">lapply</span>(all_outs, eval_att)</span>
<span id="cb338-3"><a href="lalonde-nsw-data.html#cb338-3" tabindex="-1"></a>att_summary <span class="ot">&lt;-</span> <span class="fu">do.call</span>(rbind, all_summaries)</span>
<span id="cb338-4"><a href="lalonde-nsw-data.html#cb338-4" tabindex="-1"></a><span class="fu">rownames</span>(att_summary) <span class="ot">&lt;-</span> all_plot_titles</span>
<span id="cb338-5"><a href="lalonde-nsw-data.html#cb338-5" tabindex="-1"></a></span>
<span id="cb338-6"><a href="lalonde-nsw-data.html#cb338-6" tabindex="-1"></a><span class="co"># print table output</span></span>
<span id="cb338-7"><a href="lalonde-nsw-data.html#cb338-7" tabindex="-1"></a><span class="fu">datatable</span>(att_summary, <span class="at">caption =</span> <span class="st">&quot;ATT Summary Statistics&quot;</span>,</span>
<span id="cb338-8"><a href="lalonde-nsw-data.html#cb338-8" tabindex="-1"></a>          <span class="at">options =</span> <span class="fu">list</span>(<span class="at">scrollX =</span> <span class="cn">TRUE</span>, <span class="at">paging =</span> <span class="cn">FALSE</span>, <span class="at">pageLength =</span> <span class="sc">-</span><span class="dv">1</span>, <span class="at">searching =</span> <span class="cn">FALSE</span>))</span></code></pre></div>
<div class="datatables html-widget html-fill-item" id="htmlwidget-e2b5d97e1eec2ab3f9df" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-e2b5d97e1eec2ab3f9df">{"x":{"filter":"none","vertical":false,"caption":"<caption>ATT Summary Statistics<\/caption>","data":[["(A) NSW-Experimental","(B) NSW-CPS1","(C) NSW-PSID1","(D) Top CPS1: cem_crump","(E) Top CPS1: genetic_crump","(F) Top CPS1: k3_walker","(G) Top CPS1: nn_walker","(H) Top CPS1: optimal_pair_walker","(I) Top PSID1: cem_walker","(J) Top PSID1: optimal_pair_walker","(K) Top PSID1: subcl_stuermer","(L) Top PSID1: optimal_full_stuermer","(M) Top PSID1: stuermer","(N) Trimmed NSW-CPS1-PLUS","(O) Trimmed NSW-PSID1-PLUS"],[488.6196444221198,487.698633561054,765.7262048219446,665.3320527304603,674.0642845336057,1120.401742148081,1306.065000279269,1320.144547226485,1384.636706925766,1468.088788556543,1362.308934054704,1388.545244113004,1353.690926689709,557.3479941407548,1186.495137136475],[485.2109333950256,-8870.307626543277,-15577.56889990144,-141.8948337408745,-978.9677031306906,-4481.371211618367,-4185.877915763309,-6215.254767585521,-6498.435488891608,-5502.453670018071,-8250.587385059984,-8250.587385059984,-8250.587385059984,-855.7304280454457,-4531.069578348738],[886.3037224514047,-266.3442967926444,-691.8458957114084,781.2428852306034,667.3437839434951,-3151.276327958663,-2462.446644242847,-3288.575795221257,-4024.554409258761,-3906.857397098287,-5258.004872703552,-5263.546347618103,-5263.546347618103,-115.3250110284576,-3390.077644880927],[401.0927890563791,8603.963329750633,14885.72300419003,923.137718971478,1646.311487074186,1330.094883659704,1723.431271520462,2926.678972364264,2473.881079632847,1595.596272919783,2992.582512356432,2987.041037441881,2987.041037441881,740.4054170169882,1140.991933467811]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>Mean_SE<\/th>\n      <th>Min_Estimate<\/th>\n      <th>Max_Estimate<\/th>\n      <th>Diff_Estimate<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"scrollX":true,"paging":false,"pageLength":-1,"searching":false,"columnDefs":[{"className":"dt-right","targets":[1,2,3,4]},{"orderable":false,"targets":0},{"name":" ","targets":0},{"name":"Mean_SE","targets":1},{"name":"Min_Estimate","targets":2},{"name":"Max_Estimate","targets":3},{"name":"Diff_Estimate","targets":4}],"order":[],"autoWidth":false,"orderClasses":false,"lengthMenu":[-1,10,25,50,100]}},"evals":[],"jsHooks":[]}</script>
<div class="sourceCode" id="cb339"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb339-1"><a href="lalonde-nsw-data.html#cb339-1" tabindex="-1"></a><span class="co"># create result matrix</span></span>
<span id="cb339-2"><a href="lalonde-nsw-data.html#cb339-2" tabindex="-1"></a>out.cps_top <span class="ot">&lt;-</span> <span class="fu">lapply</span>(method_names_cps, <span class="cf">function</span>(j) out.cps_trim[[j]])</span>
<span id="cb339-3"><a href="lalonde-nsw-data.html#cb339-3" tabindex="-1"></a>out.psid_top <span class="ot">&lt;-</span> <span class="fu">lapply</span>(method_names_psid, <span class="cf">function</span>(j) out.psid_trim[[j]])</span>
<span id="cb339-4"><a href="lalonde-nsw-data.html#cb339-4" tabindex="-1"></a>all_out_mat <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fu">list</span>(out1), out.cps_top, out.psid_top, <span class="fu">list</span>(out4, out5))</span>
<span id="cb339-5"><a href="lalonde-nsw-data.html#cb339-5" tabindex="-1"></a>result_mat <span class="ot">&lt;-</span> <span class="fu">create_matrix_results</span>(all_outs, all_out_mat, all_plot_titles)</span>
<span id="cb339-6"><a href="lalonde-nsw-data.html#cb339-6" tabindex="-1"></a></span>
<span id="cb339-7"><a href="lalonde-nsw-data.html#cb339-7" tabindex="-1"></a><span class="co"># print table output</span></span>
<span id="cb339-8"><a href="lalonde-nsw-data.html#cb339-8" tabindex="-1"></a><span class="fu">datatable</span>(result_mat, <span class="at">caption =</span> <span class="st">&quot;ATT Estimates and SEs&quot;</span>,</span>
<span id="cb339-9"><a href="lalonde-nsw-data.html#cb339-9" tabindex="-1"></a>          <span class="at">options =</span> <span class="fu">list</span>(<span class="at">scrollX =</span> <span class="cn">TRUE</span>, <span class="at">paging =</span> <span class="cn">FALSE</span>, <span class="at">pageLength =</span> <span class="sc">-</span><span class="dv">1</span>, <span class="at">searching =</span> <span class="cn">FALSE</span>))</span></code></pre></div>
<div class="datatables html-widget html-fill-item" id="htmlwidget-50ba1a1db363d34ad0c8" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-50ba1a1db363d34ad0c8">{"x":{"filter":"none","vertical":false,"caption":"<caption>ATT Estimates and SEs<\/caption>","data":[["Experimental Benchmark","diff","reg","om.reg","om.grf","matching","psm","ipw","cbps","ebal","dml","aipw_grf","aipw_ow"],["886.30","886.30","812.52","854.16","839.13","776.30","485.21","816.41","852.06","850.96","853.87","855.58","877.36"],["(488.14)","(488.14)","(485.60)","(413.47)","(408.30)","(553.82)","(533.70)","(500.17)","(495.44)","(495.52)","(487.71)","(499.08)","(502.50)"],["886.30","-8870.31","-792.15","-726.42","-969.43","-290.38","-374.13","-552.85","-566.41","-566.82","-1477.44","-266.34","-374.41"],["(488.14)","(408.30)","(479.67)","(462.50)","(451.72)","(585.14)","(545.22)","(485.11)","(476.37)","(476.39)","(465.36)","(512.48)","(504.11)"],["886.30","-15577.57","-1581.11","-1215.01","-2823.28","-1122.98","-1832.89","-2027.40","-718.81","-691.85","-2196.75","-1799.75","-1691.75"],["(488.14)","(508.12)","(718.80)","(481.08)","(454.43)","(1210.25)","(734.81)","(973.28)","(888.13)","(889.21)","(683.50)","(873.71)","(773.39)"],["-923.97","-140.47","190.17","472.84","435.54","781.24","94.28","744.96","744.96","475.50","-141.89","550.93","527.21"],["(554.49)","(656.26)","(641.12)","(536.58)","(521.08)","(716.32)","(716.64)","(771.60)","(771.60)","(654.18)","(655.35)","(666.87)","(676.37)"],["-923.97","102.76","385.10","475.67","430.57","667.34","-978.97","340.25","340.25","476.33","45.79","428.07","200.59"],["(554.49)","(696.21)","(667.05)","(497.38)","(485.53)","(815.54)","(650.61)","(756.55)","(756.55)","(677.48)","(688.79)","(674.18)","(722.90)"],["-3258.75","-4433.57","-3945.47","-3715.14","-3309.79","-3650.92","-4481.37","-4185.39","-4185.39","-3688.57","-4472.77","-3151.28","-3152.25"],["(827.75)","(1039.25)","(1111.13)","(1181.76)","(1044.46)","(1410.58)","(1289.00)","(1033.77)","(1033.77)","(1040.24)","(1032.30)","(1073.35)","(1155.21)"],["-3258.75","-3991.60","-3540.45","-3140.07","-2794.39","-3567.86","-3803.35","-3869.31","-3869.31","-3137.78","-4185.88","-2592.28","-2462.45"],["(827.75)","(1353.59)","(1265.37)","(1199.20)","(1013.05)","(1578.12)","(1286.30)","(1341.71)","(1341.71)","(1330.22)","(1342.93)","(1333.53)","(1287.05)"],["-3258.75","-4306.49","-3942.20","-3542.00","-3505.17","-4200.19","-6215.25","-4306.49","-4306.49","-3523.50","-4356.75","-3557.39","-3288.58"],["(827.75)","(1326.76)","(1268.86)","(1214.52)","(973.07)","(1655.28)","(1421.83)","(1326.76)","(1326.76)","(1316.98)","(1295.59)","(1363.61)","(1351.73)"],["-7095.39","-5945.96","-5362.30","-5436.88","-5699.50","-4024.55","-6498.44","-5372.67","-5372.67","-5650.71","-5789.04","-5498.54","-5978.39"],["(740.86)","(1327.39)","(1379.80)","(1179.06)","(1047.45)","(1391.50)","(1349.20)","(1557.17)","(1557.17)","(1630.04)","(1337.54)","(1399.71)","(1459.60)"],["-7095.39","-4170.14","-3945.79","-3920.45","-4243.07","-5502.45","-4980.77","-4170.14","-4170.14","-3906.86","-4091.70","-4710.16","-3912.87"],["(740.86)","(1445.75)","(1503.65)","(786.12)","(633.77)","(1772.23)","(1591.36)","(1445.75)","(1445.75)","(1611.61)","(1449.52)","(2213.23)","(1718.32)"],["-6492.78","-6492.78","-7633.86","-7882.69","-7776.57","-7947.96","-5258.00","-7228.67","-7228.67","-7761.73","-6860.36","-7831.78","-8250.59"],["(1037.70)","(1037.70)","(1480.74)","(1674.56)","(1335.00)","(1870.22)","(1759.86)","(1105.74)","(1105.74)","(1096.15)","(1150.17)","(1313.93)","(1417.91)"],["-6492.78","-6492.78","-7633.86","-7882.69","-7728.21","-7947.96","-5263.55","-6833.09","-6833.09","-7761.73","-6860.36","-7831.78","-8250.59"],["(1037.70)","(1037.70)","(1480.74)","(1674.56)","(1332.20)","(1870.22)","(1759.62)","(1264.67)","(1264.67)","(1096.15)","(1150.17)","(1313.93)","(1417.91)"],["-6492.78","-6492.78","-7633.86","-7882.69","-7728.21","-7947.96","-5263.55","-7074.64","-7731.08","-7761.73","-6860.36","-7831.78","-8250.59"],["(1037.70)","(1037.70)","(1480.74)","(1674.56)","(1332.20)","(1870.22)","(1759.62)","(1023.37)","(1087.73)","(1096.15)","(1150.17)","(1313.93)","(1417.91)"],["771.48","-519.65","-336.84","-323.38","-230.93","-115.33","-855.73","-399.70","-310.73","-310.83","-516.31","-265.19","-247.39"],["(488.82)","(578.61)","(552.46)","(461.86)","(438.23)","(637.40)","(606.82)","(571.92)","(578.63)","(578.64)","(569.48)","(553.21)","(560.93)"],["690.22","-3569.56","-3579.07","-3476.55","-3810.59","-4531.07","-4498.77","-4280.99","-3403.78","-3390.08","-3770.37","-4328.45","-3903.01"],["(678.86)","(1138.75)","(1270.85)","(644.84)","(548.81)","(1382.58)","(1142.52)","(1427.67)","(1336.51)","(1355.57)","(1163.15)","(1576.70)","(1249.99)"]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>(A) NSW-Experimental<\/th>\n      <th>V2<\/th>\n      <th>(B) NSW-CPS1<\/th>\n      <th>V4<\/th>\n      <th>(C) NSW-PSID1<\/th>\n      <th>V6<\/th>\n      <th>(D) Top CPS1: cem_crump<\/th>\n      <th>V8<\/th>\n      <th>(E) Top CPS1: genetic_crump<\/th>\n      <th>V10<\/th>\n      <th>(F) Top CPS1: k3_walker<\/th>\n      <th>V12<\/th>\n      <th>(G) Top CPS1: nn_walker<\/th>\n      <th>V14<\/th>\n      <th>(H) Top CPS1: optimal_pair_walker<\/th>\n      <th>V16<\/th>\n      <th>(I) Top PSID1: cem_walker<\/th>\n      <th>V18<\/th>\n      <th>(J) Top PSID1: optimal_pair_walker<\/th>\n      <th>V20<\/th>\n      <th>(K) Top PSID1: subcl_stuermer<\/th>\n      <th>V22<\/th>\n      <th>(L) Top PSID1: optimal_full_stuermer<\/th>\n      <th>V24<\/th>\n      <th>(M) Top PSID1: stuermer<\/th>\n      <th>V26<\/th>\n      <th>(N) Trimmed NSW-CPS1-PLUS<\/th>\n      <th>V28<\/th>\n      <th>(O) Trimmed NSW-PSID1-PLUS<\/th>\n      <th>V30<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"scrollX":true,"paging":false,"pageLength":-1,"searching":false,"columnDefs":[{"orderable":false,"targets":0},{"name":" ","targets":0},{"name":"(A) NSW-Experimental","targets":1},{"name":"V2","targets":2},{"name":"(B) NSW-CPS1","targets":3},{"name":"V4","targets":4},{"name":"(C) NSW-PSID1","targets":5},{"name":"V6","targets":6},{"name":"(D) Top CPS1: cem_crump","targets":7},{"name":"V8","targets":8},{"name":"(E) Top CPS1: genetic_crump","targets":9},{"name":"V10","targets":10},{"name":"(F) Top CPS1: k3_walker","targets":11},{"name":"V12","targets":12},{"name":"(G) Top CPS1: nn_walker","targets":13},{"name":"V14","targets":14},{"name":"(H) Top CPS1: optimal_pair_walker","targets":15},{"name":"V16","targets":16},{"name":"(I) Top PSID1: cem_walker","targets":17},{"name":"V18","targets":18},{"name":"(J) Top PSID1: optimal_pair_walker","targets":19},{"name":"V20","targets":20},{"name":"(K) Top PSID1: subcl_stuermer","targets":21},{"name":"V22","targets":22},{"name":"(L) Top PSID1: optimal_full_stuermer","targets":23},{"name":"V24","targets":24},{"name":"(M) Top PSID1: stuermer","targets":25},{"name":"V26","targets":26},{"name":"(N) Trimmed NSW-CPS1-PLUS","targets":27},{"name":"V28","targets":28},{"name":"(O) Trimmed NSW-PSID1-PLUS","targets":29},{"name":"V30","targets":30}],"order":[],"autoWidth":false,"orderClasses":false,"lengthMenu":[-1,10,25,50,100]}},"evals":[],"jsHooks":[]}</script>
<p>The tabulated results confirm visual patterns: Column (A) reports the estimates for the NSW-Experimental sample, column (B) for the NSW-CPS-1 sample, and column (C) for the NSW-PSID-1 sample. Columns (D)-(M) summarize results for the top-ranked samples for both NSW-CPS-1 and NSW-PSID1. Columns (N) and (O) report results for the trimmed and matched versions of NSW-CPS-1-PLUS and NSW-PSID-1-PLUS sample, respectively.</p>
<p>Specifically, for most NSW-CPS-1-based samples, ATT estimates remain negative. The sample <code>genetic_crump</code> (E) and <code>cem_crump</code> (D) exhibit frequently positive estimates and are relatively close to the benchmark. In contrast, the for the NSW-PSID-1-based samples, the ATT estimates exhibit larger negative magnitudes, and increased standard errors, underscoring the heightened difficulty of achieving consistent ATT effect estimates in this observational sample.</p>
<p>Overall, consistent with findings from models A and B, figures and table jointly demonstrate that ATT estimates from observational samples tend to have larger standard errors compared to the experimental sample, reflecting greater statistical uncertainty in non-experimental causal effect estimation, and that certain methods can bring observational estimates closer to the benchmark.</p>
<div class="sourceCode" id="cb340"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb340-1"><a href="lalonde-nsw-data.html#cb340-1" tabindex="-1"></a><span class="co"># save results </span></span>
<span id="cb340-2"><a href="lalonde-nsw-data.html#cb340-2" tabindex="-1"></a><span class="fu">save_csv</span>(result_mat, <span class="st">&quot;nsw_att_estimates&quot;</span>)</span></code></pre></div>
</div>
<div id="conditional-average-treatment-effect-on-the-treated-catt-3" class="section level3 hasAnchor" number="4.7.2">
<h3><span class="header-section-number">4.7.2</span> Conditional average treatment effect on the treated (CATT)<a href="lalonde-nsw-data.html#conditional-average-treatment-effect-on-the-treated-catt-3" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb341"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb341-1"><a href="lalonde-nsw-data.html#cb341-1" tabindex="-1"></a><span class="co"># estimate CATT</span></span>
<span id="cb341-2"><a href="lalonde-nsw-data.html#cb341-2" tabindex="-1"></a>catt.nsw <span class="ot">&lt;-</span> <span class="fu">catt</span>(nsw, Y, treat, covar)</span>
<span id="cb341-3"><a href="lalonde-nsw-data.html#cb341-3" tabindex="-1"></a>catt.cps <span class="ot">&lt;-</span> <span class="fu">catt</span>(nsw_cps, Y, treat, covar)</span>
<span id="cb341-4"><a href="lalonde-nsw-data.html#cb341-4" tabindex="-1"></a>catt.psid <span class="ot">&lt;-</span> <span class="fu">catt</span>(nsw_psid, Y, treat, covar)</span>
<span id="cb341-5"><a href="lalonde-nsw-data.html#cb341-5" tabindex="-1"></a>catt.top5_cps <span class="ot">&lt;-</span> <span class="fu">lapply</span>(top5_samples.cps, <span class="cf">function</span>(d) <span class="fu">catt</span>(d, Y, treat, covar))</span>
<span id="cb341-6"><a href="lalonde-nsw-data.html#cb341-6" tabindex="-1"></a>catt.top5_psid <span class="ot">&lt;-</span> <span class="fu">lapply</span>(top5_samples.psid, <span class="cf">function</span>(d) <span class="fu">catt</span>(d, Y, treat, covar))</span>
<span id="cb341-7"><a href="lalonde-nsw-data.html#cb341-7" tabindex="-1"></a>catt.top5_cps_trim <span class="ot">&lt;-</span> <span class="fu">lapply</span>(all_trim.cps, <span class="cf">function</span>(d) <span class="fu">catt</span>(d, Y, treat, covar))</span>
<span id="cb341-8"><a href="lalonde-nsw-data.html#cb341-8" tabindex="-1"></a>catt.top5_psid_trim <span class="ot">&lt;-</span> <span class="fu">lapply</span>(all_trim.psid, <span class="cf">function</span>(d) <span class="fu">catt</span>(d, Y, treat, covar))</span></code></pre></div>
<div class="sourceCode" id="cb342"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb342-1"><a href="lalonde-nsw-data.html#cb342-1" tabindex="-1"></a>catt.cps.trim <span class="ot">&lt;-</span> <span class="fu">catt</span>(nsw_cps_trim_match, Y, treat, covar)</span>
<span id="cb342-2"><a href="lalonde-nsw-data.html#cb342-2" tabindex="-1"></a>catt.psid.trim <span class="ot">&lt;-</span> <span class="fu">catt</span>(nsw_psid_trim_match, Y, treat, covar)</span>
<span id="cb342-3"><a href="lalonde-nsw-data.html#cb342-3" tabindex="-1"></a>catt.nsw.cps <span class="ot">&lt;-</span> <span class="fu">catt</span>(nsw_trim_cps, Y, treat, covar)</span>
<span id="cb342-4"><a href="lalonde-nsw-data.html#cb342-4" tabindex="-1"></a>catt.nsw.psid <span class="ot">&lt;-</span> <span class="fu">catt</span>(nsw_trim_psid, Y, treat, covar)</span></code></pre></div>
<div class="sourceCode" id="cb343"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb343-1"><a href="lalonde-nsw-data.html#cb343-1" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">2</span>)) </span>
<span id="cb343-2"><a href="lalonde-nsw-data.html#cb343-2" tabindex="-1"></a><span class="fu">par</span>(<span class="at">cex.main =</span> <span class="fl">0.9</span>)</span>
<span id="cb343-3"><a href="lalonde-nsw-data.html#cb343-3" tabindex="-1"></a></span>
<span id="cb343-4"><a href="lalonde-nsw-data.html#cb343-4" tabindex="-1"></a><span class="co"># plot results</span></span>
<span id="cb343-5"><a href="lalonde-nsw-data.html#cb343-5" tabindex="-1"></a><span class="fu">plot_catt</span>(</span>
<span id="cb343-6"><a href="lalonde-nsw-data.html#cb343-6" tabindex="-1"></a>  <span class="at">catt1 =</span> catt.nsw<span class="sc">$</span>catt,</span>
<span id="cb343-7"><a href="lalonde-nsw-data.html#cb343-7" tabindex="-1"></a>  <span class="at">catt2 =</span> catt.cps<span class="sc">$</span>catt,</span>
<span id="cb343-8"><a href="lalonde-nsw-data.html#cb343-8" tabindex="-1"></a>  <span class="at">att1  =</span> catt.nsw<span class="sc">$</span>att[<span class="dv">1</span>],</span>
<span id="cb343-9"><a href="lalonde-nsw-data.html#cb343-9" tabindex="-1"></a>  <span class="at">att2  =</span> catt.cps<span class="sc">$</span>att[<span class="dv">1</span>],</span>
<span id="cb343-10"><a href="lalonde-nsw-data.html#cb343-10" tabindex="-1"></a>  <span class="at">xlab  =</span> <span class="st">&quot;CATT (Experimental)&quot;</span>,</span>
<span id="cb343-11"><a href="lalonde-nsw-data.html#cb343-11" tabindex="-1"></a>  <span class="at">ylab  =</span> <span class="st">&quot;CATT (CPS-1)&quot;</span>,</span>
<span id="cb343-12"><a href="lalonde-nsw-data.html#cb343-12" tabindex="-1"></a>  <span class="at">main  =</span> <span class="st">&quot;(B) NSW-CPS-1&quot;</span>, </span>
<span id="cb343-13"><a href="lalonde-nsw-data.html#cb343-13" tabindex="-1"></a>  <span class="at">axes.range =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">8000</span>, <span class="dv">8000</span>)</span>
<span id="cb343-14"><a href="lalonde-nsw-data.html#cb343-14" tabindex="-1"></a>)</span>
<span id="cb343-15"><a href="lalonde-nsw-data.html#cb343-15" tabindex="-1"></a></span>
<span id="cb343-16"><a href="lalonde-nsw-data.html#cb343-16" tabindex="-1"></a><span class="fu">plot_catt</span>(</span>
<span id="cb343-17"><a href="lalonde-nsw-data.html#cb343-17" tabindex="-1"></a>  <span class="at">catt1 =</span> catt.nsw<span class="sc">$</span>catt,</span>
<span id="cb343-18"><a href="lalonde-nsw-data.html#cb343-18" tabindex="-1"></a>  <span class="at">catt2 =</span> catt.psid<span class="sc">$</span>catt,</span>
<span id="cb343-19"><a href="lalonde-nsw-data.html#cb343-19" tabindex="-1"></a>  <span class="at">att1  =</span> catt.nsw<span class="sc">$</span>att[<span class="dv">1</span>],</span>
<span id="cb343-20"><a href="lalonde-nsw-data.html#cb343-20" tabindex="-1"></a>  <span class="at">att2  =</span> catt.psid<span class="sc">$</span>att[<span class="dv">1</span>],</span>
<span id="cb343-21"><a href="lalonde-nsw-data.html#cb343-21" tabindex="-1"></a>  <span class="at">xlab  =</span> <span class="st">&quot;CATT (Experimental)&quot;</span>,</span>
<span id="cb343-22"><a href="lalonde-nsw-data.html#cb343-22" tabindex="-1"></a>  <span class="at">ylab  =</span> <span class="st">&quot;CATT (PSID-1)&quot;</span>,</span>
<span id="cb343-23"><a href="lalonde-nsw-data.html#cb343-23" tabindex="-1"></a>  <span class="at">main  =</span> <span class="st">&quot;(C) NSW-PSID-1&quot;</span>,</span>
<span id="cb343-24"><a href="lalonde-nsw-data.html#cb343-24" tabindex="-1"></a>  <span class="at">axes.range =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">8000</span>, <span class="dv">8000</span>)</span>
<span id="cb343-25"><a href="lalonde-nsw-data.html#cb343-25" tabindex="-1"></a>)</span>
<span id="cb343-26"><a href="lalonde-nsw-data.html#cb343-26" tabindex="-1"></a></span>
<span id="cb343-27"><a href="lalonde-nsw-data.html#cb343-27" tabindex="-1"></a><span class="fu">plot_catt_panels</span>(</span>
<span id="cb343-28"><a href="lalonde-nsw-data.html#cb343-28" tabindex="-1"></a>  <span class="at">exp_catt =</span> catt.top5_cps_trim,</span>
<span id="cb343-29"><a href="lalonde-nsw-data.html#cb343-29" tabindex="-1"></a>  <span class="at">catt_list  =</span> catt.top5_cps,</span>
<span id="cb343-30"><a href="lalonde-nsw-data.html#cb343-30" tabindex="-1"></a>  <span class="at">plot_titles =</span> <span class="fu">paste0</span>(<span class="st">&quot;(&quot;</span>, LETTERS[<span class="dv">4</span><span class="sc">:</span><span class="dv">8</span>], <span class="st">&quot;) Top CPS-1: &quot;</span>, top5_methods.cps)</span>
<span id="cb343-31"><a href="lalonde-nsw-data.html#cb343-31" tabindex="-1"></a>)</span></code></pre></div>
<div class="figure"><span style="display:block;" id="fig:unnamed-chunk-277-1"></span>
<img src="Outcome-Weights_files/figure-html/unnamed-chunk-277-1.png" alt="FIGUREC3. SubfigureB:NSW-CPS-1. SubfigureC:NSW-PSID-1. SubfigureD-H:Top-NSW-CPS-1. SubfigureI-M:Top-NSW-PSID-1. SubfigureN:NSW-CPS-1-PLUS. SubfigureO:NSW-PSID-1-PLUS. CATT Estimates using NSW Data: Experimental vs. Nonexperimental" width="100%" />
<p class="caption">
Figure 4.10: FIGUREC3. SubfigureB:NSW-CPS-1. SubfigureC:NSW-PSID-1. SubfigureD-H:Top-NSW-CPS-1. SubfigureI-M:Top-NSW-PSID-1. SubfigureN:NSW-CPS-1-PLUS. SubfigureO:NSW-PSID-1-PLUS. CATT Estimates using NSW Data: Experimental vs. Nonexperimental
</p>
</div>
<div class="figure"><span style="display:block;" id="fig:unnamed-chunk-277-2"></span>
<img src="Outcome-Weights_files/figure-html/unnamed-chunk-277-2.png" alt="FIGUREC3. SubfigureB:NSW-CPS-1. SubfigureC:NSW-PSID-1. SubfigureD-H:Top-NSW-CPS-1. SubfigureI-M:Top-NSW-PSID-1. SubfigureN:NSW-CPS-1-PLUS. SubfigureO:NSW-PSID-1-PLUS. CATT Estimates using NSW Data: Experimental vs. Nonexperimental" width="100%" />
<p class="caption">
Figure 4.11: FIGUREC3. SubfigureB:NSW-CPS-1. SubfigureC:NSW-PSID-1. SubfigureD-H:Top-NSW-CPS-1. SubfigureI-M:Top-NSW-PSID-1. SubfigureN:NSW-CPS-1-PLUS. SubfigureO:NSW-PSID-1-PLUS. CATT Estimates using NSW Data: Experimental vs. Nonexperimental
</p>
</div>
<div class="sourceCode" id="cb344"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb344-1"><a href="lalonde-nsw-data.html#cb344-1" tabindex="-1"></a><span class="fu">plot_catt_panels</span>(</span>
<span id="cb344-2"><a href="lalonde-nsw-data.html#cb344-2" tabindex="-1"></a>  <span class="at">exp_catt =</span> catt.top5_psid_trim,</span>
<span id="cb344-3"><a href="lalonde-nsw-data.html#cb344-3" tabindex="-1"></a>  <span class="at">catt_list  =</span> catt.top5_psid,</span>
<span id="cb344-4"><a href="lalonde-nsw-data.html#cb344-4" tabindex="-1"></a>  <span class="at">plot_titles =</span> <span class="fu">paste0</span>(<span class="st">&quot;(&quot;</span>, LETTERS[<span class="dv">9</span><span class="sc">:</span><span class="dv">13</span>], <span class="st">&quot;) Top PSID-1: &quot;</span>, top5_methods.psid)</span>
<span id="cb344-5"><a href="lalonde-nsw-data.html#cb344-5" tabindex="-1"></a>)</span></code></pre></div>
<div class="figure"><span style="display:block;" id="fig:unnamed-chunk-277-3"></span>
<img src="Outcome-Weights_files/figure-html/unnamed-chunk-277-3.png" alt="FIGUREC3. SubfigureB:NSW-CPS-1. SubfigureC:NSW-PSID-1. SubfigureD-H:Top-NSW-CPS-1. SubfigureI-M:Top-NSW-PSID-1. SubfigureN:NSW-CPS-1-PLUS. SubfigureO:NSW-PSID-1-PLUS. CATT Estimates using NSW Data: Experimental vs. Nonexperimental" width="100%" />
<p class="caption">
Figure 4.12: FIGUREC3. SubfigureB:NSW-CPS-1. SubfigureC:NSW-PSID-1. SubfigureD-H:Top-NSW-CPS-1. SubfigureI-M:Top-NSW-PSID-1. SubfigureN:NSW-CPS-1-PLUS. SubfigureO:NSW-PSID-1-PLUS. CATT Estimates using NSW Data: Experimental vs. Nonexperimental
</p>
</div>
<div class="figure"><span style="display:block;" id="fig:unnamed-chunk-277-4"></span>
<img src="Outcome-Weights_files/figure-html/unnamed-chunk-277-4.png" alt="FIGUREC3. SubfigureB:NSW-CPS-1. SubfigureC:NSW-PSID-1. SubfigureD-H:Top-NSW-CPS-1. SubfigureI-M:Top-NSW-PSID-1. SubfigureN:NSW-CPS-1-PLUS. SubfigureO:NSW-PSID-1-PLUS. CATT Estimates using NSW Data: Experimental vs. Nonexperimental" width="100%" />
<p class="caption">
Figure 4.13: FIGUREC3. SubfigureB:NSW-CPS-1. SubfigureC:NSW-PSID-1. SubfigureD-H:Top-NSW-CPS-1. SubfigureI-M:Top-NSW-PSID-1. SubfigureN:NSW-CPS-1-PLUS. SubfigureO:NSW-PSID-1-PLUS. CATT Estimates using NSW Data: Experimental vs. Nonexperimental
</p>
</div>
<div class="sourceCode" id="cb345"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb345-1"><a href="lalonde-nsw-data.html#cb345-1" tabindex="-1"></a><span class="fu">plot_catt</span>(</span>
<span id="cb345-2"><a href="lalonde-nsw-data.html#cb345-2" tabindex="-1"></a>  catt1 <span class="ot">&lt;-</span> catt.nsw.cps<span class="sc">$</span>catt,</span>
<span id="cb345-3"><a href="lalonde-nsw-data.html#cb345-3" tabindex="-1"></a>  catt2 <span class="ot">&lt;-</span> catt.cps.trim<span class="sc">$</span>catt,</span>
<span id="cb345-4"><a href="lalonde-nsw-data.html#cb345-4" tabindex="-1"></a>  att1 <span class="ot">&lt;-</span> catt.nsw.cps<span class="sc">$</span>att[<span class="dv">1</span>],</span>
<span id="cb345-5"><a href="lalonde-nsw-data.html#cb345-5" tabindex="-1"></a>  att2 <span class="ot">&lt;-</span> catt.cps.trim<span class="sc">$</span>att[<span class="dv">1</span>],</span>
<span id="cb345-6"><a href="lalonde-nsw-data.html#cb345-6" tabindex="-1"></a>  <span class="at">xlab  =</span> <span class="st">&quot;CATT (Experimental)&quot;</span>,</span>
<span id="cb345-7"><a href="lalonde-nsw-data.html#cb345-7" tabindex="-1"></a>  <span class="at">ylab  =</span> <span class="st">&quot;CATT (CPS-1-PLUS-Trimmed)&quot;</span>,</span>
<span id="cb345-8"><a href="lalonde-nsw-data.html#cb345-8" tabindex="-1"></a>  <span class="at">main  =</span> <span class="st">&quot;(N) Trimmed NSW-CPS-1-PLUS&quot;</span>, </span>
<span id="cb345-9"><a href="lalonde-nsw-data.html#cb345-9" tabindex="-1"></a>  <span class="at">axes.range =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">8000</span>, <span class="dv">8000</span>)</span>
<span id="cb345-10"><a href="lalonde-nsw-data.html#cb345-10" tabindex="-1"></a>)</span>
<span id="cb345-11"><a href="lalonde-nsw-data.html#cb345-11" tabindex="-1"></a></span>
<span id="cb345-12"><a href="lalonde-nsw-data.html#cb345-12" tabindex="-1"></a><span class="fu">plot_catt</span>(</span>
<span id="cb345-13"><a href="lalonde-nsw-data.html#cb345-13" tabindex="-1"></a>  catt1 <span class="ot">&lt;-</span> catt.nsw.psid<span class="sc">$</span>catt,</span>
<span id="cb345-14"><a href="lalonde-nsw-data.html#cb345-14" tabindex="-1"></a>  catt2 <span class="ot">&lt;-</span> catt.psid.trim<span class="sc">$</span>catt,</span>
<span id="cb345-15"><a href="lalonde-nsw-data.html#cb345-15" tabindex="-1"></a>  att1 <span class="ot">&lt;-</span> catt.nsw.psid<span class="sc">$</span>att[<span class="dv">1</span>],</span>
<span id="cb345-16"><a href="lalonde-nsw-data.html#cb345-16" tabindex="-1"></a>  att2 <span class="ot">&lt;-</span> catt.psid.trim<span class="sc">$</span>att[<span class="dv">1</span>],</span>
<span id="cb345-17"><a href="lalonde-nsw-data.html#cb345-17" tabindex="-1"></a>  <span class="at">xlab  =</span> <span class="st">&quot;CATT (Experimental)&quot;</span>,</span>
<span id="cb345-18"><a href="lalonde-nsw-data.html#cb345-18" tabindex="-1"></a>  <span class="at">ylab  =</span> <span class="st">&quot;CATT (PSID-1-PLUS-Trimmed)&quot;</span>,</span>
<span id="cb345-19"><a href="lalonde-nsw-data.html#cb345-19" tabindex="-1"></a>  <span class="at">main  =</span> <span class="st">&quot;(O) Trimmed NSW-PSID-1-PLUS&quot;</span>,</span>
<span id="cb345-20"><a href="lalonde-nsw-data.html#cb345-20" tabindex="-1"></a>  <span class="at">axes.range =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">8000</span>, <span class="dv">8000</span>)</span>
<span id="cb345-21"><a href="lalonde-nsw-data.html#cb345-21" tabindex="-1"></a>)</span></code></pre></div>
<div class="figure"><span style="display:block;" id="fig:unnamed-chunk-277-5"></span>
<img src="Outcome-Weights_files/figure-html/unnamed-chunk-277-5.png" alt="FIGUREC3. SubfigureB:NSW-CPS-1. SubfigureC:NSW-PSID-1. SubfigureD-H:Top-NSW-CPS-1. SubfigureI-M:Top-NSW-PSID-1. SubfigureN:NSW-CPS-1-PLUS. SubfigureO:NSW-PSID-1-PLUS. CATT Estimates using NSW Data: Experimental vs. Nonexperimental" width="100%" />
<p class="caption">
Figure 4.14: FIGUREC3. SubfigureB:NSW-CPS-1. SubfigureC:NSW-PSID-1. SubfigureD-H:Top-NSW-CPS-1. SubfigureI-M:Top-NSW-PSID-1. SubfigureN:NSW-CPS-1-PLUS. SubfigureO:NSW-PSID-1-PLUS. CATT Estimates using NSW Data: Experimental vs. Nonexperimental
</p>
</div>
<div class="sourceCode" id="cb346"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb346-1"><a href="lalonde-nsw-data.html#cb346-1" tabindex="-1"></a><span class="co"># combine all catt objects </span></span>
<span id="cb346-2"><a href="lalonde-nsw-data.html#cb346-2" tabindex="-1"></a>all_catt <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fu">list</span>(catt.nsw, catt.cps, catt.psid), </span>
<span id="cb346-3"><a href="lalonde-nsw-data.html#cb346-3" tabindex="-1"></a>              catt.top5_cps, catt.top5_psid, </span>
<span id="cb346-4"><a href="lalonde-nsw-data.html#cb346-4" tabindex="-1"></a>              <span class="fu">list</span>(catt.cps.trim, catt.psid.trim))</span>
<span id="cb346-5"><a href="lalonde-nsw-data.html#cb346-5" tabindex="-1"></a></span>
<span id="cb346-6"><a href="lalonde-nsw-data.html#cb346-6" tabindex="-1"></a><span class="co"># evaluate results</span></span>
<span id="cb346-7"><a href="lalonde-nsw-data.html#cb346-7" tabindex="-1"></a>all_catt_eval <span class="ot">&lt;-</span> <span class="fu">eval_catt</span>(all_catt, all_plot_titles)</span>
<span id="cb346-8"><a href="lalonde-nsw-data.html#cb346-8" tabindex="-1"></a></span>
<span id="cb346-9"><a href="lalonde-nsw-data.html#cb346-9" tabindex="-1"></a><span class="co"># print table output</span></span>
<span id="cb346-10"><a href="lalonde-nsw-data.html#cb346-10" tabindex="-1"></a><span class="fu">datatable</span>(all_catt_eval, <span class="at">caption =</span> <span class="st">&quot;CATT Summary Statistics&quot;</span>,</span>
<span id="cb346-11"><a href="lalonde-nsw-data.html#cb346-11" tabindex="-1"></a>          <span class="at">options =</span> <span class="fu">list</span>(<span class="at">scrollX =</span> <span class="cn">TRUE</span>, <span class="at">paging =</span> <span class="cn">FALSE</span>, <span class="at">pageLength =</span> <span class="sc">-</span><span class="dv">1</span>, <span class="at">searching =</span> <span class="cn">FALSE</span>))</span></code></pre></div>
<div class="datatables html-widget html-fill-item" id="htmlwidget-903d0cde7d7b3e303c73" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-903d0cde7d7b3e303c73">{"x":{"filter":"none","vertical":false,"caption":"<caption>CATT Summary Statistics<\/caption>","data":[["1","2","3","4","5","6","7","8","9","10","11","12","13","14","15"],["(A) NSW-Experimental","(B) NSW-CPS1","(C) NSW-PSID1","(D) Top CPS1: cem_crump","(E) Top CPS1: genetic_crump","(F) Top CPS1: k3_walker","(G) Top CPS1: nn_walker","(H) Top CPS1: optimal_pair_walker","(I) Top PSID1: cem_walker","(J) Top PSID1: optimal_pair_walker","(K) Top PSID1: subcl_stuermer","(L) Top PSID1: optimal_full_stuermer","(M) Top PSID1: stuermer","(N) Trimmed NSW-CPS1-PLUS","(O) Trimmed NSW-PSID1-PLUS"],[-1146.759389945134,-8994.51053940258,-8179.537502689989,-2443.751057525925,-3668.051236402277,-7747.148380562115,-7981.821823062408,-8284.961221517589,-6955.980788801261,-5922.726545798504,-8821.532794441076,-8655.980819433978,-8724.245808504143,-6939.688498343655,-7407.191718245504],[3347.569579781877,6328.352409987523,867.5126152892406,5648.763003891253,4615.644495886865,708.7702605835067,496.1107089023827,549.1964812721151,-4716.570953825845,-2264.635425659726,-7090.984594743266,-7012.427935383735,-6905.4054891919,5967.73954870104,-2178.86966261533],[814.5285494679936,-126.8339274632926,-2364.142885532741,483.6202581094111,432.6973124783715,-3109.124313967294,-3026.795016859458,-3602.82122153734,-5624.105595027199,-4110.592000589315,-7788.995232251084,-7650.737336533543,-7673.42948384338,-263.7842182837284,-4103.014650119479],[4494.32896972701,15322.8629493901,9047.05011797923,8092.514061417178,8283.695732289143,8455.918641145621,8477.932531964791,8834.157702789704,2239.409834975416,3658.091120138778,1730.548199697811,1643.552884050244,1818.840319312243,12907.42804704469,5228.322055630175]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>Method<\/th>\n      <th>Min_Catt<\/th>\n      <th>Max_Catt<\/th>\n      <th>Mean_Catt<\/th>\n      <th>Diff_Catt<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"scrollX":true,"paging":false,"pageLength":-1,"searching":false,"columnDefs":[{"className":"dt-right","targets":[2,3,4,5]},{"orderable":false,"targets":0},{"name":" ","targets":0},{"name":"Method","targets":1},{"name":"Min_Catt","targets":2},{"name":"Max_Catt","targets":3},{"name":"Mean_Catt","targets":4},{"name":"Diff_Catt","targets":5}],"order":[],"autoWidth":false,"orderClasses":false,"lengthMenu":[-1,10,25,50,100]}},"evals":[],"jsHooks":[]}</script>
<p>With NSW-CPS-1, the CATT estimates range from $-8,994.51 to $6,328.35, contrasting with the experimental benchmark where CATT estimates span from $-1,146.76 to $3,347.6, with a mean CATT estimate of $814.53. Unlike in the previous sections, the NSW-PSID-1 sample exhibits a narrower CATT estimates range compared to the NSW-CPS-1 sample, with a range spanning from $-8,179.54 to $867,51. Yet its mean CATT estimate remains substantially negative, at approximately $-2,364.14, contrary to the positive mean CATT estimates observed in models A and B given LDW data.</p>
<p>Among the top-ranked NSW-CPS-1 samples, CATT estimates exhibit substantial variability. Samples such as <code>optimal_pair_walker</code> (H), <code>nn_walker</code> (G) or <code>k3_walker</code> (F) yield notably negative minimum CATT values alongside substantial negative mean CATT estimates. Similarly, the <code>genetic_crump</code> (E) and <code>cem_crump</code> (D) samples produce consistently negative CATT estimates, whereas their mean CATT estimates are positive and closer to the benchmark.</p>
<p>The NSW-PSID-1 top-ranked samples deliver substantially decreased mean CATT estimates, reflecting greater difficulties in producing reliable effect estimates, while producing narrower extremes compared to the NSW-CPS-1 top-ranked samples.</p>
<p>Overall, this variation in range and means of CATT estimates across all observational samples indicates substantial heterogeneity in treatment effect estimation and substantiates that certain criteria improve alignment with the experimental benchmark, while others introduce considerable discrepancies.</p>
<div class="sourceCode" id="cb347"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb347-1"><a href="lalonde-nsw-data.html#cb347-1" tabindex="-1"></a><span class="co"># save results</span></span>
<span id="cb347-2"><a href="lalonde-nsw-data.html#cb347-2" tabindex="-1"></a><span class="fu">save_main_catt_panels</span>(</span>
<span id="cb347-3"><a href="lalonde-nsw-data.html#cb347-3" tabindex="-1"></a>  <span class="at">catt_refs =</span> <span class="fu">list</span>(catt.nsw),</span>
<span id="cb347-4"><a href="lalonde-nsw-data.html#cb347-4" tabindex="-1"></a>  <span class="at">catt_comps =</span> <span class="fu">list</span>(catt.cps, catt.psid),</span>
<span id="cb347-5"><a href="lalonde-nsw-data.html#cb347-5" tabindex="-1"></a>  <span class="at">ylabels =</span> <span class="fu">c</span>(<span class="st">&quot;CATT (CPS-1)&quot;</span>, <span class="st">&quot;CATT (PSID-1)&quot;</span>),</span>
<span id="cb347-6"><a href="lalonde-nsw-data.html#cb347-6" tabindex="-1"></a>  <span class="at">prefix =</span> <span class="st">&quot;nsw_catt_main_panels&quot;</span>,</span>
<span id="cb347-7"><a href="lalonde-nsw-data.html#cb347-7" tabindex="-1"></a>  <span class="at">main_titles =</span> <span class="fu">c</span>(<span class="st">&quot;(B) NSW-CPS-1&quot;</span>, <span class="st">&quot;(C) NSW-PSID-1&quot;</span>)</span>
<span id="cb347-8"><a href="lalonde-nsw-data.html#cb347-8" tabindex="-1"></a>)</span>
<span id="cb347-9"><a href="lalonde-nsw-data.html#cb347-9" tabindex="-1"></a></span>
<span id="cb347-10"><a href="lalonde-nsw-data.html#cb347-10" tabindex="-1"></a><span class="fu">save_catt_panels</span>(</span>
<span id="cb347-11"><a href="lalonde-nsw-data.html#cb347-11" tabindex="-1"></a>  <span class="at">exp_catt =</span> catt.top5_cps_trim,</span>
<span id="cb347-12"><a href="lalonde-nsw-data.html#cb347-12" tabindex="-1"></a>  <span class="at">catt_list  =</span> catt.top5_cps,</span>
<span id="cb347-13"><a href="lalonde-nsw-data.html#cb347-13" tabindex="-1"></a>  <span class="at">plot_titles =</span> <span class="fu">paste0</span>(<span class="st">&quot;(&quot;</span>, LETTERS[<span class="dv">4</span><span class="sc">:</span><span class="dv">8</span>], <span class="st">&quot;) Top CPS-1: &quot;</span>, top5_methods.cps),</span>
<span id="cb347-14"><a href="lalonde-nsw-data.html#cb347-14" tabindex="-1"></a>  <span class="at">prefix =</span> <span class="st">&quot;nsw_catt_top5_cps&quot;</span></span>
<span id="cb347-15"><a href="lalonde-nsw-data.html#cb347-15" tabindex="-1"></a>)</span>
<span id="cb347-16"><a href="lalonde-nsw-data.html#cb347-16" tabindex="-1"></a></span>
<span id="cb347-17"><a href="lalonde-nsw-data.html#cb347-17" tabindex="-1"></a><span class="fu">save_catt_panels</span>(</span>
<span id="cb347-18"><a href="lalonde-nsw-data.html#cb347-18" tabindex="-1"></a>  <span class="at">exp_catt =</span> catt.top5_psid_trim,</span>
<span id="cb347-19"><a href="lalonde-nsw-data.html#cb347-19" tabindex="-1"></a>  <span class="at">catt_list  =</span> catt.top5_psid,</span>
<span id="cb347-20"><a href="lalonde-nsw-data.html#cb347-20" tabindex="-1"></a>  <span class="at">plot_titles =</span> <span class="fu">paste0</span>(<span class="st">&quot;(&quot;</span>, LETTERS[<span class="dv">9</span><span class="sc">:</span><span class="dv">13</span>], <span class="st">&quot;) Top PSID-1: &quot;</span>, top5_methods.psid),</span>
<span id="cb347-21"><a href="lalonde-nsw-data.html#cb347-21" tabindex="-1"></a>  <span class="at">prefix =</span> <span class="st">&quot;nsw_catt_top5_psid&quot;</span></span>
<span id="cb347-22"><a href="lalonde-nsw-data.html#cb347-22" tabindex="-1"></a>)</span>
<span id="cb347-23"><a href="lalonde-nsw-data.html#cb347-23" tabindex="-1"></a></span>
<span id="cb347-24"><a href="lalonde-nsw-data.html#cb347-24" tabindex="-1"></a><span class="fu">save_plus_catt_panels</span>(</span>
<span id="cb347-25"><a href="lalonde-nsw-data.html#cb347-25" tabindex="-1"></a>  <span class="at">catt1_list =</span> <span class="fu">list</span>(catt.nsw.cps, catt.nsw.psid),</span>
<span id="cb347-26"><a href="lalonde-nsw-data.html#cb347-26" tabindex="-1"></a>  <span class="at">catt2_list =</span> <span class="fu">list</span>(catt.cps.trim, catt.psid.trim),</span>
<span id="cb347-27"><a href="lalonde-nsw-data.html#cb347-27" tabindex="-1"></a>  <span class="at">ylabels =</span> <span class="fu">c</span>(<span class="st">&quot;CATT (CPS-1-PLUS-Trimmed)&quot;</span>, <span class="st">&quot;CATT (PSID-1-PLUS-Trimmed)&quot;</span>),</span>
<span id="cb347-28"><a href="lalonde-nsw-data.html#cb347-28" tabindex="-1"></a>  <span class="at">prefix =</span> <span class="st">&quot;nsw_catt_plus_panels&quot;</span>,</span>
<span id="cb347-29"><a href="lalonde-nsw-data.html#cb347-29" tabindex="-1"></a>  <span class="at">main_titles =</span> <span class="fu">c</span>(<span class="st">&quot;(N) Trimmed NSW-CPS-1-PLUS&quot;</span>, <span class="st">&quot;(O) Trimmed NSW-PSID-1-PLUS&quot;</span>),</span>
<span id="cb347-30"><a href="lalonde-nsw-data.html#cb347-30" tabindex="-1"></a>  <span class="at">folder =</span> <span class="st">&quot;graphs/lalonde&quot;</span></span>
<span id="cb347-31"><a href="lalonde-nsw-data.html#cb347-31" tabindex="-1"></a>)</span></code></pre></div>
</div>
<div id="quantile-treatment-effect-on-the-treated-qtet-2" class="section level3 hasAnchor" number="4.7.3">
<h3><span class="header-section-number">4.7.3</span> Quantile treatment effect on the treated (QTET)<a href="lalonde-nsw-data.html#quantile-treatment-effect-on-the-treated-qtet-2" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb348"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb348-1"><a href="lalonde-nsw-data.html#cb348-1" tabindex="-1"></a><span class="co"># estimate QTET</span></span>
<span id="cb348-2"><a href="lalonde-nsw-data.html#cb348-2" tabindex="-1"></a>qte.nsw <span class="ot">&lt;-</span> <span class="fu">est_qte</span>(Y, treat, covar, <span class="at">data =</span> nsw, <span class="at">cores =</span> <span class="dv">4</span>)</span>
<span id="cb348-3"><a href="lalonde-nsw-data.html#cb348-3" tabindex="-1"></a>qte.nsw_cps <span class="ot">&lt;-</span> <span class="fu">est_qte</span>(Y, treat, covar, <span class="at">data =</span> nsw_cps)</span>
<span id="cb348-4"><a href="lalonde-nsw-data.html#cb348-4" tabindex="-1"></a>qte.nsw_psid <span class="ot">&lt;-</span> <span class="fu">est_qte</span>(Y, treat, covar, <span class="at">data =</span> nsw_psid)</span>
<span id="cb348-5"><a href="lalonde-nsw-data.html#cb348-5" tabindex="-1"></a>qte.top5_cps  <span class="ot">&lt;-</span> <span class="fu">lapply</span>(top5_samples.cps,  <span class="cf">function</span>(d) <span class="fu">est_qte</span>(Y, treat, covar, <span class="at">data =</span> d))</span>
<span id="cb348-6"><a href="lalonde-nsw-data.html#cb348-6" tabindex="-1"></a>qte.top5_psid <span class="ot">&lt;-</span> <span class="fu">lapply</span>(top5_samples.psid, <span class="cf">function</span>(d) <span class="fu">est_qte</span>(Y, treat, covar, <span class="at">data =</span> d))</span>
<span id="cb348-7"><a href="lalonde-nsw-data.html#cb348-7" tabindex="-1"></a>qte.top5_cps_trim  <span class="ot">&lt;-</span> <span class="fu">lapply</span>(all_trim.cps,  <span class="cf">function</span>(d) <span class="fu">est_qte</span>(Y, treat, covar, <span class="at">data =</span> d))</span>
<span id="cb348-8"><a href="lalonde-nsw-data.html#cb348-8" tabindex="-1"></a>qte.top5_psid_trim <span class="ot">&lt;-</span> <span class="fu">lapply</span>(all_trim.psid, <span class="cf">function</span>(d) <span class="fu">est_qte</span>(Y, treat, covar, <span class="at">data =</span> d))</span></code></pre></div>
<div class="sourceCode" id="cb349"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb349-1"><a href="lalonde-nsw-data.html#cb349-1" tabindex="-1"></a>qte.nsw.cps <span class="ot">&lt;-</span> <span class="fu">est_qte</span>(Y, treat, <span class="cn">NULL</span>, <span class="at">data =</span> nsw_trim_cps)</span>
<span id="cb349-2"><a href="lalonde-nsw-data.html#cb349-2" tabindex="-1"></a>qte.nsw.psid <span class="ot">&lt;-</span> <span class="fu">est_qte</span>(Y, treat, <span class="cn">NULL</span>, <span class="at">data =</span> nsw_trim_psid)</span>
<span id="cb349-3"><a href="lalonde-nsw-data.html#cb349-3" tabindex="-1"></a>qte.nsw_cps.trim <span class="ot">&lt;-</span> <span class="fu">est_qte</span>(Y, treat, covar, <span class="at">data =</span> nsw_cps_trim_match) </span>
<span id="cb349-4"><a href="lalonde-nsw-data.html#cb349-4" tabindex="-1"></a>qte.nsw_psid.trim <span class="ot">&lt;-</span> <span class="fu">est_qte</span>(Y, treat, covar, <span class="at">data =</span> nsw_psid_trim_match) </span></code></pre></div>
<div class="sourceCode" id="cb350"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb350-1"><a href="lalonde-nsw-data.html#cb350-1" tabindex="-1"></a>qte.nsw0 <span class="ot">&lt;-</span> <span class="fu">est_qte</span>(Y, treat, <span class="cn">NULL</span>, <span class="at">data =</span> nsw)</span>
<span id="cb350-2"><a href="lalonde-nsw-data.html#cb350-2" tabindex="-1"></a>qte.nsw_cps0 <span class="ot">&lt;-</span> <span class="fu">est_qte</span>(Y, treat, <span class="cn">NULL</span>, <span class="at">data =</span> nsw_cps)</span>
<span id="cb350-3"><a href="lalonde-nsw-data.html#cb350-3" tabindex="-1"></a>qte.nsw_psid0 <span class="ot">&lt;-</span> <span class="fu">est_qte</span>(Y, treat, <span class="cn">NULL</span>, <span class="at">data =</span> nsw_psid)</span>
<span id="cb350-4"><a href="lalonde-nsw-data.html#cb350-4" tabindex="-1"></a>qte.top5_cps_trim0  <span class="ot">&lt;-</span> <span class="fu">lapply</span>(top5_samples.cps,  <span class="cf">function</span>(d) <span class="fu">est_qte</span>(Y, treat, <span class="cn">NULL</span>, <span class="at">data =</span> d))</span>
<span id="cb350-5"><a href="lalonde-nsw-data.html#cb350-5" tabindex="-1"></a>qte.top5_psid_trim0 <span class="ot">&lt;-</span> <span class="fu">lapply</span>(top5_samples.psid, <span class="cf">function</span>(d) <span class="fu">est_qte</span>(Y, treat, <span class="cn">NULL</span>, <span class="at">data =</span> d))</span></code></pre></div>
<div class="sourceCode" id="cb351"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb351-1"><a href="lalonde-nsw-data.html#cb351-1" tabindex="-1"></a>qte.nsw_cps.trim0 <span class="ot">&lt;-</span> <span class="fu">est_qte</span>(Y, treat, <span class="cn">NULL</span>, <span class="at">data =</span> nsw_cps_trim_match) </span>
<span id="cb351-2"><a href="lalonde-nsw-data.html#cb351-2" tabindex="-1"></a>qte.nsw_psid.trim0 <span class="ot">&lt;-</span> <span class="fu">est_qte</span>(Y, treat, <span class="cn">NULL</span>, <span class="at">data =</span> nsw_psid_trim_match) </span></code></pre></div>
<div class="sourceCode" id="cb352"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb352-1"><a href="lalonde-nsw-data.html#cb352-1" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">2</span>))</span>
<span id="cb352-2"><a href="lalonde-nsw-data.html#cb352-2" tabindex="-1"></a><span class="fu">par</span>(<span class="at">cex.main =</span> <span class="fl">0.9</span>)</span>
<span id="cb352-3"><a href="lalonde-nsw-data.html#cb352-3" tabindex="-1"></a>ylim <span class="ot">=</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">25000</span>, <span class="dv">15000</span>)</span>
<span id="cb352-4"><a href="lalonde-nsw-data.html#cb352-4" tabindex="-1"></a></span>
<span id="cb352-5"><a href="lalonde-nsw-data.html#cb352-5" tabindex="-1"></a><span class="co"># plot results</span></span>
<span id="cb352-6"><a href="lalonde-nsw-data.html#cb352-6" tabindex="-1"></a><span class="fu">plot_qte</span>(qte.nsw_cps, qte.nsw_cps0, qte.nsw, <span class="at">main =</span> <span class="st">&quot;(B) NSW-CPS-1&quot;</span>, ylim)</span>
<span id="cb352-7"><a href="lalonde-nsw-data.html#cb352-7" tabindex="-1"></a><span class="fu">legend</span>(<span class="st">&quot;bottomleft&quot;</span>, <span class="at">legend =</span> <span class="fu">c</span>(<span class="st">&quot;Experimental&quot;</span>, <span class="st">&quot;Unadjusted&quot;</span>, <span class="st">&quot;Adjusted&quot;</span>), </span>
<span id="cb352-8"><a href="lalonde-nsw-data.html#cb352-8" tabindex="-1"></a>       <span class="at">lty =</span> <span class="dv">1</span>, <span class="at">pch =</span> <span class="fu">c</span>(<span class="dv">16</span>, <span class="dv">17</span>, <span class="dv">16</span>), <span class="at">col =</span> <span class="fu">c</span>(<span class="dv">4</span>, <span class="dv">2</span>, <span class="dv">1</span>), <span class="at">bty =</span> <span class="st">&quot;n&quot;</span>)</span>
<span id="cb352-9"><a href="lalonde-nsw-data.html#cb352-9" tabindex="-1"></a></span>
<span id="cb352-10"><a href="lalonde-nsw-data.html#cb352-10" tabindex="-1"></a><span class="fu">plot_qte</span>(qte.nsw_psid, qte.nsw_psid0, qte.nsw, <span class="at">main =</span> <span class="st">&quot;(C) NSW-PSID-1&quot;</span>, ylim)</span>
<span id="cb352-11"><a href="lalonde-nsw-data.html#cb352-11" tabindex="-1"></a><span class="fu">legend</span>(<span class="st">&quot;bottomleft&quot;</span>, <span class="at">legend =</span> <span class="fu">c</span>(<span class="st">&quot;Experimental&quot;</span>, <span class="st">&quot;Unadjusted&quot;</span>, <span class="st">&quot;Adjusted&quot;</span>), </span>
<span id="cb352-12"><a href="lalonde-nsw-data.html#cb352-12" tabindex="-1"></a>       <span class="at">lty =</span> <span class="dv">1</span>, <span class="at">pch =</span> <span class="fu">c</span>(<span class="dv">16</span>, <span class="dv">17</span>, <span class="dv">16</span>), <span class="at">col =</span> <span class="fu">c</span>(<span class="dv">4</span>, <span class="dv">2</span>, <span class="dv">1</span>), <span class="at">bty =</span> <span class="st">&quot;n&quot;</span>)</span>
<span id="cb352-13"><a href="lalonde-nsw-data.html#cb352-13" tabindex="-1"></a></span>
<span id="cb352-14"><a href="lalonde-nsw-data.html#cb352-14" tabindex="-1"></a><span class="fu">plot_qte_top</span>(qte.top5_cps_trim, qte.top5_cps_trim0, qte.top5_cps, all_plot_titles, <span class="at">main_start =</span> <span class="dv">4</span>)</span></code></pre></div>
<div class="figure"><span style="display:block;" id="fig:unnamed-chunk-284-1"></span>
<img src="Outcome-Weights_files/figure-html/unnamed-chunk-284-1.png" alt="FIGUREC4. SubfigureB:NSW-CPS-1. SubfigureC:NSW-PSID-1. SubfigureD-H:Top-NSW-CPS-1. SubfigureI-M:Top-NSW-PSID-1. SubfigureN:NSW-CPS-1-PLUS. SubfigureO:NSW-PSID-1-PLUS. QTET Estimates using NSW Data: Experimental vs. Nonexperimental" width="100%" />
<p class="caption">
Figure 4.15: FIGUREC4. SubfigureB:NSW-CPS-1. SubfigureC:NSW-PSID-1. SubfigureD-H:Top-NSW-CPS-1. SubfigureI-M:Top-NSW-PSID-1. SubfigureN:NSW-CPS-1-PLUS. SubfigureO:NSW-PSID-1-PLUS. QTET Estimates using NSW Data: Experimental vs. Nonexperimental
</p>
</div>
<div class="sourceCode" id="cb353"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb353-1"><a href="lalonde-nsw-data.html#cb353-1" tabindex="-1"></a><span class="fu">plot_qte_top</span>(qte.top5_psid_trim, qte.top5_psid_trim0, qte.top5_psid, all_plot_titles, <span class="at">main_start =</span> <span class="dv">9</span>)</span></code></pre></div>
<div class="figure"><span style="display:block;" id="fig:unnamed-chunk-284-2"></span>
<img src="Outcome-Weights_files/figure-html/unnamed-chunk-284-2.png" alt="FIGUREC4. SubfigureB:NSW-CPS-1. SubfigureC:NSW-PSID-1. SubfigureD-H:Top-NSW-CPS-1. SubfigureI-M:Top-NSW-PSID-1. SubfigureN:NSW-CPS-1-PLUS. SubfigureO:NSW-PSID-1-PLUS. QTET Estimates using NSW Data: Experimental vs. Nonexperimental" width="100%" />
<p class="caption">
Figure 4.16: FIGUREC4. SubfigureB:NSW-CPS-1. SubfigureC:NSW-PSID-1. SubfigureD-H:Top-NSW-CPS-1. SubfigureI-M:Top-NSW-PSID-1. SubfigureN:NSW-CPS-1-PLUS. SubfigureO:NSW-PSID-1-PLUS. QTET Estimates using NSW Data: Experimental vs. Nonexperimental
</p>
</div>
<div class="figure"><span style="display:block;" id="fig:unnamed-chunk-284-3"></span>
<img src="Outcome-Weights_files/figure-html/unnamed-chunk-284-3.png" alt="FIGUREC4. SubfigureB:NSW-CPS-1. SubfigureC:NSW-PSID-1. SubfigureD-H:Top-NSW-CPS-1. SubfigureI-M:Top-NSW-PSID-1. SubfigureN:NSW-CPS-1-PLUS. SubfigureO:NSW-PSID-1-PLUS. QTET Estimates using NSW Data: Experimental vs. Nonexperimental" width="100%" />
<p class="caption">
Figure 4.17: FIGUREC4. SubfigureB:NSW-CPS-1. SubfigureC:NSW-PSID-1. SubfigureD-H:Top-NSW-CPS-1. SubfigureI-M:Top-NSW-PSID-1. SubfigureN:NSW-CPS-1-PLUS. SubfigureO:NSW-PSID-1-PLUS. QTET Estimates using NSW Data: Experimental vs. Nonexperimental
</p>
</div>
<div class="sourceCode" id="cb354"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb354-1"><a href="lalonde-nsw-data.html#cb354-1" tabindex="-1"></a><span class="fu">plot_qte</span>(qte.nsw_cps.trim, qte.nsw_cps.trim0, qte.nsw.cps, <span class="at">main =</span> <span class="st">&quot;(N) Trimmed NSW-CPS-1-PLUS&quot;</span>, ylim)</span>
<span id="cb354-2"><a href="lalonde-nsw-data.html#cb354-2" tabindex="-1"></a><span class="fu">legend</span>(<span class="st">&quot;bottomleft&quot;</span>, <span class="at">legend =</span> <span class="fu">c</span>(<span class="st">&quot;Experimental&quot;</span>, <span class="st">&quot;Unadjusted&quot;</span>, <span class="st">&quot;Adjusted&quot;</span>), </span>
<span id="cb354-3"><a href="lalonde-nsw-data.html#cb354-3" tabindex="-1"></a>       <span class="at">lty =</span> <span class="dv">1</span>, <span class="at">pch =</span> <span class="fu">c</span>(<span class="dv">16</span>, <span class="dv">17</span>, <span class="dv">16</span>), <span class="at">col =</span> <span class="fu">c</span>(<span class="dv">4</span>, <span class="dv">2</span>, <span class="dv">1</span>), <span class="at">bty =</span> <span class="st">&quot;n&quot;</span>)</span>
<span id="cb354-4"><a href="lalonde-nsw-data.html#cb354-4" tabindex="-1"></a></span>
<span id="cb354-5"><a href="lalonde-nsw-data.html#cb354-5" tabindex="-1"></a><span class="fu">plot_qte</span>(qte.nsw_psid.trim, qte.nsw_psid.trim0, qte.nsw.psid, <span class="at">main =</span> <span class="st">&quot;(O) Trimmed NSW-PSID-1-PLUS&quot;</span>, ylim)</span>
<span id="cb354-6"><a href="lalonde-nsw-data.html#cb354-6" tabindex="-1"></a><span class="fu">legend</span>(<span class="st">&quot;bottomleft&quot;</span>, <span class="at">legend =</span> <span class="fu">c</span>(<span class="st">&quot;Experimental&quot;</span>, <span class="st">&quot;Unadjusted&quot;</span>, <span class="st">&quot;Adjusted&quot;</span>), </span>
<span id="cb354-7"><a href="lalonde-nsw-data.html#cb354-7" tabindex="-1"></a>    <span class="at">lty =</span> <span class="dv">1</span>, <span class="at">pch =</span> <span class="fu">c</span>(<span class="dv">16</span>, <span class="dv">17</span>, <span class="dv">16</span>), <span class="at">col =</span> <span class="fu">c</span>(<span class="dv">4</span>, <span class="dv">2</span>, <span class="dv">1</span>), <span class="at">bty =</span> <span class="st">&quot;n&quot;</span>)</span></code></pre></div>
<div class="figure"><span style="display:block;" id="fig:unnamed-chunk-284-4"></span>
<img src="Outcome-Weights_files/figure-html/unnamed-chunk-284-4.png" alt="FIGUREC4. SubfigureB:NSW-CPS-1. SubfigureC:NSW-PSID-1. SubfigureD-H:Top-NSW-CPS-1. SubfigureI-M:Top-NSW-PSID-1. SubfigureN:NSW-CPS-1-PLUS. SubfigureO:NSW-PSID-1-PLUS. QTET Estimates using NSW Data: Experimental vs. Nonexperimental" width="100%" />
<p class="caption">
Figure 4.18: FIGUREC4. SubfigureB:NSW-CPS-1. SubfigureC:NSW-PSID-1. SubfigureD-H:Top-NSW-CPS-1. SubfigureI-M:Top-NSW-PSID-1. SubfigureN:NSW-CPS-1-PLUS. SubfigureO:NSW-PSID-1-PLUS. QTET Estimates using NSW Data: Experimental vs. Nonexperimental
</p>
</div>
<p>These figures display QTET estimates derived from both the NSW experimental and various observational samples.</p>
<p>The QTET estimates from the NSW-CPS-1 sample (B) correspond well with the true QTET, although they are often underpowered. The QTET estimates from top-ranked samples show clear biases when compared to the experimental benchmark (E, G and H), except for <code>k3_walker</code> and <code>cem_crump</code> (F and D), where the QTET estimates align reasonably well with the true QTET.</p>
<p>The QTETs estimated from the NSW-PSID-1 sample (C) show notable biases in contrast to the experimental benchmark. Among its top-ranked samples (I-M) the QTET estimates exhibit substantial bias and are highly underpowered, reflecting great estimation uncertainty.</p>
<p>For the trimmed and matched NSW-CPS-1-PLUS sample (N), the QTET estimates align reasonably well with the experimental benchmark, whereas for the trimmed and matched NSW-PSID-1-PLUS sample (O), the QTET estimates shows notable biases.</p>
<div class="sourceCode" id="cb355"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb355-1"><a href="lalonde-nsw-data.html#cb355-1" tabindex="-1"></a><span class="co"># list results</span></span>
<span id="cb355-2"><a href="lalonde-nsw-data.html#cb355-2" tabindex="-1"></a>plots_nsw <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb355-3"><a href="lalonde-nsw-data.html#cb355-3" tabindex="-1"></a>  <span class="fu">list</span>(<span class="at">mod =</span> qte.nsw_cps, <span class="at">mod0 =</span> qte.nsw_cps0, <span class="at">bm =</span> qte.nsw, <span class="at">main =</span> <span class="st">&quot;(B) NSW-CPS-1&quot;</span>),</span>
<span id="cb355-4"><a href="lalonde-nsw-data.html#cb355-4" tabindex="-1"></a>  <span class="fu">list</span>(<span class="at">mod =</span> qte.nsw_psid, <span class="at">mod0 =</span> qte.nsw_psid0, <span class="at">bm =</span> qte.nsw, <span class="at">main =</span> <span class="st">&quot;(C) NSW-PSID-1&quot;</span>),</span>
<span id="cb355-5"><a href="lalonde-nsw-data.html#cb355-5" tabindex="-1"></a>  <span class="fu">list</span>(<span class="at">mod =</span> qte.nsw_cps.trim, <span class="at">mod0 =</span> qte.nsw_cps.trim0, <span class="at">bm =</span> qte.nsw.cps, <span class="at">main =</span> <span class="st">&quot;(N) Trimmed NSW-CPS-1-PLUS &quot;</span>),</span>
<span id="cb355-6"><a href="lalonde-nsw-data.html#cb355-6" tabindex="-1"></a>  <span class="fu">list</span>(<span class="at">mod =</span> qte.nsw_psid.trim, <span class="at">mod0 =</span> qte.nsw_psid.trim0, <span class="at">bm =</span> qte.nsw.psid, <span class="at">main =</span> <span class="st">&quot;(O) Trimmed NSW-PSID-1-PLUS&quot;</span>)</span>
<span id="cb355-7"><a href="lalonde-nsw-data.html#cb355-7" tabindex="-1"></a>)</span>
<span id="cb355-8"><a href="lalonde-nsw-data.html#cb355-8" tabindex="-1"></a></span>
<span id="cb355-9"><a href="lalonde-nsw-data.html#cb355-9" tabindex="-1"></a><span class="co"># save results</span></span>
<span id="cb355-10"><a href="lalonde-nsw-data.html#cb355-10" tabindex="-1"></a><span class="fu">save_qtet</span>(plots_nsw, <span class="at">prefix =</span> <span class="st">&quot;nsw&quot;</span>)</span>
<span id="cb355-11"><a href="lalonde-nsw-data.html#cb355-11" tabindex="-1"></a><span class="fu">save_qte_top</span>(qte.top5_cps_trim, qte.top5_cps_trim0, qte.top5_cps, all_plot_titles, <span class="at">main_start =</span> <span class="dv">4</span>, <span class="at">prefix =</span> <span class="st">&quot;nsw_top&quot;</span>)</span>
<span id="cb355-12"><a href="lalonde-nsw-data.html#cb355-12" tabindex="-1"></a><span class="fu">save_qte_top</span>(qte.top5_psid_trim, qte.top5_psid_trim0, qte.top5_psid, all_plot_titles, <span class="at">main_start =</span> <span class="dv">9</span>, <span class="at">prefix =</span> <span class="st">&quot;nsw_top&quot;</span>)</span></code></pre></div>
</div>
<div id="assessing-outcome-weights-ow-2" class="section level3 hasAnchor" number="4.7.4">
<h3><span class="header-section-number">4.7.4</span> Assessing outcome weights (OW)<a href="lalonde-nsw-data.html#assessing-outcome-weights-ow-2" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb356"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb356-1"><a href="lalonde-nsw-data.html#cb356-1" tabindex="-1"></a><span class="co"># list all samples</span></span>
<span id="cb356-2"><a href="lalonde-nsw-data.html#cb356-2" tabindex="-1"></a>all_samples <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fu">list</span>(nsw, nsw_cps, nsw_psid), top5_samples.cps, top5_samples.psid, <span class="fu">list</span>(nsw_cps_trim_match, nsw_psid_trim_match))</span>
<span id="cb356-3"><a href="lalonde-nsw-data.html#cb356-3" tabindex="-1"></a></span>
<span id="cb356-4"><a href="lalonde-nsw-data.html#cb356-4" tabindex="-1"></a><span class="co"># estimate ATT </span></span>
<span id="cb356-5"><a href="lalonde-nsw-data.html#cb356-5" tabindex="-1"></a>res_att <span class="ot">&lt;-</span> <span class="fu">get_res_att</span>(all_samples, Y, treat, covar)</span></code></pre></div>
<pre><code>## OUTCOME WEIGHTS SUMMARY: 15 succeeded, 0 failed out of 15 samples</code></pre>
<div class="sourceCode" id="cb358"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb358-1"><a href="lalonde-nsw-data.html#cb358-1" tabindex="-1"></a><span class="co"># extract outcome weights</span></span>
<span id="cb358-2"><a href="lalonde-nsw-data.html#cb358-2" tabindex="-1"></a>ow_att <span class="ot">&lt;-</span> <span class="fu">derive_ow</span>(res_att)</span></code></pre></div>
<div class="sourceCode" id="cb359"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb359-1"><a href="lalonde-nsw-data.html#cb359-1" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">2</span>))</span>
<span id="cb359-2"><a href="lalonde-nsw-data.html#cb359-2" tabindex="-1"></a><span class="fu">par</span>(<span class="at">cex.main =</span> <span class="fl">0.8</span>)</span>
<span id="cb359-3"><a href="lalonde-nsw-data.html#cb359-3" tabindex="-1"></a></span>
<span id="cb359-4"><a href="lalonde-nsw-data.html#cb359-4" tabindex="-1"></a><span class="co"># plot outcome weights distribution</span></span>
<span id="cb359-5"><a href="lalonde-nsw-data.html#cb359-5" tabindex="-1"></a><span class="fu">plot_ow</span>(ow_att, all_plot_titles) </span></code></pre></div>
<div class="figure"><span style="display:block;" id="fig:unnamed-chunk-287-1"></span>
<img src="Outcome-Weights_files/figure-html/unnamed-chunk-287-1.png" alt="FIGUREC5. SubfigureA:NSW-Experimental. SubfigureB:NSW-CPS-1. SubfigureC:NSW-PSID-1. SubfigureD-H:Top-NSW-CPS-1. SubfigureI-M:Top-NSW-PSID-1. SubfigureN:NSW-CPS-1-PLUS. SubfigureO:NSW-PSID-1-PLUS. Outcome Weights using NSW Data" width="100%" />
<p class="caption">
Figure 4.19: FIGUREC5. SubfigureA:NSW-Experimental. SubfigureB:NSW-CPS-1. SubfigureC:NSW-PSID-1. SubfigureD-H:Top-NSW-CPS-1. SubfigureI-M:Top-NSW-PSID-1. SubfigureN:NSW-CPS-1-PLUS. SubfigureO:NSW-PSID-1-PLUS. Outcome Weights using NSW Data
</p>
</div>
<div class="figure"><span style="display:block;" id="fig:unnamed-chunk-287-2"></span>
<img src="Outcome-Weights_files/figure-html/unnamed-chunk-287-2.png" alt="FIGUREC5. SubfigureA:NSW-Experimental. SubfigureB:NSW-CPS-1. SubfigureC:NSW-PSID-1. SubfigureD-H:Top-NSW-CPS-1. SubfigureI-M:Top-NSW-PSID-1. SubfigureN:NSW-CPS-1-PLUS. SubfigureO:NSW-PSID-1-PLUS. Outcome Weights using NSW Data" width="100%" />
<p class="caption">
Figure 4.20: FIGUREC5. SubfigureA:NSW-Experimental. SubfigureB:NSW-CPS-1. SubfigureC:NSW-PSID-1. SubfigureD-H:Top-NSW-CPS-1. SubfigureI-M:Top-NSW-PSID-1. SubfigureN:NSW-CPS-1-PLUS. SubfigureO:NSW-PSID-1-PLUS. Outcome Weights using NSW Data
</p>
</div>
<div class="figure"><span style="display:block;" id="fig:unnamed-chunk-287-3"></span>
<img src="Outcome-Weights_files/figure-html/unnamed-chunk-287-3.png" alt="FIGUREC5. SubfigureA:NSW-Experimental. SubfigureB:NSW-CPS-1. SubfigureC:NSW-PSID-1. SubfigureD-H:Top-NSW-CPS-1. SubfigureI-M:Top-NSW-PSID-1. SubfigureN:NSW-CPS-1-PLUS. SubfigureO:NSW-PSID-1-PLUS. Outcome Weights using NSW Data" width="100%" />
<p class="caption">
Figure 4.21: FIGUREC5. SubfigureA:NSW-Experimental. SubfigureB:NSW-CPS-1. SubfigureC:NSW-PSID-1. SubfigureD-H:Top-NSW-CPS-1. SubfigureI-M:Top-NSW-PSID-1. SubfigureN:NSW-CPS-1-PLUS. SubfigureO:NSW-PSID-1-PLUS. Outcome Weights using NSW Data
</p>
</div>
<div class="figure"><span style="display:block;" id="fig:unnamed-chunk-287-4"></span>
<img src="Outcome-Weights_files/figure-html/unnamed-chunk-287-4.png" alt="FIGUREC5. SubfigureA:NSW-Experimental. SubfigureB:NSW-CPS-1. SubfigureC:NSW-PSID-1. SubfigureD-H:Top-NSW-CPS-1. SubfigureI-M:Top-NSW-PSID-1. SubfigureN:NSW-CPS-1-PLUS. SubfigureO:NSW-PSID-1-PLUS. Outcome Weights using NSW Data" width="100%" />
<p class="caption">
Figure 4.22: FIGUREC5. SubfigureA:NSW-Experimental. SubfigureB:NSW-CPS-1. SubfigureC:NSW-PSID-1. SubfigureD-H:Top-NSW-CPS-1. SubfigureI-M:Top-NSW-PSID-1. SubfigureN:NSW-CPS-1-PLUS. SubfigureO:NSW-PSID-1-PLUS. Outcome Weights using NSW Data
</p>
</div>
<div class="sourceCode" id="cb360"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb360-1"><a href="lalonde-nsw-data.html#cb360-1" tabindex="-1"></a><span class="co"># evaluate results</span></span>
<span id="cb360-2"><a href="lalonde-nsw-data.html#cb360-2" tabindex="-1"></a>res_ow <span class="ot">&lt;-</span> <span class="fu">eval_ow</span>(ow_att, all_samples, all_plot_titles, treat, <span class="st">&quot;AIPW-ATT&quot;</span>)</span>
<span id="cb360-3"><a href="lalonde-nsw-data.html#cb360-3" tabindex="-1"></a></span>
<span id="cb360-4"><a href="lalonde-nsw-data.html#cb360-4" tabindex="-1"></a><span class="co"># print table output</span></span>
<span id="cb360-5"><a href="lalonde-nsw-data.html#cb360-5" tabindex="-1"></a><span class="fu">datatable</span>(res_ow, <span class="at">caption =</span> <span class="st">&quot;Outcome Weights for Treated and Untreated&quot;</span>,</span>
<span id="cb360-6"><a href="lalonde-nsw-data.html#cb360-6" tabindex="-1"></a>          <span class="at">options =</span> <span class="fu">list</span>(<span class="at">scrollX =</span> <span class="cn">TRUE</span>, <span class="at">paging =</span> <span class="cn">FALSE</span>, <span class="at">pageLength =</span> <span class="sc">-</span><span class="dv">1</span>, <span class="at">searching =</span> <span class="cn">FALSE</span>))</span></code></pre></div>
<div class="datatables html-widget html-fill-item" id="htmlwidget-0090a01b019e877ecf02" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-0090a01b019e877ecf02">{"x":{"filter":"none","vertical":false,"caption":"<caption>Outcome Weights for Treated and Untreated<\/caption>","data":[["1","2","3","4","5","6","7","8","9","10","11","12","13","14","15"],["(A) NSW-Experimental","(B) NSW-CPS1","(C) NSW-PSID1","(D) Top CPS1: cem_crump","(E) Top CPS1: genetic_crump","(F) Top CPS1: k3_walker","(G) Top CPS1: nn_walker","(H) Top CPS1: optimal_pair_walker","(I) Top PSID1: cem_walker","(J) Top PSID1: optimal_pair_walker","(K) Top PSID1: subcl_stuermer","(L) Top PSID1: optimal_full_stuermer","(M) Top PSID1: stuermer","(N) Trimmed NSW-CPS1-PLUS","(O) Trimmed NSW-PSID1-PLUS"],[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],[-1,-0.9999999999999989,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1],[0,1.332267629550188e-15,0,-2.220446049250313e-16,0,0,-2.220446049250313e-16,0,0,0,0,0,0,-2.220446049250313e-16,0]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>Method<\/th>\n      <th>Sum_Treated<\/th>\n      <th>Sum_Untreated<\/th>\n      <th>Total_Sum<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"scrollX":true,"paging":false,"pageLength":-1,"searching":false,"columnDefs":[{"className":"dt-right","targets":[2,3,4]},{"orderable":false,"targets":0},{"name":" ","targets":0},{"name":"Method","targets":1},{"name":"Sum_Treated","targets":2},{"name":"Sum_Untreated","targets":3},{"name":"Total_Sum","targets":4}],"order":[],"autoWidth":false,"orderClasses":false,"lengthMenu":[-1,10,25,50,100]}},"evals":[],"jsHooks":[]}</script>
<div class="sourceCode" id="cb361"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb361-1"><a href="lalonde-nsw-data.html#cb361-1" tabindex="-1"></a><span class="co">#save results</span></span>
<span id="cb361-2"><a href="lalonde-nsw-data.html#cb361-2" tabindex="-1"></a><span class="fu">save_ow</span>(ow_att, all_plot_titles, <span class="at">prefix =</span> <span class="st">&quot;nsw&quot;</span>)</span>
<span id="cb361-3"><a href="lalonde-nsw-data.html#cb361-3" tabindex="-1"></a><span class="fu">save_csv</span>(res_ow, <span class="st">&quot;nsw_ow&quot;</span>)</span></code></pre></div>
<p>Consistent with the preceding sections, the evaluation shows that, across each sample, the estimated outcome weights sum to one within the treated group and to minus one within the untreated group, yielding an overall total of zero. Note, that minor deviations from exact values are attributable to floating-point rounding error in numerical summation.</p>
<div class="callout-tip">
<p>A placebo test is not performed as the NSW data arises from a randomized controlled trial, where random assignment provides internal validity and guards against systematic confounding.</p>
</div>
</div>
</div>
<div id="validation-through-sensitivity-analyses-2" class="section level2 hasAnchor" number="4.8">
<h2><span class="header-section-number">4.8</span> Validation through sensitivity analyses<a href="lalonde-nsw-data.html#validation-through-sensitivity-analyses-2" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div class="sourceCode" id="cb362"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb362-1"><a href="lalonde-nsw-data.html#cb362-1" tabindex="-1"></a><span class="co"># define variables</span></span>
<span id="cb362-2"><a href="lalonde-nsw-data.html#cb362-2" tabindex="-1"></a>Y <span class="ot">&lt;-</span> <span class="st">&quot;re78&quot;</span></span>
<span id="cb362-3"><a href="lalonde-nsw-data.html#cb362-3" tabindex="-1"></a>treat <span class="ot">&lt;-</span> <span class="st">&quot;treat&quot;</span></span>
<span id="cb362-4"><a href="lalonde-nsw-data.html#cb362-4" tabindex="-1"></a>covar <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;age&quot;</span>, <span class="st">&quot;education&quot;</span>, <span class="st">&quot;black&quot;</span>, <span class="st">&quot;hispanic&quot;</span>, <span class="st">&quot;married&quot;</span>, <span class="st">&quot;nodegree&quot;</span>, <span class="st">&quot;re75&quot;</span>, <span class="st">&quot;u75&quot;</span>)</span>
<span id="cb362-5"><a href="lalonde-nsw-data.html#cb362-5" tabindex="-1"></a>bm <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;re75&quot;</span>)</span></code></pre></div>
<div class="sourceCode" id="cb363"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb363-1"><a href="lalonde-nsw-data.html#cb363-1" tabindex="-1"></a><span class="co"># check for valid samples </span></span>
<span id="cb363-2"><a href="lalonde-nsw-data.html#cb363-2" tabindex="-1"></a>filtered_samples_sens <span class="ot">&lt;-</span> <span class="fu">check_filter_samples</span>(all_samples, Y, treat, covar, bm)</span></code></pre></div>
<div class="sourceCode" id="cb364"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb364-1"><a href="lalonde-nsw-data.html#cb364-1" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">2</span>))</span>
<span id="cb364-2"><a href="lalonde-nsw-data.html#cb364-2" tabindex="-1"></a><span class="fu">par</span>(<span class="at">cex.main =</span> <span class="fl">0.8</span>)</span>
<span id="cb364-3"><a href="lalonde-nsw-data.html#cb364-3" tabindex="-1"></a></span>
<span id="cb364-4"><a href="lalonde-nsw-data.html#cb364-4" tabindex="-1"></a><span class="co"># loop over valid samples and plot results</span></span>
<span id="cb364-5"><a href="lalonde-nsw-data.html#cb364-5" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="fu">seq_along</span>(filtered_samples_sens)) {</span>
<span id="cb364-6"><a href="lalonde-nsw-data.html#cb364-6" tabindex="-1"></a>    <span class="fu">sens_ana</span>(filtered_samples_sens[[i]], Y, treat, covar, bm, <span class="at">kd =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>)</span>
<span id="cb364-7"><a href="lalonde-nsw-data.html#cb364-7" tabindex="-1"></a>    <span class="fu">title</span>(<span class="at">main =</span> all_plot_titles[i])</span>
<span id="cb364-8"><a href="lalonde-nsw-data.html#cb364-8" tabindex="-1"></a>}</span></code></pre></div>
<div class="figure"><span style="display:block;" id="fig:unnamed-chunk-292-1"></span>
<img src="Outcome-Weights_files/figure-html/unnamed-chunk-292-1.png" alt="FIGUREC6. SubfigureA:NSW-Experimental. SubfigureB:NSW-CPS-1. SubfigureC:NSW-PSID-1. SubfigureD-H:Top-NSW-CPS-1. SubfigureI-M:Top-NSW-PSID-1. SubfigureN:NSW-CPS-1-PLUS. SubfigureO:NSW-PSID-1-PLUS. Sensitivity Analyses NSW" width="100%" />
<p class="caption">
Figure 4.23: FIGUREC6. SubfigureA:NSW-Experimental. SubfigureB:NSW-CPS-1. SubfigureC:NSW-PSID-1. SubfigureD-H:Top-NSW-CPS-1. SubfigureI-M:Top-NSW-PSID-1. SubfigureN:NSW-CPS-1-PLUS. SubfigureO:NSW-PSID-1-PLUS. Sensitivity Analyses NSW
</p>
</div>
<div class="figure"><span style="display:block;" id="fig:unnamed-chunk-292-2"></span>
<img src="Outcome-Weights_files/figure-html/unnamed-chunk-292-2.png" alt="FIGUREC6. SubfigureA:NSW-Experimental. SubfigureB:NSW-CPS-1. SubfigureC:NSW-PSID-1. SubfigureD-H:Top-NSW-CPS-1. SubfigureI-M:Top-NSW-PSID-1. SubfigureN:NSW-CPS-1-PLUS. SubfigureO:NSW-PSID-1-PLUS. Sensitivity Analyses NSW" width="100%" />
<p class="caption">
Figure 4.24: FIGUREC6. SubfigureA:NSW-Experimental. SubfigureB:NSW-CPS-1. SubfigureC:NSW-PSID-1. SubfigureD-H:Top-NSW-CPS-1. SubfigureI-M:Top-NSW-PSID-1. SubfigureN:NSW-CPS-1-PLUS. SubfigureO:NSW-PSID-1-PLUS. Sensitivity Analyses NSW
</p>
</div>
<div class="figure"><span style="display:block;" id="fig:unnamed-chunk-292-3"></span>
<img src="Outcome-Weights_files/figure-html/unnamed-chunk-292-3.png" alt="FIGUREC6. SubfigureA:NSW-Experimental. SubfigureB:NSW-CPS-1. SubfigureC:NSW-PSID-1. SubfigureD-H:Top-NSW-CPS-1. SubfigureI-M:Top-NSW-PSID-1. SubfigureN:NSW-CPS-1-PLUS. SubfigureO:NSW-PSID-1-PLUS. Sensitivity Analyses NSW" width="100%" />
<p class="caption">
Figure 4.25: FIGUREC6. SubfigureA:NSW-Experimental. SubfigureB:NSW-CPS-1. SubfigureC:NSW-PSID-1. SubfigureD-H:Top-NSW-CPS-1. SubfigureI-M:Top-NSW-PSID-1. SubfigureN:NSW-CPS-1-PLUS. SubfigureO:NSW-PSID-1-PLUS. Sensitivity Analyses NSW
</p>
</div>
<div class="figure"><span style="display:block;" id="fig:unnamed-chunk-292-4"></span>
<img src="Outcome-Weights_files/figure-html/unnamed-chunk-292-4.png" alt="FIGUREC6. SubfigureA:NSW-Experimental. SubfigureB:NSW-CPS-1. SubfigureC:NSW-PSID-1. SubfigureD-H:Top-NSW-CPS-1. SubfigureI-M:Top-NSW-PSID-1. SubfigureN:NSW-CPS-1-PLUS. SubfigureO:NSW-PSID-1-PLUS. Sensitivity Analyses NSW" width="100%" />
<p class="caption">
Figure 4.26: FIGUREC6. SubfigureA:NSW-Experimental. SubfigureB:NSW-CPS-1. SubfigureC:NSW-PSID-1. SubfigureD-H:Top-NSW-CPS-1. SubfigureI-M:Top-NSW-PSID-1. SubfigureN:NSW-CPS-1-PLUS. SubfigureO:NSW-PSID-1-PLUS. Sensitivity Analyses NSW
</p>
</div>
<div class="sourceCode" id="cb365"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb365-1"><a href="lalonde-nsw-data.html#cb365-1" tabindex="-1"></a><span class="co"># save results</span></span>
<span id="cb365-2"><a href="lalonde-nsw-data.html#cb365-2" tabindex="-1"></a><span class="fu">save_sensitivity_plots</span>(filtered_samples_sens, Y, treat, covar, bm, all_plot_titles, <span class="st">&quot;nsw&quot;</span>)</span></code></pre></div>
<pre><code>## SUMMARY: Sensitivity plots - 14 succeeded, 0 failed out of 14 total</code></pre>
<p>The sensitivity analysis shows that for the NSW-Experimental sample, the estimated treatment effects are fairly robust to increasing confounder strength, as indicated by relatively stable values despite up to triple the correlation levels of the confounder.</p>
<p>For the NSW-CPS-1 (B) and NSW-PSID-1 (C) sample, as well as the top-ranked samples (I), (J), (K) and (M) of NSW-PSID-1 the treatment effect estimates are highly sensitive to unmeasured confounding. For the sample (M) and all top-ranked samples of NSW-CPS-1 (D-H) the treatment effect estimates are reasonably sensitive. Whereas, for the NSW-CPS-1-PLUS sample (N) the estimates are fairly robust to unmeasured confounding.</p>
</div>
<div id="summary-2" class="section level2 hasAnchor" number="4.9">
<h2><span class="header-section-number">4.9</span> Summary<a href="lalonde-nsw-data.html#summary-2" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>After reexamining the original LaLonde (NSW) data, the results confirm that the NSW-Experimental data shows nearly perfect overlap between treated and control groups, while the observational samples (NSW-CPS-1 and NSW-PSID-1) display weak overlap, with many treated units outside the control range. Expanding these samples with experimental controls and applying the exact approach as defined by <span class="citation">Imbens and Xu (<a href="#ref-imbens2024">2024</a>)</span> improves effect estimates considerably.</p>
<p>These findings reinforce the lessons from previous LDW analyses: even with improved overlap and some gains in covariate balance, achieving consistent and reliable effect estimates with observational data remains difficult.</p>

</div>
</div>
<h3>References<a href="references.html#references" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div id="refs" class="references csl-bib-body hanging-indent" entry-spacing="0">
<div id="ref-imbens2024" class="csl-entry">
Imbens, Guido W., and Yiqing Xu. 2024. <span>“LaLonde (1986) After Nearly Four Decades: Lessons Learned.”</span>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="lalonde-dehejia-wahba-ldw-data-1.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="lalonde-calónico-smith-lcs-data.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
  "sharing": {
    "github": false,
    "facebook": true,
    "twitter": true,
    "linkedin": false,
    "weibo": false,
    "instapaper": false,
    "vk": false,
    "whatsapp": false,
    "all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
  },
  "fontsettings": {
    "theme": "white",
    "family": "sans",
    "size": 2
  },
  "edit": {
    "link": "https://github.com/lkrsl/Application-of-Outcome-Weights-Framework-for-DML-to-Lalonde-Study/edit/main/tutorial/04-NSW.Rmd",
    "text": "Edit"
  },
  "history": {
    "link": null,
    "text": null
  },
  "view": {
    "link": null,
    "text": null
  },
  "download": ["Outcome-Weights.pdf", "Outcome-Weights.epub"],
  "search": {
    "engine": "fuse",
    "options": null
  },
  "toc": {
    "collapse": "subsection"
  }
});
});
</script>

</body>

</html>

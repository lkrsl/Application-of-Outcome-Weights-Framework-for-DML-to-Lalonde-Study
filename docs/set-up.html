<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 2 Set up | Replication and Extension of Imbens &amp; Xu (2024) Tutorial - LaLonde Males Samples</title>
  <meta name="description" content="<p>This book demonstrates the application of the Outcome Weights Framework
for Double Machine Learning to the Lalonde Study.</p>" />
  <meta name="generator" content="bookdown 0.45 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 2 Set up | Replication and Extension of Imbens &amp; Xu (2024) Tutorial - LaLonde Males Samples" />
  <meta property="og:type" content="book" />
  
  <meta property="og:description" content="<p>This book demonstrates the application of the Outcome Weights Framework
for Double Machine Learning to the Lalonde Study.</p>" />
  <meta name="github-repo" content="lkrsl/Application-of-Outcome-Weights-Framework-for-DML-to-Lalonde-Study" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 2 Set up | Replication and Extension of Imbens &amp; Xu (2024) Tutorial - LaLonde Males Samples" />
  
  <meta name="twitter:description" content="<p>This book demonstrates the application of the Outcome Weights Framework
for Double Machine Learning to the Lalonde Study.</p>" />
  

<meta name="author" content="Laura Kreisel" />


<meta name="date" content="2025-05-08" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="getting-started.html"/>
<link rel="next" href="summary.html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>


<style type="text/css">
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
  
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">A Minimal Book Example</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Preface</a>
<ul>
<li class="chapter" data-level="0.1" data-path="index.html"><a href="index.html#overview"><i class="fa fa-check"></i><b>0.1</b> Overview</a></li>
</ul></li>
<li class="chapter" data-level="1" data-path="getting-started.html"><a href="getting-started.html"><i class="fa fa-check"></i><b>1</b> Getting started</a>
<ul>
<li class="chapter" data-level="1.1" data-path="getting-started.html"><a href="getting-started.html#installation"><i class="fa fa-check"></i><b>1.1</b> Installation</a></li>
<li class="chapter" data-level="1.2" data-path="getting-started.html"><a href="getting-started.html#wrapper-functions"><i class="fa fa-check"></i><b>1.2</b> Wrapper functions</a>
<ul>
<li class="chapter" data-level="1.2.1" data-path="getting-started.html"><a href="getting-started.html#overview-1"><i class="fa fa-check"></i><b>1.2.1</b> Overview</a></li>
<li class="chapter" data-level="1.2.2" data-path="getting-started.html"><a href="getting-started.html#inspection"><i class="fa fa-check"></i><b>1.2.2</b> Inspection</a></li>
<li class="chapter" data-level="1.2.3" data-path="getting-started.html"><a href="getting-started.html#improving-covariate-balance-and-overlap"><i class="fa fa-check"></i><b>1.2.3</b> Improving covariate balance and overlap</a></li>
<li class="chapter" data-level="1.2.4" data-path="getting-started.html"><a href="getting-started.html#reassessing-methods"><i class="fa fa-check"></i><b>1.2.4</b> Reassessing methods</a></li>
<li class="chapter" data-level="1.2.5" data-path="getting-started.html"><a href="getting-started.html#estimating"><i class="fa fa-check"></i><b>1.2.5</b> Estimating</a></li>
</ul></li>
<li class="chapter" data-level="1.3" data-path="getting-started.html"><a href="getting-started.html#outcome-weights-analysis"><i class="fa fa-check"></i><b>1.3</b> Outcome weights analysis</a></li>
<li class="chapter" data-level="1.4" data-path="getting-started.html"><a href="getting-started.html#sensitivity-analysis"><i class="fa fa-check"></i><b>1.4</b> Sensitivity analysis</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="set-up.html"><a href="set-up.html"><i class="fa fa-check"></i><b>2</b> Set up</a>
<ul>
<li class="chapter" data-level="2.1" data-path="set-up.html"><a href="set-up.html#source-functions-and-load-data"><i class="fa fa-check"></i><b>2.1</b> Source functions and load data</a></li>
<li class="chapter" data-level="2.2" data-path="set-up.html"><a href="set-up.html#load-and-preprocess-data"><i class="fa fa-check"></i><b>2.2</b> Load and preprocess data</a></li>
<li class="chapter" data-level="2.3" data-path="set-up.html"><a href="set-up.html#assessing-overlap-and-covariate-balance"><i class="fa fa-check"></i><b>2.3</b> Assessing overlap and covariate balance</a>
<ul>
<li class="chapter" data-level="2.3.1" data-path="set-up.html"><a href="set-up.html#overlap"><i class="fa fa-check"></i><b>2.3.1</b> Overlap</a></li>
<li class="chapter" data-level="2.3.2" data-path="set-up.html"><a href="set-up.html#covariate-balance"><i class="fa fa-check"></i><b>2.3.2</b> Covariate balance</a></li>
</ul></li>
<li class="chapter" data-level="2.4" data-path="set-up.html"><a href="set-up.html#improving-primarily-covariate-balance"><i class="fa fa-check"></i><b>2.4</b> Improving primarily covariate balance</a>
<ul>
<li class="chapter" data-level="2.4.1" data-path="set-up.html"><a href="set-up.html#matching-2"><i class="fa fa-check"></i><b>2.4.1</b> Matching</a></li>
<li class="chapter" data-level="2.4.2" data-path="set-up.html"><a href="set-up.html#weighting-2"><i class="fa fa-check"></i><b>2.4.2</b> Weighting</a></li>
</ul></li>
<li class="chapter" data-level="2.5" data-path="set-up.html"><a href="set-up.html#improving-primarily-overlap"><i class="fa fa-check"></i><b>2.5</b> Improving primarily overlap</a>
<ul>
<li class="chapter" data-level="2.5.1" data-path="set-up.html"><a href="set-up.html#truncation-2"><i class="fa fa-check"></i><b>2.5.1</b> Truncation</a></li>
<li class="chapter" data-level="2.5.2" data-path="set-up.html"><a href="set-up.html#trimming-2"><i class="fa fa-check"></i><b>2.5.2</b> Trimming</a></li>
<li class="chapter" data-level="2.5.3" data-path="set-up.html"><a href="set-up.html#combination-of-methods"><i class="fa fa-check"></i><b>2.5.3</b> Combination of methods</a></li>
</ul></li>
<li class="chapter" data-level="2.6" data-path="set-up.html"><a href="set-up.html#reassessing-methods-1"><i class="fa fa-check"></i><b>2.6</b> Reassessing methods</a>
<ul>
<li class="chapter" data-level="2.6.1" data-path="set-up.html"><a href="set-up.html#matching-3"><i class="fa fa-check"></i><b>2.6.1</b> Matching</a></li>
<li class="chapter" data-level="2.6.2" data-path="set-up.html"><a href="set-up.html#weighting-3"><i class="fa fa-check"></i><b>2.6.2</b> Weighting</a></li>
<li class="chapter" data-level="2.6.3" data-path="set-up.html"><a href="set-up.html#truncation-3"><i class="fa fa-check"></i><b>2.6.3</b> Truncation</a></li>
<li class="chapter" data-level="2.6.4" data-path="set-up.html"><a href="set-up.html#trimming-3"><i class="fa fa-check"></i><b>2.6.4</b> Trimming</a></li>
</ul></li>
<li class="chapter" data-level="2.7" data-path="set-up.html"><a href="set-up.html#integrated-methods"><i class="fa fa-check"></i><b>2.7</b> Integrated methods</a>
<ul>
<li class="chapter" data-level="2.7.1" data-path="set-up.html"><a href="set-up.html#top-methods-and-datasets"><i class="fa fa-check"></i><b>2.7.1</b> Top methods and datasets</a></li>
</ul></li>
<li class="chapter" data-level="2.8" data-path="set-up.html"><a href="set-up.html#estimating-1"><i class="fa fa-check"></i><b>2.8</b> Estimating</a>
<ul>
<li class="chapter" data-level="2.8.1" data-path="set-up.html"><a href="set-up.html#average-treatment-effect-on-the-treated-att"><i class="fa fa-check"></i><b>2.8.1</b> Average treatment effect on the treated (ATT)</a></li>
<li class="chapter" data-level="2.8.2" data-path="set-up.html"><a href="set-up.html#conditional-average-treatment-effect-on-the-treated-catt-1"><i class="fa fa-check"></i><b>2.8.2</b> Conditional average treatment effect on the treated (CATT)</a></li>
<li class="chapter" data-level="2.8.3" data-path="set-up.html"><a href="set-up.html#quantile-treatment-effect-on-the-treated-qtet"><i class="fa fa-check"></i><b>2.8.3</b> Quantile treatment effect on the treated (QTET)</a></li>
<li class="chapter" data-level="2.8.4" data-path="set-up.html"><a href="set-up.html#assessing-outcome-weights-ow"><i class="fa fa-check"></i><b>2.8.4</b> Assessing outcome weights (OW)</a></li>
</ul></li>
<li class="chapter" data-level="2.9" data-path="set-up.html"><a href="set-up.html#validation-through-placebo-analyses"><i class="fa fa-check"></i><b>2.9</b> Validation through placebo analyses</a></li>
<li class="chapter" data-level="2.10" data-path="set-up.html"><a href="set-up.html#validation-through-sensitivity-analyses"><i class="fa fa-check"></i><b>2.10</b> Validation through sensitivity analyses</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="summary.html"><a href="summary.html"><i class="fa fa-check"></i><b>3</b> Summary</a></li>
<li class="chapter" data-level="" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i>References</a></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Replication and Extension of Imbens &amp; Xu (2024) Tutorial - LaLonde Males Samples</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="set-up" class="section level1 hasAnchor" number="2">
<h1><span class="header-section-number">Chapter 2</span> Set up<a href="set-up.html#set-up" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<div id="source-functions-and-load-data" class="section level2 hasAnchor" number="2.1">
<h2><span class="header-section-number">2.1</span> Source functions and load data<a href="set-up.html#source-functions-and-load-data" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div class="sourceCode" id="cb61"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb61-1"><a href="set-up.html#cb61-1" tabindex="-1"></a><span class="co"># source functions</span></span>
<span id="cb61-2"><a href="set-up.html#cb61-2" tabindex="-1"></a><span class="fu">source</span>(<span class="st">&quot;https://github.com/xuyiqing/lalonde/blob/main/tutorial/functions.R?raw=TRUE&quot;</span>)</span>
<span id="cb61-3"><a href="set-up.html#cb61-3" tabindex="-1"></a><span class="fu">source</span>(<span class="st">&quot;tutorial/functions.R&quot;</span>)</span></code></pre></div>
<div class="sourceCode" id="cb62"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb62-1"><a href="set-up.html#cb62-1" tabindex="-1"></a><span class="co"># load data</span></span>
<span id="cb62-2"><a href="set-up.html#cb62-2" tabindex="-1"></a><span class="fu">load</span>(<span class="st">&quot;data/lcs.RData&quot;</span>)</span></code></pre></div>
<div class="sourceCode" id="cb63"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb63-1"><a href="set-up.html#cb63-1" tabindex="-1"></a><span class="co"># set seed</span></span>
<span id="cb63-2"><a href="set-up.html#cb63-2" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">42</span>)</span></code></pre></div>
</div>
<div id="load-and-preprocess-data" class="section level2 hasAnchor" number="2.2">
<h2><span class="header-section-number">2.2</span> Load and preprocess data<a href="set-up.html#load-and-preprocess-data" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div class="sourceCode" id="cb64"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb64-1"><a href="set-up.html#cb64-1" tabindex="-1"></a><span class="co"># expc = 0: experimental treated; </span></span>
<span id="cb64-2"><a href="set-up.html#cb64-2" tabindex="-1"></a><span class="co"># expc = 1: experimental control; </span></span>
<span id="cb64-3"><a href="set-up.html#cb64-3" tabindex="-1"></a><span class="co"># expc = 2: psid control;</span></span>
<span id="cb64-4"><a href="set-up.html#cb64-4" tabindex="-1"></a></span>
<span id="cb64-5"><a href="set-up.html#cb64-5" tabindex="-1"></a>lcs_psid<span class="sc">$</span>expc <span class="ot">&lt;-</span> <span class="dv">0</span> </span>
<span id="cb64-6"><a href="set-up.html#cb64-6" tabindex="-1"></a>lcs_psid[lcs_psid<span class="sc">$</span>treat<span class="sc">==</span><span class="dv">0</span>, ]<span class="sc">$</span>expc <span class="ot">&lt;-</span> <span class="dv">2</span> </span>
<span id="cb64-7"><a href="set-up.html#cb64-7" tabindex="-1"></a>lcs_tr <span class="ot">&lt;-</span> lcs[lcs<span class="sc">$</span>treat<span class="sc">==</span><span class="dv">1</span>, ]</span>
<span id="cb64-8"><a href="set-up.html#cb64-8" tabindex="-1"></a>lcs_co <span class="ot">&lt;-</span> lcs[lcs<span class="sc">$</span>treat<span class="sc">==</span><span class="dv">0</span>, ]</span>
<span id="cb64-9"><a href="set-up.html#cb64-9" tabindex="-1"></a>lcs_co<span class="sc">$</span>treat <span class="ot">&lt;-</span>  <span class="dv">1</span></span>
<span id="cb64-10"><a href="set-up.html#cb64-10" tabindex="-1"></a>lcs_co<span class="sc">$</span>expc <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb64-11"><a href="set-up.html#cb64-11" tabindex="-1"></a>lcs_psid_plus <span class="ot">&lt;-</span> <span class="fu">rbind.data.frame</span>(lcs_psid, lcs_co)</span></code></pre></div>
<div class="sourceCode" id="cb65"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb65-1"><a href="set-up.html#cb65-1" tabindex="-1"></a><span class="co"># define variables</span></span>
<span id="cb65-2"><a href="set-up.html#cb65-2" tabindex="-1"></a>Y <span class="ot">&lt;-</span> <span class="st">&quot;re79&quot;</span></span>
<span id="cb65-3"><a href="set-up.html#cb65-3" tabindex="-1"></a>treat <span class="ot">&lt;-</span> <span class="st">&quot;treat&quot;</span></span>
<span id="cb65-4"><a href="set-up.html#cb65-4" tabindex="-1"></a><span class="co"># redefine covariates: removing &quot;nchildren75&quot; to be used as placebo outcome</span></span>
<span id="cb65-5"><a href="set-up.html#cb65-5" tabindex="-1"></a>covar <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;age&quot;</span>, <span class="st">&quot;educ&quot;</span>, <span class="st">&quot;nodegree&quot;</span>, <span class="st">&quot;married&quot;</span>, <span class="st">&quot;black&quot;</span>, <span class="st">&quot;hisp&quot;</span>, </span>
<span id="cb65-6"><a href="set-up.html#cb65-6" tabindex="-1"></a>           <span class="st">&quot;re75&quot;</span>, <span class="st">&quot;u75&quot;</span>)</span></code></pre></div>
<div class="callout-tip">
<p>In the following analysis, only PSID1 data is used as the original LaLonde study and its reconstruction by Calónico and Smith (2017) designate PSID1 as the appropriate nonexperimental control group for women, providing a comparable observational dataset that aligns with the experimental sample’s characteristics.</p>
</div>
</div>
<div id="assessing-overlap-and-covariate-balance" class="section level2 hasAnchor" number="2.3">
<h2><span class="header-section-number">2.3</span> Assessing overlap and covariate balance<a href="set-up.html#assessing-overlap-and-covariate-balance" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div id="overlap" class="section level3 hasAnchor" number="2.3.1">
<h3><span class="header-section-number">2.3.1</span> Overlap<a href="set-up.html#overlap" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb66"><pre class="sourceCode r fold-show"><code class="sourceCode r"><span id="cb66-1"><a href="set-up.html#cb66-1" tabindex="-1"></a><span class="co"># assess overlap</span></span>
<span id="cb66-2"><a href="set-up.html#cb66-2" tabindex="-1"></a>lcs.ps <span class="ot">&lt;-</span> <span class="fu">assess_overlap</span>(<span class="at">data =</span> lcs, <span class="at">treat =</span> treat, <span class="at">cov =</span> covar, <span class="at">xlim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="fl">1.5</span>, <span class="fl">1.5</span>), <span class="at">breaks =</span> <span class="dv">40</span>)</span></code></pre></div>
<div class="figure"><span style="display:block;" id="fig:unnamed-chunk-66-1"></span>
<img src="Outcome-Weights_files/figure-html/unnamed-chunk-66-1.png" alt="FIGURE1. SubfigureA:LCS-Experimental. SubfigureB:LCS-PSID1." width="100%" />
<p class="caption">
Figure 2.1: FIGURE1. SubfigureA:LCS-Experimental. SubfigureB:LCS-PSID1.
</p>
</div>
<div class="sourceCode" id="cb67"><pre class="sourceCode r fold-show"><code class="sourceCode r"><span id="cb67-1"><a href="set-up.html#cb67-1" tabindex="-1"></a>lcs_psid.ps <span class="ot">&lt;-</span> <span class="fu">assess_overlap</span>(<span class="at">data =</span> lcs_psid, <span class="at">treat =</span> treat, <span class="at">cov =</span> covar, <span class="at">xlim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">11</span>, <span class="dv">7</span>), <span class="at">breaks =</span> <span class="dv">40</span>)</span></code></pre></div>
<div class="figure"><span style="display:block;" id="fig:unnamed-chunk-66-2"></span>
<img src="Outcome-Weights_files/figure-html/unnamed-chunk-66-2.png" alt="FIGURE1. SubfigureA:LCS-Experimental. SubfigureB:LCS-PSID1." width="100%" />
<p class="caption">
Figure 2.2: FIGURE1. SubfigureA:LCS-Experimental. SubfigureB:LCS-PSID1.
</p>
</div>
<p>As anticipated, the LCS-Experimental data exhibit an almost perfect overlap. In contrast, the observational dataset LCS-PSID1 displays weak overlap.</p>
<div class="sourceCode" id="cb68"><pre class="sourceCode r fold-show"><code class="sourceCode r"><span id="cb68-1"><a href="set-up.html#cb68-1" tabindex="-1"></a><span class="co"># assess overlap</span></span>
<span id="cb68-2"><a href="set-up.html#cb68-2" tabindex="-1"></a>lcs_psid_plus.ps <span class="ot">&lt;-</span> <span class="fu">assess_overlap</span>(<span class="at">data =</span> lcs_psid_plus, <span class="at">treat =</span> treat, <span class="at">cov =</span> covar, <span class="at">xlim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">15</span>, <span class="dv">5</span>))</span></code></pre></div>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:unnamed-chunk-67"></span>
<img src="Outcome-Weights_files/figure-html/unnamed-chunk-67-1.png" alt="FIGURE2. SubfigureC:LCS-PSID1-PLUS." width="80%" />
<p class="caption">
Figure 2.3: FIGURE2. SubfigureC:LCS-PSID1-PLUS.
</p>
</div>
<p>With the expanded dataset LCS-PSID1, it is evident that the degree of overlap between treated and control groups has improved, as seen by a greater spread of log-odds densities across both samples.</p>
<div class="sourceCode" id="cb69"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb69-1"><a href="set-up.html#cb69-1" tabindex="-1"></a><span class="co"># set model formula</span></span>
<span id="cb69-2"><a href="set-up.html#cb69-2" tabindex="-1"></a>model <span class="ot">&lt;-</span> <span class="fu">as.formula</span>(<span class="fu">paste</span>(treat, <span class="st">&quot;~&quot;</span>, <span class="fu">paste</span>(covar, <span class="at">collapse =</span> <span class="st">&quot; + &quot;</span>)))</span></code></pre></div>
</div>
<div id="covariate-balance" class="section level3 hasAnchor" number="2.3.2">
<h3><span class="header-section-number">2.3.2</span> Covariate balance<a href="set-up.html#covariate-balance" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb70"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb70-1"><a href="set-up.html#cb70-1" tabindex="-1"></a><span class="fu">love.plot</span>(lcs, lcs_psid, treat, <span class="at">covar =</span> covar, <span class="at">title =</span> <span class="st">&quot;LCS-PSID1&quot;</span>)</span></code></pre></div>
<p><img src="Outcome-Weights_files/figure-html/unnamed-chunk-69-1.png" width="672" /></p>
<div class="sourceCode" id="cb71"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb71-1"><a href="set-up.html#cb71-1" tabindex="-1"></a><span class="fu">love.plot</span>(lcs, lcs_psid_plus, treat, <span class="at">covar =</span> covar, <span class="at">title =</span> <span class="st">&quot;LCS-PSID1-PLUS&quot;</span>)</span></code></pre></div>
<p><img src="Outcome-Weights_files/figure-html/unnamed-chunk-69-2.png" width="672" /></p>
<div class="sourceCode" id="cb72"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb72-1"><a href="set-up.html#cb72-1" tabindex="-1"></a><span class="fu">bal.tab</span>(model, <span class="at">data =</span> lcs_psid, <span class="at">treat =</span> <span class="st">&quot;treat&quot;</span>)</span></code></pre></div>
<pre><code>## Balance Measures
##             Type Diff.Un
## age      Contin. -0.3625
## educ     Contin. -0.4203
## nodegree  Binary  0.2478
## married   Binary  0.0016
## black     Binary  0.1823
## hisp      Binary  0.0996
## re75     Contin. -1.2050
## u75       Binary  0.4571
## 
## Sample sizes
##     Control Treated
## All     648     600</code></pre>
<div class="sourceCode" id="cb74"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb74-1"><a href="set-up.html#cb74-1" tabindex="-1"></a><span class="fu">bal.tab</span>(model, <span class="at">data =</span> lcs_psid_plus, <span class="at">treat =</span> <span class="st">&quot;treat&quot;</span>)</span></code></pre></div>
<pre><code>## Balance Measures
##             Type Diff.Un
## age      Contin. -0.3657
## educ     Contin. -0.4249
## nodegree  Binary  0.2398
## married   Binary  0.0103
## black     Binary  0.1727
## hisp      Binary  0.1061
## re75     Contin. -1.1996
## u75       Binary  0.4638
## 
## Sample sizes
##     Control Treated
## All     648    1185</code></pre>
<div class="callout-tip">
<p>Due to computational constraints, we use a reduced set of matching methods, consistent with previous sections.</p>
</div>
</div>
</div>
<div id="improving-primarily-covariate-balance" class="section level2 hasAnchor" number="2.4">
<h2><span class="header-section-number">2.4</span> Improving primarily covariate balance<a href="set-up.html#improving-primarily-covariate-balance" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div id="matching-2" class="section level3 hasAnchor" number="2.4.1">
<h3><span class="header-section-number">2.4.1</span> Matching<a href="set-up.html#matching-2" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div id="distance-matching" class="section level4 hasAnchor" number="2.4.1.1">
<h4><span class="header-section-number">2.4.1.1</span> Distance Matching<a href="set-up.html#distance-matching" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<div id="optimal-pair-matching" class="section level5 hasAnchor" number="2.4.1.1.1">
<h5><span class="header-section-number">2.4.1.1.1</span> Optimal pair matching<a href="set-up.html#optimal-pair-matching" class="anchor-section" aria-label="Anchor link to header"></a></h5>
<div class="sourceCode" id="cb76"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb76-1"><a href="set-up.html#cb76-1" tabindex="-1"></a><span class="co"># perform optimal pair matching that minimizes total within-pair distance on propensity scores</span></span>
<span id="cb76-2"><a href="set-up.html#cb76-2" tabindex="-1"></a>m.out.psid_plus.optimal_pair <span class="ot">&lt;-</span> <span class="fu">matchit</span>(model, <span class="at">data =</span> lcs_psid_plus, <span class="at">method =</span> <span class="st">&quot;optimal&quot;</span>, <span class="at">distance =</span> <span class="st">&quot;logit&quot;</span>)</span></code></pre></div>
</div>
<div id="optimal-full-matching" class="section level5 hasAnchor" number="2.4.1.1.2">
<h5><span class="header-section-number">2.4.1.1.2</span> Optimal full matching<a href="set-up.html#optimal-full-matching" class="anchor-section" aria-label="Anchor link to header"></a></h5>
<div class="sourceCode" id="cb77"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb77-1"><a href="set-up.html#cb77-1" tabindex="-1"></a><span class="co"># perform optimal full matching allowing sets with varying ratios of treated to controls and minimizing a global distance criterion</span></span>
<span id="cb77-2"><a href="set-up.html#cb77-2" tabindex="-1"></a>m.out.psid_plus.optimal_full <span class="ot">&lt;-</span> <span class="fu">matchit</span>(model, <span class="at">data =</span> lcs_psid_plus, <span class="at">method =</span> <span class="st">&quot;full&quot;</span>, <span class="at">distance =</span> <span class="st">&quot;logit&quot;</span>)</span></code></pre></div>
</div>
<div id="generalized-full-matching" class="section level5 hasAnchor" number="2.4.1.1.3">
<h5><span class="header-section-number">2.4.1.1.3</span> Generalized full matching<a href="set-up.html#generalized-full-matching" class="anchor-section" aria-label="Anchor link to header"></a></h5>
<div class="sourceCode" id="cb78"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb78-1"><a href="set-up.html#cb78-1" tabindex="-1"></a><span class="co"># perform generalized full matching using fast approximation and producing matched sets with flexible treated/control ratios </span></span>
<span id="cb78-2"><a href="set-up.html#cb78-2" tabindex="-1"></a>m.out.psid_plus.general_full <span class="ot">&lt;-</span> <span class="fu">matchit</span>(model, <span class="at">data =</span> lcs_psid_plus, <span class="at">method =</span> <span class="st">&quot;quick&quot;</span>, <span class="at">distance =</span> <span class="st">&quot;logit&quot;</span>)</span></code></pre></div>
</div>
</div>
<div id="stratum-matching" class="section level4 hasAnchor" number="2.4.1.2">
<h4><span class="header-section-number">2.4.1.2</span> Stratum matching<a href="set-up.html#stratum-matching" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<div id="coarsened-matching-cem" class="section level5 hasAnchor" number="2.4.1.2.1">
<h5><span class="header-section-number">2.4.1.2.1</span> Coarsened matching (cem)<a href="set-up.html#coarsened-matching-cem" class="anchor-section" aria-label="Anchor link to header"></a></h5>
<p>Strata = coarsened versions of covariates</p>
<div class="sourceCode" id="cb79"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb79-1"><a href="set-up.html#cb79-1" tabindex="-1"></a><span class="co"># match units exactly within coarse strata </span></span>
<span id="cb79-2"><a href="set-up.html#cb79-2" tabindex="-1"></a>m.out.psid_plus.cem <span class="ot">&lt;-</span> <span class="fu">matchit</span>(model, <span class="at">data =</span> lcs_psid_plus, <span class="at">method =</span> <span class="st">&quot;cem&quot;</span>)</span></code></pre></div>
</div>
<div id="subclassification" class="section level5 hasAnchor" number="2.4.1.2.2">
<h5><span class="header-section-number">2.4.1.2.2</span> Subclassification<a href="set-up.html#subclassification" class="anchor-section" aria-label="Anchor link to header"></a></h5>
<p>Strata = bins of the propensity score</p>
<div class="sourceCode" id="cb80"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb80-1"><a href="set-up.html#cb80-1" tabindex="-1"></a><span class="co"># partition sample into fixed number of bins based on propensity score </span></span>
<span id="cb80-2"><a href="set-up.html#cb80-2" tabindex="-1"></a>m.out.psid_plus.subcl <span class="ot">&lt;-</span> <span class="fu">matchit</span>(model, <span class="at">data =</span> lcs_psid_plus, <span class="at">method =</span> <span class="st">&quot;subclass&quot;</span>, <span class="at">subclass =</span> <span class="dv">5</span>)</span></code></pre></div>
</div>
</div>
<div id="pure-subset-selection" class="section level4 hasAnchor" number="2.4.1.3">
<h4><span class="header-section-number">2.4.1.3</span> Pure subset selection<a href="set-up.html#pure-subset-selection" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<div id="cardinality-profile-matching" class="section level5 hasAnchor" number="2.4.1.3.1">
<h5><span class="header-section-number">2.4.1.3.1</span> Cardinality profile matching<a href="set-up.html#cardinality-profile-matching" class="anchor-section" aria-label="Anchor link to header"></a></h5>
<div class="sourceCode" id="cb81"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb81-1"><a href="set-up.html#cb81-1" tabindex="-1"></a><span class="co"># select largest balanced sample meeting covariate balance tolerances</span></span>
<span id="cb81-2"><a href="set-up.html#cb81-2" tabindex="-1"></a>m.out.psid_plus.card <span class="ot">&lt;-</span> <span class="fu">matchit</span>(model, <span class="at">data =</span> lcs_psid_plus, <span class="at">method =</span> <span class="st">&quot;cardinality&quot;</span>, <span class="at">tols =</span> <span class="fl">0.1</span>, <span class="at">ratio =</span> <span class="dv">1</span>)</span></code></pre></div>
</div>
<div id="profile-matching" class="section level5 hasAnchor" number="2.4.1.3.2">
<h5><span class="header-section-number">2.4.1.3.2</span> Profile matching<a href="set-up.html#profile-matching" class="anchor-section" aria-label="Anchor link to header"></a></h5>
<div class="sourceCode" id="cb82"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb82-1"><a href="set-up.html#cb82-1" tabindex="-1"></a><span class="co"># matching by directly optimizing balance profile measures across covariates</span></span>
<span id="cb82-2"><a href="set-up.html#cb82-2" tabindex="-1"></a>m.out.psid_plus.profile <span class="ot">&lt;-</span> <span class="fu">matchit_profile</span>(lcs_psid_plus, treat, covar)</span></code></pre></div>
</div>
</div>
</div>
<div id="weighting-2" class="section level3 hasAnchor" number="2.4.2">
<h3><span class="header-section-number">2.4.2</span> Weighting<a href="set-up.html#weighting-2" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div id="inverse-probability-weights-ipw" class="section level4 hasAnchor" number="2.4.2.1">
<h4><span class="header-section-number">2.4.2.1</span> Inverse probability weights (IPW)<a href="set-up.html#inverse-probability-weights-ipw" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<div class="sourceCode" id="cb83"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb83-1"><a href="set-up.html#cb83-1" tabindex="-1"></a><span class="co"># compute weights as inverse of estimated propensity scores </span></span>
<span id="cb83-2"><a href="set-up.html#cb83-2" tabindex="-1"></a>w.out.psid_plus.ipw <span class="ot">&lt;-</span> <span class="fu">weightit</span>(model, <span class="at">data =</span> lcs_psid_plus, <span class="at">method =</span> <span class="st">&quot;ps&quot;</span>, <span class="at">estimand =</span> <span class="st">&quot;ATT&quot;</span>)</span>
<span id="cb83-3"><a href="set-up.html#cb83-3" tabindex="-1"></a></span>
<span id="cb83-4"><a href="set-up.html#cb83-4" tabindex="-1"></a>lcs_psid_plus<span class="sc">$</span>ipw_weight <span class="ot">&lt;-</span> w.out.psid_plus.ipw<span class="sc">$</span>weights</span></code></pre></div>
</div>
<div id="standardized-mortality-ratio-smr-treated-weights" class="section level4 hasAnchor" number="2.4.2.2">
<h4><span class="header-section-number">2.4.2.2</span> Standardized mortality ratio (SMR) treated weights<a href="set-up.html#standardized-mortality-ratio-smr-treated-weights" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<div class="sourceCode" id="cb84"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb84-1"><a href="set-up.html#cb84-1" tabindex="-1"></a><span class="co"># calculate weights for ATT by assigning weight = 1 to treated units and weights proportional to odds of treatment for control</span></span>
<span id="cb84-2"><a href="set-up.html#cb84-2" tabindex="-1"></a>lcs_psid_plus<span class="sc">$</span>smr_weight <span class="ot">&lt;-</span> <span class="fu">create_smr_weights</span>(lcs_psid_plus, model, <span class="st">&quot;ATT&quot;</span>)</span></code></pre></div>
</div>
<div id="matching-weights" class="section level4 hasAnchor" number="2.4.2.3">
<h4><span class="header-section-number">2.4.2.3</span> Matching weights<a href="set-up.html#matching-weights" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<div class="sourceCode" id="cb85"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb85-1"><a href="set-up.html#cb85-1" tabindex="-1"></a><span class="co"># derive optimal matching weights intending to minimize covariate imbalance while targeting ATT</span></span>
<span id="cb85-2"><a href="set-up.html#cb85-2" tabindex="-1"></a>w.out.psid_plus.opt <span class="ot">&lt;-</span> <span class="fu">weightit</span>(model, <span class="at">data =</span> lcs_psid_plus, <span class="at">method =</span> <span class="st">&quot;optweight&quot;</span>, <span class="at">estimand =</span> <span class="st">&quot;ATT&quot;</span>)</span>
<span id="cb85-3"><a href="set-up.html#cb85-3" tabindex="-1"></a></span>
<span id="cb85-4"><a href="set-up.html#cb85-4" tabindex="-1"></a>lcs_psid_plus<span class="sc">$</span>opt_weight <span class="ot">&lt;-</span> w.out.psid_plus.opt<span class="sc">$</span>weights</span></code></pre></div>
</div>
<div id="overlap-weights" class="section level4 hasAnchor" number="2.4.2.4">
<h4><span class="header-section-number">2.4.2.4</span> Overlap weights<a href="set-up.html#overlap-weights" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<div class="sourceCode" id="cb86"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb86-1"><a href="set-up.html#cb86-1" tabindex="-1"></a><span class="co"># calculate overlap weights emphasizing units with propensity scores near 0.5</span></span>
<span id="cb86-2"><a href="set-up.html#cb86-2" tabindex="-1"></a>lcs_psid_plus<span class="sc">$</span>overlap_weight <span class="ot">&lt;-</span> <span class="fu">create_overlap_weights</span>(lcs_psid_plus, model)</span></code></pre></div>
</div>
<div id="entropy-weights" class="section level4 hasAnchor" number="2.4.2.5">
<h4><span class="header-section-number">2.4.2.5</span> Entropy weights<a href="set-up.html#entropy-weights" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<div class="sourceCode" id="cb87"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb87-1"><a href="set-up.html#cb87-1" tabindex="-1"></a><span class="co"># compute entropy balancing weights </span></span>
<span id="cb87-2"><a href="set-up.html#cb87-2" tabindex="-1"></a>w.out.psid_plus.ebal <span class="ot">&lt;-</span> <span class="fu">weightit</span>(model, <span class="at">data =</span> lcs_psid_plus, <span class="at">method =</span> <span class="st">&quot;ebal&quot;</span>, <span class="at">estimand =</span> <span class="st">&quot;ATT&quot;</span>)</span>
<span id="cb87-3"><a href="set-up.html#cb87-3" tabindex="-1"></a></span>
<span id="cb87-4"><a href="set-up.html#cb87-4" tabindex="-1"></a>lcs_psid_plus<span class="sc">$</span>ebal_weight <span class="ot">&lt;-</span> w.out.psid_plus.ebal<span class="sc">$</span>weights</span></code></pre></div>
</div>
</div>
</div>
<div id="improving-primarily-overlap" class="section level2 hasAnchor" number="2.5">
<h2><span class="header-section-number">2.5</span> Improving primarily overlap<a href="set-up.html#improving-primarily-overlap" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div id="truncation-2" class="section level3 hasAnchor" number="2.5.1">
<h3><span class="header-section-number">2.5.1</span> Truncation<a href="set-up.html#truncation-2" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb88"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb88-1"><a href="set-up.html#cb88-1" tabindex="-1"></a><span class="co"># list of weight columns to apply truncation </span></span>
<span id="cb88-2"><a href="set-up.html#cb88-2" tabindex="-1"></a>weight_columns <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;ipw_weight&quot;</span>, <span class="st">&quot;smr_weight&quot;</span>, <span class="st">&quot;opt_weight&quot;</span>, <span class="st">&quot;overlap_weight&quot;</span>, <span class="st">&quot;ebal_weight&quot;</span>)</span></code></pre></div>
<div id="fixed-maximum-value-truncation" class="section level4 hasAnchor" number="2.5.1.1">
<h4><span class="header-section-number">2.5.1.1</span> Fixed maximum value truncation<a href="set-up.html#fixed-maximum-value-truncation" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<div class="sourceCode" id="cb89"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb89-1"><a href="set-up.html#cb89-1" tabindex="-1"></a><span class="co"># truncate weights by imposing a maximum threshold of 10</span></span>
<span id="cb89-2"><a href="set-up.html#cb89-2" tabindex="-1"></a>lcs_psid_plus.fixed <span class="ot">&lt;-</span> lcs_psid_plus</span>
<span id="cb89-3"><a href="set-up.html#cb89-3" tabindex="-1"></a><span class="cf">for</span> (wcol <span class="cf">in</span> weight_columns) {</span>
<span id="cb89-4"><a href="set-up.html#cb89-4" tabindex="-1"></a>  <span class="cf">if</span> (wcol <span class="sc">%in%</span> <span class="fu">names</span>(lcs_psid_plus.fixed)) {</span>
<span id="cb89-5"><a href="set-up.html#cb89-5" tabindex="-1"></a>    lcs_psid_plus.fixed <span class="ot">&lt;-</span> <span class="fu">truncate_weights_fixed</span>(lcs_psid_plus.fixed, <span class="at">weight_col =</span> wcol, <span class="at">max_weight =</span> <span class="dv">10</span>)</span>
<span id="cb89-6"><a href="set-up.html#cb89-6" tabindex="-1"></a>  }</span>
<span id="cb89-7"><a href="set-up.html#cb89-7" tabindex="-1"></a>}</span></code></pre></div>
</div>
<div id="at-percentile-truncation" class="section level4 hasAnchor" number="2.5.1.2">
<h4><span class="header-section-number">2.5.1.2</span> At percentile truncation<a href="set-up.html#at-percentile-truncation" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<div class="sourceCode" id="cb90"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb90-1"><a href="set-up.html#cb90-1" tabindex="-1"></a><span class="co"># truncate weights such that values above the 99th percentile are capped</span></span>
<span id="cb90-2"><a href="set-up.html#cb90-2" tabindex="-1"></a>lcs_psid_plus.percent <span class="ot">&lt;-</span> lcs_psid_plus</span>
<span id="cb90-3"><a href="set-up.html#cb90-3" tabindex="-1"></a><span class="cf">for</span> (wcol <span class="cf">in</span> weight_columns) {</span>
<span id="cb90-4"><a href="set-up.html#cb90-4" tabindex="-1"></a>  <span class="cf">if</span> (wcol <span class="sc">%in%</span> <span class="fu">names</span>(lcs_psid_plus.percent)) {</span>
<span id="cb90-5"><a href="set-up.html#cb90-5" tabindex="-1"></a>    lcs_psid_plus.percent <span class="ot">&lt;-</span> <span class="fu">truncate_weights_percentile</span>(lcs_psid_plus.percent, <span class="at">weight_col =</span> wcol, <span class="at">percentile =</span> <span class="fl">0.99</span>)</span>
<span id="cb90-6"><a href="set-up.html#cb90-6" tabindex="-1"></a>  }</span>
<span id="cb90-7"><a href="set-up.html#cb90-7" tabindex="-1"></a>}</span></code></pre></div>
</div>
<div id="adaptive-weight-truncation" class="section level4 hasAnchor" number="2.5.1.3">
<h4><span class="header-section-number">2.5.1.3</span> Adaptive weight truncation<a href="set-up.html#adaptive-weight-truncation" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<div class="sourceCode" id="cb91"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb91-1"><a href="set-up.html#cb91-1" tabindex="-1"></a><span class="co"># inspect variance of weights </span></span>
<span id="cb91-2"><a href="set-up.html#cb91-2" tabindex="-1"></a><span class="cf">for</span> (wcol <span class="cf">in</span> weight_columns) {</span>
<span id="cb91-3"><a href="set-up.html#cb91-3" tabindex="-1"></a>  <span class="cf">if</span> (wcol <span class="sc">%in%</span> <span class="fu">names</span>(lcs_psid_plus)) {</span>
<span id="cb91-4"><a href="set-up.html#cb91-4" tabindex="-1"></a>    <span class="fu">check_weights</span>(lcs_psid_plus, wcol)</span>
<span id="cb91-5"><a href="set-up.html#cb91-5" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb91-6"><a href="set-up.html#cb91-6" tabindex="-1"></a>    <span class="fu">cat</span>(<span class="st">&quot;Column&quot;</span>, wcol, <span class="st">&quot;not found in lcs_cps.plus</span><span class="sc">\n</span><span class="st">&quot;</span>)</span>
<span id="cb91-7"><a href="set-up.html#cb91-7" tabindex="-1"></a>  }</span>
<span id="cb91-8"><a href="set-up.html#cb91-8" tabindex="-1"></a>}</span></code></pre></div>
<pre><code>## Variance of ipw_weight : 4.872478 
## Variance of smr_weight : 5.740746 
## Variance of opt_weight : 0.8335116 
## Variance of overlap_weight : 0.06202534 
## Variance of ebal_weight : 1.000067</code></pre>
<p>Regarding these results we can apply adaptive weight truncation to all considered weights.</p>
<div class="sourceCode" id="cb93"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb93-1"><a href="set-up.html#cb93-1" tabindex="-1"></a><span class="co"># truncate adaptively at mean + 3 standard deviations </span></span>
<span id="cb93-2"><a href="set-up.html#cb93-2" tabindex="-1"></a>lcs_psid_plus.adapt <span class="ot">&lt;-</span> lcs_psid_plus</span>
<span id="cb93-3"><a href="set-up.html#cb93-3" tabindex="-1"></a><span class="cf">for</span> (wcol <span class="cf">in</span> weight_columns) {</span>
<span id="cb93-4"><a href="set-up.html#cb93-4" tabindex="-1"></a>  <span class="cf">if</span> (wcol <span class="sc">%in%</span> <span class="fu">names</span>(lcs_psid_plus.adapt)) {</span>
<span id="cb93-5"><a href="set-up.html#cb93-5" tabindex="-1"></a>    lcs_psid_plus.adapt <span class="ot">&lt;-</span> <span class="fu">truncate_weights_adaptive</span>(lcs_psid_plus.adapt, <span class="at">weight_col =</span> wcol, <span class="at">c =</span> <span class="dv">3</span>)</span>
<span id="cb93-6"><a href="set-up.html#cb93-6" tabindex="-1"></a>  }</span>
<span id="cb93-7"><a href="set-up.html#cb93-7" tabindex="-1"></a>}</span></code></pre></div>
</div>
</div>
<div id="trimming-2" class="section level3 hasAnchor" number="2.5.2">
<h3><span class="header-section-number">2.5.2</span> Trimming<a href="set-up.html#trimming-2" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div id="propensity-score-threshold-trimming-analogous-to-tutorial-of-imbens-xu-2024" class="section level4 hasAnchor" number="2.5.2.1">
<h4><span class="header-section-number">2.5.2.1</span> Propensity score threshold trimming (analogous to tutorial of Imbens &amp; Xu (2024))<a href="set-up.html#propensity-score-threshold-trimming-analogous-to-tutorial-of-imbens-xu-2024" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<div class="sourceCode" id="cb94"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb94-1"><a href="set-up.html#cb94-1" tabindex="-1"></a><span class="co"># apply trimming with threshold 0.9</span></span>
<span id="cb94-2"><a href="set-up.html#cb94-2" tabindex="-1"></a>lcs_psid_trim <span class="ot">&lt;-</span> <span class="fu">ps_trim</span>(lcs_psid_plus.ps, <span class="at">threshold =</span> <span class="fl">0.9</span>)</span>
<span id="cb94-3"><a href="set-up.html#cb94-3" tabindex="-1"></a></span>
<span id="cb94-4"><a href="set-up.html#cb94-4" tabindex="-1"></a><span class="co"># exclude experimental controls, subset trimmed data appropriately</span></span>
<span id="cb94-5"><a href="set-up.html#cb94-5" tabindex="-1"></a>lcs_psid.trim_match <span class="ot">&lt;-</span> <span class="fu">subset</span>(lcs_psid_trim, expc <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">2</span>) <span class="sc">&amp;</span> ps_assoverlap)</span>
<span id="cb94-6"><a href="set-up.html#cb94-6" tabindex="-1"></a></span>
<span id="cb94-7"><a href="set-up.html#cb94-7" tabindex="-1"></a><span class="co"># re-estimate propensity scores on trimmed data and perform 1:1 matching</span></span>
<span id="cb94-8"><a href="set-up.html#cb94-8" tabindex="-1"></a>lcs_psid.trim_match <span class="ot">&lt;-</span> <span class="fu">psmatch</span>(<span class="at">data =</span> lcs_psid.trim_match, <span class="at">Y =</span> <span class="st">&quot;re79&quot;</span>, <span class="at">treat =</span> <span class="st">&quot;treat&quot;</span>, <span class="at">cov =</span> covar)</span>
<span id="cb94-9"><a href="set-up.html#cb94-9" tabindex="-1"></a></span>
<span id="cb94-10"><a href="set-up.html#cb94-10" tabindex="-1"></a><span class="co"># trim experimental data and re-assign treat variable for controls in sample 3 or 4 (non-treated group)</span></span>
<span id="cb94-11"><a href="set-up.html#cb94-11" tabindex="-1"></a><span class="co">#lcs_trim_psid &lt;- subset(lcs_psid_trim, expc %in% c(0, 1))</span></span>
<span id="cb94-12"><a href="set-up.html#cb94-12" tabindex="-1"></a><span class="co">#lcs_trim_psid$treat[lcs_trim_psid$expc == 1] &lt;- 0</span></span></code></pre></div>
</div>
<div id="common-range-trimming" class="section level4 hasAnchor" number="2.5.2.2">
<h4><span class="header-section-number">2.5.2.2</span> Common range trimming<a href="set-up.html#common-range-trimming" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<div class="sourceCode" id="cb95"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb95-1"><a href="set-up.html#cb95-1" tabindex="-1"></a><span class="co"># trim observations outside the common support region of propensity scores</span></span>
<span id="cb95-2"><a href="set-up.html#cb95-2" tabindex="-1"></a>lcs_psid_plus.common  <span class="ot">&lt;-</span> <span class="fu">common_range_trim</span>(lcs_psid_plus.ps)</span></code></pre></div>
</div>
<div id="propensity-score-trimming-crump" class="section level4 hasAnchor" number="2.5.2.3">
<h4><span class="header-section-number">2.5.2.3</span> Propensity score trimming (Crump)<a href="set-up.html#propensity-score-trimming-crump" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<div class="sourceCode" id="cb96"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb96-1"><a href="set-up.html#cb96-1" tabindex="-1"></a><span class="co"># trim observations with propensity scores outside [0.1, 0.9] interval</span></span>
<span id="cb96-2"><a href="set-up.html#cb96-2" tabindex="-1"></a>lcs_psid_plus.crump <span class="ot">&lt;-</span> <span class="fu">crump_trim</span>(lcs_psid_plus.ps, <span class="at">lower =</span> <span class="fl">0.1</span>, <span class="at">upper =</span> <span class="fl">0.9</span>)</span></code></pre></div>
</div>
<div id="stuermer-trimming" class="section level4 hasAnchor" number="2.5.2.4">
<h4><span class="header-section-number">2.5.2.4</span> Stuermer trimming<a href="set-up.html#stuermer-trimming" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<div class="sourceCode" id="cb97"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb97-1"><a href="set-up.html#cb97-1" tabindex="-1"></a><span class="co"># trim observations based on propensity score quantiles separately for treated and control</span></span>
<span id="cb97-2"><a href="set-up.html#cb97-2" tabindex="-1"></a>lcs_psid_plus.stuermer <span class="ot">&lt;-</span> <span class="fu">stuermer_trim</span>(lcs_psid_plus.ps)</span></code></pre></div>
</div>
<div id="walker-trimming" class="section level4 hasAnchor" number="2.5.2.5">
<h4><span class="header-section-number">2.5.2.5</span> Walker trimming<a href="set-up.html#walker-trimming" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<div class="sourceCode" id="cb98"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb98-1"><a href="set-up.html#cb98-1" tabindex="-1"></a><span class="co"># trim observations based on preference scores that adjust for treatment prevalence using logit transformations</span></span>
<span id="cb98-2"><a href="set-up.html#cb98-2" tabindex="-1"></a>lcs_psid_plus.walker  <span class="ot">&lt;-</span> <span class="fu">walker_trim</span>(lcs_psid_plus.ps)</span></code></pre></div>
</div>
</div>
<div id="combination-of-methods" class="section level3 hasAnchor" number="2.5.3">
<h3><span class="header-section-number">2.5.3</span> Combination of methods<a href="set-up.html#combination-of-methods" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb99"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb99-1"><a href="set-up.html#cb99-1" tabindex="-1"></a><span class="co"># list trimming methods</span></span>
<span id="cb99-2"><a href="set-up.html#cb99-2" tabindex="-1"></a>trim_names <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;ps_threshold&quot;</span>, <span class="st">&quot;common_range&quot;</span>, <span class="st">&quot;stuermer&quot;</span>, <span class="st">&quot;walker&quot;</span>, <span class="st">&quot;crump&quot;</span>)</span>
<span id="cb99-3"><a href="set-up.html#cb99-3" tabindex="-1"></a>trimmed_psid <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="at">ps_threshold =</span> lcs_psid_trim, <span class="at">common_range =</span> lcs_psid_plus.common, <span class="at">stuermer =</span> lcs_psid_plus.stuermer, <span class="at">walker =</span> lcs_psid_plus.walker, <span class="at">crump =</span> lcs_psid_plus.crump)</span></code></pre></div>
<div id="ipw-with-1-propensity-threshold-2-common-range-3-stuermer-4-walker-5-crump" class="section level4 hasAnchor" number="2.5.3.1">
<h4><span class="header-section-number">2.5.3.1</span> IPW with 1) propensity threshold 2) common range 3) stuermer 4) walker 5) crump<a href="set-up.html#ipw-with-1-propensity-threshold-2-common-range-3-stuermer-4-walker-5-crump" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<div class="sourceCode" id="cb100"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb100-1"><a href="set-up.html#cb100-1" tabindex="-1"></a><span class="co"># apply inverse probability weighting (IPW) with trimming and attach IPW weights</span></span>
<span id="cb100-2"><a href="set-up.html#cb100-2" tabindex="-1"></a>ipw_comb.psid_plus <span class="ot">&lt;-</span> <span class="fu">setNames</span>(</span>
<span id="cb100-3"><a href="set-up.html#cb100-3" tabindex="-1"></a>  <span class="fu">lapply</span>(trim_names, <span class="cf">function</span>(nm) <span class="fu">trim_attach_weights</span>(trimmed_psid[[nm]], lcs_psid_plus, <span class="st">&quot;ipw_weight&quot;</span>)),</span>
<span id="cb100-4"><a href="set-up.html#cb100-4" tabindex="-1"></a>  trim_names</span>
<span id="cb100-5"><a href="set-up.html#cb100-5" tabindex="-1"></a>)</span></code></pre></div>
</div>
<div id="smr-treated-weights-with-1-propensity-threshold-2-common-range-3-stuermer-4-walker-5-crump" class="section level4 hasAnchor" number="2.5.3.2">
<h4><span class="header-section-number">2.5.3.2</span> SMR treated weights with 1) propensity threshold 2) common range 3) stuermer 4) walker 5) crump<a href="set-up.html#smr-treated-weights-with-1-propensity-threshold-2-common-range-3-stuermer-4-walker-5-crump" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<div class="sourceCode" id="cb101"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb101-1"><a href="set-up.html#cb101-1" tabindex="-1"></a><span class="co"># apply standardized mortality ratio (SMR) weighting with trimming and attach SMR weights</span></span>
<span id="cb101-2"><a href="set-up.html#cb101-2" tabindex="-1"></a>smr_treat_comb.psid_plus <span class="ot">&lt;-</span> <span class="fu">setNames</span>(</span>
<span id="cb101-3"><a href="set-up.html#cb101-3" tabindex="-1"></a>  <span class="fu">lapply</span>(trim_names, <span class="cf">function</span>(nm) <span class="fu">trim_attach_weights</span>(trimmed_psid[[nm]], lcs_psid_plus, <span class="st">&quot;smr_weight&quot;</span>)),</span>
<span id="cb101-4"><a href="set-up.html#cb101-4" tabindex="-1"></a>  trim_names</span>
<span id="cb101-5"><a href="set-up.html#cb101-5" tabindex="-1"></a>)</span></code></pre></div>
</div>
<div id="overlap-weights-with-1-propensity-threshold-2-common-range-3-stuermer-4-walker-5-crump" class="section level4 hasAnchor" number="2.5.3.3">
<h4><span class="header-section-number">2.5.3.3</span> Overlap weights with 1) propensity threshold 2) common range 3) stuermer 4) walker 5) crump<a href="set-up.html#overlap-weights-with-1-propensity-threshold-2-common-range-3-stuermer-4-walker-5-crump" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<div class="sourceCode" id="cb102"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb102-1"><a href="set-up.html#cb102-1" tabindex="-1"></a><span class="co"># apply overlap weighting with trimming and attach overlap weights</span></span>
<span id="cb102-2"><a href="set-up.html#cb102-2" tabindex="-1"></a>ov_comb.psid_plus <span class="ot">&lt;-</span> <span class="fu">setNames</span>(</span>
<span id="cb102-3"><a href="set-up.html#cb102-3" tabindex="-1"></a>  <span class="fu">lapply</span>(trim_names, <span class="cf">function</span>(nm) <span class="fu">trim_attach_weights</span>(trimmed_psid[[nm]], lcs_psid_plus, <span class="st">&quot;overlap_weight&quot;</span>)),</span>
<span id="cb102-4"><a href="set-up.html#cb102-4" tabindex="-1"></a>  trim_names</span>
<span id="cb102-5"><a href="set-up.html#cb102-5" tabindex="-1"></a>)</span></code></pre></div>
</div>
<div id="entropy-weights-with-1-propensity-threshold-2-common-range-3-stuermer-4-walker-5-crump" class="section level4 hasAnchor" number="2.5.3.4">
<h4><span class="header-section-number">2.5.3.4</span> Entropy weights with 1) propensity threshold 2) common range 3) stuermer 4) walker 5) crump<a href="set-up.html#entropy-weights-with-1-propensity-threshold-2-common-range-3-stuermer-4-walker-5-crump" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<div class="sourceCode" id="cb103"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb103-1"><a href="set-up.html#cb103-1" tabindex="-1"></a><span class="co"># apply entropy balancing weights with trimming and attach entropy weights</span></span>
<span id="cb103-2"><a href="set-up.html#cb103-2" tabindex="-1"></a>entropy_comb.psid_plus <span class="ot">&lt;-</span> <span class="fu">setNames</span>(</span>
<span id="cb103-3"><a href="set-up.html#cb103-3" tabindex="-1"></a>  <span class="fu">lapply</span>(trim_names, <span class="cf">function</span>(nm) <span class="fu">trim_attach_weights</span>(trimmed_psid[[nm]], lcs_psid_plus, <span class="st">&quot;ebal_weight&quot;</span>)),</span>
<span id="cb103-4"><a href="set-up.html#cb103-4" tabindex="-1"></a>  trim_names</span>
<span id="cb103-5"><a href="set-up.html#cb103-5" tabindex="-1"></a>)</span></code></pre></div>
</div>
</div>
</div>
<div id="reassessing-methods-1" class="section level2 hasAnchor" number="2.6">
<h2><span class="header-section-number">2.6</span> Reassessing methods<a href="set-up.html#reassessing-methods-1" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div id="matching-3" class="section level3 hasAnchor" number="2.6.1">
<h3><span class="header-section-number">2.6.1</span> Matching<a href="set-up.html#matching-3" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb104"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb104-1"><a href="set-up.html#cb104-1" tabindex="-1"></a><span class="co"># list all matching methods</span></span>
<span id="cb104-2"><a href="set-up.html#cb104-2" tabindex="-1"></a>methods.psid_plus <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb104-3"><a href="set-up.html#cb104-3" tabindex="-1"></a>  <span class="at">optimal_pair =</span> m.out.psid_plus.optimal_pair,</span>
<span id="cb104-4"><a href="set-up.html#cb104-4" tabindex="-1"></a>  <span class="at">optimal_full =</span> m.out.psid_plus.optimal_full,</span>
<span id="cb104-5"><a href="set-up.html#cb104-5" tabindex="-1"></a>  <span class="at">gen_full =</span> m.out.psid_plus.general_full,</span>
<span id="cb104-6"><a href="set-up.html#cb104-6" tabindex="-1"></a>  <span class="at">cem =</span> m.out.psid_plus.cem,</span>
<span id="cb104-7"><a href="set-up.html#cb104-7" tabindex="-1"></a>  <span class="at">card =</span> m.out.psid_plus.card,</span>
<span id="cb104-8"><a href="set-up.html#cb104-8" tabindex="-1"></a>  <span class="at">profile =</span> m.out.psid_plus.profile,</span>
<span id="cb104-9"><a href="set-up.html#cb104-9" tabindex="-1"></a>  <span class="at">subcl =</span> m.out.psid_plus.subcl</span>
<span id="cb104-10"><a href="set-up.html#cb104-10" tabindex="-1"></a>)</span></code></pre></div>
<div class="sourceCode" id="cb105"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb105-1"><a href="set-up.html#cb105-1" tabindex="-1"></a><span class="co"># calculate balance statistics </span></span>
<span id="cb105-2"><a href="set-up.html#cb105-2" tabindex="-1"></a>bal.psid_plus <span class="ot">&lt;-</span> cobalt<span class="sc">::</span><span class="fu">bal.tab</span>(model, <span class="at">data =</span> lcs_psid_plus, <span class="at">un =</span> <span class="cn">TRUE</span>, <span class="at">weights =</span> methods.psid_plus, <span class="at">s.d.denom =</span> <span class="st">&quot;treated&quot;</span>)</span></code></pre></div>
<div id="smd" class="section level4 hasAnchor" number="2.6.1.1">
<h4><span class="header-section-number">2.6.1.1</span> SMD<a href="set-up.html#smd" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<div class="sourceCode" id="cb106"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb106-1"><a href="set-up.html#cb106-1" tabindex="-1"></a><span class="co"># compute SMDs</span></span>
<span id="cb106-2"><a href="set-up.html#cb106-2" tabindex="-1"></a>smd_matchit.psid_plus <span class="ot">&lt;-</span> <span class="fu">compute_abs_smd_matchit</span>(methods.psid_plus)</span></code></pre></div>
</div>
<div id="ess" class="section level4 hasAnchor" number="2.6.1.2">
<h4><span class="header-section-number">2.6.1.2</span> ESS<a href="set-up.html#ess" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<div class="sourceCode" id="cb107"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb107-1"><a href="set-up.html#cb107-1" tabindex="-1"></a><span class="co"># compute effective sample sizes (ESS)</span></span>
<span id="cb107-2"><a href="set-up.html#cb107-2" tabindex="-1"></a>ess_matchit.psid_plus <span class="ot">&lt;-</span> <span class="fu">compute_ess_matchit</span>(bal.psid_plus)</span></code></pre></div>
</div>
<div id="visuals" class="section level4 hasAnchor" number="2.6.1.3">
<h4><span class="header-section-number">2.6.1.3</span> Visuals<a href="set-up.html#visuals" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<div class="sourceCode" id="cb108"><pre class="sourceCode r fold-show"><code class="sourceCode r"><span id="cb108-1"><a href="set-up.html#cb108-1" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">2</span>))</span>
<span id="cb108-2"><a href="set-up.html#cb108-2" tabindex="-1"></a><span class="fu">par</span>(<span class="at">cex.main =</span> <span class="fl">0.6</span>)</span>
<span id="cb108-3"><a href="set-up.html#cb108-3" tabindex="-1"></a><span class="co"># visualize covariate balance </span></span>
<span id="cb108-4"><a href="set-up.html#cb108-4" tabindex="-1"></a><span class="fu">plot_matchit</span>(methods.psid_plus, <span class="st">&quot;LCS-PSID1-PLUS&quot;</span>)</span></code></pre></div>
<div class="figure"><span style="display:block;" id="fig:unnamed-chunk-101-1"></span>
<img src="Outcome-Weights_files/figure-html/unnamed-chunk-101-1.png" alt="FIGURE3." width="672" />
<p class="caption">
Figure 2.4: FIGURE3.
</p>
</div>
<div class="figure"><span style="display:block;" id="fig:unnamed-chunk-101-2"></span>
<img src="Outcome-Weights_files/figure-html/unnamed-chunk-101-2.png" alt="FIGURE3." width="672" />
<p class="caption">
Figure 2.5: FIGURE3.
</p>
</div>
<div class="figure"><span style="display:block;" id="fig:unnamed-chunk-101-3"></span>
<img src="Outcome-Weights_files/figure-html/unnamed-chunk-101-3.png" alt="FIGURE3." width="672" />
<p class="caption">
Figure 2.6: FIGURE3.
</p>
</div>
<div class="figure"><span style="display:block;" id="fig:unnamed-chunk-101-4"></span>
<img src="Outcome-Weights_files/figure-html/unnamed-chunk-101-4.png" alt="FIGURE3." width="672" />
<p class="caption">
Figure 2.7: FIGURE3.
</p>
</div>
<div class="figure"><span style="display:block;" id="fig:unnamed-chunk-101-5"></span>
<img src="Outcome-Weights_files/figure-html/unnamed-chunk-101-5.png" alt="FIGURE3." width="672" />
<p class="caption">
Figure 2.8: FIGURE3.
</p>
</div>
<div class="figure"><span style="display:block;" id="fig:unnamed-chunk-101-6"></span>
<img src="Outcome-Weights_files/figure-html/unnamed-chunk-101-6.png" alt="FIGURE3." width="672" />
<p class="caption">
Figure 2.9: FIGURE3.
</p>
</div>
<div class="figure"><span style="display:block;" id="fig:unnamed-chunk-101-7"></span>
<img src="Outcome-Weights_files/figure-html/unnamed-chunk-101-7.png" alt="FIGURE3." width="672" />
<p class="caption">
Figure 2.10: FIGURE3.
</p>
</div>
</div>
</div>
<div id="weighting-3" class="section level3 hasAnchor" number="2.6.2">
<h3><span class="header-section-number">2.6.2</span> Weighting<a href="set-up.html#weighting-3" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb109"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb109-1"><a href="set-up.html#cb109-1" tabindex="-1"></a><span class="co"># list all weights</span></span>
<span id="cb109-2"><a href="set-up.html#cb109-2" tabindex="-1"></a>weight.psid_plus <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb109-3"><a href="set-up.html#cb109-3" tabindex="-1"></a>  <span class="at">ipw =</span> lcs_psid_plus<span class="sc">$</span>ipw_weight,</span>
<span id="cb109-4"><a href="set-up.html#cb109-4" tabindex="-1"></a>  <span class="at">smr_tr =</span> lcs_psid_plus<span class="sc">$</span>smr_weight,</span>
<span id="cb109-5"><a href="set-up.html#cb109-5" tabindex="-1"></a>  <span class="at">mw =</span> lcs_psid_plus<span class="sc">$</span>opt_weight,</span>
<span id="cb109-6"><a href="set-up.html#cb109-6" tabindex="-1"></a>  <span class="at">ow =</span> lcs_psid_plus<span class="sc">$</span>overlap_weight,</span>
<span id="cb109-7"><a href="set-up.html#cb109-7" tabindex="-1"></a>  <span class="at">ew =</span> lcs_psid_plus<span class="sc">$</span>ebal_weight</span>
<span id="cb109-8"><a href="set-up.html#cb109-8" tabindex="-1"></a>)</span></code></pre></div>
<div id="smd-1" class="section level4 hasAnchor" number="2.6.2.1">
<h4><span class="header-section-number">2.6.2.1</span> SMD<a href="set-up.html#smd-1" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<div class="sourceCode" id="cb110"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb110-1"><a href="set-up.html#cb110-1" tabindex="-1"></a><span class="co"># compute SMDs </span></span>
<span id="cb110-2"><a href="set-up.html#cb110-2" tabindex="-1"></a>smd_weight.psid_plus <span class="ot">&lt;-</span> <span class="fu">compute_abs_smd_weight</span>(lcs_psid_plus, <span class="st">&quot;treat&quot;</span>, covar, weight_columns)</span></code></pre></div>
</div>
<div id="ess-1" class="section level4 hasAnchor" number="2.6.2.2">
<h4><span class="header-section-number">2.6.2.2</span> ESS<a href="set-up.html#ess-1" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<div class="sourceCode" id="cb111"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb111-1"><a href="set-up.html#cb111-1" tabindex="-1"></a><span class="co"># compute ESS</span></span>
<span id="cb111-2"><a href="set-up.html#cb111-2" tabindex="-1"></a>ess_weight.psid_plus <span class="ot">&lt;-</span> <span class="fu">compute_ess_weight</span>(lcs_psid_plus, <span class="st">&quot;treat&quot;</span>, covar, weight_columns)</span></code></pre></div>
</div>
<div id="visuals-1" class="section level4 hasAnchor" number="2.6.2.3">
<h4><span class="header-section-number">2.6.2.3</span> Visuals<a href="set-up.html#visuals-1" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<div class="sourceCode" id="cb112"><pre class="sourceCode r fold-show"><code class="sourceCode r"><span id="cb112-1"><a href="set-up.html#cb112-1" tabindex="-1"></a><span class="co"># visualize covariate balance</span></span>
<span id="cb112-2"><a href="set-up.html#cb112-2" tabindex="-1"></a><span class="fu">plot_weighting_methods</span>(lcs_psid_plus, <span class="st">&quot;treat&quot;</span>, covar, weight.psid_plus, <span class="st">&quot;LCS-PSID1-PLUS&quot;</span>)</span></code></pre></div>
<div class="figure"><span style="display:block;" id="fig:unnamed-chunk-105-1"></span>
<img src="Outcome-Weights_files/figure-html/unnamed-chunk-105-1.png" alt="FIGURE4." width="672" />
<p class="caption">
Figure 2.11: FIGURE4.
</p>
</div>
<div class="figure"><span style="display:block;" id="fig:unnamed-chunk-105-2"></span>
<img src="Outcome-Weights_files/figure-html/unnamed-chunk-105-2.png" alt="FIGURE4." width="672" />
<p class="caption">
Figure 2.12: FIGURE4.
</p>
</div>
<div class="figure"><span style="display:block;" id="fig:unnamed-chunk-105-3"></span>
<img src="Outcome-Weights_files/figure-html/unnamed-chunk-105-3.png" alt="FIGURE4." width="672" />
<p class="caption">
Figure 2.13: FIGURE4.
</p>
</div>
<div class="figure"><span style="display:block;" id="fig:unnamed-chunk-105-4"></span>
<img src="Outcome-Weights_files/figure-html/unnamed-chunk-105-4.png" alt="FIGURE4." width="672" />
<p class="caption">
Figure 2.14: FIGURE4.
</p>
</div>
<div class="figure"><span style="display:block;" id="fig:unnamed-chunk-105-5"></span>
<img src="Outcome-Weights_files/figure-html/unnamed-chunk-105-5.png" alt="FIGURE4." width="672" />
<p class="caption">
Figure 2.15: FIGURE4.
</p>
</div>
</div>
</div>
<div id="truncation-3" class="section level3 hasAnchor" number="2.6.3">
<h3><span class="header-section-number">2.6.3</span> Truncation<a href="set-up.html#truncation-3" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Methods</p>
<div class="sourceCode" id="cb113"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb113-1"><a href="set-up.html#cb113-1" tabindex="-1"></a><span class="co"># list truncation methods</span></span>
<span id="cb113-2"><a href="set-up.html#cb113-2" tabindex="-1"></a>trunc.psid_plus <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb113-3"><a href="set-up.html#cb113-3" tabindex="-1"></a>  <span class="at">fix_max_value_trunc.psid_plus =</span> lcs_psid_plus.fixed,</span>
<span id="cb113-4"><a href="set-up.html#cb113-4" tabindex="-1"></a>  <span class="at">at_perc_trunc.psid_plus =</span> lcs_psid_plus.percent,</span>
<span id="cb113-5"><a href="set-up.html#cb113-5" tabindex="-1"></a>  <span class="at">adap_weight_trunc.psid_plus =</span> lcs_psid_plus.adapt</span>
<span id="cb113-6"><a href="set-up.html#cb113-6" tabindex="-1"></a>)</span></code></pre></div>
<div id="smd-2" class="section level4 hasAnchor" number="2.6.3.1">
<h4><span class="header-section-number">2.6.3.1</span> SMD<a href="set-up.html#smd-2" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<div class="sourceCode" id="cb114"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb114-1"><a href="set-up.html#cb114-1" tabindex="-1"></a><span class="co"># compute SMDs</span></span>
<span id="cb114-2"><a href="set-up.html#cb114-2" tabindex="-1"></a>smd_trunc.psid_plus <span class="ot">&lt;-</span> <span class="fu">compute_abs_smd_trunc</span>(trunc.psid_plus, <span class="st">&quot;treat&quot;</span>, covar, weight_columns)</span></code></pre></div>
</div>
<div id="ess-2" class="section level4 hasAnchor" number="2.6.3.2">
<h4><span class="header-section-number">2.6.3.2</span> ESS<a href="set-up.html#ess-2" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<div class="sourceCode" id="cb115"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb115-1"><a href="set-up.html#cb115-1" tabindex="-1"></a><span class="co"># compute ESS</span></span>
<span id="cb115-2"><a href="set-up.html#cb115-2" tabindex="-1"></a>ess_trunc.psid_plus <span class="ot">&lt;-</span> <span class="fu">compute_ess_trunc</span>(trunc.psid_plus, <span class="st">&quot;treat&quot;</span>, covar, weight_columns)</span></code></pre></div>
</div>
<div id="visuals-2" class="section level4 hasAnchor" number="2.6.3.3">
<h4><span class="header-section-number">2.6.3.3</span> Visuals<a href="set-up.html#visuals-2" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<div class="sourceCode" id="cb116"><pre class="sourceCode r fold-show"><code class="sourceCode r"><span id="cb116-1"><a href="set-up.html#cb116-1" tabindex="-1"></a><span class="co"># visualize covariate balance</span></span>
<span id="cb116-2"><a href="set-up.html#cb116-2" tabindex="-1"></a><span class="fu">plot_trunc_methods</span>(trunc.psid_plus, <span class="st">&quot;treat&quot;</span>, covar, weight_columns, <span class="st">&quot;LCS-PSID-PLUS&quot;</span>)</span></code></pre></div>
<div class="figure"><span style="display:block;" id="fig:unnamed-chunk-109-1"></span>
<img src="Outcome-Weights_files/figure-html/unnamed-chunk-109-1.png" alt="FIGURE5." width="672" />
<p class="caption">
Figure 2.16: FIGURE5.
</p>
</div>
<div class="figure"><span style="display:block;" id="fig:unnamed-chunk-109-2"></span>
<img src="Outcome-Weights_files/figure-html/unnamed-chunk-109-2.png" alt="FIGURE5." width="672" />
<p class="caption">
Figure 2.17: FIGURE5.
</p>
</div>
<div class="figure"><span style="display:block;" id="fig:unnamed-chunk-109-3"></span>
<img src="Outcome-Weights_files/figure-html/unnamed-chunk-109-3.png" alt="FIGURE5." width="672" />
<p class="caption">
Figure 2.18: FIGURE5.
</p>
</div>
<div class="figure"><span style="display:block;" id="fig:unnamed-chunk-109-4"></span>
<img src="Outcome-Weights_files/figure-html/unnamed-chunk-109-4.png" alt="FIGURE5." width="672" />
<p class="caption">
Figure 2.19: FIGURE5.
</p>
</div>
<div class="figure"><span style="display:block;" id="fig:unnamed-chunk-109-5"></span>
<img src="Outcome-Weights_files/figure-html/unnamed-chunk-109-5.png" alt="FIGURE5." width="672" />
<p class="caption">
Figure 2.20: FIGURE5.
</p>
</div>
<div class="figure"><span style="display:block;" id="fig:unnamed-chunk-109-6"></span>
<img src="Outcome-Weights_files/figure-html/unnamed-chunk-109-6.png" alt="FIGURE5." width="672" />
<p class="caption">
Figure 2.21: FIGURE5.
</p>
</div>
<div class="figure"><span style="display:block;" id="fig:unnamed-chunk-109-7"></span>
<img src="Outcome-Weights_files/figure-html/unnamed-chunk-109-7.png" alt="FIGURE5." width="672" />
<p class="caption">
Figure 2.22: FIGURE5.
</p>
</div>
<div class="figure"><span style="display:block;" id="fig:unnamed-chunk-109-8"></span>
<img src="Outcome-Weights_files/figure-html/unnamed-chunk-109-8.png" alt="FIGURE5." width="672" />
<p class="caption">
Figure 2.23: FIGURE5.
</p>
</div>
<div class="figure"><span style="display:block;" id="fig:unnamed-chunk-109-9"></span>
<img src="Outcome-Weights_files/figure-html/unnamed-chunk-109-9.png" alt="FIGURE5." width="672" />
<p class="caption">
Figure 2.24: FIGURE5.
</p>
</div>
<div class="figure"><span style="display:block;" id="fig:unnamed-chunk-109-10"></span>
<img src="Outcome-Weights_files/figure-html/unnamed-chunk-109-10.png" alt="FIGURE5." width="672" />
<p class="caption">
Figure 2.25: FIGURE5.
</p>
</div>
<div class="figure"><span style="display:block;" id="fig:unnamed-chunk-109-11"></span>
<img src="Outcome-Weights_files/figure-html/unnamed-chunk-109-11.png" alt="FIGURE5." width="672" />
<p class="caption">
Figure 2.26: FIGURE5.
</p>
</div>
<div class="figure"><span style="display:block;" id="fig:unnamed-chunk-109-12"></span>
<img src="Outcome-Weights_files/figure-html/unnamed-chunk-109-12.png" alt="FIGURE5." width="672" />
<p class="caption">
Figure 2.27: FIGURE5.
</p>
</div>
<div class="figure"><span style="display:block;" id="fig:unnamed-chunk-109-13"></span>
<img src="Outcome-Weights_files/figure-html/unnamed-chunk-109-13.png" alt="FIGURE5." width="672" />
<p class="caption">
Figure 2.28: FIGURE5.
</p>
</div>
<div class="figure"><span style="display:block;" id="fig:unnamed-chunk-109-14"></span>
<img src="Outcome-Weights_files/figure-html/unnamed-chunk-109-14.png" alt="FIGURE5." width="672" />
<p class="caption">
Figure 2.29: FIGURE5.
</p>
</div>
<div class="figure"><span style="display:block;" id="fig:unnamed-chunk-109-15"></span>
<img src="Outcome-Weights_files/figure-html/unnamed-chunk-109-15.png" alt="FIGURE5." width="672" />
<p class="caption">
Figure 2.30: FIGURE5.
</p>
</div>
</div>
</div>
<div id="trimming-3" class="section level3 hasAnchor" number="2.6.4">
<h3><span class="header-section-number">2.6.4</span> Trimming<a href="set-up.html#trimming-3" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Methods</p>
<div class="sourceCode" id="cb117"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb117-1"><a href="set-up.html#cb117-1" tabindex="-1"></a><span class="co"># list trimming object</span></span>
<span id="cb117-2"><a href="set-up.html#cb117-2" tabindex="-1"></a>trim.psid_plus <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb117-3"><a href="set-up.html#cb117-3" tabindex="-1"></a>  <span class="at">original =</span> lcs_psid_plus,</span>
<span id="cb117-4"><a href="set-up.html#cb117-4" tabindex="-1"></a>  <span class="at">ps_threshold =</span> lcs_psid.trim_match,</span>
<span id="cb117-5"><a href="set-up.html#cb117-5" tabindex="-1"></a>  <span class="at">common_range =</span> lcs_psid_plus.common,</span>
<span id="cb117-6"><a href="set-up.html#cb117-6" tabindex="-1"></a>  <span class="at">crump =</span> lcs_psid_plus.crump,</span>
<span id="cb117-7"><a href="set-up.html#cb117-7" tabindex="-1"></a>  <span class="at">stuermer =</span> lcs_psid_plus.stuermer,</span>
<span id="cb117-8"><a href="set-up.html#cb117-8" tabindex="-1"></a>  <span class="at">walker =</span> lcs_psid_plus.walker</span>
<span id="cb117-9"><a href="set-up.html#cb117-9" tabindex="-1"></a>)</span></code></pre></div>
<div id="smd-3" class="section level4 hasAnchor" number="2.6.4.1">
<h4><span class="header-section-number">2.6.4.1</span> SMD<a href="set-up.html#smd-3" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<div class="sourceCode" id="cb118"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb118-1"><a href="set-up.html#cb118-1" tabindex="-1"></a><span class="co"># compute SMDs</span></span>
<span id="cb118-2"><a href="set-up.html#cb118-2" tabindex="-1"></a>smd_trim.psid_plus <span class="ot">&lt;-</span> <span class="fu">compute_abs_smd_trim</span>(trim.psid_plus, <span class="st">&quot;treat&quot;</span>, covar)</span></code></pre></div>
</div>
<div id="ess-3" class="section level4 hasAnchor" number="2.6.4.2">
<h4><span class="header-section-number">2.6.4.2</span> ESS<a href="set-up.html#ess-3" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<div class="sourceCode" id="cb119"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb119-1"><a href="set-up.html#cb119-1" tabindex="-1"></a><span class="co"># compute ESS</span></span>
<span id="cb119-2"><a href="set-up.html#cb119-2" tabindex="-1"></a>ess_trim.psid_plus <span class="ot">&lt;-</span> <span class="fu">compute_ess_trim</span>(trim.psid_plus, <span class="st">&quot;treat&quot;</span>, covar)</span></code></pre></div>
</div>
<div id="visuals-3" class="section level4 hasAnchor" number="2.6.4.3">
<h4><span class="header-section-number">2.6.4.3</span> Visuals<a href="set-up.html#visuals-3" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<div class="sourceCode" id="cb120"><pre class="sourceCode r fold-show"><code class="sourceCode r"><span id="cb120-1"><a href="set-up.html#cb120-1" tabindex="-1"></a><span class="co"># visualize overlap</span></span>
<span id="cb120-2"><a href="set-up.html#cb120-2" tabindex="-1"></a><span class="fu">plot_trim</span>(trim.psid_plus, treat, covar)</span></code></pre></div>
<pre><code>## -6.793963 4.127747</code></pre>
<pre><code>## -2.367007 2.208048</code></pre>
<pre><code>## -1.765086 3.756502</code></pre>
<pre><code>## -2.130258 3.494321</code></pre>
<pre><code>## -0.4104685 3.304617</code></pre>
<pre><code>## -0.6819315 3.071009</code></pre>
<div class="figure"><span style="display:block;" id="fig:unnamed-chunk-113"></span>
<img src="Outcome-Weights_files/figure-html/unnamed-chunk-113-1.png" alt="FIGURE6." width="672" />
<p class="caption">
Figure 2.31: FIGURE6.
</p>
</div>
<div class="sourceCode" id="cb127"><pre class="sourceCode r fold-show"><code class="sourceCode r"><span id="cb127-1"><a href="set-up.html#cb127-1" tabindex="-1"></a><span class="co"># visualize covariate balance</span></span>
<span id="cb127-2"><a href="set-up.html#cb127-2" tabindex="-1"></a><span class="fu">love.plot</span>(lcs_psid, lcs_psid.trim_match, treat, <span class="at">covar =</span> covar, <span class="at">title =</span> <span class="st">&quot;LCS-PSID1-PLUS - propensity threshold trimming&quot;</span>)</span></code></pre></div>
<div class="figure"><span style="display:block;" id="fig:unnamed-chunk-114-1"></span>
<img src="Outcome-Weights_files/figure-html/unnamed-chunk-114-1.png" alt="FIGURE7." width="672" />
<p class="caption">
Figure 2.32: FIGURE7.
</p>
</div>
<div class="sourceCode" id="cb128"><pre class="sourceCode r fold-show"><code class="sourceCode r"><span id="cb128-1"><a href="set-up.html#cb128-1" tabindex="-1"></a><span class="fu">love.plot</span>(lcs_psid, lcs_psid_plus.common, treat, covar, <span class="at">title =</span> <span class="st">&quot;LCS-PSID1-PLUS - common range trimming&quot;</span>)</span></code></pre></div>
<div class="figure"><span style="display:block;" id="fig:unnamed-chunk-114-2"></span>
<img src="Outcome-Weights_files/figure-html/unnamed-chunk-114-2.png" alt="FIGURE7." width="672" />
<p class="caption">
Figure 2.33: FIGURE7.
</p>
</div>
<div class="sourceCode" id="cb129"><pre class="sourceCode r fold-show"><code class="sourceCode r"><span id="cb129-1"><a href="set-up.html#cb129-1" tabindex="-1"></a><span class="fu">love.plot</span>(lcs_psid, lcs_psid_plus.crump, treat, covar, <span class="at">title =</span> <span class="st">&quot;LCS-PSID1-PLUS - crump trimming&quot;</span>)</span></code></pre></div>
<div class="figure"><span style="display:block;" id="fig:unnamed-chunk-114-3"></span>
<img src="Outcome-Weights_files/figure-html/unnamed-chunk-114-3.png" alt="FIGURE7." width="672" />
<p class="caption">
Figure 2.34: FIGURE7.
</p>
</div>
<div class="sourceCode" id="cb130"><pre class="sourceCode r fold-show"><code class="sourceCode r"><span id="cb130-1"><a href="set-up.html#cb130-1" tabindex="-1"></a><span class="fu">love.plot</span>(lcs_psid, lcs_psid_plus.stuermer, treat, covar, <span class="at">title =</span> <span class="st">&quot;LCS-PSID1-PLUS - stuermer trimming&quot;</span>)</span></code></pre></div>
<div class="figure"><span style="display:block;" id="fig:unnamed-chunk-114-4"></span>
<img src="Outcome-Weights_files/figure-html/unnamed-chunk-114-4.png" alt="FIGURE7." width="672" />
<p class="caption">
Figure 2.35: FIGURE7.
</p>
</div>
<div class="sourceCode" id="cb131"><pre class="sourceCode r fold-show"><code class="sourceCode r"><span id="cb131-1"><a href="set-up.html#cb131-1" tabindex="-1"></a><span class="fu">love.plot</span>(lcs_psid, lcs_psid_plus.walker,  treat, covar, <span class="at">title =</span> <span class="st">&quot;LCS-PSID1-PLUS - walker trimming&quot;</span>)</span></code></pre></div>
<div class="figure"><span style="display:block;" id="fig:unnamed-chunk-114-5"></span>
<img src="Outcome-Weights_files/figure-html/unnamed-chunk-114-5.png" alt="FIGURE7." width="672" />
<p class="caption">
Figure 2.36: FIGURE7.
</p>
</div>
</div>
</div>
</div>
<div id="integrated-methods" class="section level2 hasAnchor" number="2.7">
<h2><span class="header-section-number">2.7</span> Integrated methods<a href="set-up.html#integrated-methods" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div class="sourceCode" id="cb132"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb132-1"><a href="set-up.html#cb132-1" tabindex="-1"></a><span class="co"># list all combined method results</span></span>
<span id="cb132-2"><a href="set-up.html#cb132-2" tabindex="-1"></a>comb_meth.psid_plus <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb132-3"><a href="set-up.html#cb132-3" tabindex="-1"></a>  <span class="at">ipw =</span> ipw_comb.psid_plus,</span>
<span id="cb132-4"><a href="set-up.html#cb132-4" tabindex="-1"></a>  <span class="at">smr_treated =</span> smr_treat_comb.psid_plus,</span>
<span id="cb132-5"><a href="set-up.html#cb132-5" tabindex="-1"></a>  <span class="at">overlap =</span> ov_comb.psid_plus,</span>
<span id="cb132-6"><a href="set-up.html#cb132-6" tabindex="-1"></a>  <span class="at">entropy =</span> entropy_comb.psid_plus</span>
<span id="cb132-7"><a href="set-up.html#cb132-7" tabindex="-1"></a>)</span></code></pre></div>
<div id="smd-4" class="section level4 hasAnchor" number="2.7.0.1">
<h4><span class="header-section-number">2.7.0.1</span> SMD<a href="set-up.html#smd-4" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<div class="sourceCode" id="cb133"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb133-1"><a href="set-up.html#cb133-1" tabindex="-1"></a><span class="co"># compute SMDs</span></span>
<span id="cb133-2"><a href="set-up.html#cb133-2" tabindex="-1"></a>smd_all_comb_meth.psid_plus <span class="ot">&lt;-</span> <span class="fu">compute_smd_all_datasets</span>(comb_meth.psid_plus, <span class="st">&quot;treat&quot;</span>, covar)</span></code></pre></div>
</div>
<div id="ess-4" class="section level4 hasAnchor" number="2.7.0.2">
<h4><span class="header-section-number">2.7.0.2</span> ESS<a href="set-up.html#ess-4" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<div class="sourceCode" id="cb134"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb134-1"><a href="set-up.html#cb134-1" tabindex="-1"></a><span class="co"># compute ESS</span></span>
<span id="cb134-2"><a href="set-up.html#cb134-2" tabindex="-1"></a>ess_all_comb_meth.psid_plus <span class="ot">&lt;-</span> <span class="fu">compute_ess_all_datasets</span>(comb_meth.psid_plus, <span class="st">&quot;treat&quot;</span>, covar)</span></code></pre></div>
</div>
<div id="visuals-4" class="section level4 hasAnchor" number="2.7.0.3">
<h4><span class="header-section-number">2.7.0.3</span> Visuals<a href="set-up.html#visuals-4" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<div class="sourceCode" id="cb135"><pre class="sourceCode r fold-show"><code class="sourceCode r"><span id="cb135-1"><a href="set-up.html#cb135-1" tabindex="-1"></a><span class="co"># visualize overlap</span></span>
<span id="cb135-2"><a href="set-up.html#cb135-2" tabindex="-1"></a><span class="fu">plot_comb_overlap</span>(<span class="at">comb_meth_psid =</span> comb_meth.psid_plus, <span class="at">treat =</span> <span class="st">&quot;treat&quot;</span>, <span class="at">covar =</span> covar, <span class="at">prefix_psid =</span> <span class="st">&quot;LCS-PSID1&quot;</span>)</span></code></pre></div>
<pre><code>## -6.174843 3.35259</code></pre>
<pre><code>## -1.773306 3.616391</code></pre>
<pre><code>## -0.3876292 3.26982</code></pre>
<pre><code>## -0.7134889 3.014494</code></pre>
<div class="figure"><span style="display:block;" id="fig:unnamed-chunk-118-1"></span>
<img src="Outcome-Weights_files/figure-html/unnamed-chunk-118-1.png" alt="FIGURE A8." width="672" />
<p class="caption">
Figure 2.37: FIGURE A8.
</p>
</div>
<pre><code>## -2.124707 3.514165</code></pre>
<pre><code>## -6.174843 3.35259</code></pre>
<pre><code>## -1.773306 3.616391</code></pre>
<pre><code>## -0.3876292 3.26982</code></pre>
<div class="figure"><span style="display:block;" id="fig:unnamed-chunk-118-2"></span>
<img src="Outcome-Weights_files/figure-html/unnamed-chunk-118-2.png" alt="FIGURE A8." width="672" />
<p class="caption">
Figure 2.38: FIGURE A8.
</p>
</div>
<pre><code>## -0.7134889 3.014494</code></pre>
<pre><code>## -2.124707 3.514165</code></pre>
<pre><code>## -6.174843 3.35259</code></pre>
<pre><code>## -1.773306 3.616391</code></pre>
<div class="figure"><span style="display:block;" id="fig:unnamed-chunk-118-3"></span>
<img src="Outcome-Weights_files/figure-html/unnamed-chunk-118-3.png" alt="FIGURE A8." width="672" />
<p class="caption">
Figure 2.39: FIGURE A8.
</p>
</div>
<pre><code>## -0.3876292 3.26982</code></pre>
<pre><code>## -0.7134889 3.014494</code></pre>
<pre><code>## -2.124707 3.514165</code></pre>
<pre><code>## -6.174843 3.35259</code></pre>
<div class="figure"><span style="display:block;" id="fig:unnamed-chunk-118-4"></span>
<img src="Outcome-Weights_files/figure-html/unnamed-chunk-118-4.png" alt="FIGURE A8." width="672" />
<p class="caption">
Figure 2.40: FIGURE A8.
</p>
</div>
<pre><code>## -1.773306 3.616391</code></pre>
<pre><code>## -0.3876292 3.26982</code></pre>
<pre><code>## -0.7134889 3.014494</code></pre>
<pre><code>## -2.124707 3.514165</code></pre>
<div class="figure"><span style="display:block;" id="fig:unnamed-chunk-118-5"></span>
<img src="Outcome-Weights_files/figure-html/unnamed-chunk-118-5.png" alt="FIGURE A8." width="672" />
<p class="caption">
Figure 2.41: FIGURE A8.
</p>
</div>
<div class="sourceCode" id="cb156"><pre class="sourceCode r fold-show"><code class="sourceCode r"><span id="cb156-1"><a href="set-up.html#cb156-1" tabindex="-1"></a><span class="co"># visualize covariate balance</span></span>
<span id="cb156-2"><a href="set-up.html#cb156-2" tabindex="-1"></a><span class="fu">plot_comb_love_plots</span>(<span class="at">comb_meth_psid =</span> comb_meth.psid_plus, <span class="at">treat =</span> <span class="st">&quot;treat&quot;</span>, <span class="at">covar =</span> covar, <span class="at">prefix_cps =</span> <span class="st">&quot;LCS-PSID1&quot;</span>)</span></code></pre></div>
<div class="figure"><span style="display:block;" id="fig:unnamed-chunk-119-1"></span>
<img src="Outcome-Weights_files/figure-html/unnamed-chunk-119-1.png" alt="FIGURE A9." width="672" />
<p class="caption">
Figure 2.42: FIGURE A9.
</p>
</div>
<div class="figure"><span style="display:block;" id="fig:unnamed-chunk-119-2"></span>
<img src="Outcome-Weights_files/figure-html/unnamed-chunk-119-2.png" alt="FIGURE A9." width="672" />
<p class="caption">
Figure 2.43: FIGURE A9.
</p>
</div>
<div class="figure"><span style="display:block;" id="fig:unnamed-chunk-119-3"></span>
<img src="Outcome-Weights_files/figure-html/unnamed-chunk-119-3.png" alt="FIGURE A9." width="672" />
<p class="caption">
Figure 2.44: FIGURE A9.
</p>
</div>
<div class="figure"><span style="display:block;" id="fig:unnamed-chunk-119-4"></span>
<img src="Outcome-Weights_files/figure-html/unnamed-chunk-119-4.png" alt="FIGURE A9." width="672" />
<p class="caption">
Figure 2.45: FIGURE A9.
</p>
</div>
<div class="figure"><span style="display:block;" id="fig:unnamed-chunk-119-5"></span>
<img src="Outcome-Weights_files/figure-html/unnamed-chunk-119-5.png" alt="FIGURE A9." width="672" />
<p class="caption">
Figure 2.46: FIGURE A9.
</p>
</div>
<div class="figure"><span style="display:block;" id="fig:unnamed-chunk-119-6"></span>
<img src="Outcome-Weights_files/figure-html/unnamed-chunk-119-6.png" alt="FIGURE A9." width="672" />
<p class="caption">
Figure 2.47: FIGURE A9.
</p>
</div>
<div class="figure"><span style="display:block;" id="fig:unnamed-chunk-119-7"></span>
<img src="Outcome-Weights_files/figure-html/unnamed-chunk-119-7.png" alt="FIGURE A9." width="672" />
<p class="caption">
Figure 2.48: FIGURE A9.
</p>
</div>
<div class="figure"><span style="display:block;" id="fig:unnamed-chunk-119-8"></span>
<img src="Outcome-Weights_files/figure-html/unnamed-chunk-119-8.png" alt="FIGURE A9." width="672" />
<p class="caption">
Figure 2.49: FIGURE A9.
</p>
</div>
<div class="figure"><span style="display:block;" id="fig:unnamed-chunk-119-9"></span>
<img src="Outcome-Weights_files/figure-html/unnamed-chunk-119-9.png" alt="FIGURE A9." width="672" />
<p class="caption">
Figure 2.50: FIGURE A9.
</p>
</div>
<div class="figure"><span style="display:block;" id="fig:unnamed-chunk-119-10"></span>
<img src="Outcome-Weights_files/figure-html/unnamed-chunk-119-10.png" alt="FIGURE A9." width="672" />
<p class="caption">
Figure 2.51: FIGURE A9.
</p>
</div>
<div class="figure"><span style="display:block;" id="fig:unnamed-chunk-119-11"></span>
<img src="Outcome-Weights_files/figure-html/unnamed-chunk-119-11.png" alt="FIGURE A9." width="672" />
<p class="caption">
Figure 2.52: FIGURE A9.
</p>
</div>
<div class="figure"><span style="display:block;" id="fig:unnamed-chunk-119-12"></span>
<img src="Outcome-Weights_files/figure-html/unnamed-chunk-119-12.png" alt="FIGURE A9." width="672" />
<p class="caption">
Figure 2.53: FIGURE A9.
</p>
</div>
<div class="figure"><span style="display:block;" id="fig:unnamed-chunk-119-13"></span>
<img src="Outcome-Weights_files/figure-html/unnamed-chunk-119-13.png" alt="FIGURE A9." width="672" />
<p class="caption">
Figure 2.54: FIGURE A9.
</p>
</div>
<div class="figure"><span style="display:block;" id="fig:unnamed-chunk-119-14"></span>
<img src="Outcome-Weights_files/figure-html/unnamed-chunk-119-14.png" alt="FIGURE A9." width="672" />
<p class="caption">
Figure 2.55: FIGURE A9.
</p>
</div>
<div class="figure"><span style="display:block;" id="fig:unnamed-chunk-119-15"></span>
<img src="Outcome-Weights_files/figure-html/unnamed-chunk-119-15.png" alt="FIGURE A9." width="672" />
<p class="caption">
Figure 2.56: FIGURE A9.
</p>
</div>
<div class="figure"><span style="display:block;" id="fig:unnamed-chunk-119-16"></span>
<img src="Outcome-Weights_files/figure-html/unnamed-chunk-119-16.png" alt="FIGURE A9." width="672" />
<p class="caption">
Figure 2.57: FIGURE A9.
</p>
</div>
<div class="figure"><span style="display:block;" id="fig:unnamed-chunk-119-17"></span>
<img src="Outcome-Weights_files/figure-html/unnamed-chunk-119-17.png" alt="FIGURE A9." width="672" />
<p class="caption">
Figure 2.58: FIGURE A9.
</p>
</div>
<div class="figure"><span style="display:block;" id="fig:unnamed-chunk-119-18"></span>
<img src="Outcome-Weights_files/figure-html/unnamed-chunk-119-18.png" alt="FIGURE A9." width="672" />
<p class="caption">
Figure 2.59: FIGURE A9.
</p>
</div>
<div class="figure"><span style="display:block;" id="fig:unnamed-chunk-119-19"></span>
<img src="Outcome-Weights_files/figure-html/unnamed-chunk-119-19.png" alt="FIGURE A9." width="672" />
<p class="caption">
Figure 2.60: FIGURE A9.
</p>
</div>
<div class="figure"><span style="display:block;" id="fig:unnamed-chunk-119-20"></span>
<img src="Outcome-Weights_files/figure-html/unnamed-chunk-119-20.png" alt="FIGURE A9." width="672" />
<p class="caption">
Figure 2.61: FIGURE A9.
</p>
</div>
<div class="sourceCode" id="cb157"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb157-1"><a href="set-up.html#cb157-1" tabindex="-1"></a><span class="co"># save results</span></span>
<span id="cb157-2"><a href="set-up.html#cb157-2" tabindex="-1"></a><span class="fu">save_comb_hist</span>(<span class="at">comb_meth_psid =</span> comb_meth.psid_plus, <span class="at">treat =</span> <span class="st">&quot;treat&quot;</span>, <span class="at">covar =</span> covar, <span class="at">prefix =</span> <span class="st">&quot;lcs&quot;</span>, <span class="at">prefix_psid =</span> <span class="st">&quot;LCS-PSID1&quot;</span>)</span></code></pre></div>
<pre><code>## -6.174843 3.35259</code></pre>
<pre><code>## -1.773306 3.616391</code></pre>
<pre><code>## -0.3876292 3.26982</code></pre>
<pre><code>## -0.7134889 3.014494</code></pre>
<pre><code>## -2.124707 3.514165</code></pre>
<pre><code>## -6.174843 3.35259</code></pre>
<pre><code>## -1.773306 3.616391</code></pre>
<pre><code>## -0.3876292 3.26982</code></pre>
<pre><code>## -0.7134889 3.014494</code></pre>
<pre><code>## -2.124707 3.514165</code></pre>
<pre><code>## -6.174843 3.35259</code></pre>
<pre><code>## -1.773306 3.616391</code></pre>
<pre><code>## -0.3876292 3.26982</code></pre>
<pre><code>## -0.7134889 3.014494</code></pre>
<pre><code>## -2.124707 3.514165</code></pre>
<pre><code>## -6.174843 3.35259</code></pre>
<pre><code>## -1.773306 3.616391</code></pre>
<pre><code>## -0.3876292 3.26982</code></pre>
<pre><code>## -0.7134889 3.014494</code></pre>
<pre><code>## -2.124707 3.514165</code></pre>
<div class="sourceCode" id="cb178"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb178-1"><a href="set-up.html#cb178-1" tabindex="-1"></a><span class="fu">save_comb_loveplots</span>(<span class="at">comb_meth_psid =</span> comb_meth.psid_plus, <span class="at">treat =</span> <span class="st">&quot;treat&quot;</span>, <span class="at">covar =</span> covar, <span class="at">prefix =</span> <span class="st">&quot;lcs&quot;</span>, <span class="at">prefix_cps =</span> <span class="st">&quot;LCS-CPS1&quot;</span>)</span></code></pre></div>
</div>
<div id="top-methods-and-datasets" class="section level3 hasAnchor" number="2.7.1">
<h3><span class="header-section-number">2.7.1</span> Top methods and datasets<a href="set-up.html#top-methods-and-datasets" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb179"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb179-1"><a href="set-up.html#cb179-1" tabindex="-1"></a><span class="co"># combine all results</span></span>
<span id="cb179-2"><a href="set-up.html#cb179-2" tabindex="-1"></a>all_psid_plus <span class="ot">&lt;-</span> <span class="fu">combine_results</span>(<span class="st">&quot;psid_plus&quot;</span>) </span></code></pre></div>
<div class="sourceCode" id="cb180"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb180-1"><a href="set-up.html#cb180-1" tabindex="-1"></a><span class="co"># save results </span></span>
<span id="cb180-2"><a href="set-up.html#cb180-2" tabindex="-1"></a><span class="fu">save_csv</span>(all_psid_plus, <span class="st">&quot;PSID1_PLUS_all_results_lcs&quot;</span>)</span></code></pre></div>
<div class="sourceCode" id="cb181"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb181-1"><a href="set-up.html#cb181-1" tabindex="-1"></a>ranked_psid_plus <span class="ot">&lt;-</span> <span class="fu">assess_methods</span>(all_psid_plus)</span></code></pre></div>
<div class="sourceCode" id="cb182"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb182-1"><a href="set-up.html#cb182-1" tabindex="-1"></a><span class="co"># get top 5 methods </span></span>
<span id="cb182-2"><a href="set-up.html#cb182-2" tabindex="-1"></a>top5_methods.psid_plus <span class="ot">&lt;-</span> <span class="fu">get_top_methods</span>(ranked_psid_plus, <span class="at">top_n =</span> <span class="dv">5</span>)</span></code></pre></div>
<pre><code>##                               Method     Score
## 1                               card 0.7935529
## 2   adap_weight_trunc_overlap_weight 0.7382676
## 3 fix_max_value_trunc_overlap_weight 0.7382676
## 4                     overlap_weight 0.7382676
## 5       at_perc_trunc_overlap_weight 0.7382002</code></pre>
<div class="sourceCode" id="cb184"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb184-1"><a href="set-up.html#cb184-1" tabindex="-1"></a><span class="co"># save results </span></span>
<span id="cb184-2"><a href="set-up.html#cb184-2" tabindex="-1"></a><span class="fu">save_csv</span>(top5_methods.psid_plus, <span class="st">&quot;PSID1_PLUS_top5_methods_lcs&quot;</span>)</span></code></pre></div>
<p>The table shows that CPS1 and PSID1 share the same top five methods, with the exception of one differing method and a variation in their ordering for PSID1.</p>
<div class="sourceCode" id="cb185"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb185-1"><a href="set-up.html#cb185-1" tabindex="-1"></a>dataset_list_psid <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb185-2"><a href="set-up.html#cb185-2" tabindex="-1"></a>  <span class="st">&quot;All&quot;</span> <span class="ot">=</span> lcs_psid_plus, </span>
<span id="cb185-3"><a href="set-up.html#cb185-3" tabindex="-1"></a>  <span class="st">&quot;original&quot;</span> <span class="ot">=</span> lcs_psid_plus, </span>
<span id="cb185-4"><a href="set-up.html#cb185-4" tabindex="-1"></a>  <span class="st">&quot;card&quot;</span> <span class="ot">=</span> m.out.psid_plus.card,</span>
<span id="cb185-5"><a href="set-up.html#cb185-5" tabindex="-1"></a>  <span class="st">&quot;optimal_full&quot;</span> <span class="ot">=</span> m.out.psid_plus.optimal_full,</span>
<span id="cb185-6"><a href="set-up.html#cb185-6" tabindex="-1"></a>  <span class="st">&quot;optimal_pair&quot;</span> <span class="ot">=</span> m.out.psid_plus.optimal_pair,</span>
<span id="cb185-7"><a href="set-up.html#cb185-7" tabindex="-1"></a>  <span class="st">&quot;gen_full&quot;</span> <span class="ot">=</span> m.out.psid_plus.general_full,</span>
<span id="cb185-8"><a href="set-up.html#cb185-8" tabindex="-1"></a>  <span class="st">&quot;subcl&quot;</span> <span class="ot">=</span> m.out.psid_plus.subcl,</span>
<span id="cb185-9"><a href="set-up.html#cb185-9" tabindex="-1"></a>  <span class="st">&quot;profile&quot;</span> <span class="ot">=</span> m.out.psid_plus.profile,</span>
<span id="cb185-10"><a href="set-up.html#cb185-10" tabindex="-1"></a>  <span class="st">&quot;ipw_weight&quot;</span> <span class="ot">=</span> lcs_psid_plus<span class="sc">$</span>ipw_weight, </span>
<span id="cb185-11"><a href="set-up.html#cb185-11" tabindex="-1"></a>  <span class="st">&quot;smr_weight&quot;</span> <span class="ot">=</span> lcs_psid_plus<span class="sc">$</span>smr_weight,</span>
<span id="cb185-12"><a href="set-up.html#cb185-12" tabindex="-1"></a>  <span class="st">&quot;opt_weight&quot;</span> <span class="ot">=</span> lcs_psid_plus<span class="sc">$</span>opt_weight,</span>
<span id="cb185-13"><a href="set-up.html#cb185-13" tabindex="-1"></a>  <span class="st">&quot;overlap_weight&quot;</span> <span class="ot">=</span> lcs_psid_plus<span class="sc">$</span>overlap_weight,</span>
<span id="cb185-14"><a href="set-up.html#cb185-14" tabindex="-1"></a>  <span class="st">&quot;ebal_weight&quot;</span> <span class="ot">=</span> lcs_psid_plus<span class="sc">$</span>ebal_weight,</span>
<span id="cb185-15"><a href="set-up.html#cb185-15" tabindex="-1"></a>  <span class="st">&quot;fix_max_value_trunc_ebal_weight&quot;</span> <span class="ot">=</span> lcs_psid_plus.fixed,</span>
<span id="cb185-16"><a href="set-up.html#cb185-16" tabindex="-1"></a>  <span class="st">&quot;fix_max_value_trunc_ipw_weight&quot;</span> <span class="ot">=</span> lcs_psid_plus.fixed,</span>
<span id="cb185-17"><a href="set-up.html#cb185-17" tabindex="-1"></a>  <span class="st">&quot;fix_max_value_trunc_opt_weight&quot;</span> <span class="ot">=</span> lcs_psid_plus.fixed,</span>
<span id="cb185-18"><a href="set-up.html#cb185-18" tabindex="-1"></a>  <span class="st">&quot;fix_max_value_trunc_overlap_weight&quot;</span> <span class="ot">=</span> lcs_psid_plus.fixed,</span>
<span id="cb185-19"><a href="set-up.html#cb185-19" tabindex="-1"></a>  <span class="st">&quot;fix_max_value_trunc_smr_weight&quot;</span> <span class="ot">=</span> lcs_psid_plus.fixed,</span>
<span id="cb185-20"><a href="set-up.html#cb185-20" tabindex="-1"></a>  <span class="st">&quot;at_perc_trunc_ebal_weight&quot;</span> <span class="ot">=</span> lcs_psid_plus.percent,</span>
<span id="cb185-21"><a href="set-up.html#cb185-21" tabindex="-1"></a>  <span class="st">&quot;at_perc_trunc_ipw_weight&quot;</span> <span class="ot">=</span> lcs_psid_plus.percent,</span>
<span id="cb185-22"><a href="set-up.html#cb185-22" tabindex="-1"></a>  <span class="st">&quot;at_perc_trunc_opt_weight&quot;</span> <span class="ot">=</span> lcs_psid_plus.percent,</span>
<span id="cb185-23"><a href="set-up.html#cb185-23" tabindex="-1"></a>  <span class="st">&quot;at_perc_trunc_overlap_weight&quot;</span> <span class="ot">=</span> lcs_psid_plus.percent,</span>
<span id="cb185-24"><a href="set-up.html#cb185-24" tabindex="-1"></a>  <span class="st">&quot;at_perc_trunc_smr_weight&quot;</span> <span class="ot">=</span> lcs_psid_plus.percent,</span>
<span id="cb185-25"><a href="set-up.html#cb185-25" tabindex="-1"></a>  <span class="st">&quot;adap_weight_trunc_ebal_weight&quot;</span> <span class="ot">=</span> lcs_psid_plus.adapt,</span>
<span id="cb185-26"><a href="set-up.html#cb185-26" tabindex="-1"></a>  <span class="st">&quot;adap_weight_trunc_ipw_weight&quot;</span> <span class="ot">=</span> lcs_psid_plus.adapt,</span>
<span id="cb185-27"><a href="set-up.html#cb185-27" tabindex="-1"></a>  <span class="st">&quot;adap_weight_trunc_opt_weight&quot;</span> <span class="ot">=</span> lcs_psid_plus.adapt,</span>
<span id="cb185-28"><a href="set-up.html#cb185-28" tabindex="-1"></a>  <span class="st">&quot;adap_weight_trunc_overlap_weight&quot;</span> <span class="ot">=</span> lcs_psid_plus.adapt,</span>
<span id="cb185-29"><a href="set-up.html#cb185-29" tabindex="-1"></a>  <span class="st">&quot;adap_weight_trunc_smr_weight&quot;</span> <span class="ot">=</span> lcs_psid_plus.adapt,</span>
<span id="cb185-30"><a href="set-up.html#cb185-30" tabindex="-1"></a>  <span class="st">&quot;ps_threshold&quot;</span> <span class="ot">=</span> lcs_psid.trim_match,</span>
<span id="cb185-31"><a href="set-up.html#cb185-31" tabindex="-1"></a>  <span class="st">&quot;common_range&quot;</span> <span class="ot">=</span> lcs_psid_plus.common,</span>
<span id="cb185-32"><a href="set-up.html#cb185-32" tabindex="-1"></a>  <span class="st">&quot;stuermer&quot;</span> <span class="ot">=</span> lcs_psid_plus.stuermer,</span>
<span id="cb185-33"><a href="set-up.html#cb185-33" tabindex="-1"></a>  <span class="st">&quot;walker&quot;</span> <span class="ot">=</span> lcs_psid_plus.walker,</span>
<span id="cb185-34"><a href="set-up.html#cb185-34" tabindex="-1"></a>  <span class="st">&quot;crump&quot;</span> <span class="ot">=</span> lcs_psid_plus.crump,</span>
<span id="cb185-35"><a href="set-up.html#cb185-35" tabindex="-1"></a>  <span class="st">&quot;ipw_common_range&quot;</span> <span class="ot">=</span> ipw_comb.psid_plus[[<span class="dv">1</span>]],</span>
<span id="cb185-36"><a href="set-up.html#cb185-36" tabindex="-1"></a>  <span class="st">&quot;ipw_crump&quot;</span><span class="ot">=</span> ipw_comb.psid_plus[[<span class="dv">2</span>]],</span>
<span id="cb185-37"><a href="set-up.html#cb185-37" tabindex="-1"></a>  <span class="st">&quot;ipw_ps_threshold&quot;</span><span class="ot">=</span> ipw_comb.psid_plus[[<span class="dv">3</span>]],</span>
<span id="cb185-38"><a href="set-up.html#cb185-38" tabindex="-1"></a>  <span class="st">&quot;ipw_stuermer&quot;</span><span class="ot">=</span> ipw_comb.psid_plus[[<span class="dv">4</span>]],</span>
<span id="cb185-39"><a href="set-up.html#cb185-39" tabindex="-1"></a>  <span class="st">&quot;ipw_walker&quot;</span> <span class="ot">=</span> ipw_comb.psid_plus[[<span class="dv">5</span>]],</span>
<span id="cb185-40"><a href="set-up.html#cb185-40" tabindex="-1"></a>  <span class="st">&quot;smr_treated_common_range&quot;</span> <span class="ot">=</span> smr_treat_comb.psid_plus[[<span class="dv">1</span>]],</span>
<span id="cb185-41"><a href="set-up.html#cb185-41" tabindex="-1"></a>  <span class="st">&quot;smr_treated_crump&quot;</span><span class="ot">=</span> smr_treat_comb.psid_plus[[<span class="dv">2</span>]],</span>
<span id="cb185-42"><a href="set-up.html#cb185-42" tabindex="-1"></a>  <span class="st">&quot;smr_treated_ps_threshold&quot;</span> <span class="ot">=</span> smr_treat_comb.psid_plus[[<span class="dv">3</span>]],</span>
<span id="cb185-43"><a href="set-up.html#cb185-43" tabindex="-1"></a>  <span class="st">&quot;smr_treated_stuermer&quot;</span> <span class="ot">=</span> smr_treat_comb.psid_plus[[<span class="dv">4</span>]],</span>
<span id="cb185-44"><a href="set-up.html#cb185-44" tabindex="-1"></a>  <span class="st">&quot;smr_treated_walker&quot;</span> <span class="ot">=</span> smr_treat_comb.psid_plus[[<span class="dv">5</span>]],</span>
<span id="cb185-45"><a href="set-up.html#cb185-45" tabindex="-1"></a>  <span class="st">&quot;overlap_common_range&quot;</span> <span class="ot">=</span> ov_comb.psid_plus[[<span class="dv">1</span>]],</span>
<span id="cb185-46"><a href="set-up.html#cb185-46" tabindex="-1"></a>  <span class="st">&quot;overlap_crump&quot;</span> <span class="ot">=</span> ov_comb.psid_plus[[<span class="dv">2</span>]],</span>
<span id="cb185-47"><a href="set-up.html#cb185-47" tabindex="-1"></a>  <span class="st">&quot;overlap_ps_threshold&quot;</span>  <span class="ot">=</span> ov_comb.psid_plus[[<span class="dv">3</span>]],</span>
<span id="cb185-48"><a href="set-up.html#cb185-48" tabindex="-1"></a>  <span class="st">&quot;overlap_stuermer&quot;</span> <span class="ot">=</span> ov_comb.psid_plus[[<span class="dv">4</span>]],</span>
<span id="cb185-49"><a href="set-up.html#cb185-49" tabindex="-1"></a>  <span class="st">&quot;overlap_walker&quot;</span><span class="ot">=</span> ov_comb.psid_plus[[<span class="dv">5</span>]],</span>
<span id="cb185-50"><a href="set-up.html#cb185-50" tabindex="-1"></a>  <span class="st">&quot;entropy_common_range&quot;</span> <span class="ot">=</span> entropy_comb.psid_plus[[<span class="dv">1</span>]],</span>
<span id="cb185-51"><a href="set-up.html#cb185-51" tabindex="-1"></a>  <span class="st">&quot;entropy_crump&quot;</span> <span class="ot">=</span> entropy_comb.psid_plus[[<span class="dv">2</span>]],</span>
<span id="cb185-52"><a href="set-up.html#cb185-52" tabindex="-1"></a>  <span class="st">&quot;entropy_ps_threshold&quot;</span> <span class="ot">=</span> entropy_comb.psid_plus[[<span class="dv">3</span>]],</span>
<span id="cb185-53"><a href="set-up.html#cb185-53" tabindex="-1"></a>  <span class="st">&quot;entropy_stuermer&quot;</span> <span class="ot">=</span> entropy_comb.psid_plus[[<span class="dv">4</span>]],</span>
<span id="cb185-54"><a href="set-up.html#cb185-54" tabindex="-1"></a>  <span class="st">&quot;entropy_walker&quot;</span> <span class="ot">=</span> entropy_comb.psid_plus[[<span class="dv">5</span>]])</span></code></pre></div>
<div class="sourceCode" id="cb186"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb186-1"><a href="set-up.html#cb186-1" tabindex="-1"></a><span class="co"># create the datasets from combined lists for your top 5 methods:</span></span>
<span id="cb186-2"><a href="set-up.html#cb186-2" tabindex="-1"></a>top5_datasets.psid_plus <span class="ot">&lt;-</span> <span class="fu">create_top5_datasets</span>(dataset_list_psid, top5_methods.psid_plus)</span></code></pre></div>
<div class="sourceCode" id="cb187"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb187-1"><a href="set-up.html#cb187-1" tabindex="-1"></a><span class="co"># save them into .RData files</span></span>
<span id="cb187-2"><a href="set-up.html#cb187-2" tabindex="-1"></a><span class="fu">save_top5_individual_files</span>(dataset_list_psid, top5_methods.psid_plus, <span class="at">prefix =</span> <span class="st">&quot;lcs_psid&quot;</span>)</span></code></pre></div>
<pre><code>## Saved: data/top1_lcs_psid_method_card.RData 
## Saved: data/top2_lcs_psid_method_adap_weight_trunc_overlap_weight.RData 
## Saved: data/top3_lcs_psid_method_fix_max_value_trunc_overlap_weight.RData 
## Saved: data/top4_lcs_psid_method_overlap_weight.RData 
## Saved: data/top5_lcs_psid_method_at_perc_trunc_overlap_weight.RData</code></pre>
</div>
</div>
<div id="estimating-1" class="section level2 hasAnchor" number="2.8">
<h2><span class="header-section-number">2.8</span> Estimating<a href="set-up.html#estimating-1" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div id="average-treatment-effect-on-the-treated-att" class="section level3 hasAnchor" number="2.8.1">
<h3><span class="header-section-number">2.8.1</span> Average treatment effect on the treated (ATT)<a href="set-up.html#average-treatment-effect-on-the-treated-att" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb189"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb189-1"><a href="set-up.html#cb189-1" tabindex="-1"></a>out1 <span class="ot">&lt;-</span> <span class="fu">estimate_all</span>(lcs, <span class="st">&quot;re79&quot;</span>, <span class="st">&quot;treat&quot;</span>, covar)</span>
<span id="cb189-2"><a href="set-up.html#cb189-2" tabindex="-1"></a>out2 <span class="ot">&lt;-</span> <span class="fu">estimate_all</span>(lcs_psid, <span class="st">&quot;re79&quot;</span>, <span class="st">&quot;treat&quot;</span>, covar)</span></code></pre></div>
<div class="sourceCode" id="cb190"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb190-1"><a href="set-up.html#cb190-1" tabindex="-1"></a>out3 <span class="ot">&lt;-</span> <span class="fu">estimate_all</span>(lcs_psid.trim_match, <span class="st">&quot;re79&quot;</span>, <span class="st">&quot;treat&quot;</span>, covar)</span></code></pre></div>
<div class="sourceCode" id="cb191"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb191-1"><a href="set-up.html#cb191-1" tabindex="-1"></a>out.psid_plus <span class="ot">&lt;-</span> <span class="fu">lapply</span>(top5_datasets.psid_plus, <span class="cf">function</span>(d) <span class="fu">estimate_all</span>(d, <span class="st">&quot;re79&quot;</span>, <span class="st">&quot;treat&quot;</span>, covar))</span>
<span id="cb191-2"><a href="set-up.html#cb191-2" tabindex="-1"></a></span>
<span id="cb191-3"><a href="set-up.html#cb191-3" tabindex="-1"></a>out4 <span class="ot">&lt;-</span> out.psid_plus[[<span class="dv">1</span>]]</span>
<span id="cb191-4"><a href="set-up.html#cb191-4" tabindex="-1"></a>out5 <span class="ot">&lt;-</span> out.psid_plus[[<span class="dv">2</span>]]</span>
<span id="cb191-5"><a href="set-up.html#cb191-5" tabindex="-1"></a>out6 <span class="ot">&lt;-</span> out.psid_plus[[<span class="dv">3</span>]]</span>
<span id="cb191-6"><a href="set-up.html#cb191-6" tabindex="-1"></a>out7 <span class="ot">&lt;-</span> out.psid_plus[[<span class="dv">4</span>]]</span>
<span id="cb191-7"><a href="set-up.html#cb191-7" tabindex="-1"></a>out8 <span class="ot">&lt;-</span> out.psid_plus[[<span class="dv">5</span>]]</span></code></pre></div>
<div class="sourceCode" id="cb192"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb192-1"><a href="set-up.html#cb192-1" tabindex="-1"></a><span class="co"># build plot titles </span></span>
<span id="cb192-2"><a href="set-up.html#cb192-2" tabindex="-1"></a>base_titles <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;(A) LCS-Experimental&quot;</span>, <span class="st">&quot;(B) LCS-PSID1&quot;</span> , <span class="st">&quot;(C) Trimmed LCS-PSID1&quot;</span>)</span>
<span id="cb192-3"><a href="set-up.html#cb192-3" tabindex="-1"></a>top_start <span class="ot">&lt;-</span> <span class="dv">4</span> <span class="co"># D is 4th letter</span></span>
<span id="cb192-4"><a href="set-up.html#cb192-4" tabindex="-1"></a>num_psid <span class="ot">&lt;-</span> <span class="fu">length</span>(top5_methods.psid_plus)</span>
<span id="cb192-5"><a href="set-up.html#cb192-5" tabindex="-1"></a>top_letters_psid <span class="ot">&lt;-</span> LETTERS[top_start<span class="sc">:</span>(top_start <span class="sc">+</span> num_psid <span class="sc">-</span> <span class="dv">1</span>)]</span>
<span id="cb192-6"><a href="set-up.html#cb192-6" tabindex="-1"></a>top5_titles.psid_plus <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">&quot;(&quot;</span>, top_letters_psid, <span class="st">&quot;) Top PSID1: &quot;</span>, top5_methods.psid_plus)</span>
<span id="cb192-7"><a href="set-up.html#cb192-7" tabindex="-1"></a>plot_titles <span class="ot">&lt;-</span> <span class="fu">c</span>(base_titles, top5_titles.psid_plus)</span>
<span id="cb192-8"><a href="set-up.html#cb192-8" tabindex="-1"></a></span>
<span id="cb192-9"><a href="set-up.html#cb192-9" tabindex="-1"></a><span class="co"># combine all results</span></span>
<span id="cb192-10"><a href="set-up.html#cb192-10" tabindex="-1"></a>all_outs <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fu">list</span>(out1, out2, out3), out.psid_plus)</span></code></pre></div>
<div class="sourceCode" id="cb193"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb193-1"><a href="set-up.html#cb193-1" tabindex="-1"></a><span class="co"># plot results</span></span>
<span id="cb193-2"><a href="set-up.html#cb193-2" tabindex="-1"></a>band <span class="ot">&lt;-</span> out1[<span class="dv">1</span>, <span class="dv">3</span><span class="sc">:</span><span class="dv">4</span>]</span>
<span id="cb193-3"><a href="set-up.html#cb193-3" tabindex="-1"></a>est  <span class="ot">&lt;-</span> out1[<span class="dv">1</span>, <span class="dv">1</span>]</span>
<span id="cb193-4"><a href="set-up.html#cb193-4" tabindex="-1"></a><span class="fu">plot_att_panels</span>(all_outs, plot_titles, band, est)</span></code></pre></div>
<div class="figure"><span style="display:block;" id="fig:unnamed-chunk-132-1"></span>
<img src="Outcome-Weights_files/figure-html/unnamed-chunk-132-1.png" alt="FIGURE 10. ATT Estimates Given Unconfoundedness using LCS Samples" width="100%" />
<p class="caption">
Figure 2.62: FIGURE 10. ATT Estimates Given Unconfoundedness using LCS Samples
</p>
</div>
<div class="figure"><span style="display:block;" id="fig:unnamed-chunk-132-2"></span>
<img src="Outcome-Weights_files/figure-html/unnamed-chunk-132-2.png" alt="FIGURE 10. ATT Estimates Given Unconfoundedness using LCS Samples" width="100%" />
<p class="caption">
Figure 2.63: FIGURE 10. ATT Estimates Given Unconfoundedness using LCS Samples
</p>
</div>
<div class="sourceCode" id="cb194"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb194-1"><a href="set-up.html#cb194-1" tabindex="-1"></a><span class="co"># save results</span></span>
<span id="cb194-2"><a href="set-up.html#cb194-2" tabindex="-1"></a><span class="fu">save_att_panels</span>(all_outs, plot_titles, band, est, <span class="st">&quot;lcs&quot;</span>)</span></code></pre></div>
<p>The above figures show the ATT estimates and their 95% confidence intervals for eight samples: LCS-Experimental, LCS-PSID1, a trimmed version of the LCS-PSID1 sample (analogous to Imbens &amp; Xu) and a series of top-ranked samples of LCS-PSID1 based on various matching, weighting, truncation and trimming criteria.</p>
<p>Figure (A) presents the benchmark from the experimental sample (LCS-Experimental), serving as a reference for bias and variance assessment of observational samples. Figures (B) shows results for the observational sample LCS-PSID1 and figure (C) for its trimmed version, replicating the tutorial results of Imbens &amp; Xu (2024). Figures (D) through (H) display results for PSID1-based samples.</p>
<p>Across the LCS-PSID1 dataset and its top-ranked samples, all estimators yield ATT estimates that largely cluster around the experimental benchmark except <code>Diff-in-Means</code>, which tends to produce estimates that deviate more noticeably from the benchmark.</p>
<div class="sourceCode" id="cb195"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb195-1"><a href="set-up.html#cb195-1" tabindex="-1"></a><span class="co"># prepare all results in the order shown in the plots</span></span>
<span id="cb195-2"><a href="set-up.html#cb195-2" tabindex="-1"></a>all_summaries <span class="ot">&lt;-</span> <span class="fu">lapply</span>(all_outs, eval_att)</span>
<span id="cb195-3"><a href="set-up.html#cb195-3" tabindex="-1"></a>att_summary <span class="ot">&lt;-</span> <span class="fu">do.call</span>(rbind, all_summaries)</span>
<span id="cb195-4"><a href="set-up.html#cb195-4" tabindex="-1"></a><span class="fu">rownames</span>(att_summary) <span class="ot">&lt;-</span> plot_titles</span>
<span id="cb195-5"><a href="set-up.html#cb195-5" tabindex="-1"></a>att_summary</span></code></pre></div>
<pre><code>##                                                    Mean_SE Min_Estimate
## (A) LCS-Experimental                              296.2033     782.8049
## (B) LCS-PSID1                                     404.2344   -4172.1762
## (C) Trimmed LCS-PSID1                             415.5071    -848.9421
## (D) Top PSID1: card                               396.7480    -456.3466
## (E) Top PSID1: adap_weight_trunc_overlap_weight   367.6119   -4577.7195
## (F) Top PSID1: fix_max_value_trunc_overlap_weight 367.5901   -4577.7195
## (G) Top PSID1: overlap_weight                     356.4673   -4577.7195
## (H) Top PSID1: at_perc_trunc_overlap_weight       367.5901   -4577.7195
##                                                   Max_Estimate Diff_Estimate
## (A) LCS-Experimental                                 1059.0663      276.2614
## (B) LCS-PSID1                                        1228.6598     5400.8360
## (C) Trimmed LCS-PSID1                                1126.9783     1975.9204
## (D) Top PSID1: card                                  -119.1435      337.2030
## (E) Top PSID1: adap_weight_trunc_overlap_weight       986.9403     5564.6598
## (F) Top PSID1: fix_max_value_trunc_overlap_weight     986.9403     5564.6598
## (G) Top PSID1: overlap_weight                         986.9403     5564.6598
## (H) Top PSID1: at_perc_trunc_overlap_weight           986.9403     5564.6598</code></pre>
<div class="sourceCode" id="cb197"><pre class="sourceCode r fold-hide"><code class="sourceCode r"><span id="cb197-1"><a href="set-up.html#cb197-1" tabindex="-1"></a><span class="co"># get result matrix</span></span>
<span id="cb197-2"><a href="set-up.html#cb197-2" tabindex="-1"></a>result_mat <span class="ot">&lt;-</span> <span class="fu">create_matrix_results</span>(all_outs, plot_titles)</span>
<span id="cb197-3"><a href="set-up.html#cb197-3" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">kable</span>(result_mat, <span class="at">booktabs =</span> <span class="cn">TRUE</span>, <span class="at">caption =</span> <span class="st">&quot;LCS ATT Estimates and SEs for All Samples and Estimators&quot;</span>)</span></code></pre></div>
<table>
<caption><span id="tab:unnamed-chunk-135">Table 2.1: </span>LCS ATT Estimates and SEs for All Samples and Estimators</caption>
<colgroup>
<col width="6%" />
<col width="6%" />
<col width="2%" />
<col width="4%" />
<col width="2%" />
<col width="6%" />
<col width="2%" />
<col width="5%" />
<col width="2%" />
<col width="13%" />
<col width="2%" />
<col width="14%" />
<col width="2%" />
<col width="8%" />
<col width="2%" />
<col width="12%" />
<col width="2%" />
</colgroup>
<thead>
<tr class="header">
<th align="left"></th>
<th align="left">(A) LCS-Experimental</th>
<th align="left"></th>
<th align="left">(B) LCS-PSID1</th>
<th align="left"></th>
<th align="left">(C) Trimmed LCS-PSID1</th>
<th align="left"></th>
<th align="left">(D) Top PSID1: card</th>
<th align="left"></th>
<th align="left">(E) Top PSID1: adap_weight_trunc_overlap_weight</th>
<th align="left"></th>
<th align="left">(F) Top PSID1: fix_max_value_trunc_overlap_weight</th>
<th align="left"></th>
<th align="left">(G) Top PSID1: overlap_weight</th>
<th align="left"></th>
<th align="left">(H) Top PSID1: at_perc_trunc_overlap_weight</th>
<th align="left"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">Experimental Benchmark</td>
<td align="left">821.49</td>
<td align="left">(307.89)</td>
<td align="left">-4172.18</td>
<td align="left">(412.18)</td>
<td align="left">-848.94</td>
<td align="left">(419.03)</td>
<td align="left">-313.44</td>
<td align="left">(407.40)</td>
<td align="left">-4577.72</td>
<td align="left">(377.25)</td>
<td align="left">-4577.72</td>
<td align="left">(377.25)</td>
<td align="left">-4577.72</td>
<td align="left">(377.25)</td>
<td align="left">-4577.72</td>
<td align="left">(377.25)</td>
</tr>
<tr class="even">
<td align="left">diff</td>
<td align="left">821.49</td>
<td align="left">(307.89)</td>
<td align="left">-4172.18</td>
<td align="left">(412.18)</td>
<td align="left">-848.94</td>
<td align="left">(419.03)</td>
<td align="left">-313.44</td>
<td align="left">(407.40)</td>
<td align="left">-4577.72</td>
<td align="left">(377.25)</td>
<td align="left">-4577.72</td>
<td align="left">(377.25)</td>
<td align="left">-4577.72</td>
<td align="left">(377.25)</td>
<td align="left">-4577.72</td>
<td align="left">(377.25)</td>
</tr>
<tr class="odd">
<td align="left">reg</td>
<td align="left">848.63</td>
<td align="left">(303.41)</td>
<td align="left">808.44</td>
<td align="left">(389.48)</td>
<td align="left">390.74</td>
<td align="left">(415.74)</td>
<td align="left">-286.82</td>
<td align="left">(387.76)</td>
<td align="left">152.92</td>
<td align="left">(342.69)</td>
<td align="left">152.92</td>
<td align="left">(342.69)</td>
<td align="left">152.92</td>
<td align="left">(342.69)</td>
<td align="left">152.92</td>
<td align="left">(342.69)</td>
</tr>
<tr class="even">
<td align="left">om.reg</td>
<td align="left">895.65</td>
<td align="left">(230.21)</td>
<td align="left">1128.29</td>
<td align="left">(239.37)</td>
<td align="left">655.41</td>
<td align="left">(293.53)</td>
<td align="left">-245.12</td>
<td align="left">(282.98)</td>
<td align="left">739.76</td>
<td align="left">(164.55)</td>
<td align="left">739.76</td>
<td align="left">(164.55)</td>
<td align="left">739.76</td>
<td align="left">(164.55)</td>
<td align="left">739.76</td>
<td align="left">(164.55)</td>
</tr>
<tr class="odd">
<td align="left">om.grf</td>
<td align="left">869.18</td>
<td align="left">(230.14)</td>
<td align="left">937.89</td>
<td align="left">(238.14)</td>
<td align="left">470.63</td>
<td align="left">(295.81)</td>
<td align="left">-384.52</td>
<td align="left">(280.74)</td>
<td align="left">463.70</td>
<td align="left">(163.34)</td>
<td align="left">484.83</td>
<td align="left">(163.45)</td>
<td align="left">484.83</td>
<td align="left">(163.45)</td>
<td align="left">484.83</td>
<td align="left">(163.45)</td>
</tr>
<tr class="even">
<td align="left">matching</td>
<td align="left">1059.07</td>
<td align="left">(320.55)</td>
<td align="left">1036.86</td>
<td align="left">(531.41)</td>
<td align="left">540.05</td>
<td align="left">(533.76)</td>
<td align="left">-456.35</td>
<td align="left">(508.65)</td>
<td align="left">681.42</td>
<td align="left">(482.73)</td>
<td align="left">681.42</td>
<td align="left">(482.73)</td>
<td align="left">681.42</td>
<td align="left">(482.73)</td>
<td align="left">681.42</td>
<td align="left">(482.73)</td>
</tr>
<tr class="odd">
<td align="left">psm</td>
<td align="left">782.80</td>
<td align="left">(306.86)</td>
<td align="left">728.12</td>
<td align="left">(336.80)</td>
<td align="left">1126.98</td>
<td align="left">(378.48)</td>
<td align="left">-119.14</td>
<td align="left">(401.91)</td>
<td align="left">562.69</td>
<td align="left">(233.34)</td>
<td align="left">569.19</td>
<td align="left">(232.97)</td>
<td align="left">569.19</td>
<td align="left">(232.97)</td>
<td align="left">569.19</td>
<td align="left">(232.97)</td>
</tr>
<tr class="even">
<td align="left">ipw</td>
<td align="left">914.46</td>
<td align="left">(313.97)</td>
<td align="left">978.91</td>
<td align="left">(471.60)</td>
<td align="left">570.32</td>
<td align="left">(465.21)</td>
<td align="left">-313.44</td>
<td align="left">(407.40)</td>
<td align="left">919.66</td>
<td align="left">(465.91)</td>
<td align="left">919.66</td>
<td align="left">(465.91)</td>
<td align="left">-87.61</td>
<td align="left">(364.42)</td>
<td align="left">919.66</td>
<td align="left">(465.91)</td>
</tr>
<tr class="odd">
<td align="left">cbps</td>
<td align="left">896.05</td>
<td align="left">(304.69)</td>
<td align="left">1216.52</td>
<td align="left">(429.26)</td>
<td align="left">730.25</td>
<td align="left">(435.65)</td>
<td align="left">-313.44</td>
<td align="left">(407.40)</td>
<td align="left">849.28</td>
<td align="left">(396.39)</td>
<td align="left">849.28</td>
<td align="left">(396.39)</td>
<td align="left">-87.61</td>
<td align="left">(364.42)</td>
<td align="left">849.28</td>
<td align="left">(396.39)</td>
</tr>
<tr class="even">
<td align="left">ebal</td>
<td align="left">896.09</td>
<td align="left">(304.69)</td>
<td align="left">1228.66</td>
<td align="left">(429.73)</td>
<td align="left">732.89</td>
<td align="left">(436.94)</td>
<td align="left">-224.33</td>
<td align="left">(411.01)</td>
<td align="left">850.40</td>
<td align="left">(396.48)</td>
<td align="left">850.40</td>
<td align="left">(396.48)</td>
<td align="left">850.40</td>
<td align="left">(396.48)</td>
<td align="left">850.40</td>
<td align="left">(396.48)</td>
</tr>
<tr class="odd">
<td align="left">dml</td>
<td align="left">787.78</td>
<td align="left">(300.62)</td>
<td align="left">813.84</td>
<td align="left">(387.60)</td>
<td align="left">406.80</td>
<td align="left">(414.78)</td>
<td align="left">-292.46</td>
<td align="left">(385.28)</td>
<td align="left">155.06</td>
<td align="left">(340.94)</td>
<td align="left">155.06</td>
<td align="left">(340.94)</td>
<td align="left">155.06</td>
<td align="left">(340.94)</td>
<td align="left">155.06</td>
<td align="left">(340.94)</td>
</tr>
<tr class="even">
<td align="left">aipw_grf</td>
<td align="left">935.73</td>
<td align="left">(313.81)</td>
<td align="left">1070.38</td>
<td align="left">(498.86)</td>
<td align="left">486.96</td>
<td align="left">(461.06)</td>
<td align="left">-356.14</td>
<td align="left">(468.80)</td>
<td align="left">958.14</td>
<td align="left">(505.34)</td>
<td align="left">958.14</td>
<td align="left">(505.34)</td>
<td align="left">958.14</td>
<td align="left">(505.34)</td>
<td align="left">958.14</td>
<td align="left">(505.34)</td>
</tr>
<tr class="odd">
<td align="left">aipw_ow</td>
<td align="left">833.45</td>
<td align="left">(317.61)</td>
<td align="left">1127.15</td>
<td align="left">(486.38)</td>
<td align="left">521.14</td>
<td align="left">(436.08)</td>
<td align="left">-254.22</td>
<td align="left">(411.64)</td>
<td align="left">986.94</td>
<td align="left">(542.37)</td>
<td align="left">986.94</td>
<td align="left">(542.37)</td>
<td align="left">986.94</td>
<td align="left">(542.37)</td>
<td align="left">986.94</td>
<td align="left">(542.37)</td>
</tr>
</tbody>
</table>
<p>The tabulated results confirm visual patterns: Column (A) reports the estimates for the LCS-Experimental sample, column (B) for the LCS-PSID1 sample, and column (C) for its trimmed version. Columns (D)-(H) show results of the top-ranked sample of LCS-PSID1.</p>
<p>For all PSID1-based samples, the ATT estimates remain overly positive. However, the estimates obtained with the <code>Diff-in-Means</code> estimator are consistently negative. Likewise, for the sample constructed with the <code>card</code> method, the estimates remain negative across all estimators.</p>
<div class="sourceCode" id="cb198"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb198-1"><a href="set-up.html#cb198-1" tabindex="-1"></a><span class="co"># save results </span></span>
<span id="cb198-2"><a href="set-up.html#cb198-2" tabindex="-1"></a><span class="fu">save_csv</span>(result_mat, <span class="st">&quot;LCS_att_estimates&quot;</span>)</span></code></pre></div>
</div>
<div id="conditional-average-treatment-effect-on-the-treated-catt-1" class="section level3 hasAnchor" number="2.8.2">
<h3><span class="header-section-number">2.8.2</span> Conditional average treatment effect on the treated (CATT)<a href="set-up.html#conditional-average-treatment-effect-on-the-treated-catt-1" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb199"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb199-1"><a href="set-up.html#cb199-1" tabindex="-1"></a>catt.lcs <span class="ot">&lt;-</span> <span class="fu">catt</span>(lcs, Y, treat, covar)</span>
<span id="cb199-2"><a href="set-up.html#cb199-2" tabindex="-1"></a>catt.psid <span class="ot">&lt;-</span> <span class="fu">catt</span>(lcs_psid, Y, treat, covar)</span>
<span id="cb199-3"><a href="set-up.html#cb199-3" tabindex="-1"></a>catt.psid.trim <span class="ot">&lt;-</span> <span class="fu">catt</span>(lcs_psid.trim_match, Y, treat, covar)</span></code></pre></div>
<div class="sourceCode" id="cb200"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb200-1"><a href="set-up.html#cb200-1" tabindex="-1"></a>catt.top5_psid_plus <span class="ot">&lt;-</span> <span class="fu">lapply</span>(top5_datasets.psid_plus, <span class="cf">function</span>(d) <span class="fu">catt</span>(d, Y, treat, covar))</span></code></pre></div>
<div class="sourceCode" id="cb201"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb201-1"><a href="set-up.html#cb201-1" tabindex="-1"></a><span class="co"># combine all catt objects </span></span>
<span id="cb201-2"><a href="set-up.html#cb201-2" tabindex="-1"></a>all_catt <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fu">list</span>(catt.lcs,catt.psid, catt.psid.trim), catt.top5_psid_plus)</span>
<span id="cb201-3"><a href="set-up.html#cb201-3" tabindex="-1"></a></span>
<span id="cb201-4"><a href="set-up.html#cb201-4" tabindex="-1"></a><span class="co"># plot results</span></span>
<span id="cb201-5"><a href="set-up.html#cb201-5" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">2</span>))</span>
<span id="cb201-6"><a href="set-up.html#cb201-6" tabindex="-1"></a><span class="fu">par</span>(<span class="at">cex.main =</span> <span class="fl">0.6</span>)</span>
<span id="cb201-7"><a href="set-up.html#cb201-7" tabindex="-1"></a><span class="fu">plot_catt_panels</span>(all_catt, plot_titles)</span></code></pre></div>
<div class="figure"><span style="display:block;" id="fig:unnamed-chunk-139-1"></span>
<img src="Outcome-Weights_files/figure-html/unnamed-chunk-139-1.png" alt="FIGURE 11. CATT Estimates using LCS Data" width="100%" />
<p class="caption">
Figure 2.64: FIGURE 11. CATT Estimates using LCS Data
</p>
</div>
<div class="figure"><span style="display:block;" id="fig:unnamed-chunk-139-2"></span>
<img src="Outcome-Weights_files/figure-html/unnamed-chunk-139-2.png" alt="FIGURE 11. CATT Estimates using LCS Data" width="100%" />
<p class="caption">
Figure 2.65: FIGURE 11. CATT Estimates using LCS Data
</p>
</div>
<div class="sourceCode" id="cb202"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb202-1"><a href="set-up.html#cb202-1" tabindex="-1"></a><span class="fu">eval_catt</span>(all_catt, plot_titles)</span></code></pre></div>
<pre><code>##                                              Method  Min_Catt Max_Catt
## 1                              (A) LCS-Experimental  -359.430 2719.135
## 2                                     (B) LCS-PSID1 -3357.477 2404.333
## 3                             (C) Trimmed LCS-PSID1 -3180.261 2485.600
## 4                               (D) Top PSID1: card -2868.709 2266.442
## 5   (E) Top PSID1: adap_weight_trunc_overlap_weight -3768.323 2245.871
## 6 (F) Top PSID1: fix_max_value_trunc_overlap_weight -3933.587 2281.324
## 7                     (G) Top PSID1: overlap_weight -3870.814 2250.947
## 8       (H) Top PSID1: at_perc_trunc_overlap_weight -3823.429 2244.234
##   Mean_Catt Diff_Catt
## 1  863.5073  3078.565
## 2  802.2476  5761.810
## 3  298.2523  5665.860
## 4 -415.7054  5135.151
## 5  423.4495  6014.194
## 6  430.5526  6214.911
## 7  415.5800  6121.760
## 8  391.2748  6067.663</code></pre>
<p>With LCS-PSID1, CATT estimates span from $-3,357.48 to $2,404.33, contrasting with the CATT estimated from experimental data which ranges from $-359.43 to $2,719.14, with a mean CATT estimate of $863.51.</p>
<p>In contract, across the LCS-PSID1-based samples, the ranges of CATT estimates are relatively similar. Importantly, the mean CATT estimates remain positive in all cases, except for <code>card</code> sample, that produces a mean CATT estimate of $-415.71.</p>
<div class="sourceCode" id="cb204"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb204-1"><a href="set-up.html#cb204-1" tabindex="-1"></a><span class="co"># save results</span></span>
<span id="cb204-2"><a href="set-up.html#cb204-2" tabindex="-1"></a><span class="fu">save_catt_panels</span>(all_catt, plot_titles, <span class="at">prefix =</span> <span class="st">&quot;lcs&quot;</span>)</span></code></pre></div>
</div>
<div id="quantile-treatment-effect-on-the-treated-qtet" class="section level3 hasAnchor" number="2.8.3">
<h3><span class="header-section-number">2.8.3</span> Quantile treatment effect on the treated (QTET)<a href="set-up.html#quantile-treatment-effect-on-the-treated-qtet" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb205"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb205-1"><a href="set-up.html#cb205-1" tabindex="-1"></a>qte.lcs <span class="ot">&lt;-</span> <span class="fu">est_qte</span>(Y, treat, covar, <span class="at">data =</span> lcs, <span class="at">cores =</span> <span class="dv">4</span>)</span></code></pre></div>
<div class="sourceCode" id="cb206"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb206-1"><a href="set-up.html#cb206-1" tabindex="-1"></a>qte.lcs_psid <span class="ot">&lt;-</span> <span class="fu">est_qte</span>(Y, treat, covar, <span class="at">data =</span> lcs_psid)</span>
<span id="cb206-2"><a href="set-up.html#cb206-2" tabindex="-1"></a>qte.lcs_psid.trim <span class="ot">&lt;-</span> <span class="fu">est_qte</span>(Y, treat, covar, <span class="at">data =</span> lcs_psid.trim_match) </span></code></pre></div>
<div class="sourceCode" id="cb207"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb207-1"><a href="set-up.html#cb207-1" tabindex="-1"></a>qte.top5_psid_plus <span class="ot">&lt;-</span> <span class="fu">lapply</span>(top5_datasets.psid_plus, <span class="cf">function</span>(d) <span class="fu">est_qte</span>(Y, treat, covar, <span class="at">data =</span> d))</span></code></pre></div>
<div class="sourceCode" id="cb208"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb208-1"><a href="set-up.html#cb208-1" tabindex="-1"></a>qte.lcs0 <span class="ot">&lt;-</span> <span class="fu">est_qte</span>(Y, treat, <span class="cn">NULL</span>, <span class="at">data =</span> lcs)</span>
<span id="cb208-2"><a href="set-up.html#cb208-2" tabindex="-1"></a>qte.lcs_psid0 <span class="ot">&lt;-</span> <span class="fu">est_qte</span>(Y, treat, <span class="cn">NULL</span>, <span class="at">data =</span> lcs_psid)</span>
<span id="cb208-3"><a href="set-up.html#cb208-3" tabindex="-1"></a>qte.lcs_psid.trim0 <span class="ot">&lt;-</span> <span class="fu">est_qte</span>(Y, treat, <span class="cn">NULL</span>, <span class="at">data =</span> lcs_psid.trim_match)</span>
<span id="cb208-4"><a href="set-up.html#cb208-4" tabindex="-1"></a>qte.top5_psid_plus0 <span class="ot">&lt;-</span> <span class="fu">lapply</span>(top5_datasets.psid_plus, <span class="cf">function</span>(d) <span class="fu">est_qte</span>(Y, treat, <span class="cn">NULL</span>, <span class="at">data =</span> d))</span></code></pre></div>
<div class="sourceCode" id="cb209"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb209-1"><a href="set-up.html#cb209-1" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">2</span>))</span>
<span id="cb209-2"><a href="set-up.html#cb209-2" tabindex="-1"></a><span class="fu">par</span>(<span class="at">cex.main =</span> <span class="fl">0.6</span>)</span>
<span id="cb209-3"><a href="set-up.html#cb209-3" tabindex="-1"></a></span>
<span id="cb209-4"><a href="set-up.html#cb209-4" tabindex="-1"></a><span class="co"># PSID</span></span>
<span id="cb209-5"><a href="set-up.html#cb209-5" tabindex="-1"></a><span class="fu">plot_qte</span>(qte.lcs_psid, qte.lcs_psid0, qte.lcs, <span class="at">main =</span> <span class="st">&quot;(B) LCS-PSID&quot;</span>, <span class="at">ylim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">25000</span>, <span class="dv">15000</span>))</span>
<span id="cb209-6"><a href="set-up.html#cb209-6" tabindex="-1"></a><span class="fu">legend</span>(<span class="st">&quot;bottomleft&quot;</span>, <span class="at">legend =</span> <span class="fu">c</span>(<span class="st">&quot;Experimental&quot;</span>, <span class="st">&quot;Unadjusted&quot;</span>, <span class="st">&quot;Adjusted&quot;</span>), <span class="at">lty =</span> <span class="dv">1</span>, <span class="at">pch =</span> <span class="fu">c</span>(<span class="dv">16</span>, <span class="dv">17</span>, <span class="dv">16</span>), <span class="at">col =</span> <span class="fu">c</span>(<span class="dv">4</span>, <span class="dv">2</span>, <span class="dv">1</span>), <span class="at">bty =</span> <span class="st">&quot;n&quot;</span>)</span>
<span id="cb209-7"><a href="set-up.html#cb209-7" tabindex="-1"></a></span>
<span id="cb209-8"><a href="set-up.html#cb209-8" tabindex="-1"></a><span class="co"># PSID trimmed</span></span>
<span id="cb209-9"><a href="set-up.html#cb209-9" tabindex="-1"></a><span class="fu">plot_qte</span>(qte.lcs_psid.trim, qte.lcs_psid.trim0, qte.lcs_psid, <span class="at">main =</span> <span class="st">&quot;(C) LCS-PSID (Trimmed)&quot;</span>, <span class="at">ylim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">25000</span>, <span class="dv">15000</span>))</span>
<span id="cb209-10"><a href="set-up.html#cb209-10" tabindex="-1"></a><span class="fu">legend</span>(<span class="st">&quot;bottomleft&quot;</span>, <span class="at">legend =</span> <span class="fu">c</span>(<span class="st">&quot;Experimental&quot;</span>, <span class="st">&quot;Unadjusted&quot;</span>, <span class="st">&quot;Adjusted&quot;</span>), </span>
<span id="cb209-11"><a href="set-up.html#cb209-11" tabindex="-1"></a>    <span class="at">lty =</span> <span class="dv">1</span>, <span class="at">pch =</span> <span class="fu">c</span>(<span class="dv">16</span>, <span class="dv">17</span>, <span class="dv">16</span>), <span class="at">col =</span> <span class="fu">c</span>(<span class="dv">4</span>, <span class="dv">2</span>, <span class="dv">1</span>), <span class="at">bty =</span> <span class="st">&quot;n&quot;</span>)</span>
<span id="cb209-12"><a href="set-up.html#cb209-12" tabindex="-1"></a></span>
<span id="cb209-13"><a href="set-up.html#cb209-13" tabindex="-1"></a><span class="co"># PSID top methods</span></span>
<span id="cb209-14"><a href="set-up.html#cb209-14" tabindex="-1"></a><span class="fu">plot_qte_top</span>(qte.top5_psid_plus, qte.top5_psid_plus0, qte.lcs_psid, plot_titles, <span class="at">main_start =</span> <span class="dv">2</span>, <span class="at">ylim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">25000</span>, <span class="dv">15000</span>))</span></code></pre></div>
<div class="figure"><span style="display:block;" id="fig:unnamed-chunk-146-1"></span>
<img src="Outcome-Weights_files/figure-html/unnamed-chunk-146-1.png" alt="FIGURE C12. QTET Estimates Model A using NSW Data: Experimental vs. Nonexperimental" width="100%" />
<p class="caption">
Figure 2.66: FIGURE C12. QTET Estimates Model A using NSW Data: Experimental vs. Nonexperimental
</p>
</div>
<div class="figure"><span style="display:block;" id="fig:unnamed-chunk-146-2"></span>
<img src="Outcome-Weights_files/figure-html/unnamed-chunk-146-2.png" alt="FIGURE C12. QTET Estimates Model A using NSW Data: Experimental vs. Nonexperimental" width="100%" />
<p class="caption">
Figure 2.67: FIGURE C12. QTET Estimates Model A using NSW Data: Experimental vs. Nonexperimental
</p>
</div>
<p>These figures present QTET estimates obtained from LCS-Experimental sample and several observational samples. The QTETs estimated from both the original and trimmed LCS-PSID1 samples (B and C), as well as from the top-ranked samples (E through H), align comparatively close with the true QTET. However, the QTETs from sample (F) exhibit a stronger bias, suggesting greater estimation uncertainty.</p>
<div class="sourceCode" id="cb210"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb210-1"><a href="set-up.html#cb210-1" tabindex="-1"></a>plots_lcs <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb210-2"><a href="set-up.html#cb210-2" tabindex="-1"></a>  <span class="fu">list</span>(<span class="at">mod =</span> qte.lcs_psid, <span class="at">mod0 =</span> qte.lcs_psid0, <span class="at">bm =</span> qte.lcs, <span class="at">main =</span> <span class="st">&quot;(B) LCS PSID&quot;</span>),</span>
<span id="cb210-3"><a href="set-up.html#cb210-3" tabindex="-1"></a>  <span class="fu">list</span>(<span class="at">mod =</span> qte.lcs_psid.trim, <span class="at">mod0 =</span> qte.lcs_psid.trim0, <span class="at">bm =</span> qte.lcs_psid, <span class="at">main =</span> <span class="st">&quot;(D) LCS PSID (Trimmed)&quot;</span>)</span>
<span id="cb210-4"><a href="set-up.html#cb210-4" tabindex="-1"></a>)</span>
<span id="cb210-5"><a href="set-up.html#cb210-5" tabindex="-1"></a></span>
<span id="cb210-6"><a href="set-up.html#cb210-6" tabindex="-1"></a><span class="fu">save_qtet</span>(plots_lcs, <span class="at">prefix =</span> <span class="st">&quot;lcs&quot;</span>, <span class="at">ylim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">25000</span>, <span class="dv">15000</span>))</span>
<span id="cb210-7"><a href="set-up.html#cb210-7" tabindex="-1"></a><span class="fu">save_qte_top</span>(qte.top5_psid_plus, qte.top5_psid_plus0, qte.lcs_psid, plot_titles, <span class="at">main_start =</span> <span class="dv">4</span>, <span class="at">ylim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">25000</span>, <span class="dv">15000</span>), <span class="at">prefix =</span> <span class="st">&quot;lcs_top&quot;</span>)</span></code></pre></div>
</div>
<div id="assessing-outcome-weights-ow" class="section level3 hasAnchor" number="2.8.4">
<h3><span class="header-section-number">2.8.4</span> Assessing outcome weights (OW)<a href="set-up.html#assessing-outcome-weights-ow" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb211"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb211-1"><a href="set-up.html#cb211-1" tabindex="-1"></a><span class="co"># list all datasets</span></span>
<span id="cb211-2"><a href="set-up.html#cb211-2" tabindex="-1"></a>all_datasets <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fu">list</span>(lcs, lcs_psid, lcs_psid.trim_match), top5_datasets.psid_plus)</span></code></pre></div>
<div class="sourceCode" id="cb212"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb212-1"><a href="set-up.html#cb212-1" tabindex="-1"></a><span class="co"># estimate ATT </span></span>
<span id="cb212-2"><a href="set-up.html#cb212-2" tabindex="-1"></a>res_att <span class="ot">&lt;-</span> <span class="fu">get_res_att</span>(all_datasets, Y, treat, covar)</span>
<span id="cb212-3"><a href="set-up.html#cb212-3" tabindex="-1"></a><span class="co"># extract outcome weights</span></span>
<span id="cb212-4"><a href="set-up.html#cb212-4" tabindex="-1"></a>ow_att <span class="ot">&lt;-</span> <span class="fu">derive_ow</span>(res_att)</span></code></pre></div>
<div class="sourceCode" id="cb213"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb213-1"><a href="set-up.html#cb213-1" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">2</span>))</span>
<span id="cb213-2"><a href="set-up.html#cb213-2" tabindex="-1"></a><span class="fu">par</span>(<span class="at">cex.main =</span> <span class="fl">0.6</span>)</span>
<span id="cb213-3"><a href="set-up.html#cb213-3" tabindex="-1"></a><span class="co"># plot outcome weights distribution</span></span>
<span id="cb213-4"><a href="set-up.html#cb213-4" tabindex="-1"></a><span class="fu">plot_ow</span>(ow_att, plot_titles) </span></code></pre></div>
<div class="figure"><span style="display:block;" id="fig:unnamed-chunk-150-1"></span>
<img src="Outcome-Weights_files/figure-html/unnamed-chunk-150-1.png" alt="FIGURE A14. Outcome Weights using LCS Data" width="100%" />
<p class="caption">
Figure 2.68: FIGURE A14. Outcome Weights using LCS Data
</p>
</div>
<div class="figure"><span style="display:block;" id="fig:unnamed-chunk-150-2"></span>
<img src="Outcome-Weights_files/figure-html/unnamed-chunk-150-2.png" alt="FIGURE A14. Outcome Weights using LCS Data" width="100%" />
<p class="caption">
Figure 2.69: FIGURE A14. Outcome Weights using LCS Data
</p>
</div>
<div class="sourceCode" id="cb214"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb214-1"><a href="set-up.html#cb214-1" tabindex="-1"></a><span class="co">#evaluate results</span></span>
<span id="cb214-2"><a href="set-up.html#cb214-2" tabindex="-1"></a><span class="fu">eval_ow</span>(ow_att, all_datasets, plot_titles, <span class="at">treat_var =</span> treat, <span class="at">estimator =</span> <span class="st">&quot;AIPW-ATT&quot;</span>)</span></code></pre></div>
<pre><code>##                                              Method Sum_Treated Sum_Untreated
## 1                              (A) LCS-Experimental           1            -1
## 2                                     (B) LCS-PSID1           1            -1
## 3                             (C) Trimmed LCS-PSID1           1            -1
## 4                               (D) Top PSID1: card           1            -1
## 5   (E) Top PSID1: adap_weight_trunc_overlap_weight           1            -1
## 6 (F) Top PSID1: fix_max_value_trunc_overlap_weight           1            -1
## 7                     (G) Top PSID1: overlap_weight           1            -1
## 8       (H) Top PSID1: at_perc_trunc_overlap_weight           1            -1</code></pre>
<p>Consistent with the preceding sections, the evaluation shows that, across each sample, the estimated outcome weights sum to one within the treated group and to minus one within the untreated group, yielding an overall total of zero.</p>
<div class="sourceCode" id="cb216"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb216-1"><a href="set-up.html#cb216-1" tabindex="-1"></a><span class="co">#save results</span></span>
<span id="cb216-2"><a href="set-up.html#cb216-2" tabindex="-1"></a><span class="fu">save_ow</span>(ow_att, plot_titles, <span class="at">prefix =</span> <span class="st">&quot;lcs&quot;</span>)</span></code></pre></div>
</div>
</div>
<div id="validation-through-placebo-analyses" class="section level2 hasAnchor" number="2.9">
<h2><span class="header-section-number">2.9</span> Validation through placebo analyses<a href="set-up.html#validation-through-placebo-analyses" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div class="sourceCode" id="cb217"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb217-1"><a href="set-up.html#cb217-1" tabindex="-1"></a><span class="co"># define variables</span></span>
<span id="cb217-2"><a href="set-up.html#cb217-2" tabindex="-1"></a>Y_pl <span class="ot">&lt;-</span> <span class="st">&quot;nchildren75&quot;</span></span>
<span id="cb217-3"><a href="set-up.html#cb217-3" tabindex="-1"></a>treat <span class="ot">&lt;-</span> <span class="st">&quot;treat&quot;</span></span>
<span id="cb217-4"><a href="set-up.html#cb217-4" tabindex="-1"></a>covar_pl <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;age&quot;</span>, <span class="st">&quot;educ&quot;</span>, <span class="st">&quot;nodegree&quot;</span>, <span class="st">&quot;married&quot;</span>, <span class="st">&quot;black&quot;</span>, <span class="st">&quot;hisp&quot;</span>, <span class="st">&quot;re75&quot;</span>, <span class="st">&quot;u75&quot;</span>)</span></code></pre></div>
<div class="sourceCode" id="cb218"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb218-1"><a href="set-up.html#cb218-1" tabindex="-1"></a><span class="co"># estimate placebo ATT on original and observational datasets</span></span>
<span id="cb218-2"><a href="set-up.html#cb218-2" tabindex="-1"></a>out1_pl <span class="ot">&lt;-</span> <span class="fu">estimate_all</span>(lcs, Y_pl, <span class="st">&quot;treat&quot;</span>, covar_pl)</span>
<span id="cb218-3"><a href="set-up.html#cb218-3" tabindex="-1"></a>out2_pl <span class="ot">&lt;-</span> <span class="fu">estimate_all</span>(lcs_psid, Y_pl, <span class="st">&quot;treat&quot;</span>, covar_pl)</span></code></pre></div>
<div class="sourceCode" id="cb219"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb219-1"><a href="set-up.html#cb219-1" tabindex="-1"></a><span class="co"># estimate placebo ATT on trimmed datasets (analogous to tutorial of Imbens &amp; Xu (2024))</span></span>
<span id="cb219-2"><a href="set-up.html#cb219-2" tabindex="-1"></a>out3_pl <span class="ot">&lt;-</span> <span class="fu">estimate_all</span>(lcs_psid_trim, Y_pl, <span class="st">&quot;treat&quot;</span>, covar_pl)</span></code></pre></div>
<div class="sourceCode" id="cb220"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb220-1"><a href="set-up.html#cb220-1" tabindex="-1"></a><span class="co"># estimate placebo ATT on top ranked datasets</span></span>
<span id="cb220-2"><a href="set-up.html#cb220-2" tabindex="-1"></a>out.psid_pl <span class="ot">&lt;-</span> <span class="fu">lapply</span>(top5_datasets.psid_plus, <span class="cf">function</span>(d) <span class="fu">estimate_all</span>(d, Y_pl, <span class="st">&quot;treat&quot;</span>, covar_pl))</span>
<span id="cb220-3"><a href="set-up.html#cb220-3" tabindex="-1"></a>out4_pl <span class="ot">&lt;-</span> out.psid_pl[[<span class="dv">1</span>]]</span>
<span id="cb220-4"><a href="set-up.html#cb220-4" tabindex="-1"></a>out5_pl <span class="ot">&lt;-</span> out.psid_pl[[<span class="dv">2</span>]]</span>
<span id="cb220-5"><a href="set-up.html#cb220-5" tabindex="-1"></a>out6_pl <span class="ot">&lt;-</span> out.psid_pl[[<span class="dv">3</span>]]</span>
<span id="cb220-6"><a href="set-up.html#cb220-6" tabindex="-1"></a>out7_pl <span class="ot">&lt;-</span> out.psid_pl[[<span class="dv">4</span>]]</span>
<span id="cb220-7"><a href="set-up.html#cb220-7" tabindex="-1"></a>out8_pl <span class="ot">&lt;-</span> out.psid_pl[[<span class="dv">5</span>]]</span></code></pre></div>
<div class="sourceCode" id="cb221"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb221-1"><a href="set-up.html#cb221-1" tabindex="-1"></a><span class="co"># collect all placebo results </span></span>
<span id="cb221-2"><a href="set-up.html#cb221-2" tabindex="-1"></a>all_outs.pl <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fu">list</span>(out1_pl, out2_pl, out3_pl), out.psid_pl)</span></code></pre></div>
<div class="sourceCode" id="cb222"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb222-1"><a href="set-up.html#cb222-1" tabindex="-1"></a><span class="co"># plot placebo results</span></span>
<span id="cb222-2"><a href="set-up.html#cb222-2" tabindex="-1"></a>band_pl <span class="ot">&lt;-</span> out1_pl[<span class="dv">1</span>, <span class="dv">3</span><span class="sc">:</span><span class="dv">4</span>]</span>
<span id="cb222-3"><a href="set-up.html#cb222-3" tabindex="-1"></a>est_pl  <span class="ot">&lt;-</span> out1_pl[<span class="dv">1</span>, <span class="dv">1</span>]</span>
<span id="cb222-4"><a href="set-up.html#cb222-4" tabindex="-1"></a>ylim_pl <span class="ot">=</span> <span class="fu">c</span>(<span class="sc">-</span><span class="fl">1.5</span>, <span class="dv">1</span>)</span>
<span id="cb222-5"><a href="set-up.html#cb222-5" tabindex="-1"></a><span class="fu">plot_att_panels</span>(all_outs.pl, plot_titles, band_pl, est_pl, ylim_pl)</span></code></pre></div>
<div class="figure"><span style="display:block;" id="fig:unnamed-chunk-158-1"></span>
<img src="Outcome-Weights_files/figure-html/unnamed-chunk-158-1.png" alt="FIGURE 13. Placebo Test LCS: Number of Children in 1975 as the Outcome" width="100%" />
<p class="caption">
Figure 2.70: FIGURE 13. Placebo Test LCS: Number of Children in 1975 as the Outcome
</p>
</div>
<div class="figure"><span style="display:block;" id="fig:unnamed-chunk-158-2"></span>
<img src="Outcome-Weights_files/figure-html/unnamed-chunk-158-2.png" alt="FIGURE 13. Placebo Test LCS: Number of Children in 1975 as the Outcome" width="100%" />
<p class="caption">
Figure 2.71: FIGURE 13. Placebo Test LCS: Number of Children in 1975 as the Outcome
</p>
</div>
<div class="sourceCode" id="cb223"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb223-1"><a href="set-up.html#cb223-1" tabindex="-1"></a><span class="co"># save results</span></span>
<span id="cb223-2"><a href="set-up.html#cb223-2" tabindex="-1"></a><span class="fu">save_att_panels</span>(all_outs.pl, plot_titles, band_pl, est_pl, <span class="st">&quot;lcs_placebo&quot;</span>)</span></code></pre></div>
<div class="sourceCode" id="cb224"><pre class="sourceCode r fold-hide"><code class="sourceCode r"><span id="cb224-1"><a href="set-up.html#cb224-1" tabindex="-1"></a>result_mat_pl <span class="ot">&lt;-</span> <span class="fu">create_matrix_results</span>(all_outs.pl, plot_titles)</span>
<span id="cb224-2"><a href="set-up.html#cb224-2" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">kable</span>(result_mat_pl, <span class="at">booktabs =</span> <span class="cn">TRUE</span>, <span class="at">caption =</span> <span class="st">&quot;LCS Placebo ATT Estimates and SEs for All Samples and Estimators&quot;</span>)</span></code></pre></div>
<pre><code>## Warning in attr(x, &quot;align&quot;): &#39;xfun::attr()&#39; ist veraltet.
## Benutzen Sie stattdessen &#39;xfun::attr2()&#39;
## Siehe help(&quot;Deprecated&quot;)</code></pre>
<pre><code>## Warning in attr(x, &quot;format&quot;): &#39;xfun::attr()&#39; ist veraltet.
## Benutzen Sie stattdessen &#39;xfun::attr2()&#39;
## Siehe help(&quot;Deprecated&quot;)</code></pre>
<table>
<caption><span id="tab:unnamed-chunk-160">Table 2.2: </span>LCS Placebo ATT Estimates and SEs for All Samples and Estimators</caption>
<colgroup>
<col width="7%" />
<col width="6%" />
<col width="2%" />
<col width="4%" />
<col width="2%" />
<col width="6%" />
<col width="2%" />
<col width="6%" />
<col width="2%" />
<col width="14%" />
<col width="2%" />
<col width="15%" />
<col width="2%" />
<col width="9%" />
<col width="2%" />
<col width="13%" />
<col width="2%" />
</colgroup>
<thead>
<tr class="header">
<th align="left"></th>
<th align="left">(A) LCS-Experimental</th>
<th align="left"></th>
<th align="left">(B) LCS-PSID1</th>
<th align="left"></th>
<th align="left">(C) Trimmed LCS-PSID1</th>
<th align="left"></th>
<th align="left">(D) Top PSID1: card</th>
<th align="left"></th>
<th align="left">(E) Top PSID1: adap_weight_trunc_overlap_weight</th>
<th align="left"></th>
<th align="left">(F) Top PSID1: fix_max_value_trunc_overlap_weight</th>
<th align="left"></th>
<th align="left">(G) Top PSID1: overlap_weight</th>
<th align="left"></th>
<th align="left">(H) Top PSID1: at_perc_trunc_overlap_weight</th>
<th align="left"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">Experimental Benchmark</td>
<td align="left">-0.05</td>
<td align="left">(0.08)</td>
<td align="left">0.47</td>
<td align="left">(0.09)</td>
<td align="left">0.51</td>
<td align="left">(0.08)</td>
<td align="left">0.01</td>
<td align="left">(0.11)</td>
<td align="left">0.49</td>
<td align="left">(0.08)</td>
<td align="left">0.49</td>
<td align="left">(0.08)</td>
<td align="left">0.49</td>
<td align="left">(0.08)</td>
<td align="left">0.49</td>
<td align="left">(0.08)</td>
</tr>
<tr class="even">
<td align="left">diff</td>
<td align="left">-0.05</td>
<td align="left">(0.08)</td>
<td align="left">0.47</td>
<td align="left">(0.09)</td>
<td align="left">0.51</td>
<td align="left">(0.08)</td>
<td align="left">0.01</td>
<td align="left">(0.11)</td>
<td align="left">0.49</td>
<td align="left">(0.08)</td>
<td align="left">0.49</td>
<td align="left">(0.08)</td>
<td align="left">0.49</td>
<td align="left">(0.08)</td>
<td align="left">0.49</td>
<td align="left">(0.08)</td>
</tr>
<tr class="odd">
<td align="left">reg</td>
<td align="left">-0.05</td>
<td align="left">(0.08)</td>
<td align="left">-0.18</td>
<td align="left">(0.11)</td>
<td align="left">0.05</td>
<td align="left">(0.10)</td>
<td align="left">-0.02</td>
<td align="left">(0.11)</td>
<td align="left">-0.07</td>
<td align="left">(0.10)</td>
<td align="left">-0.07</td>
<td align="left">(0.10)</td>
<td align="left">-0.07</td>
<td align="left">(0.10)</td>
<td align="left">-0.07</td>
<td align="left">(0.10)</td>
</tr>
<tr class="even">
<td align="left">om.reg</td>
<td align="left">-0.05</td>
<td align="left">(0.05)</td>
<td align="left">-0.22</td>
<td align="left">(0.06)</td>
<td align="left">-0.07</td>
<td align="left">(0.05)</td>
<td align="left">-0.02</td>
<td align="left">(0.07)</td>
<td align="left">-0.20</td>
<td align="left">(0.04)</td>
<td align="left">-0.20</td>
<td align="left">(0.04)</td>
<td align="left">-0.20</td>
<td align="left">(0.04)</td>
<td align="left">-0.20</td>
<td align="left">(0.04)</td>
</tr>
<tr class="odd">
<td align="left">om.grf</td>
<td align="left">-0.05</td>
<td align="left">(0.06)</td>
<td align="left">-0.52</td>
<td align="left">(0.06)</td>
<td align="left">-0.30</td>
<td align="left">(0.05)</td>
<td align="left">-0.28</td>
<td align="left">(0.07)</td>
<td align="left">-0.50</td>
<td align="left">(0.04)</td>
<td align="left">-0.49</td>
<td align="left">(0.04)</td>
<td align="left">-0.49</td>
<td align="left">(0.04)</td>
<td align="left">-0.49</td>
<td align="left">(0.04)</td>
</tr>
<tr class="even">
<td align="left">matching</td>
<td align="left">-0.06</td>
<td align="left">(0.07)</td>
<td align="left">-0.71</td>
<td align="left">(0.14)</td>
<td align="left">-0.47</td>
<td align="left">(0.13)</td>
<td align="left">-0.30</td>
<td align="left">(0.15)</td>
<td align="left">-0.65</td>
<td align="left">(0.14)</td>
<td align="left">-0.65</td>
<td align="left">(0.14)</td>
<td align="left">-0.65</td>
<td align="left">(0.14)</td>
<td align="left">-0.65</td>
<td align="left">(0.14)</td>
</tr>
<tr class="odd">
<td align="left">psm</td>
<td align="left">-0.10</td>
<td align="left">(0.07)</td>
<td align="left">-0.74</td>
<td align="left">(0.09)</td>
<td align="left">-0.20</td>
<td align="left">(0.08)</td>
<td align="left">-0.43</td>
<td align="left">(0.11)</td>
<td align="left">-0.78</td>
<td align="left">(0.07)</td>
<td align="left">-0.77</td>
<td align="left">(0.07)</td>
<td align="left">-0.77</td>
<td align="left">(0.07)</td>
<td align="left">-0.77</td>
<td align="left">(0.07)</td>
</tr>
<tr class="even">
<td align="left">ipw</td>
<td align="left">-0.05</td>
<td align="left">(0.08)</td>
<td align="left">-0.67</td>
<td align="left">(0.15)</td>
<td align="left">-0.34</td>
<td align="left">(0.14)</td>
<td align="left">0.01</td>
<td align="left">(0.11)</td>
<td align="left">-0.76</td>
<td align="left">(0.16)</td>
<td align="left">-0.76</td>
<td align="left">(0.16)</td>
<td align="left">-0.07</td>
<td align="left">(0.11)</td>
<td align="left">-0.76</td>
<td align="left">(0.16)</td>
</tr>
<tr class="odd">
<td align="left">cbps</td>
<td align="left">-0.05</td>
<td align="left">(0.08)</td>
<td align="left">-0.27</td>
<td align="left">(0.14)</td>
<td align="left">-0.08</td>
<td align="left">(0.12)</td>
<td align="left">0.01</td>
<td align="left">(0.11)</td>
<td align="left">-0.25</td>
<td align="left">(0.13)</td>
<td align="left">-0.25</td>
<td align="left">(0.13)</td>
<td align="left">-0.07</td>
<td align="left">(0.11)</td>
<td align="left">-0.25</td>
<td align="left">(0.13)</td>
</tr>
<tr class="even">
<td align="left">ebal</td>
<td align="left">-0.05</td>
<td align="left">(0.08)</td>
<td align="left">-0.27</td>
<td align="left">(0.14)</td>
<td align="left">-0.08</td>
<td align="left">(0.12)</td>
<td align="left">-0.03</td>
<td align="left">(0.12)</td>
<td align="left">-0.25</td>
<td align="left">(0.13)</td>
<td align="left">-0.25</td>
<td align="left">(0.13)</td>
<td align="left">-0.25</td>
<td align="left">(0.13)</td>
<td align="left">-0.25</td>
<td align="left">(0.13)</td>
</tr>
<tr class="odd">
<td align="left">dml</td>
<td align="left">-0.04</td>
<td align="left">(0.07)</td>
<td align="left">-0.18</td>
<td align="left">(0.11)</td>
<td align="left">0.06</td>
<td align="left">(0.10)</td>
<td align="left">-0.00</td>
<td align="left">(0.11)</td>
<td align="left">-0.08</td>
<td align="left">(0.10)</td>
<td align="left">-0.08</td>
<td align="left">(0.10)</td>
<td align="left">-0.08</td>
<td align="left">(0.10)</td>
<td align="left">-0.08</td>
<td align="left">(0.10)</td>
</tr>
<tr class="even">
<td align="left">aipw_grf</td>
<td align="left">-0.05</td>
<td align="left">(0.07)</td>
<td align="left">-0.76</td>
<td align="left">(0.15)</td>
<td align="left">-0.44</td>
<td align="left">(0.14)</td>
<td align="left">-0.44</td>
<td align="left">(0.17)</td>
<td align="left">-0.81</td>
<td align="left">(0.16)</td>
<td align="left">-0.81</td>
<td align="left">(0.16)</td>
<td align="left">-0.81</td>
<td align="left">(0.16)</td>
<td align="left">-0.81</td>
<td align="left">(0.16)</td>
</tr>
<tr class="odd">
<td align="left">aipw_ow</td>
<td align="left">-0.06</td>
<td align="left">(0.08)</td>
<td align="left">-0.67</td>
<td align="left">(0.15)</td>
<td align="left">-0.43</td>
<td align="left">(0.13)</td>
<td align="left">-0.33</td>
<td align="left">(0.13)</td>
<td align="left">-0.77</td>
<td align="left">(0.18)</td>
<td align="left">-0.77</td>
<td align="left">(0.18)</td>
<td align="left">-0.77</td>
<td align="left">(0.18)</td>
<td align="left">-0.77</td>
<td align="left">(0.18)</td>
</tr>
</tbody>
</table>
<p>The placebo analysis shows that the experimental benchmark is close to zero and statistically insignificant, while all estimators applied to the observational datasets produce comparable results.</p>
<div class="sourceCode" id="cb227"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb227-1"><a href="set-up.html#cb227-1" tabindex="-1"></a><span class="co"># save results </span></span>
<span id="cb227-2"><a href="set-up.html#cb227-2" tabindex="-1"></a><span class="fu">save_csv</span>(result_mat_pl, <span class="st">&quot;LCS_att_estimates_pl&quot;</span>)</span></code></pre></div>
</div>
<div id="validation-through-sensitivity-analyses" class="section level2 hasAnchor" number="2.10">
<h2><span class="header-section-number">2.10</span> Validation through sensitivity analyses<a href="set-up.html#validation-through-sensitivity-analyses" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div class="sourceCode" id="cb228"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb228-1"><a href="set-up.html#cb228-1" tabindex="-1"></a><span class="co"># define variables</span></span>
<span id="cb228-2"><a href="set-up.html#cb228-2" tabindex="-1"></a>Y <span class="ot">&lt;-</span> <span class="st">&quot;re79&quot;</span></span>
<span id="cb228-3"><a href="set-up.html#cb228-3" tabindex="-1"></a>treat <span class="ot">&lt;-</span> <span class="st">&quot;treat&quot;</span></span>
<span id="cb228-4"><a href="set-up.html#cb228-4" tabindex="-1"></a><span class="co"># redefine covariates</span></span>
<span id="cb228-5"><a href="set-up.html#cb228-5" tabindex="-1"></a>covar <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;age&quot;</span>, <span class="st">&quot;educ&quot;</span>, <span class="st">&quot;nodegree&quot;</span>, <span class="st">&quot;married&quot;</span>, <span class="st">&quot;black&quot;</span>, <span class="st">&quot;hisp&quot;</span>, <span class="st">&quot;re75&quot;</span>, <span class="st">&quot;u75&quot;</span>)</span>
<span id="cb228-6"><a href="set-up.html#cb228-6" tabindex="-1"></a>bm <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;re75&quot;</span>)</span></code></pre></div>
<div class="sourceCode" id="cb229"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb229-1"><a href="set-up.html#cb229-1" tabindex="-1"></a><span class="co"># check for valid datasets </span></span>
<span id="cb229-2"><a href="set-up.html#cb229-2" tabindex="-1"></a>datasets_sens <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fu">list</span>(lcs, lcs_psid), top5_datasets.psid_plus)</span>
<span id="cb229-3"><a href="set-up.html#cb229-3" tabindex="-1"></a>filtered_datasets_sens <span class="ot">&lt;-</span> <span class="fu">check_filter_datasets</span>(datasets_sens, Y, treat, covar, bm)</span></code></pre></div>
<div class="sourceCode" id="cb230"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb230-1"><a href="set-up.html#cb230-1" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">2</span>))</span>
<span id="cb230-2"><a href="set-up.html#cb230-2" tabindex="-1"></a><span class="fu">par</span>(<span class="at">cex.main =</span> <span class="fl">0.6</span>)</span>
<span id="cb230-3"><a href="set-up.html#cb230-3" tabindex="-1"></a><span class="co"># loop over valid datasets and assign index</span></span>
<span id="cb230-4"><a href="set-up.html#cb230-4" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="fu">seq_along</span>(filtered_datasets_sens)) {</span>
<span id="cb230-5"><a href="set-up.html#cb230-5" tabindex="-1"></a>    idx <span class="ot">&lt;-</span> <span class="fu">which</span>(<span class="fu">sapply</span>(datasets_sens, identical, filtered_datasets_sens[[i]]))</span>
<span id="cb230-6"><a href="set-up.html#cb230-6" tabindex="-1"></a>    <span class="fu">sens_ana</span>(filtered_datasets_sens[[i]], Y, treat, covar, bm, <span class="at">kd =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>)</span>
<span id="cb230-7"><a href="set-up.html#cb230-7" tabindex="-1"></a>    <span class="fu">title</span>(<span class="at">main =</span> plot_titles[idx])</span>
<span id="cb230-8"><a href="set-up.html#cb230-8" tabindex="-1"></a>}</span></code></pre></div>
<div class="figure"><span style="display:block;" id="fig:unnamed-chunk-164-1"></span>
<img src="Outcome-Weights_files/figure-html/unnamed-chunk-164-1.png" alt="FIGURE 14. Sensitivity Analyses LCS" width="100%" />
<p class="caption">
Figure 2.72: FIGURE 14. Sensitivity Analyses LCS
</p>
</div>
<div class="figure"><span style="display:block;" id="fig:unnamed-chunk-164-2"></span>
<img src="Outcome-Weights_files/figure-html/unnamed-chunk-164-2.png" alt="FIGURE 14. Sensitivity Analyses LCS" width="100%" />
<p class="caption">
Figure 2.73: FIGURE 14. Sensitivity Analyses LCS
</p>
</div>
<div class="sourceCode" id="cb231"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb231-1"><a href="set-up.html#cb231-1" tabindex="-1"></a><span class="co"># save results</span></span>
<span id="cb231-2"><a href="set-up.html#cb231-2" tabindex="-1"></a><span class="fu">save_sensitivity_plots</span>(filtered_datasets_sens, Y, treat, covar, bm, plot_titles, <span class="st">&quot;lcs&quot;</span>)</span></code></pre></div>
<p>The sensitivity analysis shows that treatment effect estimates in LCS-Experimental (A) are robust to unmeasured confounding, as expected. Observational samples instead show varying degrees of sensitivity, with the full observational sample (B) being more sensitive than the trimmed version (C). The top-ranked PSID1 samples (D-H) show that despite employing advanced criteria to improve balance and overlap, treatment effect estimates can exhibit increasing bias under plausible stronger confounding scenarios based on the reference confounder strength.</p>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="getting-started.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="summary.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
  "sharing": {
    "github": false,
    "facebook": true,
    "twitter": true,
    "linkedin": false,
    "weibo": false,
    "instapaper": false,
    "vk": false,
    "whatsapp": false,
    "all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
  },
  "fontsettings": {
    "theme": "white",
    "family": "sans",
    "size": 2
  },
  "edit": {
    "link": "https://github.com/USERNAME/REPO/edit/BRANCH/tutorial/05-LCS.Rmd",
    "text": "Edit"
  },
  "history": {
    "link": null,
    "text": null
  },
  "view": {
    "link": null,
    "text": null
  },
  "download": ["Outcome-Weights.pdf", "Outcome-Weights.epub"],
  "search": {
    "engine": "fuse",
    "options": null
  },
  "toc": {
    "collapse": "subsection"
  }
});
});
</script>

</body>

</html>
